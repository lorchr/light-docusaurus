<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/spring-authorization-server/SAS-Wechat-Login" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">SAS-Wechat-Login | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SAS-Wechat-Login | Light Docusaurus"><meta data-rh="true" name="description" content="- Spring Authorization Server入门 (十四) 联合身份认证添加微信登录"><meta data-rh="true" property="og:description" content="- Spring Authorization Server入门 (十四) 联合身份认证添加微信登录"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e8086d6f.css">
<script src="/assets/js/runtime~main.2519630d.js" defer="defer"></script>
<script src="/assets/js/main.a410c441.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a class="navbar__item navbar__link" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="折叠侧边栏分类 &#x27;Spring Authorization Server&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Geting-Start-Index/">SAS-Geting-Start-Index</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-OAuth2.1-Protocol/">SAS-OAuth2.1-Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Spring-Boot-Authorization-Server/">SAS-Spring-Boot-Authorization-Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Spring-Boot-Authorization-Server-Addition/">SAS-Spring-Boot-Authorization-Server-Addition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Device-Authorization/">SAS-Device-Authorization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Customize-Exception-Configurer/">SAS-Customize-Exception-Configurer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Token-Enhancer-And-Parser/">SAS-Token-Enhancer-And-Parser</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Image-Captcha/">SAS-Image-Captcha</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-OAuth2-Client/">SAS-OAuth2-Client</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-OAuth2-Resource-Server/">SAS-OAuth2-Resource-Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-SMS-Code-Login/">SAS-SMS-Code-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-OAuth2-Extension-Grant-Type/">SAS-OAuth2-Extension-Grant-Type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Frontend-Backend-Separate/">SAS-Frontend-Backend-Separate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Github-Gitee-Login/">SAS-Github-Gitee-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login/">SAS-Wechat-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Separate-Consent-And-Device-Authorize-Page/">SAS-Separate-Consent-And-Device-Authorize-Page</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Spring-Cloud-Gateway/">SAS-Spring-Cloud-Gateway</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Vue-Authorization-Code/">SAS-Vue-Authorization-Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Vue-PKCE/">SAS-Vue-PKCE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Redis-Core-Service/">SAS-Redis-Core-Service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-QrCode-Login/">SAS-QrCode-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/Opaque-Token-Resource-Server/">Opaque-Token-Resource-Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Wecom-DingTalk-Login/">SAS-Wecom-DingTalk-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/LDAP-Login/">LDAP-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/LDAP-Grant-Type/">LDAP-Grant-Type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Saml2-Login-Grant/">SAS-Saml2-Login-Grant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Build-GraalVM-Native-Image/">SAS-Build-GraalVM-Native-Image</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Kerberos-Login-Grant/">SAS-Kerberos-Login-Grant</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Getting-Start/">SAS-Getting-Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Opaque-Token/">SAS-Opaque-Token</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/Wecom-Login/">Wecom-Login</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Optimize-Customlize-UserDetailService/">SAS-Optimize-Customlize-UserDetailService</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Optimize-Add-Redis-Cache/">SAS-Optimize-Add-Redis-Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Optimize-Persistance-JWKSource/">SAS-Optimize-Persistance-JWKSource</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-Optimize-Redis-Serializer-Add-Jackson-Mixin/">SAS-Optimize-Redis-Serializer-Add-Jackson-Mixin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-authorization-server/SAS-FAQ/">SAS-FAQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/active-directory/">Active Directory</a><button aria-label="展开侧边栏分类 &#x27;Active Directory&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/awesome-open-source/">Github Speed UP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/spring-authorization-server/"><span itemprop="name">Spring Authorization Server</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SAS-Wechat-Login</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>SAS-Wechat-Login</h1></header><ul>
<li><a href="https://juejin.cn/post/7261098261142208568" target="_blank" rel="noopener noreferrer">Spring Authorization Server入门 (十四) 联合身份认证添加微信登录</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一前言">一、前言<a href="#一前言" class="hash-link" aria-label="一、前言的直接链接" title="一、前言的直接链接">​</a></h2>
<p>微信登录使用需要进行资质认证，虽然公众平台提供了测试号，但是测试号只能用在微信浏览器打开的网页中使用，如果将测试号用于扫码登录，则会提示scope参数错误；虽然微信登录的流程也是oauth的那一套流程，但是它要求的参数并不符合oauth的规范，所以想要集成进联合身份认证中则需要根据参数要求进行定制。</p>
<p><a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login" target="_blank" rel="noopener noreferrer">微信公众平台测试号申请地址</a>
<a href="https://mp.weixin.qq.com/wxamp/sandbox?doc=1" target="_blank" rel="noopener noreferrer">微信小程序测试号申请地址</a></p>
<p>接下来就该展示本人的三板斧了，理论、编码、测试。</p>
<p>如果不想看分析可以直接拉至中间的代码部分</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二定制分析">二、定制分析<a href="#二定制分析" class="hash-link" aria-label="二、定制分析的直接链接" title="二、定制分析的直接链接">​</a></h2>
<p>首先，打开<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noopener noreferrer">网页授权</a>的文档看一下微信登录并获取用户信息的流程，咱们根据文档一步步分析怎么去改造项目以适配微信登录</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-1-fe0097d6003af4616774644316f06df6.webp" width="466" height="205" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-第一步用户同意授权获取code">1. 第一步：用户同意授权获取code<a href="#1-第一步用户同意授权获取code" class="hash-link" aria-label="1. 第一步：用户同意授权获取code的直接链接" title="1. 第一步：用户同意授权获取code的直接链接">​</a></h3>
<p>参数列表(摘抄自微信登录文档)</p>
<table><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>appid</td><td>是</td><td>公众号的唯一标识</td></tr><tr><td>redirect_uri</td><td>是</td><td>授权后重定向的回调链接地址， 请使用 urlEncode 对链接进行处理</td></tr><tr><td>response_type</td><td>是</td><td>返回类型，请填写code</td></tr><tr><td>scope</td><td>是</td><td>应用授权作用域，snsapi_base （不弹出授权页面，直接跳转，只能获取用户openid），snsapi_userinfo （弹出授权页面，可通过openid拿到昵称、性别、所在地。并且， 即使在未关注的情况下，只要用户授权，也能获取其信息 ）</td></tr><tr><td>state</td><td>否</td><td>重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节</td></tr><tr><td>#wechat_redirect</td><td>是</td><td> 无论直接打开还是做页面302重定向时候，必须带此参数</td></tr><tr><td>forcePopup</td><td>否</td><td>强制此次授权需要用户弹窗确认；默认为false；需要注意的是，若用户命中了特殊场景下的静默授权逻辑，则此参数不生效</td></tr></tbody></table>
<p>      参数中有一个<code>appid</code>的参数，这个参数的意思是跟<code>client_id</code>是一样的，但是名字是叫<code>appid</code>，如果直接用OAuth2 Client根据这些参数登录的话是走不下去的，因为OAuth2 Client不会带<code>appid</code>参数，只会带<code>client_id</code>参数，所以这时候就要在跳转至请求授权页面之前修改授权申请的参数。</p>
<p>去<a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/client/authorization-grants.html#_customizing_the_authorization_request" target="_blank" rel="noopener noreferrer">Security OAuth2 Client文档</a>中找一下相关配置，发现文档中明确指出了自定义授权请求的配置，并给出了一个简单的示例，如下所示：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-2-fa5cfb224b13286eb87b99a4138a0a49.webp" width="1119" height="931" class="img_ev3q"></p>
<p>根据文档可知需要自定义一个<code>AuthorizationRequestResolver</code>来适配微信登录中的获取code</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-第二步通过code换取网页授权access_token">2. 第二步：通过code换取网页授权access_token<a href="#2-第二步通过code换取网页授权access_token" class="hash-link" aria-label="2. 第二步：通过code换取网页授权access_token的直接链接" title="2. 第二步：通过code换取网页授权access_token的直接链接">​</a></h3>
<p>参数列表(摘抄自微信登录文档)</p>
<table><thead><tr><th>参数</th><th>是否必须</th><th>说明</th></tr></thead><tbody><tr><td>appid</td><td>是</td><td>公众号的唯一标识</td></tr><tr><td>secret</td><td>  是</td><td>公众号的appsecret</td></tr><tr><td>code</td><td>是</td><td>填写第一步获取的code参数</td></tr><tr><td>grant_type</td><td>是</td><td>填写为authorization_code</td></tr></tbody></table>
<p>跟上一步一样，<code>clientid</code>需要改为<code>appid</code>，<code>client_secret</code>需要改为<code>secret</code>，继续去文档上找一下相关配置，文档中是有相关自定义请求<code>access_token</code>配置，详见<a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/client/authorization-grants.html#_customizing_the_access_token_request" target="_blank" rel="noopener noreferrer">Customizing the Access Token Request</a>，根据文档的说明可知需要自定义一个<code>CodeGrantRequestEntityConverter</code>来适配微信登录根据code获取<code>access_token</code></p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-3-4ce60f7cc82e191900745a4893fca272.webp" width="1263" height="246" class="img_ev3q"></p>
<p>响应参数列表</p>
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>access_token</td><td>网页授权接口调用凭证,注意：此access_token与基础支持的access_token不同</td></tr><tr><td>expires_inaccess_token</td><td>接口调用凭证超时时间，单位（秒）</td></tr><tr><td>refresh_token</td><td>用户刷新access_token</td></tr><tr><td>openid</td><td>用户唯一标识</td></tr><tr><td>scope</td><td>用户授权的作用域，使用逗号（,）分隔</td></tr></tbody></table>
<p>在这里放响应参数列表是因为它响应的数据跟框架需要的数据格式不一样，相较于标准响应多了一个<code>openid</code>，少了一个<code>token_type</code>，框架会自动将多出来的响应数据放入<code>additionalParameters</code>属性中，但是少的<code>tokenType</code>属性需要给一个默认的type，所以这里要给以自定义的转换类；同时也因为在获取用户信息时需要带上<code>openid</code>这个属性值 。</p>
<p>刷新token部分如果需要的话可以去了解一下</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-第三步拉取用户信息需scope为-snsapi_userinfo">3. 第三步：拉取用户信息(需scope为 snsapi_userinfo)<a href="#3-第三步拉取用户信息需scope为-snsapi_userinfo" class="hash-link" aria-label="3. 第三步：拉取用户信息(需scope为 snsapi_userinfo)的直接链接" title="3. 第三步：拉取用户信息(需scope为 snsapi_userinfo)的直接链接">​</a></h3>
<p>参数列表(摘抄自微信登录文档)</p>
<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>access_token</td><td>网页授权接口调用凭证,注意：此access_token与基础支持的access_token不同</td></tr><tr><td>openid</td><td>用户的唯一标识</td></tr><tr><td>lang</td><td>返回国家地区语言版本，zh_CN 简体，zh_TW 繁体，en 英语</td></tr></tbody></table>
<p>正如上一步句尾说的，要携带openid发起请求，并且要携带<code>access_token</code>参数，默认<code>access_token</code>是放在请求头中的，格式为：<code>Authorization: token_type access_token</code>，这里也要修改一下携带方式，如果看过上一篇文章的读者应该还记得我们是自己重写<code>OAuth2UserService</code>，文档中关于该类的描述中也提到了在请求用户信息之前的配置，需要提供一个<code>RequestEntityConverter</code>并通过<code>OAuth2UserService</code>的<code>setRequestEntityConverter</code>设置进去，详见<a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/login/advanced.html#oauth2login-advanced-oauth2-user-service" target="_blank" rel="noopener noreferrer">文档</a>；所以这里也要提供一个<code>RequestEntityConverter</code>并添加至自定义<code>OAuth2UserService</code>中。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-4-e418c57489df96c5cb6d40950e9e1b7b.webp" width="1256" height="816" class="img_ev3q"></p>
<p>你以 为这就完了吗？ Of course not!!! 框架在解析响应体的时候会根据<code>content-type</code>去解析，框架只会将<code>application/json</code>的<code>mediaType</code>解析为<code>bean</code>，不管是获取<code>token</code>还是获取用户信息的请求，框架都是用<code>restTemplate</code>发起请求，并且指定了响应数据的java类，以上提到的所有接口，除了获取code是重定向，其它都有响应，恶心的是微信响应回来的<code>content-type</code>是<code>text/plain</code>，框架会因为找不到解析的类型从而抛出异常，所以还要配置一下，让框架也解析<code>text/plain</code>数据。</p>
<p>在之前的文章中虽然本人自定义了很多内容，但是关于授权端点的请求与响应都没有去修改，用户信息接口直接返回了用户信息类，没有返回一个统一响应类的原因就在这里，如果修改了这些东西，那么等你将服务提供出去以后对接方会异常痛苦，并且可能边对接边骂(没错，正是在下)，相对于标准oauth2协议对接起来实在是太痛苦了。要牢记Spring Boot的“约定大于配置”。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三编码部分">三、编码部分<a href="#三编码部分" class="hash-link" aria-label="三、编码部分的直接链接" title="三、编码部分的直接链接">​</a></h2>
<p>根据上边的分析发现，对接微信登录需要从头改到尾，授权申请、用<code>code</code>换取<code>token</code>和用<code>token</code>获取用户信息都要修改。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-编码内容">1. 编码内容<a href="#1-编码内容" class="hash-link" aria-label="1. 编码内容的直接链接" title="1. 编码内容的直接链接">​</a></h3>
<ol>
<li>编写<code>WechatAuthorizationRequestConsumer</code>类，授权申请接口携带的参数。</li>
<li>编写<code>WechatCodeGrantRequestEntityConverter</code>类，修改<code>code</code>换取<code>access_token</code>时携带的参数。</li>
<li>编写<code>WechatMapAccessTokenResponseConverter</code>类，根据响应数据生成<code>OAuth2AccessTokenResponse</code>类的实例。</li>
<li>编写<code>WechatUserRequestEntityConverter</code>类，修改请求用户信息的参数。</li>
<li>编写<code>WechatUserResponseConverter</code>类，让框架可以解析<code>text/plain</code>响应信息。</li>
<li>将上边的类添加至配置中，使其生效。</li>
<li>用户信息处理策略添加<code>WechatUserConverter</code>类，使其解析微信用户信息。</li>
<li>yml中添加微信应用配置信息。</li>
<li>登录页面添加微信登录入口。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-在comexampleauthorizationwechat包中添加wechatauthorizationrequestconsumer类">2. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatAuthorizationRequestConsumer</code>类<a href="#2-在comexampleauthorizationwechat包中添加wechatauthorizationrequestconsumer类" class="hash-link" aria-label="2-在comexampleauthorizationwechat包中添加wechatauthorizationrequestconsumer类的直接链接" title="2-在comexampleauthorizationwechat包中添加wechatauthorizationrequestconsumer类的直接链接">​</a></h3>
<p>判断是否微信登录，如果是微信登录则将<code>appid</code>添加至请求参数中</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 自定义微信登录认证请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WechatAuthorizationRequestConsumer implements Consumer&lt;OAuth2AuthorizationRequest.Builder&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void accept(OAuth2AuthorizationRequest.Builder builder) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OAuth2AuthorizationRequest authorizationRequest = builder.build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object registrationId = authorizationRequest.getAttribute(OAuth2ParameterNames.REGISTRATION_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Objects.equals(registrationId, THIRD_LOGIN_WECHAT)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 判断是否微信登录，如果是微信登录则将appid添加至请求参数中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            builder.additionalParameters((params) -&gt; params.put(WECHAT_PARAMETER_FORCE_POPUP, true));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            builder.additionalParameters((params) -&gt; params.put(WECHAT_PARAMETER_APPID, authorizationRequest.getClientId()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 微信的PC端认证对参数顺序有强正则校验，修改参数顺序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            builder.parameters((params) -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 移除oauth2参数，顺序不对不能正常获取到微信授权码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(OAuth2ParameterNames.RESPONSE_TYPE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(OAuth2ParameterNames.CLIENT_ID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(OAuth2ParameterNames.SCOPE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(OAuth2ParameterNames.STATE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(OAuth2ParameterNames.REDIRECT_URI);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(SecurityConstants.WECHAT_PARAMETER_FORCE_POPUP);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.remove(SecurityConstants.WECHAT_PARAMETER_APPID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 重新添加到参数中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(SecurityConstants.WECHAT_PARAMETER_APPID, authorizationRequest.getClientId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(OAuth2ParameterNames.REDIRECT_URI, authorizationRequest.getRedirectUri());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(OAuth2ParameterNames.RESPONSE_TYPE, authorizationRequest.getResponseType().getValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(OAuth2ParameterNames.SCOPE, StringUtils.collectionToDelimitedString(authorizationRequest.getScopes(), &quot; &quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(OAuth2ParameterNames.STATE, authorizationRequest.getState());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(OAuth2ParameterNames.CLIENT_ID, authorizationRequest.getClientId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                params.put(SecurityConstants.WECHAT_PARAMETER_FORCE_POPUP, true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-在comexampleauthorizationwechat包中添加wechatcodegrantrequestentityconverter类">3. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatCodeGrantRequestEntityConverter</code>类<a href="#3-在comexampleauthorizationwechat包中添加wechatcodegrantrequestentityconverter类" class="hash-link" aria-label="3-在comexampleauthorizationwechat包中添加wechatcodegrantrequestentityconverter类的直接链接" title="3-在comexampleauthorizationwechat包中添加wechatcodegrantrequestentityconverter类的直接链接">​</a></h3>
<p>如果是微信登录，获取<code>token</code>时携带<code>appid</code>参数与<code>secret</code>参数</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录请求token入参处理类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WechatCodeGrantRequestEntityConverter extends OAuth2AuthorizationCodeGrantRequestEntityConverter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected MultiValueMap&lt;String, String&gt; createParameters(OAuth2AuthorizationCodeGrantRequest authorizationCodeGrantRequest) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 如果是微信登录，获取token时携带appid参数与secret参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MultiValueMap&lt;String, String&gt; parameters = super.createParameters(authorizationCodeGrantRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String registrationId = authorizationCodeGrantRequest.getClientRegistration().getRegistrationId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (THIRD_LOGIN_WECHAT.equals(registrationId)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 如果当前是微信登录，携带appid和secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters.add(WECHAT_PARAMETER_APPID, authorizationCodeGrantRequest.getClientRegistration().getClientId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters.add(WECHAT_PARAMETER_SECRET, authorizationCodeGrantRequest.getClientRegistration().getClientSecret());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return parameters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RequestEntity&lt;?&gt; convert(OAuth2AuthorizationCodeGrantRequest authorizationGrantRequest) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RequestEntity&lt;?&gt; requestEntity = super.convert(authorizationGrantRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String registrationId = authorizationGrantRequest.getClientRegistration().getRegistrationId();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 框架默认是POST请求，参数在form-data中，微信的token接口参数在queryParam中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (SecurityConstants.THIRD_LOGIN_WECHAT.equals(registrationId)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            URI url = requestEntity.getUrl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LinkedMultiValueMap&lt;String, List&lt;String&gt;&gt; body = (LinkedMultiValueMap&lt;String, List&lt;String&gt;&gt;) requestEntity.getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            URI uri = UriComponentsBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .fromUri(url)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(SecurityConstants.WECHAT_PARAMETER_APPID, body.get(SecurityConstants.WECHAT_PARAMETER_APPID))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(SecurityConstants.WECHAT_PARAMETER_SECRET, body.get(SecurityConstants.WECHAT_PARAMETER_SECRET))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(OAuth2ParameterNames.CODE, body.get(OAuth2ParameterNames.CODE))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(OAuth2ParameterNames.GRANT_TYPE, body.get(OAuth2ParameterNames.GRANT_TYPE))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(OAuth2ParameterNames.REDIRECT_URI, body.get(OAuth2ParameterNames.REDIRECT_URI))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build().toUri();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new RequestEntity&lt;&gt;(HttpMethod.GET, uri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return requestEntity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-在comexampleauthorizationwechat包中添加wechatmapaccesstokenresponseconverter类">4. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatMapAccessTokenResponseConverter</code>类<a href="#4-在comexampleauthorizationwechat包中添加wechatmapaccesstokenresponseconverter类" class="hash-link" aria-label="4-在comexampleauthorizationwechat包中添加wechatmapaccesstokenresponseconverter类的直接链接" title="4-在comexampleauthorizationwechat包中添加wechatmapaccesstokenresponseconverter类的直接链接">​</a></h3>
<p>这个类逻辑是默认的<code>DefaultMapOAuth2AccessTokenResponseConverter</code>类中的逻辑，唯一的改动就是在<code>token type</code>为空时给个默认值</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录获取token的响应处理类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WechatMapAccessTokenResponseConverter implements Converter&lt;Map&lt;String, Object&gt;, OAuth2AccessTokenResponse&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Set&lt;String&gt; TOKEN_RESPONSE_PARAMETER_NAMES = new HashSet&lt;&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Arrays.asList(OAuth2ParameterNames.ACCESS_TOKEN, OAuth2ParameterNames.EXPIRES_IN,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    OAuth2ParameterNames.REFRESH_TOKEN, OAuth2ParameterNames.SCOPE, OAuth2ParameterNames.TOKEN_TYPE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OAuth2AccessTokenResponse convert(Map&lt;String, Object&gt; source) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String accessToken = getParameterValue(source, OAuth2ParameterNames.ACCESS_TOKEN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OAuth2AccessToken.TokenType accessTokenType = getAccessTokenType(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long expiresIn = getExpiresIn(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Set&lt;String&gt; scopes = getScopes(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String refreshToken = getParameterValue(source, OAuth2ParameterNames.REFRESH_TOKEN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; additionalParameters = new LinkedHashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Map.Entry&lt;String, Object&gt; entry : source.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!TOKEN_RESPONSE_PARAMETER_NAMES.contains(entry.getKey())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                additionalParameters.put(entry.getKey(), entry.getValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return OAuth2AccessTokenResponse.withToken(accessToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 如果token type为空，给个默认值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .tokenType(accessTokenType == null ? OAuth2AccessToken.TokenType.BEARER : accessTokenType)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .expiresIn(expiresIn)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .scopes(scopes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .refreshToken(refreshToken)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .additionalParameters(additionalParameters)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static OAuth2AccessToken.TokenType getAccessTokenType(Map&lt;String, Object&gt; tokenResponseParameters) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (OAuth2AccessToken.TokenType.BEARER.getValue()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .equalsIgnoreCase(getParameterValue(tokenResponseParameters, OAuth2ParameterNames.TOKEN_TYPE))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return OAuth2AccessToken.TokenType.BEARER;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static long getExpiresIn(Map&lt;String, Object&gt; tokenResponseParameters) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return getParameterValue(tokenResponseParameters, OAuth2ParameterNames.EXPIRES_IN, 0L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static Set&lt;String&gt; getScopes(Map&lt;String, Object&gt; tokenResponseParameters) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (tokenResponseParameters.containsKey(OAuth2ParameterNames.SCOPE)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String scope = getParameterValue(tokenResponseParameters, OAuth2ParameterNames.SCOPE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new HashSet&lt;&gt;(Arrays.asList(StringUtils.delimitedListToStringArray(scope, &quot; &quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Collections.emptySet();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static String getParameterValue(Map&lt;String, Object&gt; tokenResponseParameters, String parameterName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj = tokenResponseParameters.get(parameterName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (obj != null) ? obj.toString() : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static long getParameterValue(Map&lt;String, Object&gt; tokenResponseParameters, String parameterName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                          long defaultValue) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long parameterValue = defaultValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object obj = tokenResponseParameters.get(parameterName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (obj != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Final classes Long and Integer do not need to be coerced</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (obj.getClass() == Long.class) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                parameterValue = (Long) obj;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else if (obj.getClass() == Integer.class) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                parameterValue = (Integer) obj;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Attempt to coerce to a long (typically from a String)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    parameterValue = Long.parseLong(obj.toString());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                catch (NumberFormatException ignored) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return parameterValue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-在comexampleauthorizationwechat包中添加wechatuserrequestentityconverter类">5. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatUserRequestEntityConverter</code>类<a href="#5-在comexampleauthorizationwechat包中添加wechatuserrequestentityconverter类" class="hash-link" aria-label="5-在comexampleauthorizationwechat包中添加wechatuserrequestentityconverter类的直接链接" title="5-在comexampleauthorizationwechat包中添加wechatuserrequestentityconverter类的直接链接">​</a></h3>
<p>对于微信登录的特殊处理，请求用户信息时添加<code>openid</code>与<code>access_token</code>参数</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录获取用户信息参数转换器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WechatUserRequestEntityConverter extends OAuth2UserRequestEntityConverter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RequestEntity&lt;?&gt; convert(OAuth2UserRequest userRequest) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取配置文件中的客户端信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClientRegistration clientRegistration = userRequest.getClientRegistration();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (THIRD_LOGIN_WECHAT.equals(clientRegistration.getRegistrationId())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 对于微信登录的特殊处理，请求用户信息时添加openid与access_token参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object openid = userRequest.getAdditionalParameters().get(WECHAT_PARAMETER_OPENID);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            URI uri = UriComponentsBuilder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .fromUriString(clientRegistration.getProviderDetails().getUserInfoEndpoint().getUri())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(WECHAT_PARAMETER_OPENID, openid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .queryParam(OAuth2ParameterNames.ACCESS_TOKEN, userRequest.getAccessToken().getTokenValue())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build().toUri();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new RequestEntity&lt;&gt;(HttpMethod.GET, uri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return super.convert(userRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-在comexampleauthorizationwechat包中添加wechatuserresponseconverter类">6. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatUserResponseConverter</code>类<a href="#6-在comexampleauthorizationwechat包中添加wechatuserresponseconverter类" class="hash-link" aria-label="6-在comexampleauthorizationwechat包中添加wechatuserresponseconverter类的直接链接" title="6-在comexampleauthorizationwechat包中添加wechatuserresponseconverter类的直接链接">​</a></h3>
<p>微信获取用户信息时响应的类型为<code>text/plain</code>，这里特殊处理一下</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信用户信息响应转换器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WechatUserResponseConverter extends MappingJackson2HttpMessageConverter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public WechatUserResponseConverter() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;MediaType&gt; mediaTypes = new ArrayList&lt;&gt;(super.getSupportedMediaTypes());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 微信获取用户信息时响应的类型为“text/plain”，这里特殊处理一下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mediaTypes.add(MediaType.TEXT_PLAIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super.setSupportedMediaTypes(mediaTypes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-将上边的类添加至配置中使其生效">7. 将上边的类添加至配置中，使其生效<a href="#7-将上边的类添加至配置中使其生效" class="hash-link" aria-label="7. 将上边的类添加至配置中，使其生效的直接链接" title="7. 将上边的类添加至配置中，使其生效的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-authorizationconfig类的配置">1. <code>AuthorizationConfig</code>类的配置<a href="#1-authorizationconfig类的配置" class="hash-link" aria-label="1-authorizationconfig类的配置的直接链接" title="1-authorizationconfig类的配置的直接链接">​</a></h4>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 配置认证相关的过滤器链(资源服务，客户端配置)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param http spring security核心配置类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 过滤器链</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws Exception 抛出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http, ClientRegistrationRepository clientRegistrationRepository) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 添加跨域过滤器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.addFilter(corsFilter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 禁用 csrf 与 cors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.csrf(AbstractHttpConfigurer::disable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.cors(AbstractHttpConfigurer::disable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.authorizeHttpRequests((authorize) -&gt; authorize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        // 放行静态资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .requestMatchers(&quot;/assets/**&quot;, &quot;/webjars/**&quot;, &quot;/login&quot;, &quot;/getCaptcha&quot;, &quot;/getSmsCaptcha&quot;, &quot;/error&quot;).permitAll()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .anyRequest().authenticated()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 指定登录页面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .formLogin(formLogin -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            formLogin.loginPage(&quot;/login&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            if (UrlUtils.isAbsoluteUrl(LOGIN_URL)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                // 绝对路径代表是前后端分离，登录成功和失败改为写回json，不重定向了</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                formLogin.successHandler(new LoginSuccessHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                formLogin.failureHandler(new LoginFailureHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 添加BearerTokenAuthenticationFilter，将认证服务当做一个资源服务，解析请求头中的token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.oauth2ResourceServer((resourceServer) -&gt; resourceServer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .jwt(Customizer.withDefaults())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .accessDeniedHandler(SecurityUtils::exceptionHandler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .authenticationEntryPoint(SecurityUtils::exceptionHandler)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 兼容前后端分离与不分离配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (UrlUtils.isAbsoluteUrl(LOGIN_URL)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 当未登录时访问认证端点时重定向至login页面</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .exceptionHandling((exceptions) -&gt; exceptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .defaultAuthenticationEntryPointFor(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    new LoginTargetAuthenticationEntryPoint(LOGIN_URL),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    new MediaTypeRequestMatcher(MediaType.TEXT_HTML)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 联合身份认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.oauth2Login(oauth2Login -&gt; oauth2Login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .loginPage(LOGIN_URL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .authorizationEndpoint(authorization -&gt; authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .authorizationRequestResolver(this.authorizationRequestResolver(clientRegistrationRepository))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .tokenEndpoint(token -&gt; token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .accessTokenResponseClient(this.accessTokenResponseClient())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 使用redis存储、读取登录的认证信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        http.securityContext(context -&gt; context.securityContextRepository(redisSecurityContextRepository));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return http.build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * AuthorizationRequest 自定义配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param clientRegistrationRepository yml配置中客户端信息存储类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return OAuth2AuthorizationRequestResolver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private OAuth2AuthorizationRequestResolver authorizationRequestResolver(ClientRegistrationRepository clientRegistrationRepository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultOAuth2AuthorizationRequestResolver authorizationRequestResolver =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new DefaultOAuth2AuthorizationRequestResolver(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        clientRegistrationRepository, &quot;/oauth2/authorization&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 兼容微信登录授权申请</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        authorizationRequestResolver.setAuthorizationRequestCustomizer(new WechatAuthorizationRequestConsumer());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return authorizationRequestResolver;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 适配微信登录适配，添加自定义请求token入参处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return OAuth2AccessTokenResponseClient accessToken响应信息处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private OAuth2AccessTokenResponseClient&lt;OAuth2AuthorizationCodeGrantRequest&gt; accessTokenResponseClient() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DefaultAuthorizationCodeTokenResponseClient tokenResponseClient = new DefaultAuthorizationCodeTokenResponseClient();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tokenResponseClient.setRequestEntityConverter(new WechatCodeGrantRequestEntityConverter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 自定义 RestTemplate，适配微信登录获取token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        OAuth2AccessTokenResponseHttpMessageConverter messageConverter = new OAuth2AccessTokenResponseHttpMessageConverter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;MediaType&gt; mediaTypes = new ArrayList&lt;&gt;(messageConverter.getSupportedMediaTypes());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 微信获取token时响应的类型为“text/plain”，这里特殊处理一下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mediaTypes.add(MediaType.TEXT_PLAIN);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        messageConverter.setAccessTokenResponseConverter(new WechatMapAccessTokenResponseConverter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        messageConverter.setSupportedMediaTypes(mediaTypes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 初始化RestTemplate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RestTemplate restTemplate = new RestTemplate(Arrays.asList(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new FormHttpMessageConverter(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                messageConverter));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        restTemplate.setErrorHandler(new OAuth2ErrorResponseErrorHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tokenResponseClient.setRestOperations(restTemplate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return tokenResponseClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-customoauth2userservice改造">2. <code>CustomOauth2UserService</code>改造<a href="#2-customoauth2userservice改造" class="hash-link" aria-label="2-customoauth2userservice改造的直接链接" title="2-customoauth2userservice改造的直接链接">​</a></h4>
<p>移除类上的<code>@RequiredArgsConstructor</code>注解，自己实现构造方法，初始化时添加微信用户信息请求处理(<code>oidcUserService</code>本质上是调用该类获取用户信息的，不用添加)，设置用户信息转换器，获取微信用户信息时使其支持<code>text/plain</code>的<code>Context-Type</code>。添加异常处理，将异常信息放入<code>session</code>中，重定向至登录时可以获取到异常信息。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 自定义三方oauth2登录获取用户信息服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CustomOauth2UserService extends DefaultOAuth2UserService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final IOauth2ThirdAccountService thirdAccountService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Oauth2UserConverterContext userConverterContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CustomOauth2UserService(IOauth2ThirdAccountService thirdAccountService, Oauth2UserConverterContext userConverterContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.thirdAccountService = thirdAccountService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.userConverterContext = userConverterContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 初始化时添加微信用户信息请求处理，oidcUserService本质上是调用该类获取用户信息的，不用添加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super.setRequestEntityConverter(new WechatUserRequestEntityConverter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设置用户信息转换器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RestTemplate restTemplate = new RestTemplate();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        restTemplate.setErrorHandler(new OAuth2ErrorResponseErrorHandler());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;HttpMessageConverter&lt;?&gt;&gt; messageConverters = List.of(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new StringHttpMessageConverter(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 获取微信用户信息时使其支持“text/plain”</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new WechatUserResponseConverter(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new ResourceHttpMessageConverter(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new ByteArrayHttpMessageConverter(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new AllEncompassingFormHttpMessageConverter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        restTemplate.setMessageConverters(messageConverters);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super.setRestOperations(restTemplate);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OAuth2User loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            OAuth2User oAuth2User = super.loadUser(userRequest);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 转为项目中的三方用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Oauth2ThirdAccount oauth2ThirdAccount = userConverterContext.convert(userRequest, oAuth2User);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 检查用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            thirdAccountService.checkAndSaveUser(oauth2ThirdAccount);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 将loginType设置至attributes中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LinkedHashMap&lt;String, Object&gt; attributes = new LinkedHashMap&lt;&gt;(oAuth2User.getAttributes());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 将RegistrationId当做登录类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            attributes.put(&quot;loginType&quot;, userRequest.getClientRegistration().getRegistrationId());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String userNameAttributeName = userRequest.getClientRegistration().getProviderDetails().getUserInfoEndpoint()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .getUserNameAttributeName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new DefaultOAuth2User(oAuth2User.getAuthorities(), attributes, userNameAttributeName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 获取当前request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (requestAttributes == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new InvalidCaptchaException(&quot;Failed to get the current request.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 将异常放入session中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            request.getSession(Boolean.FALSE).setAttribute(WebAttributes.AUTHENTICATION_EXCEPTION, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new AuthenticationServiceException(e.getMessage(), e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-用户信息处理策略添加wechatuserconverter类使其解析微信用户信息">8. 用户信息处理策略添加<code>WechatUserConverter</code>类，使其解析微信用户信息<a href="#8-用户信息处理策略添加wechatuserconverter类使其解析微信用户信息" class="hash-link" aria-label="8-用户信息处理策略添加wechatuserconverter类使其解析微信用户信息的直接链接" title="8-用户信息处理策略添加wechatuserconverter类使其解析微信用户信息的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信用户信息转换器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author vains</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequiredArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component(THIRD_LOGIN_WECHAT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class WechatUserConverter implements Oauth2UserConverterStrategy {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Oauth2ThirdAccount convert(OAuth2User oAuth2User) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取三方用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; attributes = oAuth2User.getAttributes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 转换至Oauth2ThirdAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Oauth2ThirdAccount thirdAccount = new Oauth2ThirdAccount();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        thirdAccount.setUniqueId(String.valueOf(attributes.get(&quot;openid&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        thirdAccount.setThirdUsername(oAuth2User.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        thirdAccount.setType(THIRD_LOGIN_WECHAT);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        thirdAccount.setLocation(attributes.get(&quot;province&quot;)+ &quot; &quot; + attributes.get(&quot;city&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 设置基础用户信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        thirdAccount.setName(oAuth2User.getName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        thirdAccount.setAvatarUrl(String.valueOf(attributes.get(&quot;headimgurl&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return thirdAccount;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-yml中添加微信应用配置信息">9. yml中添加微信应用配置信息<a href="#9-yml中添加微信应用配置信息" class="hash-link" aria-label="9. yml中添加微信应用配置信息的直接链接" title="9. yml中添加微信应用配置信息的直接链接">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">datasource</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver-class-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.mysql.cj.jdbc.Driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> jdbc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">mysql</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">3306/authorization</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">?</span><span class="token plain">serverTimezone=UTC</span><span class="token important">&amp;userUnicode=true&amp;characterEncoding=utf-</span><span class="token number" style="color:#36acaa">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">username</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">security</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">oauth2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">client</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">registration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 这个&#x27;gitee&#x27;就是registrationId</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">gitee</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 指定oauth登录提供者，该oauth登录由provider中的gitee来处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 客户端名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Sign in with Gitee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 认证方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">authorization-grant-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> authorization_code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 客户端id，使用自己的gitee的客户端id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 客户端秘钥，使用自己的gitee的客户端秘钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 回调地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">redirect-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.1.102</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/login/oauth2/code/gitee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 申请scope列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> emails</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> projects</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">github</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># security client默认实现了GitHub提供的oauth2登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">wechat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 微信登录配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wechat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 客户端名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Sign in with WeChat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 认证方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">authorization-grant-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> authorization_code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 客户端id，使用自己的微信的appid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 客户端秘钥，使用自己的微信的app secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">client-secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 回调地址，设置为认证服务的回调地址，由认证服务用code换取token</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">redirect-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.1.102</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">8080/login/oauth2/code/wechat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 申请scope列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> snsapi_userinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># oauth登录提供商</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 微信的OAuth2端点配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">wechat</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 设置用户信息响应体中账号的字段</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user-name-attribute</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nickname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 获取token的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">token-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//api.weixin.qq.com/sns/oauth2/access_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 获取用户信息的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user-info-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//api.weixin.qq.com/sns/userinfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 发起授权申请的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">authorization-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//open.weixin.qq.com/connect/oauth2/authorize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># gitee的OAuth2端点配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">gitee</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 设置用户信息响应体中账号的 字段</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user-name-attribute</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 获取token的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">token-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gitee.com/oauth/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 获取用户信息的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user-info-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gitee.com/api/v5/user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># 发起授权申请的地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">authorization-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gitee.com/oauth/authorize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">github</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">user-name-attribute</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Mybatis-Plus 配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mybatis-plus</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 扫描mapper文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mapper-locations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">com/vains/mapper/xml/</span><span class="token important">*Mapper.xml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-登录页面添加微信登录入口">10. 登录页面添加微信登录入口<a href="#10-登录页面添加微信登录入口" class="hash-link" aria-label="10. 登录页面添加微信登录入口的直接链接" title="10. 登录页面添加微信登录入口的直接链接">​</a></h3>
<p>将上期的按钮改成图标了，重点的是点击微信登录按钮后要让请求跳转至<code>/oauth2/authorization/wechat</code>，<code>wechat</code>就是上边yml中微信应用的<code>registrationId</code>，这里要注意对应上</p>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">third-box</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/oauth2/authorization/gitee</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">title</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Gitee登录</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">svg</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">width</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">32</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">height</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">32</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">xmlns</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">http://www.w3.org/2000/svg</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">zi_tmGitee</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">             </span><span class="token tag attr-name" style="color:#00a4db">viewBox</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0 0 2000 2000</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">path</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">fill</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">red</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">                  </span><span class="token tag attr-name" style="color:#00a4db">d</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">M898 1992q183 0 344-69.5t283-191.5q122-122 191.5-283t69.5-344q0-183-69.5-344T1525 477q-122-122-283-191.5T898 216q-184 0-345 69.5T270 477Q148 599 78.5 760T9 1104q0 183 69.5 344T270 1731q122 122 283 191.5t345 69.5zm199-400H448q-17 0-30.5-14t-13.5-30V932q0-89 43.5-163.5T565 649q74-45 166-45h616q17 0 30.5 14t13.5 31v111q0 16-13.5 30t-30.5 14H731q-54 0-93.5 39.5T598 937v422q0 17 14 30.5t30 13.5h416q55 0 94.5-39.5t39.5-93.5v-22q0-17-14-30.5t-31-13.5H842q-17 0-30.5-14t-13.5-31v-111q0-16 13.5-30t30.5-14h505q17 0 30.5 14t13.5 30v250q0 121-86.5 207.5T1097 1592z</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">svg</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">a</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/oauth2/authorization/github</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">title</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">GitHub登录</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">width</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">36</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">margin-right</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">5</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">px</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">alt</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Sign in with GitHub</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">             </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">a</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">a</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">href</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">/oauth2/authorization/wechat</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">title</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">GitHub登录</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">img</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">width</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">28</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">style</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">margin-right</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css number" style="color:#36acaa">5</span><span class="token tag special-attr attr-value value css language-css unit" style="color:#e3116c">px</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> </span><span class="token tag special-attr attr-value value css language-css property" style="color:#36acaa">position</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">:</span><span class="token tag special-attr attr-value value css language-css" style="color:#e3116c"> static</span><span class="token tag special-attr attr-value value css language-css punctuation" style="color:#393A34">;</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">alt</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Sign in with GitHub</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token tag" style="color:#00009f">             </span><span class="token tag attr-name" style="color:#00a4db">src</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">./assets/img/wechat_login.png</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">a</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11补充">11.补充<a href="#11补充" class="hash-link" aria-label="11.补充的直接链接" title="11.补充的直接链接">​</a></h3>
<p><code>SecurityConstants</code>常量类中的常量</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录相关参数——openid：用户唯一id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static final String WECHAT_PARAMETER_OPENID = &quot;openid&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录相关参数——forcePopup：强制此次授权需要用户弹窗确认</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static final String WECHAT_PARAMETER_FORCE_POPUP = &quot;forcePopup&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录相关参数——secret：微信的应用秘钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static final String WECHAT_PARAMETER_SECRET = &quot;secret&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 微信登录相关参数——appid：微信的应用id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static final String WECHAT_PARAMETER_APPID = &quot;appid&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 三方登录类型——微信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static final String THIRD_LOGIN_WECHAT = &quot;wechat&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>到此为止编码部分就完成了，微信登录的图标可以去gitee上取一下或者自己找一下就行，代码仓库地址在最后的附录中。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四微信测试号配置简要说明">四、微信测试号配置简要说明<a href="#四微信测试号配置简要说明" class="hash-link" aria-label="四、微信测试号配置简要说明的直接链接" title="四、微信测试号配置简要说明的直接链接">​</a></h2>
<p>微信应用配置中<code>appid</code>和<code>app secret</code>大家用自己的，如果没有认证资质也可以像作者这样去申请一个微信测试号去测试，因为这里限制了只有关注了测试公众号才可以使用，最多只能关注100个，所以大家去申请一个测试就ok。</p>
<p>下边我会放一下测试号的截图，要是真想用可以关注下测试号(有回调地址的限制)</p>
<table><thead><tr><th>key</th><th>value</th></tr></thead><tbody><tr><td>appID</td><td>wx946ad2f955901214</td></tr><tr><td>appsecret</td><td>e4635ff2ed22c83294394ac818cf75a7</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-5-6d5d22c746353db7ec2f5d3b66f53946.webp" width="1512" height="760" class="img_ev3q"></p>
<p>测试号的二维码，扫描关注后才可使用</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-6-f05d25f8faf75b6968c0a0ff3f1f48cc.webp" width="1366" height="886" class="img_ev3q"></p>
<p><strong>重要：</strong> 想让联合认证流程走下去要修改回调地址为认证服务器的地址
点击修改，在弹出的框内输入认证服务的地址</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-7-ae38251f7e206850136198b006e3b902.webp" width="1486" height="789" class="img_ev3q"></p>
<p>修改回调地址</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-8-e11cbbe1fb91fa457b2ff9991b14ea04.webp" width="1290" height="723" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五测试">五、测试<a href="#五测试" class="hash-link" aria-label="五、测试的直接链接" title="五、测试的直接链接">​</a></h2>
<p>测试号限制了只能在微信客户端打开授权申请地址，所以本次测试要在微信内打开认证服务的授权申请地址</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-微信内打开授权申请地址">1. 微信内打开授权申请地址<a href="#1-微信内打开授权申请地址" class="hash-link" aria-label="1. 微信内打开授权申请地址的直接链接" title="1. 微信内打开授权申请地址的直接链接">​</a></h3>
<p><del>不知道为什么pc端微信跳转至微信的授权申请页面时是空白，这里我用手机进行测试。</del></p>
<p>  经评论区提醒发现是因为参数的顺序问题，微信服务器会对授权申请地址的参数顺序做强校验(移动端微信应该是没有这个校验的)，文档原文：</p>
<blockquote>
<p>尤其注意：由于授权操作安全等级较高，所以在发起授权请求时，微信会对授权链接做正则强匹配校验，如果链接的参数顺序不对，授权页面将无法正常访问。</p>
</blockquote>
<p>文档说明位置请查看<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html#%E7%9B%AE%E5%BD%95" target="_blank" rel="noopener noreferrer">第一步：用户同意授权</a>，获取code下的正文内容。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">http://192.168.1.102:8080/oauth2/authorize?client_id=messaging-client&amp;response_type=code&amp;scope=message.read&amp;redirect_uri=http://127.0.0.1:8000/login/oauth2/code/messaging-client-oidc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-认证服务检测到未登录重定向至登录页面">2. 认证服 务检测到未登录，重定向至登录页面<a href="#2-认证服务检测到未登录重定向至登录页面" class="hash-link" aria-label="2. 认证服务检测到未登录，重定向至登录页面的直接链接" title="2. 认证服务检测到未登录，重定向至登录页面的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-9-daceecaf1c54609787d4c4c5564567ca.webp" width="1290" height="2796" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-点击微信登录图标由认证服务重定向至微信的授权申请地址微信浏览器弹框申请授权">3. 点击微信登录图标，由认证服务重定向至微信的授权申请地址，微信浏览器弹框申请授权<a href="#3-点击微信登录图标由认证服务重定向至微信的授权申请地址微信浏览器弹框申请授权" class="hash-link" aria-label="3. 点击微信登录图标，由认证服务重定向至微信的授权申请地址，微信浏览器弹框申请授权的直接链接" title="3. 点击微信登录图标，由认证服务重定向至微信的授权申请地址，微信浏览器弹框申请授权的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-10-dc06299b52a9407e7532fdcae42d2fcd.webp" width="1290" height="2796" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-确认授权以后微信引导请求携带code重定向至认证服务认证服务根据code换取access_token再根据access_token和openid获取用户信息获取到用户信息后重定向至认证服务的授权确认页面">4. 确认授权以后微信引导请求携带code重定向至认证服务，认证服务根据code换取access_token，再根据access_token和openid获取用户信息，获取到用户信息后重定向至认证服务的授权确认页面<a href="#4-确认授权以后微信引导请求携带code重定向至认证服务认证服务根据code换取access_token再根据access_token和openid获取用户信息获取到用户信息后重定向至认证服务的授权确认页面" class="hash-link" aria-label="4. 确认授权以后微信引导请求携带code重定向至认证服务，认证服务根据code换取access_token，再根据access_token和openid获取用户信息，获取到用户信息后重定向至认证服务的授权确认页面的直接链接" title="4. 确认授权以后微信引导请求携带code重定向至认证服务，认证服务根据code换取access_token，再根据access_token和openid获取用户信息，获取到用户信息后重定向至认证服务的授权确认页面的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-11-9a93e846389dd5a995b41d2be7845fff.webp" width="1290" height="2796" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-确认授权以后会发现页面没有跳转这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务加载失败了虽然加载失败了但是当前链接已经是回调地址了这时候可以点右上角的三个点选择复制链接然后就能获取code了">5. 确认授权以后会发现页面没有跳转，这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务，加载失败了，虽然加载失败了但是当前链接已经是回调地址了，这时候可以点右上角的三个点，选择复制链接，然后就能获取code了<a href="#5-确认授权以后会发现页面没有跳转这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务加载失败了虽然加载失败了但是当前链接已经是回调地址了这时候可以点右上角的三个点选择复制链接然后就能获取code了" class="hash-link" aria-label="5. 确认授权以后会发现页面没有跳转，这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务，加载失败了，虽然加载失败  了但是当前链接已经是回调地址了，这时候可以点右上角的三个点，选择复制链接，然后就能获取code了的直接链接" title="5. 确认授权以后会发现页面没有跳转，这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务，加载失败了，虽然加载失败了但是当前链接已经是回调地址了，这时候可以点右上角的三个点，选择复制链接，然后就能获取code了的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-12-68599b3074ffcfeeab8a1b1663133438.webp" width="1290" height="2796" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-在postman中根据code获取token">6. 在postman中根据code获取token<a href="#6-在postman中根据code获取token" class="hash-link" aria-label="6. 在postman中根据code获取token的直接链接" title="6. 在postman中根据code获取token的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-13-353a7162a54f133e8106b4e462179845.webp" width="1390" height="693" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-根据token获取当前用户信息">7. 根据token获取当前用户信息<a href="#7-根据token获取当前用户信息" class="hash-link" aria-label="7. 根据token获取当前用户信息的直接链接" title="7. 根据token获取当前用户信息的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-14-154ea4c85bc7ba87ae0dbe7785967477.webp" width="1393" height="791" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-最后附上数据库用户信息截图">8. 最后附上数据库用户信息截图<a href="#8-最后附上数据库用户信息截图" class="hash-link" aria-label="8. 最后附上数据库用户信息截图的直接链接" title="8. 最后附上数据库用户信息截图的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/14-15-eacf853c55452c6aeb631529855b0852.webp" width="1280" height="201" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="六写在最后">六、写在最后<a href="#六写在最后" class="hash-link" aria-label="六、写在最后的直接链接" title="六、写在最后的直接链接">​</a></h2>
<p>虽然这次是用测试号对接的，但是实际上开放平台提供的扫码登录也是这个流程，直接替换<code>appid</code>和<code>app secret</code>为开放平台申请的应该能直接使用；</p>
<p>另外需要注意的是获取<code>access_token</code>时可能会返回<code>unionid</code>，这是在同一个微信开放平台账号下拥有多个移动应用、网站应用和公众账号，获取用户信息后用户信息中的<code>openid</code>可能不同，但是<code>unionid</code>是相同的，可以通过<code>unionid</code>区分用户。所以可以在三方用户表中多加一个字段来存放<code>unionid</code>或者<code>openid</code>。如果有什么问题或者更好的建议可以在下方评论区中提出</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="七附录">七、附录<a href="#七附录" class="hash-link" aria-label="七、附录的直接链接" title="七、附录的直接链接">​</a></h2>
<ul>
<li>微信网页授权登录文档：<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html" target="_blank" rel="noopener noreferrer">地址</a></li>
<li>微信测试号申请地址：<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login" target="_blank" rel="noopener noreferrer">地址</a></li>
<li>Security OAuth2 Client文档地址：<a href="https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html" target="_blank" rel="noopener noreferrer">地址</a></li>
<li>代码地址：<a href="https://gitee.com/vains-Sofia/authorization-example" target="_blank" rel="noopener noreferrer">Gitee</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-authorization-server/14-SAS-Wechat-Login.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/zh-cn/spring-authorization-server/SAS-Github-Gitee-Login/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">SAS-Github-Gitee-Login</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/zh-cn/spring-authorization-server/SAS-Separate-Consent-And-Device-Authorize-Page/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">SAS-Separate-Consent-And-Device-Authorize-Page</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一前言" class="table-of-contents__link toc-highlight">一、前言</a></li><li><a href="#二定制分析" class="table-of-contents__link toc-highlight">二、定制分析</a><ul><li><a href="#1-第一步用户同意授权获取code" class="table-of-contents__link toc-highlight">1. 第一步：用户同意授权获取code</a></li><li><a href="#2-第二步通过code换取网页授权access_token" class="table-of-contents__link toc-highlight">2. 第二步：通过code换取网页授权access_token</a></li><li><a href="#3-第三 步拉取用户信息需scope为-snsapi_userinfo" class="table-of-contents__link toc-highlight">3. 第三步：拉取用户信息(需scope为 snsapi_userinfo)</a></li></ul></li><li><a href="#三编码部分" class="table-of-contents__link toc-highlight">三、编码部分</a><ul><li><a href="#1-编码内容" class="table-of-contents__link toc-highlight">1. 编码内容</a></li><li><a href="#2-在comexampleauthorizationwechat包中添加wechatauthorizationrequestconsumer类" class="table-of-contents__link toc-highlight">2. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatAuthorizationRequestConsumer</code>类</a></li><li><a href="#3-在comexampleauthorizationwechat包中添加wechatcodegrantrequestentityconverter类" class="table-of-contents__link toc-highlight">3. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatCodeGrantRequestEntityConverter</code>类</a></li><li><a href="#4-在comexampleauthorizationwechat包中添加wechatmapaccesstokenresponseconverter类" class="table-of-contents__link toc-highlight">4. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatMapAccessTokenResponseConverter</code>类</a></li><li><a href="#5-在comexampleauthorizationwechat包中添加wechatuserrequestentityconverter类" class="table-of-contents__link toc-highlight">5. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatUserRequestEntityConverter</code>类</a></li><li><a href="#6-在comexampleauthorizationwechat包中添加wechatuserresponseconverter类" class="table-of-contents__link toc-highlight">6. 在<code>com.example.authorization.wechat</code>包中添加<code>WechatUserResponseConverter</code>类</a></li><li><a href="#7-将上边的类添加至配置中使其生效" class="table-of-contents__link toc-highlight">7. 将上边的类添加至配置中，使其生效</a></li><li><a href="#8-用户信息处理策略添加wechatuserconverter类使其解析微信用户信息" class="table-of-contents__link toc-highlight">8. 用户信息处理策略添加<code>WechatUserConverter</code>类，使其解析微信用户信息</a></li><li><a href="#9-yml中添加微信应用配置信息" class="table-of-contents__link toc-highlight">9. yml中添加微信应用配置信息</a></li><li><a href="#10-登录页面添加微信登录入口" class="table-of-contents__link toc-highlight">10. 登录页面添加微信登录入口</a></li><li><a href="#11补充" class="table-of-contents__link toc-highlight">11.补充</a></li></ul></li><li><a href="#四微信测试号配置简要说明" class="table-of-contents__link toc-highlight">四、微信测试号配置简要说明</a></li><li><a href="#五测试" class="table-of-contents__link toc-highlight">五、测试</a><ul><li><a href="#1-微信内打开授权申请地址" class="table-of-contents__link toc-highlight">1. 微信内打开授权申请地址</a></li><li><a href="#2-认证服务检测到未登录重定向至登录页面" class="table-of-contents__link toc-highlight">2. 认证服务检测到未登录，重定向至登录页面</a></li><li><a href="#3-点击微信登录图标由认证服务重定向至微信的授权申请地址微信浏览器弹框申请授权" class="table-of-contents__link toc-highlight">3. 点击微信登录图标，由认证服务重定向至微信的授权申请地址，微信浏览器弹框申请授权</a></li><li><a href="#4-确认授权以后微信引导请求携带code重定向至认证服务认证服务根据code换取access_token再根据access_token和openid获取用户信息获取到用户信息后重定向至认证服务的授权确认页面" class="table-of-contents__link toc-highlight">4. 确认授权以后微信引导请求携带code重定向至认证服务，认证服务根据code换取access_token，再根据access_token和openid获取用户信息，获取到用户信息后重定向至认证服务的授权确认页面</a></li><li><a href="#5-确认授权以后会发现页面没有跳转这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务加载失败了虽然加载失败了但是当前链接已经是回调地址了这时候可以点右上角的三个点选择复制链接然后就能获取code了" class="table-of-contents__link toc-highlight">5. 确认授权以后会发现页面没有跳转，这是因为请求认证服务的授权申请地址携带的redirect_uri是一个不可用的服务，加载失败了，虽然加载失败了但是当前链接已经是回调地址了，这时候可以点右上角的三个点，选择复制链接，然后就能获取code了</a></li><li><a href="#6-在postman中根据code获取token" class="table-of-contents__link toc-highlight">6. 在postman中根据code获取token</a></li><li><a href="#7-根据token获取当前用户信息" class="table-of-contents__link toc-highlight">7. 根据token获取当前用户信息</a></li><li><a href="#8-最后附上数据库用户信息截图" class="table-of-contents__link toc-highlight">8. 最后附上数据库用户信息截图</a></li></ul></li><li><a href="#六写在最后" class="table-of-contents__link toc-highlight">六、写在最后</a></li><li><a href="#七附录" class="table-of-contents__link toc-highlight">七、附录</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>