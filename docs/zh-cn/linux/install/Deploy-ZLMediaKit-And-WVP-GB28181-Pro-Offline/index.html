<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/docs/zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline | Light Docusaurus"><meta data-rh="true" name="description" content="一、相关链接"><meta data-rh="true" property="og:description" content="一、相关链接"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/docs/zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e8086d6f.css">
<script src="/assets/js/runtime~main.2519630d.js" defer="defer"></script>
<script src="/assets/js/main.a410c441.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a class="navbar__item navbar__link" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/active-directory/">Active Directory</a><button aria-label="展开侧边栏分类 &#x27;Active Directory&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/linux/">Linux</a><button aria-label="折叠侧边栏分类 &#x27;Linux&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/common/">Common</a><button aria-label="展开侧边栏分类 &#x27;Common&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/category/install/">Install</a><button aria-label="折叠侧边栏分类 &#x27;Install&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-JDK/">Install-JDK</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-NodeJS/">Install-NodeJS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Maven/">Install-Maven</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Gitea/">Install-Gitea</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Nexus3/">Install-Nexus3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Jenkins/">Install-Jenkins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Harbor/">Install-Harbor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Docker-Registry/">Install-Docker-Registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Ftp/">Install-Ftp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Zim/">Install-Zim</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-Zsh/">Install-Zsh</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/linux/install/Install-EMQX-Offline-In-CentOS8/">Install-EMQX-Offline-In-CentOS8</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/zh-cn/linux/install/Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline/">Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/awesome-open-source/">Github Speed UP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux/"><span itemprop="name">Linux</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/install/"><span itemprop="name">Install</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一相关链接">一、相关链接<a href="#一相关链接" class="hash-link" aria-label="一、相关链接的直接链接" title="一、相关链接的直接链接">​</a></h2>
<ul>
<li>
<p><a href="https://github.com/ZLMediaKit/ZLMediaKit.git" target="_blank" rel="noopener noreferrer">ZLMediaKit Github</a></p>
</li>
<li>
<p><a href="https://docs.zlmediakit.com" target="_blank" rel="noopener noreferrer">ZLMediaKit Docs</a></p>
</li>
<li>
<p><a href="https://github.com/648540858/wvp-GB28181-pro" target="_blank" rel="noopener noreferrer">Wvp-Pro Github</a></p>
</li>
<li>
<p><a href="https://doc.wvp-pro.cn" target="_blank" rel="noopener noreferrer">Wvp-Pro Docs</a></p>
</li>
<li>
<p><a href="https://pkgs.org/search" target="_blank" rel="noopener noreferrer">Linux依赖搜索</a></p>
</li>
<li>
<p><a href="https://www.nasm.us/pub/nasm/releasebuilds/2.14.02/" target="_blank" rel="noopener noreferrer">Nasm下载</a></p>
</li>
<li>
<p><a href="https://www.tortall.net/projects/yasm/releases/" target="_blank" rel="noopener noreferrer">Yasm下载</a></p>
</li>
<li>
<p><a href="https://www.videolan.org/developers/x264.html" target="_blank" rel="noopener noreferrer">X264下载</a></p>
</li>
<li>
<p><a href="https://ffmpeg.org/releases/" target="_blank" rel="noopener noreferrer">FFmpeg下载</a></p>
</li>
<li>
<p><a href="https://www.cpan.org/src/" target="_blank" rel="noopener noreferrer">Perl下载</a></p>
</li>
<li>
<p><a href="https://openssl-library.org/source/old/index.html" target="_blank" rel="noopener noreferrer">OpenSSL下载</a></p>
</li>
<li>
<p><a href="https://github.com/cisco/libsrtp/releases" target="_blank" rel="noopener noreferrer">libsrtp  下载</a></p>
</li>
<li>
<p><a href="http://mp4v2.org/" target="_blank" rel="noopener noreferrer">libmp4v2下载</a></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二环境介绍">二、环境介绍<a href="#二环境介绍" class="hash-link" aria-label="二、环境介绍的直接链接" title="二、环境介绍的直接链接">​</a></h2>
<p>编译机器：</p>
<ul>
<li>centos 8.6</li>
<li>gcc version 8.5.0 (GCC)</li>
<li>cmake version 3.20.2</li>
</ul>
<table><thead><tr><th>名称</th><th>版本</th><th>备注</th></tr></thead><tbody><tr><td>CentOS</td><td>8.5.2111</td><td></td></tr><tr><td>ZLMediaKit</td><td>7.0</td><td></td></tr><tr><td>WVP-Pro</td><td>2.7.2</td><td></td></tr><tr><td>gcc</td><td>8.5.0</td><td></td></tr><tr><td>g++</td><td>8.5.0</td><td></td></tr><tr><td>cmake</td><td>3.20.2</td><td></td></tr><tr><td>nasm</td><td>2.14.02</td><td></td></tr><tr><td>yasm</td><td>1.3.0</td><td></td></tr><tr><td>x264</td><td>0.165.x</td><td></td></tr><tr><td>libmp4v2</td><td></td><td></td></tr><tr><td>faac</td><td>1.29.9.2</td><td></td></tr><tr><td>perl</td><td>v5.32.1</td><td></td></tr><tr><td>openssl</td><td>1.1.1w</td><td></td></tr><tr><td>libsrtp</td><td>2.5.0</td><td></td></tr><tr><td>FFmpeg</td><td>7.1.1</td><td></td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三准备工作">三、准备工作<a href="#三准备工作" class="hash-link" aria-label="三、准备工作的直接链接" title="三、准备工作的直接链接">​</a></h2>
<p>本文档所有操作在一台与内网服务器同版本的虚拟机上执行，在内网机器部署时，只需要执行标题包含【离线】字样的内容</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-系统安装">3.1 系统安装<a href="#31-系统安装" class="hash-link" aria-label="3.1 系统安装的直接链接" title="3.1 系统安装的直接链接">​</a></h3>
<p>系统安装与CentOS7之前有较大区别，可以参考<a href="https://blog.csdn.net/wusam/article/details/142619996" target="_blank" rel="noopener noreferrer">这篇文章</a>
重点是在<code>安装信息摘要</code>页面，按照以下顺序设置</p>
<ol>
<li>Root用户密码</li>
<li>网络和主机名 此处的MAC地址需要和虚拟机<code>设置</code>-<code>网络</code>页面的MAC地址一致</li>
<li>安装目的地</li>
<li>安装源       <code>http://mirrors.aliyun.com/centos/8/BaseOS/x86_64/os/</code></li>
<li>软件选择     最小安装(yum ssh curl ping ip)</li>
<li>时间和日期   将时区改为 Asia/Shanghai</li>
</ol>
<p><img decoding="async" loading="lazy" alt="安装配置顺序" src="/assets/images/安装配置顺序-eb97d844fd5877d1143eeb90da846994.png" width="1005" height="733" class="img_ev3q">
<img decoding="async" loading="lazy" alt="配置安装源" src="/assets/images/配置安装源-d355f0f2a9c495cf3983acf601a996be.png" width="1005" height="733" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-设置静态ip">3.2 设置静态IP<a href="#32-设置静态ip" class="hash-link" aria-label="3.2 设置静态IP的直接链接" title="3.2 设置静态IP的直接链接">​</a></h3>
<p>如果要设置固定IP，可以修改网络配置文件，手动设置IP、MAC地址、网关、子网掩码、DNS等信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看网络配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改网络配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vi /etc/sysconfig/network-scripts/ifcfg-enp0s3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BOOTPROTO=static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPADDR=192.168.137.101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># MACADDR=08:00:27:D7:88:87</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HWADDR=08:00:27:D7:88:87</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GATEWAY=192.168.137.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NETMASK=255.255.255.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DNS1=114.114.114.114</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启网络服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart NetworkManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试与宿主机 公网的网络互通</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ping -c4 192.168.137.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ping -c4 jd.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-修改yum源">3.3 修改yum源<a href="#33-修改yum源" class="hash-link" aria-label="3.3 修改yum源的直接链接" title="3.3 修改yum源的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Errors during downloading metadata for repository &#x27;appstream&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Curl error (6): Couldn&#x27;t resolve host name for http://mirrorlist.centos.org/?release=8&amp;arch=x86_64&amp;repo=AppStream&amp;infra=stock [Could not resolve host: mirrorlist.centos.org]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">错误：为仓库 &#x27;appstream&#x27; 下载元数据失败 : Cannot prepare internal mirrorlist: Curl error (6): Couldn&#x27;t resolve host name for http://mirrorlist.centos.org/?release=8&amp;arch=x86_64&amp;repo=AppStream&amp;infra=stock [Could not resolve host: mirrorlist.centos.org]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于 CentOS 团队已于 2021 年 12 月 31 日对 CentOS Linux 8 停止更新和维护，并从官方镜像中移除 CentOS 8 的所有包，因此导致在使用 yum 源安装或更新会报上述错误，解决方案可参考<a href="https://blog.csdn.net/huchaoyang123/article/details/144608111" target="_blank" rel="noopener noreferrer">这篇文章</a>，下面直接用阿里云软件源替换</p>
<ol>
<li>备份软件源</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 进入仓库源文件目录下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /etc/yum.repos.d/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 备份</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-AppStream.repo             /etc/yum.repos.d/CentOS-Linux-AppStream.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-BaseOS.repo                /etc/yum.repos.d/CentOS-Linux-BaseOS.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-ContinuousRelease.repo     /etc/yum.repos.d/CentOS-Linux-ContinuousRelease.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-Debuginfo.repo             /etc/yum.repos.d/CentOS-Linux-Debuginfo.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-Devel.repo                 /etc/yum.repos.d/CentOS-Linux-Devel.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-Extras.repo                /etc/yum.repos.d/CentOS-Linux-Extras.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-FastTrack.repo             /etc/yum.repos.d/CentOS-Linux-FastTrack.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-HighAvailability.repo      /etc/yum.repos.d/CentOS-Linux-HighAvailability.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-Media.repo                 /etc/yum.repos.d/CentOS-Linux-Media.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-Plus.repo                  /etc/yum.repos.d/CentOS-Linux-Plus.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-PowerTools.repo            /etc/yum.repos.d/CentOS-Linux-PowerTools.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/yum.repos.d/CentOS-Linux-Sources.repo               /etc/yum.repos.d/CentOS-Linux-Sources.repo.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>使用阿里云软件源</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 如果没有wget，可以用curl下载 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># wget http://mirrors.aliyun.com/repo/Centos-8.repo -O /etc/yum.repos.d/CentOS-Linux-BaseOS.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl http://mirrors.aliyun.com/repo/Centos-8.repo -o /etc/yum.repos.d/CentOS-Linux-BaseOS.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>安装epel源、rpmfusion源</li>
</ol>
<ul>
<li><a href="https://developer.aliyun.com/mirror/epel" target="_blank" rel="noopener noreferrer">阿里云epel源</a></li>
<li><a href="https://developer.aliyun.com/mirror/rpmfusion" target="_blank" rel="noopener noreferrer">阿里云rpmfusion源</a></li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 下载阿里云epel源、rpmfusion源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/{epel,rpmfusion}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://mirrors.aliyun.com/epel/epel-release-latest-8.noarch.rpm -o /root/lib/epel/epel-release-latest-8.noarch.rpm </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://mirrors.aliyun.com/rpmfusion/free/el/rpmfusion-free-release-8.noarch.rpm -o /root/lib/rpmfusion/rpmfusion-free-release-8.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://mirrors.aliyun.com/rpmfusion/nonfree/el/rpmfusion-nonfree-release-8.noarch.rpm -o /root/lib/rpmfusion/rpmfusion-nonfree-release-8.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/epel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/rpmfusion/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /etc/yum.repos.d/epel*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /etc/yum.repos.d/rpmfusion*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf repolist epel -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf repolist rpmfusion -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>更新软件源</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 清空原有缓存并重新生成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum clean all &amp;&amp; yum makecache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新软件包（可选）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum update -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-创建操作用户">3.4 创建操作用户<a href="#34-创建操作用户" class="hash-link" aria-label="3.4 创建操作用户的直接链接" title="3.4 创建操作用户的直接链接">​</a></h3>
<p>如果没有专门的操作用户，可以按下面的操作创建新的用户，后续操作均使用此新用户来执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 创建用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd -m diginn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 设置密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo passwd diginn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 赋予root权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo visudo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 添加如下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">diginn   ALL=(ALL)   ALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 测试权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">su - diginn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 显示 root 即表示diginn用户有 sudo 权限</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-安装基础依赖">3.5 安装基础依赖<a href="#35-安装基础依赖" class="hash-link" aria-label="3.5 安装基础依赖的直接链接" title="3.5 安装基础依赖的直接链接">​</a></h3>
<p>由于离线安装时无法在线安装依赖包，故需要提前准备好相关的依赖包，如何查询并安装依赖包可以参考<a href="https://www.cnblogs.com/zw-loser/p/17251908.html" target="_blank" rel="noopener noreferrer">这篇文章</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="351-在线在线下载和安装">3.5.1 【在线】在线下载和安装<a href="#351-在线在线下载和安装" class="hash-link" aria-label="3.5.1 【在线】在线下载和安装的直接链接" title="3.5.1 【在线】在线下载和安装的直接链接">​</a></h4>
<ol>
<li>安装依赖</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载 yum-utils https://mirrors.aliyun.com/centos/8.5.2111/BaseOS/x86_64/os/Packages/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/yum-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://mirrors.aliyun.com/centos/8.5.2111/BaseOS/x86_64/os/Packages/yum-utils-4.0.21-3.el8.noarch.rpm -o /root/lib/yum-utils/yum-utils-4.0.21-3.el8.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装 yum-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/yum-utils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 下载RPM包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/{tar,bzip2,unzip,vim,wget,net-tools,yum-utils}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># yumdownloader --arch=x86_64 --resolve --destdir=/root/lib/tar tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/tar tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/bzip2 bzip2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/unzip unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/vim vim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/wget wget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/net-tools net-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/yum-utils yum-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 安装RPM包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/tar/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/bzip2/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/unzip/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/vim/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/wget/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/net-tools/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/yum-utils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>--resolve</code> 下载依赖包</li>
<li><code>--arch</code> 指定平台架构 <code>x86_64</code> <code>aarch64</code></li>
<li><code>--releasever</code>指定系统版本 <code>CentOS7</code> 的 <code>7</code> 或 <code>CentOS8</code> 的 <code>8</code></li>
<li><code>--destdir</code> 指定保存路径</li>
</ul>
<ol start="2">
<li>查看提供某个命令/value的rpm包</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum provides unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>查看 rpm 包所需的全部依赖</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum deplist unzip-6.0-45.el8_4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="352-离线离线安装">3.5.2 【离线】离线安装<a href="#352-离线离线安装" class="hash-link" aria-label="3.5.2 【离线】离线安装的直接链接" title="3.5.2 【离线】离线安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 安装解压工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh tar-1.30-5.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 解压离线安装包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf lib.tar.gz            # RPM依赖包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf resource.tar.gz       # 源码安装包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf ZLMediaKit.tar.gz     # ZLMediaKit源码包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 安装基础依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/tar/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/bzip2/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/unzip/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/vim/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/wget/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/net-tools/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/yum-utils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四安装编译依赖">四、安装编译依赖<a href="#四安装编译依赖" class="hash-link" aria-label="四、安装编译依赖的直接链接" title="四、安装编译依赖的直接链接">​</a></h2>
<p>按照<a href="https://github.com/ZLMediaKit/ZLMediaKit/wiki/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" target="_blank" rel="noopener noreferrer">快速开始</a>和<a href="https://github.com/ZLMediaKit/ZLMediaKit/wiki/zlm%E5%90%AF%E7%94%A8webrtc%E7%BC%96%E8%AF%91%E6%8C%87%E5%8D%97" target="_blank" rel="noopener noreferrer">zlm启用webrtc编译指南</a>来准备编译环境</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-开发工具包依赖安装">4.1 开发工具包依赖安装<a href="#41-开发工具包依赖安装" class="hash-link" aria-label="4.1 开发工具包依赖安装的直接链接" title="4.1 开发工具包依赖安装的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="411-在线在线下载和安装">4.1.1 【在线】在线下载和安装<a href="#411-在线在线下载和安装" class="hash-link" aria-label="4.1.1 【在线】在线下载和安装的直接链接" title="4.1.1 【在线】在线下载和安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 查看开发工具包所包含的依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf group info &quot;Development Tools&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf group install &quot;Development Tools&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf group remove &quot;Development Tools&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf install perl-IPC-Cmd  perl-Pod-Html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 下载安装包及依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/autoconf autoconf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/automake automake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/binutils binutils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/bison bison</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/flex flex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/gcc gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/gcc-c++ gcc-c++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/gdb gdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/glibc-devel glibc-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/libtool libtool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/make make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/pkgconf pkgconf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/pkgconf-m4 pkgconf-m4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/pkgconf-pkg-config pkgconf-pkg-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/redhat-rpm-config redhat-rpm-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/rpm-build rpm-build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/rpm-sign rpm-sign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/strace strace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/asciidoc asciidoc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/byacc byacc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/ctags ctags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/diffstat diffstat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/elfutils-libelf-devel elfutils-libelf-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/git git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/intltool intltool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/jna jna</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/ltrace ltrace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/patchutils patchutils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/perl-Fedora-VSP perl-Fedora-VSP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/perl-Sys-Syslog perl-Sys-Syslog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/perl-generators perl-generators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/pesign pesign</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/source-highlight source-highlight</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/systemtap systemtap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/valgrind valgrind</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/valgrind-devel valgrind-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/cmake cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/expect expect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/rpmdevtools rpmdevtools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/development/rpmlint rpmlint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/perl-ipc perl-IPC-Cmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/perl-pod perl-Pod-Html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/autoconf/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/automake/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/binutils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/bison/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/flex/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/gcc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/gcc-c++/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/gdb/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/glibc-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/libtool/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/make/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pkgconf/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pkgconf-m4/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pkgconf-pkg-config/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/redhat-rpm-config/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpm-build/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpm-sign/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/strace/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/asciidoc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/byacc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/ctags/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/diffstat/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/elfutils-libelf-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/git/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/intltool/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/jna/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/ltrace/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/patchutils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/perl-Fedora-VSP/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/perl-Sys-Syslog/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/perl-generators/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pesign/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/source-highlight/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/systemtap/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/valgrind/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/valgrind-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/cmake/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/expect/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpmdevtools/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpmlint/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/perl-ipc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/perl-pod/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="412-离线离线安装">4.1.2 【离线】离线安装<a href="#412-离线离线安装" class="hash-link" aria-label="4.1.2 【离线】离线安装的直接链接" title="4.1.2 【离线】离线安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 由于上面步骤已解压离线安装包，这里直接安装即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 安装开发工具包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/autoconf/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/automake/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/binutils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/bison/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/flex/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/gcc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/gcc-c++/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/gdb/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/glibc-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/libtool/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/make/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pkgconf/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pkgconf-m4/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pkgconf-pkg-config/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/redhat-rpm-config/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpm-build/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpm-sign/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/strace/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/asciidoc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/byacc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/ctags/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/diffstat/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/elfutils-libelf-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/git/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/intltool/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/jna/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/ltrace/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/patchutils/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/perl-Fedora-VSP/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/perl-Sys-Syslog/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/perl-generators/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/pesign/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/source-highlight/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/systemtap/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/valgrind/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/valgrind-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/cmake/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/expect/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpmdevtools/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/development/rpmlint/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/perl-ipc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/perl-pod/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-安装基础依赖-gcc-gcc-c-cmake">4.2 安装基础依赖 gcc gcc-c++ cmake<a href="#42-安装基础依赖-gcc-gcc-c-cmake" class="hash-link" aria-label="4.2 安装基础依赖 gcc gcc-c++ cmake的直接链接" title="4.2 安装基础依赖 gcc gcc-c++ cmake的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="421-在线在线下载和安装">4.2.1 【在线】在线下载和安装<a href="#421-在线在线下载和安装" class="hash-link" aria-label="4.2.1 【在线】在线下载和安装的直接链接" title="4.2.1 【在线】在线下载和安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在线安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># yum -y install gcc gcc-c++ cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载安装包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/{gcc,gcc-c++,cmake}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/gcc gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/gcc-c++ gcc-c++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/cmake cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc/*rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc-c++/*rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/cmake/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># yum localinstall *.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g++ --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果g++找不到命令，手动安装，缺少g++编译ZLMediaKit会报错：No CMAKE_CXX_COMPILER could be found.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc-c++/libstdc++-devel-8.5.0-4.el8_5.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc-c++/gcc-c++-8.5.0-4.el8_5.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="422-离线离线安装">4.2.2 【离线】离线安装<a href="#422-离线离线安装" class="hash-link" aria-label="4.2.2 【离线】离线安装的直接链接" title="4.2.2 【离线】离线安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc/*rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc-c++/*rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/cmake/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g++ --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 如果g++找不到命令，手动安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 缺少g++编译ZLMediaKit会报错：No CMAKE_CXX_COMPILER could be found.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc-c++/libstdc++-devel-8.5.0-4.el8_5.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/gcc-c++/gcc-c++-8.5.0-4.el8_5.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-安装-nasm-yasm">4.3 安装 Nasm Yasm<a href="#43-安装-nasm-yasm" class="hash-link" aria-label="4.3 安装 Nasm Yasm的直接链接" title="4.3 安装 Nasm Yasm的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="431-在线在线下载和安装">4.3.1 【在线】在线下载和安装<a href="#431-在线在线下载和安装" class="hash-link" aria-label="4.3.1 【在线】在线下载和安装的直接链接" title="4.3.1 【在线】在线下载和安装的直接链接">​</a></h4>
<ol>
<li>安装Nasm</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://www.nasm.us/pub/nasm/releasebuilds/2.14.02/nasm-2.14.02.tar.bz2 -O /root/resource/nasm-2.14.02.tar.bz2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -jxvf nasm-2.14.02.tar.bz2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nasm-2.14.02/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/nasm/bin/nasm -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>安装Yasm</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz -O /root/resource/yasm-1.3.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf yasm-1.3.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd yasm-1.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/yasm/bin/yasm --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="432-离线离线安装">4.3.2 【离线】离线安装<a href="#432-离线离线安装" class="hash-link" aria-label="4.3.2 【离线】离线安装的直接链接" title="4.3.2 【离线】离线安装的直接链接">​</a></h4>
<ol>
<li>安装Nasm</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -jxvf nasm-2.14.02.tar.bz2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nasm-2.14.02/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/nasm/bin/nasm -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>安装Yasm</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf yasm-1.3.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd yasm-1.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/yasm/bin/yasm --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="433-设置环境变量">4.3.3 设置环境变量<a href="#433-设置环境变量" class="hash-link" aria-label="4.3.3 设置环境变量的直接链接" title="4.3.3 设置环境变量的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 设置环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASM_HOME=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YASM_HOME=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=$PATH:$NASM_HOME/bin:$YASM_HOME/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NASM_HOME YASM_HOME PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nasm --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yasm --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-安装-x264-libmp4v2-faac">4.4 安装 x264 libmp4v2 faac<a href="#44-安装-x264-libmp4v2-faac" class="hash-link" aria-label="4.4 安装 x264 libmp4v2 faac的直接链接" title="4.4 安装 x264 libmp4v2 faac的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="441-在线在线下载和安装">4.4.1 【在线】在线下载和安装<a href="#441-在线在线下载和安装" class="hash-link" aria-label="4.4.1 【在线】在线下载和安装的直接链接" title="4.4.1 【在线】在线下载和安装的直接链接">​</a></h4>
<ol>
<li>安装x264</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://code.videolan.org/videolan/x264/-/archive/master/x264-master.tar.bz2 -O /root/resource/x264-master.tar.bz2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -jxvf x264-master.tar.bz2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd x264-master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/x264 --enable-shared --enable-static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/x264/bin/x264 --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 配置动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/ld.so.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/x264/lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. 配置 pkgconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ERROR: x264 not found using pkg-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># pkg-config会搜索指定路径下的.pc文件，所以将.pc文件移动到指定目录下即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /usr/local/x264/lib/pkgconfig/x264.pc /usr/share/pkgconfig/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>设置环境变量</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 设置环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASM_HOME=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YASM_HOME=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X264_HOME=/usr/local/x264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=$PATH:$NASM_HOME/bin:$YASM_HOME/bin:$X264_HOME/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NASM_HOME YASM_HOME X264_HOME PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x264 --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>安装libmp4v2、faac</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/{libmp4v2,faac}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/libmp4v2 libmp4v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/libmp4v2 libmp4v2-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/faac faac</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/faac faac-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/libmp4v2/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/faac/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="442-离线离线安装">4.4.2   【离线】离线安装<a href="#442-离线离线安装" class="hash-link" aria-label="4.4.2 【离线】离线安装的直接链接" title="4.4.2 【离线】离线安装的直接链接">​</a></h4>
<ol>
<li>安装x264</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -jxvf x264-master.tar.bz2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd x264-master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/x264 --enable-shared --enable-static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/x264/bin/x264 --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 配置动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/ld.so.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/x264/lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. 配置 pkgconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ERROR: x264 not found using pkg-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># pkg-config会搜索指定路径下的.pc文件，所以将.pc文件移动到指定目录下即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /usr/local/x264/lib/pkgconfig/x264.pc /usr/share/pkgconfig/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>设置环境变量</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 设置环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASM_HOME=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YASM_HOME=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X264_HOME=/usr/local/x264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=$PATH:$NASM_HOME/bin:$YASM_HOME/bin:$X264_HOME/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NASM_HOME YASM_HOME X264_HOME PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x264 --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>安装libmp4v2、faac</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/libmp4v2/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/faac/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="45-编译安装opensslperl-zlib">4.5 编译安装Openssl(perl zlib)<a href="#45-编译安装opensslperl-zlib" class="hash-link" aria-label="4.5 编译安装Openssl(perl zlib)的直接链接" title="4.5 编译安装Openssl(perl zlib)的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="451-目前-centos-852111-自带的openssl版本为-111k满足zlmediakit的要求-110不建议安装升级高版本的openssl可能会导致一些意外的错误例如-openssl-yum-openssh-不可用等">4.5.1 目前 CentOS 8.5.2111 自带的Openssl版本为 1.1.1k，满足ZLMediaKit的要求（&gt; 1.1.0），不建议安装升级高版本的OpenSSL，可能会导致一些意外的错误，例如 openssl yum openssh 不可用等<a href="#451-目前-centos-852111-自带的openssl版本为-111k满足zlmediakit的要求-110不建议安装升级高版本的openssl可能会导致一些意外的错误例如-openssl-yum-openssh-不可用等" class="hash-link" aria-label="4.5.1 目前 CentOS 8.5.2111 自带的Openssl版本为 1.1.1k，满足ZLMediaKit的要求（&gt; 1.1.0），不建议安装升级高版本的OpenSSL，可能会导致一些意外的错误，例如 openssl yum openssh 不可用等的直接链接" title="4.5.1 目前 CentOS 8.5.2111 自带的Openssl版本为 1.1.1k，满足ZLMediaKit的要求（&gt; 1.1.0），不建议安装升级高版本的OpenSSL，可能会导致一些意外的错误，例如 openssl yum openssh 不可用等的直接链接">​</a></h4>
<ul>
<li><a href="https://blog.csdn.net/quantum7/article/details/104086731" target="_blank" rel="noopener noreferrer">LINUX下载编译OpenSSL</a></li>
<li><a href="https://blog.csdn.net/quantum7/article/details/104807212" target="_blank" rel="noopener noreferrer">LINUX下载编译libsrtp-2.3.0</a></li>
<li><a href="https://blog.csdn.net/qq_39187750/article/details/123569704" target="_blank" rel="noopener noreferrer">linux openssl 升级</a></li>
<li><a href="https://blog.csdn.net/hzcm1984/article/details/115958795" target="_blank" rel="noopener noreferrer">OepnSSL报错处理</a></li>
<li><a href="https://blog.csdn.net/yiyihuazi/article/details/116000480" target="_blank" rel="noopener noreferrer">centos8 OpenSSL升级版本到最新</a></li>
<li><a href="https://cn.linux-console.net/?p=31592" target="_blank" rel="noopener noreferrer">在 Rocky/AlmaLinux/CentOS/RHEL 8 上安装 OpenSSL 3.x</a></li>
</ul>
<p><strong>经测试，安装openssl 3.0.12 不替换默认的 openssl 1.1 ，在后续也会报错</strong></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="452-在线rpm安装rpm安装-openssl">4.5.2 【在线】【RPM安装】RPM安装 OpenSSL<a href="#452-在线rpm安装rpm安装-openssl" class="hash-link" aria-label="4.5.2 【在线】【RPM安装】RPM安装 OpenSSL的直接链接" title="4.5.2 【在线】【RPM安装】RPM安装 OpenSSL的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载YUM仓库的Openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/{openssl,openssl11,libsdl}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/openssl openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/openssl-devel openssl-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/openssl11 openssl11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/openssl11-devel openssl11-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/libsdl SDL-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/openssl/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/openssl-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/openssl11/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/openssl11-devel/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf install -y /root/lib/libsdl/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="453-在线手动编译在线下载和安装">4.5.3 【在线】【手动编译】在线下载和安装<a href="#453-在线手动编译在线下载和安装" class="hash-link" aria-label="4.5.3 【在线】【手动编译】在线下载和安装的直接链接" title="4.5.3 【在线】【手动编译】在线下载和安装的直接链接">​</a></h4>
<ol>
<li>安装zlib（编译openssl需要）</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/lib/zlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/zlib zlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnf download --archlist=x86_64,noarch --resolve --destdir=/root/lib/zlib zlib-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/zlib/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果openssl编译报错，单独安装 zlib zlib-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/zlib/zlib-1.2.11-17.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/zlib/zlib-devel-1.2.11-17.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>手动编译 perl5 (编译openssl需要)</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://www.cpan.org/src/5.0/perl-5.32.1.tar.gz      -O /root/resource/perl-5.32.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf perl-5.32.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd perl-5.32.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./Configure -des -Dprefix=/usr/local/perl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下面两个命令是由这两条安装的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf install -y /root/lib/perl-ipc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf install -y /root/lib/perl-pod/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod2man --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod2html --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>手动编译 openssl (openssl版本要求1.1.0以上)</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://www.openssl.org/source/openssl-3.0.16.tar.gz -O /root/resource/openssl-3.0.16.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvzf openssl-3.0.16.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd openssl-3.0.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./config shared zlib --openssldir=/usr/local/openssl --prefix=/usr/local/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make depend &amp;&amp; make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 配置和更新动态链接器运行时绑定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/openssl/bin/openssl version -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="454-离线手动编译离线安装">4.5.4 【离线】【手动编译】离线安装<a href="#454-离线手动编译离线安装" class="hash-link" aria-label="4.5.4 【离线】【手动编译】离线安装的直接链接" title="4.5.4 【离线】【手动编译】离线安装的直接链接">​</a></h4>
<ol>
<li>安装zlib（编译openssl需要）</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/zlib/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果openssl编译报错，单独安装 zlib zlib-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/zlib/zlib-1.2.11-17.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh /root/lib/zlib/zlib-devel-1.2.11-17.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>手动编译 perl5 (编译openssl需要)</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf perl-5.32.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd perl-5.32.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./Configure -des -Dprefix=/usr/local/perl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perl --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下面两个命令是由这两条安装的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf install -y /root/lib/perl-ipc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># dnf install -y /root/lib/perl-pod/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod2man --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pod2html --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>手动编译 openssl (openssl版本要求1.1.0以上)</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvzf openssl-3.0.16.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd openssl-3.0.16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./config shared zlib --openssldir=/usr/local/openssl --prefix=/usr/local/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make depend &amp;&amp; make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 配置和更新动态链接器运行时绑定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/openssl/bin/openssl version -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="455-配置动态链接库和环境变量">4.5.5 配置动态链接库和环境变量<a href="#455-配置动态链接库和环境变量" class="hash-link" aria-label="4.5.5 配置动态链接库和环境变量的直接链接" title="4.5.5 配置动态链接库和环境变量的直接链接">​</a></h4>
<ol>
<li>配置动态链接库</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/ld.so.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/lib64/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/openssl/lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/openssl/lib64/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>设置环境变量</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 设置环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASM_HOME=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YASM_HOME=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X264_HOME=/usr/local/x264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OPENSSL_HOME=/usr/local/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=$PATH:$NASM_HOME/bin:$YASM_HOME/bin:$X264_HOME/bin:$OPENSSL_HOME/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NASM_HOME YASM_HOME X264_HOME OPENSSL_HOME PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl version -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>替换原Openssl</li>
</ol>
<p><strong>redhat8自己开发了一套函数，会打包在自己的libopenssl rpm包里，有些redhat提供的应用使用到这些函数；
在official的openssl源代码里没有这些函数；
所以如果是用redhat提供的openssl 最好不要自己build openssl</strong></p>
<p><strong>替换会导致部分依赖openssl的程序不可用，例如yum openssh等</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 备份原openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/bin/openssl     /usr/bin/openssl_bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/include/openssl /usr/include/openssl_bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/lib64/openssl   /usr/lib64/openssl_bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /usr/lib64/libssl.so /usr/lib64/libssl.so_bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建软链接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/bin/openssl           /usr/bin/openssl # 替换系统openssl，非必须</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/include/openssl       /usr/include/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/lib/libssl.so         /usr/lib64/libssl.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/lib/libssl.so.1.1     /usr/lib64/libssl.so.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/lib/libcrypto.so      /usr/lib64/libcrypto.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/lib/libcrypto.so.1.1  /usr/lib64/libcrypto.so.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rm -rf /usr/lib64/libcrypto.so.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ln -sf /usr/local/openssl/lib64/libcrypto.so.3  /usr/lib64/libcrypto.so.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /usr/lib64/libssl*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /usr/lib64/libcrypt*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@centos openssl-1.1.1w]# ll /usr/lib64/libssl*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx. 1 root root     16 12月  3 2021 /usr/lib64/libssl.so.1.1 -&gt; libssl.so.1.1.1k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rwxr-xr-x. 1 root root 615704 12月  3 2021 /usr/lib64/libssl.so.1.1.1k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[root@centos openssl-1.1.1w]# ll /usr/lib64/libcrypt*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx. 1 root root      19 12月  3 2021 /usr/lib64/libcrypto.so.1.1 -&gt; libcrypto.so.1.1.1k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rwxr-xr-x. 1 root root 3079664 12月  3 2021 /usr/lib64/libcrypto.so.1.1.1k</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx. 1 root root      23 2月  19 2021 /usr/lib64/libcryptsetup.so.12 -&gt; libcryptsetup.so.12.6.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rwxr-xr-x. 1 root root  510096 2月  19 2021 /usr/lib64/libcryptsetup.so.12.6.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx. 1 root root      17 5月   6 2021 /usr/lib64/libcrypt.so -&gt; libcrypt.so.1.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx. 1 root root      17 5月   6 2021 /usr/lib64/libcrypt.so.1 -&gt; libcrypt.so.1.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rwxr-xr-x. 1 root root  136040 5月   6 2021 /usr/lib64/libcrypt.so.1.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl version -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="46-安装-libsrtp-ffmpeg">4.6 安装 libsrtp FFmpeg<a href="#46-安装-libsrtp-ffmpeg" class="hash-link" aria-label="4.6 安装 libsrtp FFmpeg的直接链接" title="4.6 安装 libsrtp FFmpeg的直接链接">​</a></h3>
<ul>
<li><a href="https://blog.csdn.net/weixin_42899203/article/details/115201520" target="_blank" rel="noopener noreferrer">CentOS7离线部署ZLMediaKit</a></li>
<li><a href="https://blog.51cto.com/BADAOLIUMANGQZ/8776336" target="_blank" rel="noopener noreferrer">FFmpeg在Centos服务器上离线安装(包含所需依赖)并实现拉取rtsp流与推送至rtmp服务器</a></li>
<li><a href="https://blog.csdn.net/qq_39835480/article/details/112886780" target="_blank" rel="noopener noreferrer">Linux ffmpeg 离线安装</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/120866438" target="_blank" rel="noopener noreferrer">如何在 CentOS 8 上安装 FFmpeg</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="461-在线在线下载和安装">4.6.1 【在线】在线下载和安装<a href="#461-在线在线下载和安装" class="hash-link" aria-label="4.6.1 【在线】在线下载和安装的直接链接" title="4.6.1 【在线】在线下载和安装的直接链接">​</a></h4>
<ol>
<li>手动编译 libsrtp</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/cisco/libsrtp/archive/refs/tags/v2.5.0.tar.gz -O /root/resource/libsrtp-2.5.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvzf libsrtp-2.5.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd libsrtp-2.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认openssl，需要安装 openssl-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --enable-openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 手动编译的openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ./configure --enable-openssl --with-openssl-dir=/usr/local/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>安装FFmpeg</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ffmpeg-4.4 是最后一个支持openssl 1.1.1的版本，ffmpeg-4.4.5开始需要openssl 3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># wget https://ffmpeg.org/releases/ffmpeg-7.1.1.tar.gz -O /root/resource/ffmpeg-7.1.1.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://ffmpeg.org/releases/ffmpeg-4.4.tar.gz -O /root/resource/ffmpeg-4.4.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvf ffmpeg-4.4.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ffmpeg-4.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ./configure --prefix=/usr/local/ffmpeg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/ffmpeg --enable-gpl --enable-libx264 --enable-static --disable-shared --extra-libs=-ldl --enable-encoder=libx264 --enable-openssl --enable-nonfree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ./configure --prefix=/usr/local/ffmpeg --enable-gpl --enable-libx264 --enable-static --disable-shared --extra-libs=-ldl  --enable-openssl --extra-cflags=&quot;-I/usr/local/openssl/include&quot; --extra-ldflags=&quot;-L/usr/local/openssl/lib&quot; --enable-encoder=libx264 --extra-ldflags=&quot;-L/usr/local/x264/lib&quot; --enable-nonfree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/ffmpeg/bin/ffmpeg -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="462-离线离线安装">4.6.2 【离线】离线安装<a href="#462-离线离线安装" class="hash-link" aria-label="4.6.2 【离线】离线安装的直接链接" title="4.6.2 【离线】离线安装的直接链接">​</a></h4>
<ol>
<li>手动编译 libsrtp</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvzf libsrtp-2.5.0.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd libsrtp-2.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 默认openssl，需要安装 openssl-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --enable-openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 手动编译的openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ./configure --enable-openssl --with-openssl-dir=/usr/local/openssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>安装FFmpeg</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/resource  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -xvf ffmpeg-4.4.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ffmpeg-4.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 编译安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix=/usr/local/ffmpeg --enable-gpl --enable-libx264 --enable-static --disable-shared --extra-libs=-ldl --enable-encoder=libx264 --enable-openssl --enable-nonfree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make -j$(nproc) &amp;&amp; make install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/ffmpeg/bin/ffmpeg -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="463-配置动态链接库和环境变量">4.6.3 配置动态链接库和环境变量<a href="#463-配置动态链接库和环境变量" class="hash-link" aria-label="4.6.3 配置动态链接库和环境变量的直接链接" title="4.6.3 配置动态链接库和环境变量的直接链接">​</a></h4>
<ol>
<li>配置动态链接库</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/ld.so.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/ffmpeg/lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载动态链接库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ldconfig -v</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>设置环境变量</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 设置环境变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NASM_HOME=/usr/local/nasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">YASM_HOME=/usr/local/yasm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">X264_HOME=/usr/local/x264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FFMPEG_HOME=/usr/local/ffmpeg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PATH=$PATH:$NASM_HOME/bin:$YASM_HOME/bin:$X264_HOME/bin:$FFMPEG_HOME/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export NASM_HOME YASM_HOME X264_HOME FFMPEG_HOME PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /etc/profile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五安装zlmediakit">五、安装ZLMediaKit<a href="#五安装zlmediakit" class="hash-link" aria-label="五、安装ZLMediaKit的直接链接" title="五、安装ZLMediaKit的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-下载zlmediakit源码">5.1 下载ZLMediaKit源码<a href="#51-下载zlmediakit源码" class="hash-link" aria-label="5.1 下载ZLMediaKit源码的直接链接" title="5.1 下载ZLMediaKit源码的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 国内用户推荐从同步镜像网站gitee下载 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone --depth 1 https://gitee.com/xia-chu/ZLMediaKit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ZLMediaKit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 千万不要忘记执行这句命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git submodule update --init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-编译安装zlmediakit">5.2 编译安装ZLMediaKit<a href="#52-编译安装zlmediakit" class="hash-link" aria-label="5.2 编译安装ZLMediaKit的直接链接" title="5.2 编译安装ZLMediaKit的直接链接">​</a></h3>
<ol>
<li>检查依赖</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 检查依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gcc --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g++ --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ffmpeg -version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>编译</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /root/ZLMediaKit/build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/ZLMediaKit/build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 不启用webrtc编译</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cmake .. &amp;&amp; make -j4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启用webrtc编译</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake .. -DENABLE_WEBRTC=true -DOPENSSL_ROOT_DIR=/usr/local/openssl -DOPENSSL_LIBRARIES=/usr/local/openssl/lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake --build . --target MediaServer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-修改配置文件">5.3 修改配置文件<a href="#53-修改配置文件" class="hash-link" aria-label="5.3 修改配置文件的直接链接" title="5.3 修改配置文件的直接链接">​</a></h3>
<p>配置文件在 <code>/root/ZLMediaKit/release/linux/Debug/config.ini</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="531-wvp集成配置">5.3.1 WVP集成配置<a href="#531-wvp集成配置" class="hash-link" aria-label="5.3.1 WVP集成配置的直接链接" title="5.3.1 WVP集成配置的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[api]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiDebug=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defaultSnap=./www/logo.png</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改和记录秘钥，与WVP中匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">secret=035c73f7-bb6b-4889-a715-d9eb2d1925cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">snapRoot=./www/snap/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[general]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_nvidia_dev=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enableVhost=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enable_ffmpeg_log=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flowThreshold=1024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxStreamWaitMS=15000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改和记录MediaServerId，与WVP中匹配</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mediaServerId=FQ3TF8yT83wh5Wvz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mergeWriteMS=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">resetWhenRePlay=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">streamNoneReaderDelayMS=20000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unready_frame_cache=100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wait_add_track_ms=3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wait_track_ready_ms=10000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="531-webrtc配置">5.3.1 WebRTC配置<a href="#531-webrtc配置" class="hash-link" aria-label="5.3.1 WebRTC配置的直接链接" title="5.3.1 WebRTC配置的直接链接">​</a></h4>
<p>由于webrtc协议需要告知播放器服务器所在ip，如果该ip对播放器不可见，会导致webrtc无法联通。请修改配置文件中<code>rtc.externIP</code>为播放器可见ip，如果不设置该配置项，zlmediakit将获取网卡ip(一般是内网ip)，那么将无法跨域nat使用webrtc。</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[rtc]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#rtc播放推流、播放超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timeoutSec=15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#本机对rtc客户端的可见ip，作为服务器时一般为公网ip，置空时，会自动获取网卡ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">externIP=192.168.137.126</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#rtc udp服务器监听端口号，所有rtc客户端将通过该端口传输stun/dtls/srtp/srtcp数据，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#该端口是多线程的，同时支持客户端网络切换导致的连接迁移</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#需要注意的是，如果服务器在nat  内，需要做端口映射时，必须确保外网映射端口跟该端口一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port=8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#设置remb比特率，非0时关闭twcc并开启remb。该设置在rtc推流时有效，可以控制推流画质</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rembBitRate=1000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-防火墙配置">5.4 防火墙配置<a href="#54-防火墙配置" class="hash-link" aria-label="5.4 防火墙配置的直接链接" title="5.4 防火墙配置的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 开放端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=80/tcp          # http (hls http-ts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=443/tcp         # https</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=1935/tcp        # rtmp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=10000/tcp       # rtp_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=10000/udp       # rtp_proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=30000-35000/udp # rtp 推送端口，至少36个端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=8000/tcp        # rtc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=8000/udp        # rtc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=9000/udp        # srt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=554/tcp         # rtsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=554/udp         # rtsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=18080/tcp       # WVP http端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --permanent --zone=public --add-port=18081/tcp       # 录 像管理端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 刷新配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看开放的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --list-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看所有防火墙规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firewall-cmd --list-all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-运行">5.4 运行<a href="#54-运行" class="hash-link" aria-label="5.4 运行的直接链接" title="5.4 运行的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/ZLMediaKit/release/linux/Debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 通过-h可以了解启动参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./MediaServer -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#以守护进程模式启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./MediaServer -d &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-测试">5.5 测试<a href="#55-测试" class="hash-link" aria-label="5.5 测试的直接链接" title="5.5 测试的直接链接">​</a></h3>
<p>最新的zlmediakit源码自带有效的ssl证书default.pem,对应的域名是default.zlmediakit.com,该域名解析到的ip为127.0.0.1,用户在浏览器中打开<a href="https://default.zlmediakit.com/webrtc/" target="_blank" rel="noopener noreferrer">测试链接</a> 即可开始测试。请先推流后，再测试播放。如果webrtc无法播放， 请参考此<a href="https://github.com/ZLMediaKit/ZLMediaKit/issues/1277" target="_blank" rel="noopener noreferrer">issue</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="六编译安装wvp-pro">六、编译安装WVP-Pro<a href="#六编译安装wvp-pro" class="hash-link" aria-label="六、编译安装WVP-Pro的直接链接" title="六、编译安装WVP-Pro的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-前端编译安装">6.1 前端编译安装<a href="#61-前端编译安装" class="hash-link" aria-label="6.1 前端编译安装的直接链接" title="6.1 前端编译安装的直接链接">​</a></h3>
<ol>
<li>拉取代码</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 拉取代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone http://113.57.121.225:3001/Pi-Diginn/wvp-front.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd wvp-front</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm --registry=https://registry.npmmirror.com install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>修改环境配置 <code>config/prod.env.js</code></li>
</ol>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">&#x27;use strict&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;production&quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// pi-diginn-web地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PI_DIGINN_WEB_URL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;diginn.pisx.local:9096&quot;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// PI_DIGINN_WEB_URL: &#x27;&quot;113.57.121.225:9096&quot;&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// PI_DIGINN_WEB_URL: &#x27;&quot;114.55.234.250:9096&quot;&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">WVP_WEB_URL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&quot;diginn.pisx.local:9096&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// WVP_WEB_URL: &#x27;&quot;113.57.121.225:9096&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// WVP_WEB_URL: &#x27;&quot;114.55.234.250:9096&quot;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>测试地址需要修改主机hosts文件 <code>192.168.137.1  diginn.pisx.local</code></p>
<ol start="3">
<li>打包静态文件</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 打包静态文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>将得到的dist目录放到nginx下 <code>html/wvp</code></li>
</ol>
<p>添加配置文件 <code>conf.d/diginn.conf</code></p>
<div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_nginx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:9096;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_oauth {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31888;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_system {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31112;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_thing {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31111;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_message {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31890;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_plugin {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31116;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_workflow {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31113;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_usability {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31789;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_wvp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31117;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">upstream diginn_demo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server 192.168.137.1:31112;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># websocket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">map $http_upgrade $connection_upgrade {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  default upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;&#x27; close;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen       9096;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listen  [::]:9096;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  server_name  diginn.pisx.local;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #access_log  /var/log/nginx/host.access.log  main;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root   html/diginn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!-e $request_filename) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rewrite ^(.*)$ /index.html?s=$1 last;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location /monitor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      alias   html/wvp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      if (!-e $request_filename) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rewrite ^(.*)$ /index.html?s=$1 last;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /oauth/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_oauth/oauth/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /system/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_system;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /thing/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_thing;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /message/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /plugin/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_plugin;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /workflow/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_workflow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /usability/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_usability;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ^~ /wvp/ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass              http://diginn_wvp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_http_version      1.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_read_timeout      30s;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Host $http_host;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Real-IP $remote_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        X-NginX-Proxy true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Upgrade $http_upgrade;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_set_header        Connection &quot;$connection_upgrade&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # 使用捕获组 $1 来传递剩余路径 /demo/123 -&gt; /123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ~ ^/demo(/.*)$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_pass http://diginn_demo$1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #error_page  404              /404.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # redirect server error pages to the static page /50x.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location = /50x.html {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # 图片防盗链</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  location ~* \.(gif|jpg|jpeg|png|bmp|swf)$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valid_referers none blocked 192.168.9.21; # 只允许本机IP外链引用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($invalid_referer){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return 403;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # proxy the PHP scripts to Apache listening on 127.0.0.1:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #location ~ \.php$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    proxy_pass   http://127.0.0.1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #location ~ \.php$ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    root           html;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    fastcgi_pass   127.0.0.1:9000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    fastcgi_index  index.php;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    include        fastcgi_params;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # deny access to .htaccess files, if Apache&#x27;s document root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # concurs with nginx&#x27;s one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #location ~ /\.ht {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #    deny  all;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-运行-wvp-pro-后端服务">6.2 运行 wvp-pro 后端服务<a href="#62-运行-wvp-pro-后端服务" class="hash-link" aria-label="6.2 运行 wvp-pro 后端服务的直接链接" title="6.2 运行 wvp-pro 后端服务的直接链接">​</a></h3>
<p>修改 <code>application-wvp-local.yaml</code> 配置，设置 <code>media.ip</code> <code>media.hook-ip</code> <code>media.sdp-ip</code> 等</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选]上传文件大小限制</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">servlet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">multipart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">max-file-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">max-request-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100MB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  # REDIS数据库配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  redis:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    # [必须修改] Redis服务器IP, REDIS安装在本机的,使用127.0.0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    host: 127.0.0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    # [必须修改] 端口号</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    port: 6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    # [可选] 数据库 DB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    database: 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    # [可选] 访问密码,若你的redis服务器没有设置密码，就不需要用密码去连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    password: 62g@A71u2sx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    # [可选] 超时时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    timeout: 10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    # mysql数据源</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#  datasource:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    type: com.alibaba.druid.pool.DruidDataSource</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    driver-class-name: com.mysql.cj.jdbc.Driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    url: jdbc:mysql://127.0.0.1:3306/wvp?useUnicode=true&amp;characterEncoding=UTF8&amp;rewriteBatchedStatements=true&amp;serverTimezone=PRC&amp;useSSL=false&amp;allowMultiQueries=true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    username: root</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    password: pisx@mysql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    druid:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      initialSize: 10                       # 连接池初始化连接数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      maxActive: 200                        # 连接池最大连接数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      minIdle: 5                            # 连接池最小空闲连接数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      maxWait: 60000                        # 获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置useUnfairLock属性为true使用非公平锁。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      keepAlive: true                       # 连接池中的minIdle数量以内的连接，空闲时间超过minEvictableIdleTimeMillis，则会执行keepAlive操作。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      validationQuery: select 1             # 检测连接是否有效sql，要求是查询语句，常用select &#x27;x&#x27;。如果validationQuery为null，testOnBorrow、testOnReturn、testWhileIdle都不会起作用。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      testWhileIdle: true                   # 建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      testOnBorrow: false                   # 申请连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      testOnReturn: false                   # 归还连接时执行validationQuery检测连接是否有效，做了这个配置会降低性能。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      poolPreparedStatements: false         # 是否開啟PSCache，並且指定每個連線上PSCache的大小</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      timeBetweenEvictionRunsMillis: 60000  # 配置間隔多久才進行一次檢測，檢測需要關閉的空閒連  線，單位是毫秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      minEvictableIdleTimeMillis: 300000    # 配置一個連線在池中最小生存的時間，單位是毫秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      filters: stat,slf4j             # 配置监控统计拦截的filters，监控统计用的filter:sta, 日志用的filter:log4j</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      useGlobalDataSourceStat: true         # 合并多个DruidDataSource的监控数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      # 通过connectProperties属性来打开mergeSql功能；慢SQL记录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      connectionProperties: druid.stat.mergeSql=true;druid.stat.slowSqlMillis=1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#      #stat-view-servlet.url-pattern: /admin/druid/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#[可选] WVP监听的HTTP端口, 网页和接口调用都是这个端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">31117</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 作为28181服务器的配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">sip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [必须修改] 本机的IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 28181服务监听的端口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30405</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 根据国标6.1.2中规定，domain宜采用ID统一编码的前十位编码。国标附录D中定义前8位为中心编码（由省级、市级、区级、基层编号组成，参照GB/T 2260-2007）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 后两位为行业编码，定义参照附录D.3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 4201110000标识湖北省武汉市洪山区 信息行业接入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">domain</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3402000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">34020000002000000001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 默认设备认证密码，后续扩展使用设备单独密码, 移除密码将不进行校验</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pisx@2023</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#zlm 默认服务器配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">media</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> FQ3TF8yT83wh5Wvz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [必须修改] zlm服务器的内网IP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.9.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] zlm服务器的hook所使用的IP, 默认使用sip.ip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hook-ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.8.119</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] wvp在国标信令中使用的ip，此ip为摄像机可以访问到的ip， 置空使用 media.ip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">sdp-ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.8.119</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 返回流地址时的ip，置空使用 media.ip</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">stream-ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.9.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [必须修改] zlm服务器的http.port</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">http-port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] zlm服务器的hook.admin_params=secret</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> GVuK9EAuuNujz6xU5DzQOKexFvblb0YV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 启用多端口模式, 多端口模式使用端口区分每路流，兼容性更好。 单端口使用流的ssrc区分， 点播超时建议使用多端口测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">rtp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 是否启用多端口模式, 开启后会在portRange范围内选择端口用于媒体流传输</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 在此范围内选择端口用于媒体流传输, 必须提前在zlm上配置该属性，不然自动配置此属性可能不成功</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">port-range</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">30500</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 端口范围</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 国标级联在此范围内选择端口发送媒体流,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">send-port-range</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">30500</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 端  口范围</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 录像辅助服务， 部署此服务可以实现zlm录像的管理与下载， 0 表示不使用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">record-assist-port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">18081</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># [自定义] ZLM 映射的IP地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">public-stream-ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.9.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># [可选] 日志配置, 一般不需要改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">logging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">logback</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">local.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 作为oauth客户端接入第三方登录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">oauth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clients</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 创新平台登录配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pi-diginn</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">client-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wvp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">client-secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 7mevh7atoq23f9xcqgqsmr4ny8v2ufp0rsg7z2p2bidnvj7tsq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">redirect-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/monitor/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">authorize-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/oauth/oauth/authorize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">token-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/oauth/oauth/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">userinfo-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/oauth/user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">pi-diginn-test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">client-id</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> wvp</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">client-secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 7mevh7atoq23f9xcqgqsmr4ny8v2ufp0rsg7z2p2bidnvj7tsq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">redirect-uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9006/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">authorize-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/oauth/oauth/authorize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">token-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/oauth/oauth/token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">userinfo-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/oauth/user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">scope</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">wvp</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># wvp的访问地址</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//diginn.pisx.local</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">9096/wvp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="七obs推流">七、OBS推流<a href="#七obs推流" class="hash-link" aria-label="七、OBS推流的直接链接" title="七、OBS推流的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-新建场景">1. 新建场景<a href="#1-新建场景" class="hash-link" aria-label="1. 新建场景的直接链接" title="1. 新建场景的直接链  接">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/OBS新建场景1-401e52286fb3243ff1bf0ef20b052d6f.png" width="1358" height="946" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-新建媒体源">2. 新建媒体源<a href="#2-新建媒体源" class="hash-link" aria-label="2. 新建媒体源的直接链接" title="2. 新建媒体源的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/OBS新建媒体源1-9687dc65e1cc16ea9c74bb9317df4ce8.png" width="1358" height="958" class="img_ev3q"></p>
<p>新建源
<img decoding="async" loading="lazy" src="/assets/images/OBS新建媒体源2-50b81f27c2b0ef84c2c54a1352c7621e.png" width="1376" height="956" class="img_ev3q"></p>
<p>选择本地MP4文件
<img decoding="async" loading="lazy" src="/assets/images/OBS新建媒体源3-830b476a3d668e8ce71e03c12cf7e6c7.png" width="1376" height="956" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-设置推流信息">3. 设置推流信息<a href="#3-设置推流信息" class="hash-link" aria-label="3. 设置推流信息的直接链接" title="3. 设置推流信息的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" src="/assets/images/设置推流信息1-0656f798c92f7fdb01203a439cbbd6a2.png" width="1376" height="956" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/设置推流信息2-79738718233c4d3487978ff327b669cf.png" width="1920" height="922" class="img_ev3q"></p>
<p>生成推流链接
<a href="https://www.sojson.com/md5/" target="_blank" rel="noopener noreferrer">MD5在线加密/解密/破解—MD5在线</a>
需要修改的地方 ip 端口(默认1935) sign(用户表里找pushkey然后MD5小写加密)</p>
<ul>
<li>服务器： <code>rtmp://192.168.137.126:1935/obs</code>。 ZLM的IP + rtmp端口 + APP名称</li>
<li>推流码： <code>push_mp4?sign=41db35390ddad33f83944f44b8b75ded</code> wvp_user表查pushKey。 流ID + <code>sign=md5(pushKey)</code></li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/设置推流信息3-2084af82620c1fe23a30c1470fcad10f.png" width="1242" height="961" class="img_ev3q"></p>
<p>开始推流
<img decoding="async" loading="lazy" src="/assets/images/设置推流信息4-f47337bc1c17b11140fe7c5ac6def76e.png" width="1376" height="956" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-播放视频流">4. 播放视频流<a href="#4-播放视频流" class="hash-link" aria-label="4. 播放视频流的直接链接" title="4. 播放视频流的直接链接">​</a></h3>
<p>Jessibuca播放
<img decoding="async" loading="lazy" src="/assets/images/播放视频流1-d367e35e2d726c124e591bd2d4f39d05.png" width="1920" height="922" class="img_ev3q"></p>
<p>WebRTC播放
<img decoding="async" loading="lazy" src="/assets/images/播放视频流2-b4baa4381b99960d66bc70c471a9d41e.png" width="1920" height="922" class="img_ev3q"></p>
<p>PortPlayer播放
<img decoding="async" loading="lazy" src="/assets/images/播放视频流3-a8867a3081c4d730e358df730c0116cf.png" width="1676" height="916" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="八接入国标摄像头">八、接入国标摄像头<a href="#八接入国标摄像头" class="hash-link" aria-label="八、接入国标摄像头的直接链接" title="八、接入国标摄像头的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="81-摄像头配置">8.1 摄像头配置<a href="#81-摄像头配置" class="hash-link" aria-label="8.1 摄像头配置的直接链接" title="8.1 摄像头配置的直接链接">​</a></h3>
<ul>
<li><a href="https://doc.wvp-pro.cn/#/_content/ability/device" target="_blank" rel="noopener noreferrer">接入国标28181设备</a>
<img decoding="async" loading="lazy" src="/assets/images/摄像头配置1-8823d744ace27500f9e8cd3c4793c1de.png" width="1920" height="922" class="img_ev3q"></li>
</ul>
<table><thead><tr><th>参数</th><th>示例值</th><th>对应wvp配置属性</th><th>属性说明</th></tr></thead><tbody><tr><td>SIP服务器ID</td><td>34020000002000000001</td><td>sip.id</td><td></td></tr><tr><td>SIP服务器域</td><td>3402000000</td><td>sip.domain</td><td></td></tr><tr><td>SIP服务器地址</td><td>192.168.8.119</td><td>sip.ip</td><td>多个网卡时要指定为摄像头可访问的ip</td></tr><tr><td>SIP服务器端口</td><td>30405</td><td>sip.port</td><td></td></tr><tr><td>SIP用户名</td><td>34020000001320000013</td><td></td><td>自定义</td></tr><tr><td>SIP用户认证ID</td><td>34020000001320000013</td><td></td><td>自定义</td></tr><tr><td>密码</td><td>••••••</td><td>sip.password</td><td></td></tr><tr><td>密码确认</td><td>••••••</td><td>sip.password</td><td></td></tr><tr><td>注册有效期</td><td>3600 秒</td><td></td><td>自定义</td></tr><tr><td>注册状态</td><td>在线</td><td></td><td>自定义</td></tr><tr><td>心跳周期</td><td>10 秒</td><td></td><td>自定义</td></tr><tr><td>28181码流索引</td><td>主码流（定时）</td><td></td><td>自定义</td></tr><tr><td>注册间隔</td><td>60 秒</td><td></td><td>自定义</td></tr><tr><td>最大心跳超时次数</td><td>3</td><td></td><td>自定义</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="82-启动wvp">8.2 启动wvp<a href="#82-启动wvp" class="hash-link" aria-label="8.2 启动wvp的直接链接" title="8.2 启动wvp的直接链接">​</a></h3>
<p>启动WVP，可以看到主动连接ZLM，并接收到了设备的注册信息</p>
<p><img decoding="async" loading="lazy" src="/assets/images/启动WVP-3fa8d1b5f0c162fedaba447e6bfcdcda.png" width="1930" height="1046" class="img_ev3q"></p>
<p>查看ZLM的日志，可以看到先调用了 <code>/index/api/getServerConfig</code> <code>/index/api/getMediaList</code> 获取ZLM的配置信息
<img decoding="async" loading="lazy" src="/assets/images/获取Server配置-6e70bdde41228afa2a728cab003b97e9.png" width="1676" height="916" class="img_ev3q"></p>
<p>再调用了 <code>/index/api/setServerConfig</code> 设 置hook回调地址信息
<img decoding="async" loading="lazy" src="/assets/images/设置Server配置-f184dcad89314c0726ee7d42fb2095bc.png" width="1676" height="916" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="83-web端查看摄像头信息">8.3 WEB端查看摄像头信息<a href="#83-web端查看摄像头信息" class="hash-link" aria-label="8.3 WEB端查看摄像头信息的直接链接" title="8.3 WEB端查看摄像头信息的直接链接">​</a></h3>
<p>可以看到自动注册的设备信息
<img decoding="async" loading="lazy" src="/assets/images/国标设备1-eac6ae6ac173ee1a0c1a10af7a50d1ae.png" width="1920" height="922" class="img_ev3q"></p>
<p>打开通道列表
<img decoding="async" loading="lazy" src="/assets/images/国标设备2-4a3fbf76305fc04878c0dbe4d3bd2892.png" width="1920" height="922" class="img_ev3q"></p>
<p>点击播放按钮
<img decoding="async" loading="lazy" src="/assets/images/国标设备3-90dd80907abd4d572ad1a5c859cdf872.png" width="1920" height="922" class="img_ev3q"></p>
<p>切换WenRTC播放
<img decoding="async" loading="lazy" src="/assets/images/国标设备4-bc29006305066d9e982c93e410edbbe6.png" width="1920" height="922" class="img_ev3q"></p>
<p>查看ZLM日志，可以看到收到两个请求 <code>/index/api/getRtpInfo</code> <code>/index/api/webrtc?app=rtp&amp;stream=34020000001320000013_34020000001320000013&amp;type=play</code>，分别对应Jessibuca和webrtc播放
<img decoding="async" loading="lazy" src="/assets/images/播放日志1-e459564ee361e84884d469cb3f14a87c.png" width="1676" height="916" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题">常见问题<a href="#常见问题" class="hash-link" aria-label="常见问题的直接链接" title="常见问题的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="一点播收流超时-github-issue289">一、点播收流超时 <a href="https://github.com/648540858/wvp-GB28181-pro/issues/289" target="_blank" rel="noopener noreferrer">Github issue#289</a><a href="#一点播收流超时-github-issue289" class="hash-link" aria-label="一点播收流超时-github-issue289的直接链接" title="一点播收流超时-github-issue289的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="故障原因">故障原因<a href="#故障原因" class="hash-link" aria-label="故障原因的直接链接" title="故障原因的直接链接">​</a></h4>
<p>这通常是摄像头网络无法联通ZLMediaServer导致的</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案">解决方案<a href="#解决方案" class="hash-link" aria-label="解决方案的直接链接" title="解决方案的直接链接">​</a></h4>
<p>在摄像头配置中开启SSH
<img decoding="async" loading="lazy" src="/assets/images/摄像头开启SSH-aca9e6753b5247a33a90bb8fefb94165.png" width="1920" height="922" class="img_ev3q"></p>
<p>测试摄像头与ZLM WVP的网络互通情况
<img decoding="async" loading="lazy" src="/assets/images/摄像头网络测试-5a00a1b5cc31e5f907606ae25a676c43.png" width="1676" height="916" class="img_ev3q"></p>
<p>然后检查ZLM的防火墙是否关闭（或者端口放行规则是否配置）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="二webrtc播放报错">二、WebRTC播放报错<a href="https://cloud.tencent.com/developer/article/2403493" target="_blank" rel="noopener noreferrer"></a><a href="#二webrtc播放报错" class="hash-link" aria-label="二webrtc播放报错的直接链接" title="二webrtc播放报错的直接链接">​</a></h3>
<p>Chrome浏览器升级到123版本后，zlmediakit的webrtc无法播放，无法建立连接问题</p>
<p>报错信息如下</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> [RTCPusherPlayer] OperationError: Failed to execute &#x27;setRemoteDescription&#x27; on &#x27;RTCPeerConnection&#x27;: Failed to parse SessionDescription.  Duplicate a=msid lines detected</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at e.RTCPeerConnection.setRemoteDescription (liveplayer-lib.min.js:1:1198473)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at RTCPeerConnection.setRemoteDescription (common_shim.js:214:39)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    at endpoint.js:119:29</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="故障原因-1">故障原因<a href="#故障原因-1" class="hash-link" aria-label="故障原因的直接链接" title="故障原因的直接链接">​</a></h4>
<p>这是因为Chrome浏览器升级到123版本后<a href="https://bugs.chromium.org/p/webrtc/issues/detail?id=15845" target="_blank" rel="noopener noreferrer">更改了rtp机制</a>导致的。(<a href="https://issues.webrtc.org/issues/42226210" target="_blank" rel="noopener noreferrer">https://issues.webrtc.org/issues/42226210</a>)</p>
<p>webrtc 返回的sdp中的msid是相同的，chrome更新完后会有这个问题，在<code>WebRtcTransport.cpp</code>修改
<code>ssrc.msid = RTP_MSID + to_string(i++);</code> 这一行，使msid不一样就好了</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-1">解决方案：<a href="#解决方案-1" class="hash-link" aria-label="解决方案：的直接链接" title="解决方案：的直接链接">​</a></h4>
<ol>
<li>合并fix代码：<a href="https://github.com/ZLMediaKit/ZLMediaKit/commit/1e3959433522808f3390bc9748ae96af793906dc" target="_blank" rel="noopener noreferrer">Commit 1e39594</a></li>
<li>更新编译zlmeidakit版本到最新版本</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="webrtc播放失败转圈">WebRTC播放失败，转圈<a href="#webrtc播放失败转圈" class="hash-link" aria-label="WebRTC播放失败，转圈的直接链接" title="WebRTC播放失败，转圈的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="故障原因-2">故障原因<a href="#故障原因-2" class="hash-link" aria-label="故障原因的直接链接" title="故障原因的直接链接">​</a></h4>
<p>一般是因为网络不通，如设备(摄像头)及服务(wvp zlm)部署通过内网IP通讯，通过公网访问视频页面时会出现WebRTC一直转圈的情况</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决方案-2">解决方案<a href="#解决方案-2" class="hash-link" aria-label="解决方案的直接链接" title="解决方案的直接链接">​</a></h4>
<p>这时可以将zlm rtc配置改为内网ip测试</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[rtc]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bfilter=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">datachannel_echo=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#externIP=113.57.121.225     # 将此处的公网IP改为内网</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">externIP=192.168.1.213</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxRtpCacheMS=5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxRtpCacheSize=2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_bitrate=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_bitrate=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nackIntervalRatio=1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nackMaxCount=15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nackMaxMS=3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nackMaxSize=2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nackRtpSize=8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">port=8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">preferredCodecA=PCMA,PCMU,opus,mpeg4-generic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">preferredCodecV=H264,H265,AV1,VP9,VP8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rembBitRate=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start_bitrate=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tcpPort=8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timeoutSec=15</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果可以正常播放，需要将公网IP防火墙规则对应的8000/tcp 8000/udp 开放出来</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="语音对讲报错-navigatormediadevices-is-undefined">语音对讲报错 <code>navigator.mediaDevices is undefined</code><a href="#语音对讲报错-navigatormediadevices-is-undefined" class="hash-link" aria-label="语音对讲报错-navigatormediadevices-is-undefined的直接链接" title="语音对讲报错-navigatormediadevices-is-undefined的直接链接">​</a></h3>
<ul>
<li><a href="https://blog.csdn.net/gw6601/article/details/130850614" target="_blank" rel="noopener noreferrer">关于navigator.mediaDevices为undefined，获取不到媒体权限的问题</a></li>
</ul>
<p>报错信息如下</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TypeError: Cannot read properties of undefined (reading &#x27;getUserMedia&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当时的场景是公司搭建的内部服务网站没有测试环境（有点鸡肋，说是因为需要线上成员信息认证登录），也因为跨域问题，所以需要制定线上环境的域名，本地localhost用不了，协议是http的，导致接入一个语音需求的时候本地调试出现了问题。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="故障原因-3">故障原因<a href="#故障原因-3" class="hash-link" aria-label="故障原因的直接链接" title="故障原因的直接链接">​</a></h4>
<p>主要原因是浏览器的安全策略导致了这个问题</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// 兼容性处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getUserMedia</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getUserMedia</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">webkitGetUserMedia</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mozGetUserMedia</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">msGetUserMedia</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getUserMedia</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 支持</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;支持&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getUserMedia</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 不支持</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;navigator.getUserMedia - 不支持&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 新版 API 优先</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mediaDevices</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mediaDevices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getUserMedia</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 现代浏览器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">mediaDevices</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUserMedia</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">video</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">audio</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleSuccess</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">handleError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">getUserMedia</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 旧版浏览器兼容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token dom variable" style="color:#36acaa">navigator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getUserMedia</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">video</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">audio</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleSuccess</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;当前浏览器不支持媒体设备访问&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&lt;!</span><span class="token doctype doctype-tag" style="color:#999988;font-style:italic">DOCTYPE</span><span class="token doctype" style="color:#999988;font-style:italic"> </span><span class="token doctype name" style="color:#999988;font-style:italic">html</span><span class="token doctype punctuation" style="color:#393A34;font-style:italic">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">button</span><span class="token tag" style="color:#00009f"> </span><span class="token tag special-attr attr-name" style="color:#00a4db">onclick</span><span class="token tag special-attr attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag special-attr attr-value value javascript language-javascript function" style="color:#d73a49">startCapture</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:#393A34">(</span><span class="token tag special-attr attr-value value javascript language-javascript punctuation" style="color:#393A34">)</span><span class="token tag special-attr attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">获取媒体 设备</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">button</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">video</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">id</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">video</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">autoplay</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">video</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 兼容性处理</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                            </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">webkitGetUserMedia</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                            </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mozGetUserMedia</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">||</span><span class="token script language-javascript"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">                            </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">msGetUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 支持</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;支持&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">else</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 不支持</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;navigator.getUserMedia - 不支持&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 新版 API 优先</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mediaDevices</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mediaDevices</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 现代浏览器</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mediaDevices</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style="color:#36acaa">video</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style="color:#36acaa">audio</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">then</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">handleSuccess</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript keyword control-flow" style="color:#00009f">catch</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">handleError</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">else</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 旧版浏览器兼容</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style="color:#36acaa">video</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style="color:#36acaa">audio</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> handleSuccess</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> handleError</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">else</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&quot;当前浏览器不支持媒体设备访问&quot;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#00009f">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#d73a49">handleSuccess</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript parameter">stream</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">log</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&quot;成功获取媒体流&quot;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword" style="color:#00009f">const</span><span class="token script language-javascript"> video </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">document</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getElementById</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&#x27;video&#x27;</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      video</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">srcObject</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">=</span><span class="token script language-javascript"> stream</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#00009f">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#d73a49">handleError</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript parameter">error</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript console class-name">console</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">error</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript string" style="color:#e3116c">&quot;获取媒体失败:&quot;</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> error</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">name</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> error</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">message</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript keyword" style="color:#00009f">function</span><span class="token script language-javascript"> </span><span class="token script language-javascript function" style="color:#d73a49">startCapture</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript comment" style="color:#999988;font-style:italic">// 通过按钮触发（浏览器要求用户主动交互）</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword control-flow" style="color:#00009f">if</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mediaDevices</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator" style="color:#393A34">&amp;&amp;</span><span class="token script language-javascript"> </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mediaDevices</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">        </span><span class="token script language-javascript dom variable" style="color:#36acaa">navigator</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript property-access">mediaDevices</span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">getUserMedia</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript punctuation" style="color:#393A34">{</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style="color:#36acaa">video</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript punctuation" style="color:#393A34">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript literal-property property" style="color:#36acaa">audio</span><span class="token script language-javascript operator" style="color:#393A34">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript boolean" style="color:#36acaa">true</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">          </span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript method function property-access" style="color:#d73a49">then</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">handleSuccess</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">          </span><span class="token script language-javascript punctuation" style="color:#393A34">.</span><span class="token script language-javascript keyword control-flow" style="color:#00009f">catch</span><span class="token script language-javascript punctuation" style="color:#393A34">(</span><span class="token script language-javascript">handleError</span><span class="token script language-javascript punctuation" style="color:#393A34">)</span><span class="token script language-javascript punctuation" style="color:#393A34">;</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">      </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation" style="color:#393A34">}</span><span class="token script language-javascript"></span><br></span><span class="token-line" style="color:#393A34"><span class="token script language-javascript">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">script</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">html</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer">MediaDevices.getUserMedia() - Web API 接口参考 | MDN</a></li>
</ul>
<p><code>navigator.mediaDevices</code>在目前以下三种情况下可以获取到</p>
<ol>
<li>地址为localhost:// 访问时</li>
<li>地址为https:// 时</li>
<li>为文件访问file://</li>
</ol>
<p>解决方案有三种</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-采用https方案">1. 采用https方案<a href="#1-采用https方案" class="hash-link" aria-label="1. 采用https方案的直接链接" title="1. 采用https方案的直接链接">​</a></h4>
<p>由于线上环境都是https协议的，所以这个不用考虑，只是本地调试是一个大问题，所以忽略</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-采取修改chrome浏览器的安全策略">2. 采取修改chrome浏览器的安全策略<a href="#2-采取修改chrome浏览器的安全策略" class="hash-link" aria-label="2. 采取修改chrome浏览器的安全策略的直接链接" title="2. 采取修改chrome浏览器的安全策略的直接链接">​</a></h4>
<ol>
<li>浏览器地址栏输入 <code>edge://flags/#unsafely-treat-insecure-origin-as-secure</code>  <code>chrome://flags/#unsafely-treat-insecure-origin-as-secure</code></li>
<li>将该 <code>Disabled</code> 切换成 <code>Enable</code> 状态；</li>
<li>在输入框中填写需要开启的域名或地址(带上端口号)，如果有多个，则以逗号分隔；<!-- -->
<ul>
<li><code>http://aio.pisx.com:9092</code></li>
</ul>
</li>
<li>重启浏览器后生效</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-在本地做了一次proxy我的项目是vue的在vueconfigjs中添加">3. 在本地做了一次proxy，我的项目是vue的，在vue.config.js中添加：<a href="#3-在本地做了一次proxy我的项目是vue的在vueconfigjs中添加" class="hash-link" aria-label="3. 在本地做了一次proxy，我的项目是vue的，在vue.config.js中添加：的直接链接" title="3. 在本地做了一次proxy，我的项目是vue的，在vue.config.js中添加：的直接链接">​</a></h4>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">devServer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">port</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">disableHostCheck</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">host</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;aio.pisx.com&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">https</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>采用第2、3套方案可以解决本地调试问题，如果线上不是https协议，那就要申请证书了</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/linux/install/13-Deploy-ZLMediaKit-And-WVP-GB28181-Pro-Offline.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/zh-cn/linux/install/Install-EMQX-Offline-In-CentOS8/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Install-EMQX-Offline-In-CentOS8</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/docker/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Docker</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一相关链接" class="table-of-contents__link toc-highlight">一、相关链接</a></li><li><a href="#二环境介绍" class="table-of-contents__link toc-highlight">二、环境介绍</a></li><li><a href="#三准备工作" class="table-of-contents__link toc-highlight">三、准备工作</a><ul><li><a href="#31-系统安装" class="table-of-contents__link toc-highlight">3.1 系统安装</a></li><li><a href="#32-设置静态ip" class="table-of-contents__link toc-highlight">3.2 设置静态IP</a></li><li><a href="#33-修改yum源" class="table-of-contents__link toc-highlight">3.3 修改yum源</a></li><li><a href="#34-创建操作用户" class="table-of-contents__link toc-highlight">3.4 创建操作用户</a></li><li><a href="#35-安装基础依赖" class="table-of-contents__link toc-highlight">3.5 安装基础依赖</a></li></ul></li><li><a href="#四安装编译依赖" class="table-of-contents__link toc-highlight">四、安装编译依赖</a><ul><li><a href="#41-开发工具包依赖安装" class="table-of-contents__link toc-highlight">4.1 开发工具包依赖安装</a></li><li><a href="#42-安装基础依赖-gcc-gcc-c-cmake" class="table-of-contents__link toc-highlight">4.2 安装基础依赖 gcc gcc-c++ cmake</a></li><li><a href="#43-安装-nasm-yasm" class="table-of-contents__link toc-highlight">4.3 安装 Nasm Yasm</a></li><li><a href="#44-安装-x264-libmp4v2-faac" class="table-of-contents__link toc-highlight">4.4 安装 x264 libmp4v2 faac</a></li><li><a href="#45-编译安装opensslperl-zlib" class="table-of-contents__link toc-highlight">4.5 编译安装Openssl(perl zlib)</a></li><li><a href="#46-安装-libsrtp-ffmpeg" class="table-of-contents__link toc-highlight">4.6 安装 libsrtp FFmpeg</a></li></ul></li><li><a href="#五安装zlmediakit" class="table-of-contents__link toc-highlight">五、安装ZLMediaKit</a><ul><li><a href="#51-下载zlmediakit源码" class="table-of-contents__link toc-highlight">5.1 下载ZLMediaKit源码</a></li><li><a href="#52-编译安装zlmediakit" class="table-of-contents__link toc-highlight">5.2 编译安装ZLMediaKit</a></li><li><a href="#53-修改配置文件" class="table-of-contents__link toc-highlight">5.3 修改配置文件</a></li><li><a href="#54-防火墙配置" class="table-of-contents__link toc-highlight">5.4 防火墙配置</a></li><li><a href="#54-运行" class="table-of-contents__link toc-highlight">5.4 运行</a></li><li><a href="#55-测试" class="table-of-contents__link toc-highlight">5.5 测试</a></li></ul></li><li><a href="#六编译安装wvp-pro" class="table-of-contents__link toc-highlight">六、编译安装WVP-Pro</a><ul><li><a href="#61-前端编译安装" class="table-of-contents__link toc-highlight">6.1 前端编译安装</a></li><li><a href="#62-运行-wvp-pro-后端服务" class="table-of-contents__link toc-highlight">6.2 运行 wvp-pro 后端服务</a></li></ul></li><li><a href="#七obs推流" class="table-of-contents__link toc-highlight">七、OBS推流</a><ul><li><a href="#1-新建场景" class="table-of-contents__link toc-highlight">1. 新建场景</a></li><li><a href="#2-新建媒体源" class="table-of-contents__link toc-highlight">2. 新建媒体源</a></li><li><a href="#3-设置推流信息" class="table-of-contents__link toc-highlight">3. 设置推流信息</a></li><li><a href="#4-播放视频流" class="table-of-contents__link toc-highlight">4. 播放视频流</a></li></ul></li><li><a href="#八接入国标摄像头" class="table-of-contents__link toc-highlight">八、接入国标摄像头</a><ul><li><a href="#81-摄像头配置" class="table-of-contents__link toc-highlight">8.1 摄像头配置</a></li><li><a href="#82-启动wvp" class="table-of-contents__link toc-highlight">8.2 启动wvp</a></li><li><a href="#83-web端查看摄像头信息" class="table-of-contents__link toc-highlight">8.3 WEB端查看摄像头信息</a></li></ul></li><li><a href="#常见问题" class="table-of-contents__link toc-highlight">常见问题</a><ul><li><a href="#一点播收流超时-github-issue289" class="table-of-contents__link toc-highlight">一、点播收流超时 Github issue#289</a></li><li><a href="#二webrtc播放报错" class="table-of-contents__link toc-highlight">二、WebRTC播放报错</a></li><li><a href="#webrtc播放失败转圈" class="table-of-contents__link toc-highlight">WebRTC播放失败，转圈</a></li><li><a href="#语音对讲报错-navigatormediadevices-is-undefined" class="table-of-contents__link toc-highlight">语音对讲报错 <code>navigator.mediaDevices is undefined</code></a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>