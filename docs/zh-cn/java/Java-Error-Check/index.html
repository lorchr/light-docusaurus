<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/java/Java-Error-Check" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Java-Error-Check | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/Java-Error-Check/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Java-Error-Check | Light Docusaurus"><meta data-rh="true" name="description" content="- 线上故障排查"><meta data-rh="true" property="og:description" content="- 线上故障排查"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/Java-Error-Check/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/Java-Error-Check/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/Java-Error-Check/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.609e5209.css">
<script src="/light-docusaurus/assets/js/runtime~main.79436775.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.af3b976d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a class="navbar__item navbar__link" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/docs/zh-cn/java/Java-Error-Check/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/light-docusaurus/docs/category/java-jvm/">Java (JVM)</a><button aria-label="折叠侧边栏分类 &#x27;Java (JVM)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-AbstractQueuedSynchronizer/">Java-Concurrent-AbstractQueuedSynchronizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-ReentrantLock/">Java-Concurrent-ReentrantLock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-Semaphore/">Java-Concurrent-Semaphore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-CountDownlatch/">Java-Concurrent-CountDownlatch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-CyclicBarrier/">Java-Concurrent-CyclicBarrier</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-ConcurrentHashMap/">Java-Concurrent-ConcurrentHashMap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-ThreadPoolExecutor/">Java-Concurrent-ThreadPoolExecutor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/AbstractQueuedSynchronizer-In-Action/">AbstractQueuedSynchronizer-In-Action</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/">CompletableFuture-Getting-Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-Usage/">CompletableFuture-Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-In-Action/">CompletableFuture-In-Action</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Bytecode-Toolkit-Javassist/">Bytecode-Toolkit-Javassist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/GC-Exception-Analysis/">GC-Exception-Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Instrumentation-JavaAgent/">Java-Instrumentation-JavaAgent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/JVM-Stack-And Heap-Dump/">JVM-Stack-And Heap-Dump</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Http-Client-Skip-Https-Check/">Http-Client-Skip-Https-Check</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Error-Check/">Java-Error-Check</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Agent-1/">Java-Agent-1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Lock/">Java-Lock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Generic-Type/">Java-Generic-Type</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/awesome-open-source/">Awesome open source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/docs/category/java-jvm/"><span itemprop="name">Java (JVM)</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Java-Error-Check</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Java-Error-Check</h1></header><ul>
<li><a href="https://mp.weixin.qq.com/s/ujqwk7pdz5a-UpR6q5ogFQ">线上故障排查</a></li>
<li><a href="https://fredal.xin/java-error-check">Java Error Check</a></li>
</ul>
<p>线上故障主要会包括cpu、磁盘、内存以及网络问题，而大多数故障可能会包含不止一个层面的问题，所以进行排查时候尽量四个方面依次排查一遍。</p>
<p>同时例如<code>jstack</code>、<code>jmap</code>等工具也是不囿于一个方面的问题的，基本上出问题就是<code>df</code>、<code>free</code>、<code>top</code> 三连，然后依次<code>jstack</code>、<code>jmap</code>伺候，具体问题具体分析即可。</p>
<h2 id="cpu">CPU</h2>
<p>一般来讲我们首先会排查cpu方面的问题。cpu异常往往还是比较好定位的。原因包括业务逻辑问题(死循环)、频繁gc以及上下文切换过多。而最常见的往往是业务逻辑(或者框架逻辑)导致的，可以使用<code>jstack</code>来分析对应的堆栈情况。</p>
<h3 id="使用jstack分析cpu问题">使用jstack分析cpu问题</h3>
<p>我们先用<code>ps</code>命令找到对应进程的pid(  如果你有好几个目标进程，可以先用top看一下哪个占用比较高)。</p>
<p>接着用<code>top -H -p pid</code>来找到cpu使用率比较高的一些线程</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-1-c9316a9e92e48860b0c28ecacc41d398.png" width="1080" height="382">
然后将占用最高的pid转换为16进制<code>printf &#x27;%x\n&#x27; pid</code>得到<code>nid</code></p>
<p><img alt="img" src="data:image/png;base64,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" width="510" height="76">
接着直接在<code>jstack</code>中找到相应的堆栈信息<code>jstack pid |grep &#x27;nid&#x27; -C5 –color</code></p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-3-2f566d71c8018817918f91e76b1e16f9.png" width="1080" height="263">
可以看到我们已经找到了<code>nid</code>为<code>0x42</code>的堆栈信息，接着只要仔细分析一番即可。</p>
<p>当然更常见的是我们对整个<code>jstack</code>文件进行分析，通常我们会比较关注WAITING和TIMED_WAITING的部分，BLOCKED就不用说了。我们可以使用命令<code>cat jstack.log | grep &quot;java.lang.Thread.State&quot; | sort -nr | uniq -c</code>来对<code>jstack</code>的状态有一个整体的把握，如果WAITING之类的特别多，那么多半是有问题啦。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-4-60daaaa6742b5d90b0d115c888f21ee4.png" width="1080" height="220"></p>
<h3 id="频繁gc">频繁gc</h3>
<p>当然我们还是会使用<code>jstack</code>来分析问题，但有时候我们可以先确定下gc是不是太频繁，使用<code>jstat -gc pid 1000</code>命令来对gc分代变化情况进行观察，1000表示采样间隔(ms)，<code>S0C/S1C、S0U/S1U、EC/EU、OC/OU、MC/MU</code>分别代表两个Survivor区、Eden区、老年代、元数据区的容量和使用量。</p>
<p><code>YGC/YGCT</code>、<code>FGC/FGCT</code>、<code>GCT</code>则代表<code>YoungGC</code>、<code>FullGC</code>的耗时和次数以及总耗时。如果看到gc比较频繁，再针对gc方面做进一步分析。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-5-f7d9abd8fe7f51f10cd30dba194145bf.png" width="1080" height="122"></p>
<h3 id="上下文切换">上下文切换</h3>
<p>针对频繁上下文问题，我们可以使用<code>vmstat</code>命令来进行查看</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-6-b755f7d883a5893063a778d4ef83b1b4.png" width="1080" height="240">
<code>cs(context switch)</code>一列则代表了上下文切换的次数。</p>
<p>如果我们希望对特定的pid进行监控那么可以使用 <code>pidstat -w pid</code>命令，<code>cswch</code>和<code>nvcswch</code>表示自愿及非自愿切换。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-7-c7155627a3683b4c96f38b87aaa3a81b.png" width="922" height="432"></p>
<h2 id="磁盘">磁盘</h2>
<p>磁盘问题和cpu一样是属于比较基础的。首先是磁盘空间方面，我们直接使用<code>df -hl</code>来查看文件系统状态</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-8-0f53f36e501c0f44711f8a3a01d80727.png" width="1080" height="137"></p>
<p>更多时候，磁盘问题还是性能上的问题。我们可以通过<code>iostatiostat -d -k -x</code>来进行分析</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-9-b35ce08db3ec320c81fed6aeff12b69f.png" width="1080" height="241"></p>
<p>最后一列<code>%util</code>可以看到每块磁盘写入的程度，而<code>rrqpm/s</code>以及<code>wrqm/s</code>分别表示读写速度，一般就能帮助定位到具体哪块磁盘出现问题了。</p>
<p>另外我们还需要知道是哪个进程在进行读写，一般来说开发自己心里有数，或者用iotop命令来进行定位文件读写的来源。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-10-357d830c76c926c781ba030529da38a7.png" width="1080" height="273"></p>
<p>不过这边拿到的是<code>tid</code>，我们要转换成<code>pid</code>，可以通过<code>readlink</code>来找到<code>pidreadlink -f /proc/*/task/tid/../..</code>。</p>
<p><img alt="img" src="data:image/png;base64,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" width="944" height="84">
找到<code>pid</code>之后就可以看这个进程具体的读写情况<code>cat /proc/pid/io</code></p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-12-21fbc3bf34675fce679683b8f7edcce9.png" width="660" height="282">
我们还可以通过lsof命令来确定具体的文件读写情况<code>lsof -p pid</code></p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-13-718a26444a12f91bc773865fb69b9167.png" width="1080" height="614"></p>
<h2 id="内存">内存</h2>
<p>内存问题排查起来相对比CPU麻烦一些，场景也比较多。主要包括OOM、GC问题和堆外内存。一般来讲，我们会先用<code>free</code>命令先来检查一发内存的各种情况。
<img alt="img" src="/light-docusaurus/assets/images/17-14-519538d6709f55f3b5bcc62d9ad5412f.png" width="1080" height="125"></p>
<h3 id="堆内内存">堆内内存</h3>
<p>内存问题大多还都是堆内内存问题。表象上主要分为<code>OOM</code>和<code>StackOverflow</code>。</p>
<h4 id="oom">OOM</h4>
<p>JMV中的内存不足，<code>OOM</code>大致可以分为以下几种：</p>
<p><code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: unable to create new native thread</code></p>
<p>这个意思是没有足够的内存空间给线程分配java栈，基本上还是线程池代码写的有问题，比如说忘记<code>shutdown</code>，所以说应该首先从代码层面来寻找问题，使用<code>jstack</code>或者<code>jmap</code>。如果一切都正常，JVM方面可以通过指定<code>Xss</code>来减少单个<code>thread stack</code>的大小。</p>
<p>另外也可以在系统层面，可以通过修改<code>/etc/security/limits.confnofile</code>和<code>nproc</code>来增大<code>os</code>对线程的限制</p>
<p><img alt="img" src="data:image/png;base64,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" width="326" height="152">
<code>Exception in thread &quot;main&quot; java.lang.OutOfMemoryError: Java heap space</code></p>
<p>这个意思是堆的内存占用已经达到-Xmx设置的最大值，应该是最常见的OOM错误了。解决思路仍然是先应该在代码中找，怀疑存在内存泄漏，通过jstack和jmap去定位问题。如果说一切都正常，才需要通过调整Xmx的值来扩大内存。</p>
<p><code>Caused by: java.lang.OutOfMemoryError: Meta space</code></p>
<p>这个意思是元数据区的内存占用已经达到<code>-XX:MaxMetaspaceSize</code>设置的最大值，排查思路和上面的一致，参数方面可以通过<code>-XX:MaxPermSize</code>来进行调整(这里就不说1.8以前的永久代了)。</p>
<h4 id="stack-overflow">Stack Overflow</h4>
<p>栈内存溢出，这个大家见到也比较多。</p>
<p><code>Exception in thread &quot;main&quot; java.lang.StackOverflowError</code></p>
<p>表示线程栈需要的内存大于Xss值，同样也是先进行排查，参数方面通过Xss来调整，但调整的太大可能又会引起OOM。</p>
<h3 id="使用jmap定位代码内存泄漏">使用JMAP定位代码内存泄漏</h3>
<p>上述关于OOM和StackOverflow的代码排查方面，我们一般使用JMAP <code>jmap -dump:format=b,file=filename pid</code>来导出dump文件</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-16-24edece2a788768cfc892c2dbbc6cc1c.png" width="742" height="114"></p>
<p>通过<code>mat(Eclipse Memory Analysis Tools)</code>导入<code>dump</code>文件进行分析，内存泄漏问题一般我们直接选<code>Leak Suspects</code>即可，mat给出了内存泄漏的建议。另外也可以选择<code>Top Consumers</code>来查看最大对象报告。</p>
<p>和线程相关的问题可以选择<code>thread overview</code>进行分析。除此之外就是选择<code>Histogram</code>类概览来自己慢慢分析，大家可以搜搜mat的相关教程。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-17-c4f3c9bc7c16770090bdc29ac614a414.png" width="1080" height="833">
日常开发中，代码产生内存泄漏是比较常见的事，并且比较隐蔽，需要开发者更加关注细节。比如说每次请求都new对象，导致大量重复创建对象；进行文件流操作但未正确关闭；手动不当触发gc；ByteBuffer缓存分配不合理等都会造成代码OOM。</p>
<p>另一方面，我们可以在启动参数中指定<code>-XX:+HeapDumpOnOutOfMemoryError</code>来保存OOM时的dump文件。</p>
<h3 id="gc问题和线程">gc问题和线程</h3>
<p>gc问题除了影响cpu也会影响内存，排查思路也是一致的。一般先使用jstat来查看分代变化情况，比如youngGC或者fullGC次数是不是太多呀；EU、OU等指标增长是不是异常呀等。</p>
<p>线程的话太多而且不被及时gc也会引发oom，大部分就是之前说的<code>unable to create new native thread</code>。除了<code>jstack</code>细细分析<code>dump</code>文件外，我们一般先会看下总体线程，通过<code>pstreee -p pid |wc -l</code>。</p>
<p><img alt="img" src="data:image/png;base64,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" width="454" height="72"></p>
<p>或者直接通过查看<code>/proc/pid/task</code>的数量即为线程数量。</p>
<p><img alt="img" src="data:image/png;base64,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" width="518" height="66"></p>
<h3 id="堆外内存">堆外内存</h3>
<p>如果碰到堆外内存溢出，那可真是太不幸了。首先堆外内存溢出表现就是物理常驻内存增长快，报错的话视使用方式都不确定，如果由于使用Netty导致的，那错误日志里可能会出现<code>OutOfDirectMemoryError</code>错误，如果直接是<code>DirectByteBuffer</code>，那会报<code>OutOfMemoryError: Direct buffer memory</code>。</p>
<p>堆外内存溢出往往是和NIO的使用相关，一般我们先通过pmap来查看下进程占用的内存情况<code>pmap -x pid | sort -rn -k3 | head -30</code>，这段意思是查看对应pid倒序前30大的内存段。这边可以再一段时间后再跑一次命令看看内存增长情况，或者和正常机器比较可疑的内存段在哪里。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-20-0b4aeade39cd550fe0d8c92bf613f9b5.png" width="1022" height="1126"></p>
<p>我们如果确定有可疑的内存端，需要通过gdb来分析<code>gdb --batch --pid {pid} -ex &quot;dump memory filename.dump {内存起始地址} {内存起始地址+内存块大小}&quot;</code></p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-21-0c8a4676d17fe16f822c6ed230870150.png" width="1080" height="36"></p>
<p>获取dump文件后可用<code>heaxdump</code>进行查看<code>hexdump -C filename | less</code>，不过大多数看到的都是二进制乱码。</p>
<p>NMT是Java7U40引入的HotSpot新特性，配合jcmd命令我们就可以看到具体内存组成了。需要在启动参数中加入 <code>-XX:NativeMemoryTracking=summary</code> 或者 <code>-XX:NativeMemoryTracking=detail</code>，会有略微性能损耗。</p>
<p>一般对于堆外内存缓慢增长直到爆炸的情况来说，可以先设一个基线<code>jcmd pid VM.native_memory baseline</code>。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-22-1cb0fcec1886969d7c5003e9898f21f6.png" width="690" height="114"></p>
<p>然后等放一段时间后再去看看内存增长的情况，通过<code>jcmd pid VM.native_memory detail.diff(summary.diff)</code>做一下<code>summary</code>或者<code>detail</code>级别的diff。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-23-cc174f6d912a3f590b0ca9645962efcc.png" width="638" height="50">
<img alt="img" src="/light-docusaurus/assets/images/17-24-0f8dbe3496af907398849025130ab450.png" width="1080" height="1125"></p>
<p>可以看到jcmd分析出来的内存十分详细，包括堆内、线程以及gc(所以上述其他内存异常其实都可以用nmt来分析)，这边堆外内存我们重点关注Internal的内存增长，如果增长十分明显的话那就是有问题了。</p>
<p>detail级别的话还会有具体内存段的增长情况，如下图。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-25-05b5adfa8b14630042db14a9c8b1e863.png" width="1080" height="138">
此外在系统层面，我们还可以使用strace命令来监控内存分配 strace -f -e &quot;brk,mmap,munmap&quot; -p pid</p>
<p>这边内存分配信息主要包括了pid和内存地址。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-26-0075ae354a88ec8c75879256f76f631e.jpg" width="1080" height="324"></p>
<p>不过其实上面那些操作也很难定位到具体的问题点，关键还是要看错误日志栈，找到可疑的对象，搞清楚它的回收机制，然后去分析对应的对象。比如DirectByteBuffer分配内存的话，是需要full GC或者手动system.gc来进行回收的(所以最好不要使用-XX:+DisableExplicitGC)。</p>
<p>那么其实我们可以跟踪一下DirectByteBuffer对象的内存情况，通过jmap -histo<!-- -->:live<!-- --> pid手动触发fullGC来看看堆外内存有没有被回收。如果被回收了，那么大概率是堆外内存本身分配的太小了，通过-XX<!-- -->:MaxDirectMemorySize<!-- -->进行调整。如果没有什么变化，那就要使用jmap去分析那些不能被gc的对象，以及和DirectByteBuffer之间的引用关系了。</p>
<h2 id="gc问题">GC问题</h2>
<p>堆内内存泄漏总是和GC异常相伴。不过GC问题不只是和内存问题相关，还有可能引起CPU负载、网络问题等系列并发症，只是相对来说和内存联系紧密些，所以我们在此单独总结一下GC相关问题。</p>
<p>我们在cpu章介绍了使用jstat来获取当前GC分代变化信息。而更多时候，我们是通过GC日志来排查问题的，在启动参数中加上<code>-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps</code>来开启GC日志。</p>
<p>常见的Young GC、Full GC日志含义在此就不做赘述了。</p>
<p>针对gc日志，我们就能大致推断出youngGC与fullGC是否过于频繁或者耗时过长，从而对症下药。我们下面将对G1垃圾收集器来做分析，这边也建议大家使用<code>G1-XX:+UseG1GC</code>。</p>
<h3 id="younggc过频繁">youngGC过频繁</h3>
<p>youngGC频繁一般是短周期小对象较多，先考虑是不是Eden区/新生代设置的太小了，看能否通过调整-Xmn、-XX<!-- -->:SurvivorRatio<!-- -->等参数设置来解决问题。如果参数正常，但是young gc频率还是太高，就需要使用Jmap和MAT对dump文件进行进一步排查了。</p>
<h3 id="younggc耗时过长">youngGC耗时过长</h3>
<p>耗时过长问题就要看GC日志里耗时耗在哪一块了。以G1日志为例，可以关注Root Scanning、Object Copy、Ref Proc等阶段。Ref Proc耗时长，就要注意引用相关的对象。</p>
<p>Root Scanning耗时长，就要注意线程数、跨代引用。Object Copy则需要关注对象生存周期。而且耗时分析它需要横向比较，就是和其他项目或者正常时间段的耗时比较。比如说图中的Root Scanning和正常时间段比增长较多，那就是起的线程太多了。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-27-8c337329cf628676a7560dcc3fc74b5c.png" width="1080" height="790"></p>
<h3 id="触发fullgc">触发fullGC</h3>
<p>G1中更多的还是mixedGC，但mixedGC可以和youngGC思路一样去排查。触发fullGC了一般都会有问题，G1会退化使用Serial收集器来完成垃圾的清理工作，暂停时长达到秒级别，可以说是半跪了。</p>
<p>fullGC的原因可能包括以下这些，以及参数调整方面的一些思路：</p>
<ul>
<li>并发阶段失败：在并发标记阶段，MixGC之前老年代就被填满了，那么这时候G1就会放弃标记周期。这种情况，可能就需要增加堆大小，或者调整并发标记线程数<code>-XX:ConcGCThreads</code>。</li>
<li>晋升失败：在GC的时候没有足够的内存供存活/晋升对象使用，所以触发了Full GC。这时候可以通过<code>-XX:G1ReservePercent</code>来增加预留内存百分比，减少<code>-XX:InitiatingHeapOccupancyPercent</code>来提前启动标记，<code>-XX:ConcGCThreads</code>来增加标记线程数也是可以的。</li>
<li>大对象分配失败：大对象找不到合适的region空间进行分配，就会进行fullGC，这种情况下可以增大内存或者增大<code>-XX:G1HeapRegionSize</code>。</li>
<li>程序主动执行<code>System.gc()</code>：不要随便写就对了。</li>
</ul>
<p>另外，我们可以在启动参数中配置<code>-XX:HeapDumpPath=/xxx/dump.hprof</code>来dump fullGC相关的文件，并通过jinfo来进行gc前后的dump
<code>jinfo -flag +HeapDumpBeforeFullGC pid</code><br>
<code>jinfo -flag +HeapDumpAfterFullGC pid</code></p>
<p>这样得到2份dump文件，对比后主要关注被gc掉的问题对象来定位问题。</p>
<h2 id="网络">网络</h2>
<p>涉及到网络层面的问题一般都比较复杂，场景多，定位难，成为了大多数开发的噩梦，应该是最复杂的了。这里会举一些例子，并从tcp层、应用层以及工具的使用等方面进行阐述。</p>
<h3 id="超时">超时</h3>
<p>超时错误大部分处在应用层面，所以这块着重理解概念。超时大体可以分为连接超时和读写超时，某些使用连接池的客户端框架还会存在获取 连接超时和空闲连接清理超时。</p>
<ul>
<li>读写超时。<code>readTimeout/writeTimeout</code>，有些框架叫做<code>so_timeout</code>或者<code>socketTimeout</code>，均指的是数据读写超时。注意这边的超时大部分是指逻辑上的超时。soa的超时指的也是读超时。读写超时一般都只针对客户端设置。</li>
<li>连接超时。<code>connectionTimeout</code>，客户端通常指与服务端建立连接的最大时间。服务端这边<code>connectionTimeout</code>就有些五花八门了，jetty中表示空闲连接清理时间，tomcat则表示连接维持的最大时间。</li>
<li>其他。包括连接获取超时<code>connectionAcquireTimeout</code>和空闲连接清理超时<code>idleConnectionTimeout</code>。多用于使用连接池或队列的客户端或服务端框架。</li>
</ul>
<p>我们在设置各种超时时间中，需要确认的是尽量保持客户端的超时小于服务端的超时，以保证连接正常结束。
在实际开发中，我们关心最多的应该是接口的读写超时了。
如何设置合理的接口超时是一个问题。如果接口超时设置的过长，那么有可能会过多地占用服务端的tcp连接。而如果接口设置的过短，那么接口超时就会非常频繁。
服务端接口明明rt降低，但客户端仍然一直超时又是另一个问题。这个问题其实很简单，客户端到服务端的链路包括网络传输、排队以及服务处理等，每一个环节都可能是耗时的原因。</p>
<h3 id="tcp队列溢出">TCP队列溢出</h3>
<p>tcp队列溢出是个相对底层的错误，它可能会造成超时、rst等更表层的错误。因此错误也更隐蔽，所以我们单独说一说。
<img alt="img" src="/light-docusaurus/assets/images/17-28-98d5b61853bd2ec848337c16913a8136.jpg" width="1080" height="698"></p>
<p>如上图所示，这里有两个队列：<code>syns queue</code>（半连接队列）、<code>accept queue</code>（全连接队列）。三次握手，在server收到client的syn后，把消息放到<code>syns queue</code>，回复<code>syn+ack</code>给client，server收到client的ack，如果这时<code>accept queue</code>没满，那就从<code>syns queue</code>拿出暂存的信息放入<code>accept queue</code>中，否则按<code>tcp_abort_on_overflow</code>指示的执行。</p>
<ul>
<li><code>tcp_abort_on_overflow 0</code>表示如果三次握手第三步的时候<code>accept queue</code>满了那么server扔掉client发过来的ack。</li>
<li><code>tcp_abort_on_overflow 1</code>则表示第三步的时候如果全连接队列满了，server发送一个rst包给client，表示废掉这个握手过程和这个连接，意味着日志里可能会有很多<code>connection reset / connection reset by peer</code>。</li>
</ul>
<p>那么在实际开发中，我们怎么能快速定位到tcp队列溢出呢？</p>
<h4 id="netstat命令执行netstat--s--egrep-listenlisten"><code>netstat</code>命令，执行<code>netstat -s | egrep &quot;listen|LISTEN&quot;</code></h4>
<p><img alt="img" src="/light-docusaurus/assets/images/17-29-24b6687aa7d007014c661fc9f5b5aa8f.jpg" width="1080" height="117">
如上图所示，<code>overflowed</code>表示全连接队列溢出的次数，<code>sockets dropped</code>表示半连接队列溢出的次数。</p>
<h4 id="ss命令执行ss--lnt"><code>ss</code>命令，执行<code>ss -lnt</code></h4>
<p><img alt="img" src="/light-docusaurus/assets/images/17-30-89456fd375d502ef58aab1f2623769c1.jpg" width="1080" height="93"></p>
<p>上面看到<code>Send-Q</code> 表示第三列的<code>listen</code>端口上的全连接队列最大为5，第一列<code>Recv-Q</code>为全连接队列当前使用了多少。</p>
<p>接着我们看看怎么设置全连接、半连接队列大小吧：</p>
<p>全连接队列的大小取决于<code>min(backlog, somaxconn)</code>。<code>backlog</code>是在<code>socket</code>创建的时候传入的，<code>somaxconn</code>是一个os级别的系统参数。而半连接队列的大小取决于<code>max(64, /proc/sys/net/ipv4/tcp_max_syn_backlog)</code>。</p>
<p>在日常开发中，我们往往使用servlet容器作为服务端，所以我们有时候也需要关注容器的连接队列大小。在tomcat中<code>backlog</code>叫做<code>acceptCount</code>，在jetty里面则是<code>acceptQueueSize</code>。</p>
<h3 id="rst异常">RST异常</h3>
<p>RST包表示连接重置，用于关闭一些无用的连接，通常表示异常关闭，区别于四次挥手。</p>
<p>在实际开发中，我们往往会看到<code>connection reset / connection reset by peer</code>错误，这种情况就是<code>RST</code>包导致的。</p>
<h4 id="端口不存在">端口不存在</h4>
<p>如果像不存在的端口发出建立连接<code>SYN</code>请求，那么服务端发现自己并没有这个端口则会直接返回一个<code>RST</code>报文，用于中断连接。</p>
<h4 id="主动代替fin终止连接">主动代替FIN终止连接</h4>
<p>一般来说，正常的连接关闭都是需要通过FIN报文实现，然而我们也可以用<code>RST</code>报文来代替FIN，表示直接终止连接。实际开发中，可设置SO_LINGER数值来控制，这种往往是故意的，来跳过<code>TIMED_WAIT</code>，提供交互效率，不闲就慎用。</p>
<h4 id="客户端或服务端有一边发生了异常该方向对端发送rst以告知关闭连接">客户端或服务端有一边发生了异常，该方向对端发送<code>RST</code>以告知关闭连接</h4>
<p>我们上面讲的tcp队列溢出发送<code>RST</code>包其实也是属于这一种。这种往往是由于某些原因，一方无法再能正常处理请求连接了(比如程序崩了，队列满了)，从而告知另一方关闭连接。</p>
<h4 id="接收到的tcp报文不在已知的tcp连接内">接收到的TCP报文不在已知的TCP连接内</h4>
<p>比如，一方机器由于网络实在太差TCP报文失踪了，另一方关闭了该连接，然后过了许久收到了之前失踪的TCP报文，但由于对应的TCP连接已不存在，那么会直 接发一个RST包以便开启新的连接。</p>
<h4 id="一方长期未收到另一方的确认报文在一定时间或重传次数后发出rst报文">一方长期未收到另一方的确认报文，在一定时间或重传次数后发出RST报文</h4>
<p>这种大多也和网络环境相关了，网络环境差可能会导致更多的RST报文。</p>
<p>之前说过RST报文多会导致程序报错，在一个已关闭的连接上读操作会报<code>connection reset</code>，而在一个已关闭的连接上写操作则会报<code>connection reset by peer</code>。通常我们可能还会看到<code>broken pipe</code>错误，这是管道层面的错误，表示对已关闭的管道进行读写，往往是在收到RST，报出<code>connection reset</code>错后继续读写数据报的错，这个在<code>glibc</code>源码注释中也有介绍。</p>
<p>我们在排查故障时候怎么确定有RST包的存在呢？当然是使用tcpdump命令进行抓包，并使用wireshark进行简单分析了。<code>tcpdump -i en0 tcp -w xxx.cap</code>，en0表示监听的网卡。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/17-31-b1d1bf31dae0c10d247a85d3dce98c9e.jpg" width="1080" height="69"></p>
<p>接下来我们通过wireshark打开抓到的包，可能就能看到如下图所示，红色的就表示RST包了。
<img alt="img" src="/light-docusaurus/assets/images/17-32-1bac15f23ba7a17676351b7c0bf8204e.jpg" width="1080" height="225"></p>
<h2 id="time_wait和close_wait">TIME_WAIT和CLOSE_WAIT</h2>
<p><code>TIME_WAIT</code>和<code>CLOSE_WAIT</code>是啥意思相信大家都知道。</p>
<p>在线上时，我们可以直接用命令<code>netstat -n | awk &#x27;/^tcp/ {++S[$NF]} END {for(a in S) print a, S[a]}&#x27;</code>来查看<code>time-wait</code>和<code>close_wait</code>的数量</p>
<p>用<code>ss</code>命令会更快<code>ss -ant | awk &#x27;{++S[$1]} END {for(a in S) print a, S[a]}&#x27;</code>
<img alt="img" src="/light-docusaurus/assets/images/17-33-a7de2fe0916c3dd4bd7b91a27dc481a5.png" width="1080" height="131"></p>
<h3 id="time_wait">TIME_WAIT</h3>
<p><code>time_wait</code>的存在一是为了丢失的数据包被后面连接复用，二是为了在2MSL的时间范围内正常关闭连接。它的存在其实会大大减少RST包的出现。
过多的time_wait在短连接频繁的场景比较容易出现。这种情况可以在服务端做一些内核参数调优:</p>
<pre><code class="language-shell"># 表示开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接，默认为0，表示关闭  
net.ipv4.tcp_tw_reuse = 1  
# 表示开启TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭  
net.ipv4.tcp_tw_recycle = 1  
</code></pre>
<p>当然我们不要忘记在NAT环境下因为时间戳错乱导致数据包被拒绝的坑了，另外的办法就是改小<code>tcp_max_tw_buckets</code>，超过这个数的<code>time_wait</code>都会被干掉，不过这也会导致报<code>time wait bucket table overflow</code>的错。</p>
<h3 id="close_wait">CLOSE_WAIT</h3>
<p><code>close_wait</code>往往都是因为应用程序写的有问题，没有在ACK后再次发起FIN报文。<code>close_wait</code>出现的概率甚至比<code>time_wait</code>要更高，后果也更严重。往往是由于某个地方阻塞住了，没有正常关闭连接，从而渐渐地消耗完所有的线程。</p>
<p>想要定位这类问题，最好是通过<code>jstack</code>来分析线程堆栈来排查问题，具体可参考上述章节。这里仅举一个例子。</p>
<p>开发同学说应用上线后<code>CLOSE_WAIT</code>就一直增多，直到挂掉为止，jstack后找到比较可疑的堆栈是大部分线程都卡在了<code>countdownlatch.await</code>方法，找开发同学了解后得知使用了多线程但是确没有<code>catch</code>异常，修改后发现异常仅仅是最简单的升级sdk后常出现的<code>class not found</code>。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/java/17-Java-Error-Check.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/docs/zh-cn/java/Http-Client-Skip-Https-Check/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Http-Client-Skip-Https-Check</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/docs/zh-cn/java/Java-Agent-1/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Java-Agent-1</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cpu" class="table-of-contents__link toc-highlight">CPU</a><ul><li><a href="#使用jstack分析cpu问题" class="table-of-contents__link toc-highlight">使用jstack分析cpu问题</a></li><li><a href="#频繁gc" class="table-of-contents__link toc-highlight">频繁gc</a></li><li><a href="#上下文切换" class="table-of-contents__link toc-highlight">上下文切换</a></li></ul></li><li><a href="#磁盘" class="table-of-contents__link toc-highlight">磁盘</a></li><li><a href="#内存" class="table-of-contents__link toc-highlight">内存</a><ul><li><a href="#堆内内存" class="table-of-contents__link toc-highlight">堆内内存</a></li><li><a href="#使用jmap定位代码内存泄漏" class="table-of-contents__link toc-highlight">使用JMAP定位代码内存泄  漏</a></li><li><a href="#gc问题和线程" class="table-of-contents__link toc-highlight">gc问题和线程</a></li><li><a href="#堆外内存" class="table-of-contents__link toc-highlight">堆外内存</a></li></ul></li><li><a href="#gc问题" class="table-of-contents__link toc-highlight">GC问题</a><ul><li><a href="#younggc过频繁" class="table-of-contents__link toc-highlight">youngGC过频繁</a></li><li><a href="#younggc耗时过长" class="table-of-contents__link toc-highlight">youngGC耗时过长</a></li><li><a href="#触发fullgc" class="table-of-contents__link toc-highlight">触发fullGC</a></li></ul></li><li><a href="#网络" class="table-of-contents__link toc-highlight">网络</a><ul><li><a href="#超时" class="table-of-contents__link toc-highlight">超时</a></li><li><a href="#tcp队列溢出" class="table-of-contents__link toc-highlight">TCP队列溢出</a></li><li><a href="#rst异常" class="table-of-contents__link toc-highlight">RST异常</a></li></ul></li><li><a href="#time_wait和close_wait" class="table-of-contents__link toc-highlight">TIME_WAIT和CLOSE_WAIT</a><ul><li><a href="#time_wait" class="table-of-contents__link toc-highlight">TIME_WAIT</a></li><li><a href="#close_wait" class="table-of-contents__link toc-highlight">CLOSE_WAIT</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>