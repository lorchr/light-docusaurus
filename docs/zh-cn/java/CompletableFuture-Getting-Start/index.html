<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/java/CompletableFuture-Getting-Start" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">CompletableFuture-Getting-Start | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CompletableFuture-Getting-Start | Light Docusaurus"><meta data-rh="true" name="description" content="- 奇淫巧技，CompletableFuture 异步多线程是真的优雅"><meta data-rh="true" property="og:description" content="- 奇淫巧技，CompletableFuture 异步多线程是真的优雅"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.4f186c91.css">
<script src="/light-docusaurus/assets/js/runtime~main.41741ade.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.2e65ac87.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a class="navbar__item navbar__link" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/light-docusaurus/docs/category/java-jvm/">Java (JVM)</a><button aria-label="折叠侧边栏分类 &#x27;Java (JVM)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-AbstractQueuedSynchronizer/">Java-Concurrent-AbstractQueuedSynchronizer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-ReentrantLock/">Java-Concurrent-ReentrantLock</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-Semaphore/">Java-Concurrent-Semaphore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-CountDownlatch/">Java-Concurrent-CountDownlatch</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-CyclicBarrier/">Java-Concurrent-CyclicBarrier</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-ConcurrentHashMap/">Java-Concurrent-ConcurrentHashMap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Concurrent-ThreadPoolExecutor/">Java-Concurrent-ThreadPoolExecutor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/AbstractQueuedSynchronizer-In-Action/">AbstractQueuedSynchronizer-In-Action</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-Getting-Start/">CompletableFuture-Getting-Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-Usage/">CompletableFuture-Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-In-Action/">CompletableFuture-In-Action</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Bytecode-Toolkit-Javassist/">Bytecode-Toolkit-Javassist</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/GC-Exception-Analysis/">GC-Exception-Analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Instrumentation-JavaAgent/">Java-Instrumentation-JavaAgent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/JVM-Stack-And Heap-Dump/">JVM-Stack-And Heap-Dump</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Http-Client-Skip-Https-Check/">Http-Client-Skip-Https-Check</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Error-Check/">Java-Error-Check</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/java/Java-Agent-1/">Java-Agent-1</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/docker/">Docker</a><button aria-label="展开侧 边栏分类 &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/awesome-open-source/">Awesome open source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/docs/category/java-jvm/"><span itemprop="name">Java (JVM)</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CompletableFuture-Getting-Start</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>CompletableFuture-Getting-Start</h1></header><ul>
<li><a href="https://mp.weixin.qq.com/s/dH_AHuDeO_wb0E0MMI0N5g">奇淫巧技，CompletableFuture 异步多线程是真的优雅</a></li>
</ul>
<h2 id="一个示例回顾future">一个示例回顾Future</h2>
<p>一些业务场景我们需要使用多线程异步执行任务，加快任务执行速度。</p>
<p>JDK5新增了Future接口，用于描述一个异步计算的结果。</p>
<p>虽然 <code>Future</code> 以及相关使用方法提供了异步执行任务的能力，但是对于结果的获取却是很不方便，我们必须使用<code>Future.get()</code>的方式阻塞调用线程，或者使用轮询方式判断 <code>Future.isDone</code> 任务是否结束，再获取结果。</p>
<p>这两种处理方式都不是很优雅，相关代码如下:</p>
<pre><code class="language-java">@Test  
public void testFuture() throws ExecutionException, InterruptedException {  
    ExecutorService executorService = Executors.newFixedThreadPool(5);  
    Future&lt;String&gt; future = executorService.submit(() -&gt; {  
        Thread.sleep(2000);  
        return &quot;hello&quot;;  
    });  
    System.out.println(future.get());  
    System.out.println(&quot;end&quot;);  
}
</code></pre>
<p>与此同时，Future无法解决多个异步任务需要相互依赖的场景，简单点说就是，主线程需要等待子线程任务执行完毕之后在进行执行，这个时候你可能想到了<code>CountDownLatch</code>，没错确实可以解决，代码如下。</p>
<p>这里定义两个Future，第一个通过用户id获取用户信息，第二个通过商品id获取商品信息。</p>
<pre><code class="language-java">@Test  
public void testCountDownLatch() throws InterruptedException, ExecutionException {  
    ExecutorService executorService = Executors.newFixedThreadPool(5);  
    CountDownLatch downLatch = new CountDownLatch(2);  
    long startTime = System.currentTimeMillis();  
    Future&lt;String&gt; userFuture = executorService.submit(() -&gt; {  
        //模拟查询商品耗时500毫秒  
        Thread.sleep(500);  
        downLatch.countDown();  
        return &quot;用户A&quot;;  
    });  

    Future&lt;String&gt; goodsFuture = executorService.submit(() -&gt; {  
        //模拟查询商品耗时500毫秒  
        Thread.sleep(400);  
        downLatch.countDown();  
        return &quot;商品A&quot;;  
    });  

    downLatch.await();  
    //模拟主程序耗时时间  
    Thread.sleep(600);  
    System.out.println(&quot;获取用户信息:&quot; + userFuture.get());  
    System.out.println(&quot;获取商品信息:&quot; + goodsFuture.get());  
    System.out.println(&quot;总共用时&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;);  

}  
</code></pre>
<p>「运行结果」</p>
<pre><code class="language-shell">获取用户信息:用户A  
获取商品信息:商品A  
总共用时1110ms  
</code></pre>
<p>从运行结果可以看出结果都已经获取，而且如果我们不用异步操作，执行时间应该是:500+400+600 = 1500，用异步操作后实际只用1110。</p>
<p>但是Java8以后我不在认为这是一种优雅的解决方式，接下来来了解下<code>CompletableFuture</code>的使用。</p>
<h2 id="通过completablefuture实现上面示例">通过CompletableFuture实现上面示例</h2>
<pre><code class="language-java">@Test  
public void testCompletableInfo() throws InterruptedException, ExecutionException {  
    long startTime = System.currentTimeMillis();  

      //调用用户服务获取用户基本信息  
      CompletableFuture&lt;String&gt; userFuture = CompletableFuture.supplyAsync(() -&gt;  
              //模拟查询商品耗时500毫秒  
      {  
          try {  
              Thread.sleep(500);  
          } catch (InterruptedException e) {  
              e.printStackTrace();  
          }  
          return &quot;用户A&quot;;  
      });  

      //调用商品服务获取商品基本信息  
      CompletableFuture&lt;String&gt; goodsFuture = CompletableFuture.supplyAsync(() -&gt;  
              //模拟查询商品耗时500毫秒  
      {  
          try {  
              Thread.sleep(400);  
          } catch (InterruptedException e) {  
              e.printStackTrace();  
          }  
          return &quot;商品A&quot;;  
      });  

      System.out.println(&quot;获取用户信息:&quot; + userFuture.get());  
      System.out.println(&quot;获取商品信息:&quot; + goodsFuture.get());  

      //模拟主程序耗时时间  
      Thread.sleep(600);  
      System.out.println(&quot;总共用时&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;);  
}
</code></pre>
<p>运行结果</p>
<pre><code class="language-shell">获取用户信息:用户A  
获取商品信息:商品A  
总共用时1112ms  
</code></pre>
<p>通过CompletableFuture可以很轻松的实现CountDownLatch的功能，你以为这就结束了，远远不止，CompletableFuture比这要强多了。</p>
<p>比如可以实现：任务1执行完了再执行任务2,甚至任务1执行的结果，作为任务2的入参数等等强大功能，下面就来学学CompletableFuture的API。</p>
<h2 id="completablefuture创建方式">CompletableFuture创建方式</h2>
<h3 id="1常用的4种创建方式">1、常用的4种创建方式</h3>
<p>CompletableFuture源码中有四个静态方法用来执行异步任务</p>
<ol>
<li><code>public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier){..}</code></li>
<li><code>public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier,Executor executor){..}</code></li>
<li><code>public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable){..}</code></li>
<li><code>public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable,Executor executor){..}</code></li>
</ol>
<p>一般我们用上面的静态方法来创建CompletableFuture，这里也解释下他们的区别:</p>
<ul>
<li>「supplyAsync」执行任务，支持返回值。</li>
<li>「runAsync」执行任务，没有返回值。</li>
<li>「supplyAsync方法」</li>
</ul>
<pre><code class="language-java">//使用默认内置线程池ForkJoinPool.commonPool()，根据supplier构建执行任务  
public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier)  
//自定义线程，根据supplier构建执行任务  
public static &lt;U&gt; CompletableFuture&lt;U&gt; supplyAsync(Supplier&lt;U&gt; supplier, Executor executor)  
</code></pre>
<ul>
<li>「runAsync方法」</li>
</ul>
<pre><code class="language-java">//使用默认内置线程池ForkJoinPool.commonPool()，根据runnable构建执行任务  
public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable)   
//自定义线程，根据runnable构建执行任务  
public static CompletableFuture&lt;Void&gt; runAsync(Runnable runnable,  Executor executor)  
</code></pre>
<h3 id="2结果获取的4种方式">2、结果获取的4种方式</h3>
<p>对于结果的获取CompltableFuture类提供了四种方式</p>
<pre><code class="language-java">//方式一  
public T get()  
//方式二  
public T get(long timeout, TimeUnit unit)  
//方式三  
public T getNow(T valueIfAbsent)  
//方式四  
public T join()  
</code></pre>
<p>说明：</p>
<ul>
<li>「get()和<code>get(long timeout, TimeUnit unit)</code>」 =&gt; 在Future中就已经提供了，后者提供超时处理，如果在指定时间内未获取结果将抛出超时异常</li>
<li>「getNow」 =&gt; 立即获取结果不阻塞，结果计算已完成将返回结果或计算过程中的异常，如果未计算完成将返回设定的valueIfAbsent值</li>
<li>「join」 =&gt; 方法里不会抛出异常</li>
</ul>
<p>示例：</p>
<pre><code class="language-java">@Test  
public void testCompletableGet() throws InterruptedException, ExecutionException {  

    CompletableFuture&lt;String&gt; cp1 = CompletableFuture.supplyAsync(() -&gt; {  
        try {  
            Thread.sleep(1000);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
        return &quot;商品A&quot;;  
    });  

    // getNow方法测试   
    System.out.println(cp1.getNow(&quot;商品B&quot;));  

    //join方法测试   
    CompletableFuture&lt;Integer&gt; cp2 = CompletableFuture.supplyAsync((() -&gt; 1 / 0));  
    System.out.println(cp2.join());  
   System.out.println(&quot;-----------------------------------------------------&quot;);  
    //get方法测试  
    CompletableFuture&lt;Integer&gt; cp3 = CompletableFuture.supplyAsync((() -&gt; 1 / 0));  
    System.out.println(cp3.get());  
}
</code></pre>
<p>「运行结果」：</p>
<ul>
<li>
<p>第一个执行结果为 「商品B」，因为要先睡上1秒结果不能立即获取</p>
</li>
<li>
<p>join方法获取结果方法里不会抛异常，但是执行结果会抛异常，抛出的异常为CompletionException</p>
</li>
<li>
<p>get方法获取结果方法里将抛出异常，执行结果抛出的异常为ExecutionException</p>
</li>
</ul>
<h2 id="异步回调方法">异步回调方法</h2>
<p>图片</p>
<h3 id="1thenrunthenrunasync">1、thenRun/thenRunAsync</h3>
<p>通俗点讲就是，「做完第一个任务后，再做第二个任务,第二个任务也没有返回值」。</p>
<p>示例</p>
<pre><code class="language-java">@Test  
public void testCompletableThenRunAsync() throws InterruptedException, ExecutionException {  
    long startTime = System.currentTimeMillis();  
      
    CompletableFuture&lt;Void&gt; cp1 = CompletableFuture.runAsync(() -&gt; {  
        try {  
            //执行任务A  
            Thread.sleep(600);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  

    });  

    CompletableFuture&lt;Void&gt; cp2 =  cp1.thenRun(() -&gt; {  
        try {  
            //执行任务B  
            Thread.sleep(400);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
    });  

    // get方法测试  
    System.out.println(cp2.get());  

    //模拟主程序耗时时间  
    Thread.sleep(600);  
    System.out.println(&quot;总共用时&quot; + (System.currentTimeMillis() - startTime) + &quot;ms&quot;);  
}  
//运行结果    
/**  
 *  null  
 *  总共用时1610ms  
 */  
</code></pre>
<h3 id="thenrun-和thenrunasync有什么区别呢">「thenRun 和thenRunAsync有什么区别呢？」</h3>
<p>如果你执行第一个任务的时候，传入了一个自定义线程池：</p>
<ul>
<li>调用thenRun方法执行第二个任务时，则第二个任务和第一个任务是共用同一个线程池。</li>
<li>调用thenRunAsync执行第二个任务时，则第一个任务使用的是你自己传入的线程池，第二个任务使用的是ForkJoin线程池。</li>
</ul>
<p><strong>说明:</strong> 后面介绍的thenAccept和thenAcceptAsync，thenApply和thenApplyAsync等，它们之间的区别也是这个。</p>
<h3 id="2thenacceptthenacceptasync">2、thenAccept/thenAcceptAsync</h3>
<p>第一个任务执行完成后，执行第二个回调方法任务，会将该任务的执行结果，作为入参，传递到回调方法中，但是回调方法是没有返回值的。</p>
<p>示例</p>
<pre><code class="language-java">@Test  
public void testCompletableThenAccept() throws ExecutionException, InterruptedException {  
    long startTime = System.currentTimeMillis();  
    CompletableFuture&lt;String&gt; cp1 = CompletableFuture.supplyAsync(() -&gt; {  
        return &quot;dev&quot;;  

    });  
    CompletableFuture&lt;Void&gt; cp2 =  cp1.thenAccept((a) -&gt; {  
        System.out.println(&quot;上一个任务的返回结果为: &quot; + a);  
    });  
   
    cp2.get();  
}  
</code></pre>
<h3 id="3-thenapplythenapplyasync">3、 thenApply/thenApplyAsync</h3>
<p>表示第一个任务执行完成后，执行第二个回调方法任务，会将该任务的执行结果，作为入参，传递到回调方法中，并且回调方法是有返回值的。</p>
<p>示例</p>
<pre><code class="language-java">@Test  
public void testCompletableThenApply() throws ExecutionException, InterruptedException {  
    CompletableFuture&lt;String&gt; cp1 = CompletableFuture.supplyAsync(() -&gt; {  
        return &quot;dev&quot;;  

    }).thenApply((a) -&gt; {  
        if(Objects.equals(a,&quot;dev&quot;)){  
            return &quot;dev&quot;;  
        }  
        return &quot;prod&quot;;  
    });  

    System.out.println(&quot;当前环境为:&quot; + cp1.get());  

    //输出: 当前环境为:dev  
}  
</code></pre>
<h2 id="异常回调">异常回调</h2>
<p>当CompletableFuture的任务不论是正常完成还是出现异常它都会调用 「whenComplete」这回调函数。</p>
<ul>
<li>「正常完成」：whenComplete返回结果和上级任务一致，异常为null；</li>
<li>「出现异常」：whenComplete返回结果为null，异常为上级任务的异常；</li>
</ul>
<p>即调用<code>get()</code>时，正常完成时就获取到结果，出现异常时就会抛出异常，需要你处理该异常。</p>
<p>下面来看看示例</p>
<h3 id="1只用whencomplete">1、只用whenComplete</h3>
<pre><code class="language-java">@Test  
public void testCompletableWhenComplete() throws ExecutionException, InterruptedException {  
    CompletableFuture&lt;Double&gt; future = CompletableFuture.supplyAsync(() -&gt; {  

        if (Math.random() &lt; 0.5) {  
            throw new RuntimeException(&quot;出错了&quot;);  
        }  
        System.out.println(&quot;正常结束&quot;);  
        return 0.11;  

    }).whenComplete((aDouble, throwable) -&gt; {  
        if (aDouble == null) {  
            System.out.println(&quot;whenComplete aDouble is null&quot;);  
        } else {  
            System.out.println(&quot;whenComplete aDouble is &quot; + aDouble);  
        }  
        if (throwable == null) {  
            System.out.println(&quot;whenComplete throwable is null&quot;);  
        } else {  
            System.out.println(&quot;whenComplete throwable is &quot; + throwable.getMessage());  
        }  
    });  
    System.out.println(&quot;最终返回的结果 = &quot; + future.get());  
} 
</code></pre>
<p>正常完成，没有异常时：</p>
<pre><code class="language-shell">正常结束  
whenComplete aDouble is 0.11  
whenComplete throwable is null  
最终返回的结果 = 0.11  
</code></pre>
<p>出现异常时：get()会抛出异常</p>
<pre><code class="language-shell">whenComplete aDouble is null  
whenComplete throwable is java.lang.RuntimeException: 出错了  
  
java.util.concurrent.ExecutionException: java.lang.RuntimeException: 出错了  
 at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)  
 at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)  
</code></pre>
<h3 id="2whencomplete--exceptionally示例">2、whenComplete + exceptionally示例</h3>
<pre><code class="language-java">@Test  
public void testWhenCompleteExceptionally() throws ExecutionException, InterruptedException {  
    CompletableFuture&lt;Double&gt; future = CompletableFuture.supplyAsync(() -&gt; {  
        if (Math.random() &lt; 0.5) {  
            throw new RuntimeException(&quot;出错了&quot;);  
        }  
        System.out.println(&quot;正常结束&quot;);  
        return 0.11;  

    }).whenComplete((aDouble, throwable) -&gt; {  
        if (aDouble == null) {  
            System.out.println(&quot;whenComplete aDouble is null&quot;);  
        } else {  
            System.out.println(&quot;whenComplete aDouble is &quot; + aDouble);  
        }  
        if (throwable == null) {  
            System.out.println(&quot;whenComplete throwable is null&quot;);  
        } else {  
            System.out.println(&quot;whenComplete throwable is &quot; + throwable.getMessage());  
        }  
    }).exceptionally((throwable) -&gt; {  
        System.out.println(&quot;exceptionally中异常：&quot; + throwable.getMessage());  
        return 0.0;  
    });  

    System.out.println(&quot;最终返回的结果 = &quot; + future.get());  
} 
</code></pre>
<p>当出现异常时，exceptionally中会捕获该异常，给出默认返回值0.0。</p>
<pre><code class="language-shell">whenComplete aDouble is null  
whenComplete throwable is java.lang.RuntimeException: 出错了  
exceptionally中异常：java.lang.RuntimeException: 出错了  
最终返回的结果 = 0.0  
</code></pre>
<h2 id="多任务组合回调">多任务组合回调</h2>
<p>图片</p>
<h3 id="1and组合关系">1、AND组合关系</h3>
<p>thenCombine / thenAcceptBoth / runAfterBoth都表示：「当任务一和任务二都完成再执行任务三」。</p>
<p>区别在于：</p>
<ul>
<li>「runAfterBoth」 不会把执行结果当做方法入参，且没有返回值</li>
<li>「thenAcceptBoth」: 会将两个任务的执行结果作为方法入参，传递到指定方法中，且无返回值</li>
<li>「thenCombine」：会将两个任务的执行结果作为方法入参，传递到指定方法中，且有返回值</li>
</ul>
<p>示例</p>
<pre><code class="language-java">@Test  
public void testCompletableThenCombine() throws ExecutionException, InterruptedException {  
    //创建线程池  
    ExecutorService executorService = Executors.newFixedThreadPool(10);  
    //开启异步任务1  
    CompletableFuture&lt;Integer&gt; task = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务1，当前线程是：&quot; + Thread.currentThread().getId());  
        int result = 1 + 1;  
        System.out.println(&quot;异步任务1结束&quot;);  
        return result;  
    }, executorService);  

    //开启异步任务2  
    CompletableFuture&lt;Integer&gt; task2 = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务2，当前线程是：&quot; + Thread.currentThread().getId());  
        int result = 1 + 1;  
        System.out.println(&quot;异步任务2结束&quot;);  
        return result;  
    }, executorService);  

    //任务组合  
    CompletableFuture&lt;Integer&gt; task3 = task.thenCombineAsync(task2, (f1, f2) -&gt; {  
        System.out.println(&quot;执行任务3，当前线程是：&quot; + Thread.currentThread().getId());  
        System.out.println(&quot;任务1返回值：&quot; + f1);  
        System.out.println(&quot;任务2返回值：&quot; + f2);  
        return f1 + f2;  
    }, executorService);  

    Integer res = task3.get();  
    System.out.println(&quot;最终结果：&quot; + res);  
}
</code></pre>
<p>「运行结果」</p>
<pre><code class="language-shell">异步任务1，当前线程是：17  
异步任务1结束  
异步任务2，当前线程是：18  
异步任务2结束  
执行任务3，当前线程是：19  
任务1返回值：2  
任务2返回值：2  
最终结果：4  
</code></pre>
<h3 id="2or组合关系">2、OR组合关系</h3>
<p>applyToEither / acceptEither / runAfterEither 都表示：「两个任务，只要有一个任务完成，就执行任务三」。</p>
<p>区别在于：</p>
<ul>
<li>「runAfterEither」：不会把执行结果当做方法入参，且没有返回值</li>
<li>「acceptEither」: 会将已经执行完成的任务，作为方法入参，传递到指定方法中，且无返回值</li>
<li>「applyToEither」：会将已经执行完成的任务，作为方法入参，传递到指定方法中，且有返回值</li>
</ul>
<p>示例</p>
<pre><code class="language-java">@Test  
public void testCompletableEitherAsync() {  
    //创建线程池  
    ExecutorService executorService = Executors.newFixedThreadPool(10);  
    //开启异步任务1  
    CompletableFuture&lt;Integer&gt; task = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务1，当前线程是：&quot; + Thread.currentThread().getId());  

        int result = 1 + 1;  
        System.out.println(&quot;异步任务1结束&quot;);  
        return result;  
    }, executorService);  

    //开启异步任务2  
    CompletableFuture&lt;Integer&gt; task2 = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务2，当前线程是：&quot; + Thread.currentThread().getId());  
        int result = 1 + 2;  
        try {  
            Thread.sleep(3000);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
        System.out.println(&quot;异步任务2结束&quot;);  
        return result;  
    }, executorService);  

    //任务组合  
    task.acceptEitherAsync(task2, (res) -&gt; {  
        System.out.println(&quot;执行任务3，当前线程是：&quot; + Thread.currentThread().getId());  
        System.out.println(&quot;上一个任务的结果为：&quot;+res);  
    }, executorService);  
}  
</code></pre>
<p>运行结果</p>
<pre><code class="language-shell">//通过结果可以看出，异步任务2都没有执行结束，任务3获取的也是1的执行结果  
异步任务1，当前线程是：17  
异步任务1结束  
异步任务2，当前线程是：18  
执行任务3，当前线程是：19  
上一个任务的结果为：2  
</code></pre>
<p><strong>注意</strong></p>
<p>如果把上面的核心线程数改为1也就是</p>
<pre><code class="language-java">ExecutorService executorService = Executors.newFixedThreadPool(1);  
</code></pre>
<p>运行结果就是下面的了，会发现根本没有执行任务3，显然是任务3直接被丢弃了。</p>
<pre><code class="language-shell">异步任务1，当前线程是：17  
异步任务1结束  
异步任务2，当前线程是：17  
</code></pre>
<h3 id="3多任务组合">3、多任务组合</h3>
<ul>
<li>「allOf」：等待所有任务完成</li>
<li>「anyOf」：只要有一个任务完成</li>
</ul>
<p>示例</p>
<p>allOf：等待所有任务完成</p>
<pre><code class="language-java">@Test  
public void testCompletableAallOf() throws ExecutionException, InterruptedException {  
    //创建线程池  
    ExecutorService executorService = Executors.newFixedThreadPool(10);  
    //开启异步任务1  
    CompletableFuture&lt;Integer&gt; task = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务1，当前线程是：&quot; + Thread.currentThread().getId());  
        int result = 1 + 1;  
        System.out.println(&quot;异步任务1结束&quot;);  
        return result;  
    }, executorService);  

    //开启异步任务2  
    CompletableFuture&lt;Integer&gt; task2 = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务2，当前线程是：&quot; + Thread.currentThread().getId());  
        int result = 1 + 2;  
        try {  
            Thread.sleep(3000);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
        System.out.println(&quot;异步任务2结束&quot;);  
        return result;  
    }, executorService);  

    //开启异步任务3  
    CompletableFuture&lt;Integer&gt; task3 = CompletableFuture.supplyAsync(() -&gt; {  
        System.out.println(&quot;异步任务3，当前线程是：&quot; + Thread.currentThread().getId());  
        int result = 1 + 3;  
        try {  
            Thread.sleep(4000);  
        } catch (InterruptedException e) {  
            e.printStackTrace();  
        }  
        System.out.println(&quot;异步任务3结束&quot;);  
        return result;  
    }, executorService);  

    //任务组合  
    CompletableFuture&lt;Void&gt; allOf = CompletableFuture.allOf(task, task2, task3);  

    //等待所有任务完成  
    allOf.get();  
    //获取任务的返回结果  
    System.out.println(&quot;task结果为：&quot; + task.get());  
    System.out.println(&quot;task2结果为：&quot; + task2.get());  
    System.out.println(&quot;task3结果为：&quot; + task3.get());  
}  
</code></pre>
<p>anyOf: 只要有一个任务完成</p>
<pre><code class="language-java">@Test  
public void testCompletableAnyOf() throws ExecutionException, InterruptedException {  
    //创建线程池  
    ExecutorService executorService = Executors.newFixedThreadPool(10);  
    //开启异步任务1  
    CompletableFuture&lt;Integer&gt; task = CompletableFuture.supplyAsync(() -&gt; {  
        int result = 1 + 1;  
        return result;  
    }, executorService);  

    //开启异步任务2  
    CompletableFuture&lt;Integer&gt; task2 = CompletableFuture.supplyAsync(() -&gt; {  
        int result = 1 + 2;  
        return result;  
    }, executorService);  

    //开启异步任务3  
    CompletableFuture&lt;Integer&gt; task3 = CompletableFuture.supplyAsync(() -&gt; {  
        int result = 1 + 3;  
        return result;  
    }, executorService);  

    //任务组合  
    CompletableFuture&lt;Object&gt; anyOf = CompletableFuture.anyOf(task, task2, task3);  
    //只要有一个有任务完成  
    Object o = anyOf.get();  
    System.out.println(&quot;完成的任务的结果：&quot; + o);  
}  
</code></pre>
<h2 id="completablefuture使用有哪些注意点">CompletableFuture使用有哪些注意点</h2>
<p>图片
<code>CompletableFuture</code> 使我们的异步编程更加便利的、代码更加优雅的同时，我们也要关注下它，使用的一些注意点。</p>
<h3 id="1future需要获取返回值才能获取异常信息">1、Future需要获取返回值，才能获取异常信息</h3>
<pre><code class="language-java">@Test  
public void testWhenCompleteExceptionally() {  
    CompletableFuture&lt;Double&gt; future = CompletableFuture.supplyAsync(() -&gt; {  
        if (1 == 1) {  
            throw new RuntimeException(&quot;出错了&quot;);  
        }  
        return 0.11;  
    });  

    //如果不加 get()方法这一行，看不到异常信息  
    //future.get();  
} 
</code></pre>
<p><code>Future</code>需要获取返回值，才能获取到异常信息。如果不加 <code>get()</code>/<code>join()</code>方法，看不到异常信息。</p>
<p>小伙伴们使用的时候，注意一下哈,考虑是否加<code>try...catch...</code>或者使用<code>exceptionally</code>方法。</p>
<h3 id="2completablefuture的get方法是阻塞的">2、CompletableFuture的get()方法是阻塞的</h3>
<p><code>CompletableFuture</code>的<code>get()</code>方法是阻塞的，如果使用它来获取异步调用的返回值，需要添加超时时间。</p>
<pre><code class="language-java">//反例  
 CompletableFuture.get();  
//正例  
CompletableFuture.get(5, TimeUnit.SECONDS); 
</code></pre>
<h3 id="3不建议使用默认线程池">3、不建议使用默认线程池</h3>
<p><code>CompletableFuture</code>代码中又使用了默认的 「ForkJoin线程池」，处理的线程个数是电脑 「CPU核数-1」。在大量请求过来的时候，处理逻辑复杂的话，响应会很慢。一般建议使用自定义线程池，优化线程池配置参数。</p>
<h3 id="4自定义线程池时注意饱和策略">4、自定义线程池时，注意饱和策略</h3>
<p><code>CompletableFuture</code>的<code>get()</code>方法是阻塞的，我们一般建议使用<code>future.get(5, TimeUnit.SECONDS)</code>。并且一般建议使用自定义线程池。</p>
<p>但是如果线程池拒绝策略是<code>DiscardPolicy</code>或者<code>DiscardOldestPolicy</code>，当线程池饱和时，会直接丢弃任务，不会抛弃异常。因此建议，<code>CompletableFuture</code>线程池策略最好使用<code>AbortPolicy</code>，然后耗时的异步线程，做好线程池隔离哈。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/java/9-CompletableFuture-Getting-Start.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/docs/zh-cn/java/AbstractQueuedSynchronizer-In-Action/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">AbstractQueuedSynchronizer-In-Action</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/docs/zh-cn/java/CompletableFuture-Usage/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">CompletableFuture-Usage</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一个示例回顾future" class="table-of-contents__link toc-highlight">一个示例回顾Future</a></li><li><a href="#通过completablefuture实现上面示例" class="table-of-contents__link toc-highlight">通过CompletableFuture实现上面示例</a></li><li><a href="#completablefuture创建方式" class="table-of-contents__link toc-highlight">CompletableFuture创建方式</a><ul><li><a href="#1常用的4种创建方式" class="table-of-contents__link toc-highlight">1、常用的4种创建方式</a></li><li><a href="#2结果获取的4种方式" class="table-of-contents__link toc-highlight">2、结果获取的4种方式</a></li></ul></li><li><a href="#异步回调方法" class="table-of-contents__link toc-highlight">异步回调方法</a><ul><li><a href="#1thenrunthenrunasync" class="table-of-contents__link toc-highlight">1、thenRun/thenRunAsync</a></li><li><a href="#thenrun-和thenrunasync有什么区别呢" class="table-of-contents__link toc-highlight">「thenRun 和thenRunAsync有什么区别呢？」</a></li><li><a href="#2thenacceptthenacceptasync" class="table-of-contents__link toc-highlight">2、thenAccept/thenAcceptAsync</a></li><li><a href="#3-thenapplythenapplyasync" class="table-of-contents__link toc-highlight">3、 thenApply/thenApplyAsync</a></li></ul></li><li><a href="#异常回调" class="table-of-contents__link toc-highlight">异常回调</a><ul><li><a href="#1只用whencomplete" class="table-of-contents__link toc-highlight">1、只用whenComplete</a></li><li><a href="#2whencomplete--exceptionally示例" class="table-of-contents__link toc-highlight">2、whenComplete + exceptionally示例</a></li></ul></li><li><a href="#多任务组合回调" class="table-of-contents__link toc-highlight">多任务组合回调</a><ul><li><a href="#1and组合关系" class="table-of-contents__link toc-highlight">1、AND组合关系</a></li><li><a href="#2or组合关系" class="table-of-contents__link toc-highlight">2、OR组合关系</a></li><li><a href="#3多任务组合" class="table-of-contents__link toc-highlight">3、多任务组合</a></li></ul></li><li><a href="#completablefuture使用有哪些注意点" class="table-of-contents__link toc-highlight">CompletableFuture使用有哪些注意点</a><ul><li><a href="#1future需要获取返回值才能获取异常信息" class="table-of-contents__link toc-highlight">1、Future需要获取返回值，才能获取异常信息</a></li><li><a href="#2completablefuture的get方法是阻塞的" class="table-of-contents__link toc-highlight">2、CompletableFuture的get()方法是阻塞的</a></li><li><a href="#3不建议使用默认线程池" class="table-of-contents__link toc-highlight">3、不建议使用默认线程池</a></li><li><a href="#4自定义线程池时注意饱和策略" class="table-of-contents__link toc-highlight">4、自定义线程池时，注意饱和策略</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>