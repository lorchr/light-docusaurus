<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/active-directory/Install-AD-DS" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Install-AD-DS | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/docs/zh-cn/active-directory/Install-AD-DS/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Install-AD-DS | Light Docusaurus"><meta data-rh="true" name="description" content="- Active Directory 域服务概述"><meta data-rh="true" property="og:description" content="- Active Directory 域服务概述"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/active-directory/Install-AD-DS/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/active-directory/Install-AD-DS/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/active-directory/Install-AD-DS/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.609e5209.css">
<script src="/light-docusaurus/assets/js/runtime~main.c76c40a0.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.4a0c9925.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a class="navbar__item navbar__link" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/docs/zh-cn/active-directory/Install-AD-DS/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/light-docusaurus/docs/category/active-directory/">Active Directory</a><button aria-label="折叠侧边栏分类 &#x27;Active Directory&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/docs/zh-cn/active-directory/Install-AD-DS/">Install-AD-DS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/active-directory/Tomcat-Integrate-Windows-Authentication-With-Spnego/">Tomcat-Integrate-Windows-Authentication-With-Spnego</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/awesome-open-source/">Awesome open source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/docs/category/active-directory/"><span itemprop="name">Active Directory</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Install-AD-DS</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Install-AD-DS</h1></header><ul>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">Active Directory 域服务概述</a></li>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/security/windows-authentication/windows-authentication-overview">Windows 身份验证概述</a></li>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/security/windows-authentication/windows-logon-scenarios">Windows 登录方案</a></li>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/identity/ad-fs/deployment/configure-a-federation-server#configure-the-first-federation-server-in-a-new-federation-server-farm">配置新联合服务器场中的第一台联合服务器</a></li>
<li><a href="https://blog.csdn.net/qq_74285286/article/details/130180775">如何在windows server 2016上设置域控制器并验证</a></li>
<li><a href="https://blog.51cto.com/u_16230257/7136375">部署：AD FS联合身份验证</a></li>
</ul>
<h2 id="一安装系统">一、安装系统</h2>
<p>系统配置如下，具体安装过程略过。</p>
<ul>
<li>Windows Server 2019: 8C8G</li>
<li>Account:<!-- -->
<ul>
<li>Administrator / Admin123</li>
</ul>
</li>
</ul>
<p>激活密钥</p>
<pre><code class="language-shell"># 卸载密钥
slmgr /upk
# 安装密钥
slmgr /ipk WMDGN-G9PQG-XVVXX-R3X43-63DFG
# 设置 KMS服务器
slmgr /skms kms.03k.org
# 激活  需要等待
slmgr /ato
# 激活查看指令
slmgr /xpr
</code></pre>
<p>域名规划</p>
<ul>
<li>域地址:         dev.local</li>
<li>AD域服务器:     win-dc01.dev.local</li>
<li>Tomcat服务器:   win-tc01.dev.local</li>
<li>客户端:         win-pc01.dev.local</li>
</ul>
<p><strong>注意:</strong> 如果是虚拟机安装，最好将网络改为桥接，否则外部的计算机无法添加到域中</p>
<h2 id="二安装ad域服务器">二、安装AD域服务器</h2>
<ul>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview">Active Directory 域服务概述</a></li>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/security/windows-authentication/windows-authentication-overview">Windows 身份验证概述</a></li>
<li><a href="https://learn.microsoft.com/zh-cn/windows-server/security/windows-authentication/windows-logon-scenarios">Windows 登录方案</a></li>
<li><a href="https://blog.csdn.net/qq_74285286/article/details/130180775">如何在windows server 2016上设置域控制器并验证</a></li>
</ul>
<h3 id="1-安装ad域服务">1. 安装AD域服务</h3>
<p>点击【开始】-【服务器管理】</p>
<p><img src="/light-docusaurus/assets/images/1-3a8480e5023e0e94923ebcbccea9d0f7.png" width="1151" height="865"></p>
<p>选择【添加角色和功能】</p>
<p><img src="/light-docusaurus/assets/images/2-01696a7d9ef320aea2985f0b4c3f4632.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/3-9b1b834d5726cb720fd96b6f974ced63.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/4-7dddce019149302f5df3834e6741b6ca.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/5-ccec06307be7989cc67a0b2e8dc23c0d.png" width="1151" height="865"></p>
<p>勾选【Active Directory 域服务】，点击下一步</p>
<p><img src="/light-docusaurus/assets/images/6-f37e04bf78eeb3fb8cba4b157611536d.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/7-cbef79b069218d049b52e11f4a736271.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/8-0b1008055b58f5d0f7cdaf845c5c470d.png" width="1151" height="865"></p>
<p>点击【安装】</p>
<p><img src="/light-docusaurus/assets/images/9-9e42b19458df2dd4611adbda15178daf.png" width="1151" height="865"></p>
<p>安装进行中</p>
<p><img src="/light-docusaurus/assets/images/10-03a98854bffa17bba5b5572b489b424e.png" width="1151" height="865"></p>
<p>安装完成，点击【将此服务器提升为域控制器】</p>
<p><img src="/light-docusaurus/assets/images/11-0a47b5131788090f7f91fea92d50dba4.png" width="1151" height="865"></p>
<h3 id="2-将服务器提升为域控制器">2. 将服务器提升为域控制器</h3>
<p>在这里需要明白几个概念：</p>
<ol>
<li>将域控制器添加到现有林：可向现有域添加第二台或是更多域控制器，不过前提是要先有一个域</li>
<li>将新域添加到现有林：在现有林中创建现有域的子域，注意，一个林中有多个树，树有多个域</li>
<li>添加新林：新建全新的域，这里注意一下，如果是第一次安装域控制器，建议选择添加到新林</li>
</ol>
<p>勾选【添加林】，输入域名称 <code>dev.local</code></p>
<p><img src="/light-docusaurus/assets/images/12-7937a3f9bed28f379049fcebaf3a785a.png" width="1151" height="865"></p>
<p>设置AD域服务还原密码 Admin123</p>
<p><img src="/light-docusaurus/assets/images/13-24466e811e0be8cf29d37f322a3ab100.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/14-1c16034a6967782962be2dbee94a359f.png" width="1151" height="865"></p>
<p>NetBIOS域名默认即可，有需要可以修改</p>
<p><img src="/light-docusaurus/assets/images/15-582e0786abed88a2295564bf6876be22.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/16-6c569e2324a62169e7e319f2206a4bb3.png" width="1151" height="865"></p>
<p>下一步</p>
<p><img src="/light-docusaurus/assets/images/17-8b07d1ff996c8d72a7410169db20e45e.png" width="1151" height="865"></p>
<p>先决条件检查完毕后，点击【安装】</p>
<p><img src="/light-docusaurus/assets/images/18-c14d1cebfbf4b8f8f59de4af47d157f3.png" width="1151" height="865"></p>
<p>安装完成后计算机将会自动重启</p>
<p><img src="/light-docusaurus/assets/images/19-45c37a3c5e84ab67a5e86163c31c256a.png" width="1151" height="865"></p>
<p>可以看到，【服务器管理】上多了 【AD DS】及【DNS】两个服务</p>
<p><img src="/light-docusaurus/assets/images/20-63643506376a82c1b63066139c5d449d.png" width="1151" height="865"></p>
<p>后续所有加入到此AD域的计算机，都需要AD域来分配IP，测试时可以手动修改计算机的DNS为AD域的IP</p>
<h3 id="3-更改目标服务器">3. 更改目标服务器</h3>
<p>目标服务器即主机名，AD域的域名，默认为一串乱码 <code>WIN-FO87FA2R38O</code></p>
<p>依次点击【本地服务器】-【主机名】-【更改】，修改计算机名称，点击【确定】</p>
<p><img src="/light-docusaurus/assets/images/21-d9b9e7df48564f4b8c1c57ab8fc09a63.png" width="1151" height="865"></p>
<p>最后重启</p>
<p><img src="/light-docusaurus/assets/images/22-e2a3697644cf80df624afe04a0d284e1.png" width="1151" height="865"></p>
<p><strong>注意</strong> 此操作是在域控制器安装完，进行的操作，所以，此时无法选择隶属那个域，而是系统默认，不过默认的一般情况，是所创域控制器所属域，所以，无大碍</p>
<p>如果，不想系统默认隶属域，要在设置前操作</p>
<p>验证，重启之后在【控制面板】-【系统和安全】-【系统】中即可查看新的AD域名称</p>
<p><img src="/light-docusaurus/assets/images/23-dfd5283d8269f394b6bbc03f404ec008.png" width="1151" height="865"></p>
<h3 id="4-添加域用户">4. 添加域用户</h3>
<p>在【AD DS】页面右键点击服务器，选择 【Active Directy 用户和计算机】</p>
<p><img src="/light-docusaurus/assets/images/24-de947da2ec35ca9e78720dca4a0e7449.png" width="1151" height="865"></p>
<p>这个页面有两项重要的信息，</p>
<ul>
<li>【Computers】代表添加到域中的计算机</li>
<li>【Users】代表域中的用户</li>
</ul>
<p><img src="/light-docusaurus/assets/images/25-ff00e083f88721ce293a8cdc316da57b.png" width="1151" height="865"></p>
<p>新建用户，右键点击【Users-新建-用户】</p>
<p><img src="/light-docusaurus/assets/images/26-a389bbec0b2cf4a6dabadfa299c27d7f.png" width="1151" height="865"></p>
<p>输入姓名、用户名、登录名等信息</p>
<p><img src="/light-docusaurus/assets/images/27-bf300be1cde3d1fcc8ccba3a20757503.png" width="1151" height="865"></p>
<p>设置密码，勾选【密码永不过期】 Admin123</p>
<p><img src="/light-docusaurus/assets/images/28-c26c16393324ab53d8f82de286092799.png" width="1151" height="865"></p>
<p>可以看到完整的登录名</p>
<p><img src="/light-docusaurus/assets/images/29-14761f5fe13445f262deed7acc58ab45.png" width="1151" height="865"></p>
<p>右键点击【属性】</p>
<p><img src="/light-docusaurus/assets/images/30-f5a5802580b88abf0c1de314308afba9.png" width="1151" height="865"></p>
<p>在【账户】中，有两项关键的配置信息</p>
<ul>
<li>【登录到】    可以设置当前用户可以在哪些电脑上登录</li>
<li>【账户选项】  可以设置账户的加密方式，客户端需要对应的加密方式，否则会报错</li>
</ul>
<p><img src="/light-docusaurus/assets/images/31-6b0427d9dae5762b3d1533076ea8fa73.png" width="1151" height="865"></p>
<h2 id="三计算机加入ad域">三、计算机加入AD域</h2>
<h3 id="1-windows服务器加入ad域">1. Windows服务器加入AD域</h3>
<ul>
<li><a href="https://blog.51cto.com/91xueit/1114387">将计算机加入域</a></li>
</ul>
<p>修改计算机的DNS为AD域服务器的IP</p>
<p><img src="/light-docusaurus/assets/images/32-64320221c2d603b58d0ed1caf7b4db00.png" width="597" height="734"></p>
<p>右键点击【此电脑】-【属性】-【重命名这台电脑】-【更改】</p>
<p>将【隶属于】改为AD域的地址，此处为 <code>dev.local</code></p>
<p><img src="/light-docusaurus/assets/images/33-14b8530cd4d56bfebbb1b925bd9b1965.png" width="1920" height="1030"></p>
<p>点击确定，输入域管理员账号密码（Administrator / Admin123）登录，登录完成后需要重启计算机</p>
<p><img src="/light-docusaurus/assets/images/34-913286869038573f726072884b662c51.png" width="571" height="351"></p>
<p><strong>注意</strong> 计算机加入域，会自动的在活动目录中【Computers】目录下创建计算机账号。您也可以在活动目录中先创建计算机账号，再将计算机加入到域中。</p>
<p>检查加入到域之后的计算机名称，发现计算机名称后自动添加了域后缀</p>
<p><img src="/light-docusaurus/assets/images/35-e25142ac367ee137aef54b532381e79e.png" width="1920" height="1030"></p>
<p>计算机脱离域，将计算机加入到工作组即可从域中退出。</p>
<p><img src="/light-docusaurus/assets/images/36-b8e567b9d861ca0825c7599848a7eae5.png" width="1920" height="1030"></p>
<h3 id="2-linux服务器加入ad域">2. Linux服务器加入AD域</h3>
<ul>
<li>
<p><a href="https://linux.cn/article-7695-1.html">如何让 Linux 机器加入 Windows 的 AD 域</a></p>
</li>
<li>
<p><a href="https://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64">CentOS 7.9 镜像下载</a></p>
</li>
<li>
<p>Windows 服务器地址为 <code>192.168.3.32</code>，域名为 <code>dev.local</code>，主机名为 <code>win-dc01.dev.local</code>；</p>
</li>
<li>
<p>Linux 服务器地址为 <code>192.168.3.34</code>，主机名为 <code>lin-pc01.dev.local</code>。</p>
</li>
</ul>
<h4 id="1安装所需软件">1、安装所需软件：</h4>
<pre><code class="language-shell">yum -y install samba samba-client samba-common samba-winbind samba-winbind-clients krb5-workstation ntpdate

# 关闭selinux
sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config
</code></pre>
<h4 id="2设置服务自启动并启动服务">2、设置服务自启动并启动服务：</h4>
<pre><code class="language-shell">chkconfig smb on
chkconfig winbind on
service smb start
service winbind start
</code></pre>
<h4 id="3修改-etchosts-文件添加主机对应记录">3、修改 /etc/hosts 文件，添加主机对应记录：</h4>
<pre><code class="language-shell">vim /etc/hosts

# 添加下列内容
192.168.3.32 win-dc01.dev.local
192.168.3.34 lin-pc01.dev.local pc01
</code></pre>
<h4 id="4设置-dns-地址并与-ad-服务器同步时间">4、设置 DNS 地址并与 AD 服务器同步时间：</h4>
<pre><code class="language-shell"># 修改DNS
echo &quot;nameserver 192.168.3.32&quot; &gt;&gt; /etc/resolv.conf

# 同步时间
ntpdate win-dc01.dev.local
</code></pre>
<h4 id="5设置-kerberos-票据可选">5、设置 Kerberos 票据（可选）：</h4>
<p>销毁已经存在的所有票据：</p>
<pre><code class="language-shell">kdestroy

# 或
klist purge
</code></pre>
<p>查看当前是否还存在票据：</p>
<pre><code class="language-shell">klist

# 输出
klist: Credentials cache keyring &#x27;persistent:0:0&#x27; not found
</code></pre>
<p>生成新的票据，注意域名大写。</p>
<pre><code class="language-shell"># 生  成票据（未加域生成失败，加域后重试即可）
kinit administrator@DEV.LOCAL

klist

# 输出
Ticket cache: KEYRING:persistent:0:0
Default principal: administrator@DEV.LOCAL

Valid starting       Expires              Service principal
2024-01-31T17:31:06  2024-02-01T03:31:06  krbtgt/DEV.LOCAL@DEV.LOCAL
        renew until 2024-02-07T17:30:58
</code></pre>
<h4 id="6以命令方式设置-samba-与-kerberos并加入-ad-域">6、以命令方式设置 samba 与 Kerberos，并加入 AD 域：</h4>
<pre><code class="language-shell">authconfig --enablewinbind  --enablewins --enablewinbindauth \
  --smbsecurity ads --smbworkgroup=DEV --smbrealm DEV.LOCAL \
  --smbservers=win-dc01.dev.local --enablekrb5 --krb5realm=DEV.LOCAL \
  --krb5kdc=win-dc01.dev.local --krb5adminserver=win-dc01.dev.local \
  --enablekrb5kdcdns --enablekrb5realmdns --enablewinbindoffline \
  --winbindtemplateshell=/bin/bash --winbindjoin=administrator \
  --update --enablelocauthorize --enablemkhomedir --enablewinbindusedefaultdomain
</code></pre>
<p>注意命令中的大小写，此步骤也可以使用 <code>authconfig-tui</code> 完成。下面为界面UI</p>
<p><img src="/light-docusaurus/assets/images/37-e9f96d696ad4b9a073b85d63c71f5d8e.png" width="1615" height="886"></p>
<h4 id="7增加-sudo-权限可选">7、增加 sudo 权限（可选）：</h4>
<pre><code class="language-shell">visudo

# 加入下列设置：
%MYDOMAIN\\domain\ admins ALL=(ALL)  NOPASSWD: ALL
</code></pre>
<h4 id="8确认是否正确加入-ad-域">8、确认是否正确加入 AD 域：</h4>
<p>查看 AD 的相关信息</p>
<pre><code class="language-shell">net ads info

# 输出
LDAP server: 192.168.3.32
LDAP server name: win-dc01.dev.local
Realm: DEV.LOCAL
Bind Path: dc=DEV,dc=LOCAL
LDAP port: 389
Server time: 三, 31 1月 2024 17:32:38 CST
KDC server: 192.168.3.32
Server time offset: -2
Last machine account password change: 三, 31 1月 2024 17:30:27 CST
</code></pre>
<p>查看 MYDOMAIN\USERID 的使用者帐户</p>
<pre><code class="language-shell">wbinfo -u

# 输出
administrator
guest
krbtgt
tc01
pc01
</code></pre>
<h4 id="9-补充">9. 补充：</h4>
<p>最好关闭SELinux</p>
<pre><code class="language-shell"># 确认当前SELinux状态
getenforce

# 临时关闭SELinux
setenforce 0

# 永久关闭SELinux
sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config
</code></pre>
<p>如果启用 selinux 的话，需要安装 <code>oddjobmkhomedir</code> 并启动其服务，这样才能确保系统对创建的家目录设置合适的 SELinux 安全上下文。</p>
<h4 id="10-效果">10. 效果</h4>
<p>添加完成后可以在【Computers】中看到Windows计算机和Linux计算机
<img src="/light-docusaurus/assets/images/38-7e328032fb5760e60624e66810bea08e.png" width="1151" height="865"></p>
<h2 id="四服务端配置">四、服务端配置</h2>
<ul>
<li><a href="https://tomcat.apache.org/tomcat-9.0-doc/windows-auth-howto.html">Windows Authentication How-To</a></li>
<li><a href="https://www.w3cschool.cn/tomcat/6wds1ka3.html">Tomcat Windows 认证</a></li>
</ul>
<p>上面Tomcat官方集成步骤仅供参考，建议使用第三方的集成。</p>
<p>对于Tomcat项目，推荐使用<a href="https://spnego.sourceforge.net/">Spnego</a>; 对于SpringBoot项目，推荐使用<a href="http://static.springsource.org/spring-security/site/extensions/krb/index.html">Spring Security Kerberos</a></p>
<h3 id="1-使用tomcat--spnego-集成-windows-authentication">1. 使用Tomcat + Spnego 集成 Windows Authentication</h3>
<ul>
<li>tomcat 版本为 9.0.85</li>
<li>JDK 版本为 jdk 1.8</li>
</ul>
<p>以下用<code>~</code>表示Tomcat安装目录: <code>D:\Develop\apache-tomcat-9.0.85</code></p>
<h4 id="1-添加-spnego-依赖-spnegojar">1. 添加 Spnego 依赖 <code>spnego.jar</code></h4>
<p>版本依赖关系</p>
<table><thead><tr><th>Tomcat</th><th>JDK</th><th>spnego</th></tr></thead><tbody><tr><td>Tomcat 8</td><td>Java 8</td><td>spnego-r9.jar</td></tr><tr><td>Tomcat 9</td><td>Java 11+</td><td>spnego-r9.jar</td></tr><tr><td>Tomcat 10+</td><td>Java 11+</td><td>spnego-jakarta-2.0.jar</td></tr></tbody></table>
<ul>
<li><a href="https://sourceforge.net/projects/spnego/files/spnego-r9.jar/download">spnego-r9.jar</a></li>
<li><a href="https://sourceforge.net/projects/spnego/files/spnego-jakarta-2.0.jar/download">spnego-jakarta-2.0.jar</a></li>
</ul>
<p>将下载的依赖包放入 <code>tomcat/lib/</code> 目录下，例如: <code>~\lib\spnego-r9.jar</code></p>
<h4 id="2-修改-webxml-文件">2. 修改 web.xml 文件</h4>
<p>修改 <code>~\conf\web.xml</code>，添加以下内容</p>
<pre><code class="language-xml">&lt;!--==================== SPNEGO FILTER - Kerberos SSO ===================== --&gt; 
&lt;filter&gt;
    &lt;filter-name&gt;SpnegoHttpFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;net.sourceforge.spnego.SpnegoHttpFilter&lt;/filter-class&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.allow.basic&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.allow.localhost&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.allow.unsecure.basic&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.login.client.module&lt;/param-name&gt;
        &lt;param-value&gt;spnego-client&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.krb5.conf&lt;/param-name&gt;
        &lt;param-value&gt;krb5.conf&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.login.conf&lt;/param-name&gt;
        &lt;param-value&gt;login.conf&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;!-- 此处配置 AD域账号，用于服务端的认证 --&gt;
        &lt;param-name&gt;spnego.preauth.username&lt;/param-name&gt;
        &lt;param-value&gt;pc01&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;!-- 此处配置 AD域账号对应的密码，用于服务端的认证 --&gt;
        &lt;param-name&gt;spnego.preauth.password&lt;/param-name&gt;
        &lt;param-value&gt;Admin123&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.login.server.module&lt;/param-name&gt;
        &lt;param-value&gt;spnego-server&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.prompt.ntlm&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;

    &lt;init-param&gt;
        &lt;param-name&gt;spnego.logger.level&lt;/param-name&gt;
        &lt;param-value&gt;1&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;SpnegoHttpFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>
<h4 id="3-创建krb5conf和loginconf">3. 创建<code>krb5.conf</code>和<code>login.conf</code></h4>
<ul>
<li><a href="https://spnego.sourceforge.net/krb5.conf">https://spnego.sourceforge.net/krb5.conf</a></li>
</ul>
<p>添加<code>~/krb5.conf</code></p>
<pre><code class="language-conf">[libdefaults]
default_realm = DEV.LOCAL
# 如果未在 ~/conf/web.xml 配置域账号，则需要配置keytab
# default_keytab_name = FILE:C:\apache-tomcat-9.0.85\conf\tomcat.keytab
# 加密算法，根据【AD域-用户及计算机管理-用户-账户-账号选项】设置值选择
default_tkt_enctypes = aes256-cts aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 aes128-cts rc4-hmac des3-cbc-sha1 des-cbc-md5 des-cbc-crc arcfour-hmac arcfour-hmac-md5
default_tgs_enctypes = aes256-cts aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 aes128-cts rc4-hmac des3-cbc-sha1 des-cbc-md5 des-cbc-crc arcfour-hmac arcfour-hmac-md5
permitted_enctypes   = aes256-cts aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 aes128-cts rc4-hmac des3-cbc-sha1 des-cbc-md5 des-cbc-crc arcfour-hmac arcfour-hmac-md5
forwardable=true

[realms]
DEV.LOCAL = {
    # AD域服务器的地址
    kdc = win-dc01.dev.local
    default_domain = DEV.LOCAL
}

[domain_realm]
dev.local= DEV.LOCAL
.dev.local= DEV.LOCAL
</code></pre>
<ul>
<li><a href="https://spnego.sourceforge.net/login.conf">https://spnego.sourceforge.net/login.conf</a></li>
</ul>
<p>添加<code>~/login.conf</code></p>
<pre><code class="language-conf">spnego-client {
	com.sun.security.auth.module.Krb5LoginModule required;
};

spnego-server {
	com.sun.security.auth.module.Krb5LoginModule required
	storeKey=true
	isInitiator=false;
};
</code></pre>
<h4 id="4-注册spnservice-principal-name">4. 注册SPN（Service Principal Name）</h4>
<p>一个SPN只能对应一个用户名，一个用户可以有多个SPN</p>
<pre><code class="language-shell"># 查看帮助
setspn --help

# 添加SPN
setspn -A HTTP/lin-pc01                 pc01
setspn -A HTTP/lin-pc01.dev.local       pc01

setspn -A HTTP/win-pc01                 pc02
setspn -A HTTP/win-pc01.dev.local       pc02

# 查看账号关联的SPN
setspn -L pc01

# 删除账号关联的SPN
setspn -D HTTP/lin-pc01                 pc01

# 查询SPN信息
setspn -Q HTTP/lin-pc01.dev.local
</code></pre>
<p><img src="/light-docusaurus/assets/images/39-11c690519180b31db0845556e69b5961.png" width="1151" height="865"></p>
<p>生成<code>tomcat.keytab</code></p>
<pre><code class="language-shell"># /out      输出文件路径
# /mapuser  映射用户
# /princ    关联的计算机
# /pass     映射用户的密码
# /kvno     版本
ktpass /out c:\tomcat.keytab /mapuser pc01@DEV.LOCAL /princ HTTP/lin-pc01.dev.local@DEV.LOCAL /pass &#x27;Admin123&#x27; /kvno 0

ktpass /princ HTTP/YOUR_COMPUTER_NAME_HERE@YOUR_DOMAIN_HERE.COM /mapuser YOUR_USER_HERE /pass YOUR_PASSWORD_HERE /Target YOUR_DOMAIN_HERE.COM /out YOUR_KEYTAB_FILENAME_HERE.keytab /kvno 0 /crypto RC4-HMAC-NT /ptype KRB5_NT_PRINCIPAL
</code></pre>
<p><img src="/light-docusaurus/assets/images/40-89010bb2f7534b366df7e2ca85d294ea.png" width="1151" height="865"></p>
<h4 id="5-测试配置文件">5. 测试配置文件</h4>
<pre><code class="language-java">import java.io.File;
import java.io.FileNotFoundException;
import java.security.NoSuchAlgorithmException;
 
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.login.Configuration;
import javax.security.auth.login.LoginContext;
 
public final class HelloKDC {
 
    private HelloKDC() {
        // default private
    }
 
    public static void main(final String[] args) throws Exception {
 
    	// Domain (pre-authentication) account
        final String username = &quot;pc01&quot;;
        
        // Password for the pre-auth acct.
        final String password = &quot;Admin123&quot;;
        
        // Name of our krb5 config file
        final String krbfile = &quot;krb5.conf&quot;;
        
        // Name of our login config file
        final String loginfile = &quot;login.conf&quot;;
        
        // Name of our login module
        final String module = &quot;spnego-client&quot;;
 
        // set some system properties
        System.setProperty(&quot;java.security.krb5.conf&quot;, krbfile);
        System.setProperty(&quot;java.security.auth.login.config&quot;, loginfile);
        //System.setProperty(&quot;sun.security.krb5.debug&quot;, true);
 
        // assert 
        HelloKDC.validate(username, password, krbfile, loginfile, module);
 
        final CallbackHandler handler = 
            HelloKDC.getUsernamePasswordHandler(username, password);
 
        final LoginContext loginContext = new LoginContext(module, handler);
 
        // attempt to login
        loginContext.login();
 
        // output some info
        System.out.println(&quot;Subject=&quot; + loginContext.getSubject());
 
        // logout
        loginContext.logout();
 
        System.out.println(&quot;Connection test successful.&quot;);
    }
 
    private static void validate(final String username, final String password
        , final String krbfile, final String loginfile, final String moduleName) 
        throws FileNotFoundException, NoSuchAlgorithmException {
 
        // confirm username was provided
        if (null == username || username.isEmpty()) {
            throw new IllegalArgumentException(&quot;Must provide a username&quot;);
        }
 
        // confirm password was provided
        if (null == password || password.isEmpty()) {
            throw new IllegalArgumentException(&quot;Must provide a password&quot;);
        }
 
        // confirm krb5.conf file exists
        if (null == krbfile || krbfile.isEmpty()) {
            throw new IllegalArgumentException(&quot;Must provide a krb5 file&quot;);
        } else {
            final File file = new File(krbfile);
            if (!file.exists()) {
                throw new FileNotFoundException(krbfile);
            }
        }
 
        // confirm loginfile
        if (null == loginfile || loginfile.isEmpty()) {
            throw new IllegalArgumentException(&quot;Must provide a login file&quot;);
        } else {
            final File file = new File(loginfile);
            if (!file.exists()) {
                throw new FileNotFoundException(loginfile);
            }
        }
 
        // confirm that runtime loaded the login file
        final Configuration config = Configuration.getConfiguration();
 
        // confirm that the module name exists in the file
        if (null == config.getAppConfigurationEntry(moduleName)) {
            throw new IllegalArgumentException(&quot;The module name &quot; 
                    + moduleName + &quot; was not found in the login file&quot;);
        }        
    }
 
    private static CallbackHandler getUsernamePasswordHandler(
        final String username, final String password) {
 
        final CallbackHandler handler = new CallbackHandler() {
            public void handle(final Callback[] callback) {
                for (int i=0; i&lt;callback.length; i++) {
                    if (callback[i] instanceof NameCallback) {
                        final NameCallback nameCallback = (NameCallback) callback[i];
                        nameCallback.setName(username);
                    } else if (callback[i] instanceof PasswordCallback) {
                        final PasswordCallback passCallback = (PasswordCallback) callback[i];
                        passCallback.setPassword(password.toCharArray());
                    } else {
                        System.err.println(&quot;Unsupported Callback: &quot; 
                                + callback[i].getClass().getName());
                    }
                }
            }
        };
 
        return handler;
    }
}
</code></pre>
<pre><code class="language-shell"># 编译
javac HelloKDC.java

# 运行
java HelloKDC
</code></pre>
<h4 id="6-创建一个-hello_spnegojsp-文件">6. 创建一个 <code>hello_spnego.jsp</code> 文件</h4>
<ul>
<li><a href="https://spnego.sourceforge.net/hello_spnego.zip">https://spnego.sourceforge.net/hello_spnego.zip</a></li>
</ul>
<p>添加 <code>~/webapps/ROOT/hello_spnego.jsp</code></p>
<pre><code class="language-jsp">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Hello SPNEGO Example&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
Hello &lt;%= request.getRemoteUser() %&gt; !
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h4 id="7-测试">7. 测试</h4>
<pre><code class="language-shell"># 1. 本机访问
http://localhost:8080/hello_spnego.jsp
# 页面显示 `Hello YOUR_USER_NAME !`


# 2. 非域计算机访问
http://192.168.3.49:8080/hello_spnego.jsp
# 会弹出Windows认证的输入框，需要输入域账号、密码
# 输入正确的账号密码后页面显示 `Hello YOUR_USER_NAME !`


# 3. 域计算机访问（已登录域账号，使用域地址访问）
http://win-pc01.dev.local:8080/hello_spnego.jsp
# 不需要登录，页面显示 `Hello YOUR_USER_NAME !`
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/active-directory/1-Install-AD-DS.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/docs/category/active-directory/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Active Directory</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/docs/zh-cn/active-directory/Tomcat-Integrate-Windows-Authentication-With-Spnego/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Tomcat-Integrate-Windows-Authentication-With-Spnego</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一安装系统" class="table-of-contents__link toc-highlight">一、安装系统</a></li><li><a href="#二安装ad域服务器" class="table-of-contents__link toc-highlight">二、安装AD域服务器</a><ul><li><a href="#1-安装ad域服务" class="table-of-contents__link toc-highlight">1. 安装AD域服务</a></li><li><a href="#2-将服务器提升为域控制器" class="table-of-contents__link toc-highlight">2. 将服务器提升为域控制器</a></li><li><a href="#3-更改目标服务器" class="table-of-contents__link toc-highlight">3. 更改目标服务器</a></li><li><a href="#4-添加域用户" class="table-of-contents__link toc-highlight">4. 添加域用户</a></li></ul></li><li><a href="#三计算机加入ad域" class="table-of-contents__link toc-highlight">三、计算机加入AD域</a><ul><li><a href="#1-windows服务器加入ad域" class="table-of-contents__link toc-highlight">1. Windows服务器加入AD域</a></li><li><a href="#2-linux服务器加入ad域" class="table-of-contents__link toc-highlight">2. Linux服务器加入AD域</a></li></ul></li><li><a href="#四服务端配置" class="table-of-contents__link toc-highlight">四、服务端配置</a><ul><li><a href="#1-使用tomcat--spnego-集成-windows-authentication" class="table-of-contents__link toc-highlight">1. 使用Tomcat + Spnego 集成 Windows Authentication</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>