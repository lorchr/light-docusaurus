<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/k8s/Build-K8s-Offline-With-RKE2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Build-K8s-Offline-With-RKE2 | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Build-K8s-Offline-With-RKE2 | Light Docusaurus"><meta data-rh="true" name="description" content="- RKE2离线安装"><meta data-rh="true" property="og:description" content="- RKE2离线安装"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.609e5209.css">
<script src="/light-docusaurus/assets/js/runtime~main.8c0ff940.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.898faf32.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a class="navbar__item navbar__link" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/active-directory/">Active Directory</a><button aria-label="展开侧边栏分类 &#x27;Active Directory&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/light-docusaurus/docs/category/kubernetes/">Kubernetes</a><button aria-label="折叠侧边栏分类 &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Single-Master-Cluster/">Build-K8s-Single-Master-Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Cluster-With-Rancher/">Build-K8s-Cluster-With-Rancher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/">Build-K8s-Offline-With-RKE2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/k8s/K8s-Commands/">K8s-Commands</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/awesome-open-source/">Awesome open source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/docs/category/kubernetes/"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Build-K8s-Offline-With-RKE2</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Build-K8s-Offline-With-RKE2</h1></header><ul>
<li><a href="https://docs.rke2.io/zh/install/airgap">RKE2离线安装</a></li>
</ul>
<h2 id="一基于rke2的k8s部署">一、基于RKE2的K8s部署</h2>
<h3 id="1禁用-selinuxfirewalld-swap">1、禁用 SELinux、Firewalld 、Swap</h3>
<pre><code class="language-shell"># 禁用 SELinux
sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config &amp;&amp; setenforce 0

# 关闭 firewalld
systemctl stop firewalld &amp;&amp; systemctl disable firewalld

# 禁用swap分区
swapoff -a &amp;&amp; sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab
</code></pre>
<h3 id="2设置时间同步">2、设置时间同步</h3>
<pre><code class="language-shell"># 设置系统时区为 中国/上海 
timedatectl set-timezone &quot;Asia/Shanghai&quot;

# 将当前的 UTC 时间写入硬件时钟
timedatectl set-local-rtc 0

# 重启依赖于系统时间的服务
systemctl restart rsyslog
</code></pre>
<h3 id="3下载安装包以及镜像文件">3、下载安装包以及镜像文件</h3>
<pre><code class="language-shell"># 镜像下载
wget https://github.com/rancher/rke2/releases/download/v1.24.7%2Brke2r1/rke2-images.linux-amd64.tar.gz

# 安装包下载
wget https://github.com/rancher/rke2/releases/download/v1.24.7%2Brke2r1/rke2.linux-amd64.tar.gz
</code></pre>
<p>上述所有服务器均需执行！</p>
<h3 id="4部署-server-节点master">4、部署 server 节点(master)</h3>
<pre><code class="language-shell"># 设置服务器名称
hostnamectl set-hostname k8s-master

# 解压安装包文件
tar -xzvf rke2.linux-amd64.tar.gz

# 复制可执行文件到 /usr/local/bin/
cp bin/* /usr/local/bin/

# 复制启动项文件到 /usr/lib/systemd/system/
# 注意：启动项有 server 和 agent ，这里是复制 server 的
cp lib/systemd/system/rke2-server.service /usr/lib/systemd/system/

# 复制镜像文件到 rke2 指定的默认位置
# 创建目录
mkdir -p /var/lib/rancher/rke2/agent/images/
# 复制镜像文件到该目录
cp rke2-images.linux-amd64.tar.gz /var/lib/rancher/rke2/agent/images/

# 设置开机启动并启动
systemctl enable rke2-server &amp;&amp; systemctl start rke2-server
</code></pre>
<p><strong>注意：</strong> 以下操作在 <code>rke2-server</code> 启动再操作</p>
<pre><code class="language-shell"># 复制 kubectl 到 /usr/lobal/bin
cp /var/lib/rancher/rke2/bin/kubectl /usr/local/bin/
cp /var/lib/rancher/rke2/bin/crictl /usr/local/bin/
cp /var/lib/rancher/rke2/bin/ctr /usr/local/bin/

# 设置 kubeconfig
cat &gt;&gt; ~/.bashrc &lt;&lt;EOF
export KUBECONFIG=/etc/rancher/rke2/rke2.yaml
alias crictl=&#x27;crictl --runtime-endpoint unix:///run/k3s/containerd/containerd.sock&#x27;
alias ctr=&#x27;ctr --address /run/k3s/containerd/containerd.sock&#x27;
EOF

source ~/.bashrc

# 等启动后查看 node 以及 pod
# nodes
kubectl get nodes
# pods
kubectl get pods -A
</code></pre>
<h3 id="5部署-agent-节点worker">5、部署 agent 节点(worker)</h3>
<p><code>agent</code> 节点的安装同样要下载安装包以及镜像文件。</p>
<pre><code class="language-shell"># 设置服务器名称
hostnamectl set-hostname k8s-node-1

# 加入节点需要认证,认证文件在 server 节点上
cat /var/lib/rancher/rke2/server/token
# 获取token示例如下：
# K10c5203928ea0e95fcddd9f64d07a4eda1536718ac3ebb35503900dd096523df46::server:880d72c3a7c8a55728aac3fc28de59f1

# 创建目录
mkdir -p /etc/rancher/rke2

# 创建配置文件
# 注意：server 为首个节点的地址；token 就是 server 节点上生成的 
cat &gt; /etc/rancher/rke2/config.yaml &lt;&lt;EOF
server: https://192.168.0.22:9345
token:	K10c5203928ea0e95fcddd9f64d07a4eda1536718ac3ebb35503900dd096523df46::server:880d72c3a7c8a55728aac3fc28de59f1
EOF

# 解压安装包文件
tar -xzvf rke2.linux-amd64.tar.gz

# 复制可执行文件到 /usr/local/bin/
cp bin/* /usr/local/bin/

# 复制启动项文件到 /usr/lib/systemd/system/
# 注意：启动项有 server 和 agent ，这里是复制 agent 的
cp lib/systemd/system/rke2-agent.service /usr/lib/systemd/system/

# 复制镜像文件到 rke2 指定的默认位置
# 创建目录
mkdir -p /var/lib/rancher/rke2/agent/images/
# 复制镜像文件到该目录
cp rke2-images.linux-amd64.tar.gz /var/lib/rancher/rke2/agent/images/

# 设置开机启动并启动
systemctl enable rke2-agent &amp;&amp; systemctl start rke2-agent
</code></pre>
<p>启动后到 <code>server</code> 节点就可以看到加入的节点了</p>
<p><strong>注意：</strong> 启动成功后设置</p>
<pre><code class="language-shell"># 设置命令链接
cp /var/lib/rancher/rke2/bin/crictl /usr/local/bin/ 
cp /var/lib/rancher/rke2/bin/ctr /usr/local/bin/

cat &gt;&gt; ~/.bashrc &lt;&lt;EOF
alias crictl=&#x27;crictl --runtime-endpoint unix:///run/k3s/containerd/containerd.sock&#x27;
alias ctr=&#x27;ctr --address /run/k3s/containerd/containerd.sock&#x27;
EOF

source ~/.bashrc
</code></pre>
<h3 id="6删除节点">6、删除节点</h3>
<pre><code class="language-shell"># 先查看一下这个node节点上的nodes信息
kubectl get nodes

# 驱逐此node节点上的pod
kubectl drain k8s-node-1 --delete-local-data --force --ignore-daemonsets

# 删除这个node节点
kubectl delete nodes k8s-node-1

# 卸载rke2
/usr/local/bin/rke2-uninstall.sh
</code></pre>
<h3 id="7集群重置">7、集群重置</h3>
<ul>
<li><a href="https://docs.rke2.io/zh/backup_restore">集群重置</a></li>
</ul>
<p>RKE2 启用了一项功能，可以通过传递 <code>--cluster-reset</code> 标志将集群重置为一个成员集群。将此标志传递给 RKE2 server 时，它将使用相同的数据目录重置集群，数据 etcd 的目录存在于 <code>/var/lib/rancher/rke2/server/db/etcd</code> 中，这个标志可以在集群丢失仲裁时传递。</p>
<p>要传递重置标志，首先你需要停止 RKE2 服务（如果 RKE2 是通过 <code>systemd</code> 启用的）：</p>
<pre><code class="language-shell">systemctl stop rke2-server
rke2 server --cluster-reset
</code></pre>
<p><strong>结果：</strong> 日志中的一条消息表示 RKE2 可以在没有标志的情况下重新启动。再次启动 RKE2，它应该将 RKE2 作为一个成员集群启动。</p>
<pre><code class="language-shell">INFO[0088] Managed etcd cluster membership has been reset, restart without --cluster-reset flag now. Backup and delete ${datadir}/server/db on each peer etcd server and rejoin the nodes 

#  【master节点】重启RKE2
systemctl restart rke2-server

# 【worker节点】修改server地址
vim /etc/rancher/rke2/config.yaml
# 【worker节点】重启RKE2
systemctl restart rke2-agent
</code></pre>
<h2 id="二安装pgsql-154">二、安装Pgsql 15.4</h2>
<h3 id="1本地编译源码">1、本地编译源码</h3>
<pre><code class="language-shell"># 安装依赖项
yum install -y gcc make readline-devel zlib-devel
# apt install -y gcc make libreadline-dev zlib1g zlib1g.dev

# 创建目录
mkdir -p /home/light/pgsql/build

# 下载源码包
wget https://ftp.postgresql.org/pub/source/v15.4/postgresql-15.4.tar.gz

# 解压
tar -zxvf postgresql-15.4.tar.gz -C /home/light/pgsql

# 编译
/home/light/pgsql/postgresql-15.4/configure --prefix /home/light/pgsql/build
make

# 安装
make install

# 打包
cd /home/light/pgsql/build
tar -zcvf pgsql-15.4.tar.gz ./bin ./include ./lib ./share
</code></pre>
<h3 id="2上传解压编译后的包">2、上传解压编译后的包</h3>
<pre><code class="language-shell"># 解压pgsql-15.4.tar.gz到/data/local
tar -xzvf pgsql-15.4.tar.gz -C /data/local

# 创建PG用户
useradd postgres

# 初始化目录
mkdir -p /data/local/postgresql/data
mkdir -p /data/local/postgresql/log
</code></pre>
<h3 id="3初始化数据库">3、初始化数据库</h3>
<pre><code class="language-shell"># 给postgres目录权限
chown -R postgres:postgres /data/local/postgresql/

# 切换postgres用户
su postgres

# 初始化数据库
/data/local/postgresql/bin/initdb -D /data/local/postgresql/data/ -E UTF8 --locale=en_US.UTF-8

# 自定义可访问IP及端口
vim /data/local/postgresql/data/postgresql.conf
listen_addresses = &#x27;*&#x27;
port = 5432
max_connections = 1000

# 修改数据库访问策略
vim /data/local/postgresql/data/pg_hba.conf
# IPv4 local connections:
host    all             all             192.168.0.0/24            trust
host    all             all             0.0.0.0/0                 md5

# 启动数据库
/data/local/postgresql/bin/pg_ctl -D /data/local/postgresql/data/ -l logfile start
# 修改postgres用户密码
/data/local/postgresql/bin/psql -U postgres -h localhost -c &quot;ALTER USER postgres WITH PASSWORD &#x27;2#w4a8BV6qHP3LG#&#x27;;&quot;
</code></pre>
<h3 id="4远程连接">4、远程连接</h3>
<p>关闭防火墙或者打开5432端口</p>
<pre><code class="language-shell"># 检查防火墙状态
sudo firewall-cmd --state

# 添加入站规则
sudo firewall-cmd --permanent --add-port=5432/tcp

# 重启防火墙
sudo firewall-cmd --reload

# 列出开放的端口
sudo firewall-cmd --list-ports

# 列出添加的服务
sudo firewall-cmd --list-services

# 列出当前系统上打开的所有网络连接和监听端口
netstat -tuln
# 同时显示服务名称
sudo netstat -tulnp
</code></pre>
<h3 id="5设置开机自启">5、设置开机自启</h3>
<pre><code class="language-shell"># 拷贝linux文件，并更名为postgresql
cp /data/local/postgresql/contrib/start-scripts/linux /etc/init.d/postgresql

sed -i &quot;s/\/usr\/local\/pgsql/\/data\/local\/postgresql/g&quot; /etc/init.d/postgresql
sed -i &quot;s/\/usr\/local\/pgsql\/data/\/data\/local\/postgresql\/data/g&quot; /etc/init.d/postgresql

# 添加执行权限 设置开机自启
chmod a+x /etc/init.d/postgresql
chkconfig --add postgresql
</code></pre>
<p>自定义服务注册文件</p>
<pre><code class="language-shell"># 添加服务注册文件
cat &gt; /etc/systemd/system/postgresql.service &lt;&lt; EOF
[Unit]
Description=PostgreSQL Database Server

[Service]
Type=forking
ExecStart=/data/local/postgresql/bin/pg_ctl start -D /data/local/postgresql/data -l /data/local/postgresql/log/logfile.log
ExecStop=/data/local/postgresql/bin/pg_ctl stop -D /data/local/postgresql/data
Restart=always
RestartSec=5
User=postgres
Group=postgres

[Install]
WantedBy=multi-user.target
EOF

# 重新加载 systemd
systemctl daemon-reload

# 启动pgsql并查看状态
systemctl start postgresql
systemctl status postgresql
systemctl stop postgresql
systemctl restart postgresql

# 状态正常即可设置开机自启
systemctl enable postgresql
systemctl disable postgresql
</code></pre>
<p><strong>注意：</strong> 需要在<code>[Service]</code>标签下指定启动的用户 用户组，否则会启动失败</p>
<h2 id="三安装influxdb-184">三、安装Influxdb 1.8.4</h2>
<h3 id="1下载-rpm-安装包">1、下载 rpm 安装包</h3>
<pre><code class="language-shell">wget https://dl.influxdata.com/influxdb/releases/influxdb-1.8.4.x86_64.rpm
</code></pre>
<h3 id="2安装">2、安装</h3>
<pre><code class="language-shell"># 安装rpm包
yum localinstall -y influxdb-1.8.4.x86_64.rpm

# 开机自启
systemctl enable influxdb

# 启动
systemctl start influxdb
</code></pre>
<h3 id="3创建新用户">3、创建新用户</h3>
<pre><code class="language-shell">influx
# 进入influx命令行客户端，创建用户：
CREATE USER &quot;yongtuoif@Pisx&quot; WITH PASSWORD &#x27;3Xj3W5fun3N!MjL5&#x27; WITH ALL PRIVILEGES
</code></pre>
<h3 id="4修改配置文件启动权限验证">4、修改配置文件，启动权限验证</h3>
<pre><code class="language-shell">vim /etc/influxdb/influxdb.conf
[http]
auth-enabled = true

# 重启influxdb服务
systemctl restart influxdb

# 验证账号密码
influx -username &#x27;yongtuoif@Pisx&#x27; -password &#x27;3Xj3W5fun3N!MjL5&#x27;
</code></pre>
<h2 id="四安装minio-release2023-09-16t01-01-47z">四、安装Minio RELEASE.2023-09-16T01-01-47Z</h2>
<h3 id="1下载-rpm-安装包-1">1、下载 rpm 安装包</h3>
<pre><code class="language-shell"># 下载安装包
wget https://dl.min.io/server/minio/release/linux-amd64/minio

# 创建目录
mkdir -p /data/local/minio/data
mkdir -p /data/local/minio/conf
mkdir -p /data/local/minio/log
mkdir -p /data/local/minio/bin

# 移动minio文件 赋予可执行权限
mv minio /data/local/minio/bin
chmod +x /data/local/minio/bin/minio

# 创建日志文件
touch /data/local/minio/log/minio.log
</code></pre>
<h3 id="2编写配置文件启动脚本">2、编写配置文件、启动脚本</h3>
<pre><code class="language-shell"># 配置文件
cat &gt; /data/local/minio/conf/minio.conf &lt;&lt; EOF
# This is minio conf.
MINIO_VOLUMES=&quot;/data/local/minio/data&quot;
# 端口号设置
MINIO_OPTS=&quot;--address \&quot;:9000\&quot; --console-address \&quot;:9001\&quot;&quot;
# 用户名 密码
MINIO_ROOT_USER=&quot;yongtuomi&quot;
MINIO_ROOT_PASSWORD=&quot;Y2rKNdWKLsujDY&quot;
EOF

# 启动脚本
cat &gt; /data/local/minio/bin/start.sh &lt;&lt; EOF
#!/bin/bash
export MINIO_ROOT_USER=yongtuomi
export MINIO_ROOT_PASSWORD=Y2rKNdWKLsujDY
nohup /data/local/minio/bin/minio server /data/local/minio/data --console-address &quot;:9001&quot; --address &quot;:9000&quot; &gt; /data/local/minio/log/minio.log 2&gt;&amp;1 &amp;
EOF

# 添加执行权限
chmod +x /data/local/minio/bin/start.sh
# 启动
sh /data/local/minio/bin/start.sh
</code></pre>
<h3 id="3设置开机自启">3、设置开机自启</h3>
<pre><code class="language-shell"># 添加服务注册文件
cat &gt; /etc/systemd/system/minio.service &lt;&lt; &#x27;EOF&#x27;
[Unit]
Description=MinIO
Documentation=https://min.io/docs/minio/linux/index.html
Wants=network-online.target
After=network-online.target
AssertFileIsExecutable=/data/local/minio/bin/minio

[Service]
WorkingDirectory=/data/local/

User=root
Group=root
ProtectProc=invisible

EnvironmentFile=-/data/local/minio/conf/minio.conf
ExecStartPre=/bin/bash -c &quot;if [ -z \&quot;${MINIO_VOLUMES}\&quot; ]; then echo \&quot;Variable MINIO_VOLUMES not set in /data/local/minio/conf/minio.conf\&quot;; exit 1; fi&quot;
ExecStart=/data/local/minio/bin/minio server $MINIO_OPTS $MINIO_VOLUMES &gt; /data/local/minio/log/minio.log 2&gt;&amp;1

# MinIO RELEASE.2023-05-04T21-44-30Z adds support for Type=notify (https://www.freedesktop.org/software/systemd/man/systemd.service.html#Type=)
# This may improve systemctl setups where other services use `After=minio.server`
# Uncomment the line to enable the functionality
# Type=notify

# Let systemd restart this service always
Restart=always
# Specifies the maximum file descriptor number that can be opened by this process
LimitNOFILE=65536
# Specifies the maximum number of threads this process can create
TasksMax=infinity
# Disable timeout logic and wait until process is stopped
TimeoutStopSec=infinity
SendSIGKILL=no

[Install]
WantedBy=multi-user.target
EOF

# 重新加载 systemd
systemctl daemon-reload

# 启动nginx并查看状态
systemctl start minio
systemctl status minio
systemctl stop minio
systemctl restart minio

# 状态正常即可设置开机自启
systemctl enable minio
systemctl disable minio
</code></pre>
<p><strong>注意：</strong></p>
<ol>
<li>脚本中有环境变量引用，直接使用<code>cat</code>写入会丢失环境变量的名称，需要手动编辑，需要将<code>cat &gt;&gt; filename &lt;&lt; EOF</code> 改为 <code>cat &gt;&gt; filename &lt;&lt; &#x27;EOF&#x27;</code></li>
<li><code>EnvironmentFile=-/data/local/minio/conf/minio.conf</code>加载文件内容为环境变量，<code>-</code>表示文件不存在不报错</li>
<li><code>cat &gt; filename &lt;&lt; EOF</code> 表示写入，会覆盖原内容； <code>cat &gt;&gt; filename &lt;&lt; EOF</code>表示追加，不会覆盖原内容</li>
</ol>
<h2 id="五安装nginx-1221">五、安装Nginx 1.22.1</h2>
<h3 id="1本地编译源码-1">1、本地编译源码</h3>
<ul>
<li><a href="https://ftp.pcre.org/pub/pcre/">pcre</a></li>
<li><a href="http://www.zlib.net/">zlib</a></li>
<li><a href="https://www.openssl.org/">openssl</a></li>
</ul>
<pre><code class="language-shell"># 安装依赖项
yum install -y pcre pcre-devel zlib zlib-devel openssl openssl-devel
# apt install -y build-essential libpcre3 libpcre3-dev zlib1g zlib1g-dev openssl libssl-dev

# 创建目录
mkdir -p /home/light/nginx/build

# 下载源码包
wget https://nginx.org/download/nginx-1.22.1.tar.gz

# 解压
tar -zxvf nginx-1.22.1.tar.gz -C /home/light/nginx

# 编译
./configure \
    --prefix=/home/light/nginx/build \
    --with-http_ssl_module \
    --with-http_realip_module \
    --with-http_addition_module \
    --with-http_gzip_static_module \
    --with-http_gunzip_module \
    --with-http_secure_link_module \
    --with-http_stub_status_module \
    --with-http_v2_module \
    --with-ipv6 \
    --with-mail \
    --with-mail_ssl_module
make

# 安装
sudo make install

# 打包
cd /home/light/nginx/build
tar -zcvf nginx-1.22.1.tar.gz ./conf ./html ./logs ./sbin
</code></pre>
<ul>
<li><code>--prefix</code>：Nginx安装的根路径，所有其他的安装路径都要依赖于该选项。默认为/usr/local/nginx</li>
<li><code>--with-http_ssl_module</code>：安装http ssl module 使Nginx支持SSL协议，提供HTTPS服务</li>
<li><code>--with-http_realip_module</code>：安装http realip module 可以在请求头添加 <code>X-Real-IP</code> <code>X-Forwarded-For</code>获取客户端真实IP</li>
<li><code>--with-http_addition_module</code>：安装http addition module 可以在Http响应包头部或尾部增加内容</li>
<li><code>--with-http_gzip_static_module</code>：安装http gzip static module 可以把一些文档进行压缩返回给客户端，并在压缩前进行检查是否已经有压缩过的包返回</li>
<li><code>--with-http_gunzip_module</code>：安装http gunzip module 对于不支持gzip编码的客户，该模块用于为客户解压缩预压缩内容</li>
<li><code>--with-http_secure_link_module</code>：安装http secure link module 验证请求是否有效，提供安全机制</li>
<li><code>--with-http_stub_status_module</code>：安装http stub status module 让Nginx提供性能统计压面，获取相关并发连接、请求信息</li>
<li><code>--with-http_v2_module</code>：安装http v2 module 支持Http 2.0</li>
<li><code>--with-ipv6</code> 支持IPv6</li>
<li><code>--with-mail</code> 支持邮件服务器反向代理，默认安装 imap pop3 smtp等模块</li>
<li><code>--with-mail_ssl_module</code> 使 imap pop3 smtp 支持SSL/TLS协议</li>
<li><code>--without-mail_imap_module</code> 不安装imap</li>
<li><code>--without-mail_pop3_module</code> 不安装pop3</li>
<li><code>--without-mail_smtp_module</code> 不安装smtp</li>
</ul>
<h3 id="2上传解压编译后的包-1">2、上传解压编译后的包</h3>
<pre><code class="language-shell"># 解压nginx-1.22.1.tar.gz到/data/local
tar -xzvf nginx-1.22.1.tar.gz -C /data/local
</code></pre>
<h3 id="3启动nginx">3、启动nginx</h3>
<pre><code class="language-shell">/data/local/nginx/sbin/nginx
</code></pre>
<h3 id="4设置开机自启">4、设置开机自启</h3>
<pre><code class="language-shell"># 添加服务注册文件
cat &gt; /etc/systemd/system/nginx.service &lt;&lt; EOF
[Unit]
Description=The NGINX HTTP and reverse proxy server
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=forking
PIDFile=/data/local/nginx/logs/nginx.pid
ExecStartPre=/data/local/nginx/sbin/nginx -t -q -g &#x27;daemon on; master_process on;&#x27;
ExecStart=/data/local/nginx/sbin/nginx -g &#x27;daemon on; master_process on;&#x27;
ExecReload=/data/local/nginx/sbin/nginx -g &#x27;daemon on; master_process on;&#x27; -s reload
ExecStop=/data/local/nginx/sbin/nginx -g &#x27;daemon on; master_process on;&#x27; -s quit
PrivateTmp=true

[Install]
WantedBy=multi-user.target
EOF

# 重新加载 systemd
systemctl daemon-reload

# 启动nginx并查看状态
systemctl start nginx
systemctl status nginx
systemctl stop nginx
systemctl restart nginx

# 状态正常即可设置开机自启
systemctl enable nginx
systemctl disable nginx
</code></pre>
<h2 id="六安装emqx-520">六、安装EMQX 5.2.0</h2>
<h3 id="1下载安装包">1、下载安装包</h3>
<pre><code class="language-shell"># 下载
wget https://www.emqx.com/zh/downloads/broker/5.2.0/emqx-5.2.0-el7-amd64.tar.gz

# 安装
mkdir -p /data/local/emqx
tar -zxvf emqx-5.2.0-el7-amd64.tar.gz -C /data/local/emqx
</code></pre>
<h3 id="2运行">2、运行</h3>
<pre><code class="language-shell">useradd emqx
chown -R emqx:emqx /data/local/emqx/

/data/local/emqx/bin/emqx start
/data/local/emqx/bin/emqx stop
</code></pre>
<h3 id="3设置开机自启-1">3、设置开机自启</h3>
<pre><code class="language-shell"># 添加服务注册文件
cat &gt; /etc/systemd/system/emqx.service &lt;&lt; EOF
[Unit]
Description=EMQ X Broker
After=network.target

[Service]
# Type=simple
Type=forking
ExecStart=/data/local/emqx/bin/emqx start
ExecStop=/data/local/emqx/bin/emqx stop
Restart=on-failure
User=root
Group=root
LimitNOFILE=65536
LimitNPROC=4096

[Install]
WantedBy=multi-user.target
EOF

# 重新加载 systemd
systemctl daemon-reload

# 启动emqx并查看状态
systemctl start emqx
systemctl status emqx
systemctl stop emqx
systemctl restart emqx

# 状态正常即可设置开机自启
systemctl enable emqx
systemctl disable emqx
</code></pre>
<h2 id="七安装redis-cluster-7012">七、安装Redis Cluster 7.0.12</h2>
<h3 id="1本地编译源码-2">1、本地编译源码</h3>
<pre><code class="language-shell"># 创建目录
mkdir -p /home/light/redis/build/conf

# 下载源码包
wget https://download.redis.io/releases/redis-7.0.12.tar.gz

# 解压
tar -xzvf redis-7.0.12.tar.gz -C /home/light/redis

# 编译
cd redis-7.0.12/
make

# 安装
make install PREFIX=/home/light/redis/build
# 复制默认的配置文件
cp redis.conf /home/light/redis/build/conf

# 打包
tar -zcvf redis-7.0.12.tar.gz ./conf ./bin
</code></pre>
<h3 id="2上传解压编译后的包-2">2、上传解压编译后的包</h3>
<pre><code class="language-shell"># 22创建目录
mkdir -p /data/local/redis/node-6381
mkdir -p /data/local/redis/node-6382

# 21创建目录
mkdir -p /data/local/redis/node-6383
mkdir -p /data/local/redis/node-6384

# 23创建目录
mkdir -p /data/local/redis/node-6385
mkdir -p /data/local/redis/node-6386

# 解压缩redis-7.0.12.tar.gz
tar -xzvf redis-7.0.12.tar.gz -C /data/local/redis/node-638*/
</code></pre>
<h3 id="3修改配置文件">3、修改配置文件</h3>
<p>将如下redis.conf配置文件内容分别按各自ip地址及port覆盖</p>
<pre><code class="language-shell">port ${port}
requirepass 5pKu5D8Lm
masterauth 5pKu5D8Lm
bind 0.0.0.0 -::0
protected-mode no
daemonize no
appendonly yes
cluster-enabled yes 
cluster-config-file nodes-${port}.conf
cluster-node-timeout 5000
cluster-announce-ip  服务器ip地址
cluster-announce-port ${port}
cluster-announce-bus-port 1${port}

vi /data/local/redis/node-638*/redis-7.0.12/redis.conf
</code></pre>
<h3 id="4配置etcsysctlconf">4、配置/etc/sysctl.conf</h3>
<pre><code class="language-shell">vi /etc/sysctl.conf
</code></pre>
<p>在最后一行添加如下配置：</p>
<pre><code class="language-conf">net.core.somaxconn = 10240
vm.overcommit_memory=1
</code></pre>
<p>保存后输入：<code>sysctl -p</code> 使配置立即生效。</p>
<h3 id="5启动各redis-节点">5、启动各Redis 节点</h3>
<pre><code class="language-shell"># 进入/data/local/redis目录
cd /data/local/redis

# 启动各Redis 节点
nohup /data/local/redis/node-638*/redis-7.0.12/src/redis-server \
    /data/local/redis/node-638*/redis-7.0.12/redis.conf &gt; /dev/null 2&gt;&amp;1 &amp;

# 创建Redis Cluster集群
/data/local/redis/node-6381/redis-7.0.12/src/redis-cli  -a 5pKu5D8Lm \
    --cluster create 192.168.56.102:6381 192.168.56.102:6382 \
        192.168.56.102:6383 192.168.56.102:6384 \
        192.168.56.102:6385 192.168.56.102:6386 \
    --cluster-replicas 1 
</code></pre>
<h3 id="7单节点安装">7、单节点安装</h3>
<pre><code class="language-shell"># 创建目录
mkdir -p /data/local/redis/single

# 解压缩redis-7.0.12.tar.gz
tar -xzvf redis-7.0.12.tar.gz -C /data/local/redis/single

# 添加服务注册文件
cat &gt; /etc/systemd/system/redis.service &lt;&lt; EOF
[Unit]
Description=Redis Server
After=network.target

[Service]
ExecStart=/data/local/redis/single/redis-7.0.12/src/redis-server /data/local/redis/single/redis-7.0.12/redis.conf
ExecStop=/data/local/redis/single/redis-7.0.12/src/redis-cli shutdown
User=root
Group=root
Restart=always

[Install]
WantedBy=multi-user.target
EOF

# 重新加载 systemd
systemctl daemon-reload

# 启动pgsql并查看状态
systemctl start redis
systemctl status redis
systemctl stop redis
systemctl restart redis

# 状态正常即可设置开机自启
systemctl enable redis
systemctl disable redis
</code></pre>
<h2 id="八服务部署">八、服务部署</h2>
<h3 id="1前端配置文件">1、前端配置文件</h3>
<ol>
<li><code>nginx</code>根配置文件 <code>/data/local/nginx/nginx.conf</code></li>
</ol>
<pre><code class="language-conf">user  nginx;
worker_processes  auto;

error_log  logs/error.log notice;
pid        logs/nginx.pid;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;
                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;
                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;

    access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    types {
        application/vnd.ms-fontobject   eot;
        font/ttf                        ttf;
        font/opentype                   otf;
        font/x-woff                     woff;
        image/svg+xml                   svg;
    }

    # websocket
    map $http_upgrade $connection_upgrade {
        default upgrade;
        &#x27;&#x27;      close;
    }

    # gzip config
    gzip            on;
    gzip_min_length 1k;
    gzip_comp_level 6;
    gzip_types      text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php     image/jpeg image/gif image/png font/ttf font/opentype font/x-woff;
    gzip_vary       on;
    gzip_disable    &quot;MSIE [1-6]\.&quot;;

    proxy_buffer_size           1024k;
    proxy_buffers               16  1024k;
    proxy_busy_buffers_size     2048k;
    proxy_temp_file_write_size  2048k;

    client_header_timeout       120;
    client_body_timeout         120;
    send_timeout                120;
    client_max_body_size        10m;

    include /data/local/nginx/conf.d/*.conf;
}
</code></pre>
<ol start="2">
<li>平台前端配置文件 <code>/data/local/nginx/conf.d/platform.conf</code></li>
</ol>
<pre><code class="language-conf">upstream platform_oauth {  
   server 192.168.0.21:31888;   
}

upstream platform_system {  
   server 192.168.0.21:31112;   
}

upstream platform_thing {  
   server 192.168.0.21:31111;   
}

upstream platform_message {  
   server 192.168.0.21:31890;   
}

upstream platform_workflow {  
   server 192.168.0.21:31113;   
}

upstream platform_plugin {  
   server 192.168.0.21:31116;   
}

server {
    listen       9096;
    server_name  localhost;

    #charset koi8-r;

    #access_log  logs/host.access.log  main;
    location / {
        root   html/platform;
        index  index.html index.htm;
        if (!-e $request_filename) {
            rewrite ^(.*)$ /index.html?s=$1 last;
            break;
        }
    }

    location /monitor {
        alias  html/monitor;
        index  index.html index.htm;
    }

    # 后台代理配置 以auth服务为例
    location ^~ /oauth/ {
        proxy_pass              http://platform_oauth;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    location ^~ /system/ {
        proxy_pass              http://platform_system;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    location ^~ /thing/ {
        proxy_pass              http://platform_thing;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    location ^~ /message/ {
        proxy_pass              http://platform_message;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    location ^~ /workflow/ {
        proxy_pass              http://platform_workflow;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    location ^~ /plugin/ {
        proxy_pass              http://platform_plugin;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    location ^~ /ws/ {
        proxy_pass              http://platform_thing;
        client_max_body_size    100m;
        proxy_redirect          default;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }
    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
}
</code></pre>
<ol>
<li>业务前端配置文件 <code>/data/local/nginx/conf.d/business.conf</code></li>
</ol>
<pre><code class="language-conf">upstream business_main {  
   server 192.168.0.21:31222;   
}

upstream business_demo {  
   server 192.168.0.21:31223;   
}

server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;

    #access_log  logs/host.access.log  main;

    #解决Router(mode: &#x27;history&#x27;)模式下，刷新路由地址不能找到页面的问题
    location / {
        root   html/business;
        index  index.html index.htm;
        if (!-e $request_filename) {
            rewrite ^(.*)$ /index.html?s=$1 last;
            break;
        }
    }

    location /monitor {
        alias  html/monitor;
        index  index.html index.htm;
    }

    location ^~ /business/ {
        proxy_pass              http://business_main;
        proxy_http_version      1.1;
        proxy_read_timeout      900s;
        proxy_set_header        Host $http_host;
        proxy_set_header        X-Real-IP $remote_addr;
        proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header        X-NginX-Proxy true;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade
    }

    # 使用捕获组 $1 来传递剩余路径 /demo/123 -&gt; /123
    location ~ ^/demo(/.*)$ {
        proxy_pass http://business_demo$1;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
}
</code></pre>
<h3 id="2前端部署">2、前端部署</h3>
<pre><code class="language-shell"># 打包
npm run build

# 压缩dist 得到 dist.zip
# 将文件上传到服务器
scp D:/frontend/dist.zip root@192.168.0.21:/data/local/nginx/html/

# 解压
unzip dist.zip -d ./frontend

# 重启Nginx
systemctl restart nginx
</code></pre>
<h3 id="3后端配置文件">3、后端配置文件</h3>
<ol>
<li>打包镜像配置文件 <code>Dockerfile</code></li>
</ol>
<pre><code class="language-Dockerfile">FROM frolvlad/alpine-oraclejdk8:slim
VOLUME /tmp
ADD auth-service.jar /
RUN sh -c &#x27;touch /auth-service.jar&#x27;
ENV JAVA_OPTS=&quot;-Duser.timezone=Asia/Shanghai -Xms1g -Xmx2g&quot;
ENTRYPOINT [ &quot;sh&quot;, &quot;-c&quot;, &quot;java ${JAVA_OPTS} -jar /auth-service.jar&quot; ]
</code></pre>
<ol start="2">
<li>k8s部署配置文件 <code>K8s.yaml</code></li>
</ol>
<pre><code class="language-yaml">apiVersion: v1
kind: Service
metadata:
  name: svc-auth-service
  namespace: svc-platform
spec:
  type: NodePort
  selector:
    app: auth-service
  ports:
    - name: http
      port: 31888
      targetPort: 31888
      nodePort: 31888
      protocol: TCP

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: dep-auth-service
  namespace: svc-platform
spec:
  minReadySeconds: 5
  revisionHistoryLimit: 3
  strategy:
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 1
  replicas: 1
  selector:
    matchLabels:
      app: auth-service
      version: &quot;1.0.0&quot;
  template:
    metadata:
      labels:
        app: auth-service
        version: &quot;1.0.0&quot;
    spec:
      imagePullSecrets:
        - name: dockerimage
      containers:
        - name: auth-service
          image: 192.168.0.22:5000/auth-service:1.0.0
          imagePullPolicy: Always
          ports:
            - containerPort: 31888
          # 启动探针，检测系统是否启动成功
          startupProbe:
            httpGet:
              path: /oauth/actuator/health/readiness
              port: 31888
            periodSeconds: 10 # 探测时间间隔
            timeoutSeconds: 5 # 超时时间
            failureThreshold: 30 # 重试次数
          # 存活探针，检测系统是否存活
          livenessProbe:
            httpGet:
              path: /oauth/actuator/health/liveness
              port: 31888
            initialDelaySeconds: 5
            periodSeconds: 5
            timeoutSeconds: 20
            failureThreshold: 3
          resources:
            limits:
              cpu: &quot;2&quot;
              memory: &quot;2048Mi&quot;
            requests:
              cpu: &quot;1&quot;
              memory: &quot;1024Mi&quot;
</code></pre>
<ol>
<li>部署脚本 <code>deploy.sh</code></li>
</ol>
<pre><code class="language-shell">#!/bin/bash

# 定义镜像名称和版本默认值
image_name=&quot;&quot;
image_version=&quot;&quot;
image_registry=&quot;&quot;

# 使用getopts来解析选项和参数
while getopts &quot;i:v:-:&quot; opt; do
    case &quot;$opt&quot; in
        i|image)
            image_name=&quot;$OPTARG&quot;
            ;;
        v|version)
            image_version=&quot;$OPTARG&quot;
            ;;
        r|registry)
            image_registry=&quot;$OPTARG&quot;
            ;;
        -)
            case &quot;${OPTARG}&quot; in
                image=*)
                    image_name=&quot;${OPTARG#*=}&quot;
                    ;;
                version=*)
                    image_version=&quot;${OPTARG#*=}&quot;
                    ;;
                registry=*)
                    image_registry=&quot;${OPTARG#*=}&quot;
                    ;;
                *)
                    echo &quot;Invalid option: --$OPTARG&quot; &gt;&amp;2
                    exit 1
                    ;;
            esac
            ;;
        *)
            echo &quot;Invalid option: -$OPTARG&quot; &gt;&amp;2
            exit 1
            ;;
    esac
done

# 检查参数是否已提供
if [ -z &quot;$image_name&quot; ] || [ -z &quot;$image_version&quot; ]; then
    echo &quot;Usage: $0 -i|--image &lt;image_name&gt; -v|--version &lt;version_no&gt; -r|--registry &lt;registry_address&gt;&quot;
    exit 1
fi


# 获取当前日期和时间，用于创建备份文件和标记
timestamp=$(date +%Y%m%d%H%M%S)

# 备份镜像为tar文件
docker save -o &quot;${image_name}_${image_version}_${timestamp}.tar&quot; &quot;${image_name}:${image_version}&quot; || echo &quot;continue execute&quot;
docker rmi ${image_name}:${image_version} || echo &quot;continue execute&quot;

# 构建新的Docker镜像
docker build -t &quot;${image_name}:${image_version}&quot; .

# 推送新的Docker镜像到镜像仓库
if [ &quot;$image_registry&quot; ]; then
    docker rmi ${image_registry}/${image_name}:${image_version} || echo &quot;continue execute&quot;
    docker tag ${image_name}:${image_version} ${image_registry}/${image_name}:${image_version}
    docker push ${image_registry}/${image_name}:${image_version}
fi

export KUBECONFIG=&quot;/root/.kube/config&quot;
export PATH=&quot;$PATH:/var/lib/rancher/rke2/bin/&quot;
# 停止之前的部署
kubectl delete -f k8s.yaml || echo &quot;continue execute&quot;

# 等待3秒
sleep 3

# 在Kubernetes上部署应用程序
kubectl apply -f k8s.yaml || echo &quot;continue execute&quot;
</code></pre>
<h3 id="4后端服务部署">4、后端服务部署</h3>
<pre><code class="language-shell"># 查询namespace
kubectl get namespaces

# 不存在则新建一个 namespace
kubectl create namespace svc-pd-service

# 添加执行权限
chmod +x ./deploy.sh

# 一键部署
./deploy.sh -i auth-service -v 1.0.0


# 查看所有镜像
curl -X GET http://192.168.0.22:5000/v2/_catalog

# 查看指定镜像的所有版本
curl -X GET http://192.168.0.22:5000/v2/auth-service/tags/list

# 查看pod基础信息
kubectl get pods -n svc-pd-service -o wide

# 查看pod详细信息
kubectl describe pod -n svc-pd-service &lt;pod-name&gt;

# 获取ClusterIP用于反向代理
kubectl get svc -n svc-pd-service svc-auth-service 

# 查看日志
kubectl logs -n svc-pd-service dep-auth-service-6674cff5c9-29r78 

# 查看k8s底层容器运行时
kubectl get nodes -o custom-columns=NODE:.metadata.name,RUNTIME:.status.nodeInfo.containerRuntimeVersion

# 查看cri信息
crictl info 
crictl version 

</code></pre>
<hr>
<pre><code class="language-shell"># 打包
mvn clean package -U -Dmaven.test.skip=true

# 编译Docker镜像
docker build backend:1.0.1 .

# 备份镜像
docker save -o backend.tar backend:1.0.1

# 将文件上传到服务器
scp D:/backend/backend.tar root@192.168.0.22:/data/local/services/

# 修改旧版本的tag
docker tag backend:latest backend:1.0.0

# 加载镜像
docker load -i backend.tar

# 修改新版本的tag
docker tag backend:1.0.1 backend:latest
</code></pre>
<h2 id="九安装问题">九、安装问题</h2>
<h3 id="1k8s拉取镜像报错">1、k8s拉取镜像报错</h3>
<p><code>imagePullBackOff</code>  <code>http: server gave HTTP response to HTTPS client</code></p>
<ol>
<li><a href="https://docs.rke2.io/zh/install/containerd_registry_configuration">RKE2</a></li>
</ol>
<pre><code class="language-shell">cat &gt; /etc/rancher/rke2/registries.yaml &lt;&lt; EOF
mirrors:
  &quot;192.168.0.22:5000&quot;:
    endpoint:
      - &quot;http://192.168.0.22:5000&quot;
  docker.io:
    endpoint:
      - &quot;http://192.168.0.22:5000&quot;
EOF

# 修改完成后重启 RKE2
systemctl daemon-reload &amp;&amp; systemctl restart rke2-server
systemctl daemon-reload &amp;&amp; systemctl restart rke2-agent
</code></pre>
<ol>
<li><a href="https://github.com/containerd/containerd/issues/3847">Containerd</a></li>
</ol>
<ul>
<li><a href="https://github.com/containerd/cri/blob/master/docs/registry.md#configure-registry-endpoint">Containerd</a></li>
</ul>
<pre><code class="language-shell">cat &gt; /etc/containerd/config.toml  &lt;&lt; EOF
[plugins]
    [plugins.&quot;io.containerd.grpc.v1.cri&quot;]
        [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry]
            [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors]
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;docker.io&quot;]
                    endpoint = [&quot;https://registry-1.docker.io&quot;]
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;harbor.io&quot;]
                    endpoint = [&quot;https://xxx-harbor.com:7443&quot;]
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.mirrors.&quot;192.168.0.22:5000&quot;]
                    endpoint = [&quot;https://192.168.0.22:5000&quot;]
            [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs]
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;harbor.io&quot;]
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;harbor.io&quot;.tls]
                    insecure_skip_verify = true
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;harbor.io&quot;.auth]
                    username = &quot;admin&quot;
                    password = &quot;Harbor12345&quot;
                [plugins.&quot;io.containerd.grpc.v1.cri&quot;.registry.configs.&quot;192.168.0.22:5000&quot;.tls]
                    insecure_skip_verify = true
EOF

# 修改完成后重启 Containerd
systemctl daemon-reload &amp;&amp; systemctl restart containerd
</code></pre>
<ol>
<li><a href="https://docs.docker.com/registry/insecure/">Docker</a></li>
</ol>
<pre><code class="language-shell">cat &gt; /etc/docker/daemon.json &lt;&lt; EOF
{ 
    &quot;insecure-registries&quot;:[&quot;192.168.0.22:5000&quot;]
}
EOF

# 修改完成后重启 Docker
systemctl daemon-reload &amp;&amp; systemctl restart docker
</code></pre></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/k8s/3-Build-K8s-Offline-With-RKE2.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Cluster-With-Rancher/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Build-K8s-Cluster-With-Rancher</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/docs/zh-cn/k8s/K8s-Commands/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">K8s-Commands</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一基于rke2的k8s部署" class="table-of-contents__link toc-highlight">一、基于RKE2的K8s部署</a><ul><li><a href="#1禁用-selinuxfirewalld-swap" class="table-of-contents__link toc-highlight">1、禁用 SELinux、Firewalld 、Swap</a></li><li><a href="#2设置时间同步" class="table-of-contents__link toc-highlight">2、设置时间同步</a></li><li><a href="#3下载安装包以及镜像文件" class="table-of-contents__link toc-highlight">3、下载安装包以及镜像文件</a></li><li><a href="#4部署-server-节点master" class="table-of-contents__link toc-highlight">4、部署 server 节点(master)</a></li><li><a href="#5部署-agent-节点worker" class="table-of-contents__link toc-highlight">5、部署 agent 节点(worker)</a></li><li><a href="#6删除节点" class="table-of-contents__link toc-highlight">6、删除节点</a></li><li><a href="#7集群重置" class="table-of-contents__link toc-highlight">7、集群重置</a></li></ul></li><li><a href="#二安装pgsql-154" class="table-of-contents__link toc-highlight">二、安装Pgsql 15.4</a><ul><li><a href="#1本地编译源码" class="table-of-contents__link toc-highlight">1、本地编译源码</a></li><li><a href="#2上传解压编译后的包" class="table-of-contents__link toc-highlight">2、上传解压编译后的包</a></li><li><a href="#3初始化数据库" class="table-of-contents__link toc-highlight">3、初始化数据库</a></li><li><a href="#4远程连接" class="table-of-contents__link toc-highlight">4、远程连接</a></li><li><a href="#5设置开机自启" class="table-of-contents__link toc-highlight">5、设置开机自启</a></li></ul></li><li><a href="#三安装influxdb-184" class="table-of-contents__link toc-highlight">三、安装Influxdb 1.8.4</a><ul><li><a href="#1下载-rpm-安装包" class="table-of-contents__link toc-highlight">1、下载 rpm 安装包</a></li><li><a href="#2安装" class="table-of-contents__link toc-highlight">2、安装</a></li><li><a href="#3创建新用户" class="table-of-contents__link toc-highlight">3、创建新用户</a></li><li><a href="#4修改配置文件启动权限验证" class="table-of-contents__link toc-highlight">4、修改配置文件，启动权限验证</a></li></ul></li><li><a href="#四安装minio-release2023-09-16t01-01-47z" class="table-of-contents__link toc-highlight">四、安装Minio RELEASE.2023-09-16T01-01-47Z</a><ul><li><a href="#1下载-rpm-安装包-1" class="table-of-contents__link toc-highlight">1、下载 rpm 安装包</a></li><li><a href="#2编写配置文件启动脚本" class="table-of-contents__link toc-highlight">2、编写配置文件、启动脚本</a></li><li><a href="#3设置开机自启" class="table-of-contents__link toc-highlight">3、设置开机自启</a></li></ul></li><li><a href="#五安装nginx-1221" class="table-of-contents__link toc-highlight">五、安装Nginx 1.22.1</a><ul><li><a href="#1本地编译源码-1" class="table-of-contents__link toc-highlight">1、本地编译源码</a></li><li><a href="#2上传解压编译后的包-1" class="table-of-contents__link toc-highlight">2、上传解压编译后的包</a></li><li><a href="#3启动nginx" class="table-of-contents__link toc-highlight">3、启动nginx</a></li><li><a href="#4设置开机自启" class="table-of-contents__link toc-highlight">4、设置开机自启</a></li></ul></li><li><a href="#六安装emqx-520" class="table-of-contents__link toc-highlight">六、安装EMQX 5.2.0</a><ul><li><a href="#1下载安装包" class="table-of-contents__link toc-highlight">1、下载安装包</a></li><li><a href="#2运行" class="table-of-contents__link toc-highlight">2、运行</a></li><li><a href="#3设置开机自启-1" class="table-of-contents__link toc-highlight">3、设置开机自启</a></li></ul></li><li><a href="#七安装redis-cluster-7012" class="table-of-contents__link toc-highlight">七、安装Redis Cluster 7.0.12</a><ul><li><a href="#1本地编译源码-2" class="table-of-contents__link toc-highlight">1、本地编译源码</a></li><li><a href="#2上传解压编译后的包-2" class="table-of-contents__link toc-highlight">2、上传解压编译后的包</a></li><li><a href="#3修改配置文件" class="table-of-contents__link toc-highlight">3、修改配置文件</a></li><li><a href="#4配置etcsysctlconf" class="table-of-contents__link toc-highlight">4、配置/etc/sysctl.conf</a></li><li><a href="#5启动各redis-节点" class="table-of-contents__link toc-highlight">5、启动各Redis 节点</a></li><li><a href="#7单节点安装" class="table-of-contents__link toc-highlight">7、单节点安装</a></li></ul></li><li><a href="#八服务部署" class="table-of-contents__link toc-highlight">八、服务部署</a><ul><li><a href="#1前端配置文件" class="table-of-contents__link toc-highlight">1、前端配置文件</a></li><li><a href="#2前端部署" class="table-of-contents__link toc-highlight">2、前端部署</a></li><li><a href="#3后端配置文件" class="table-of-contents__link toc-highlight">3、后端配置文件</a></li><li><a href="#4后端服务部署" class="table-of-contents__link toc-highlight">4、后端服务部署</a></li></ul></li><li><a href="#九安装问题" class="table-of-contents__link toc-highlight">九、安装问题</a><ul><li><a href="#1k8s拉取镜像报错" class="table-of-contents__link toc-highlight">1、k8s拉取镜像报错</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>