<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/k8s/Build-K8s-Multi-Master-Cluster" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Build-K8s-Multi-Master-Cluster | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Build-K8s-Multi-Master-Cluster | Light Docusaurus"><meta data-rh="true" name="description" content="一、相关链接"><meta data-rh="true" property="og:description" content="一、相关链接"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e8086d6f.css">
<script src="/assets/js/runtime~main.2519630d.js" defer="defer"></script>
<script src="/assets/js/main.a410c441.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a class="navbar__item navbar__link" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-boot/">Spring Boot</a><button aria-label="展开侧边栏分类 &#x27;Spring Boot&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/active-directory/">Active Directory</a><button aria-label="展开侧边栏分类 &#x27;Active Directory&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/kubernetes/">Kubernetes</a><button aria-label="折叠侧边栏分类 &#x27;Kubernetes&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/k8s/Build-K8s-Single-Master-Cluster/">Build-K8s-Single-Master-Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/k8s/Build-K8s-Cluster-With-Rancher/">Build-K8s-Cluster-With-Rancher</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/k8s/Build-K8s-Offline-With-RKE2/">Build-K8s-Offline-With-RKE2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/k8s/K8s-Commands/">K8s-Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster/">Build-K8s-Multi-Master-Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster-Offline/">Build-K8s-Multi-Master-Cluster-Offline</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/awesome-open-source/">Github Speed UP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/kubernetes/"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Build-K8s-Multi-Master-Cluster</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Build-K8s-Multi-Master-Cluster</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一相关链接">一、相关链接<a href="#一相关链接" class="hash-link" aria-label="一、相关链接的直接链接" title="一、相关链接的直接链接">​</a></h2>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/" target="_blank" rel="noopener noreferrer">Kubernetes生产环境安装注意事项</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/" target="_blank" rel="noopener noreferrer">Kubernetes 容器运行时</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/" target="_blank" rel="noopener noreferrer">使用 kubeadm 引导集群</a></li>
<li><a href="https://docs.docker.com/engine/install/#server" target="_blank" rel="noopener noreferrer">Docker 容器运行时安装</a></li>
<li><a href="https://download.docker.com/linux/centos/8/x86_64/stable/Packages/" target="_blank" rel="noopener noreferrer">Docker rpm安装包下载</a></li>
<li><a href="https://mirantis.github.io/cri-dockerd/usage/install/" target="_blank" rel="noopener noreferrer">安装CRI-Dockerd</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/" target="_blank" rel="noopener noreferrer">Kubernetes运行必要的端口</a></li>
<li></li>
<li><a href="https://kubernetes.io/zh-cn/releases/download/" target="_blank" rel="noopener noreferrer">Kubernetes下载</a></li>
<li><a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.30.md#v13011" target="_blank" rel="noopener noreferrer">Kubernetes更新历史</a></li>
<li><a href="https://www.downloadkubernetes.com/" target="_blank" rel="noopener noreferrer">Kubernetes下载</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/" target="_blank" rel="noopener noreferrer">在 Linux 系统中安装并设置 kubectl</a></li>
<li></li>
<li><a href="https://github.com/helm/helm/releases" target="_blank" rel="noopener noreferrer">开源项目 Helm 用于安装Dashbaord</a></li>
<li><a href="https://github.com/kube-vip/kube-vip" target="_blank" rel="noopener noreferrer">开源项目 kube-vip 控制面虚拟IP</a></li>
<li><a href="https://github.com/cloudnativer/kube-install" target="_blank" rel="noopener noreferrer">开源项目 kube-install 离线安装K8s</a></li>
<li></li>
<li><a href="https://cloud.tencent.com/developer/article/2505531" target="_blank" rel="noopener noreferrer">Kubernetes(k8s)-高可用集群部署v1.32.2(生产可用)</a></li>
<li><a href="https://blog.csdn.net/tonyhi6/article/details/139019297" target="_blank" rel="noopener noreferrer">Centos8.5 基于 k8s v1.30.1 部署高可用集群</a></li>
<li><a href="https://blog.csdn.net/qq_33342132/article/details/135751063" target="_blank" rel="noopener noreferrer">在已有的高可用kubernetes/k8s集群中添加master节点</a></li>
<li><a href="https://bbs.huaweicloud.com/blogs/368244" target="_blank" rel="noopener noreferrer">k8s 集群添加Master和node节点</a></li>
<li><a href="https://blog.csdn.net/Lfwthotpt/article/details/105892926" target="_blank" rel="noopener noreferrer">理论+实操：k8s单节点集群加入master节点</a></li>
<li><a href="https://blog.csdn.net/qq_42895490/article/details/139564373" target="_blank" rel="noopener noreferrer">k8s v1.30.1 高可用版本搭建</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/524772977" target="_blank" rel="noopener noreferrer">Kubernetes 网络插件 Calico 完全运维指南</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二环境介绍">二、环境介绍<a href="#二环境介绍" class="hash-link" aria-label="二、环境介绍的直接链接" title="二、环境介绍的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-软件版本">2.1 软件版本<a href="#21-软件版本" class="hash-link" aria-label="2.1 软件版本的直接链接" title="2.1 软件版本的直接链接">​</a></h3>
<table><thead><tr><th>名称</th><th>版本</th><th>备注</th></tr></thead><tbody><tr><td>操作系统</td><td>CentOS 8.5</td><td>内核版本 4.18.0-348.7.1.el8_5.x86_64</td></tr><tr><td>Kubernates</td><td>1.30.11</td><td></td></tr><tr><td>容器运行时</td><td>Docker-CE-26.1.3-1</td><td></td></tr><tr><td>K8s网络组件</td><td>Calico-v3.25</td><td></td></tr><tr><td>Helm</td><td>helm-v3.17.2</td><td>用于安装Dashboard</td></tr><tr><td>K8s Dashbaord</td><td>kubernetes-dashboard-7.7.0</td><td></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-服务器规划">2.2 服务器规划<a href="#22-服务器规划" class="hash-link" aria-label="2.2 服务器规划的直接链接" title="2.2 服务器规划的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看网络信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看MAC地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip link | grep link/ether</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看 product_uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cat /sys/class/dmi/id/product_uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>操作系统</th><th>内存</th><th>主机名</th><th>IP</th><th>备注</th></tr></thead><tbody><tr><td>Cent OS 8.5</td><td>4G</td><td>k8s-master-01</td><td>192.168.137.121</td><td>Master</td></tr><tr><td>Cent OS 8.5</td><td>4G</td><td>k8s-master-02</td><td>192.168.137.122</td><td>Master</td></tr><tr><td>Cent OS 8.5</td><td>4G</td><td>k8s-master-03</td><td>192.168.137.123</td><td>Master</td></tr><tr><td>Cent OS 8.5</td><td>4G</td><td>k8s-node-01</td><td>192.168.137.131</td><td>Node</td></tr><tr><td>Cent OS 8.5</td><td>4G</td><td>k8s-node-02</td><td>192.168.137.132</td><td>Node</td></tr><tr><td>Cent OS 8.5</td><td>4G</td><td>k8s-node-03</td><td>192.168.137.133</td><td>Node</td></tr><tr><td>-</td><td>-</td><td>vip</td><td>192.168.137.140</td><td>虚拟IP，无实体</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三所有节点准备工作">三、【所有节点】准备工作<a href="#三所有节点准备工作" class="hash-link" aria-label="三、【所有节点】准备工作的直接链接" title="三、【所有节点】准备工作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-创建操作用户">3.1 创建操作用户<a href="#31-创建操作用户" class="hash-link" aria-label="3.1 创建操作用户的直接链接" title="3.1 创建操作用户的直接链接">​</a></h3>
<p>如果没有专门的操作用户，可以按下面的操作创建新的用户，后续操作均使用此新用户来执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 创建用户</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo useradd -m diginn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 设置密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo passwd diginn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 赋予root权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo visudo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 添加如下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">diginn   ALL=(ALL)   ALL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 测试权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">su - diginn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo whoami</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 显示 root   即表示diginn用户有 sudo 权限</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-禁用系统交换分区">3.2 禁用系统交换分区<a href="#32-禁用系统交换分区" class="hash-link" aria-label="3.2 禁用系统交换分区的直接链接" title="3.2 禁用系统交换分区的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 临时禁用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo swapoff -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 永久禁用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i &#x27;/ swap / s/^\(.*\)$/#\1/g&#x27; /etc/fstab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看swap分区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">swapon --show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-禁用-selinux">3.3 禁用 SELinux<a href="#33-禁用-selinux" class="hash-link" aria-label="3.3 禁用 SELinux的直接链接" title="3.3 禁用 SELinux的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 临时禁用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo setenforce 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 永久禁用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i &#x27;s/^SELINUX=enforcing$/SELINUX=permissive/&#x27; /etc/selinux/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查SELinux状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sestatus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">getenforce</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-配置内核参数">3.4 配置内核参数<a href="#34-配置内核参数" class="hash-link" aria-label="3.4 配置内核参数的直接链接" title="3.4 配置内核参数的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 立即生效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ip_vs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ip_vs_rr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ip_vs_sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ip_vs_wrr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe nf_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe br_netfilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe overlay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe nf_nat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe xt_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe veth  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ip_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ip6_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe nf_defrag_ipv6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe ebtables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe dummy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo modprobe xt_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置启动记载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee -a /etc/modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_vs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_vs_rr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_vs_sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_vs_wrr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nf_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">br_netfilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">overlay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nf_nat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xt_conntrack</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">veth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip6_tables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nf_defrag_ipv6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ebtables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dummy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xt_set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 验证是否加载成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lsmod | grep -E &quot;ip_vs|nf_conntrack|br_netfilter|overlay|nf_nat|xt_conntrack|veth|ip_tables|ip6_tables|nf_defrag_ipv6|ebtables|dummy|xt_set&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-配置网络参数">3.5 配置网络参数<a href="#35-配置网络参数" class="hash-link" aria-label="3.5 配置网络参数的直接链接" title="3.5 配置网络参数的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.bridge.bridge-nf-call-iptables  = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.bridge.bridge-nf-call-ip6tables = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.ip_forward                 = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 应用 sysctl 参数而不重新启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sysctl --system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sysctl net.ipv4.ip_forward</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="36-设置主机名和hosts">3.6 设置主机名和hosts<a href="#36-设置主机名和hosts" class="hash-link" aria-label="3.6 设置主机名和hosts的直接链接" title="3.6 设置主机名和hosts的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># master主机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo hostnamectl  set-hostname  k8s-master-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo hostnamectl  set-hostname  k8s-master-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo hostnamectl  set-hostname  k8s-master-03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># node主机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo hostnamectl  set-hostname  k8s-node-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo hostnamectl  set-hostname  k8s-node-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo hostnamectl  set-hostname  k8s-node-03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改/etc/hosts内容（集群内每一个主机都要配置）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee -a /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.137.121   k8s-master-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.137.122   k8s-master-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.137.123   k8s-master-03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.137.131   k8s-node-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.137.132   k8s-node-02</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">192.168.137.133   k8s-node-03</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="37-设置时区">3.7 设置时区<a href="#37-设置时区" class="hash-link" aria-label="3.7 设置时区的直接链接" title="3.7 设置时区的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看时区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timedatectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看所有可用时区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">timedatectl list-timezones</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置为上海时区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo timedatectl set-timezone Asia/Shanghai</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="38-打通节点之间的网络在k8s节点之间直接放行">3.8 打通节点之间的网络，在K8s节点之间直接放行<a href="#38-打通节点之间的网络在k8s节点之间直接放行" class="hash-link" aria-label="3.8 打通节点之间的网络，在K8s节点之间直接放行的直接链接" title="3.8 打通节点之间的网络，在K8s节点之间直接放行的直接链接">​</a></h3>
<p>由于各个组件之间通讯逻辑十分复杂，且不同版本之间的网络规则还存在区别，对于生产环境，建议在不能关闭防火墙的情况下配置节点之间直接放行，</p>
<p><strong>如果按此处配置，后续关于开放网络端口的命令都可以跳过。</strong></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在防火墙中启用 Masquerade（NAT）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-masquerade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># K8s的Master 节点及Node节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.137.121/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.137.122/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.137.123/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.137.131/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.137.132/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.137.133/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Service 网络及 Pod网络</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.244.0.0/16&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;10.96.0.0/12&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许 Pod 网段到网关 DNS（192.168.137.1）的 UDP 53 流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果是在虚拟机部署，这里是物理机的ip，同时注意物理机关闭防火墙，避免pod网络dns请求报错</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=ipv4 source address=10.244.0.0/16 destination address=192.168.137.1/32 port port=53 protocol=udp accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许 Pod 网段到外部 DNS（如 8.8.8.8）的 UDP 53 流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-rich-rule=&#x27;rule family=ipv4 source address=10.244.0.0/16 destination address=8.8.8.8/32 port port=53 protocol=udp accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 【Calico】 IP-in-IP 需要开放协议号为4的流量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule protocol value=&quot;4&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 【Keepalived】添加永久规则允许VRRP协议</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-protocol=vrrp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 【Keepalived】若上述命令报错（协议名称不支持），改用富规则指定协议号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule protocol value=&quot;112&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 【Keepalived】VRRP默认使用组播地址224.0.0.18。允许相关组播通信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;224.0.0.18/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重新加载防火墙规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-all --zone=public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看规则的输出示例如下</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 ~]$ sudo firewall-cmd --list-all --zone=public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public (active)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  icmp-block-inversion: no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  interfaces: enp0s3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  services: cockpit dhcpv6-client ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  protocols: vrrp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  forward: no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  masquerade: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  forward-ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source-ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  icmp-blocks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rich rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;192.168.137.131/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;192.168.137.133/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;192.168.137.121/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;10.244.0.0/16&quot; destination address=&quot;192.168.137.1/32&quot; port port=&quot;53&quot; protocol=&quot;udp&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;10.244.0.0/16&quot; destination address=&quot;8.8.8.8/32&quot; port port=&quot;53&quot; protocol=&quot;udp&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule protocol value=&quot;4&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;192.168.137.132/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule protocol value=&quot;112&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;192.168.137.122/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;224.0.0.18/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;192.168.137.123/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;10.96.0.0/12&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rule family=&quot;ipv4&quot; source address=&quot;10.244.0.0/16&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪  贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="39-配置防火墙放行规则">3.9 配置防火墙放行规则<a href="#39-配置防火墙放行规则" class="hash-link" aria-label="3.9 配置防火墙放行规则的直接链接" title="3.9 配置防火墙放行规则的直接链接">​</a></h3>
<ul>
<li><a href="https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/" target="_blank" rel="noopener noreferrer">Kubernates运行必要的端口</a></li>
</ul>
<p>经实际多次测试，这个接口列表缺少很多端口，仅kubernetes核心的端口，一些必要的组件端口并没有列出来，同一组件在不同工作模式下的规则还不相同，建议第一次部署时关闭防火墙。</p>
<p>控制面</p>
<table><thead><tr><th>协议</th><th>方向</th><th>端口范围</th><th>目的</th><th>使用者</th></tr></thead><tbody><tr><td>TCP</td><td>入站</td><td>6443</td><td>Kubernetes API 服务器</td><td>所有</td></tr><tr><td>TCP</td><td>入站</td><td>2379-2380</td><td>etcd 服务器客户端 API</td><td>kube-apiserver、etcd</td></tr><tr><td>TCP</td><td>入站</td><td>10250</td><td>kubelet API</td><td>自身、控制面</td></tr><tr><td>TCP</td><td>入站</td><td>10259</td><td>kube-scheduler</td><td>自身</td></tr><tr><td>TCP</td><td>入站</td><td>10257</td><td>kube-controller-manager</td><td>自身</td></tr></tbody></table>
<p>工作节点</p>
<table><thead><tr><th>协议</th><th>方向</th><th>端口范围</th><th>目的</th><th>使用者</th></tr></thead><tbody><tr><td>TCP</td><td>入站</td><td>10250</td><td>kubelet API</td><td>自身、控制面</td></tr><tr><td>TCP</td><td>入站</td><td>10256</td><td>kube-proxy</td><td>自身、负载均衡器</td></tr><tr><td>TCP</td><td>入站</td><td>30000-32767</td><td>NodePort Services†</td><td>所有</td></tr></tbody></table>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 关闭防火墙（不推荐）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl stop firewalld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl disable firewalld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">## 打开端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=6443/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=2379-2380/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=10250/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=10256/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=10257/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=10259/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=30000-32767/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HTTP HTTPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=80/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=443/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CoreDNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=53/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=53/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=9153/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DHCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=67/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=68/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ETCD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=6666/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=6667/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启防火墙</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看开放的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看所有防火墙规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以用 <code>netcat</code> 检查端口是否开放</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装netcat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf install -y nc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nc 127.0.0.1 6443 -zv -w 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="310-在线依赖项安装">3.10 【在线】依赖项安装<a href="#310-在线依赖项安装" class="hash-link" aria-label="3.10 【在线】依赖项安装的直接链接" title="3.10 【在线】依赖项安装的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf install -y vim wget tar unzip ebtables ethtool nc net-tools yum-utils iproute-tc ipset ipvsadm bash-completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="310-离线依赖项安装">3.10 【离线】依赖项安装<a href="#310-离线依赖项安装" class="hash-link" aria-label="3.10 【离线】依赖项安装的直接链接" title="3.10 【离线】依赖项安装的直接链接">​</a></h3>
<ul>
<li><a href="https://mirrors.aliyun.com/centos/8.5.2111/BaseOS/x86_64/os/Packages/" target="_blank" rel="noopener noreferrer">阿里云CentOS8镜像</a></li>
</ul>
<p><strong>注意</strong> 需要本地准备一台与服务器系统版本一致的虚拟机，在虚拟机上下载各种依赖包</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 需要先安装 yum-utils 来下载其他的依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl https://mirrors.aliyun.com/centos/8.5.2111/BaseOS/x86_64/os/Packages/yum-utils-4.0.21-3.el8.noarch.rpm -o ./yum-utils-4.0.21-3.el8.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rpm -ivh yum-utils-4.0.21-3.el8.noarch.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 本地虚拟机下载依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/lib/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/vim             vim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/tar             tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/unzip           unzip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/wget            wget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/tree            tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/nc              nc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/ebtables        ebtables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/ethtool         ethtool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/net-tools       net-tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/iproute-tc      iproute-tc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/ipset           ipset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/ipvsadm         ipvsadm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./lib/bash-completion bash-completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HAProxy Keepalived Nginx 单独目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./haproxy     haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./keepalived  keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./nginx       nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 打包依赖为压缩包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zcvf lib.tar.gz ./lib </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 下载完成后传输到内网机器上</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. 内网机安装安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/vim/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/tar/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/unzip/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/wget/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/nc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/ebtables/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/ethtool/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/net-tools/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/iproute-tc/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/ipset/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/ipvsadm/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./lib/bash-completion/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四所有节点docker安装配置容器运行时">四、【所有节点】Docker安装配置（容器运行时）<a href="#四所有节点docker安装配置容器运行时" class="hash-link" aria-label="四、【所有节点】Docker安装配置（容器运行时）的直接链接" title="四、【所有节点】Docker安装配置（容器运行时）的直接链接">​</a></h2>
<ul>
<li><a href="https://docs.docker.com/engine/install/centos/" target="_blank" rel="noopener noreferrer">CentOS安装Docker</a></li>
<li><a href="https://developer.aliyun.com/mirror/docker-ce" target="_blank" rel="noopener noreferrer">阿里云Docker镜像</a></li>
<li><a href="https://download.docker.com/linux/centos/8/x86_64/stable/Packages/" target="_blank" rel="noopener noreferrer">Docker离线安装包下载</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-卸载已有docker-engine">4.1 卸载已有Docker Engine<a href="#41-卸载已有docker-engine" class="hash-link" aria-label="4.1 卸载已有Docker Engine的直接链接" title="4.1 卸载已有Docker Engine的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf remove docker \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-client \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-client-latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-common \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-latest-logrotate \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-logrotate \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                docker-engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-添加docker-yum仓库">4.2 添加Docker yum仓库<a href="#42-添加docker-yum仓库" class="hash-link" aria-label="4.2 添加Docker yum仓库的直接链接" title="4.2 添加Docker yum仓库的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 添加docker仓库源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf install -y dnf-plugins-core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果官方源下载速度慢，可以使用阿里源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看Docker源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/yum.repos.d/docker-ce.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-在线安装docker">4.3 【在线】安装Docker<a href="#43-在线安装docker" class="hash-link" aria-label="4.3 【在线】安装Docker的直接链接" title="4.3 【在线】安装Docker的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看Docker的版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf list docker-ce.x86_64 --showduplicates | sort -r</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装最新版本Docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装指定版本的Docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># sudo dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-1:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 运行Docker Engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将当前用户加入到docker操作组 设置完后需要重新登录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -aG docker $USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试Docker是否安装成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run hello-world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-离线安装docker">4.3 【离线】安装Docker<a href="#43-离线安装docker" class="hash-link" aria-label="4.3 【离线】安装Docker的直接链接" title="4.3 【离线】安装Docker的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/docker/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载安装包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/containerd.io-1.6.9-3.1.el8.x86_64.rpm -o ./docker/containerd.io-1.6.9-3.1.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-buildx-plugin-0.14.0-1.el8.x86_64.rpm -o ./docker/docker-buildx-plugin-0.14.0-1.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-26.1.3-1.el8.x86_64.rpm -o ./docker/docker-ce-26.1.3-1.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-cli-26.1.3-1.el8.x86_64.rpm -o ./docker/docker-ce-cli-26.1.3-1.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-rootless-extras-26.1.3-1.el8.x86_64.rpm -o ./docker/docker-ce-rootless-extras-26.1.3-1.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-compose-plugin-2.6.0-3.el8.x86_64.rpm -o ./docker/docker-compose-plugin-2.6.0-3.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-scan-plugin-0.23.0-1.el8.x86_64.rpm -o ./docker/docker-scan-plugin-0.23.0-1.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载依赖包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-ce              docker-ce </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-ce-cli          docker-ce-cli</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./docker/containerd             containerd.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-buildx-plugin   docker-buildx-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-compose-plugin  docker-compose-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装离线包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./docker/docker-ce/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./docker/docker-ce-cli/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./docker/containerd/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./docker/docker-buildx-plugin/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./docker/docker-compose-plugin/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 运行Docker Engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将当前用户加入到docker操作组 设置完后需要重新登录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo usermod -aG docker $USER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 测试Docker是否安装成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run hello-world</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-如果需要卸载使用以下命令">4.4 如果需要卸载，使用以下命令<a href="#44-如果需要卸载使用以下命令" class="hash-link" aria-label="4.4 如果需要卸载，使用以下命令的直接链接" title="4.4 如果需要卸载，使用以下命令的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 卸载 docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo dnf remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除相关目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rm -rf /var/lib/docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rm -rf /var/lib/containerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="45-配置docker驱动及镜像仓库">4.5 配置Docker驱动及镜像仓库<a href="#45-配置docker驱动及镜像仓库" class="hash-link" aria-label="4.5 配置Docker驱动及镜像仓库的直接链接" title="4.5 配置Docker驱动及镜像仓库的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;log-driver&quot;: &quot;json-file&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;log-opts&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;max-size&quot;: &quot;100m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;storage-driver&quot;: &quot;overlay2&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;registry-mirrors&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://docker.hpcloud.cloud&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://docker.m.daocloud.io&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://docker.unsee.tech&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://docker.1panel.live&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http://mirrors.ustc.edu.cn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://docker.chenby.cn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;http://mirror.azure.cn&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://dockerpull.org&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://dockerhub.icu&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;https://hub.rat.dev&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="46-安装cri-dockerd驱动docker与k8s集成的适配层">4.6 安装cri-dockerd驱动（Docker与K8s集成的适配层）<a href="#46- 安装cri-dockerd驱动docker与k8s集成的适配层" class="hash-link" aria-label="4.6 安装cri-dockerd驱动（Docker与K8s集成的适配层）的直接链接" title="4.6 安装cri-dockerd驱动（Docker与K8s集成的适配层）的直接链接">​</a></h3>
<ul>
<li><a href="https://mirantis.github.io/cri-dockerd/usage/install/" target="_blank" rel="noopener noreferrer">CRI-Dockerd安装文档</a></li>
</ul>
<p>Docker Engine 没有实现 <a href="https://kubernetes.io/zh-cn/docs/concepts/architecture/cri/" target="_blank" rel="noopener noreferrer">CRI</a>， 而这是容器运行时在 Kubernetes 中工作所需要的。 为此，必须安装一个额外的服务 <a href="https://github.com/Mirantis/cri-dockerd" target="_blank" rel="noopener noreferrer">cri-dockerd</a>。 cri-dockerd 是一个基于传统的内置 Docker 引擎支持的项目， 它在 1.24 版本从 kubelet 中<a href="https://kubernetes.io/zh-cn/dockershim" target="_blank" rel="noopener noreferrer">移除</a>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="461-推荐rpm安装">4.6.1 【推荐】rpm安装<a href="#461-推荐rpm安装" class="hash-link" aria-label="4.6.1 【推荐】rpm安装的直接链接" title="4.6.1 【推荐】rpm安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/cri/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.14/cri-dockerd-0.3.14-3.el8.x86_64.rpm -o ./cri/cri-dockerd-0.3.14-3.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./cri/cri-dockerd-0.3.14-3.el8.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable cri-docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start cri-docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status cri-docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查CRI套接字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="462-源码安装">4.6.2 源码安装<a href="#462-源码安装" class="hash-link" aria-label="4.6.2 源码安装的直接链接" title="4.6.2 源码安装的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/cri/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载 cri-dockerd（注意系统版本，这里是amd64）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.14/cri-dockerd-0.3.14.amd64.tgz -o ./cri/cri-dockerd-0.3.14.amd64.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.121:/home/diginn/k8s-install/cri/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.123:/home/diginn/k8s-install/cri/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.131:/home/diginn/k8s-install/cri/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.132:/home/diginn/k8s-install/cri/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">scp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.133:/home/diginn/k8s-install/cri/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf ./cri/cri-dockerd-0.3.14.amd64.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 移动到系统路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv ./cri/cri-dockerd/cri-dockerd /usr/local/bin/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="463-仅源码安装注册为系统服务">4.6.3 【仅源码安装】注册为系统服务<a href="#463-仅源码安装注册为系统服务" class="hash-link" aria-label="4.6.3 【仅源码安装】注册为系统服务的直接链接" title="4.6.3 【仅源码安装】注册为系统服务的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo tee /etc/systemd/system/cri-docker.service &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=CRI Interface for Docker Application Container Engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Documentation=https://docs.mirantis.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=network-online.target firewalld.service docker.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Wants=network-online.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Requires=cri-docker.socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/usr/local/bin/cri-dockerd --container-runtime-endpoint fd:// --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecReload=/bin/kill -s HUP $MAINPID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TimeoutSec=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RestartSec=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=always</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Note that StartLimit* options were moved from &quot;Service&quot; to &quot;Unit&quot; in systemd 229.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Both the old, and new location are accepted by systemd 229 and up, so using the old location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># to make them work for either version of systemd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StartLimitBurst=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Both the old, and new name are accepted by systemd 230 and up, so using the old name to make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># this option work for either version of systemd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StartLimitInterval=60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LimitNOFILE=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LimitNPROC=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LimitCORE=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Comment TasksMax if your systemd version does not support it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Only systemd 226 and above support this option.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TasksMax=infinity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Delegate=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KillMode=process</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cri-docker.socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo tee /etc/systemd/system/cri-docker.socket &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=CRI Docker Socket for the API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PartOf=cri-docker.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Socket]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ListenStream=%t/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SocketMode=0660</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SocketUser=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SocketGroup=docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=sockets.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="464-仅源码安装启动-cri-dockerd">4.6.4 【仅源码安装】启动 cri-dockerd<a href="#464-仅源码安装启动-cri-dockerd" class="hash-link" aria-label="4.6.4 【仅源码安装】启动 cri-dockerd的直接链接" title="4.6.4 【仅源码安装】启动 cri-dockerd的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 启动cri-dockerd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now cri-docker.socket</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查CRI套接字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对于 <code>cri-dockerd</code>，默认情况下，CRI 套接字是 <code>/run/cri-dockerd.sock</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五所有节点安装-kubeadmkubelet-和-kubectl">五、【所有节点】安装 kubeadm、kubelet 和 kubectl<a href="#五所有节点安装-kubeadmkubelet-和-kubectl" class="hash-link" aria-label="五、【所有节点】安装 kubeadm、kubelet 和 kubectl的直接链接" title="五、【所有节点】安装 kubeadm、kubelet 和 kubectl的直接链接">​</a></h2>
<ul>
<li><a href="https://www.downloadkubernetes.com/" target="_blank" rel="noopener noreferrer">Kubernetes下载</a></li>
</ul>
<p>需要在每台机器上安装以下的软件包：</p>
<ul>
<li>
<p><code>kubeadm</code>：用来初始化集群的指令。</p>
</li>
<li>
<p><code>kubelet</code>：在集群中的每个节点上用来启动 Pod 和容器等。</p>
</li>
<li>
<p><code>kubectl</code>：用来与集群通信的命令行工具。</p>
</li>
<li>
<p><code>Pod</code>: Kubernetes的最小工作单元。每个<code>Pod</code>包含一个或多个容器。<code>Pod</code>中的容器会作为一个整体被<code>Master</code>调度到一个<code>Node</code>上运行.</p>
</li>
</ul>
<p><code>kubeadm</code> 不能帮你安装或者管理 <code>kubelet</code> 或 <code>kubectl</code>， 所以你需要确保它们与通过 <code>kubeadm</code> 安装的控制平面的版本相匹配。 如果不这样做，则存在发生版本偏差的风险，可能会导致一些预料之外的错误和问题。 然而，控制平面与 <code>kubelet</code> 之间可以存在一个次要版本的偏差，但 <code>kubelet</code> 的版本不可以超过 API 服务器的版本。 例如，1.7.0 版本的 <code>kubelet</code> 可以完全兼容 1.8.0 版本的 API 服务器，反之则不可以。</p>
<p>有关安装 <code>kubectl</code> 的信息，请参阅<a href="https://kubernetes.io/zh-cn/docs/tasks/tools/" target="_blank" rel="noopener noreferrer">安装和设置 kubectl</a> 文档。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-确保每个节点上-mac-地址和-product_uuid-的唯一性">5.1 确保每个节点上 MAC 地址和 product_uuid 的唯一性<a href="#51-确保每个节点上-mac-地址和-product_uuid-的唯一性" class="hash-link" aria-label="5.1 确保每个节点上 MAC 地址和 product_uuid 的唯一性的直接链接" title="5.1 确保每个节点上 MAC 地址和 product_uuid 的唯一性的直接链接">​</a></h3>
<blockquote>
<p>你可以使用命令 <code>ip link</code> 或 <code>ifconfig -a</code> 来获取网络接口的 MAC 地址</p>
</blockquote>
<blockquote>
<p>可以使用 <code>sudo cat /sys/class/dmi/id/product_uuid</code> 命令对 <code>product_uuid</code> 校验</p>
</blockquote>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip link | grep link/ether</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看 product_uuid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cat /sys/class/dmi/id/product_uuid</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-添加-kubernetes-的-yum-仓库">5.2 添加 Kubernetes 的 yum 仓库<a href="#52-添加-kubernetes-的-yum-仓库" class="hash-link" aria-label="5.2 添加 Kubernetes 的 yum 仓库的直接链接" title="5.2 添加 Kubernetes 的 yum 仓库的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 此操作会覆盖 /etc/yum.repos.d/kubernetes.repo 中现存的所有配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[kubernetes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseurl=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgkey=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/repodata/repomd.xml.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exclude=kubelet kubeadm kubectl cri-tools kubernetes-cni</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果慢，可以改成阿里云的源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[kubernetes]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name=Kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enabled=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgcheck=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpgkey=https://mirrors.aliyun.com/kubernetesnew/core/stable/v1.30/rpm/repodata/repomd.xml.key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-在线安装-kubeletkubeadm-和-kubectl">5.3 【在线】安装 kubelet、kubeadm 和 kubectl<a href="#53-在线安装-kubeletkubeadm-和-kubectl" class="hash-link" aria-label="5.3 【在线】安装 kubelet、kubeadm 和 kubectl的直接链接" title="5.3 【在线】安装 kubelet、kubeadm 和 kubectl的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 kubelet、kubeadm 和 kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm version </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version --client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubelet --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/k8s安装1-a97dd6f2888b352f36edba06a3a56a0c.png" width="1661" height="916" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/k8s安装2-da6542721734d458e93808727b2e8693.png" width="1661" height="916" class="img_ev3q"></p>
<p>修改配置</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo vim /etc/sysconfig/kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将KUBELET_EXTRA_ARGS 的值设置为</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=systemd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启用 kubelet 以确保它在启动时自动启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-离线安装-kubeletkubeadm-和-kubectl">5.3 【离线】安装 kubelet、kubeadm 和 kubectl<a href="#53-离线安装-kubeletkubeadm-和-kubectl" class="hash-link" aria-label="5.3 【离线】安装 kubelet、kubeadm 和 kubectl的直接链接" title="5.3 【离线】安装 kubelet、kubeadm 和 kubectl的直接链接">​</a></h3>
<ul>
<li><a href="https://www.downloadkubernetes.com/" target="_blank" rel="noopener noreferrer">Kubernetes下载</a></li>
<li><a href="https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/" target="_blank" rel="noopener noreferrer">阿里云Kubeadm Kubectl Kubelet下载</a></li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/k8s/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 二进制包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/apiextensions-apiserver ./k8s/apiextensions-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-aggregator         ./k8s/kube-aggregator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-apiserver          ./k8s/kube-apiserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-controller-manager ./k8s/kube-controller-manager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-log-runner         ./k8s/kube-log-runner</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-proxy              ./k8s/kube-proxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-scheduler          ./k8s/kube-scheduler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubeadm                 ./k8s/kubeadm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubectl                 ./k8s/kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubectl-convert         ./k8s/kubectl-convert</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubelet                 ./k8s/kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://dl.k8s.io/v1.30.11/bin/linux/amd64/mounter                 ./k8s/mounter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 适用于CentOS的RPM包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/kubeadm-1.30.11-150500.1.1.x86_64.rpm -O ./k8s/kubeadm-1.30.11-150500.1.1.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/kubectl-1.30.11-150500.1.1.x86_64.rpm -O ./k8s/kubectl-1.30.11-150500.1.1.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/kubelet-1.30.11-150500.1.1.x86_64.rpm -O ./k8s/kubelet-1.30.11-150500.1.1.x86_64.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 下载依赖包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./k8s/kubeadm kubeadm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./k8s/kubectl kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yumdownloader --archlist=x86_64 --resolve --destdir=./k8s/kubelet kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 安装 kubelet、kubeadm 和 kubectl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./k8s/kubeadm/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./k8s/kubectl/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./k8s/kubelet/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改配置</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo vim /etc/sysconfig/kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将KUBELET_EXTRA_ARGS 的值设置为</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=systemd&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启用 kubelet 以确保它在启动时自动启动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now kubelet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-下载k8s依赖镜像">5.4 下载K8s依赖镜像<a href="#54-下载k8s依赖镜像" class="hash-link" aria-label="5.4 下载K8s依赖镜像的直接链接" title="5.4 下载K8s依赖镜像的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看初始化所需的镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm config images list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 拉取镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm config images pull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 官方下载慢，可以使用阿里云的下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/kube-apiserver:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/kube-controller-manager:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/kube-scheduler:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/kube-proxy:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/coredns:v1.11.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/pause:3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull registry.aliyuncs.com/google_containers/etcd:3.5.15-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重新打Tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/kube-apiserver:v1.30.11          registry.k8s.io/kube-apiserver:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/kube-controller-manager:v1.30.11 registry.k8s.io/kube-controller-manager:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/kube-scheduler:v1.30.11          registry.k8s.io/kube-scheduler:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/kube-proxy:v1.30.11              registry.k8s.io/kube-proxy:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/coredns:v1.11.3                  registry.k8s.io/coredns/coredns:v1.11.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/pause:3.9                        registry.k8s.io/pause:3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.aliyuncs.com/google_containers/etcd:3.5.15-0                    registry.k8s.io/etcd:3.5.15-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除阿里云Tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/kube-apiserver:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/kube-controller-manager:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/kube-scheduler:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/kube-proxy:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/coredns:v1.11.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/pause:3.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker rmi registry.aliyuncs.com/google_containers/etcd:3.5.15-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看镜像列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker image list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 导出镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./docker_image_tool.sh export ~/k8s-install/images/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/k8s安装3-38dcadf90f7c6e7423b6d35ad1da94dd.png" width="1661" height="916" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="六仅master节点安装haproxy-keepalived">六、【仅Master节点】安装HAProxy Keepalived<a href="#六仅master节点安装haproxy-keepalived" class="hash-link" aria-label="六、【仅Master节点】安装HAProxy Keepalived的直接链接" title="六、【仅Master节点】安装HAProxy Keepalived的直接链接">​</a></h2>
<p>在 k8s 的高可用配置中，通常使用 haproxy 和 keepalived 作为高可用的组件，对于 k8s 的高可用主要分为两个方面： apiserver 和 etcd。 apiserver 是 k8s 的入口，etcd 则为 k8s 的数据存储。</p>
<p>接下来主要讲述如何对 apiserver 进行高可用的配置，etcd 的高可用配置将在集群的生成的时候，由 kubeadm 进行自行配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-开放端口">6.1 开放端口<a href="#61-开放端口" class="hash-link" aria-label="6.1 开放端口的直接链接" title="6.1 开放端口的直接链接">​</a></h3>
<ul>
<li><a href="https://www.cnblogs.com/tanghu/p/12617840.html" target="_blank" rel="noopener noreferrer">CentOS7下配置防火墙放过Keepalived</a></li>
<li><a href="https://www.cnblogs.com/lgh344902118/p/7737129.html" target="_blank" rel="noopener noreferrer">centos7 keepalived以及防火墙配置</a></li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 添加永久规则允许VRRP协议</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-protocol=vrrp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 若上述命令报错（协议名称不支持），改用富规则指定协议号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule protocol value=&quot;112&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># VRRP默认使用组播地址224.0.0.18。允许相关组播通信</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;224.0.0.18/32&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># HAProxy代理接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --zone=public --add-port=16443/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启防火墙</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看开放的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># protocols: vrrp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rich rules: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     rule protocol value=&quot;112&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#     rule family=&quot;ipv4&quot; source address=&quot;224.0.0.18/32&quot; accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/VIP2-815cdf626c67885544299a174714a9e3.png" width="1676" height="975" class="img_ev3q"></p>
<p>在配置防火墙规则之后，<code>192.168.137.140</code> IP仅在Keepalived主节点上，备份节点没有这个ip，备份节点也可以通过这个IP访问到主节点</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-在线安装keepalived-haproxy">6.2 【在线】安装Keepalived HAProxy<a href="#62-在线安装keepalived-haproxy" class="hash-link" aria-label="6.2 【在线】安装Keepalived HAProxy的直接链接" title="6.2 【在线】安装Keepalived HAProxy的直接链接">​</a></h3>
<p>此步骤所有Master节点都要执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在线安装keepalived haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum install -y keepalived haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线安装keepalived haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ~/k8s-install/haproxy/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ~/k8s-install/keepalived/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 备份配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /etc/keepalived/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /etc/haproxy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-离线安装keepalived-haproxy">6.2 【离线】安装Keepalived HAProxy<a href="#62-离线安装keepalived-haproxy" class="hash-link" aria-label="6.2 【离线】安装Keepalived HAProxy的直接链接" title="6.2 【离线】安装Keepalived HAProxy的直接链接">​</a></h3>
<p>此步骤所有Master节点都要执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 离线安装keepalived haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./haproxy/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo rpm -ivh ./keepalived/*.rpm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 备份配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /etc/keepalived/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ll /etc/haproxy/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-配置haproxy">6.3 配置HAProxy<a href="#63-配置haproxy" class="hash-link" aria-label="6.3 配置HAProxy的直接链接" title="6.3 配置HAProxy的直接链接">​</a></h3>
<p>此步骤所有Master节点都要执行</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/haproxy/haproxy.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log /dev/log    local0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log /dev/log    local1 notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    chroot /var/lib/haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    stats timeout 30s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    group haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">defaults</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    log     global</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode    tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    option  tcplog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    option  dontlognull</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout connect 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout client  50000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeout server  50000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">frontend https-in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bind *:16443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    option tcplog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_backend servers-backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backend servers-backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    balance roundrobin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    option tcp-check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server k8s-master-01 192.168.137.121:6443 check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server k8s-master-02 192.168.137.122:6443 check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server k8s-master-03 192.168.137.123:6443 check</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="64-配置keepalived">6.4 配置Keepalived<a href="#64-配置keepalived" class="hash-link" aria-label="6.4 配置Keepalived的直接链接" title="6.4 配置Keepalived的直接链接">​</a></h3>
<p>此步骤每个Master节点执行对应的配置</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="641-192168137121作为vip的主节点配置文件如下">6.4.1 <code>192.168.137.121</code>作为VIP的主节点，配置文件如下<a href="#641-192168137121作为vip的主节点配置文件如下" class="hash-link" aria-label="641-192168137121作为vip的主节点配置文件如下的直接链接" title="641-192168137121作为vip的主节点配置文件如下的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/keepalived/keepalived.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">! Configuration File for keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id LVS_DEVEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state MASTER                    # 设置为主节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface enp0s3                # 网络接口，根据实际情况修改</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51            # VRRP 路由ID，主备节点必须相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 100                    # 优先级，主节点必须高于备份节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1                    # VRRP通告间隔，单位秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unicast_peer {                  # 配置unicast_peers，指定其他两台服务器的IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.122</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS              # 认证类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1234              # 认证密码，主备节点必须相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.140             # 虚拟IP地址，可以根据实际情况修改</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="642-192168137122作为vip的备份节点配置文件如下">6.4.2 <code>192.168.137.122</code>作为VIP的备份节点，配置文件如下<a href="#642-192168137122作为vip的备份节点配置文件如下" class="hash-link" aria-label="642-192168137122作为vip的备份节点配置文件如下的直接链接" title="642-192168137122作为vip的备份节点配置文件如下的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/keepalived/keepalived.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">! Configuration File for keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id LVS_DEVEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state BACKUP                    # 设置为备份节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface enp0s3                # 确保使用正确的网络接口名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51            # VRRP 路由ID，主备节点必须相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 50                     # 优先级，备份节点必须低于主节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1                    # VRRP通告间隔，单位秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unicast_peer {                  # 配置unicast_peers，指定其他两台服务器的IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.121</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS              # 认证类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1234              # 认证密码，主备节点必须相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.140             # 虚拟IP地址，与主节点相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="643-192168137123作为vip的备份节点配置文件如下">6.4.3 <code>192.168.137.123</code>作为VIP的备份节点，配置文件如下<a href="#643-192168137123作为vip的备份节点配置文件如下" class="hash-link" aria-label="643-192168137123作为vip的备份节点配置文件如下的直接链接" title="643-192168137123作为vip的备份节点配置文件如下的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF | sudo tee /etc/keepalived/keepalived.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">! Configuration File for keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id LVS_DEVEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state BACKUP                    # 设置为备份节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface enp0s3                # 确保使用正确的网络接口名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51            # VRRP 路由ID，主备节点必须相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 40                     # 优先级，备份节点必须低于主节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1                    # VRRP通告间隔，单位秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unicast_peer {                  # 配置unicast_peers，指定其他两台服务器的IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.121</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.122</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS              # 认证类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1234              # 认证密码，主备节点必须相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.137.140             # 虚拟IP地址，与主节点相同</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="65-启动keepalived-haproxy">6.5 启动Keepalived HAProxy<a href="#65-启动keepalived-haproxy" class="hash-link" aria-label="6.5 启动Keepalived HAProxy的直接链接" title="6.5 启动Keepalived HAProxy的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/haproxy/haproxy.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/keepalived/keepalived.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl start haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开机自启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl enable --now haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl status haproxy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/VIP1-be0e45302eaf3e0510c33eee1fc9e4e7.png" width="1676" height="975" class="img_ev3q"></p>
<p>在配置防火墙规则之前，每台机器都有 <code>192.168.137.140</code> IP</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="七第一个master节点使用kubeadm创建集群并配置网络">七、【第一个Master节点】使用kubeadm创建集群并配置网络<a href="#七第一个master节点使用kubeadm创建集群并配置网络" class="hash-link" aria-label="七、【第一个Master节点】使用kubeadm创建集群并配置网络的直接链接" title="七、【第一个Master节点】使用kubeadm创建集群并配置网络的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-启动集群主节点">7.1 启动集群主节点<a href="#71-启动集群主节点" class="hash-link" aria-label="7.1 启动集群主节点的直接链接" title="7.1 启动集群主节点的直接链接">​</a></h3>
<p><strong>注意</strong> 离线部署时，需要将 <code>--image-repository</code> 设置为本地镜像仓库地址，或者当前服务器上的镜像前缀，否则回出现服务部署找不到镜像的情况</p>
<ul>
<li>【默认】默认的镜像仓库无法访问  <code>--image-repository=registry.k8s.io</code></li>
<li>【在线】在线使用阿里云镜像仓库  <code>--image-repository=registry.aliyuncs.com/google_containers</code></li>
<li>【离线】离线使用自建镜像仓库    <code>--image-repository=registry.example.com</code></li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 如果离线仓库的前缀为 registry.example.com，给镜像重新打Tag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/kube-apiserver:v1.30.11          registry.example.com/kube-apiserver:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/kube-controller-manager:v1.30.11 registry.example.com/kube-controller-manager:v1.30.11 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/kube-scheduler:v1.30.11          registry.example.com/kube-scheduler:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/kube-proxy:v1.30.11              registry.example.com/kube-proxy:v1.30.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/coredns/coredns:v1.11.3          registry.example.com/coredns:v1.11.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/pause:3.9                        registry.example.com/pause:3.9    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker tag registry.k8s.io/etcd:3.5.15-0                    registry.example.com/etcd:3.5.15-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建集群</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm init \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --kubernetes-version=v1.30.11 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --control-plane-endpoint=192.168.137.140:16443 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --image-repository=registry.k8s.io \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # --image-repository=registry.aliyuncs.com/google_containers \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --service-cidr=10.96.0.0/12 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --pod-network-cidr=10.244.0.0/16 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --upload-certs \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看生成的配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubectl -n kube-system get cm kubeadm-config -o yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果初始化异常，可以使用下面命令重置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm reset --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>kubernetes-version</code>: K8s版本，与上面安装的一致</li>
<li><code>--control-plane-endpoint</code>: 控制面端点，配置VIP的地址 <code>192.168.137.140</code> 端口为HAProxy代理的端口</li>
<li><code>apiserver-advertise-address</code>: master主机内网IP地址</li>
<li><code>image-repository</code>: 指定阿里云镜像仓库地址。由于kubeadm 默认从官网<a href="http://k8s.grc.io%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F%EF%BC%8C%E5%9B%BD%E5%86%85%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%9B%A0%E6%AD%A4%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80" target="_blank" rel="noopener noreferrer">http://k8s.grc.io下载所需镜像，国内无法访问，因此需要指定阿里云镜像仓库地址</a></li>
<li><code>service-cidr</code>: 集群内部虚拟网络，Pod统一访问入口</li>
<li><code>pod-network-cidr</code>: 定义pod网段为, <code>10.244.0.0/16</code></li>
</ul>
<p>执行后打印的日志信息</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 等待成功后按照提示配置访问的.kube/config即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Your Kubernetes control-plane has initialized successfully!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To start using your cluster, you need to run the following as a regular user:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mkdir -p $HOME/.kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Alternatively, if you are the root user, you can run:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You should now deploy a pod network to the cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You can now join any number of the control-plane node running the following command on each as root:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --control-plane --certificate-key 3f3d619638bb3cb780d9a54bc2153d61996c9a367d79e8f584992fa961d2659b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please note that the certificate-key gives access to cluster sensitive data, keep it secret!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;kubeadm init phase upload-certs --upload-certs&quot; to reload certs afterward.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Then you can join any number of worker nodes by running the following on each as root:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/k8s  安装4-67368f70c6a17e3d06228d78e8bad347.png" width="1676" height="917" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/k8s安装5-fbf05c0e484d3e76c291c3ff5c2262f1.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-配置master节点">7.2 配置Master节点<a href="#72-配置master节点" class="hash-link" aria-label="7.2 配置Master节点的直接链接" title="7.2 配置Master节点的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 按照安装完成的提示执行命令（此时需要使用普通用户）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p $HOME/.kube</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取节点信息和pod信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/k8s安装6-1fdd07228504a3078291dca02aa4d94c.png" width="1676" height="917" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="八其他master节点master节点加入集群">八、【其他Master节点】Master节点加入集群<a href="#八其他master节点master节点加入集群" class="hash-link" aria-label="八、【其他Master节点】Master节点加入集群的直接链接" title="八、【其他Master节点】Master节点加入集群的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="81-节点初始化">8.1 节点初始化<a href="#81-节点初始化" class="hash-link" aria-label="8.1 节点初始化的直接链接" title="8.1 节点初始化的直接链接">​</a></h3>
<p>按顺序执行上面 【三、四、五】 的所有配置及安装命令，此处不再重复</p>
<p><strong>注意</strong> 在 <code>192.168.137.122</code> <code>192.168.137.123</code> 需要按照 【六】 的步骤安装配置HAProxy keepalived</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="82-环境检查">8.2 环境检查<a href="#82-环境检查" class="hash-link" aria-label="8.2 环境检查的直接链接" title="8.2 环境检查的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看Docker版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看K8s版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm version </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version --client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubelet --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Master节点加入1-d33e2d019cf49be6524b4cd4dd4c60ed.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="83-加入master节点">8.3 加入Master节点<a href="#83-加入master节点" class="hash-link" aria-label="8.3 加入Master节点的直接链接" title="8.3 加入Master节点的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="831-生成加入集群的token">8.3.1 生成加入集群的Token<a href="#831-生成加入集群的token" class="hash-link" aria-label="8.3.1 生成加入集群的Token的直接链接" title="8.3.1 生成加入集群的Token的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在Master节点打印加入节点指令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm token create --print-join-command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 输出内容如下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm join 192.168.137.140:16443 --token lp0sqf.ikkxltrxmirs15zn \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --discovery-token-ca-cert-hash sha256:1dfe993019b8a38fa80357e0a91490c7e2fc0ab3a0a3b16ddc4c7644af04a4ae</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="832-初始化master节点时上传证书到-etcd-中">8.3.2 初始化Master节点时上传证书到 etcd 中<a href="#832-初始化master节点时上传证书到-etcd-中" class="hash-link" aria-label="8.3.2 初始化Master节点时上传证书到 etcd 中的直接链接" title="8.3.2 初始化Master节点时上传证书到 etcd 中的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在Master节点执行上传证书指令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm init phase upload-certs --upload-certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 输出内容如下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$ sudo kubeadm init phase upload-certs --upload-certs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I0326 14:09:10.693417   10336 version.go:256] remote version is much newer: v1.32.3; falling back to: stable-1.30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[upload-certs] Using certificate key:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">273174b4ecf9ae7ea9e366cbfe26895f5de0e5a41f1aca60a52a86bc59d10758</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="833-加入新的master节点">8.3.3 加入新的Master节点<a href="#833-加入新的master节点" class="hash-link" aria-label="8.3.3 加入新的Master节点的直接链接" title="8.3.3 加入新的Master节点的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --control-plane --certificate-key 3f3d619638bb3cb780d9a54bc2153d61996c9a367d79e8f584992fa961d2659b \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意</strong> 要加上<code>-control-plane</code> <code>--certificate-key</code> ，不然就会添加为node节点而不是master</p>
<p><img decoding="async" loading="lazy" src="/assets/images/Master节点加入2-4b20714148f0958ebb72ee2222a29612.png" width="1676" height="917" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/Master节点加入3-dfa9a314fcdf72901c561f34075f60b4.png" width="1676" height="917" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/assets/images/Master节点加入4-dae07990d13ed2d9e4695dffea588bf1.png" width="1676" height="917" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/Master节点加入5-9daf8c453fa9a4b296171ef366fa3e5e.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="84-在主master节点查看新的节点是否成功加入">8.4 在主Master节点查看新的节点是否成功加入<a href="#84-在主master节点查看新的节点是否成功加入" class="hash-link" aria-label="8.4 在主Master节点查看新的节点是否成功加入的直接链接" title="8.4 在主Master节点查看新的节点是否成功加入的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Master节点加入6-2109608e5122e5cbce3baed570063ed2.png" width="1676" height="917" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="九所有node节点node节点加入集群">九、【所有Node节点】Node节点加入集群<a href="#九所有node节点node节点加入集群" class="hash-link" aria-label="九、【所有Node节点】Node节点加入集群的直接链接" title="九、【所有Node节点】Node节点加入集群的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="91-node节点初始化">9.1 Node节点初始化<a href="#91-node节点初始化" class="hash-link" aria-label="9.1 Node节点初始化的直接链接" title="9.1 Node节点初始化的直接链接">​</a></h3>
<p>按顺序执行上面 【三、四、五】 的所有配置及安装命令，此处不再重复</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="92-环境检查">9.2 环境检查<a href="#92-环境检查" class="hash-link" aria-label="9.2 环境检查的直接链接" title="9.2 环境检查的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看Docker版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看K8s版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm version </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version --client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubelet --version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Node节点加入1-ed5aaafa07f03e15a9b35d6af3bc0730.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="93-加入node节点">9.3 加入Node节点<a href="#93-加入node节点" class="hash-link" aria-label="9.3 加入Node节点的直接链接" title="9.3 加入Node节点的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在Master节点打印加入节点指令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubeadm token create --print-join-command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定运行时（添加--cri-socket参数）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Node节点加入2-adbd5105901597141505eb9e6bfd3487.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="94-在主master节点查看新的节点是否成功加入">9.4 在主Master节点查看新的节点是否成功加入<a href="#94-在主master节点查看新的节点是否成功加入" class="hash-link" aria-label="9.4 在主Master节点查看新的节点是否成功加入的直接链接" title="9.4 在主Master节点查看新的节点是否成功加入的直接链接">​</a></h3>
<p>由于需要等待 <code>Master</code> 下发镜像及Pod启动，需要等待2分钟左右Node的状态才会变成<code>Ready</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Node节点加入3-0607e32f85fff09761daed40f7b2f7f1.png" width="1676" height="917" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十第一个master节点网络插件安装及证书延期">十、【第一个Master节点】网络插件安装及证书延期<a href="#十第一个master节点网络插件安装及证书延期" class="hash-link" aria-label="十、【第一个Master节点】网络插件安装及证书延期的直接链接" title="十、【第一个Master节点】网络插件安装及证书延期的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="101-开放端口calico">10.1 开放端口(calico)<a href="#101-开放端口calico" class="hash-link" aria-label="10.1 开放端口(calico)的直接链接" title="10.1 开放端口(calico)的直接链接">​</a></h3>
<p>根据安装的网络插件不同，这里需要开放的端口也不同</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># BGP 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=179/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 根据封装模式选择 IP-in-IP 或 VXLAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># IP-in-IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule protocol value=&quot;4&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或 VXLAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=8472/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Typha 端口（若启用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=5473/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指标端口（按需）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=9099/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=9091/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CoreDNS需要的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=53/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启防火墙</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看开放的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看防火墙所有规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-all</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="102-安装calico网络服务">10.2 安装Calico网络服务<a href="#102-安装calico网络服务" class="hash-link" aria-label="10.2 安装Calico网络服务的直接链接" title="10.2 安装Calico网络服务的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/calico/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># wget https://raw.githubusercontent.com/projectcalico/calico/refs/heads/release-v3.25/manifests/calico.yaml -0 ./calico/calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -sSLf https://docs.tigera.io/archive/v3.25/manifests/calico.yaml -o ./calico/calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改配置文件中的 CALICO_IPV4POOL_CIDR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo vim ./calico/calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 在 CLUSTER_TYPE 后添加 IP_AUTODETECTION_METHOD value 为网卡名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cluster type to identify the deployment type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: CLUSTER_TYPE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &quot;k8s,bgp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: IP_AUTODETECTION_METHOD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &quot;interface=enp0s3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 此处value和kubeadm init的 --pod-network-cidr 一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># - name: CALICO_IPV4POOL_CIDR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#   value: &quot;192.168.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: CALICO_IPV4POOL_CIDR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value: &quot;10.244.0.0/16&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动calico</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f ./calico/calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果有异常，可以使用下面命令删除重新安装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f ./calico/calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/k8s安装7-aca1530d81e322dd9332835645233e44.png" width="1676" height="916" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/k8s安装8-22d9933263debf40e9c427bb2259ebb0.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="103-检查节点状态">10.3 检查节点状态<a href="#103-检查节点状态" class="hash-link" aria-label="10.3 检查节点状态的直接链接" title="10.3 检查节点状态的直接链接">​</a></h3>
<p>等待 calico 容器镜像下载启动完成，可能需要几分钟</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/k8s安装9-087937d1f25ebecb134ee152f4078159.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="104-检查coredns是否正常">10.4 检查CoreDNS是否正常<a href="#104-检查coredns是否正  常" class="hash-link" aria-label="10.4 检查CoreDNS是否正常的直接链接" title="10.4 检查CoreDNS是否正常的直接链接">​</a></h3>
<p>安装 Pod 网络后，你可以通过在 <code>kubectl get pods --all-namespaces</code> 输出中检查 CoreDNS Pod 是否 Running 来确认其是否正常运行。 一旦 CoreDNS Pod 启用并运行，你就可以继续加入节点。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces | grep coredns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看日志及状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n kube-system coredns-cb4864fb5-4mj8d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pod -n kube-system coredns-cb4864fb5-4mj8d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="105-控制平面节点隔离">10.5 控制平面节点隔离<a href="#105-控制平面节点隔离" class="hash-link" aria-label="10.5 控制平面节点隔离的直接链接" title="10.5 控制平面节点隔离的直接链接">​</a></h3>
<p>默认情况下，出于安全原因，你的集群不会在控制平面节点上调度 Pod。 如果你希望能够在单机 Kubernetes 集群等控制平面节点上调度 Pod，请运行：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 允许pod运行在控制平面节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint nodes --all node-role.kubernetes.io/control-plane-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="106-延长证书使用时间方便管理">10.6 延长证书使用时间，方便管理<a href="#106-延长证书使用时间方便管理" class="hash-link" aria-label="10.6 延长证书使用时间，方便管理的直接链接" title="10.6 延长证书使用时间，方便管理的直接链接">​</a></h3>
<ol>
<li>查看当前有效期</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看有效期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 输出以下结果，默认只有一年的有效期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$ openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Not Before: Mar 26 07:14:03 2025 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Not After : Mar 26 07:19:03 2026 GMT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看各项服务证书的有效期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm certs check-expiration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/证书有效期1-1594e2c1abed0a01952cc7f5c1fd6353.png" width="1676" height="917" class="img_ev3q"></p>
<ol start="2">
<li>延长证书有效期<a href="https://github.com/yuyicai/update-kube-cert" target="_blank" rel="noopener noreferrer">更新K8s证书有效期脚本</a></li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://raw.githubusercontent.com/yuyicai/update-kube-cert/refs/heads/master/update-kubeadm-cert.sh  -O ./update-kubeadm-cert.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x ./update-kubeadm-cert.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./update-kubeadm-cert.sh all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看有效期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看各项服务证书的有效期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm certs check-expiration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/证书有效期2-4b83258994142b7e99aa3989e4a5b91c.png" width="1676" height="917" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/证书有效期3-f07a694fb1b5dab5c32576a7baa1eb4e.png" width="1676" height="917" class="img_ev3q"></p>
<p>可以看到，服务及CA证书都延长到了10年</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十一安装dashboard">十一、安装Dashboard<a href="#十一安装dashboard" class="hash-link" aria-label="十一、安装Dashboard的直接链接" title="十一、安装Dashboard的直接链接">​</a></h2>
<ul>
<li><a href="https://www.cnblogs.com/baoshu/p/13296659.html" target="_blank" rel="noopener noreferrer">kubernetes系列(十六) - Helm安装和入门</a></li>
<li><a href="https://www.cnblogs.com/baoshu/p/13326480.html" target="_blank" rel="noopener noreferrer">kubernetes系列(十七) - 通过helm安装dashboard详细教程</a></li>
</ul>
<p>Kubernetes仪表板是Kubernetes集群的通用、基于Web的UI。它允许用户管理集群中运行的应用程序并对其进行故障排除，以及管理集群本身。</p>
<p>从7.x版开始，不再支持基于Manifest的安装。现在只支持基于Helm的安装。由于多容器设置和对Kong网关API代理的严重依赖 要轻松支持基于清单安装是不可行的。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="111-helm安装">11.1 Helm安装<a href="#111-helm安装" class="hash-link" aria-label="11.1 Helm安装的直接链接" title="11.1 Helm安装的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/helm/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Helm 下载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://get.helm.sh/helm-v3.17.2-linux-amd64.tar.gz -O ./helm/helm-v3.17.2-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf ./helm/helm-v3.17.2-linux-amd64.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 移动到bin目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv ./linux-amd64/helm  /usr/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装命令补全</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo yum install -y bash-completion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;source &lt;(helm completion bash)&quot; &gt;&gt; ~/.bashrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="112-仅在线配置dashboard仓库并拉取默认配置">11.2 【仅在线】配置Dashboard仓库并拉取默认配置<a href="#112-仅在线配置dashboard仓库并拉取默认配置" class="hash-link" aria-label="11.2 【仅在线】配置Dashboard仓库并拉取默认配置的直接链接" title="11.2 【仅在线】配置Dashboard仓库并拉取默认配置的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 添加helmhub上的dashboard官方repo仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看添加完成后的仓库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询dashboard的chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm search repo kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 新建文件夹用于保存chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p dashboard-chart &amp;&amp; cd dashboard-chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 拉取chart</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm pull kubernetes-dashboard/kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 此时会有一个压缩包，默认下载的是最新版本，可能与kubernates版本不兼容，需要去github确认</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf kubernetes-dashboard-7.11.1.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 进入到解压后的文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果下载较慢，可以从Github直接下载后上传到服务器</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/k8s-install/dashboard/ &amp;&amp; cd ~/k8s-install/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 最后一个确认支持 kubernates 1.30 的 dashboard 版本 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/kubernetes/dashboard/releases/download/kubernetes-dashboard-7.7.0/kubernetes-dashboard-7.7.0.tgz -O ./dashboard/kubernetes-dashboard-7.7.0.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装所需的容 器镜像也可以在 release页面找到 https://github.com/kubernetes/dashboard/releases/tag/kubernetes-dashboard-7.7.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull kubernetesui/dashboard-api:1.8.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull kubernetesui/dashboard-auth:1.1.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull kubernetesui/dashboard-metrics-scraper:1.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docker pull kubernetesui/dashboard-web:1.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="113-修改dashboard配置并安装">11.3 修改Dashboard配置并安装<a href="#113-修改dashboard配置并安装" class="hash-link" aria-label="11.3 修改Dashboard配置并安装的直接链接" title="11.3 修改Dashboard配置并安装的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 解压</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf ./dashboard/kubernetes-dashboard-7.7.0.tgz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 备份原始配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp values.yaml values.yaml.bakup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果使用Nginx代理，可以在此处配置域名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enabled: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hosts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Keep &#x27;localhost&#x27; host only if you want to access Dashboard using &#x27;kubectl port-forward ...&#x27; on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # https://localhost:8443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - dashboard.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装Dashboard  执行路径在values.yaml目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install kubernetes-dashboard . --create-namespace --namespace kubernetes-dashboard -f values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看Helm部署的资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm ls --namespace kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看dashboard pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kubernetes-dashboard -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看服务端口信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc -n kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard1-0a1561b665fc7ceb1bafcbe42e5cef37.png" width="1676" height="916" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="114-创建token">11.4 创建Token<a href="#114-创建token" class="hash-link" aria-label="11.4 创建Token的直接链接" title="11.4 创建Token的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt; dashboard-adminuser.yaml &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: admin-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: admin-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: cluster-admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: admin-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: admin-user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kubernetes.io/service-account.name: &quot;admin-user&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type: kubernetes.io/service-account-token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建账户 授予角色权限 创建Token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f dashboard-adminuser.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={&quot;.data.token&quot;} | base64 -d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">eyJhbGciOiJSUzI1NiIsImtpZCI6IjJtWTBjMHlsN2tSVkVaamI1WGU0YTZkMi1EclRfUXdBLUdnR3VFRDl1QTAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIyZDAxMDdkYy04YTk3LTQ2YjItOTMwMC1iOGMyNGIzZTdkNGEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.k9ndYMW8yKPkZUg-EXkNDM9Uye7OdbZAo5JvfEb9Nad77KQigh6tCplWeYNXuOzjo0H1s7Huy4Jkwv5z7fvybI_y7RjjOGrtTnrYXEsMlXi7y8Gm0YYthnCiYYBU-Jwkk6rreJOpHoJ2hjryQgfQx3rS85fBtn8KdjronMFor3ZTCqSk1QTI387EzOgnLJ5YbJLdQJVCxheIr6Aso6bwKYk7H9lDKCP684cgsYJ-ZbRuYe2Ec-Mr2u_OvoLckGgojJSqNbVJ1zMBs9sHxuEBYut-TvpdL-HRJDDUTI8Y1mBZlS6l4rYUANcC6qVufQAbQq8FNMB_q3qdQzTxt39hzg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe secret -n kubernetes-dashboard $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk &#x27;{print $1}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard2-3456c9cffc7ef6f747b1b8392a87d760.png" width="1676" height="916" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="115-访问dashboard">11.5 访问Dashboard<a href="#115-访问dashboard" class="hash-link" aria-label="11.5 访问Dashboard的直接链接" title="11.5 访问Dashboard的直接链接">​</a></h3>
<p>如果需要直接使用集群的IP端口访问Dashboard，按照下面配置映射的端口，配置完成后回重新运行新的容器，可能需要等待几分钟</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 编辑网关对外端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit svc kubernetes-dashboard-kong-proxy -n kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 修改以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: NodePort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: kong-proxy-tls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nodePort: 30443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port: 443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol: TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    targetPort: 8443</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc -n kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看kong-proxy所在的节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kubernetes-dashboard -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n kubernetes-dashboard kubernetes-dashboard-kong-7696bb8c88-c2qkt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard3-770691a11156f6df4d80dfba9fa53e03.png" width="1676" height="916" class="img_ev3q"></p>
<ul>
<li>浏览器访问 <code>https://192.168.137.131:30443</code>，输入前面生成的Token即可访问页面</li>
</ul>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard4-601e097c5d4648ddc67a03f96bea4f4e.png" width="1892" height="972" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="116-删除dashboard">11.6 删除Dashboard<a href="#116-删除dashboard" class="hash-link" aria-label="11.6 删除Dashboard的直接链接" title="11.6 删除Dashboard的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 用Helm卸载 Dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$ helm -n kubernetes-dashboard uninstall kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">release &quot;kubernetes-dashboard&quot; uninstalled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查pod是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$ kubectl -n kubernetes-dashboard get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No resources found in kubernetes-dashboard namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 检查service是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$ kubectl -n kubernetes-dashboard get svc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No resources found in kubernetes-dashboard namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除命名空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@k8s-master-01 k8s]$ kubectl delete namespace kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace &quot;kubernetes-dashboard&quot; deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十二常用命令">十二、常用命令<a href="#十二常用命令" class="hash-link" aria-label="十二、常用命令的直接链接" title="十二、常用命令的直接链接">​</a></h2>
<ul>
<li><a href="https://www.cnblogs.com/kangao/p/17526694.html" target="_blank" rel="noopener noreferrer">k8s 操作命令 合集</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="初始化常用">初始化常用<a href="#初始化常用" class="hash-link" aria-label="初始化常用的直接链接" title="初始化常用的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 重置当前节点 将 kubeadm init 及  kubeadm join生成的内容重置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo kubeadm reset --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取所有节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取所有Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建资源对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除资源对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f calico.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n kube-system calico-node-hqf25</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="121-基础操作命令">12.1 基础操作命令<a href="#121-基础操作命令" class="hash-link" aria-label="12.1 基础操作命令的直接链接" title="12.1 基础操作命令的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -o=json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -o=yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -o=wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n=&lt;namespace_name&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f ./</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -l name=</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="122-资源相关">12.2 资源相关<a href="#122-资源相关" class="hash-link" aria-label="12.2 资源相关的直接链接" title="12.2 资源相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建资源对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create -f &lt;file.yaml&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除资源对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f &lt;file.yaml&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="123-集群相关">12.3 集群相关<a href="#123-集群相关" class="hash-link" aria-label="12.3 集群相关的直接链接" title="12.3 集群相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cluster-info – Display endpoint information about the master and services in the cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version – Display the Kubernetes version running on the client and server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config view – Get the configuration of the cluster.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config view -o jsonpath=&#x27;{.users[*].name}&#x27; – Get a list of users.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config current-context – Display the current context.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config get-contexts – Display a list of contexts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl config use-context – Set the default context.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl api-resources – List the API resources that are available.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl api-versions – List the API versions that are available. kubectl get all --all-namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="124-daemonsets-相关">12.4 Daemonsets 相关<a href="#124-daemonsets-相关" class="hash-link" aria-label="12.4 Daemonsets 相关的直接链接" title="12.4 Daemonsets 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get daemonset – List one or more daemonsets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit daemonset &lt;daemonset_name&gt; – Edit and update the definition of one or more daemonset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete daemonset &lt;daemonset_name&gt; – Delete a daemonset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create daemonset &lt;daemonset_name&gt; – Create a new daemonset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl rollout daemonset – Manage the rollout of a daemonset.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe ds &lt;daemonset_name&gt; -n &lt;namespace_name&gt; – Display the detailed state of daemonsets within a namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="125-deployments相关">12.5 Deployments相关<a href="#125-deployments相关" class="hash-link" aria-label="12.5 Deployments相关的直接链接" title="12.5 Deployments相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployment – List one or more deployments.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe deployment &lt;deployment_name&gt; – Display the detailed state of one or more deployments.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit deployment &lt;deployment_name&gt; – Edit and update the definition of one or more deployments on the server.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create deployment &lt;deployment_name&gt; – Create a new deployment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete deployment &lt;deployment_name&gt; – Delete deployments.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl rollout status deployment &lt;deployment_name&gt; – See the rollout status of a deployment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl set image deployment/ =image: – Perform a rolling update (K8S default), set the image of the container to a new version for a particular deployment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl rollout undo deployment/ – Rollback a previous deployment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl replace --force -f – Perform a replace deployment — Force replace, delete and then re-create the resource.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="126-事件相关">12.6 事件相关<a href="#126-事件相关" class="hash-link" aria-label="12.6 事件相关的直接链接" title="12.6 事件相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events – List recent events for all resources in the system.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events –field-selector type=Warning – List Warnings only.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events --sort-by=.metadata.creationTimestamp – List events sorted by timestamp.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events --field-selector involvedObject.kind!=Pod – List events but exclude Pod events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events --field-selector involvedObject.kind=Node, involvedObject.name=&lt;node_name&gt; – Pull events for a single node with a specific name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get events --field-selector type!=Normal – Filter out normal events from a list of events.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="127-日志相关">12.7 日志相关<a href="#127-日志相关" class="hash-link" aria-label="12.7 日志相关的直接链接" title="12.7 日志相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs &lt;pod_name&gt; – Print the logs for a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs --since=6h &lt;pod_name&gt; – Print the logs for the last 6 hours for a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs --tail=50 &lt;pod_name&gt; – Get the most recent 50 lines of logs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -f &lt;service_name&gt; [-c &lt;$container&gt;] – Get logs from a service and optionally select which container.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -f &lt;pod_name&gt; – Print the logs for a pod and follow new logs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -c &lt;container_name&gt; &lt;pod_name&gt; – Print the logs for a container in a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs &lt;pod_name&gt; pod.log – Output the logs for a pod into a file named ‘pod.log&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs --previous &lt;pod_name&gt; – View the logs for a previously failed pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="128-namespace-相关">12.8 Namespace 相关<a href="#128-namespace-相关" class="hash-link" aria-label="12.8 Namespace 相关的直接链接" title="12.8 Namespace 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace &lt;namespace_name&gt; – Create a namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get namespace &lt;namespace_name&gt; – List one or more namespaces.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe namespace &lt;namespace_name&gt; – Display the detailed state of one or more namespaces.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete namespace &lt;namespace_name&gt; – Delete a namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit namespace &lt;namespace_name&gt; – Edit and update the definition of a namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top namespace &lt;namespace_name&gt; – Display Resource (CPU/Memory/Storage) usage for a namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="129-nodes-相关">12.9 Nodes 相关<a href="#129-nodes-相关" class="hash-link" aria-label="12.9 Nodes 相关的直接链接" title="12.9 Nodes 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl taint node &lt;node_name&gt; – Update the taints on one or more nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get node – List one or more nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete node &lt;node_name&gt; – Delete a node or multiple nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top node &lt;node_name&gt; – Display Resource usage (CPU/Memory/Storage) for nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -o wide | grep &lt;node_name&gt; – Pods running on a node.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate node &lt;node_name&gt; – Annotate a node.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl cordon node &lt;node_name&gt; – Mark a node as unschedulable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl uncordon node &lt;node_name&gt; – Mark node as schedulable.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl drain node &lt;node_name&gt; – Drain a node in preparation for maintenance.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label node – Add or update the labels of one or more nodes.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1210-pods-操作相关">12.10 Pods 操作相关<a href="#1210-pods-操作相关" class="hash-link" aria-label="12.10 Pods 操作相关的直接链接" title="12.10 Pods 操作相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pod – List one or more pods.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --sort-by=&#x27;.status.containerStatuses[0].restartCount&#x27; – List pods Sorted by Restart Count.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --field-selector=status.phase=Running – Get all running pods in the namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod &lt;pod_name&gt; – Delete a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pod &lt;pod_name&gt; – Display the detailed state of a pods.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create pod &lt;pod_name&gt; – Create a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec &lt;pod_name&gt; -c &lt;container_name&gt; – Execute a command against a container in a pod. Read more: Using Kubectl Exec: Connect to Your Kubernetes Containers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec -it &lt;pod_name&gt; /bin/sh – Get an interactive shell on a single-container pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl top pod – Display Resource usage (CPU/Memory/Storage) for pods.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl annotate pod &lt;pod_name&gt; – Add or update the annotations of a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl label pods &lt;pod_name&gt; new-label= – Add or update the label of a pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --show-labels – Get pods and show labels.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl port-forward : – Listen on a port on the local machine and forward to a port on a specified pod.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1211-replication-controller-相关">12.11 Replication Controller 相关<a href="#1211-replication-controller-相关" class="hash-link" aria-label="12.11 Replication Controller 相关的直接链接" title="12.11 Replication Controller 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get rc – List the replication controllers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get rc --namespace=”&lt;namespace_name&gt;” – List the replication controllers by namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1212-replicasets-相关">12.12 ReplicaSets 相关<a href="#1212-replicasets-相关" class="hash-link" aria-label="12.12 ReplicaSets 相关的直接链接" title="12.12 ReplicaSets 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get replicasets – List ReplicaSets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe replicasets &lt;replicaset_name&gt; – Display the detailed state of one or more ReplicaSets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale --replicas=[x] – Scale a ReplicaSet.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1213-sercrets-相关">12.13 Sercrets 相关<a href="#1213-sercrets-相关" class="hash-link" aria-label="12.13 Sercrets 相关的直接链接" title="12.13 Sercrets 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create secret – Create a secret.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get secrets – List secrets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe secrets – List details about secrets.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete secret &lt;secret_name&gt; – Delete a secret.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1214-services-相关">12.14 Services 相关<a href="#1214-services-相关" class="hash-link" aria-label="12.14 Services 相关的直接链接" title="12.14 Services 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get services – List one or more services.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe services – Display the detailed state of a service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose deployment [deployment_name] – Expose a replication controller, service, deployment, or pod as a new Kubernetes service.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl edit services – Edit and update the definition of one or more services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1215-service-account相关">12.15 Service Account相关<a href="#1215-service-account相关" class="hash-link" aria-label="12.15 Service Account相关的直接链接" title="12.15 Service Account相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get serviceaccounts – List service accounts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe serviceaccounts – Display the detailed state of one or more service accounts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl replace serviceaccount – Replace a service account.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete serviceaccount &lt;service_account_name&gt; – Delete a service account</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1216-statefulsets-相关">12.16 StatefulSets 相关<a href="#1216-statefulsets-相关" class="hash-link" aria-label="12.16 StatefulSets 相关的直接链接" title="12.16 StatefulSets 相关的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get statefulset – List StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete statefulset/[stateful_set_name] --cascade=false – Delete StatefulSet only (not pods).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1217-常用参数">12.17 常用参数<a href="#1217-常用参数" class="hash-link" aria-label="12.17 常用参数的直接链接" title="12.17 常用参数的直接链接">​</a></h3>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>-n &lt;namespace&gt;</code></td><td>指定命名空间（如 <code>kubectl get pods -n kube-system</code>）</td></tr><tr><td><code>--all-namespaces</code></td><td>跨所有命名空间操作</td></tr><tr><td><code>-o yaml/json/wide</code></td><td>指定输出格式</td></tr><tr><td><code>--dry-run=client</code></td><td>模拟执行（生成YAML但不创建资源）</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1218-注意事项">12.18 注意事项<a href="#1218-注意事项" class="hash-link" aria-label="12.18 注意事项的直接链接" title="12.18 注意事项的直接链接">​</a></h3>
<ol>
<li>使用 <code>--force --grace-period=0</code> 强制删除资源时需谨慎（可能导致数据不一致）。</li>
<li>查看日志时，若Pod有多个容器，需指定容器名：<code>kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt;</code>。</li>
<li>复杂操作建议优先使用YAML文件（<code>kubectl apply -f</code>）。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十三k8s网络设计">十三、K8s网络设计<a href="#十三k8s网络设计" class="hash-link" aria-label="十三、K8s网络设计的直接链接" title="十三、K8s网络设计的直接链接">​</a></h2>
<p>在K8s的安装使用过程中，最复杂也最难排查的问题通常都是网络问题，K8s的设计决定了网络结构的复杂度，可以用AI梳理一下K8s的网络模型</p>
<p>理解 Kubernetes（K8s）网络需要从它的设计理念、核心组件及网络模型入手。K8s 网络模型旨在解决容器化应用中复杂的通信需求，以下是逐步拆解的关键点：</p>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-k8s-网络的核心需求">1. K8s 网络的核心需求<a href="#1-k8s-网络的核心需求" class="hash-link" aria-label="1. K8s 网络的核心需求的直接链接" title="1. K8s 网络的核心需求的直接链接">​</a></h3>
<p>K8s 网络需满足以下基本条件：</p>
<ol>
<li><strong>Pod 间直接通信</strong>
<ul>
<li>所有 Pod 可以直接通过 IP 地址通信，无需 NAT。</li>
<li>无论 Pod 是否在同一节点上，网络必须支持跨节点通信。</li>
</ul>
</li>
<li><strong>节点与 Pod 通信</strong>
<ul>
<li>节点（物理机/虚拟机）可以直接访问其上的 Pod。</li>
</ul>
</li>
<li><strong>Service 抽象</strong>
<ul>
<li>通过 Service 为一组 Pod 提供稳定的虚拟 IP（ClusterIP）和 DNS 名称。</li>
<li>支持负载均衡和流量转发。</li>
</ul>
</li>
<li><strong>外部访问</strong>
<ul>
<li>通过 <code>Ingress</code> 或 <code>LoadBalancer</code> 类型 Service 暴露服务到集群外部。</li>
</ul>
</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-k8s-网络模型设计">2. K8s 网络模型设计<a href="#2-k8s-网络模型设计" class="hash-link" aria-label="2. K8s 网络模型设计的直接链接" title="2. K8s 网络模型设计的直接链接">​</a></h3>
<p>K8s 本身不直接实现网络功能，而  是定义了一套标准模型，依赖插件（CNI）实现。核心设计如下：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-pod-网络">1. <strong>Pod 网络</strong><a href="#1-pod-网络" class="hash-link" aria-label="1-pod-网络的直接链接" title="1-pod-网络的直接链接">​</a></h4>
<ul>
<li><strong>每个 Pod 拥有独立 IP</strong>
<ul>
<li>Pod 内的容器共享网络命名空间，通过 <code>localhost</code> 直接通信。</li>
<li>每个 Pod 的 IP 在整个集群中唯一（称为 <code>Pod IP</code>）。</li>
</ul>
</li>
<li><strong>跨节点通信</strong>
<ul>
<li>不同节点上的 Pod 可以直接通信，无需 NAT。</li>
<li>由 CNI 插件（如 Calico、Flannel、Cilium 等）实现底层网络隧道（如 VXLAN、IPIP）或路由策略。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-service-网络">2. <strong>Service 网络</strong><a href="#2-service-网络" class="hash-link" aria-label="2-service-网络的直接链接" title="2-service-网络的直接链接">​</a></h4>
<ul>
<li><strong>Service 的虚拟 IP（ClusterIP）</strong>
<ul>
<li>Service 不是实体组件，而是通过 <code>kube-proxy</code> 在节点上配置的 iptables/IPVS 规则实现。</li>
<li>流量从 Service IP 转发到后端 Pod（负载均衡）。</li>
</ul>
</li>
<li><strong>DNS 服务发现</strong>
<ul>
<li>CoreDNS 为 Service 提供 DNS 记录（如 <code>my-svc.my-namespace.svc.cluster.local</code>）。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-网络插件cni">3. <strong>网络插件（CNI）</strong><a href="#3-网络插件cni" class="hash-link" aria-label="3-网络插件cni的直接链接" title="3-网络插件cni的直接链接">​</a></h4>
<ul>
<li><strong>CNI 的作用</strong>
<ul>
<li>负责为 Pod 分配 IP、配置网络接口、路由规则等。</li>
<li>常见插件：Calico（基于 BGP 路由）、Flannel（基于 VXLAN 隧道）、Cilium（基于 eBPF）。</li>
</ul>
</li>
<li><strong>选择 CNI 插件的影响</strong>
<ul>
<li>性能（如延迟、吞吐量）、网络策略支持（NetworkPolicy）、多集群互联能力等。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-网络策略networkpolicy">4. <strong>网络策略（NetworkPolicy）</strong><a href="#4-网络策略networkpolicy" class="hash-link" aria-label="4-网络策略networkpolicy的直接链接" title="4-网络策略networkpolicy的直接链接">​</a></h4>
<ul>
<li>通过 <code>NetworkPolicy</code> 定义 Pod 间的通信规则（白名单），实现微服务网络安全。</li>
<li>需要 CNI 插件支持（如 Calico、Cilium）。</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-关键组件详解">3. 关键组件详解<a href="#3-关键组件详解" class="hash-link" aria-label="3. 关键组件详解的直接链接" title="3. 关键组件详解的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-kube-proxy">1. <strong>kube-proxy</strong><a href="#1-kube-proxy" class="hash-link" aria-label="1-kube-proxy的直接链接" title="1-kube-proxy的直接链接">​</a></h4>
<ul>
<li><strong>作用</strong>：维护节点上的网络规则，实现 Service 的流量转发。</li>
<li><strong>实现方式</strong>：<!-- -->
<ul>
<li><strong>iptables 模式</strong>：通过 iptables 规则匹配目标 IP 和端口，转发到随机后端 Pod。</li>
<li><strong>IPVS 模式</strong>：基于内核的 IP Virtual Server，性能更高，适合大规模集群。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-coredns">2. <strong>CoreDNS</strong><a href="#2-coredns" class="hash-link" aria-label="2-coredns的直接链接" title="2-coredns的直接链接">​</a></h4>
<ul>
<li><strong>作用</strong>：为 Service 和 Pod 提供 DNS 解析服务。</li>
<li><strong>记录类型</strong>：<!-- -->
<ul>
<li><code>A</code> 记录：Service 的 ClusterIP。</li>
<li><code>SRV</code> 记录：服务端口信息。</li>
<li>Pod 的 DNS 记 录（需显式配置 <code>hostname</code> 和 <code>subdomain</code>）。</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-ingress-controller">3. <strong>Ingress Controller</strong><a href="#3-ingress-controller" class="hash-link" aria-label="3-ingress-controller的直接链接" title="3-ingress-controller的直接链接">​</a></h4>
<ul>
<li><strong>作用</strong>：通过 HTTP/HTTPS 路由规则暴露服务到集群外。</li>
<li><strong>常见实现</strong>：Nginx Ingress、Traefik、HAProxy。</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-网络通信示例">4. 网络通信示例<a href="#4-网络通信示例" class="hash-link" aria-label="4. 网络通信示例的直接链接" title="4. 网络通信示例的直接链接">​</a></h3>
<p>假设集群中有以下资源：</p>
<ul>
<li>Pod A（IP: <code>10.244.1.2</code>，节点: Node1）</li>
<li>Pod B（IP: <code>10.244.2.3</code>，节点: Node2）</li>
<li>Service S（ClusterIP: <code>10.96.0.10</code>，后端为 Pod A 和 Pod B）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-pod-a--pod-b">1. <strong>Pod A → Pod B</strong><a href="#1-pod-a--pod-b" class="hash-link" aria-label="1-pod-a--pod-b的直接链接" title="1-pod-a--pod-b的直接链接">​</a></h4>
<ul>
<li>直接通过 Pod IP <code>10.244.2.3</code> 通信。</li>
<li>CNI 插件确保跨节点流量通过隧道或路由到达目标节点。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-pod-a--service-s">2. <strong>Pod A → Service S</strong><a href="#2-pod-a--service-s" class="hash-link" aria-label="2-pod-a--service-s的直接链接" title="2-pod-a--service-s的直接链接">​</a></h4>
<ul>
<li>请求发送到 <code>10.96.0.10:80</code>。</li>
<li><code>kube-proxy</code> 通过 iptables/IPVS 将流量转发到 Pod A 或 Pod B。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-外部访问-service-s">3. <strong>外部访问 Service S</strong><a href="#3-外部访问-service-s" class="hash-link" aria-label="3-外部访问-service-s的直接链接" title="3-外部访问-service-s的直接链接">​</a></h4>
<ul>
<li>通过 <code>NodePort</code>（如 <code>30080</code>）或 <code>LoadBalancer</code> 类型的 Service。</li>
<li>Ingress 控制器根据域名和路径路由到 Service。</li>
</ul>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-常见问题与排查">5. 常见问题与排查<a href="#5-常见问题与排查" class="hash-link" aria-label="5. 常见问题与排查的直接链接" title="5. 常见问题与排查的直接链接">​</a></h3>
<ol>
<li><strong>Pod 无法跨节点通信</strong>
<ul>
<li>检查 CNI 插件是否安装，节点防火墙是否开放 VXLAN/BGP 端口。</li>
</ul>
</li>
<li><strong>Service 无法访问</strong>
<ul>
<li>检查 <code>kube-proxy</code> 是否运行，iptables/IPVS 规则是否正确。</li>
</ul>
</li>
<li><strong>DNS 解析失败（CoreDNS Pending）</strong>
<ul>
<li>确保网络插件已安装，CoreDNS Pod 调度正常（如容忍主节点污点）。</li>
</ul>
</li>
</ol>
<hr>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-总结">6. 总结<a href="#6-总结" class="hash-link" aria-label="6. 总结的直接链接" title="6. 总结的直接链接">​</a></h3>
<p>K8s 网络的核心是 <strong>Pod 直接通信 + Service 抽象 + CNI 插件实现</strong>，理解其分层模型和组件协作是关键。实际应用中需根据场景选择合适的 CNI 插件，并通过 <code>kubectl describe</code>、<code>kubectl logs</code> 等工具排查网络问题。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="十四问题">十四、问题<a href="#十四问题" class="hash-link" aria-label="十四、问题的直接链接" title="十四、问题的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-加入新的master节点时报错-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address">1. 加入新的Master节点时报错 <code>cluster that doesn&#x27;t have a stable controlPlaneEndpoint address</code><a href="#1-加入新的master节点时报错-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address" class="hash-link" aria-label="1-加入新的master节点时报错-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address的直接链接" title="1-加入新的master节点时报错-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[diginn@centos ~]$ sudo kubeadm join 192.168.137.121:6443 --token dvoeut.f4ebwfjuvxfrq8en \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;   --discovery-token-ca-cert-hash sha256:6dc91db6dcca58593100b04e03f2f534490fdecdcdb19717775fb7940df32c35 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;   --control-plane --certificate-key a42a3d42d713581b588a689b64cc78c47bed8c320c01e763ccc358abde775918 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;   --cri-socket=unix:///var/run/cri-dockerd.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[sudo] diginn 的密码：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[preflight] Running pre-flight checks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[preflight] Reading configuration from the cluster...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error execution phase preflight:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">One or more conditions for hosting a new control plane instance is not satisfied.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unable to add a new control plane instance to a cluster that doesn&#x27;t have a stable controlPlaneEndpoint address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please ensure that:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* The cluster has a stable controlPlaneEndpoint address.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* The certificates that must be shared among control plane instances are provided.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To see the stack trace of this error execute with --v=5 or higher</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/加入Master节点异常1-43ace62326b94ce3322277969d63a50f.png" width="1661" height="916" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决">解决<a href="#解决" class="hash-link" aria-label="解决的直接链接" title="解决的直接链接">​</a></h4>
<p>如果在第一个集群使用kubeadm初始化时没有指定vip则会出现上述报错</p>
<ol>
<li>在主master节点查看 <code>kubeadm-config.yaml</code></li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kube-system get cm kubeadm-config -o yaml | grep controlPlaneEndpoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果没有筛选到 <code>controlPlaneEndpoint</code> ，代表初始化时没有配置</p>
<ol start="2">
<li>编辑<code>kubeadm-config</code>，添加<code>controlPlaneEndpoint</code></li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n kube-system edit cm kubeadm-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ClusterConfiguration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    apiServer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">      timeoutForControlPlane: 4m0s</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    apiVersion: kubeadm.k8s.io/v1beta3</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    certificatesDir: /etc/kubernetes/pki</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    clusterName: kubernetes</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    # 此处加加入高可用vip</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    controlPlaneEndpoint: 192.168.137.140:16443</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    controllerManager: {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    dns: {}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/加入Master节点异常2-02157077b0669256838a1d8dd979d215.png" width="1661" height="916" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-calico-服务运行异常">2. Calico 服务运行异常<a href="#2-calico-服务运行异常" class="hash-link" aria-label="2. Calico 服务运行异常的直接链接" title="2. Calico 服务运行异常的直接链接">​</a></h3>
<ul>
<li><a href="https://blog.csdn.net/qq_43024789/article/details/136127430" target="_blank" rel="noopener noreferrer">记录一次K8s 集群故障（路由&amp;Calico）</a></li>
</ul>
<p>集群在加入节点后 <code>calico-node</code> 服务运行状态异常
<img decoding="async" loading="lazy" src="/assets/images/Calico运行异常1-919d7cf0af0018fc482deae08eabccd1.png" width="1676" height="916" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="解决-1">解决<a href="#解决-1" class="hash-link" aria-label="解决的直接链接" title="解决的直接链接">​</a></h4>
<p>calico各节点之间通讯需要开放一些端口，端口开放后访问正常</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># BGP 端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=179/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 根据封装模式选择 IP-in-IP 或 VXLAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># IP-in-IP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-rich-rule=&#x27;rule protocol value=&quot;4&quot; accept&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或 VXLAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=8472/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Typha 端口（若启用）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=5473/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指标端口（按需）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=9099/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=9091/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启防火墙</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看开放的端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询所有calico-node </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kube-system -l k8s-app=calico-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除所有calico-node </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pods -n kube-system -l k8s-app=calico-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Calico运行异常2-7af266490fa16e07f79ca2801af6dc29.png" width="1676" height="917" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-dashboard访问异常">3. Dashboard访问异常<a href="#3-dashboard访问异常" class="hash-link" aria-label="3. Dashboard访问异常的直接链接" title="3. Dashboard访问异常的直接链接">​</a></h3>
<p>访问Dashboard时报错</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">failed the initial dns/balancer resolve for &#x27;kubernetes-dashboard-web&#x27; with: failed to receive reply from UDP server 10.96.0.10:53: no route to host.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">request_id: d4fe874d5f8e335cd8fdb52ae1d33c04</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard访问异常1-6988afb0e50db0bf57ae61e054094a68.png" width="1701" height="771" class="img_ev3q"></p>
<p>这个问题也属于网络问题的范畴，通常是CoreDNS的问题</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查找CoreDNS Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kube-system -l k8s-app=kube-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看日志是否有异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n kube-system coredns-cb4864fb5-4mj8d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n kube-system coredns-cb4864fb5-gxrdp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 确认CoreDNS的ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get svc -n kube-system kube-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 确认防火墙的放行规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 进入容器内部交互模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec -it -n kube-system coredns-cb4864fb5-4mj8d -- sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard访问异常2-f552d8551ae50e7ab6f381e45224814d.png" width="1676" height="917" class="img_ev3q"></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. 所有节点开放CoreDNS相关端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=53/tcp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=53/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=9153/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DHCP端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=67/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --permanent --add-port=68/udp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. 在Master节点上删除 coredns 和 calico-node 相关pods，等待重建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pods -n kube-system -l k8s-app=calico-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pods -n kube-system -l k8s-app=kube-dns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. 在Master节点上删除 kubernetes-dashboard 相关pods，等待重建</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pods --all -n kubernetes-dashboard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. 验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo firewall-cmd --list-all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/assets/images/Dashboard访问异常3-e4ed3877f124ddec9866622eecf4588f.png" width="1676" height="917" class="img_ev3q">
<img decoding="async" loading="lazy" src="/assets/images/Dashboard访问异常4-1dc60fb44ed04edd7606a74c2721b33d.png" width="1869" height="989" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/k8s/5-Build-K8s-Multi-Master-Cluster.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/zh-cn/k8s/K8s-Commands/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">K8s-Commands</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster-Offline/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Build-K8s-Multi-Master-Cluster-Offline</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一相关链接" class="table-of-contents__link toc-highlight">一、相关链接</a></li><li><a href="#二环境介绍" class="table-of-contents__link toc-highlight">二、环境介绍</a><ul><li><a href="#21-软件版本" class="table-of-contents__link toc-highlight">2.1 软件版本</a></li><li><a href="#22-服务器规划" class="table-of-contents__link toc-highlight">2.2 服务器规划</a></li></ul></li><li><a href="#三所有节点准备工作" class="table-of-contents__link toc-highlight">三、【所有节点】准备工作</a><ul><li><a href="#31-创建操作用户" class="table-of-contents__link toc-highlight">3.1 创建操作用户</a></li><li><a href="#32-禁用系统交换分区" class="table-of-contents__link toc-highlight">3.2 禁用系统交换分区</a></li><li><a href="#33-禁用-selinux" class="table-of-contents__link toc-highlight">3.3 禁用 SELinux</a></li><li><a href="#34-配置内核参数" class="table-of-contents__link toc-highlight">3.4 配置内核参数</a></li><li><a href="#35-配置网络参数" class="table-of-contents__link toc-highlight">3.5 配置网络参数</a></li><li><a href="#36-设置主机名和hosts" class="table-of-contents__link toc-highlight">3.6 设置主机名和hosts</a></li><li><a href="#37-设置时区" class="table-of-contents__link toc-highlight">3.7 设置时区</a></li><li><a href="#38-打通节点之间的网络在k8s节点之间直接放行" class="table-of-contents__link toc-highlight">3.8 打通节点之间的网络，在K8s节点之间直接放行</a></li><li><a href="#39-配置防火墙放行规则" class="table-of-contents__link toc-highlight">3.9 配置防火墙放行规则</a></li><li><a href="#310-在线依赖项安装" class="table-of-contents__link toc-highlight">3.10 【在线】依赖项安装</a></li><li><a href="#310-离线依赖项安装" class="table-of-contents__link toc-highlight">3.10 【离线】依赖项安装</a></li></ul></li><li><a href="#四所有节点docker安装配置容器运行时" class="table-of-contents__link toc-highlight">四、【所有节点】Docker安装配置（容器运行时）</a><ul><li><a href="#41-卸载已有docker-engine" class="table-of-contents__link toc-highlight">4.1 卸载已有Docker Engine</a></li><li><a href="#42-添加docker-yum仓库" class="table-of-contents__link toc-highlight">4.2 添加Docker yum仓库</a></li><li><a href="#43-在线安装docker" class="table-of-contents__link toc-highlight">4.3 【在线】安装Docker</a></li><li><a href="#43-离线安装docker" class="table-of-contents__link toc-highlight">4.3 【离线】安装Docker</a></li><li><a href="#44-如果需要卸载使用以下命令" class="table-of-contents__link toc-highlight">4.4 如果需要卸载，使用以下命令</a></li><li><a href="#45-配置docker驱动及镜像仓库" class="table-of-contents__link toc-highlight">4.5 配置Docker驱动及镜像仓库</a></li><li><a href="#46-安装cri-dockerd驱动docker与k8s集成的适配层" class="table-of-contents__link toc-highlight">4.6 安装cri-dockerd驱动（Docker与K8s集成的适配层）</a></li></ul></li><li><a href="#五所有节点安装-kubeadmkubelet-和-kubectl" class="table-of-contents__link toc-highlight">五、【所有节点】安装 kubeadm、kubelet 和 kubectl</a><ul><li><a href="#51-确保每个节点上-mac-地址和-product_uuid-的唯一性" class="table-of-contents__link toc-highlight">5.1 确保每个节点上 MAC 地址和 product_uuid 的唯一性</a></li><li><a href="#52-添加-kubernetes-的-yum-仓库" class="table-of-contents__link toc-highlight">5.2 添加 Kubernetes 的 yum 仓库</a></li><li><a href="#53-在线安装-kubeletkubeadm-和-kubectl" class="table-of-contents__link toc-highlight">5.3 【在线】安装 kubelet、kubeadm 和 kubectl</a></li><li><a href="#53-离线安装-kubeletkubeadm-和-kubectl" class="table-of-contents__link toc-highlight">5.3 【离线】安装 kubelet、kubeadm 和 kubectl</a></li><li><a href="#54-下载k8s依赖镜像" class="table-of-contents__link toc-highlight">5.4 下载K8s依赖镜像</a></li></ul></li><li><a href="#六仅master节点安装haproxy-keepalived" class="table-of-contents__link toc-highlight">六、【仅Master节点】安装HAProxy Keepalived</a><ul><li><a href="#61-开放端口" class="table-of-contents__link toc-highlight">6.1 开放端口</a></li><li><a href="#62-在线安装keepalived-haproxy" class="table-of-contents__link toc-highlight">6.2 【在线】安装Keepalived HAProxy</a></li><li><a href="#62-离线安装keepalived-haproxy" class="table-of-contents__link toc-highlight">6.2 【离线】安装Keepalived HAProxy</a></li><li><a href="#63-配置haproxy" class="table-of-contents__link toc-highlight">6.3 配置HAProxy</a></li><li><a href="#64-配置keepalived" class="table-of-contents__link toc-highlight">6.4 配置Keepalived</a></li><li><a href="#65-启动keepalived-haproxy" class="table-of-contents__link toc-highlight">6.5 启动Keepalived HAProxy</a></li></ul></li><li><a href="#七第一个master节点使用kubeadm创建集群并配置网络" class="table-of-contents__link toc-highlight">七、【第一个Master节点】使用kubeadm创建集群并配置网络</a><ul><li><a href="#71-启动集群主节点" class="table-of-contents__link toc-highlight">7.1 启动集群主节点</a></li><li><a href="#72-配置master节点" class="table-of-contents__link toc-highlight">7.2 配置Master节点</a></li></ul></li><li><a href="#八其他master节点master节点加入集群" class="table-of-contents__link toc-highlight">八、【其他Master节点】Master节点加入集群</a><ul><li><a href="#81-节点初始化" class="table-of-contents__link toc-highlight">8.1 节点初始化</a></li><li><a href="#82-环境检查" class="table-of-contents__link toc-highlight">8.2 环境检查</a></li><li><a href="#83-加入master节点" class="table-of-contents__link toc-highlight">8.3 加入Master节点</a></li><li><a href="#84-在主master节点查看新的节点是否成功加入" class="table-of-contents__link toc-highlight">8.4 在主Master节点查看新的节点是否成功加入</a></li></ul></li><li><a href="#九所有node节点node节点加入集群" class="table-of-contents__link toc-highlight">九、【所有Node节点】Node节点加入集群</a><ul><li><a href="#91-node节点初始化" class="table-of-contents__link toc-highlight">9.1 Node节点初始化</a></li><li><a href="#92-环境检查" class="table-of-contents__link toc-highlight">9.2 环境检查</a></li><li><a href="#93-加入node节点" class="table-of-contents__link toc-highlight">9.3 加入Node节点</a></li><li><a href="#94-在主master节点查看新的节点是否成功加入" class="table-of-contents__link toc-highlight">9.4 在主Master节点查看新的节点是否成功加入</a></li></ul></li><li><a href="#十第一个master节点网络插件安装及证书延期" class="table-of-contents__link toc-highlight">十、【第一个Master节点】网络插件安装及证书延期</a><ul><li><a href="#101-开放端口calico" class="table-of-contents__link toc-highlight">10.1 开放端口(calico)</a></li><li><a href="#102-安装calico网络服务" class="table-of-contents__link toc-highlight">10.2 安装Calico网络服务</a></li><li><a href="#103-检查节点状态" class="table-of-contents__link toc-highlight">10.3 检查节点状态</a></li><li><a href="#104-检查coredns是否正常" class="table-of-contents__link toc-highlight">10.4 检查CoreDNS是否正常</a></li><li><a href="#105-控制平面节点隔离" class="table-of-contents__link toc-highlight">10.5 控制平面节点隔离</a></li><li><a href="#106-延长证书使用时间方便管理" class="table-of-contents__link toc-highlight">10.6 延长证书使用时间，方便管理</a></li></ul></li><li><a href="#十一安装dashboard" class="table-of-contents__link toc-highlight">十一、安装Dashboard</a><ul><li><a href="#111-helm安装" class="table-of-contents__link toc-highlight">11.1 Helm安装</a></li><li><a href="#112-仅在线配置dashboard仓库并拉取默认配置" class="table-of-contents__link toc-highlight">11.2 【仅在线】配置Dashboard仓库并拉取默认配置</a></li><li><a href="#113-修改dashboard配置并安装" class="table-of-contents__link toc-highlight">11.3 修改Dashboard配置并安装</a></li><li><a href="#114-创建token" class="table-of-contents__link toc-highlight">11.4 创建Token</a></li><li><a href="#115-访问dashboard" class="table-of-contents__link toc-highlight">11.5 访问Dashboard</a></li><li><a href="#116-删除dashboard" class="table-of-contents__link toc-highlight">11.6 删除Dashboard</a></li></ul></li><li><a href="#十二常用命令" class="table-of-contents__link toc-highlight">十二、常用命令</a><ul><li><a href="#初始化常用" class="table-of-contents__link toc-highlight">初始化常用</a></li><li><a href="#121-基础操作命令" class="table-of-contents__link toc-highlight">12.1 基础操作命令</a></li><li><a href="#122-资源相关" class="table-of-contents__link toc-highlight">12.2 资源相关</a></li><li><a href="#123-集群相关" class="table-of-contents__link toc-highlight">12.3 集群相关</a></li><li><a href="#124-daemonsets-相关" class="table-of-contents__link toc-highlight">12.4 Daemonsets 相关</a></li><li><a href="#125-deployments相关" class="table-of-contents__link toc-highlight">12.5 Deployments相关</a></li><li><a href="#126-事件相关" class="table-of-contents__link toc-highlight">12.6 事件相关</a></li><li><a href="#127-日志相关" class="table-of-contents__link toc-highlight">12.7 日志相关</a></li><li><a href="#128-namespace-相关" class="table-of-contents__link toc-highlight">12.8 Namespace 相关</a></li><li><a href="#129-nodes-相关" class="table-of-contents__link toc-highlight">12.9 Nodes 相关</a></li><li><a href="#1210-pods-操作相关" class="table-of-contents__link toc-highlight">12.10 Pods 操作相关</a></li><li><a href="#1211-replication-controller-相关" class="table-of-contents__link toc-highlight">12.11 Replication Controller 相关</a></li><li><a href="#1212-replicasets-相关" class="table-of-contents__link toc-highlight">12.12 ReplicaSets 相关</a></li><li><a href="#1213-sercrets-相关" class="table-of-contents__link toc-highlight">12.13 Sercrets 相关</a></li><li><a href="#1214-services-相关" class="table-of-contents__link toc-highlight">12.14 Services 相关</a></li><li><a href="#1215-service-account相关" class="table-of-contents__link toc-highlight">12.15 Service Account相关</a></li><li><a href="#1216-statefulsets-相关" class="table-of-contents__link toc-highlight">12.16 StatefulSets 相关</a></li><li><a href="#1217-常用参数" class="table-of-contents__link toc-highlight">12.17 常用参数</a></li><li><a href="#1218-注意事项" class="table-of-contents__link toc-highlight">12.18 注意事项</a></li></ul></li><li><a href="#十三k8s网络设计" class="table-of-contents__link toc-highlight">十三、K8s网络设计</a><ul><li><a href="#1-k8s-网络的核心需求" class="table-of-contents__link toc-highlight">1. K8s 网络的核心需求</a></li><li><a href="#2-k8s-网络模型设计" class="table-of-contents__link toc-highlight">2. K8s 网络模型设计</a></li><li><a href="#3-关键组件详解" class="table-of-contents__link toc-highlight">3. 关键组件详解</a></li><li><a href="#4-网络通信示例" class="table-of-contents__link toc-highlight">4. 网络通信示例</a></li><li><a href="#5-常见问题与排查" class="table-of-contents__link toc-highlight">5. 常见问题与排查</a></li><li><a href="#6-总结" class="table-of-contents__link toc-highlight">6. 总结</a></li></ul></li><li><a href="#十四问题" class="table-of-contents__link toc-highlight">十四、问题</a><ul><li><a href="#1-加入新的master节点时报错-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address" class="table-of-contents__link toc-highlight">1. 加入新的Master节点时报错 <code>cluster that doesn&#39;t have a stable controlPlaneEndpoint address</code></a></li><li><a href="#2-calico-服务运行异常" class="table-of-contents__link toc-highlight">2. Calico 服务运行异常</a></li><li><a href="#3-dashboard访问异常" class="table-of-contents__link toc-highlight">3. Dashboard访问异常</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>