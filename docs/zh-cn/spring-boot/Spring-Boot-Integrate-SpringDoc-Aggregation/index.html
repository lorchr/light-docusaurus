<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Spring-Boot-Integrate-SpringDoc-Aggregation | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spring-Boot-Integrate-SpringDoc-Aggregation | Light Docusaurus"><meta data-rh="true" name="description" content="- springdoc-openapi demo"><meta data-rh="true" property="og:description" content="- springdoc-openapi demo"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.10a62360.css">
<script src="/light-docusaurus/assets/js/runtime~main.9eecdcd0.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.270bc9c7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a class="navbar__item navbar__link" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/light-docusaurus/docs/category/spring-boot/">Spring Boot</a><button aria-label="折叠侧边栏分类 &#x27;Spring Boot&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Api-Specification/">Api-Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/SPI/">SPI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Common-Async-Data-Handle/">Common-Async-Data-Handle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Multi-Thread-Transaction/">Multi-Thread-Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Obfuscate-Spring-Boot-Application-With-Classfinal/">Obfuscate-Spring-Boot-Application-With-Classfinal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Obfuscate-Spring-Boot-Application-With-Proguard/">Obfuscate-Spring-Boot-Application-With-Proguard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Endpoints/">Spring-Boot-Endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Ip-Address-Parse/">Spring-Boot-Ip-Address-Parse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Ip-Ragion-Parse/">Spring-Boot-Ip-Ragion-Parse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Json-Diff/">Spring-Boot-Json-Diff</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Native-Memory-Leak/">Spring-Boot-Native-Memory-Leak</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Unit-Test/">Spring-Boot-Unit-Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Core/">Spring-Core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Rate-Limit/">Spring-Rate-Limit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Statemachine/">Spring-Statemachine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/SpringEvent/">SpringEvent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Dynamic-Datasource/">Spring-Boot-Dynamic-Datasource</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-QrCode-Zxing/">Spring-Boot-QrCode-Zxing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-With-Enum-Type/">Spring-Boot-With-Enum-Type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Actuator/">Spring-Boot-Actuator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Parameter-Validate/">Spring-Boot-Parameter-Validate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Sql-Injection/">Sql-Injection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Enhance-Request-And-Response/">Enhance-Request-And-Response</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/">Spring-Boot-Integrate-SpringDoc-Aggregation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Hotswap-Aop/">Spring-Boot-Hotswap-Aop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Customlize-Request-Trace/">Customlize-Request-Trace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Integrate-Alipay/">Spring-Boot-Integrate-Alipay</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/light-docusaurus/docs/zh-cn/spring-boot/file/File-Upload-Split-Continue-on-Break/">file</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/light-docusaurus/docs/category/file/">File</a><button aria-label="展开侧边栏分类 &#x27;File&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/active-directory/">Active Directory</a><button aria-label="展开侧边栏分类 &#x27;Active Directory&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/light-docusaurus/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/awesome-open-source/">Awesome open source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/docs/category/spring-boot/"><span itemprop="name">Spring Boot</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring-Boot-Integrate-SpringDoc-Aggregation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring-Boot-Integrate-SpringDoc-Aggregation</h1></header><ul>
<li><a href="https://github.com/ahuadoreen/studentmanager" target="_blank" rel="noopener noreferrer">springdoc-openapi demo</a></li>
<li><a href="https://github.com/springdoc/springdoc-openapi" target="_blank" rel="noopener noreferrer">springdoc-openapi github</a></li>
<li><a href="https://springdoc.org/" target="_blank" rel="noopener noreferrer">springdoc-openapi 官方文档</a></li>
<li><a href="https://blog.csdn.net/wangzhihao1994/article/details/108408595" target="_blank" rel="noopener noreferrer">Spring Boot 整合 springdoc-openapi</a></li>
<li><a href="https://blog.csdn.net/qq_35425070/article/details/105347336" target="_blank" rel="noopener noreferrer">Swagger3 注解使用（Open API 3）</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="简单集成">简单集成<a href="#简单集成" class="hash-link" aria-label="简单集成的直接链接" title="简单集成的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-添加依赖项">1. 添加依赖项<a href="#1-添加依赖项" class="hash-link" aria-label="1. 添加依赖项的直接链接" title="1. 添加依赖项的直接链接">​</a></h3>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Springdoc 2.x --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    &lt;groupId&gt;io.springfox&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;/dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    &lt;artifactId&gt;knife4j-spring-boot-starter&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;/dependency&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!-- Springdoc 3.x --&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">org.springdoc</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">springdoc-openapi-starter-webmvc-ui</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.github.xiaoymin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">knife4j-openapi3-jakarta-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">&lt;!--&lt;dependency&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">    &lt;artifactId&gt;knife4j-openapi3-spring-boot-starter&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">&lt;/dependency&gt;--&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-添加配置">2. 添加配置<a href="#2-添加配置" class="hash-link" aria-label="2. 添加配置的直接链接" title="2. 添加配置的直接链接">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">light</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cloud</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Swagger 文档配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">openapi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">profiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">test</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">nat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">base-group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Light Cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">scan-group</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Demo Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">scan-packages</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.light.cloud.service.demo.controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Light Cloud Restful APIs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">license-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Apache License 2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">license-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//www.apache.org/licenses/LICENSE</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contact-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Light Cloud</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contact-email</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> whitetulips@163.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">contact-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gitee.com/lorchr/spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">terms-of-service-url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//gitee.com/lorchr/spring</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cloud</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">internals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">tencent-sdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">group-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Tencent SDK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.light.cloud.sdk.tencent.wechat.controller;com.light.cloud.sdk.tencent.wecom.controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">alibaba-sdk</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">group-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Alibaba SDK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> com.light.cloud.sdk.alibaba.dingtalk.controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Note: 外部接口这部分已经废弃 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">externals</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">classpath-doc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">group-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Classpath Doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> classpath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">openapi.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">local-doc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">group-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Local Doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> D</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/openapi.json.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">http-doc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">group-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HTTP Doc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">schema</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> localhost</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /v3/api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-openapiproperties-属性定义">3. OpenapiProperties 属性定义<a href="#3-openapiproperties-属性定义" class="hash-link" aria-label="3. OpenapiProperties 属性定义的直接链接" title="3. OpenapiProperties 属性定义的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.properties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.ArrayList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.constant.PlatformConstant;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Swagger属性配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author Hui Liu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/8/5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConfigurationProperties(prefix = OpenapiProperties.OPENAPI_PREFIX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OpenapiProperties {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String OPENAPI_PREFIX = &quot;light.cloud.openapi&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String OPENAPI_ENABLE = &quot;enable&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String OPENAPI_SCAN_PACKAGES = &quot;light.cloud.openapi.scan-packages&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean enable = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String profiles = &quot;dev,test,nat&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Web模块的名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String baseGroup = PlatformConstant.PLATFORM_NAME;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 扫描的业务服务名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String scanGroup;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 扫描的业务服务包路径 多个异&quot;,“分隔</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String scanPackages;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 服务描述信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String description = &quot;Light Cloud Restful APIs&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 服务版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String version = PlatformConstant.PLATFORM_VERSION;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 证书许可名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String licenseName = &quot;Apache License 2.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 证书许可URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String licenseUrl = &quot;https://www.apache.org/licenses/LICENSE-2.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 联系人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String contactName = PlatformConstant.PLATFORM_NAME;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 联系人URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String contactUrl = &quot;https://gitee.com/lorchr/spring-cloud-samples&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 联系人邮箱地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String contactEmail = &quot;whitetulips@163.com&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 服务条款URL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String termsOfServiceUrl = &quot;https://gitee.com/lorchr/spring-cloud-samples&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 依赖的其他公共模块 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * group-name: 接口文档分组名称 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * location: 接口文档的包路径 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, RouteDefinition&gt; internals = new HashMap&lt;&gt;(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @deprecated 此方式只能实现接口的展示，不能跨服务调用，使用 knife4j aggregation 代替</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 引用外部的api文件解析生成文档 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * group-name: 接口文档分组名称 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * location: 接口文档的包路径 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * openapi文档地址支持多种格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     &lt;li&gt;Windows本地文件: file:///D:/openapi.json.txt&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     &lt;li&gt;Linux本地文件: file://var/lib/openapi.json&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     &lt;li&gt;Classpath文件: classpath:openapi.json&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     &lt;li&gt;Http资源文件: http://localhost:8080/v3/api-docs&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *     &lt;li&gt;...&lt;/li&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;/ul&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, RouteDefinition&gt; externals = new HashMap&lt;&gt;(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-routedefinition-路由定义">4. RouteDefinition 路由定义<a href="#4-routedefinition-路由定义" class="hash-link" aria-label="4. RouteDefinition 路由定义的直接链接" title="4. RouteDefinition 路由定义的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.properties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.Data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RouteDefinition {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 接口文档分组名称 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 认证服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String groupName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 文档读取协议 http https ftp file ...  &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * http</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 文档读取地址 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String uri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 文档读取位置 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * /auth/v3/api-docs &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * com.light.cloud.sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String location;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 服务器地址 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * http://localhost:8080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String serverUrl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-openapiconfig-配置类">5. OpenapiConfig 配置类<a href="#5-openapiconfig-配置类" class="hash-link" aria-label="5. OpenapiConfig 配置类的直接链接" title="5. OpenapiConfig 配置类的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.Components;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.ExternalDocumentation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.media.StringSchema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.parameters.HeaderParameter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.common.collect.Lists;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.constant.PlatformConstant;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.processor.OpenapiAdditionalBeanRegistry;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.properties.OpenapiProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.annotations.enums.ParameterIn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.OpenAPI;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.info.Contact;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.info.Info;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.info.License;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.parameters.Parameter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.security.OAuthFlow;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.security.OAuthFlows;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.security.Scopes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.security.SecurityRequirement;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.security.SecurityScheme;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.annotation.Resource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Openapi配置类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author Hui Liu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/7/29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableConfigurationProperties(value = {OpenapiProperties.class})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OpenapiConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value(&quot;${&quot; + PlatformConstant.SPRING_APPLICATION_NAME + &quot;:&#x27;Light Cloud&#x27;}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String serviceName;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private OpenapiProperties openapiProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OpenAPI openAPI() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 添加 components 后可以重复引用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Components components = new Components()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addParameters(PlatformConstant.HEADER_CLIENT_ID, clientId())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addParameters(PlatformConstant.HEADER_AUTHORIZATION, authorization());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new OpenAPI()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .info(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        new Info().title(serviceName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .description(openapiProperties.getDescription())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .version(openapiProperties.getVersion())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .license(new License()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        .name(openapiProperties.getLicenseName())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        .url(openapiProperties.getLicenseUrl()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .contact(new Contact()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        .name(openapiProperties.getContactName())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        .email(openapiProperties.getContactEmail())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        .url(openapiProperties.getContactUrl()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .termsOfService(openapiProperties.getTermsOfServiceUrl())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                //外部文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .externalDocs(new ExternalDocumentation()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .description(&quot;官方文档&quot;).url(&quot;https://springdoc.org&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .webhooks(new HashMap&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 全局统一安全认证配置 一个key对应一个schema（安全配置），</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 对接口添加 @SecurityRequirement 可使用不同的安全规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .schemaRequirement(PlatformConstant.HEADER_AUTHORIZATION, apikeySecuritySchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .schemaRequirement(PlatformConstant.HEADER_CLIENT_ID, apikeySecuritySchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .schemaRequirement(HttpHeaders.AUTHORIZATION, oauth2SecuritySchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 全局安全校验项，也可以在对应的controller上加注解SecurityRequirement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addSecurityItem(new SecurityRequirement().addList(PlatformConstant.HEADER_AUTHORIZATION))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 组件定义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .components(components);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 动态注册Swagger文档配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OpenapiAdditionalBeanRegistry openapiAdditionalBeanRegistry() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new OpenapiAdditionalBeanRegistry();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // region 统一认证配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Access Token Header接口级授权 &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * https://github.com/springfox/springfox/issues/3477  &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Note: 使用List注入时无法接收服务内定义的参数，单独注入可以避免这个问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Parameter authorization() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Parameter authorization = new Parameter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(PlatformConstant.HEADER_AUTHORIZATION)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数描述信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(&quot;认证的 Token。当全局授权（Authorize）后，此处不必填写&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数类型 QUERY HEADER COOKIE PATH FORM BODY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in(ParameterIn.HEADER.toString())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数数据类型定义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .schema(new StringSchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 是否必填</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .required(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return authorization;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Parameter clientId() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Parameter clientId = new Parameter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(PlatformConstant.HEADER_CLIENT_ID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数描述信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(&quot;ClientId 系统的名称&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数类型 QUERY HEADER COOKIE PATH FORM BODY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in(ParameterIn.HEADER.toString())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数数据类型定义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .schema(new StringSchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 是否必填</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .required(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return clientId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Access Token Header接口级授权</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * &lt;p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * https://github.com/springfox/springfox/issues/3477</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;Parameter&gt; openapiParameters() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Parameter accessToken = new Parameter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(PlatformConstant.HEADER_AUTHORIZATION)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数描述信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(&quot;认证的 Token。当全局授权（Authorize）后，此处不必填写&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数类型 QUERY HEADER COOKIE PATH FORM BODY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in(ParameterIn.HEADER.toString())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 是否必填</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .required(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Parameter systemName = new Parameter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(PlatformConstant.HEADER_CLIENT_ID)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数描述信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(&quot;ClientId 系统的名称&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 参数类型 QUERY HEADER COOKIE PATH FORM BODY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in(ParameterIn.HEADER.toString())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 是否必填</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .required(false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Lists.newArrayList(accessToken, systemName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * apikey认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SecurityScheme apikeySecuritySchema() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SecurityScheme()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .type(SecurityScheme.Type.APIKEY)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(PlatformConstant.HEADER_AUTHORIZATION)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in(SecurityScheme.In.HEADER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * http认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SecurityScheme httpSecuritySchema() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SecurityScheme()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .type(SecurityScheme.Type.HTTP)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(PlatformConstant.HEADER_AUTHORIZATION)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .in(SecurityScheme.In.HEADER);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * oauth认证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SecurityScheme oauth2SecuritySchema() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new SecurityScheme()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // token类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .type(SecurityScheme.Type.OAUTH2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .name(&quot;OAuth2认证&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .description(&quot;OAuth2认证&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .flows(new OAuthFlows()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        .implicit()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        .clientCredentials()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .password(new OAuthFlow()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .authorizationUrl(&quot;/oauth2/authorize&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .tokenUrl(&quot;/oauth2/token&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .refreshUrl(&quot;/oauth2/refreshToken&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .scopes(scopes()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .authorizationCode(new OAuthFlow()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .authorizationUrl(&quot;/oauth2/authorize&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .tokenUrl(&quot;/oauth2/token&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .refreshUrl(&quot;/oauth2/refreshToken&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                .scopes(scopes())));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Scopes scopes() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new Scopes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addString(&quot;global&quot;, &quot;accessAnything&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-springdocconfig-配置类">6. SpringDocConfig 配置类<a href="#6-springdocconfig-配置类" class="hash-link" aria-label="6. SpringDocConfig 配置类的直接链接" title="6. SpringDocConfig 配置类的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.charset.StandardCharsets;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.ArrayList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Arrays;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Collection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Collections;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.stream.Collectors;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.constant.PlatformConstant;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.parameters.HeaderParameter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.collections4.CollectionUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.collections4.MapUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.lang3.ArrayUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.lang3.StringUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springdoc.core.customizers.OpenApiCustomizer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springdoc.core.customizers.GlobalOpenApiCustomizer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springdoc.core.customizers.GlobalOperationCustomizer;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springdoc.core.models.GroupedOpenApi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.autoconfigure.endpoint.web.CorsEndpointProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.autoconfigure.endpoint.web.WebEndpointProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.autoconfigure.web.server.ManagementPortType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.ExposableEndpoint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.EndpointLinksResolver;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.EndpointMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.EndpointMediaTypes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.ExposableWebEndpoint;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.WebEndpointsSupplier;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.annotation.ControllerEndpointsSupplier;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.annotation.ServletEndpointsSupplier;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.actuate.endpoint.web.servlet.WebMvcEndpointHandlerMapping;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Profiles;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.method.HandlerMethod;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.fasterxml.jackson.core.JsonProcessingException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.fasterxml.jackson.databind.JsonNode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.fasterxml.jackson.databind.ObjectMapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.fasterxml.jackson.databind.node.TreeTraversingParser;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.fasterxml.jackson.databind.type.MapType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.constant.BaseConstant;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.enums.ResponseEnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.tool.StringTool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.properties.OpenapiProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.properties.RouteDefinition;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.core.util.Json;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.core.util.Yaml;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.Components;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.media.Schema;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.OpenAPI;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.Operation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.parameters.Parameter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.PathItem;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.Paths;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.swagger.v3.oas.models.servers.Server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.annotation.Resource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lombok.extern.slf4j.Slf4j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * SpringDoc配置类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author Hui Liu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/7/29</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SpringDocConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Value((&quot;${server.servlet.context-path:}&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String contextPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String BASE_PACKAGE = &quot;com.light.cloud.common.web.endpoints&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Environment environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private OpenapiProperties openapiProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Parameter&gt; openapiParameters;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private CustomOperationCustomizer customOperationCustomizer = new CustomOperationCustomizer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private CustomOpenApiCustomizer customOpenApiCustomizer = new CustomOpenApiCustomizer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 添加分组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(&quot;platformApi&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GroupedOpenApi platformApi() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isOpen = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String profileStr = openapiProperties.getProfiles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StringUtils.isNotBlank(profileStr)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;String&gt; profileList = Arrays.stream(profileStr.split(BaseConstant.COMMA))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .map(String::trim).collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Profiles profiles = Profiles.of(profileList.toArray(new String[0]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isOpen = environment.acceptsProfiles(profiles);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return GroupedOpenApi.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .group(openapiProperties.getBaseGroup())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 扫描该包下  的所有需要在Swagger中展示的API，@Hidden 注解标注的除外</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .packagesToScan(BASE_PACKAGE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加全局参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addOperationCustomizer(customOperationCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加统一的上下文地址 contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .addOpenApiCustomizer(customOpenApiCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(&quot;serviceApi&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public GroupedOpenApi serviceApi() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isOpen = true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String profileStr = openapiProperties.getProfiles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StringUtils.isNotBlank(profileStr)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;String&gt; profileList = Arrays.stream(profileStr.split(BaseConstant.COMMA))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .map(String::trim).collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Profiles profiles = Profiles.of(profileList.toArray(new String[0]));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            isOpen = environment.acceptsProfiles(profiles);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return GroupedOpenApi.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .group(openapiProperties.getScanGroup())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 扫描该包下的所有需要在Swagger中展示的API， @Hidden 注解标注的除外</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .packagesToScan(openapiProperties.getScanPackages())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加全局参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .addOperationCustomizer(customOperationCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加统一的上下文地址 contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .addOpenApiCustomizer(customOpenApiCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // region 动态注册Swagger文档配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//     * 动态注册Swagger文档配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    public OpenapiAdditionalBeanRegistry openapiAdditionalBeanRegistry() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        return new OpenapiAdditionalBeanRegistry();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 注册项目模块内部的接口文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void registerInternalOpenApis(ConfigurableListableBeanFactory beanFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, GroupedOpenApi&gt; openApis = internalOpenApis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Map.Entry&lt;String, GroupedOpenApi&gt; entry : openApis.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String docName = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GroupedOpenApi openApi = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanFactory.registerSingleton(docName + &quot;InternalApi&quot;, openApi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 注册项目模块外部的接口文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @deprecated 此方式只能实现接口的展示，不能跨服务调用，使用 knife4j aggregation 代替</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void registerExternalOpenApis(ConfigurableListableBeanFactory beanFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, GroupedOpenApi&gt; openApis = externalOpenApis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Map.Entry&lt;String, GroupedOpenApi&gt; entry : openApis.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String docName = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GroupedOpenApi openApi = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            beanFactory.registerSingleton(docName + &quot;ExternalApi&quot;, openApi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 解析项目模块内部的接口文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return key-组名称 value-Api文档对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;String, GroupedOpenApi&gt; internalOpenApis() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, RouteDefinition&gt; internals = openapiProperties.getInternals();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (MapUtils.isEmpty(internals)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Collections.emptyMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, GroupedOpenApi&gt; openApiMap = new HashMap&lt;&gt;(internals.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Map.Entry&lt;String, RouteDefinition&gt; entry : internals.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String entityKey = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RouteDefinition route = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String groupName = StringUtils.isBlank(route.getGroupName()) ? parseGroupName(entityKey) : route.getGroupName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String scanPackage = route.getLocation();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GroupedOpenApi openApi = GroupedOpenApi.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .group(groupName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 扫描该包下的所有需要在Swagger中展示的API，@Hidden 注解标注的除外</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .packagesToScan(scanPackage)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 添加全局参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .addOperationCustomizer(customOperationCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 添加统一  的上下文地址 contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    .addOpenApiCustomizer(customOpenApiCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            openApiMap.put(entityKey, openApi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return openApiMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 解析项目模块外部的接口文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return key-组名称 value-Api文档对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @deprecated 此方式只能实现接口的展示，不能跨服务调用，使用 knife4j aggregation 代替</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;String, GroupedOpenApi&gt; externalOpenApis() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, RouteDefinition&gt; externals = openapiProperties.getExternals();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (MapUtils.isEmpty(externals)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Collections.emptyMap();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, GroupedOpenApi&gt; openApiMap = new HashMap&lt;&gt;(externals.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (Map.Entry&lt;String, RouteDefinition&gt; entry : externals.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String entityKey = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RouteDefinition route = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String groupName = StringUtils.isBlank(route.getGroupName()) ? parseGroupName(entityKey) : route.getGroupName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String resourcePath = buildUrl(route.getSchema().toLowerCase(), route.getUri(), route.getLocation());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; apiSpecMap = getResourceAsMap(resourcePath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            GroupedOpenApi openApi = GroupedOpenApi.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .group(groupName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 扫描该包下的所有需要在Swagger中展示的API，@Hidden 注解标注的除外</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    .packagesToScan(scanPackage)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 添加全局参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .addOperationCustomizer(customOperationCustomizer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 添加统一的上下文地址 contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .addOpenApiCustomizer(new FileOpenApiCustomizer(apiSpecMap, route.getServerUrl()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            openApiMap.put(entityKey, openApi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return openApiMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String parseGroupName(String entityKey) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String[] strings = StringUtils.splitByCharacterTypeCamelCase(entityKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Arrays.stream(strings).map(s -&gt; StringTool.toUpperCamelCase(s, null))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .collect(Collectors.joining(BaseConstant.SPACE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String buildUrl(String schema, String uri, String path) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StringUtils.equalsAny(schema, &quot;http&quot;, &quot;https&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return schema + &quot;://&quot; + uri + &quot;/&quot; + path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (StringUtils.equalsAny(schema, &quot;ftp&quot;, &quot;sftp&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return schema + &quot;://&quot; + uri + &quot;/&quot; + path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (StringUtils.equalsAny(schema, &quot;classpath&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else if (StringUtils.equalsAny(schema, &quot;file&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String osName = System.getProperty(&quot;os.name&quot;).toLowerCase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (osName.startsWith(&quot;windows&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return schema + &quot;:///&quot; + uri + &quot;/&quot; + path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (osName.startsWith(&quot;linux&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return schema + &quot;:/&quot; + uri + &quot;/&quot; + path;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        throw new UnsupportedOperationException(&quot;Unsupported schema: &quot; + schema);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, Object&gt; getResourceAsMap(String resourcePath) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 支持 classpath:  file:// http: ftp:// 等协议</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            org.springframework.core.io.Resource resource = new PathMatchingResourcePatternResolver()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .getResource(resourcePath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            byte[] bytes = resource.getContentAsByteArray();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (ArrayUtils.isNotEmpty(bytes)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String content = new String(bytes, StandardCharsets.UTF_8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, Object&gt; apiSpecMap = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (resourcePath.endsWith(BaseConstant.DOT_YAML) || resourcePath.endsWith(BaseConstant.DOT_YML)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    apiSpecMap = yamlToMap(content, Map.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    apiSpecMap = jsonToMap(content, Map.class, String.class, Object.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return apiSpecMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception ex) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(ex.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // region 可解决Spring 6.x 与Swagger 3.0.0 不兼容问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 增加如下配置可解决Spring 6.x 与Swagger 3.0.0 不兼容问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     **/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public WebMvcEndpointHandlerMapping webEndpointServletHandlerMapping(WebEndpointsSupplier webEndpointsSupplier,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         ServletEndpointsSupplier servletEndpointsSupplier,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         ControllerEndpointsSupplier controllerEndpointsSupplier,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         EndpointMediaTypes endpointMediaTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         CorsEndpointProperties corsProperties,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         WebEndpointProperties webEndpointProperties,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                                                         Environment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;ExposableEndpoint&lt;?&gt;&gt; allEndpoints = new ArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Collection&lt;ExposableWebEndpoint&gt; webEndpoints = webEndpointsSupplier.getEndpoints();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allEndpoints.addAll(webEndpoints);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allEndpoints.addAll(servletEndpointsSupplier.getEndpoints());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        allEndpoints.addAll(controllerEndpointsSupplier.getEndpoints());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String basePath = webEndpointProperties.getBasePath();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        EndpointMapping endpointMapping = new EndpointMapping(basePath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean shouldRegisterLinksMapping = this.shouldRegisterLinksMapping(webEndpointProperties, environment, basePath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new WebMvcEndpointHandlerMapping(endpointMapping, webEndpoints,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                endpointMediaTypes, corsProperties.toCorsConfiguration(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new EndpointLinksResolver(allEndpoints, basePath), shouldRegisterLinksMapping);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private boolean shouldRegisterLinksMapping(WebEndpointProperties webEndpointProperties,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               Environment environment,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                               String basePath) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return webEndpointProperties.getDiscovery().isEnabled()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &amp;&amp; (org.springframework.util.StringUtils.hasText(basePath)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                || ManagementPortType.get(environment).equals(ManagementPortType.DIFFERENT));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // region 全局参数及上下文处理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 添加全局的请求头参数，并为所有接口添加context-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public OpenApiCustomizer customerGlobalOpenApiCustomizer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return openApi -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Paths paths = openApi.getPaths();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String[] pathSet = paths.keySet().toArray(new String[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (String path : pathSet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PathItem pathItem = paths.get(path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加全局的请求头参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                pathItem.readOperations().forEach(operation -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 引用在 OpenAPI 中定义的 components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    operation.addParametersItem(new HeaderParameter().$ref(&quot;#/components/parameters/&quot; + PlatformConstant.HEADER_CLIENT_ID))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .addParametersItem(new HeaderParameter().$ref(&quot;#/components/parameters/&quot; + PlatformConstant.HEADER_AUTHORIZATION));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 为接口添加 context-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                paths.put(contextPath + path, pathItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                paths.remove(path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class CustomOperationCustomizer implements GlobalOperationCustomizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public Operation customize(Operation operation, HandlerMethod handlerMethod) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Parameter parameter : openapiParameters) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                operation.addParametersItem(parameter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return operation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class CustomOpenApiCustomizer implements GlobalOpenApiCustomizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void customise(OpenAPI openApi) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StringUtils.isBlank(contextPath)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Paths paths = openApi.getPaths();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // To avoid ConcurrentModificationException</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String[] keySet = paths.keySet().toArray(new String[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (String key : keySet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (key.startsWith(contextPath)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PathItem pathItem = paths.get(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // add contextPath to the individual operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                paths.put(contextPath + key, pathItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                paths.remove(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Server server = openApi.getServers().get(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            // Add the basePath to the server entry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            server.setUrl(server.getUrl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @see &lt;a href=&quot;https://stackoverflow.com/questions/71156280/how-can-i-add-custom-json-object-to-openapi-spec-generated-by-springboot-springd&quot;&gt;How can I add custom json object to Openapi spec generated by SpringBoot SpringDoc?&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @see &lt;a href=&quot;https://github.com/springdoc/springdoc-openapi/issues/705&quot;&gt;Programatically schemas added are not showed in the generated openapi &lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @see &lt;a href=&quot;https://github.com/springdoc/springdoc-openapi/issues/1703&quot;&gt;How to refresh the API&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class FileOpenApiCustomizer implements GlobalOpenApiCustomizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private Map&lt;String, Object&gt; apiSpecMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private List&lt;String&gt; serverUrls;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public FileOpenApiCustomizer(Map&lt;String, Object&gt; apiSpecMap, String serverUrls) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.apiSpecMap = apiSpecMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StringUtils.isNotBlank(serverUrls)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.serverUrls = Arrays.stream(serverUrls.split(&quot;,&quot;)).toList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public void customise(OpenAPI openApi) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StringUtils.isBlank(contextPath)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                contextPath = &quot;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // add external info to api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; extensions = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            extensions.put(&quot;external&quot;, &quot;https://lorchr.github.io/light-docusaurus&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            openApi.setExtensions(extensions);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 添加server信息，发送请求是 curl脚本会生成新的url</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (CollectionUtils.isNotEmpty(serverUrls)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                List&lt;Server&gt; servers = serverUrls.stream().map(url -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Server server = new Server();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    server.setUrl(url);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return server;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }).collect(Collectors.toList());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                openApi.setServers(servers);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; pathMap = (Map&lt;String, Object&gt;) apiSpecMap.get(&quot;paths&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Paths paths = openApi.getPaths();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Note: 如果此处不清空，其他接口的数据也会显示到当前的接口集中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            paths.clear();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Map.Entry&lt;String, Object&gt; entry : pathMap.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String key = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, Object&gt; valueMap = (Map&lt;String, Object&gt;) entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                PathItem pathItem = jsonToBean(beanToJson(valueMap), PathItem.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                for (Map.Entry&lt;String, Object&gt; innerEntry : valueMap.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    String innerKey = innerEntry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    Object innerValue = innerEntry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    Operation operation = jsonToBean(JsonTool.beanToJson(innerValue), Operation.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    if (PathItem.HttpMethod.POST.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setPost(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.GET.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setGet(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.PUT.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setPut(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.PATCH.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setPatch(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.DELETE.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setDelete(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.HEAD.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setHead(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.OPTIONS.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setOptions(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    } else if (PathItem.HttpMethod.TRACE.name().equalsIgnoreCase(innerKey)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                        pathItem.setTrace(operation);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                paths.addPathItem(key, pathItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            String openapi = (String) apiSpecMap.get(&quot;openapi&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            List&lt;Object&gt; info = (List&lt;Object&gt;) apiSpecMap.get(&quot;info&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Map&lt;String, Object&gt; externalDocs = (Map&lt;String, Object&gt;) apiSpecMap.get(&quot;externalDocs&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            List&lt;Object&gt; servers = (List&lt;Object&gt;) apiSpecMap.get(&quot;servers&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            List&lt;Object&gt; tags = (List&lt;Object&gt;) apiSpecMap.get(&quot;tags&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Map&lt;String, Object&gt; paths = (Map&lt;String, Object&gt;) apiSpecMap.get(&quot;paths&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            List&lt;Object&gt; security = (List&lt;Object&gt;) apiSpecMap.get(&quot;security&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            Map&lt;String, Object&gt; components = (Map&lt;String, Object&gt;) apiSpecMap.get(&quot;components&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Components components = openApi.getComponents();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; componentMap = (Map&lt;String, Object&gt;) apiSpecMap.get(&quot;components&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; schemaMap = (Map&lt;String, Object&gt;) componentMap.get(&quot;schemas&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Map.Entry&lt;String, Object&gt; entry : schemaMap.entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String key = entry.getKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Object value = entry.getValue();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Schema schema = jsonToBean(beanToJson(value), Schema.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                components.addSchemas(key, schema);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // endregion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 使用Swagger时，最好使用自带的 {@link io.swagger.v3.core.util.Json} {@link io.swagger.v3.core.util.Yaml}解析类</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param content json字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param clazz   目标对象类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return clazz 类型对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; T jsonToBean(String content, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Json.mapper().readValue(content, clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (JsonProcessingException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map jsonToMap(String content, Class&lt;? extends Map&gt; mapType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         Class&lt;String&gt; keyType, Class&lt;Object&gt; valueType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ObjectMapper mapper = Json.mapper();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MapType type = mapper.getTypeFactory()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .constructMapType(mapType, keyType, valueType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return mapper.readValue(content, type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (JsonProcessingException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String beanToJson(Object bean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Json.mapper().writeValueAsString(bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (JsonProcessingException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public &lt;T&gt; T yamlToBean(String content, Class&lt;T&gt; clazz) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Yaml.mapper().readValue(content, clazz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (JsonProcessingException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Jackson yaml不支持带锚点的yaml文档解析：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @see &lt;a href=&quot;https://stackoverflow.com/questions/40074700/jackson-yaml-support-for-anchors-and-references&quot;&gt;Jackson YAML: support for anchors and references&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @see &lt;a href=&quot;https://github.com/FasterXML/jackson-dataformats-text/issues/98&quot;&gt;Jackson Yaml anchors/references Support&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static &lt;K, V&gt; Map&lt;K, V&gt; yamlToMap(String content, Class&lt;? extends Map&gt; mapType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                             Class&lt;K&gt; keyType, Class&lt;V&gt; valueType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ObjectMapper mapper = Yaml.mapper();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final JsonNode rootNode = mapper.readTree(content);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            MapType type = mapper.getTypeFactory()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .constructMapType(mapType, keyType, valueType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TreeTraversingParser treeTraversingParser = new TreeTraversingParser(rootNode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return mapper.readValue(treeTraversingParser, type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.error(ResponseEnum.YAML_PARSE_ERROR.getDesc(), e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 使用 snakeyaml 可以支持锚点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map yamlToMap(String content, Class&lt;? extends Map&gt; mapType) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        org.yaml.snakeyaml.Yaml yaml = new org.yaml.snakeyaml.Yaml();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return yaml.loadAs(content, mapType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String beanToYaml(Object bean) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Yaml.mapper().writeValueAsString(bean);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (JsonProcessingException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7openapiadditionalbeanregistry-动态注册类">7.OpenapiAdditionalBeanRegistry 动态注册类<a href="#7openapiadditionalbeanregistry-动态注册类" class="hash-link" aria-label="7.OpenapiAdditionalBeanRegistry 动态注册类的直接链接" title="7.OpenapiAdditionalBeanRegistry 动态注册类的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.processor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springdoc.core.properties.SpringDocConfigProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.BeansException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.PropertyValues;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.BeanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.BeanFactoryAware;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.config.InstantiationAwareBeanPostProcessor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.config.SpringDocConfig;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.annotation.Resource;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Swagger 额外Bean的手动注册</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see springfox.documentation.spring.web.plugins.DocumentationPluginsManager</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see org.springdoc.core.providers.SpringDocProviders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see org.springdoc.core.configuration.SpringDocConfiguration#springDocProviders(java.util.Optional, java.util.Optional, java.util.Optional, java.util.Optional, java.util.Optional, java.util.Optional, java.util.Optional, org.springdoc.core.providers.ObjectMapperProvider)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see org.springframework.web.servlet.DispatcherServlet#doDispatch(jakarta.servlet.http.HttpServletRequest, jakarta.servlet.http.HttpServletResponse)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see org.springdoc.webmvc.ui.SwaggerConfigResource#openapiJson(HttpServletRequest)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author Hui Liu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2022/9/27</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OpenapiAdditionalBeanRegistry implements InstantiationAwareBeanPostProcessor, BeanFactoryAware {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private SpringDocConfig springDocConfig;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private SpringDocConfigProperties springDocConfigProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ConfigurableListableBeanFactory beanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setBeanFactory(BeanFactory beanFactory) throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (beanFactory instanceof ConfigurableListableBeanFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.beanFactory = (ConfigurableListableBeanFactory) beanFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PropertyValues postProcessProperties(PropertyValues pvs, Object bean, String beanName) throws BeansException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // springfox 切入点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        if (&quot;documentationPluginsManager&quot;.equals(beanName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//            springDocConfig.registerOpenApis(beanFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // springdoc 切入点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (&quot;springDocProviders&quot;.equals(beanName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            springDocConfig.registerInternalOpenApis(beanFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Note: 接口废弃，外部接口调用使用 knife4j-aggregation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            springDocConfig.registerExternalOpenApis(beanFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 禁用缓存，会自动加载新的文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SpringDocConfigProperties.Cache cache = springDocConfigProperties.getCache();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!cache.isDisabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                cache.setDisabled(Boolean.TRUE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                springDocConfigProperties.setCache(cache);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return InstantiationAwareBeanPostProcessor.super.postProcessProperties(pvs, bean, beanName);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title=" 复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="聚合api文档">聚合Api文档<a href="#聚合api文档" class="hash-link" aria-label="聚合Api文档的直接链接" title="聚合Api文档的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-添加依赖项-1">1. 添加依赖项<a href="#1-添加依赖项-1" class="hash-link" aria-label="1. 添加依赖项的直接链接" title="1. 添加依赖项的直接链接">​</a></h3>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">com.github.xiaoymin</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">knife4j-aggregation-spring-boot-starter</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-添加配置-1">2. 添加配置<a href="#2-添加配置-1" class="hash-link" aria-label="2. 添加配置的直接链接" title="2. 添加配置的直接链接">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 使用 knife4j aggregation 实现外部接口的展示和调用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">knife4j</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">enable-aggregation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">cloud</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 权限管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.3.49</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /oauth/v3/api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 系统管理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uri</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.3.49</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">location</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /system/v3/api</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">docs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-routeproxyfilter-路由过滤器">3. RouteProxyFilter 路由过滤器<a href="#3-routeproxyfilter-路由过滤器" class="hash-link" aria-label="3. RouteProxyFilter 路由过滤器的直接链接" title="3. RouteProxyFilter 路由过滤器的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation.filter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.io.IoUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.util.StrUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.fasterxml.jackson.core.type.TypeReference;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.SwaggerRoute;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.gson.Gson;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.gson.GsonBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.google.gson.stream.JsonReader;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.core.tool.JsonTool;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.RouteDispatcher;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.Filter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.FilterChain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.FilterConfig;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletOutputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.collections4.CollectionUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.collections4.MapUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.commons.lang3.StringUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.Logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.LoggerFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.web.util.ContentCachingResponseWrapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.PrintWriter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.charset.StandardCharsets;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.ArrayList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Enumeration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Objects;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.function.Function;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.stream.Collectors;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.spring.configuration.Knife4jAggregationAutoConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.core.filter.Knife4jRouteProxyFilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/10/29 20:06</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RouteProxyFilter implements Filter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final RouteDispatcher routeDispatcher;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final Gson gson = new GsonBuilder().create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Logger logger = LoggerFactory.getLogger(RouteProxyFilter.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteProxyFilter(RouteDispatcher routeDispatcher) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.routeDispatcher = routeDispatcher;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void init(FilterConfig filterConfig) throws ServletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String uri = request.getRequestURI();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Note: 有些版本的前端代码中Header名称 knife4j-gateway-request 存在拼写错误</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (routeDispatcher.checkRoute(request.getHeader(RouteDispatcher.ROUTE_PROXY_HEADER_NAME))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StrUtil.endWith(uri, RouteDispatcher.OPENAPI_GROUP_INSTANCE_ENDPOINT)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String group = request.getParameter(&quot;group&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SwaggerRoute swaggerRoute = routeDispatcher.getRoute(group);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                writeRouteResponse(response, null, swaggerRoute == null ? &quot;&quot; : swaggerRoute.getContent());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 响应当前服务disk-实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (logger.isDebugEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    logger.debug(&quot;Current Request URI:{},Proxy Request&quot;, uri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                routeDispatcher.execute(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // go on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StrUtil.endWith(uri, RouteDispatcher.OPENAPI_GROUP_ENDPOINT)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 响应当前服务聚合结构</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ContentCachingResponseWrapper responseWrapper = response instanceof ContentCachingResponseWrapper ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        (ContentCachingResponseWrapper) response : new ContentCachingResponseWrapper(response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                filterChain.doFilter(request, responseWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String result = new String(responseWrapper.getContentAsByteArray());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                writeRouteResponse(response, result, gson.toJson(routeDispatcher.getRoutes()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (StrUtil.endWith(uri, RouteDispatcher.OPENAPI_GROUP_INSTANCE_ENDPOINT)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 响应当前服务disk-实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String group = request.getParameter(&quot;group&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                SwaggerRoute swaggerRoute = routeDispatcher.getRoute(group);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                writeRouteResponse(response, null, swaggerRoute == null ? &quot;&quot; : swaggerRoute.getContent());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (uri.endsWith(&quot;/webjars/js/app.b0c0d7df.js&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // Note: 修复 openapi 3.0 兼容性问题</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ContentCachingResponseWrapper responseWrapper = response instanceof ContentCachingResponseWrapper ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        (ContentCachingResponseWrapper) response : new ContentCachingResponseWrapper(response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                filterChain.doFilter(request, responseWrapper);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String result = new String(responseWrapper.getContentAsByteArray());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String newResult = result.replace(&quot;url:re.a.getValue(e,\&quot;url\&quot;,\&quot;\&quot;,!0)&quot;, &quot;url:re.a.getValue(e,\&quot;url\&quot;,\&quot;\&quot;,!0),header:re.a.getValue(e,\&quot;header\&quot;,\&quot;\&quot;,!0)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .replace(&quot;url:re.a.getValue(t,\&quot;url\&quot;,\&quot;\&quot;,!0)&quot;, &quot;url:re.a.getValue(t,\&quot;url\&quot;,\&quot;\&quot;,!0),header:re.a.getValue(t,\&quot;header\&quot;,\&quot;\&quot;,!0)&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .replace(&quot;t.servicePath=re.a.getValue(e,\&quot;servicePath\&quot;,null,!0)&quot;, &quot;t.servicePath=re.a.getValue(e,\&quot;servicePath\&quot;,null,!0),t.header=re.a.getValue(e,\&quot;header\&quot;,null,!0)&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] bytes = newResult.getBytes(StandardCharsets.UTF_8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                responseWrapper.setContentLengthLong(bytes.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                responseWrapper.setContentLength(bytes.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                responseWrapper.setBufferSize(bytes.length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                responseWrapper.getOutputStream().write(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                responseWrapper.copyBodyToResponse();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                filterChain.doFilter(servletRequest, servletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 响应服务端的内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param response 响应流</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param content 内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @throws IOException 异常</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void writeRouteResponse(HttpServletResponse response, String result, String content) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] bytes = content.getBytes(StandardCharsets.UTF_8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StringUtils.isNotBlank(result)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; resultMap = JsonTool.jsonToMap(result, Map.class, String.class, Object.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;Map&lt;String, Object&gt;&gt; routes = JsonTool.jsonToBean(content, new TypeReference&lt;List&lt;Map&lt;String, Object&gt;&gt;&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (CollectionUtils.isNotEmpty(routes)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 添加外部文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                List&lt;Map&lt;String, Object&gt;&gt; urls = (List&lt;Map&lt;String, Object&gt;&gt;) resultMap.getOrDefault(&quot;urls&quot;, new ArrayList&lt;&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (Map&lt;String, Object&gt; route : routes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    route.put(&quot;url&quot;, routeDispatcher.getRootPath() + route.get(&quot;location&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    urls.add(route);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 移除单独的文档配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // resultMap.remove(&quot;url&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                resultMap.put(&quot;urls&quot;, urls);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                bytes = JsonTool.beanToJson(resultMap).getBytes(StandardCharsets.UTF_8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ServletOutputStream outputStream = response.getOutputStream();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outputStream.write(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outputStream.flush();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        outputStream.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void destroy() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-securitybasicauthfilter-认证过滤器">4. SecurityBasicAuthFilter 认证过滤器<a href="#4-securitybasicauthfilter-认证过滤器" class="hash-link" aria-label="4. SecurityBasicAuthFilter 认证过滤器的直接链接" title="4. SecurityBasicAuthFilter 认证过滤器的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation.filter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.BasicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.Filter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.FilterChain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.FilterConfig;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.Logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.LoggerFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Base64;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.spring.configuration.Knife4jAggregationAutoConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.core.filter.Knife4jSecurityBasicAuthFilter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/11/25 19:55</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class SecurityBasicAuthFilter implements Filter {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Logger logger = LoggerFactory.getLogger(SecurityBasicAuthFilter.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * basic auth验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String SwaggerBootstrapUiBasicAuthSession = &quot;Knife4jAggregationBasicAuthSession&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 是否开启basic验证,默认不开启</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 文档Basic保护</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private BasicAuth basicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SecurityBasicAuthFilter(BasicAuth basicAuth) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.basicAuth = basicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected String decodeBase64(String source) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String decodeStr = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (source != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // BASE64Decoder decoder=new BASE64Decoder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // byte[] bytes=decoder.decodeBuffer(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                byte[] bytes = Base64.getDecoder().decode(source);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                decodeStr = new String(bytes);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.error(e.getMessage(), e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return decodeStr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void init(FilterConfig filterConfig) throws ServletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletRequest servletRequest = (HttpServletRequest) request;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpServletResponse httpServletResponse = (HttpServletResponse) response;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 针对swagger资源请求过滤</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (basicAuth != null &amp;&amp; basicAuth.isEnable()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 判断Session中是否存在</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Object swaggerSessionValue = servletRequest.getSession().getAttribute(SwaggerBootstrapUiBasicAuthSession);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (swaggerSessionValue != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                chain.doFilter(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 匹配到,判断auth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 获取请求头Authorization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String auth = servletRequest.getHeader(&quot;Authorization&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (auth == null || &quot;&quot;.equals(auth)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    writeForbiddenCode(httpServletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String userAndPass = decodeBase64(auth.substring(6));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String[] upArr = userAndPass.split(&quot;:&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (upArr.length != 2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    writeForbiddenCode(httpServletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String iptUser = upArr[0];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String iptPass = upArr[1];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 匹配服务端用户名及密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (iptUser.equals(basicAuth.getUsername()) &amp;&amp; iptPass.equals(basicAuth.getPassword())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        servletRequest.getSession().setAttribute(SwaggerBootstrapUiBasicAuthSession, basicAuth.getUsername());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        chain.doFilter(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        writeForbiddenCode(httpServletResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            chain.doFilter(request, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void destroy() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void writeForbiddenCode(HttpServletResponse httpServletResponse) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        httpServletResponse.setStatus(401);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        httpServletResponse.setHeader(&quot;WWW-Authenticate&quot;, &quot;Basic realm=\&quot;input OpenAPI userName &amp; password \&quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        httpServletResponse.getWriter().write(&quot;You do not have permission to access this resource&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-routedispatcher-路由分发器">5. RouteDispatcher 路由分发器<a href="#5-routedispatcher-路由分发器" class="hash-link" aria-label="5. RouteDispatcher 路由分发器的直接链接" title="5. RouteDispatcher 路由分发器的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.collection.CollectionUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.io.IoUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.lang.Assert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.util.StrUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.json.JSONObject;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteCache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.common.ExecutorEnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.common.RouteUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.BasicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.HeaderWrapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.SwaggerRoute;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.executor.ApacheClientExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.executor.OkHttpClientExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.executor.RouteExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletOutputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.Part;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.Logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.LoggerFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.util.StringUtils;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.ServletException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.HttpServletResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.InputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.PrintWriter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.net.URI;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.core.RouteDispatcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/10/29 20:08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RouteDispatcher {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String ROUTE_PROXY_HEADER_NAME = &quot;knife4j-gateway-request&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String ROUTE_PROXY_HEADER_BASIC_NAME = &quot;knife4j-gateway-basic-request&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String OPENAPI_GROUP_ENDPOINT = &quot;/swagger-config&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String OPENAPI_GROUP_INSTANCE_ENDPOINT = &quot;/swagger-instance&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static final String ROUTE_BASE_PATH = &quot;/&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Logger logger = LoggerFactory.getLogger(com.github.xiaoymin.knife4j.aggre.core.RouteDispatcher.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * current project contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String rootPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RouteRepository routeRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RouteExecutor routeExecutor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RouteCache&lt;String, SwaggerRoute&gt; routeCache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Set&lt;String&gt; ignoreHeaders = new HashSet&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteDispatcher(RouteRepository routeRepository, RouteCache&lt;String, SwaggerRoute&gt; routeRouteCache,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           ExecutorEnum executorEnum, String rootPath) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.routeRepository = routeRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.routeCache = routeRouteCache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.rootPath = rootPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        initExecutor(executorEnum);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ignoreHeaders.addAll(Arrays.asList(new String[]{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;host&quot;, &quot;content-length&quot;, ROUTE_PROXY_HEADER_NAME, ROUTE_PROXY_HEADER_BASIC_NAME, &quot;Request-Origion&quot;, &quot;language&quot;, &quot;knife4j-gateway-code&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void initExecutor(ExecutorEnum executorEnum) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (executorEnum == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new IllegalArgumentException(&quot;ExecutorEnum can not be empty&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (executorEnum) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case APACHE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.routeExecutor = new ApacheClientExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            case OKHTTP:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                this.routeExecutor = new OkHttpClientExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                throw new UnsupportedOperationException(&quot;UnSupported ExecutorType:&quot; + executorEnum.name());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean checkRoute(String header) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isNotBlank(header)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SwaggerRoute swaggerRoute = routeRepository.getRoute(header);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (swaggerRoute != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return StrUtil.isNotBlank(swaggerRoute.getUri());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void execute(HttpServletRequest request, HttpServletResponse response) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RouteRequestContext routeContext = new RouteRequestContext();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.buildContext(routeContext, request);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            RouteResponse routeResponse = routeExecutor.executor(routeContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeResponseStatus(routeResponse, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeResponseHeader(routeResponse, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeBody(routeResponse, response);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;has Error:{}&quot;, e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(e.getMessage(), e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // write Default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            writeDefault(request, response, e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void writeDefault(HttpServletRequest request, HttpServletResponse response, String errMsg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.setContentType(&quot;application/json&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.setCharacterEncoding(&quot;UTF-8&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PrintWriter printWriter = response.getWriter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map.put(&quot;message&quot;, errMsg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map.put(&quot;code&quot;, &quot;500&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            map.put(&quot;path&quot;, request.getRequestURI());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new JSONObject(map).write(printWriter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            printWriter.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Write Http Status Code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param routeResponse routeResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param response      response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void writeResponseStatus(RouteResponse routeResponse, HttpServletResponse response) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (routeResponse != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.setStatus(routeResponse.getStatusCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Write Response Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param routeResponse route instance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param response Servlet Response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void writeResponseHeader(RouteResponse routeResponse, HttpServletResponse response) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (routeResponse != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (CollectionUtil.isNotEmpty(routeResponse.getHeaders())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (HeaderWrapper header : routeResponse.getHeaders()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    if (!StrUtil.equalsIgnoreCase(header.getName(), &quot;Transfer-Encoding&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        response.addHeader(header.getName(), header.getValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (logger.isDebugEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.debug(&quot;Content-Type:{},Charset-Encoding:{}&quot;, routeResponse.getContentType(), routeResponse.getCharsetEncoding());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.setContentType(routeResponse.getContentType());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (routeResponse.getContentLength() &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.setContentLengthLong(routeResponse.getContentLength());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.setCharacterEncoding(routeResponse.getCharsetEncoding().displayName());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Write Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param routeResponse route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param response Servlet Response</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void writeBody(RouteResponse routeResponse, HttpServletResponse response) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (routeResponse != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (routeResponse.success()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                InputStream inputStream = routeResponse.getBody();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (inputStream != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    int read = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    byte[] bytes = new byte[1024 * 1024];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ServletOutputStream outputStream = response.getOutputStream();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    while ((read = inputStream.read(bytes)) != -1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        outputStream.write(bytes, 0, read);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    IoUtil.close(inputStream);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    IoUtil.close(outputStream);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                String text = routeResponse.text();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (StrUtil.isNotBlank(text)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    PrintWriter printWriter = response.getWriter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    printWriter.write(text);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    printWriter.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Build Context of Route</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param routeRequestContext Route Context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param request Servlet Request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected void buildContext(RouteRequestContext routeRequestContext, HttpServletRequest request) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Whether Basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String basicHeader = request.getHeader(ROUTE_PROXY_HEADER_BASIC_NAME);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isNotBlank(basicHeader)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BasicAuth basicAuth = routeRepository.getAuth(basicHeader);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (basicAuth != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // add Basic header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                routeRequestContext.addHeader(&quot;Authorization&quot;, RouteUtils.authorize(basicAuth.getUsername(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        basicAuth.getPassword()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SwaggerRoute swaggerRoute = getRoute(request.getHeader(ROUTE_PROXY_HEADER_NAME));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // String uri=&quot;http://knife4j.xiaominfo.com&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String uri = swaggerRoute.getUri();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String fromUri = request.getRequestURI();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // get project servlet.contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isNotBlank(this.rootPath) &amp;&amp; !StrUtil.equals(this.rootPath, ROUTE_BASE_PATH)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fromUri = fromUri.replaceFirst(this.rootPath, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 此处需要追加一个请求头basePath，因为父项目设置了context-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            routeRequestContext.addHeader(&quot;X-Forwarded-Prefix&quot;, this.rootPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 判断servicePath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isNotBlank(swaggerRoute.getServicePath()) &amp;&amp; !StrUtil.equals(swaggerRoute.getServicePath(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ROUTE_BASE_PATH)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (StrUtil.startWith(fromUri, swaggerRoute.getServicePath())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 实际在请求时,剔除servicePath,否则会造成404</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                fromUri = fromUri.replaceFirst(swaggerRoute.getServicePath(), &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isNotBlank(swaggerRoute.getLocation())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (swaggerRoute.getLocation().indexOf(fromUri) == -1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.debug(&quot;location:{},fromURI:{}&quot;, swaggerRoute.getLocation(), fromUri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 当前路径是请求非获取OpenAPI实例路径地址，判断debugURL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (StrUtil.isNotBlank(swaggerRoute.getDebugUrl())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 设置为调试地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    uri = swaggerRoute.getDebugUrl();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (logger.isDebugEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.debug(&quot;Debug URI:{},fromURI:{}&quot;, uri, fromUri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Assert.notEmpty(uri, &quot;Uri is Empty&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringBuilder requestUrlBuilder = new StringBuilder();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestUrlBuilder.append(uri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestUrlBuilder.append(fromUri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // String requestUrl=uri+fromUri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String requestUrl = requestUrlBuilder.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String host = URI.create(uri).getHost();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (logger.isDebugEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.debug(&quot;目标请求Url:{},请求类型:{},Host:{}&quot;, requestUrl, request.getMethod(), host);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        routeRequestContext.setOriginalUri(fromUri);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        routeRequestContext.setUrl(requestUrl);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        routeRequestContext.setMethod(request.getMethod());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Enumeration&lt;String&gt; enumeration = request.getHeaderNames();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (enumeration.hasMoreElements()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String key = enumeration.nextElement();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String value = request.getHeader(key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!ignoreHeaders.contains(key.toLowerCase())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                routeRequestContext.addHeader(key, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        routeRequestContext.addHeader(&quot;Host&quot;, host);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Enumeration&lt;String&gt; params = request.getParameterNames();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (params.hasMoreElements()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String name = params.nextElement();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String value = request.getParameter(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // logger.info(&quot;param-name:{},value:{}&quot;,name,value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            routeRequestContext.addParam(name, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 增加文件，sinc 2.0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String contentType = request.getContentType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ((!StringUtils.isEmpty(contentType)) &amp;&amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                contentType.contains(&quot;multipart/form-data&quot;)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Collection&lt;Part&gt; parts = request.getParts();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (CollectionUtil.isNotEmpty(parts)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Map&lt;String, String&gt; paramMap = routeRequestContext.getParams();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    parts.forEach(part -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        String key = part.getName();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        if (!paramMap.containsKey(key)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            routeRequestContext.addPart(part);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (ServletException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.warn(&quot;get part error,message:&quot; + e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        routeRequestContext.setRequestContent(request.getInputStream());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SwaggerRoute getRoute(String header) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 去除缓存机制，由于Eureka以及Nacos设立了心跳检测机制，服务在多节点部署时，节点ip可能存在变化,导致调试最终转发给已经下线的服务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // since 2.0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SwaggerRoute swaggerRoute = routeRepository.getRoute(header);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return swaggerRoute;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;SwaggerRoute&gt; getRoutes() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return routeRepository.getRoutes();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getRootPath() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return rootPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-routerequestcontext-路由上下文">6. RouteRequestContext 路由上下文<a href="#6-routerequestcontext-路由上下文" class="hash-link" aria-label="6. RouteRequestContext 路由上下文的直接链接" title="6. RouteRequestContext 路由上下文的直接链  接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.BasicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.HeaderWrapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.Part;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.InputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.ArrayList;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.List;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/10/29 20:34</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RouteRequestContext {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 当前请求的接口地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String originalUri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 请求接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String url;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 请求类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String method;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 请求头</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;HeaderWrapper&gt; headers = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 查询参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;String, String&gt; params = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;Part&gt; parts = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 请求内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private InputStream requestContent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 请求长度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long contentLength;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Basic验证</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private BasicAuth basicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 添加请求头</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param key 请求头</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value 值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addHeader(String key, String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.headers.add(new HeaderWrapper(key, value));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 添加params参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param name 参数名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param value 参数值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addParam(String name, String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.params.put(name, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 增加文件参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param part  文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void addPart(Part part) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.parts.add(part);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public BasicAuth getBasicAuth() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return basicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setBasicAuth(BasicAuth basicAuth) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.basicAuth = basicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getOriginalUri() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return originalUri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setOriginalUri(String originalUri) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.originalUri = originalUri;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Long getContentLength() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return contentLength;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setContentLength(Long contentLength) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.contentLength = contentLength;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Map&lt;String, String&gt; getParams() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return params;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setParams(Map&lt;String, String&gt; params) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.params = params;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getUrl() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return url;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setUrl(String url) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.url = url;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getMethod() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return method;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setMethod(String method) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.method = method;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;HeaderWrapper&gt; getHeaders() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return headers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setHeaders(List&lt;HeaderWrapper&gt; headers) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.headers = headers;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public InputStream getRequestContent() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return requestContent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setRequestContent(InputStream requestContent) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.requestContent = requestContent;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;Part&gt; getParts() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return parts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setParts(List&lt;Part&gt; parts) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.parts = parts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-routeexecutor-路由执行器">7. RouteExecutor 路由执行器<a href="#7-routeexecutor-路由执行器" class="hash-link" aria-label="7. RouteExecutor 路由执行器的直接链接" title="7. RouteExecutor 路由执行器的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation.executor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.RouteRequestContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.core.RouteExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/10/29 20:33</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public interface RouteExecutor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 执行器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param routeContext 请求上下文</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 响应对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RouteResponse executor(RouteRequestContext routeContext);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-okhttpclientexecutor-路由执行器-okhttp-实现">8. OkHttpClientExecutor 路由执行器 OkHttp 实现<a href="#8-okhttpclientexecutor-路由执行器-okhttp-实现" class="hash-link" aria-label="8. OkHttpClientExecutor 路由执行器 OkHttp 实现的直接链接" title="8. OkHttpClientExecutor 路由执行器 OkHttp 实现的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation.executor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.RouteRequestContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.core.executor.OkHttpClientExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/10/29 20:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class OkHttpClientExecutor implements RouteExecutor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteResponse executor(RouteRequestContext routeContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-apacheclientexecutor-路由执行器-apache-实现">9. ApacheClientExecutor 路由执行器 Apache 实现<a href="#9-apacheclientexecutor-路由执行器-apache-实现" class="hash-link" aria-label="9. ApacheClientExecutor 路由执行器 Apache 实现的直接链接" title="9. ApacheClientExecutor 路由执行器 Apache 实现的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation.executor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.collection.CollectionUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.executor.ApacheClientResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.executor.DefaultClientResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.ext.PoolingConnectionManager;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.HeaderWrapper;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.RouteRequestContext;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import jakarta.servlet.http.Part;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.Header;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.client.methods.CloseableHttpResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.client.methods.HttpUriRequest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.client.methods.RequestBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.conn.HttpHostConnectException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.entity.BasicHttpEntity;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.entity.ContentType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.entity.mime.HttpMultipartMode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.apache.http.entity.mime.MultipartEntityBuilder;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.Logger;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.slf4j.LoggerFactory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.nio.charset.StandardCharsets;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.core.executor.ApacheClientExecutor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 基于HttpClient组件的转发策略</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @since  2.0.8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author &lt;a href=&quot;mailto:xiaoymin@foxmail.com&quot;&gt;xiaoymin@foxmail.com&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 2020/10/29 20:35</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ApacheClientExecutor extends PoolingConnectionManager implements RouteExecutor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Logger logger = LoggerFactory.getLogger(com.github.xiaoymin.knife4j.aggre.core.executor.ApacheClientExecutor.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private HttpUriRequest buildRequest(RouteRequestContext routeContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RequestBuilder builder = RequestBuilder.create(routeContext.getMethod());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (logger.isDebugEnabled()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.debug(&quot;ApacheClient Uri:{}&quot;, routeContext.getUrl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.setUri(routeContext.getUrl());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (CollectionUtil.isNotEmpty(routeContext.getHeaders())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 构建Header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (HeaderWrapper headerWrapper : routeContext.getHeaders()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                builder.addHeader(headerWrapper.getName(), headerWrapper.getValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (CollectionUtil.isNotEmpty(routeContext.getParams())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 构建Params</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Map.Entry&lt;String, String&gt; entry : routeContext.getParams().entrySet()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                builder.addParameter(entry.getKey(), entry.getValue());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (routeContext.getRequestContent() != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 文件请求是否为空 since 2.0.9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (CollectionUtil.isNotEmpty(routeContext.getParts())) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                MultipartEntityBuilder partFileBuilder = MultipartEntityBuilder.create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                partFileBuilder.setCharset(StandardCharsets.UTF_8);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                partFileBuilder.setMode(HttpMultipartMode.BROWSER_COMPATIBLE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 从请求头获取context-type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Header header = builder.getFirstHeader(&quot;content-type&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (header != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // 赋值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    partFileBuilder.setContentType(ContentType.parse(header.getValue()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (Part part : routeContext.getParts()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        partFileBuilder.addBinaryBody(part.getName(), part.getInputStream(), ContentType.MULTIPART_FORM_DATA, part.getSubmittedFileName());// 文件流</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        logger.warn(&quot;add part file error,message:&quot; + e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                builder.setEntity(partFileBuilder.build());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 普通请求，构建请求体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                BasicHttpEntity basicHttpEntity = new BasicHttpEntity();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                basicHttpEntity.setContent(routeContext.getRequestContent());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // if the entity contentLength isn&#x27;t set, transfer-encoding will be set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // to chunked in org.apache.http.protocol.RequestContent. See gh-1042</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                builder.setEntity(basicHttpEntity);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        builder.setConfig(getRequestConfig());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return builder.build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteResponse executor(RouteRequestContext routeContext) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        RouteResponse routeResponse = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 判断当前接口是否需要执行basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            CloseableHttpResponse closeableHttpResponse = getClient().execute(buildRequest(routeContext));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            routeResponse = new ApacheClientResponse(closeableHttpResponse);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;Executor Failed,message:&quot; + e.getMessage(), e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 当前异常有可能是服务下线导致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (e instanceof HttpHostConnectException) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 服务下线，连接失败</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                routeResponse = new DefaultClientResponse(routeContext.getOriginalUri(), e.getMessage(), 504);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                routeResponse = new DefaultClientResponse(routeContext.getOriginalUri(), e.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return routeResponse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-aggregationconfig">10. AggregationConfig<a href="#10-aggregationconfig" class="hash-link" aria-label="10. AggregationConfig的直接链接" title="10. AggregationConfig的直接链接">​</a></h3>
<p><strong>注意</strong> 因为使用了knif4j集成依赖的一些实体对象，所以需要手动排除 <code>Knife4jAggregationAutoConfiguration</code> 配置类</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">package com.light.cloud.common.web.openapi.aggregation.config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import cn.hutool.core.util.StrUtil;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteCache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.RouteRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.cache.RouteInMemoryCache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.common.ExecutorEnum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.BasicAuth;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.core.pojo.SwaggerRoute;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.repository.CloudRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.repository.DiskRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.repository.EurekaRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.repository.NacosRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.spring.configuration.HttpConnectionSetting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.spring.configuration.Knife4jAggregationProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.spring.support.CloudSetting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.spring.support.DiskSetting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.spring.support.EurekaSetting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.github.xiaoymin.knife4j.aggre.spring.support.NacosSetting;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.RouteDispatcher;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.filter.RouteProxyFilter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.light.cloud.common.web.openapi.aggregation.filter.SecurityBasicAuthFilter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.beans.factory.annotation.Autowired;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.boot.web.servlet.filter.OrderedFormContentFilter;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Bean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Conditional;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.context.annotation.Configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.springframework.core.env.Environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Objects;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @see com.github.xiaoymin.knife4j.aggre.spring.configuration.Knife4jAggregationAutoConfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@EnableConfigurationProperties({Knife4jAggregationProperties.class, HttpConnectionSetting.class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DiskSetting.class, CloudSetting.class, EurekaSetting.class,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NacosSetting.class, BasicAuth.class})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@ConditionalOnProperty(name = &quot;knife4j.enable-aggregation&quot;, havingValue = &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class AggregationConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final Environment environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public AggregationConfig(Environment environment) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.environment = environment;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteCache&lt;String, SwaggerRoute&gt; routeCache() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new RouteInMemoryCache();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(initMethod = &quot;start&quot;, destroyMethod = &quot;close&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConditionalOnProperty(name = &quot;knife4j.cloud.enable&quot;, havingValue = &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public CloudRepository cloudRepository(@Autowired Knife4jAggregationProperties knife4jAggregationProperties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new CloudRepository(knife4jAggregationProperties.getCloud());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(initMethod = &quot;start&quot;, destroyMethod = &quot;close&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConditionalOnProperty(name = &quot;knife4j.eureka.enable&quot;, havingValue = &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public EurekaRepository eurekaRepository(@Autowired Knife4jAggregationProperties knife4jAggregationProperties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new EurekaRepository(knife4jAggregationProperties.getEureka());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean(initMethod = &quot;start&quot;, destroyMethod = &quot;close&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConditionalOnProperty(name = &quot;knife4j.nacos.enable&quot;, havingValue = &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public NacosRepository nacosRepository(@Autowired Knife4jAggregationProperties knife4jAggregationProperties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new NacosRepository(knife4jAggregationProperties.getNacos());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConditionalOnProperty(name = &quot;knife4j.disk.enable&quot;, havingValue = &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public DiskRepository diskRepository(@Autowired Knife4jAggregationProperties knife4jAggregationProperties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new DiskRepository(knife4jAggregationProperties.getDisk());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RouteDispatcher routeDispatcher(@Autowired RouteRepository routeRepository,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                           @Autowired RouteCache&lt;String, SwaggerRoute&gt; routeCache) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取当前项目的contextPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String contextPath = Objects.toString(environment.getProperty(&quot;server.servlet.context-path&quot;), &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isBlank(contextPath)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            contextPath = &quot;/&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isNotBlank(contextPath) &amp;&amp; !StrUtil.equals(contextPath, RouteDispatcher.ROUTE_BASE_PATH)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 判断是否/开头</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!StrUtil.startWith(contextPath, RouteDispatcher.ROUTE_BASE_PATH)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                contextPath = RouteDispatcher.ROUTE_BASE_PATH + contextPath;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new RouteDispatcher(routeRepository, routeCache, ExecutorEnum.APACHE, contextPath);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 注意过滤器的顺序，如果此过滤器在鉴权过滤器后方，会导致转发失败</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param routeDispatcher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FilterRegistrationBean routeProxyFilter(@Autowired RouteDispatcher routeDispatcher) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setFilter(new RouteProxyFilter(routeDispatcher));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setOrder(OrderedFormContentFilter.DEFAULT_ORDER + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setEnabled(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return filterRegistrationBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @ConditionalOnProperty(name = &quot;knife4j.basic-auth.enable&quot;, havingValue = &quot;true&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FilterRegistrationBean routeBasicFilter(@Autowired Knife4jAggregationProperties knife4jAggregationProperties) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setFilter(new SecurityBasicAuthFilter(knife4jAggregationProperties.getBasicAuth()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setOrder(10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.setEnabled(true);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        filterRegistrationBean.addUrlPatterns(&quot;/*&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return filterRegistrationBean;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="前端改造">前端改造<a href="#前端改造" class="hash-link" aria-label="前端改造的直接链接" title="前端改造的直接链接">​</a></h2>
<ul>
<li>knife4j-openapi3-spring-boot-starter 4.5.0</li>
<li>knife4j-openapi3-ui 4.4.0</li>
<li>knife4j-openapi3-ui 4.5.0</li>
</ul>
<p>因为 knife4j 进行聚合后进行接口调试，需要根据 <code>knife4j-gateway-request</code> Header头进行路由，改造的主要目的是将这个参数添加到请求中</p>
<p>有些版本，如: <code>knife4j-openapi3-ui 4.1.0</code> 此属性拼写错误 <code>knfie4j-gateway-request</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1准备工作">1.准备工作<a href="#1准备工作" class="hash-link" aria-label="1.准备工作的直接链接" title="1.准备工作的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-下载前端源码">1. 下载前端源码<a href="#1-下载前端源码" class="hash-link" aria-label="1. 下载前端源码的直接链接" title="1. 下载前端源码的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone -b v4.5.0 https://github.com/xiaoymin/knife4j</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-修改前端代理-dworkspacegithubknife4jknife4j-vuevueconfigjs">2. 修改前端代理 <code>D:\Workspace\Github\knife4j\knife4j-vue\vue.config.js</code><a href="#2-修改前端代理-dworkspacegithubknife4jknife4j-vuevueconfigjs" class="hash-link" aria-label="2-修改前端代理-dworkspacegithubknife4jknife4j-vuevueconfigjs的直接链接" title="2-修改前端代理-dworkspacegithubknife4jknife4j-vuevueconfigjs的直接链接">​</a></h4>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token literal-property property" style="color:#36acaa">proxy</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string-property property" style="color:#36acaa">&quot;/&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//target: &#x27;http://localhost:8990/&#x27;,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">target</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:31112/system/&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* target: &#x27;http://knife4j.xiaominfo.com/&#x27;, */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">ws</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">changeOrigin</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-前端源码改造测试">2. 前端源码改造测试<a href="#2-前端源码改造测试" class="hash-link" aria-label="2. 前端源码改造测试的直接链接" title="2. 前端源码改造测试的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-修改接口调用-dworkspacegithubknife4jknife4j-vuesrccoreknife4jasyncjs">1. 修改接口调用 <code>D:\Workspace\Github\knife4j\knife4j-vue\src\core\Knife4jAsync.js</code><a href="#1-修改接口调用-dworkspacegithubknife4jknife4j-vuesrccoreknife4jasyncjs" class="hash-link" aria-label="1-修改接口调用-dworkspacegithubknife4jknife4j-vuesrccoreknife4jasyncjs的直接链接" title="1-修改接口调用-dworkspacegithubknife4jknife4j-vuesrccoreknife4jasyncjs的直接链接">​</a></h4>
<p>将后台返回的 header 值设置到前端缓存的分组实例对象中，以便调用时读取</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic"> * 解析springdoc-OpenAPI</span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic"> * </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@param</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">{</span><span class="token doc-comment comment class-name operator" style="color:#393A34;font-style:italic">*</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">}</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment parameter" style="color:#999988;font-style:italic">data</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"></span><br></span><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">SwaggerBootstrapUi</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">analysisSpringDocOpenApiGroupSuccess</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> that </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">typeof</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> groupData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">t </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;string&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// groupData = JSON.parse(data)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groupData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">json5parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groupData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;响应分组json数据&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> serviceOptions </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> allGroupIds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> groupUrls </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;urls&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> newGroupData </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">arrNotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupUrls</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    groupUrls</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">gu</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> newGroup </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;default&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;url&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">header</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;header&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;url&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">swaggerVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.0.3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">tagSort</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tagsSorter&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;order&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">operationSort</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;operationsSorter&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;order&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">servicePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;servicePath&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">contextPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">gu</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;contextPath&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      newGroupData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">newGroup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// https://gitee.com/xiaoym/knife4j/issues/I5L440#note_12238431</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 如果开发者没有创建bean对象，urls对象为空，取而代之的是直接返回url</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    newGroupData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;name&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;default&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;url&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">location</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;url&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">swaggerVersion</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.0.3&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">tagSort</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;tagsSorter&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;order&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">operationSort</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;operationsSorter&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;order&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">servicePath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;servicePath&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">contextPath</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">groupData</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;contextPath&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  newGroupData</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">group</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> g </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SwaggerBootstrapUiInstance</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex escape" style="color:#36acaa">\/</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;-&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">swaggerVersion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;groupInfo&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                                </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;desktop&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">desktop</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                           </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;desktopCode&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">desktopCode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/system&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                       </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">header</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;header&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">desktop</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">desktop</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">desktopCode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">desktopCode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//排序规则2022.12.6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tagSort</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">tagSort</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">operationSort</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">operationSort</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//增加basePath，主要是网关聚合的场景</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">servicePath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;servicePath&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">contextPath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;contextPath&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// g.url=&#x27;/test/json&#x27;;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> newUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 此处需要判断basePath路径的情况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      newUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      newUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">location</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">extUrl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> newUrl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">validateExtUrl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">validateExtUrl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">extUrl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 判断当前分组url是否存在basePath</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">basePath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">basePath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">basePath</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">baseUrl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">basePath</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 赋值查找缓存的id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cacheApis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> cainstance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cacheApis</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">ca</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ca</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">groupId</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cainstance </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ca</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">/*  $.each(that.cacheApis, function (x, ca) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         if (ca.id == g.groupId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">           cainstance = ca</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">       }) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">cainstance </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">firstLoad</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 判断旧版本是否包含updatesApi属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">cainstance</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hasOwnProperty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;updateApis&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cainstance</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;updateApis&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cacheInstance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cainstance</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// g.groupApis=cainstance.cacheApis;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cacheInstance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SwaggerBootstrapUiCacheApis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">groupId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cacheInstance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">SwaggerBootstrapUiCacheApis</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">groupId</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 双向绑定</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    serviceOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">label</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 增加所有分组id，为afterScript特性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allGroupIds</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">instances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">g</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 赋值分组id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">arrNotEmpty</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">instances</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    that</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">instances</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">inst</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      inst</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">allGroupIds</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> allGroupIds</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化所有</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">serviceOptions</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> serviceOptions</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;globals/setServiceOptions&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// that.$Vue.serviceOptions = serviceOptions;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">serviceOptions</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// that.$Vue.defaultServiceOption = serviceOptions[0].value;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">defaultServiceOption</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> serviceOptions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">store</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">dispatch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;globals/setDefaultService&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> serviceOptions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-dworkspacegithubknife4jknife4j-vuesrcviewsapidebugvue">2. <code>D:\Workspace\Github\knife4j\knife4j-vue\src\views\api\Debug.vue</code><a href="#2-dworkspacegithubknife4jknife4j-vuesrcviewsapidebugvue" class="hash-link" aria-label="2-dworkspacegithubknife4jknife4j-vuesrcviewsapidebugvue的直接链接" title="2-dworkspacegithubknife4jknife4j-vuesrcviewsapidebugvue的直接链接">​</a></h4>
<p>将分组实例对象中的header参数设置到请求的 header 中，实现接口的调用</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">debugSendRawRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// 发送raw类型的请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">// console(&quot;发送raw接口&quot;);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> validateForm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">validateRawForm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">validateForm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">validate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugLoading</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 发送状态置为已发送请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugSend</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// raw类型的 请求需要判断是何种类型</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> headers </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">debugHeaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugUrl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> methodType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugMethodType</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">toLowerCase</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> data </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">rawText</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> formParams </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">debugRawFormParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 得到key-value的参数值,对请求类型进行判断，判断是否为path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugPathFlag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> realFormParams </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 是path类型的接口,需要对地址、参数进行replace处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugPathParams</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">forEach</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">pathKey</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> replaceRege </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> pathKey </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;}&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// var value = formParams[pathKey];</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token maybe-class-name">KUtils</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">getValue</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">formParams</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pathKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">replaceRege</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> formParams</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 判断key在debugPath中是否存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugPathParams</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">indexOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// 不存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              realFormParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> formParams</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 重新赋值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          formParams </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> realFormParams</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> checkResult </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">checkUrlParams</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">checkResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">result</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          url </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> checkResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          formParams </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">assign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">formParams</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> checkResult</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> baseUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 是否启用Host</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">enableHost</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          baseUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">enableHostText</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> requestConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">baseURL</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> baseUrl</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">debugCheckUrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">url</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> methodType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">headers</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">params</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> formParams</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">data</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Cookie标志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">withCredentials</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">debugSendHasCookie</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">timeout</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 需要判断是否是下载请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// https://gitee.com/xiaoym/knife4j/issues/I1U4LA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// 判断当前接口规范是OAS3还是Swagger2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">oas2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// OAS2规范制定了produces的定义,需要判断请求头</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 需要判断是否是下载请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">debugStreamFlag</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// 流请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            requestConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">requestConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">responseType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blob&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// 统一追加一个blob类型的响应,在OpenAPI3.0的规范中,没有关于produces的设定，因此无法判断当前请求是否是流的请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// https://gitee.com/xiaoym/knife4j/issues/I374SP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requestConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain">requestConfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">responseType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;blob&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// console(headers);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// console(this.rawText);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;headers&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> headers</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                              </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;formParams&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> formParams</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                        </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;requestConfig&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> requestConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        requestConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> requestConfig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">url</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;/system&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Add Line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> startTime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">DebugAxios</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">request</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">requestConfig</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">then</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">res</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugLoading</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">handleDebugSuccess</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">startTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> res</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">err</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">debugLoading</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">handleDebugError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">startTime</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$message</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">validateForm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>改了上面的地方之后，应该就可以成功代理了</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-后端静态文件改造思路">3. 后端静态文件改造思路<a href="#3-后端静态文件改造思路" class="hash-link" aria-label="3. 后端静态文件改造思路的直接链接" title="3. 后端静态文件改造思路的直接链接">​</a></h3>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 搜索下面方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">analysisSpringDocOpenApiGroupSuccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 找到对应的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.5de26223.js   # knife4j-openapi2-ui 4.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.c31badf5.js   # knife4j-openapi3-ui 4.5.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app.b0c0d7df.js   # knife4j-openapi3-ui 4.4.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 源码中的显眼单词定位 如： that.log(&#x27;响应分组json数据&#x27;); 中的 `响应分组json数据`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 分别添加获取设置 header 的语句</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url:re.a.getValue(e,&quot;url&quot;,&quot;&quot;,!0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url:re.a.getValue(e,&quot;url&quot;,&quot;&quot;,!0),header:re.a.getValue(e,&quot;header&quot;,&quot;&quot;,!0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url:re.a.getValue(t,&quot;url&quot;,&quot;&quot;,!0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">url:re.a.getValue(t,&quot;url&quot;,&quot;&quot;,!0),header:re.a.getValue(t,&quot;header&quot;,&quot;&quot;,!0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t.servicePath=re.a.getValue(e,&quot;servicePath&quot;,null,!0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t.servicePath=re.a.getValue(e,&quot;servicePath&quot;,null,!0),t.header=re.a.getValue(e,&quot;header&quot;,null,!0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="问题">问题<a href="#问题" class="hash-link" aria-label="问题的直接链接" title="问题的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-接口的调用最好使用-knife4j-gateway-code-去除当前项目的context-path-否则会出现异常">1. 接口的调用最好使用 <code>knife4j-gateway-code</code> 去除当前项目的context-path 否则会出现异常<a href="#1-接口的调用最好使用-knife4j-gateway-code-去除当前项目的context-path-否则会出现异常" class="hash-link" aria-label="1-接口的调用最好使用-knife4j-gateway-code-去除当前项目的context-path-否则会出现异常的直接链接" title="1-接口的调用最好使用-knife4j-gateway-code-去除当前项目的context-path-否则会出 现异常的直接链接">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-解决问题一如果项目本身需要使用聚合接口需要在所有接口前再添加一次-context-path">2. 【解决问题一】如果项目本身需要使用聚合接口，需要在所有接口前再添加一次 context-path<a href="#2-解决问题一如果项目本身需要使用聚合接口需要在所有接口前再添加一次-context-path" class="hash-link" aria-label="2. 【解决问题一】如果项目本身需要使用聚合接口，需要在所有接口前再添加一次 context-path的直接链接" title="2. 【解决问题一】如果项目本身需要使用聚合接口，需要在所有接口前再添加一次 context-path的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public OpenAPI openAPI() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 添加 components 后可以重复引用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Components components = new Components()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addParameters(PlatformConstant.HEADER_CLIENT_ID, clientId())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addParameters(PlatformConstant.HEADER_AUTHORIZATION, authorization());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return new OpenAPI()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .info(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    new Info().title(serviceName)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .description(openapiProperties.getDescription())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .version(openapiProperties.getVersion())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .license(new License()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    .name(openapiProperties.getLicenseName())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    .url(openapiProperties.getLicenseUrl()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .contact(new Contact()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    .name(openapiProperties.getContactName())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    .email(openapiProperties.getContactEmail())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                    .url(openapiProperties.getContactUrl()))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            .termsOfService(openapiProperties.getTermsOfServiceUrl())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            //外部文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .externalDocs(new ExternalDocumentation()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    .description(&quot;官方文档&quot;).url(&quot;https://springdoc.org&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // webhooks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .webhooks(new HashMap&lt;&gt;())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 全局统一安全认证配置 一个key对应一个schema（安全配置），</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 对接口添加 @SecurityRequirement 可使用不同的安全规则</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .schemaRequirement(PlatformConstant.HEADER_AUTHORIZATION, apikeySecuritySchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .schemaRequirement(PlatformConstant.HEADER_CLIENT_ID, apikeySecuritySchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//                .schemaRequirement(HttpHeaders.AUTHORIZATION, oauth2SecuritySchema())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 全局安全校验项，也可以在对应的controller上加注解SecurityRequirement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .addSecurityItem(new SecurityRequirement().addList(PlatformConstant.HEADER_AUTHORIZATION))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 组件定义</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .components(components);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * 添加全局的请求头参数，并为所有接口添加context-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public OpenApiCustomizer customerGlobalOpenApiCustomizer() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return openApi -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Paths paths = openApi.getPaths();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String[] pathSet = paths.keySet().toArray(new String[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (String path : pathSet) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PathItem pathItem = paths.get(path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 添加全局的请求头参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pathItem.readOperations().forEach(operation -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                // 引用在 OpenAPI 中定义的 components</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                operation.addParametersItem(new HeaderParameter().$ref(&quot;#/components/parameters/&quot; + PlatformConstant.HEADER_CLIENT_ID))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .addParametersItem(new HeaderParameter().$ref(&quot;#/components/parameters/&quot; + PlatformConstant.HEADER_AUTHORIZATION));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 为接口添加 context-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            paths.put(contextPath + path, pathItem);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            paths.remove(path);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note: 这种方式会 导致直接调用本地接口（非聚合方式）报错</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-对于项目默认需要token校验的可以使用-components-实现参数的复用">3. 对于项目默认需要Token校验的，可以使用 components 实现参数的复用<a href="#3-对于项目默认需要token校验的可以使用-components-实现参数的复用" class="hash-link" aria-label="3. 对于项目默认需要Token校验的，可以使用 components 实现参数的复用的直接链接" title="3. 对于项目默认需要Token校验的，可以使用 components 实现参数的复用的直接链接">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-一个自定义动态注册-requestmapping-的-bug">4. 一个自定义动态注册 RequestMapping 的 Bug<a href="#4-一个自定义动态注册-requestmapping-的-bug" class="hash-link" aria-label="4. 一个自定义动态注册 RequestMapping 的 Bug的直接链接" title="4. 一个自定义动态注册 RequestMapping 的 Bug的直接链接">​</a></h3>
<ul>
<li><a href="https://blog.csdn.net/mole_exp/article/details/123992395" target="_blank" rel="noopener noreferrer">Java内存马-SpringMVC篇</a></li>
<li><a href="https://blog.csdn.net/maple_son/article/details/122572869" target="_blank" rel="noopener noreferrer">springboot 2.6.x 自定义注册 RequestMapping</a></li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java.lang.IllegalArgumentException:  Expected lookupPath in request attribute &quot;org.springframework.web.util.UrlPathHelper.PATH&quot;.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪  贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">spring</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Spring MVC 处理映射匹配的默认策略已从AntPathMatcher更改为PathPatternParser。</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 此处配置为使用AntPathMatcher兼容 swagger 相关的路径匹配</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mvc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path-match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">matching-strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ANT_PATH_MATCHER</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-boot/23-Spring-Boot-Integrate-SpringDoc-Aggregation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/docs/zh-cn/spring-boot/Enhance-Request-And-Response/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Enhance-Request-And-Response</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/docs/zh-cn/spring-boot/Spring-Boot-Hotswap-Aop/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Spring-Boot-Hotswap-Aop</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简单集成" class="table-of-contents__link toc-highlight">简单集成</a><ul><li><a href="#1-添加依赖项" class="table-of-contents__link toc-highlight">1. 添加依赖项</a></li><li><a href="#2-添加配置" class="table-of-contents__link toc-highlight">2. 添加配置</a></li><li><a href="#3-openapiproperties-属性定义" class="table-of-contents__link toc-highlight">3. OpenapiProperties 属性定义</a></li><li><a href="#4-routedefinition-路由定义" class="table-of-contents__link toc-highlight">4. RouteDefinition 路由定义</a></li><li><a href="#5-openapiconfig-配置类" class="table-of-contents__link toc-highlight">5. OpenapiConfig 配置类</a></li><li><a href="#6-springdocconfig-配置类" class="table-of-contents__link toc-highlight">6. SpringDocConfig 配置类</a></li><li><a href="#7openapiadditionalbeanregistry-动态注册类" class="table-of-contents__link toc-highlight">7.OpenapiAdditionalBeanRegistry 动态注册类</a></li></ul></li><li><a href="#聚合api文档" class="table-of-contents__link toc-highlight">聚合Api文档</a><ul><li><a href="#1-添加依赖项-1" class="table-of-contents__link toc-highlight">1. 添加依赖项</a></li><li><a href="#2-添加配置-1" class="table-of-contents__link toc-highlight">2. 添加配置</a></li><li><a href="#3-routeproxyfilter-路由过滤器" class="table-of-contents__link toc-highlight">3. RouteProxyFilter 路由过滤器</a></li><li><a href="#4-securitybasicauthfilter-认证过滤器" class="table-of-contents__link toc-highlight">4. SecurityBasicAuthFilter 认证过滤器</a></li><li><a href="#5-routedispatcher-路由分发  器" class="table-of-contents__link toc-highlight">5. RouteDispatcher 路由分发器</a></li><li><a href="#6-routerequestcontext-路由上下文" class="table-of-contents__link toc-highlight">6. RouteRequestContext 路由上下文</a></li><li><a href="#7-routeexecutor-路由执行器" class="table-of-contents__link toc-highlight">7. RouteExecutor 路由执行器</a></li><li><a href="#8-okhttpclientexecutor-路由执行器-okhttp-实现" class="table-of-contents__link toc-highlight">8. OkHttpClientExecutor 路由执行器 OkHttp 实现</a></li><li><a href="#9-apacheclientexecutor-路由执行器-apache-实现" class="table-of-contents__link toc-highlight">9. ApacheClientExecutor 路由执行器 Apache 实现</a></li><li><a href="#10-aggregationconfig" class="table-of-contents__link toc-highlight">10. AggregationConfig</a></li></ul></li><li><a href="#前端改造" class="table-of-contents__link toc-highlight">前端改造</a><ul><li><a href="#1准备工作" class="table-of-contents__link toc-highlight">1.准备工作</a></li><li><a href="#2-前端源码改造测试" class="table-of-contents__link toc-highlight">2. 前端源码改造测试</a></li><li><a href="#3-后端静态文件改造思路" class="table-of-contents__link toc-highlight">3. 后端静态文件改造思路</a></li></ul></li><li><a href="#问题" class="table-of-contents__link toc-highlight">问题</a><ul><li><a href="#1-接口的调用最好使用-knife4j-gateway-code-去除当前项目的context-path-否则会出现异常" class="table-of-contents__link toc-highlight">1. 接口的调用最好使用 <code>knife4j-gateway-code</code> 去除当前项目的context-path 否则会出现异常</a></li><li><a href="#2-解决问题一如果项目本身需要使用聚合接口需要在所有接口前再添加一次-context-path" class="table-of-contents__link toc-highlight">2. 【解决问题一】如果项目本身需要使用聚合接口，需要在所有接口前再添加一次 context-path</a></li><li><a href="#3-对于项目默认需要token校验的  可以使用-components-实现参数的复用" class="table-of-contents__link toc-highlight">3. 对于项目默认需要Token校验的，可以使用 components 实现参数的复用</a></li><li><a href="#4-一个自定义动态注册-requestmapping-的-bug" class="table-of-contents__link toc-highlight">4. 一个自定义动态注册 RequestMapping 的 Bug</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>