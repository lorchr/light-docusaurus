<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-zh-cn/spring-boot/ApiKey-design" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">ApiKey-design | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/docs/zh-cn/spring-boot/ApiKey-design/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="ApiKey-design | Light Docusaurus"><meta data-rh="true" name="description" content="- 三方接口调用设计方案"><meta data-rh="true" property="og:description" content="- 三方接口调用设计方案"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/docs/zh-cn/spring-boot/ApiKey-design/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/spring-boot/ApiKey-design/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/docs/zh-cn/spring-boot/ApiKey-design/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.10a62360.css">
<script src="/assets/js/runtime~main.849e35c8.js" defer="defer"></script>
<script src="/assets/js/main.4af205e6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a class="navbar__item navbar__link" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/zh-cn/spring-boot/ApiKey-design/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/guide/">Guide</a><button aria-label="展开侧边栏分类 &#x27;Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/develop-environment/">Develop Environment</a><button aria-label="展开侧边栏分类 &#x27;Develop Environment&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/java-jvm/">Java (JVM)</a><button aria-label="展开侧边栏分类 &#x27;Java (JVM)&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/spring-boot/">Spring Boot</a><button aria-label="折叠侧边栏分类 &#x27;Spring Boot&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Api-Specification/">Api-Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/SPI/">SPI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Common-Async-Data-Handle/">Common-Async-Data-Handle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Multi-Thread-Transaction/">Multi-Thread-Transaction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Obfuscate-Spring-Boot-Application-With-Classfinal/">Obfuscate-Spring-Boot-Application-With-Classfinal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Obfuscate-Spring-Boot-Application-With-Proguard/">Obfuscate-Spring-Boot-Application-With-Proguard</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Endpoints/">Spring-Boot-Endpoints</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Ip-Address-Parse/">Spring-Boot-Ip-Address-Parse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Ip-Ragion-Parse/">Spring-Boot-Ip-Ragion-Parse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Json-Diff/">Spring-Boot-Json-Diff</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Native-Memory-Leak/">Spring-Boot-Native-Memory-Leak</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Unit-Test/">Spring-Boot-Unit-Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Core/">Spring-Core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Rate-Limit/">Spring-Rate-Limit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Statemachine/">Spring-Statemachine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/SpringEvent/">SpringEvent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Dynamic-Datasource/">Spring-Boot-Dynamic-Datasource</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-QrCode-Zxing/">Spring-Boot-QrCode-Zxing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-With-Enum-Type/">Spring-Boot-With-Enum-Type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Actuator/">Spring-Boot-Actuator</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Parameter-Validate/">Spring-Boot-Parameter-Validate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Sql-Injection/">Sql-Injection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Enhance-Request-And-Response/">Enhance-Request-And-Response</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Integrate-SpringDoc-Aggregation/">Spring-Boot-Integrate-SpringDoc-Aggregation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Hotswap-Aop/">Spring-Boot-Hotswap-Aop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Customlize-Request-Trace/">Customlize-Request-Trace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Integrate-Alipay/">Spring-Boot-Integrate-Alipay</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/zh-cn/spring-boot/ApiKey-design/">ApiKey-design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-RSA-AES-Encryption/">Spring-Boot-RSA-AES-Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Slim-Spring-Boot-FatJar/">Slim-Spring-Boot-FatJar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-boot-Dynamic-Load-Dependency/">Spring-boot-Dynamic-Load-Dependency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Start-Sequence/">Spring-Boot-Start-Sequence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Transaction-Hook/">Spring-Boot-Transaction-Hook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Naming-Validate/">Spring-Boot-Naming-Validate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Launch-Speed-Up/">Spring-Boot-Launch-Speed-Up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Insert-Annotation-Like-Lombok/">Insert-Annotation-Like-Lombok</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Encryption/">Spring-Boot-Encryption</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Dynamic-Load-Jar/">Spring-Boot-Dynamic-Load-Jar</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Auto-Switch-between-Schedule-And-XXL-Job/">Auto-Switch-between-Schedule-And-XXL-Job</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Plugable-Develop/">Spring-Boot-Plugable-Develop</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/How-To-Write-Controller/">How-To-Write-Controller</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Dynamic-DataSource/">Spring-Boot-Dynamic-DataSource</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-Dynamic-Load-Plugin/">Spring-Boot-Dynamic-Load-Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/zh-cn/spring-boot/Spring-Boot-No-Stop-Update/">Spring-Boot-No-Stop-Update</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/zh-cn/spring-boot/file/File-Upload-Split-Continue-on-Break/">file</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/category/file/">File</a><button aria-label="展开侧边栏分类 &#x27;File&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-cloud/">Spring Cloud</a><button aria-label="展开侧边栏分类 &#x27;Spring Cloud&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-security/">Spring Security</a><button aria-label="展开侧边栏分类 &#x27;Spring Security&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/spring-authorization-server/">Spring Authorization Server</a><button aria-label="展开侧边栏分类 &#x27;Spring Authorization Server&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/active-directory/">Active Directory</a><button aria-label="展开侧边栏分类 &#x27;Active Directory&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/database/">Database</a><button aria-label="展开侧边栏分类 &#x27;Database&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/git/">Git</a><button aria-label="展开侧边栏分类 &#x27;Git&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/linux/">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/docker/">Docker</a><button aria-label="展开侧边栏分类 &#x27;Docker&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/kubernetes/">Kubernetes</a><button aria-label="展开侧边栏分类 &#x27;Kubernetes&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/test/">Test</a><button aria-label="展开侧边栏分类 &#x27;Test&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/others/">Others</a><button aria-label="展开侧边栏分类 &#x27;Others&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/awesome-open-source/">Github Speed UP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/zh-cn/windows/">Windows</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/spring-boot/"><span itemprop="name">Spring Boot</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ApiKey-design</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>ApiKey-design</h1></header><ul>
<li><a href="https://juejin.cn/post/7268667384440504360" target="_blank" rel="noopener noreferrer">三方接口调用设计方案</a></li>
<li><a href="https://mp.weixin.qq.com/s/aY7xi1uS9qWr0EuR7HNzsQ" target="_blank" rel="noopener noreferrer">三方接口就要这样设计，非常优雅！</a></li>
<li><a href="https://mp.weixin.qq.com/s/-6btpBrgOz-3iqP-g_l_0A" target="_blank" rel="noopener noreferrer">公司来了个大神，三方接口调用方案设计的真优雅~~</a></li>
</ul>
<p>在为第三方系统提供接口的时候，肯定要考虑接口数据的安全问题，比如数据是否被篡改，数据是否已经过时，数据是否可以重复提交等问题。</p>
<p>在设计三方接口调用的方案时，需要考虑到安全性和可用性。以下是一种设计方案的概述，其中包括使用API密钥（<code>Access Key</code>/<code>Secret Key</code>）进行身份验证和设置回调地址。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="设计方案概述">设计方案概述<a href="#设计方案概述" class="hash-link" aria-label="设计方案概述的直接链接" title="设计方案概述的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-api密钥生成-为每个三方应用生成唯一的api密钥对aksk其 中ak用于标识应用sk用于进行签名和加密">1. API密钥生成： 为每个三方应用生成唯一的API密钥对（AK/SK），其中AK用于标识应用，SK用于进行签名和加密。<a href="#1-api密钥生成-为每个三方应用生成唯一的api密钥对aksk其中ak用于标识应用sk用于进行签名和加密" class="hash-link" aria-label="1. API密钥生成： 为每个三方应用生成唯一的API密钥对（AK/SK），其中AK用于标识应用，SK用于进行签名和加密。的直接链接" title="1. API密钥生成： 为每个三方应用生成唯一的API密钥对（AK/SK），其中AK用于标识应用，SK用于进行签名和加密。的直接链接">​</a></h3>
<blockquote>
<p>AK：<code>Access Key Id</code>，用于标示用户。
SK：<code>Secret Access Key</code>，是用户用于加密认证字符串和用来验证认证字符串的密钥，其中SK必须保密。
通过使用 <code>Access Key Id</code> / <code>Secret Access Key</code> 加密的方法来验证某个请求的发送者身份。</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-接口鉴权-在进行接口调用时客户端需要使用ak和请求参数生成签名并将其放入请求头或参数中以进行身份验证">2. 接口鉴权： 在进行接口调用时，客户端需要使用AK和请求参数生成签名，并将其放入请求头或参数中以进行身份验证。<a href="#2-接口鉴权-在进行接口调用时客户端需要使用ak和请求参数生成签名并将其放入请求头或参数中以进行身份验证" class="hash-link" aria-label="2. 接口鉴权： 在进行接口调用时，客户端需要使用AK和请求参数生成签名，并将其放入请求头或参数中以进行身份验证。的直接链接" title="2. 接口鉴权： 在进行接口调用时，客户端需要使用AK和请求参数生成签名，并将其放入请求头或参数中以进行身份验证。的直接链接">​</a></h3>
<blockquote>
<p>淘宝签名和验签： <a href="https://www.yuque.com/u12226311/ttgrez/mxy16ld5h2tw7xhx" target="_blank" rel="noopener noreferrer">淘宝SDK签名算法 (yuque.com)</a></p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-回调地址设置-三方应用提供回调地址用于接收异步通知和回调结果">3. 回调地址设置： 三方应用提供回调地址，用于接收异步通知和回调结果。<a href="#3-回调地址设置-三方应用提供回调地址用于接收异步通知和回调结果" class="hash-link" aria-label="3. 回调地址设置： 三方应用提供回调地址，用于接收异步通知和回调结果。的直接链接" title="3. 回调地址设置： 三方应用提供回调地址，用于接收异步通知和回调结果。的直接链接">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-接口api设计-设计接口的urlhttp方法请求参数响应格式等细节">4. 接口API设计： 设计接口的URL、HTTP方法、请求参数、响应格式等细节。<a href="#4-接口api设计-设计接口的urlhttp方法请求参数响应格式等细节" class="hash-link" aria-label="4. 接口API设计： 设计接口的URL、HTTP方法、请求参数、响应格式等细节。的直接链接" title="4. 接口API设计： 设计接口的URL、HTTP方法、请求参数、响应格式等细节。的直接链接">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="权限划分">权限划分<a href="#权限划分" class="hash-link" aria-label="权限划分的直接链接" title="权限划分的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appid应用的唯一标识">appID：应用的唯一标识<a href="#appid应用的唯一标识" class="hash-link" aria-label="appID：应用的唯一标识的直接链接" title="appID：应用的唯一标识的直接链接">​</a></h3>
<p>用来标识你的开发者账号的，即：用户id，可以在数据库添加索引，方便快速查找，同一个 appId 可以对应多个 <code>appKey+appSecret</code>，达 到权限的</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appkey公匙相当于账号">appKey：公匙（相当于账号）<a href="#appkey公匙相当于账号" class="hash-link" aria-label="appKey：公匙（相当于账号）的直接链接" title="appKey：公匙（相当于账号）的直接链接">​</a></h3>
<p>公开的，调用服务所需要的密钥。是用户的身份认证标识，用于调用平台可用服务.，可以简单理解成是账号。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="appsecret私匙相当于密码">appSecret：私匙（相当于密码）<a href="#appsecret私匙相当于密码" class="hash-link" aria-label="appSecret：私匙（相当于密码）的直接链接" title="appSecret：私匙（相当于密码）的直接链接">​</a></h3>
<p>签名的密钥，是跟appKey配套使用的，可以简单理解成是密码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="token令牌过期失效">token：令牌（过期失效）<a href="#token令牌过期失效" class="hash-link" aria-label="token：令牌（过期失效）的直接链接" title="token：令牌（过期失效）的直接链接">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用方法">使用方法<a href="#使用方法" class="hash-link" aria-label="使用方法的直接链接" title="使用方法的直接链接">​</a></h3>
<ol>
<li>向第三方服务器请求授权时，带上<code>AppKey</code>和<code>AppSecret</code>（需存在服务器端）</li>
<li>第三方服务器验证<code>appKey</code>和<code>appSecret</code>在数据库、缓存中有没有记录</li>
<li>如果有，生成一串唯一的字符串（token令牌），返回给服务器，服务器再返回给客户端</li>
<li>后续客户端每次请求都需要带上token令牌</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么-要有appkey--appsecret-这种成对出现的机制呢">为什么 要有appKey + appSecret 这种成对出现的机制呢?<a href="#为什么-要有appkey--appsecret-这种成对出现的机制呢" class="hash-link" aria-label="为什么 要有appKey + appSecret 这种成对出现的机制呢?的直接链接" title="为什么 要有appKey + appSecret 这种成对出现的机制呢?的直接链接">​</a></h3>
<p>因为要加密, 通常用在首次验证(类似登录场景)，用 <code>appKey</code>(标记要申请的权限有哪些) + <code>appSecret</code>(密码, 表示你真的拥有这个权限)来申请一个<code>token</code>，就是我们经常用到的 <code>accessToken</code>（通常拥有失效时间），后续的每次请求都需要提供<code>accessToken</code> 表明验证权限通过。</p>
<blockquote>
<p>现在有了统一的<code>appId</code>，此时如果针对同一个业务要划分不同的权限，比如同一功能，某些场景需要只读权限，某些场景需要读写权限。这样提供一个<code>appId</code>和对应的秘钥<code>appSecret</code>就没办法满足需求。此时就需要根据权限进行账号分配，通常使用<code>appKey</code>和<code>appSecret</code>。</p>
</blockquote>
<p>由于 <code>appKey</code> 和 <code>appSecret</code> 是成对出现的账号, 同一个 <code>appId</code> 可以对应多个 <code>appKey</code> + <code>appSecret</code>，这样平台就为不同的<code>appKey</code> + <code>appSecret</code>对分配不一样的权限。</p>
<blockquote>
<p>可以生成两对<code>appKey</code>和<code>appSecret</code>。一个用于删除，一个用于读写，达到权限的细粒度划分。如 : <code>appKey1</code> + <code>appSecect1</code> 只有删除权限 但是 <code>appKey2</code> + <code>appSecret2</code> 有读写权限… 这样你就可以把对应的权限 放给不同的开发者。其中权限的配置都是直接跟<code>appKey</code> 做关联的，<code>appKey</code> 也需要添加数据库索引, 方便快速查找</p>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="简化的场景">简化的场景:<a href="#简化的场景" class="hash-link" aria-label="简化的场景:的直接链接" title="简化的场景:的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第一种场景-通常用于开放性接口像地图api会省去app_id和app_key此时相当于三者相等合而为一-appid--appkey--appsecret这种模式下带上app_id的目的仅仅是统计某一个用户调用接口的次数而已了">第一种场景： 通常用于开放性接口，像地图api，会省去<code>app_id</code>和<code>app_key</code>，此时相当于三者相等，合而为一 <code>appId = appKey = appSecret</code>。这种模式下，带上<code>app_id</code>的目的仅仅是统计某一个用户调用接口的次数而已了。<a href="#第一种场景-通常用于开放性接口像地图api会省去app_id和app_key此时相当于三者相等合而为一-appid--appkey--appsecret这种模式下带上app_id的目的仅仅是统计某一个用户调用接口的次数而已了" class="hash-link" aria-label="第一种场景-通常用于开放性接口像地图api会省去app_id和app_key此时相当于三者相等合而为一-appid--appkey--appsecret这种模式下带上app_id的目的仅仅是统计某一个用户调用接口的次数而已了的直接链接" title="第一种场景-通常用于开放性接口像地图api会省去app_id和app_key此时相当于三者相等合而为一-appid--appkey--appsecret这种模式下带上app_id的目的仅仅是统计某一个用户调用接口的次数而已了的直接链接">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第二种场景-当每一个用户有且仅有一套权限配置-可以去掉-appkey直接将-app_id--app_key每个用户分配一个appid-appsecret就够了">第二种场景: 当每一个用户有且仅有一套权限配置 可以去掉 <code>appKey</code>，直接将 <code>app_id = app_key</code>，每个用户分配一个<code>appId+ appSecret</code>就够了。<a href="#第二种场景-当每一个用户有且仅有一套权限配置-可以去掉-appkey直接将-app_id--app_key每个用户分配一个appid-appsecret就够了" class="hash-link" aria-label="第二种场景-当每一个用户有且仅有一套权限配置-可以去掉-appkey直接将-app_id--app_key每个用户分配一个appid-appsecret就够了的直接链接" title="第二种场景-当每一个用户有且仅有一套权限配置-可以去掉-appkey直接将-app_id--app_key每个用户分配一个appid-appsecret就够了的直接链接">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="也可以采用签名signature的方式-当调用方向服务提供方法发起请求时带上appkey时间戳timestamp随机数nonce签名sign-签名sign-可以使用-appsecret--时间戳--随机数使用sha1md5生成服务提供方收到后生成本地签名和收到的签名比对如果一致校验成功">也可以采用签名(<code>signature</code>)的方式： 当调用方向服务提供方法发起请求时，带上（<code>appKey</code>、时间戳<code>timeStamp</code>、随机数<code>nonce</code>、签名<code>sign</code>） 签名<code>sign</code> 可以使用 (<code>AppSecret</code> + 时间戳 + 随机数)使用sha1、md5生成，服务提供方收到后，生成本地签名和收到的签名比对，如果一致，校验成功<a href="#也可以采用签名signature的方式-当调用方向服务提供方法发起请求时带上appkey时间戳timestamp随机数nonce签名sign-签名sign-可以使用-appsecret--时间戳--随机数使用sha1md5生成服务提供方收到后生成本地签名和收到的签名比对如果一致校验成功" class="hash-link" aria-label="也可以采用签名signature的方式-当调用方向服务提供方法发起请求时带上appkey时间戳timestamp随机数nonce签名sign-签名sign-可以使用-appsecret--时间戳--随机数使用sha1md5生成服务提供方收到后生成本地签名和收到的签名比对如果一致校验成功的直接链接" title="也可以采用签名signature的方式-当调用方向服务提供方法发起请求时带上appkey时间戳timestamp随机数nonce签名sign-签名sign-可以使用-appsecret--时间戳--随机数使用sha1md5生成服务提供方收到后生成本地签名和收到的签名比对如果一致校验成功的直接链接">​</a></h4>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="签名流程">签名流程<a href="#签名流程" class="hash-link" aria-label="签名流程的直接链接" title="签名流程的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/27-1-290792b0976572bacd925ade31686c3a.bmp" width="1080" height="496" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="签名规则">签名规则<a href="#签名规则" class="hash-link" aria-label="签名规则的直接链接" title="签名规则的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-分配appid开发者标识和appsecret密钥给-不同的调用方">1. 分配appId(开发者标识)和appSecret(密钥)，给 不同的调用方<a href="#1-分配appid开发者标识和appsecret密钥给-不同的调用方" class="hash-link" aria-label="1. 分配appId(开发者标识)和appSecret(密钥)，给 不同的调用方的直接链接" title="1. 分配appId(开发者标识)和appSecret(密钥)，给 不同的调用方的直接链接">​</a></h3>
<p>可以直接通过平台线上申请，也可以线下直接颁发。<code>appId</code>是全局唯一的，每个<code>appId</code>将对应一个客户，密钥<code>appSecret</code>需要高度保密。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-加入timestamp时间戳以服务端当前时间为准单位为ms-5分钟内数据有效">2. 加入timeStamp（时间戳），以服务端当前时间为准，单位为ms ，5分钟内数据有效<a href="#2-加入timestamp时间戳以服务端当前时间为准单位为ms-5分钟内数据有效" class="hash-link" aria-label="2. 加入timeStamp（时间戳），以服务端当前时间为准，单位为ms ，5分钟内数据有效的直接链接" title="2. 加入timeStamp（时间戳），以服务端当前时间为准，单位为ms ，5分钟内数据有效的直接链接">​</a></h3>
<p>时间戳的目的就是为了减轻DOS攻击。防止请求被拦截后一直尝试请求接口。服务器端设置时间戳阀值，如果服务器时间 减 请求时间戳超过阀值，表示签名超时，接口调用失败。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-加入临时流水号nonce至少为10位-有效期内防重复提交">3. 加入临时流水号nonce，至少为10位 ，有效期内防重复提交。<a href="#3-加入临时流水号nonce至少为10位-有效期内防重复提交" class="hash-link" aria-label="3. 加入临时流水号nonce，至少为10位 ，有效期内防重复提交。的直接链接" title="3. 加入临时流水号nonce，至少为10位 ，有效期内防重复提交。的直接链接">​</a></h3>
<p>随机值nonce 主要是为了增加签名sign的多变性，也可以保护接口的幂等性，相邻的两次请求nonce不允许重复，如果重复则认为是重复提交，接口调用失败。</p>
<ul>
<li>针对查询接口，流水号只用于日志落地，便于后期日志核查。</li>
<li>针对办理类接口需校验流水号在有效期内的唯一性，以避免重复请求。</li>
</ul>
<p>通过在接口签名请求参数加上 时间戳<code>timeStamp</code> + 随机数<code>nonce</code> 可以防止 ”重放攻击“</p>
<ol>
<li>时间戳（timeStamp）:</li>
</ol>
<p>以服务端当前时间为准，服务端要求客户端发过来的时间戳，必须是最近60秒内（假设值，自己定义）的。</p>
<p>这样，即使这个请求即使被截取了，也只能在60s内进行重放攻击。</p>
<ol start="2">
<li>随机数（nonce）:</li>
</ol>
<p>但是，即使设置了时间戳，攻击者还有60s的攻击时间呢！</p>
<p>所以我们需要在客户端请求中再加上一个随机数（中间黑客不可能自己修改随机数，因为有参数签名的校验呢），服务端会对 一分钟内请求的随机数进行检查，如果有两个相同的，基本可以判定为重放攻击。</p>
<p>因为正常情况下，在短时间内（比如60s）连续生成两个相同nonce的情况几乎为0</p>
<p>服务端“第一次”在接收到这个nonce的时候做下面行为：</p>
<ol>
<li>去redis中查找是否有key为<code>nonce:{nonce}</code>的数据</li>
<li>如果没有，则创建这个key，把这个key失效的时间和验证timestamp失效的时间一致，比如是60s。</li>
<li>如果有，说明这个key在60s内已经被使用了，那么这个请求就可以判断为重放请求。</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-加入签名字段sign获取调用方传递的签名信息">4. 加入签名字段sign，获取调用方传递的签名信息。<a href="#4-加入签名字段sign获取调用方传递的签名信息" class="hash-link" aria-label="4. 加入签名字段sign，获取调用方传递的签名信息。的直接链接" title="4. 加入签名字段sign，获取调用方传递的签名信息。的直接链接">​</a></h3>
<p>通过在接口签名请求参数加上 时间戳<code>appId</code> + <code>sign</code> 解决身份验证和防止 ”参数篡改“</p>
<ol>
<li>请求携带参数<code>appId</code>和<code>Sign</code>，只有拥有合法的身份<code>appId</code>和正确的签名<code>Sign</code>才能放行。这样就解决了身份验证和参数篡改问题。</li>
<li>即使请求参数被劫持，由于获取不到<code>appSecret</code>（仅作本地加密使用，不参与网络传输），也无法伪造合法的请求。</li>
</ol>
<p>以上字段放在请求头中。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api接口设计">API接口设计<a href="#api接口设计" class="hash-link" aria-label="API接口设计的直接链接" title="API接口设计的直接链接">​</a></h2>
<p>根据你的具体需求和业务场景，以下是一个简单示例的API接口设计：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-获取资源列表接口">1. 获取资源列表接口<a href="#1-获取资源列表接口" class="hash-link" aria-label="1. 获取资源列表接口的直接链接" title="1. 获取资源列表接口的直接链接">​</a></h3>
<p>URL: <code>/api/resources</code></p>
<p>HTTP 方法: GET</p>
<p>请求参数:</p>
<ul>
<li>page (可选): 页码</li>
<li>limit (可选): 每页限制数量</li>
</ul>
<p>响应:</p>
<ul>
<li>成功状态码: 200 OK</li>
<li>响应体: 返回资源列表的JSON数组</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-创建资源接口">2. 创建资源接口<a href="#2-创建资源接口" class="hash-link" aria-label="2. 创建资源接口的直接链接" title="2. 创建资源接口的直接链接">​</a></h3>
<p>URL: <code>/api/resources</code></p>
<p>HTTP 方法: POST</p>
<p>请求参数:</p>
<ul>
<li>name (必填): 资源名称</li>
<li>description (可选): 资源描述</li>
</ul>
<p>响应:</p>
<ul>
<li>成功状态码: 201 Created</li>
<li>响应体: 返回新创建资源的ID等信息</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-更新资源接口">3. 更新资源接口<a href="#3-更新资源接口" class="hash-link" aria-label="3. 更新资源接口的直接链接" title="3. 更新资源接口的直接链接">​</a></h3>
<p>URL: <code>/api/resources/{resourceId}</code></p>
<p>HTTP 方法: PUT</p>
<p>请求参数:</p>
<ul>
<li>resourceId (路径参数, 必填): 资源ID</li>
<li>name (可选): 更新后的资源名称</li>
<li>description (可选): 更新后的资源描述</li>
</ul>
<p>响应:</p>
<ul>
<li>成功状态码: 200 OK</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-删除资源接口">4. 删除资源接口<a href="#4-删除资源接口" class="hash-link" aria-label="4. 删除资源接口的直接链接" title="4. 删除资源接口的直接链接">​</a></h3>
<p>URL: <code>/api/resources/{resourceId}</code></p>
<p>HTTP 方法: DELETE</p>
<p>请求参数:</p>
<ul>
<li>resourceId (路径参数,  必填): 资源ID</li>
</ul>
<p>响应:</p>
<ul>
<li>成功状态码: 204 No Content</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="安全性考虑">安全性考虑<a href="#安全性考虑" class="hash-link" aria-label="安全性考虑的直接链接" title="安全性考虑的直接链接">​</a></h2>
<p>为了确保安全性，可以采取以下措施：</p>
<ol>
<li>使用HTTPS协议进行数据传输，以保护通信过程中的数据安全。</li>
<li>在请求中使用AK和签名进行身份验证，并对请求进行验签，在服务端进行校验和鉴权，以防止非法请求和重放攻击。</li>
<li>对敏感数据进行加密传输，例如使用TLS加密算法对敏感数据进行加密。</li>
</ol>
<p>以上是一个简单的设计方案和API接口设计示例。具体的实现细节可能因项目需求而有所不同。在实际开发中，还要考虑错误处理、异常情况处理、日志记录等方面。</p>
<p>防止重放攻击和对敏感数据进行加密传输都是保护三方接口安全的重要措施。以下是一些示例代码，展示了如何实现这些功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="防止重放攻击">防止重放攻击<a href="#防止重放攻击" class="hash-link" aria-label="防止重放攻击的直接链接" title="防止重放攻击的直接链接">​</a></h3>
<p>抓取报文原封不动重复发送如果是付款接口，或者购买接口就会造成损失，因此需要采用防重放的机制来做请求验证，如请求参数上加上timestamp时间戳+nonce随机数。关注公众号：码猿技术专栏，回复关键词：1111 获取阿里内部Java性能调优手册！</p>
<p>重放攻击是指黑客通过抓包的方式，得到客户端的请求数据及请求连接，重复的向服务器发送请求的行为。</p>
<blockquote>
<p>时间戳(tamp) + 数字签名(sign)， 也就是说每次发送请求时多传两个参数，分别为 tamp 和 sign。</p>
</blockquote>
<p>数字签名的作用是为 了确保请求的有效性。因为签名是经过加密的，只有客户端和服务器知道加密方式及密钥（key），所以第三方模拟不了。我们通过对sign的验证来判断请求的有效性，如果sign验证失败则判定为无效的请求，反之有效。但是数字签名并不能阻止重放攻击，因为黑客可以抓取你的tamp和sign（不需做任何修改），然后发送请求。这个时候就要对时间戳进行验证。</p>
<p>时间戳的作用是为了确保请求的时效性。我们将上一次请求的时间戳进行存储，在下一次请求时，将两次时间戳进行比对。如果此次请求的时间戳和上次的相同或小于上一次的时间戳，则判定此请求为过时请求，无效。因为正常情况下，第二次请求的时间肯定是比上一次的时间大的，不可能相等或小于。</p>
<p>如果修改了时间戳来满足时间的时效性，sign验签就不通过了。</p>
<blockquote>
<p>注：如果客户端是js，一定要对js做代码混淆，禁止右键等。</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-使用nonce和timestamp">1. 使用Nonce和Timestamp<a href="#1-使用nonce和timestamp" class="hash-link" aria-label="1. 使用Nonce和Timestamp的直接链接" title="1. 使用Nonce和Timestamp的直接链接">​</a></h4>
<p>在请求中添加唯一的Nonce（随机数）和Timestamp（时间戳），并将其包含在签名计算中。服务端在验证签名时，可以检查Nonce和Timestamp的有效性，并确保请求没有被重放。</p>
<p>防止重放攻击是在三方接口中非常重要的安全措施之一。使用Nonce（一次性随机数）和Timestamp（时间戳）结合起来，可以有效地防止重放攻击。下面是实现此功能的最佳实践：</p>
<p>生成Nonce和Timestamp：</p>
<ul>
<li>Nonce应该是一个随机的、唯一的字符串，可以使用UUID或其他随机字符串生成算法来创建。</li>
<li>Timestamp表示请求的时间戳，通常使  用标准的Unix时间戳格式（以秒为单位）。</li>
</ul>
<p>在每个请求中包含Nonce和Timestamp：</p>
<ul>
<li>将生成的Nonce和Timestamp作为参数添加到每个请求中，可以通过URL参数、请求头或请求体的方式进行传递。</li>
<li>确保Nonce和Timestamp在每个请求中都是唯一且正确的。</li>
</ul>
<p>服务器端验证Nonce和Timestamp：</p>
<ul>
<li>在服务器端接收到请求后，首先验证Nonce和Timestamp的有效性。</li>
<li>检查Nonce是否已经被使用过，如果已经被使用过，则可能是重放攻击，拒绝该请求。</li>
<li>检查Timestamp是否在合理的时间范围内，如果超出预定的有效期，则认为请求无效。</li>
</ul>
<p>存储和管理Nonce：</p>
<ul>
<li>为了验证Nonce是否已经被使用过，服务器需要存储已经使用过的Nonce。</li>
<li>可以使用数据库、缓存或其他持久化存储方式来管理Nonce的状态。</li>
<li>需要定期清理过期的Nonce，以防止存储占用过多的资源。</li>
</ul>
<p>设置有效期：</p>
<ul>
<li>为了限制请求的有效时间范围，可以设置一个合理的有效期。</li>
<li>根据实际需求和业务场景，选择适当的有效期，例如几分钟或几小时。</li>
</ul>
<p>通过使用Nonce和Timestamp来防止重放攻击，可以保护三方接口免受恶意重放请求的影响。以上是实现该功能的最佳实践，但具体的实现方法可能因应用程序和技术栈的不同而有所差异。确保在设计和实施安全措施时考虑到应用程序的特定需求和风险模型。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-添加过期时间">2. 添加过期时间<a href="#2-添加过期时间" class="hash-link" aria-label="2. 添加过期时间的直接链接" title="2. 添加过期时间的直接链接">​</a></h4>
<p>在请求中添加一个过期时间字段（例如，token的有效期），并在服务端验证请求的时间戳是否在有效期内。超过过期时间 的请求应被拒绝。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="防篡改防重放攻击拦截器">防篡改、防重放攻击拦截器<a href="#防篡改防重放攻击拦截器" class="hash-link" aria-label="防篡改、防重放攻击拦截器的直接链接" title="防篡改、防重放攻击拦截器的直接链接">​</a></h3>
<p>每次HTTP请求，都需要加上timestamp参数，然后把timestamp和其他参数一起进行数字签名。HTTP请求从发出到达服务器一般都不会超过60s，所以服务器收到HTTP请求之后，首先判断时间戳参数与当前时间相比较，是否超过了60s，如果超过了则认为是非法的请求。</p>
<p>一般情况下,从抓包重放请求耗时远远超过了60s，所以此时请求中的timestamp参数已经失效了，如果修改timestamp参数为当前的时间戳，则signature参数对应的数字签名就会失效，因为不知道签名秘钥，没有办法生成新的数字签名。</p>
<blockquote>
<p>但这种方式的漏洞也是显而易见的，如果在60s之后进行重放攻击，那就没办法了，所以这种方式不能保证请求仅一次有效 nonce的作用</p>
</blockquote>
<p>nonce的意思是仅一次有效的随机字符串，要求每次请求时，该参数要保证不同。我们将每次请求的nonce参数存储到一个“集合”中，每次处理HTTP请求时，首先判断该请求的nonce参数是否在该“集合”中，如果存在则认为是非法请求。</p>
<p>nonce参数在首次请求时，已经被存储到了服务器上的“集合”中，再次发送请求会被识别并拒绝。</p>
<p>nonce参数作为数字签名的一部分，是无法篡改的，因为不知道签名秘钥，没有办法生成新的数字签名。</p>
<blockquote>
<p>这种方式也有很大的问题，那就是存储nonce参数的“集合”会越来越大。</p>
</blockquote>
<p>nonce的一次性可以解决timestamp参数60s(防止重放攻击)的问题，timestamp可以解决nonce参数“集合”越来越大的问题。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SignAuthInterceptor implements HandlerInterceptor {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RedisTemplate&lt;String, String&gt; redisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public SignAuthInterceptor(RedisTemplate&lt;String, String&gt; redisTemplate, String key) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.redisTemplate = redisTemplate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.key = key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean preHandle(HttpServletRequest request,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                             HttpServletResponse response, Object handler) throws Exception {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String timestamp = request.getHeader(&quot;timestamp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取随机字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String nonceStr = request.getHeader(&quot;nonceStr&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取签名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String signature = request.getHeader(&quot;signature&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 判断时间是否大于xx秒(防止重放攻击)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        long NONCE_STR_TIMEOUT_SECONDS = 60L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isEmpty(timestamp) || DateUtil.between(DateUtil.date(Long.parseLong(timestamp) * 1000), DateUtil.date(), DateUnit.SECOND) &gt; NONCE_STR_TIMEOUT_SECONDS) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BusinessException(&quot;invalid  timestamp&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 判断该用户的nonceStr参数是否已经在redis中（防止短时间内的重放攻击）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Boolean haveNonceStr = redisTemplate.hasKey(nonceStr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isEmpty(nonceStr) || Objects.isNull(haveNonceStr) || haveNonceStr) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BusinessException(&quot;invalid nonceStr&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 对请求头参数进行签名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (StrUtil.isEmpty(signature) || !Objects.equals(signature, this.signature(timestamp, nonceStr, request))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new BusinessException(&quot;invalid signature&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 将本次用户请求的nonceStr参数存到redis中设置xx秒后自动删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        redisTemplate.opsForValue().set(nonceStr, nonceStr, NONCE_STR_TIMEOUT_SECONDS, TimeUnit.SECONDS);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String signature(String timestamp, String nonceStr, HttpServletRequest request) throws UnsupportedEncodingException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; params = new HashMap&lt;&gt;(16);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Enumeration&lt;String&gt; enumeration = request.getParameterNames();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (enumeration.hasMoreElements()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String name = enumeration.nextElement();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String value = request.getParameter(name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            params.put(name, URLEncoder.encode(value, CommonConstants.UTF_8));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String qs = String.format(&quot;%s×tamp=%s&amp;nonceStr=%s&amp;key=%s&quot;, this.sortQueryParamString(params), timestamp, nonceStr, key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;qs:{}&quot;, qs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String sign = SecureUtil.md5(qs).toLowerCase();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;sign:{}&quot;, sign);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return sign;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 按照字母顺序进行升序排序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param params 请求参数 。注意请求参数中不能包含key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @return 排序后结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String sortQueryParamString(Map&lt;String, Object&gt; params) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; listKeys = Lists.newArrayList(params.keySet());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Collections.sort(listKeys);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StrBuilder content = StrBuilder.create();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (String param : listKeys) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            content.append(param).append(&quot;=&quot;).append(params.get(param).toString()).append(&quot;&amp;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (content.length() &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return content.subString(0, content.length() - 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return content.toString();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注册拦截器指定拦截接口</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="对敏感数据进行加密传输"><a href="https://blog.51cto.com/u_16175496/6920098" target="_blank" rel="noopener noreferrer">对敏感数据进行加密传输</a><a href="#对敏感数据进行加密传输" class="hash-link" aria-label="对敏感数据进行加密传输的直接链接" title="对敏感数据进行加密传输的直接链接">​</a></h3>
<p>使用TLS（传输层安全）协议可以保证通信过程中的数据加密和完整性。以下是一些基本步骤：</p>
<ol>
<li>在服务器上配置TLS证书（包括公钥和私钥）。</li>
<li>客户端和服务器之间建立TLS连接。客户端向服务器发送HTTPS请求。</li>
<li>在TLS握手期间，客户端和服务器协商加密算法和密钥交换方法。</li>
<li>握手成功后，客户端和服务器之间的所有数据传输都会经过加密处理。</li>
</ol>
<p>具体的实现取决于所使用的编程语言和框架。以下是使用Java的示例代码，演示如何使用TLS进行加密传输：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 创建SSLContext对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SSLContext sslContext = SSLContext.getInstance(&quot;TLS&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 初始化SSLContext，加载证书和私钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyStore.load(new FileInputStream(&quot;keystore.jks&quot;), &quot;password&quot;.toCharArray());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KeyManagerFactory kmf = KeyManagerFactory.getInstance(KeyManagerFactory.getDefaultAlgorithm());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kmf.init(keyStore, &quot;password&quot;.toCharArray());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TrustManagerFactory tmf = TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tmf.init(keyStore);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sslContext.init(kmf.getKeyManagers(), tmf.getTrustManagers(), new SecureRandom());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 创建HttpsURLConnection连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">URL url = new URL(&quot;https://api.example.com/endpoint&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HttpsURLConnection connection = (HttpsURLConnection) url.openConnection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">connection.setSSLSocketFactory(sslContext.getSocketFactory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置其他请求参数、发送请求、处理响应等</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这段代码中，我们创建了一个<code>SSLContext</code>对象并初始化它，加载了服务器的证书和私钥。然后，通过<code>HttpsURLConnection</code>对象，设置了TLS的安全套接字工厂，并与指定的URL建立了HTTPS连接。</p>
<p>请注意，你需要将实际的证书和私钥文件（通常是.jks格式）替换为真实的文件路径，并提供正确的密码。</p>
<p>以上代码只是一个简单的示例，实际部署时可能需要根据具体要求进行更多配置。确保在项目中遵循最佳实践和安全建议，并与相应的开发和运维团队合作，以确保三方接口的安全性。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ak和sk生成方案">AK和SK生成方案<a href="#ak和sk生成方案" class="hash-link" aria-label="AK和SK生成方案的直接链接" title="AK和SK生成方案的直接链接">​</a></h2>
<p>参考各大云服务厂商如何获取aksk:</p>
<blockquote>
<p><code>https://blog.csdn.net/weixin_43460193/article/details/130242478</code></p>
</blockquote>
<p>开发一个三方接口，并提供给客户使用，可以考虑以下方法来生成AK（<code>Access Key</code>）和SK（<code>Secret Key</code>）：</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="设计api密钥管理系统">设计API密钥管理系统：<a href="#设计api密钥管理系统" class="hash-link" aria-label="设计API密钥管理系 统：的直接链接" title="设计API密钥管理系统：的直接链接">​</a></h3>
<ul>
<li>创建一个API密钥管理系统，用于生成和管理AK和SK。这个系统可以是一个独立的服务器应用或与你的主应用集成在一起。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="生成ak和sk">生成AK和SK：<a href="#生成ak和sk" class="hash-link" aria-label="生成AK和SK：的直接链接" title="生成AK和SK：的直接链接">​</a></h3>
<ul>
<li>在API密钥管理系统中，为每个客户生成唯一的AK和SK。</li>
<li>AK通常是一个公开的标识符，用于标识客户的身份。可以使用随机字符串、UUID等方式生成。</li>
<li>SK是一个保密的私钥，用于生成身份验证签名和加密访问令牌。可以使用随机字符串、哈希函数等方式生成，并确保其足够安全。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="存储和管理ak和sk">存储和管理AK和SK：<a href="#存储和管理ak和sk" class="hash-link" aria-label="存储和管理AK和SK：的直接链接" title="存储和管理AK和SK：的直接链接">​</a></h3>
<ul>
<li>将生成的AK和SK存储在数据库或其他持久化存储中，并与客户的其他相关信息关联起来。</li>
<li>需要实施适当的权限控制和安全措施，以确保只有授权的用户可以访问和管理AK和SK。</li>
<li>可以考虑对SK进行加密处理，以增加安全性。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="提供api密钥分发机制">提供API密钥分发机制：<a href="#提供api密钥分发机制" class="hash-link" aria-label="提供API密钥分发机制：的直接链接" title="提供API密钥分发机制：的直接链接">​</a></h3>
<ul>
<li>客户可以通过你提供的界面、API或者自助注册流程来获取他们的AK和SK。</li>
<li>在分发过程中，确保以安全的方式将AK和SK传递给客户。例如，使用加密连接或其他安全通道进行传输。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安全性和最佳实践">安全性和最佳实践：<a href="#安全性和最佳实践" class="hash-link" aria-label="安全性和最佳实践：的直接链接" title="安全性和最佳实践：的直接链接">​</a></h3>
<ul>
<li>强烈建议对API密钥管理系统进行安全审计，并根据最佳实践来保护和管理AK和SK。</li>
<li>定期轮换AK和SK，以增加安全性并降低潜在风险。</li>
<li>在设计接口时，使用AK和SK进行身份验证和权限控制，以防止未经授权的访问。</li>
</ul>
<p>请注意，上述步骤提供了一般性的指导，具体实现可能因你的应用程序需求、技术栈和安全策略而有所不同。确保遵循安全最佳实践，并参考相关的安全文档和建议，以确保生成的AK和SK的安全性和可靠性。</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> api_credentials </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AUTO_INCREMENT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app_id </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_key </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    secret_key </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valid_from </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    valid_to </span><span class="token keyword" style="color:#00009f">DATETIME</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enabled </span><span class="token keyword" style="color:#00009f">TINYINT</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    allowed_endpoints </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">255</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    created_at </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DEFAULT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT_TIMESTAMP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个表包含以下字段：</p>
<ul>
<li><code>id</code>：主键，自增的唯一标识符。</li>
<li><code>app_id</code>：应用程序ID或标识符，用于关联AKSK与特定应用程序。</li>
<li><code>access_key</code>：访问密钥（AK），用于标识客户身份。</li>
<li><code>secret_key</code>：秘密密钥（SK），用于生成签名和进行身份验证。</li>
<li><code>valid_from</code>：AKSK有效期起始时间。</li>
<li><code>valid_to</code>：AKSK有效期结束时间。</li>
<li><code>enabled</code>：是否启用该AKSK，1表示启用，0表示禁用。</li>
<li><code>allowed_endpoints</code>：逗号分隔的允许访问的接口/端点列表。</li>
<li><code>created_at</code>：记录创建时间  。</li>
</ul>
<p>在实际使用中，你可能需要根据具体需求对字段进行调整或添加索引以提高性能。此外，还可以考虑添加其他字段来满足你的应用程序的需求，例如描述、所属用户等。</p>
<p>请注意，具体的设计可能会因你的应用程序需求和使用场景而有所不同。确保在实施前仔细考虑你的业务要求，并遵循良好的数据库设计原则和最佳实践。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="api接口设计补充">API接口设计补充<a href="#api接口设计补充" class="hash-link" aria-label="API接口设计补充的直接链接" title="API接口设计补充的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/27-2-0f67f67df812a2a2a5deeca95213c787.bmp" width="760" height="435" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-使用post作为接口请求方式">1. 使用POST作为接口请求方式<a href="#1-使用post作为接口请求方式" class="hash-link" aria-label="1. 使用POST作为接口请求方式的直接链接" title="1. 使用POST作为接口请求方式的直接链接">​</a></h3>
<p>一般调用接口最常用的两种方式就是<code>GET</code>和<code>POST</code>。两者的区别也很明显，<code>GET</code>请求会将参数暴露在浏览器<code>URL</code>中，而且对长度也有限制。为了更高的安全性，所有接口都采用<code>POST</code>方式请求。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-客户端ip白名单">2. 客户端IP白名单<a href="#2-客户端ip白名单" class="hash-link" aria-label="2. 客户端IP白名单的直接链接" title="2. 客户端IP白名单的直接链接">​</a></h3>
<p>ip白名单是指将接口的访问权限对部分ip进行开放来避免其他ip进行访问攻击。</p>
<ul>
<li>设置ip白名单缺点就是当你的客户端进行迁移后，就需要重新联系服务提供者添加新的ip白名单。</li>
<li>设置ip白名单的方式很多，除了传统的防火墙之外，<code>spring cloud alibaba</code>提供的组件<code>sentinel</code>也支持白名单设置。</li>
<li>为了降低api的复杂度，推荐使用防火墙规则进行白名单设置。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-单个接口针对ip限流">3. 单个接口针对ip限流<a href="#3-单个接口针对ip限流" class="hash-link" aria-label="3. 单个接口针对ip限流的直接链接" title="3. 单个接口针对ip限流的直接链接">​</a></h3>
<p>限流是为了更好的维护系统稳定性。</p>
<p>使用redis进行接口调用次数统计，<code>ip+接口地址作为key</code>，访问次数作为<code>value</code>，每次请求<code>value+1</code>，设置过期时长来限制接口的调用频率。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-记录接口请求日志">4. 记录接口请求日志<a href="#4-记录接口请求日志" class="hash-link" aria-label="4. 记录接口请求日志的直接链接" title="4. 记录接口请求日志的直接链接">​</a></h3>
<p>记录请求日志，快速定位异常请求位置，排查问题原因。(如：用aop来全局处理接口请求)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-敏感数据脱敏">5. 敏感数据脱敏<a href="#5-敏感数据脱敏" class="hash-link" aria-label="5. 敏感数据脱敏的直接链接" title="5. 敏感数据脱敏的直接链接">​</a></h3>
<p>在接口调用过程中，可能会涉及到订单号等敏感数据，这类数据通常需要脱敏处理</p>
<p>最常用的方式就是加密。加密方式使用安全性比较高的RSA非对称加密。非对称加密算法有两个密钥，这两个密钥完全不同但又完全匹配。只有使用匹配的一对公钥和私钥，才能完成对明文的加密和解密过程。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-幂等性问题">6. 幂等性问题<a href="#6-幂等性问题" class="hash-link" aria-label="6. 幂等性问题的直接链 接" title="6. 幂等性问题的直接链接">​</a></h3>
<p>幂等性是指: 任意多次请求的执行结果和一次请求的执行结果所产生的影响相同。</p>
<ul>
<li>说的直白一点就是查询操作无论查询多少次都不会影响数据本身，因此查询操作本身就是幂等的。</li>
<li>但是新增操作，每执行一次数据库就会发生变化，所以它是非幂等的。</li>
</ul>
<p>幂等问题的解决有很多思路，这里讲一种比较严谨的。</p>
<ul>
<li>提供一个生成随机数的接口，随机数全局唯一。调用接口的时候带入随机数。</li>
<li>第一次调用，业务处理成功后，将随机数作为key，操作结果作为value，存入redis，同时设置过期时长。</li>
<li>第二次调用，查询redis，如果key存在，则证明是重复提交，直接返回错误。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="7-版本控制">7. 版本控制<a href="#7-版本控制" class="hash-link" aria-label="7. 版本控制的直接链接" title="7. 版本控制的直接链接">​</a></h3>
<p>一套成熟的API文档，一旦发布是不允许随意修改接口的。这时候如果想新增或者修改接口，就需要加入版本控制，版本号可以是整数类型，也可以是浮点数类型。</p>
<p>一般接口地址都会带上版本号，<code>http://ip:port//v1/list</code> , <code>http://ip:port//v2/list</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="8-响应状态码规范">8. 响应状态码规范<a href="#8-响应状态码规范" class="hash-link" aria-label="8. 响应状态码规范的直接链接" title="8. 响应状态码规范的直接链接">​</a></h3>
<p>一个牛逼的API，还需要提供简单明了的响应值，根据状态码就可以大概知道问题所在。我们采用http的状态码进行数据封装，例如200表示请求成功，4xx表示客户端错误，5xx表示服务器内部发生错误。</p>
<p>状态码设计参考如下：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public enum CodeEnum {// 根据业务需求进行添加</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SUCCESS(200, &quot;处理成功&quot;),ERROR_PATH(404, &quot;请求地址错误&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ERROR_SERVER(505, &quot;服务器内部发生错误&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CodeEnum(int code, String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.code = code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.message = message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getCode() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setCode(int code) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.code = code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getMessage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setMessage(String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.message = message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="9-统一响应数据格式">9. 统一响应数据格式<a href="#9-统一响应数据格式" class="hash-link" aria-label="9. 统一响应数据格式的直接链接" title="9. 统一响应数据格式的直接链接">​</a></h3>
<p>为了方便给客户端响应，响应数据会包含三个属性，状态码（code）,信息描述（message）,响应数据（data）。客户端根据状态码及信息描述可快速知道接口，如果状态码返回成功，再开始处理数据。</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Result implements Serializable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final long serialVersionUID = 793034041048451317L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Object data = null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public int getCode() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setCode(int code) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.code = code;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getMessage() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setMessage(String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.message = message;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object getData() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** * 放入响应枚举 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Result fillCode(CodeEnum codeEnum) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.setCode(codeEnum.getCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.setMessage(codeEnum.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** * 放入响应码及信息 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Result fillCode(int code, String message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.setCode(code);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.setMessage(message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** * 处理成功，放入自定义业务数据集合 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Result fillData(Object data) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.setCode(CodeEnum.SUCCESS.getCode());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.setMessage(CodeEnum.SUCCESS.getMessage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.data = data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return this;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="10-接口文档">10. 接口文档<a href="#10-接口文档" class="hash-link" aria-label="10. 接口文档的直接链接" title="10. 接口文档的直接链接">​</a></h3>
<p>一个好的API还少不了一个优秀的接口文档。接口文档的可读性非常重要，虽然很多程序员都不喜欢写文档，而且不喜欢别人不写文 档。为了不增加程序员的压力，推荐使用swagger2或其他接口管理工具，通过简单配置，就可以在开发中测试接口的连通性，上线后也可以生成离线文档用于管理API</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-生成签名sign的详细步骤">11. 生成签名sign的详细步骤<a href="#11-生成签名sign的详细步骤" class="hash-link" aria-label="11. 生成签名sign的详细步骤的直接链接" title="11. 生成签名sign的详细步骤的直接链接">​</a></h3>
<p>结合案例详细说明怎么生成签名<code>signature</code>（写完上面的博客后，得出的感悟）</p>
<p>第1步: 将所有参数（注意是所有参数，包括<code>appId</code>,<code>timeStamp</code>,<code>nonce</code>），除去<code>sign</code>本身，以及值是空的参数，按<code>key</code>名升序排序存储。</p>
<p>第2步: 然后把排序后的参数按 <code>key1value1key2value2…keyXvalueX</code> 的方式拼接成一个字符串。</p>
<blockquote>
<p>这里的参数和值必须是传输参数的原始值，不能是经过处理的，如不能将&quot;转成”后再拼接）</p>
</blockquote>
<p>第3步: 把分配给调用方的密钥<code>secret</code>拼接在第2步得到的字符串最后面。</p>
<blockquote>
<p>即: <code>key1value1key2value2…keyXvalueX + secret</code></p>
</blockquote>
<p>第4步: 计算第3步字符串的md5值(32位)，然后转成大写,最终得到的字符串作为签名<code>sign</code>。</p>
<blockquote>
<p>即: <code>Md5(key1value1key2value2…keyXvalueX + secret)</code> 转大写</p>
</blockquote>
<p>举例：</p>
<p>假设传输的数据是</p>
<blockquote>
<p><code>http://www.xxx.com/openApi?sign=sign_value&amp;k1=v1&amp;k2=v2&amp;method=cancel&amp;k3=&amp;kX=vX</code></p>
</blockquote>
<p>请求头是</p>
<blockquote>
<p><code>appId:zs001timeStamp:1612691221000sign:2B42AAED20E4B2D5BA389F7C344FE91Bnonce:1234567890</code></p>
</blockquote>
<p>实际情况最好是通过post方式发送，其中<code>sign</code>参数对应的<code>sign_value</code>就是签名的值。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第一步拼接字符串">第一步：拼接字符串。<a href="#第一步拼接字符串" class="hash-link" aria-label="第一步：拼接字符串。的直接链接" title="第一步：拼接字符串。的直接链接">​</a></h4>
<p>首先去除<code>sign</code>参数本身，然后去除值是空的参数<code>k3</code>，剩下<code>appId=zs001&amp;timeStamp=1612691221000&amp;nonce=1234567890&amp;k1=v1&amp;k2=v2&amp;&amp;method=cancel&amp;kX=vX</code>，然后按参数名字符升序排序，<code>appId=zs001&amp;k1=v1&amp;k2=v2&amp;kX=vX&amp;method=cancel&amp;nonce=1234567890&amp;timeStamp=1612691221000</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第二步将参数名和值的拼接">第二步：将参数名和值的拼接<a href="#第二步将参数名和值的拼接" class="hash-link" aria-label="第二步：将参数名和值的拼接的直接链接" title="第二步：将参数名和值的拼接的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">appIdzs001k1v1k2v2kXvXmethodcancelnonce1234567890timeStamp1612691221000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第三步在上面拼接得到的字符串前加上密钥secret">第三步：在上面拼接得到的字符串前加上密钥secret<a href="#第三步在上面拼接得到的字符串前加上密钥secret" class="hash-link" aria-label="第三步：在上面拼接得到的字符串前加上密钥secret的直接链接" title="第三步：在上面拼接得到的字符串前加上密钥secret的直接链接">​</a></h4>
<p>假设是<code>miyao</code>，得到新的字符串<code>appIdzs001k1v1k2v2kXvXmethodcancelnonce1234567890timeStamp1612691221000miyao</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="第四步然后将这个字符串进行md5计算">第四步：然后将这个字符串进行md5计算<a href="#第四步然后将这个字符串进行md5计算" class="hash-link" aria-label="第四步：然后将这个字符串进行md5计算的直接链接" title="第四步：然后将这个字符串进行md5计算的直接链接">​</a></h4>
<p>假设得到的是<code>abcdef</code>，然后转为大写，得到<code>ABCDEF</code>这个值作为签名<code>sign</code></p>
<blockquote>
<p>注意，计算md5之前调用方需确保签名加密字符串编码与提供方一致，如统一使用utf-8编码或者GBK编码，如果编码方式不一致则计算出来的签名会校验失败。</p>
</blockquote>
<p>上面说的请求录音可拼可不拼接，主要还是为了增强签名的复杂性</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-什么是token">12. 什么是token?<a href="#12-什么是token" class="hash-link" aria-label="12. 什么是token?的直接链接" title="12. 什么是token?的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="token是什么">Token是什么？<a href="#token是什么" class="hash-link" aria-label="Token是什么？的直接链接" title="Token是什么？的直接链接">​</a></h4>
<p><code>token</code>即 访问令牌<code>access token</code>，用于接口中标识接口调用者的身份、凭证，减少用户名和密码的传输次数。 一般情况下客户端(接口调用方)需要先向服务器端申请一个接口调用的账号，服务器会给出一个<code>appId</code>和一个<code>appSecret</code>(<code>appSecret</code>用于参数签名使用)</p>
<blockquote>
<p>注意<code>appSecret</code>保存到客户端，需要做一些安全处理，防止泄露。</p>
</blockquote>
<p>Token的值一般是UUID，服务端生成Token后需要将token做为key，将一些和token关联的信息作为value保存到缓存服务器中(redis)，当一个请求过来后，服务器就去缓存服务器中查询这个Token是否存在，存在则调用接口，不存在返回接口错误，一般通过拦截器或者过滤器来实现。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="token分为两种">Token分为两种<a href="#token分为两种" class="hash-link" aria-label="Token分为两种的直接链接" title="Token分为两种的直接链接">​</a></h4>
<ul>
<li><code>API Token</code>(接口令牌): 用于访问不需要用户登录的接口，如登录、注册、一些基本数据的获取等。获取接口令牌需要拿<code>appId</code>、<code>timestamp</code>和<code>sign</code>来换，<code>sign=加密(参数1+…+参数n+timestamp+key)</code></li>
<li><code>USER Token</code>(用户令牌): 用于访问需要用户登录之后的接口，如：获取我的基本信息、保存、修改、删除等操作。获取用户令牌需要拿用户名和密码来换</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-token签名有用户状态的接口签名">13. Token+签名(有用户状态的接口签名)<a href="#13-token签名有用户状态的接口签名" class="hash-link" aria-label="13. Token+签名(有用户状态的接口签名)的直接链接" title="13. Token+签名(有用户状态的接口签名)的直 接链接">​</a></h3>
<p>上面讲的接口签名方式都是无状态的，在APP开放API接口的设计中，由于大多数接口涉及到用户的个人信息以及产品的敏感数据，所以要对这些接口进行身份验证，为了安全起见让用户暴露的明文密码次数越少越好，然而客户端与服务器的交互在请求之间是无状态的，也就是说，当涉及到用户状态时，每次请求都要带上身份验证信息(令牌token)。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-token身份验证">1. Token身份验证<a href="#1-token身份验证" class="hash-link" aria-label="1. Token身份验证的直接链接" title="1. Token身份验证的直接链接">​</a></h4>
<ul>
<li>用户登录向服务器提供认证信息（如账号和密码），服务器验证成功后返回Token给客户端；</li>
<li>客户端将Token缓存在本地，后续每次发起请求时，都要携带此Token；</li>
<li>服务端检查Token的有效性，有效则放行，无效（Token错误或过期）则拒绝。</li>
</ul>
<p>弊端：Token被劫持，伪造请求和篡改参数。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-token签名验证">2. Token+签名验证<a href="#2-token签名验证" class="hash-link" aria-label="2. Token+签名验证的直接链接" title="2. Token+签名验证的直接链接">​</a></h4>
<p>与上面接口签名规则一样，为客户端分配<code>appSecret</code>（密钥，用于接口加密，不参与传输），将<code>appSecret</code>和所有请求参数组合成一个字符串，根据签名算法生成签名值，发送请求时将签名值一起发送给服务器验证。</p>
<p>这样，即使Token被劫持，对方不知道<code>appSecret</code>和签名算法，就无法伪造请求和篡改参数，并且有了token后也能正确的获取到用户的状态</p>
<p>登陆和退出请求</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/27-3-ae63abb55116b17394941ed187801c35.bmp" width="472" height="284" class="img_ev3q"></p>
<p>后续请求</p>
<p>客户端: 与上面接口签名规则一样类似，把<code>appId</code>改为token即可。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/27-4-9ce2055a2620d903713a621af0842fc1.bmp" width="360" height="508" class="img_ev3q"></p>
<ul>
<li><a href="https://www.dandelioncloud.cn/article/details/1585274840783507457" target="_blank" rel="noopener noreferrer">【JavaWeb】如何优雅的实现第三方开放api接口签名(有状态/无状态)</a></li>
<li><a href="https://www.cnblogs.com/shamo89/p/17497921.html" target="_blank" rel="noopener noreferrer">java/springboot服务第三方接口安全签名(Signature)实现方案 </a></li>
<li><a href="https://www.cnblogs.com/cgy1995/p/17473791.html" target="_blank" rel="noopener noreferrer">AK、SK实现（双方API交互：签名及验证）</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-boot/27-ApiKey-design.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/zh-cn/spring-boot/Spring-Boot-Integrate-Alipay/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Spring-Boot-Integrate-Alipay</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/zh-cn/spring-boot/Spring-Boot-RSA-AES-Encryption/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Spring-Boot-RSA-AES-Encryption</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#设计方案概述" class="table-of-contents__link toc-highlight">设计方案概述</a><ul><li><a href="#1-api密钥生成-为每个三方应用生成唯一的api密钥对aksk其中ak用于标识应用sk用于进行签名和加密" class="table-of-contents__link toc-highlight">1. API密钥生成： 为每个三方应用生成唯一的API密钥对（AK/SK），其中AK用于标识应用，SK用于进行签名和加密。</a></li><li><a href="#2-接口鉴权-在进行接口调用时客户端需要使用ak和请求参数生成签名并将其放入请求头或参数中以进行身份验证" class="table-of-contents__link toc-highlight">2. 接口鉴权： 在进行接口调用时，客户端需要使用AK和请求参数生成签名，并将其放入请求头或参数中以进行身份验证。</a></li><li><a href="#3-回调地址设置-三方应用提供回调地址用于接收异步通知和回调结果" class="table-of-contents__link toc-highlight">3. 回调地址设置： 三方应用提供回调地址，用于接收异步通知和回调结果。</a></li><li><a href="#4-接口api设计-设计接口的urlhttp方法请求参数响应格式等细节" class="table-of-contents__link toc-highlight">4. 接口API设计： 设计接口的URL、HTTP方法、请求参数、响应格式等细节。</a></li></ul></li><li><a href="#权限划分" class="table-of-contents__link toc-highlight">权限划分</a><ul><li><a href="#appid应用的唯一标识" class="table-of-contents__link toc-highlight">appID：应用的唯一标识</a></li><li><a href="#appkey公匙相当于账号" class="table-of-contents__link toc-highlight">appKey：公匙（相当于账号）</a></li><li><a href="#appsecret私匙相当于密码" class="table-of-contents__link toc-highlight">appSecret：私匙（相当于密码）</a></li><li><a href="#token令牌过期失效" class="table-of-contents__link toc-highlight">token：令牌（过期失效）</a></li><li><a href="#使用方法" class="table-of-contents__link toc-highlight">使用方法</a></li><li><a href="#为什么-要有appkey--appsecret-这种成对出现的机制呢" class="table-of-contents__link toc-highlight">为什么 要有appKey + appSecret 这种成对出现的机制呢?</a></li><li><a href="#简化的场景" class="table-of-contents__link toc-highlight">简化的场景:</a></li></ul></li><li><a href="#签名流程" class="table-of-contents__link toc-highlight">签名流程</a></li><li><a href="#签名规则" class="table-of-contents__link toc-highlight">签名规则</a><ul><li><a href="#1-分配appid开发者标识和appsecret密钥给-不同的调用方" class="table-of-contents__link toc-highlight">1. 分配appId(开发者标识)和appSecret(密钥)，给 不同的调用方</a></li><li><a href="#2-加入timestamp时间戳以服务端当前时间为准单位为ms-5分钟内数据有效" class="table-of-contents__link toc-highlight">2. 加入timeStamp（时间戳），以服务端当前时间为准，单位为ms ，5分钟内数据有效</a></li><li><a href="#3-加入临时流水号nonce至少为10位-有效期内防重复提交" class="table-of-contents__link toc-highlight">3. 加入临时流水号nonce，至少为10位 ，有效期内防重复提交。</a></li><li><a href="#4-加入签名字段sign获取调用方传递的签名信息" class="table-of-contents__link toc-highlight">4. 加入签名字段sign，获取调用方传递的签名信息。</a></li></ul></li><li><a href="#api接口设计" class="table-of-contents__link toc-highlight">API接口设计</a><ul><li><a href="#1-获取资源列表接口" class="table-of-contents__link toc-highlight">1. 获取资源列表接口</a></li><li><a href="#2-创建资源接口" class="table-of-contents__link toc-highlight">2. 创建资源接口</a></li><li><a href="#3-更  新资源接口" class="table-of-contents__link toc-highlight">3. 更新资源接口</a></li><li><a href="#4-删除资源接口" class="table-of-contents__link toc-highlight">4. 删除资源接口</a></li></ul></li><li><a href="#安全性考虑" class="table-of-contents__link toc-highlight">安全性考虑</a><ul><li><a href="#防止重放攻击" class="table-of-contents__link toc-highlight">防止重放攻击</a></li><li><a href="#防篡改防重放攻击拦截器" class="table-of-contents__link toc-highlight">防篡改、防重放攻击拦截器</a></li><li><a href="#对敏感数据进行加密传输" class="table-of-contents__link toc-highlight">对敏感数据进行加密传输</a></li></ul></li><li><a href="#ak和sk生成方案" class="table-of-contents__link toc-highlight">AK和SK生成方案</a><ul><li><a href="#设计api密钥管理系统" class="table-of-contents__link toc-highlight">设计API密钥管理系统：</a></li><li><a href="#生成ak和sk" class="table-of-contents__link toc-highlight">生成AK和SK：</a></li><li><a href="#存储和管理ak和sk" class="table-of-contents__link toc-highlight">存储和管理AK和SK：</a></li><li><a href="#提供api密钥分发机制" class="table-of-contents__link toc-highlight">提供API密钥分发机制：</a></li><li><a href="#安全性和最佳实践" class="table-of-contents__link toc-highlight">安全性和最佳实践：</a></li></ul></li><li><a href="#api接口设计补充" class="table-of-contents__link toc-highlight">API接口设计补充</a><ul><li><a href="#1-使用post作为接口请求方式" class="table-of-contents__link toc-highlight">1. 使用POST作为接口请求方式</a></li><li><a href="#2-客户端ip白名单" class="table-of-contents__link toc-highlight">2. 客户端IP白名单</a></li><li><a href="#3-单个接口针对ip限流" class="table-of-contents__link toc-highlight">3. 单个接口针对ip限流</a></li><li><a href="#4-记录接口请求日志" class="table-of-contents__link toc-highlight">4. 记录接口请求日志</a></li><li><a href="#5-敏感数据脱敏" class="table-of-contents__link toc-highlight">5. 敏感数据脱敏</a></li><li><a href="#6-幂等性问题" class="table-of-contents__link toc-highlight">6. 幂等性问题</a></li><li><a href="#7-版本控制" class="table-of-contents__link toc-highlight">7. 版本控制</a></li><li><a href="#8-响应状态码规范" class="table-of-contents__link toc-highlight">8. 响应状态码规范</a></li><li><a href="#9-统一响应数据格式" class="table-of-contents__link toc-highlight">9. 统一响应数据格式</a></li><li><a href="#10-接口文档" class="table-of-contents__link toc-highlight">10. 接口文档</a></li><li><a href="#11-生成签名sign的详细步骤" class="table-of-contents__link toc-highlight">11. 生成签名sign的详细步骤</a></li><li><a href="#12-什么是token" class="table-of-contents__link toc-highlight">12. 什么是token?</a></li><li><a href="#13-token签名有用户状态的接口签名" class="table-of-contents__link toc-highlight">13. Token+签名(有用户状态的接口签名)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>