"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[71672],{6142:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>i});var t=s(74848),r=s(28453);const o={},l=void 0,c={id:"zh-cn/k8s/Build-K8s-Single-Master-Cluster",title:"Build-K8s-Single-Master-Cluster",description:"\u5355Master\u670d\u52a1\u5668\u89c4\u5212\uff1a",source:"@site/docs/zh-cn/k8s/1-Build-K8s-Single-Master-Cluster.md",sourceDirName:"zh-cn/k8s",slug:"/zh-cn/k8s/Build-K8s-Single-Master-Cluster",permalink:"/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Single-Master-Cluster",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/k8s/1-Build-K8s-Single-Master-Cluster.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"troch",previous:{title:"Kubernetes",permalink:"/light-docusaurus/docs/category/kubernetes"},next:{title:"Build-K8s-Cluster-With-Rancher",permalink:"/light-docusaurus/docs/zh-cn/k8s/Build-K8s-Cluster-With-Rancher"}},a={},i=[{value:"1. \u73af\u5883\u51c6\u5907",id:"1-\u73af\u5883\u51c6\u5907",level:2},{value:"1. \u5207\u6362\u53ca\u6dfb\u52a0\u5b89\u88c5\u6e90",id:"1-\u5207\u6362\u53ca\u6dfb\u52a0\u5b89\u88c5\u6e90",level:3},{value:"2. \u5b89\u88c5\u4f9d\u8d56",id:"2-\u5b89\u88c5\u4f9d\u8d56",level:3},{value:"3. \u670d\u52a1\u5668\u8bbe\u7f6e",id:"3-\u670d\u52a1\u5668\u8bbe\u7f6e",level:3},{value:"2. \u5b89\u88c5Docker/kubeadm/kubelet",id:"2-\u5b89\u88c5dockerkubeadmkubelet",level:2},{value:"1. \u5b89\u88c5Docker",id:"1-\u5b89\u88c5docker",level:3},{value:"2. \u5b89\u88c5Docker Compose",id:"2-\u5b89\u88c5docker-compose",level:3},{value:"3. Docker overlay2\u5360\u7528\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\u89e3\u51b3\u529e\u6cd5",id:"3-docker-overlay2\u5360\u7528\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\u89e3\u51b3\u529e\u6cd5",level:3},{value:"4. \u5b89\u88c5K8s",id:"4-\u5b89\u88c5k8s",level:3},{value:"3. \u521d\u59cb\u5316K8s Master\u8282\u70b9",id:"3-\u521d\u59cb\u5316k8s-master\u8282\u70b9",level:2},{value:"1. \u5728192.168.137.101\uff08Master\uff09\u6267\u884c\u521d\u59cb\u5316\u547d\u4ee4",id:"1-\u5728192168137101master\u6267\u884c\u521d\u59cb\u5316\u547d\u4ee4",level:3},{value:"2. \u666e\u901a\u7528\u6237\u64cd\u4f5cK8s\u6743\u9650",id:"2-\u666e\u901a\u7528\u6237\u64cd\u4f5ck8s\u6743\u9650",level:3},{value:"4. \u6ce8\u518cK8s Node\u8282\u70b9",id:"4-\u6ce8\u518ck8s-node\u8282\u70b9",level:2},{value:"5. \u90e8\u7f72\u5bb9\u5668\u7f51\u7edc\uff08CNI\uff09",id:"5-\u90e8\u7f72\u5bb9\u5668\u7f51\u7edccni",level:2},{value:"1. \u5728Master\u8282\u70b9\u90e8\u7f72flannel",id:"1-\u5728master\u8282\u70b9\u90e8\u7f72flannel",level:3},{value:"2. \u7ed9\u96c6\u7fa4\u6253Tag\uff08\u8df3\u8fc7\uff09",id:"2-\u7ed9\u96c6\u7fa4\u6253tag\u8df3\u8fc7",level:3},{value:"3. \u8bbe\u7f6eipvs\u6a21\u5f0f\uff08\u8df3\u8fc7\uff09",id:"3-\u8bbe\u7f6eipvs\u6a21\u5f0f\u8df3\u8fc7",level:3},{value:"4. \u91cd\u542fkube-proxy\uff08\u8df3\u8fc7\uff09",id:"4-\u91cd\u542fkube-proxy\u8df3\u8fc7",level:3},{value:"6. \u90e8\u7f72\u5b98\u65b9Dashboard\uff08UI\uff09",id:"6-\u90e8\u7f72\u5b98\u65b9dashboardui",level:2},{value:"1. \u90e8\u7f72Dashboard",id:"1-\u90e8\u7f72dashboard",level:3},{value:"2. \u521b\u5efaServiceAccount\u5e76\u7ed1\u5b9a\u9ed8\u8ba4cluster-admin\u7ba1\u7406\u5458\u96c6\u7fa4\u89d2\u8272\uff1a",id:"2-\u521b\u5efaserviceaccount\u5e76\u7ed1\u5b9a\u9ed8\u8ba4cluster-admin\u7ba1\u7406\u5458\u96c6\u7fa4\u89d2\u8272",level:3},{value:"7. \u72b6\u6001\u67e5\u770b",id:"7-\u72b6\u6001\u67e5\u770b",level:2},{value:"8. \u90e8\u7f72\u4e1a\u52a1\u670d\u52a1",id:"8-\u90e8\u7f72\u4e1a\u52a1\u670d\u52a1",level:2},{value:"1. \u521b\u5efa\u547d\u540d\u7a7a\u95f4",id:"1-\u521b\u5efa\u547d\u540d\u7a7a\u95f4",level:3},{value:"2. \u7f16\u5199yaml\u6587\u4ef6",id:"2-\u7f16\u5199yaml\u6587\u4ef6",level:3},{value:"3. \u6267\u884c\u90e8\u7f72",id:"3-\u6267\u884c\u90e8\u7f72",level:3},{value:"10. \u5f02\u5e38\u5904\u7406",id:"10-\u5f02\u5e38\u5904\u7406",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u5355Master\u670d\u52a1\u5668\u89c4\u5212\uff1a"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u89d2\u8272"}),(0,t.jsx)(n.th,{children:"IP"}),(0,t.jsx)(n.th,{children:"\u7ec4\u4ef6"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"master"}),(0,t.jsx)(n.td,{children:"192.168.137.101"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"node1"}),(0,t.jsx)(n.td,{children:"192.168.137.102"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"node2"}),(0,t.jsx)(n.td,{children:"192.168.137.103"}),(0,t.jsx)(n.td,{})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"1-\u73af\u5883\u51c6\u5907",children:"1. \u73af\u5883\u51c6\u5907"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5207\u6362\u53ca\u6dfb\u52a0\u5b89\u88c5\u6e90",children:"1. \u5207\u6362\u53ca\u6dfb\u52a0\u5b89\u88c5\u6e90"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5 wget\nyum -y install wget\n\n# \u5907\u4efd\u4e3b\u4ed3\u5e93\nmv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak\n\n# \u5207\u6362\u4e3b\u4ed3\u5e93\nwget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo\n\n# \u8bbe\u7f6eepel\u4ed3\u5e93\nwget -O /etc/yum.repos.d/epel-7.repo https://mirrors.aliyun.com/repo/epel-7.repo\n\n# \u8bbe\u7f6eDocker\u4ed3\u5e93\nwget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n# \u8bbe\u7f6eK8s\u6e90\u4ed3\u5e93\ncat << EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n# \u6e05\u9664\u5e76\u91cd\u5efa\u7f13\u5b58\uff0c\u7981\u6389GPG\u9a8c\u8bc1\u68c0\u67e5\uff0c\u6ca1\u6709\u7b7e\u540d\u7684\u8f6f\u4ef6\u5b89\u88c5\u52a0\u8fd9\u4e2a\u53c2\u6570\nyum clean all && yum makecache fast --nogpgcheck\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u5b89\u88c5\u4f9d\u8d56",children:"2. \u5b89\u88c5\u4f9d\u8d56"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5epel\nyum install -y epel-release\n\n# \u5b89\u88c5\u4f9d\u8d56\nyum install -y \\\n  vim* \\\n  lrzsz \\\n  net-tools \\\n  ifconfig \\\n  yum-utils \\\n  netcat \\\n  ntpdate\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-\u670d\u52a1\u5668\u8bbe\u7f6e",children:"3. \u670d\u52a1\u5668\u8bbe\u7f6e"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5173\u95ed\u9632\u706b\u5899\nsystemctl stop firewalld && systemctl disable firewalld\n\n# \u5173\u95edselinux\n# \u6c38\u4e45\nsed -i 's/enforcing/disabled/' /etc/selinux/config\n# \u4e34\u65f6\nsetenforce 0\n\n# \u5173\u95edswap\n# \u4e34\u65f6\nswapoff -a\n# \u6c38\u4e45\nsed -ri 's/.*swap.*/#&/' /etc/fstab\n# \u68c0\u67e5\uff0c\u786e\u4fddswap\u91cc\u9762\u6ca1\u6709\u4e1c\u897f\nfree -m\n\n# \u6839\u636e\u89c4\u5212\u8bbe\u7f6e\u4e3b\u673a\u540d\nhostnamectl set-hostname <hostname>\n# \u67e5\u770b\u4fee\u6539\u7ed3\u679c\nhostnamectl status\n# \u4fee\u6539hosts\u6587\u4ef6\necho \"127.0.0.1 $(hostname)\" >> /etc/hosts\n\n# \u5728master\u6dfb\u52a0hosts\ncat >> /etc/hosts << EOF\n192.168.137.101 master\n192.168.137.102 node1\nEOF\n\n# \u914d\u7f6e\u6865\u63a5\u6d41\u91cf\ncat << EOF | sudo tee /etc/modules-load.d/k8s.conf\nbr_netfilter\nEOF\n\n# \u5c06\u6865\u63a5\u7684IPv4\u6d41\u91cf\u4f20\u9012\u5230iptables\u7684\u94fe\ncat << EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\n# \u914d\u7f6e\u751f\u6548\nsysctl --system\n\n# \u65f6\u95f4\u540c\u6b65\nntpdate time.windows.com\n\n# \u5173\u673a \u91cd\u542f\nshutdown now \nshutdown -r now\nreboot -n\n"})}),"\n",(0,t.jsx)(n.h2,{id:"2-\u5b89\u88c5dockerkubeadmkubelet",children:"2. \u5b89\u88c5Docker/kubeadm/kubelet"}),"\n",(0,t.jsx)(n.p,{children:"Kubernetes\u9ed8\u8ba4CRI\uff08\u5bb9\u5668\u8fd0\u884c\u65f6\uff09\u4e3aDocker\uff0c\u56e0\u6b64\u5148\u5b89\u88c5Docker\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5b89\u88c5docker",children:"1. \u5b89\u88c5Docker"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/install/centos/",children:"https://docs.docker.com/engine/install/centos/"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# \u914d\u7f6e\u4ed3\u5e93\nsudo yum install -y yum-utils\nsudo yum-config-manager \\\n  --add-repo \\\n  https://download.docker.com/linux/centos/docker-ce.repo\n\n# \u6e05\u9664\u4e4b\u524d\u7684Docker\nsudo yum remove docker \\\n          docker-client \\\n          docker-client-latest \\\n          docker-common \\\n          docker-latest \\\n          docker-latest-logrotate \\\n          docker-logrotate \\\n          docker-engine\n\n# \u67e5\u770bDocker\u7248\u672c\nyum list docker-ce --showduplicates | sort -r\n\n# \u5b89\u88c5Docker\nyum -y install docker-ce-18.06.1.ce-3.el7\n\n# \u542f\u52a8Docker\u5e76\u8bbe\u7f6e\u81ea\u52a8\u91cd\u542f\nsystemctl start docker && systemctl enable docker\n\n# \u914d\u7f6e\u955c\u50cf\u4e0b\u8f7d\u52a0\u901f\u5668\uff1a\ncat > /etc/docker/daemon.json << EOF\n{\n  "registry-mirrors": ["https://rv4ppfhe.mirror.aliyuncs.com"],\n  "exec-opts": ["native.cgroupdriver=systemd"]\n}\nEOF\n\n# \u66f4\u65b0\u914d\u7f6e\u540e\u91cd\u542f\nsystemctl daemon-reload && systemctl restart docker\n\n# \u666e\u901a\u7528\u6237\u64cd\u4f5cDocker\nsudo cat /etc/group | grep docker\n\n# docker\u7528\u6237\u7ec4\u4e0d\u5b58\u5728\u5219\u6dfb\u52a0\u7528\u6237\u7ec4\n# sudo groupadd docker \n\n# \u5c06\u5f53\u524d\u7528\u6237\u6dfb\u52a0\u5230docker\u7ec4\u4e2d\nsudo usermod -aG docker $USER\nsudo usermod -aG dockerroot $USER\n\n# \u5f00\u542fDocker\u8fdc\u7a0b\u8bbf\u95ee\nvim /lib/systemd/system/docker.service\nExecStart=/usr/bin/dockerd -H unix:///var/run/docker.sock -H tcp://0.0.0.0:2375\n\n# \u67e5\u770b2375\u7aef\u53e3\u662f\u5426\u5f00\u542f\nnetstat -nlp | grep docker\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u5b89\u88c5docker-compose",children:"2. \u5b89\u88c5Docker Compose"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"https://docs.docker.com/compose/install/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/install/compose-plugin/",children:"https://docs.docker.com/compose/install/compose-plugin/"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5Docker Compose\nyum install -y docker-compose-plugin\n\n# \u4e0b\u8f7d\ncurl -SL https://github.com/docker/compose/releases/download/v2.7.0/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose\n\n# \u6dfb\u52a0\u6267\u884c\u6743\u9650\nchmod +x /usr/local/bin/docker-compose\n\n# \u94fe\u63a5\nsudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n# \u6d4b\u8bd5\ndocker-compose version\n\n# \u4f20\u8f93\u6587\u4ef6\nscp /usr/local/bin/docker-compose root@192.168.137.102:/usr/local/bin/docker-compose\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-docker-overlay2\u5360\u7528\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\u89e3\u51b3\u529e\u6cd5",children:"3. Docker overlay2\u5360\u7528\u5927\u91cf\u78c1\u76d8\u7a7a\u95f4\u89e3\u51b3\u529e\u6cd5"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u9996\u5148\u627e\u5230overlay2\u76ee\u5f55"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cd /var/lib/docker/overlay2\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770b\u6587\u4ef6\u7684\u5927\u5c0f"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"du -h --max-depth=1 /var/lib/docker/overlay2 | grep [MGT] | sort -nr\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u4e0b\u6240\u793a\uff0c\u627e\u5230\u5927\u5c0f\u4e3a500G\u7684\u6587\u4ef6"}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770b\u5360\u7528\u7a7a\u95f4\u7684pid\uff0c\u4ee5\u53ca\u5bf9\u5e94\u7684\u5bb9\u5668\u540d\u79f0"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker ps -q | xargs docker inspect --format '{{.State.Pid}}, {{.Name}}, {{.GraphDriver.Data.WorkDir}}' | grep \"09151aa1dd70a8884a9f6ab3f31b0b530be8a7a5fb78c25f4f51901440089681\"\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"\u89e3\u51b3\u65b9\u6cd5\uff08\u4f1a\u5220\u9664\u5bf9\u5e94\u7684\u5bb9\u5668\u548c\u5bf9\u5e94\u955c\u50cf\uff09\uff1a"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker stop ainews_processB && docker rm ainews_processB && docker rmi image_id\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-\u5b89\u88c5k8s",children:"4. \u5b89\u88c5K8s"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/getting-started-guides/kubeadm/",children:"https://kubernetes.io/docs/getting-started-guides/kubeadm/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/setup/production-environment/tools/",children:"https://kubernetes.io/docs/setup/production-environment/tools/"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/",children:"https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u7531\u4e8e\u7248\u672c\u66f4\u65b0\u9891\u7e41\uff0c\u8fd9\u91cc\u6307\u5b9a\u7248\u672c\u53f7\u90e8\u7f72\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"kubelet\uff1asystemd\u5b88\u62a4\u8fdb\u7a0b\u7ba1\u7406"}),"\n",(0,t.jsx)(n.li,{children:"kubeadm\uff1a\u90e8\u7f72\u5de5\u5177"}),"\n",(0,t.jsx)(n.li,{children:"kubectl\uff1ak8s\u547d\u4ee4\u884c\u7ba1\u7406\u5de5\u5177"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u68c0\u67e5Master6443\u7aef\u53e3\u5360\u7528\nnc 127.0.0.1 6443\n\n#  \u5378\u8f7d\u65e7\u7248\u672c\nyum remove -y kubelet kubeadm kubectl\n\n# \u67e5\u770bk8s\u7684\u7248\u672c\nyum list kubelet --showduplicates | sort -r \n\n# \u5b89\u88c5K8s\nyum install -y \\\n  kubelet-1.18.0 \\\n  kubeadm-1.18.0 \\\n  kubectl-1.18.0\n\n# \u542f\u52a8kubelet\nsystemctl start kubelet && systemctl enable kubelet\n\n# \u67e5\u770bkubelet\u72b6\u6001\nsystemctl status kubelet\n"})}),"\n",(0,t.jsx)(n.h2,{id:"3-\u521d\u59cb\u5316k8s-master\u8282\u70b9",children:"3. \u521d\u59cb\u5316K8s Master\u8282\u70b9"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5728192168137101master\u6267\u884c\u521d\u59cb\u5316\u547d\u4ee4",children:"1. \u5728192.168.137.101\uff08Master\uff09\u6267\u884c\u521d\u59cb\u5316\u547d\u4ee4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bkubeadm\u9700\u8981\u4e0b\u8f7d\u7684\u955c\u50cf\nkubeadm config images list \n# \u63d0\u524d\u4e0b\u8f7d\u9700\u8981\u7684\u955c\u50cf\n# kubeadm config images pull\n\n# \u6328\u4e2a\u4e0b\u8f7d\u4ee5\u4e0a\u955c\u50cf\uff0c\u7531\u4e8e\u662f\u56fd\u5916\u955c\u50cf\uff0c\u4f7f\u7528\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u4e0b\u8f7d\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.18.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.18.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.18.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.18.0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.3-0\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:1.6.7\n\n# \u56e0\u4e3acoredns\u662f\u5e26\u4e8c\u7ea7\u76ee\u5f55\u7684\uff0c\u6240\u4ee5\u8981\u591a\u6267\u884c\u8fd9\u4e00\u6b65\n# docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.6 registry.cn-hangzhou.aliyuncs.com/google_containers/coredns/coredns:1.6.7\n\n# \u67e5\u770beth0\u7684inet\u79c1\u6709\u7f51\u7edc\u5730\u5740\uff0c\u590d\u5236\u51fa\u6765\u586b\u5165apiserver-advertise-address\nip addr\n\n# \u521d\u59cb\u5316Master\u8282\u70b9\n# image-respository  \u955c\u50cf\u4ed3\u5e93\u7684\u5730\u5740\n# service-cidr pod-network-cidr \u8bbe\u5b9a\u4e24\u4e2a\u5b50\u7f51\u8303\u56f4\uff0c\u4e0d\u80fd\u548capiserver\u51b2\u7a81\nkubeadm init \\\n  --apiserver-advertise-address=192.168.137.101 \\\n  --image-repository registry.aliyuncs.com/google_containers \\\n  --kubernetes-version v1.18.0 \\\n  --service-cidr=10.96.0.0/12 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --ignore-preflight-errors=all\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u6253\u5370\u5982\u4e0b\u4fe1\u606f\u6210\u529f\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'W0823 17:52:46.436675    8256 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]\n[init] Using Kubernetes version: v1.18.0\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using \'kubeadm config images pull\'\n[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[kubelet-start] Starting the kubelet\n[certs] Using certificateDir folder "/etc/kubernetes/pki"\n[certs] Generating "ca" certificate and key\n[certs] Generating "apiserver" certificate and key\n[certs] apiserver serving cert is signed for DNS names [master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 192.168.137.101]\n[certs] Generating "apiserver-kubelet-client" certificate and key\n[certs] Generating "front-proxy-ca" certificate and key\n[certs] Generating "front-proxy-client" certificate and key\n[certs] Generating "etcd/ca" certificate and key\n[certs] Generating "etcd/server" certificate and key\n[certs] etcd/server serving cert is signed for DNS names [master localhost] and IPs [192.168.137.101 127.0.0.1 ::1]\n[certs] Generating "etcd/peer" certificate and key\n[certs] etcd/peer serving cert is signed for DNS names [master localhost] and IPs [192.168.137.101 127.0.0.1 ::1]\n[certs] Generating "etcd/healthcheck-client" certificate and key\n[certs] Generating "apiserver-etcd-client" certificate and key\n[certs] Generating "sa" key and public key\n[kubeconfig] Using kubeconfig folder "/etc/kubernetes"\n[kubeconfig] Writing "admin.conf" kubeconfig file\n[kubeconfig] Writing "kubelet.conf" kubeconfig file\n[kubeconfig] Writing "controller-manager.conf" kubeconfig file\n[kubeconfig] Writing "scheduler.conf" kubeconfig file\n[control-plane] Using manifest folder "/etc/kubernetes/manifests"\n[control-plane] Creating static Pod manifest for "kube-apiserver"\n[control-plane] Creating static Pod manifest for "kube-controller-manager"\nW0823 17:53:10.225513    8256 manifests.go:225] the default kube-apiserver authorization-mode is "Node,RBAC"; using "Node,RBAC"\n[control-plane] Creating static Pod manifest for "kube-scheduler"\nW0823 17:53:10.226495    8256 manifests.go:225] the default kube-apiserver authorization-mode is "Node,RBAC"; using "Node,RBAC"\n[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s\n[apiclient] All control plane components are healthy after 24.503745 seconds\n[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace\n[kubelet] Creating a ConfigMap "kubelet-config-1.18" in namespace kube-system with the configuration for the kubelets in the cluster\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node master as control-plane by adding the label "node-role.kubernetes.io/master=\'\'"\n[mark-control-plane] Marking the node master as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]\n[bootstrap-token] Using token: ftlxtx.pqomr1j82debo3ph\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace\n[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.137.101:6443 --token ftlxtx.pqomr1j82debo3ph \\\n    --discovery-token-ca-cert-hash sha256:6406f96f7b11ef7ed750c4da41ac825a63bca63d8dece634197abc23184371ab\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u666e\u901a\u7528\u6237\u64cd\u4f5ck8s\u6743\u9650",children:"2. \u666e\u901a\u7528\u6237\u64cd\u4f5cK8s\u6743\u9650"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5207\u6362\u5230\u666e\u901a\u7528\u6237\uff0c\u7ed9\u666e\u901a\u7528\u6237\u589e\u52a0\u64cd\u4f5ck8s\u7684\u6743\u9650\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# \u67e5\u770bMaster\u8282\u70b9\u7684\u60c5\u51b5\nkubectl get nodes\n\nNAME     STATUS     ROLES    AGE     VERSION\nmaster   NotReady   master   2m55s   v1.18.0\n\n # \u67e5\u770bkubelet\u65e5\u5fd7\njournalctl -u kubelet\n# \u91cd\u542fkubelet\nsystemctl daemon-reload && systemctl restart kubelet\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-\u6ce8\u518ck8s-node\u8282\u70b9",children:"4. \u6ce8\u518cK8s Node\u8282\u70b9"}),"\n",(0,t.jsx)(n.p,{children:"\u5411\u96c6\u7fa4\u6dfb\u52a0\u65b0\u8282\u70b9\uff0c\u6267\u884c\u5728kubeadm init\u8f93\u51fa\u7684kubeadm join\u547d\u4ee4\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5982\u679cToken\u5931\u6548\uff0c\u91cd\u65b0\u751f\u6210\nkubeadm token create --print-join-command\n\n# \u6ce8\u518c\u4ece\u8282\u70b9\nkubeadm join 192.168.137.101:6443 --token ftlxtx.pqomr1j82debo3ph \\\n    --discovery-token-ca-cert-hash sha256:6406f96f7b11ef7ed750c4da41ac825a63bca63d8dece634197abc23184371ab\n\n# \u67e5\u770b\u96c6\u7fa4\u8282\u70b9\nkubectl get nodes\nNAME     STATUS     ROLES    AGE     VERSION\nmaster   NotReady   master   5m22s   v1.18.0\nnode1    NotReady   <none>   77s     v1.18.0\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'W0823 17:57:30.170836    8459 join.go:346] [preflight] WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.\n[preflight] Running pre-flight checks\n        [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd". Please follow the guide at https://kubernetes.io/docs/setup/cri/\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with \'kubectl -n kube-system get cm kubeadm-config -oyaml\'\n[kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.18" ConfigMap in the kube-system namespace\n[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n[kubelet-start] Starting the kubelet\n[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun \'kubectl get nodes\' on the control-plane to see this node join the cluster.\n'})}),"\n",(0,t.jsx)(n.h2,{id:"5-\u90e8\u7f72\u5bb9\u5668\u7f51\u7edccni",children:"5. \u90e8\u7f72\u5bb9\u5668\u7f51\u7edc\uff08CNI\uff09"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5728master\u8282\u70b9\u90e8\u7f72flannel",children:"1. \u5728Master\u8282\u70b9\u90e8\u7f72flannel"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u4e0b\u8f7dflannel\u542f\u52a8\u6587\u4ef6\nwget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n# \u67e5\u770bPods\u72b6\u6001\nkubectl get pods -A\n\n# \u6267\u884c\u7f51\u7edc\u5b89\u88c5\u914d\u7f6e\nkubectl apply -f kube-flannel.yml\n\n# \u5b89\u88c5\u5b8c\u6210\u540e\u67e5\u8be2\u7f51\u7edc\nkubectl get pods -A\n# kubectl get pods -n kube-system\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5b89\u88c5\u524d\u540e\u6267\u884c\u7ed3\u679c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5\u524d\n[lorch@master ~]$ kubectl get pods -n kube-system\nNAME                             READY   STATUS    RESTARTS   AGE\ncoredns-7ff77c879f-k82td         0/1     Pending   0          5m45s\ncoredns-7ff77c879f-ldvq8         0/1     Pending   0          5m45s\netcd-master                      1/1     Running   0          5m55s\nkube-apiserver-master            1/1     Running   0          5m55s\nkube-controller-manager-master   1/1     Running   0          5m55s\nkube-proxy-565f8                 1/1     Running   0          5m45s\nkube-proxy-hfzcx                 1/1     Running   0          2m\nkube-scheduler-master            1/1     Running   0          5m55s\n\n# \u5b89\u88c5\u540e\nNAMESPACE      NAME                             READY   STATUS    RESTARTS   AGE\nkube-flannel   kube-flannel-ds-lm4rc            1/1     Running   0          2m52s\nkube-flannel   kube-flannel-ds-vg2db            1/1     Running   0          2m52s\nkube-system    coredns-7ff77c879f-k82td         1/1     Running   0          7m43s\nkube-system    coredns-7ff77c879f-ldvq8         1/1     Running   0          7m43s\nkube-system    etcd-master                      1/1     Running   0          7m53s\nkube-system    kube-apiserver-master            1/1     Running   0          7m53s\nkube-system    kube-controller-manager-master   1/1     Running   0          7m53s\nkube-system    kube-proxy-565f8                 1/1     Running   0          7m43s\nkube-system    kube-proxy-hfzcx                 1/1     Running   0          3m58s\nkube-system    kube-scheduler-master            1/1     Running   0          7m53s\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u7ed9\u96c6\u7fa4\u6253tag\u8df3\u8fc7",children:"2. \u7ed9\u96c6\u7fa4\u6253Tag\uff08\u8df3\u8fc7\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl label node k8s-node1 node.kubernetes.io/worker=''\n# k8s-node1\u662f\u8282\u70b9\u7684hostname\n# node.kubernetes.io\u662f\u56fa\u5b9a\u5199\u6cd5\u4e0d\u53ef\u53d8\n# worker\u662f\u7ed9\u8282\u70b9\u52a0\u7684\u6807\u7b7e\n# =''\u65e0\u6240\u8c13\uff0c''\u91cc\u9762\u53ef\u4ee5\u968f\u4fbf\u5199\n\n# \u53bb\u9664\u6807\u7b7e\u91c7\u7528\u547d\u4ee4\nkubectl label node k8s-node1 node.kubernetes.io/worker-\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-\u8bbe\u7f6eipvs\u6a21\u5f0f\u8df3\u8fc7",children:"3. \u8bbe\u7f6eipvs\u6a21\u5f0f\uff08\u8df3\u8fc7\uff09"}),"\n",(0,t.jsx)(n.p,{children:"\u56e0\u4e3alinux\u9ed8\u8ba4\u91c7\u7528\u7684\u662fiptables\u6a21\u5f0f\uff0c\u6027\u80fd\u5f00\u9500\u975e\u5e38\u5927\uff0c\u5f53\u4f60\u96c6\u7fa4\u8282\u70b9\u4e00\u591a\uff0c\u6bcf\u4e2a\u8282\u70b9\u7684kube-proxy\u90fd\u8981\u53bb\u540c\u6b65iptables\uff0c\u53ef\u80fd\u4e00\u5929\u90fd\u540c\u6b65\u4e0d\u5b8c\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# \u67e5\u770bkube-proxy\u9ed8\u8ba4\u7684\u6a21\u5f0f\nkubectl logs -n kube-system kube-proxy-565f8\n\n# \u6253\u5f00\u7f16\u8f91kube-proxy\u7684\u914d\u7f6e\u6587\u4ef6\nkubectl edit cm kube-proxy -n kube-system\n\n# \u627e\u5230\u5982\u4e0b\u914d\u7f6e\uff1a\nipvs:\n   excludeCIDRs: null\n   minSyncPeriod: 0s\n   scheduler: ""\n   strictARP: false\n   syncPeriod: 0s\n   tcpFinTimeout: 0s\n   tcpTimeout: 0s\n   udpTimeout: 0s\nkind: KubeProxyConfiguration\nmetricsBindAddress: ""\nmode: ""\n'})}),"\n",(0,t.jsx)(n.p,{children:"mode\u4e2d\u52a0\u5165ipvs\uff0c\u4fdd\u5b58\u540e\u9000\u51fa\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"4-\u91cd\u542fkube-proxy\u8df3\u8fc7",children:"4. \u91cd\u542fkube-proxy\uff08\u8df3\u8fc7\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u6240\u6709Pods\nkubectl get pod -A -o wide\n\n# \u627e\u5230kube-proxy-565f8 \uff0c\u5220\u9664\u4ed6\uff0c\u4e0d\u7528\u62c5\u5fc3\u4ed6\u4f1a\u81ea\u52a8\u91cd\u542f\uff0c\u914d\u7f6e\u5c31\u751f\u6548\u4e86\uff0c-n\u540e\u9762\u8ddf\u7684\u662f\u4ed6\u7684\u547d\u540d\u7a7a\u95f4\u3002\nkubectl delete pod kube-proxy-565f8 -n kube-system\n\n# \u7b49\u5f85\u91cd\u542f\u540e\u91cd\u65b0\u67e5\u770b\u72b6\u6001\nkubectl get pod -A | grep kube-proxy\n"})}),"\n",(0,t.jsx)(n.h2,{id:"6-\u90e8\u7f72\u5b98\u65b9dashboardui",children:"6. \u90e8\u7f72\u5b98\u65b9Dashboard\uff08UI\uff09"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u90e8\u7f72dashboard",children:"1. \u90e8\u7f72Dashboard"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u4e0b\u8f7d\u5b98\u65b9Dashboard\u6587\u4ef6\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.3/aio/deploy/recommended.yaml\n\n# \u5b89\u88c5\u5b98\u65b9Dashboard\nkubectl apply -f recommended.yaml\n\n# \u67e5\u770bDashboard\u542f\u52a8\u60c5\u51b5\nkubectl get pods -n kubernetes-dashboard\n\nNAME                                         READY   STATUS              RESTARTS   AGE\ndashboard-metrics-scraper-6b4884c9d5-94r7k   0/1     ContainerCreating   0          3s\nkubernetes-dashboard-7f99b75bf4-xgvf6        0/1     ContainerCreating   0          4s\n\n# \u67e5\u770bDashboard\u670d\u52a1\nkubectl get svc -n kubernetes-dashboard\n\nNAME                        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\ndashboard-metrics-scraper   ClusterIP   10.110.248.145   <none>        8000/TCP   15h\nkubernetes-dashboard        ClusterIP   10.96.248.50     <none>        443/TCP    15h\n\n# \u5220\u9664\u73b0\u6709\u7684Dashboard\u670d\u52a1\n# \u8be5\u670d\u52a1\u7684\u7c7b\u578b\u662fClusterIP\uff0c\u4e0d\u4fbf\u4e8e\u6211\u4eec\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff0c\u56e0\u6b64\u9700\u8981\u6539\u6210NodePort\u578b\u7684\nkubectl delete service kubernetes-dashboard -n kubernetes-dashboard\n\n# \u4fee\u6539\u914d\u7f6e\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  # \u589e\u52a0type\u4e3a nodePort\n  type: NodePort\n  ports:\n    - port: 443\n      targetPort: 8443\n      # \u8bbe\u7f6e\u6620\u5c04\u7684\u7aef\u53e3\n      nodePort: 30001\n  selector:\n    k8s-app: kubernetes-dashboard\n\n# \u518d\u6b21\u90e8\u7f72\nkubectl apply -f recommended.yaml\n\n# \u518d\u6b21\u67e5\u770b\u670d\u52a1\nkubectl get svc -n kubernetes-dashboard\n\nNAME                        TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)         AGE\ndashboard-metrics-scraper   ClusterIP   10.110.248.145   <none>        8000/TCP        16h\nkubernetes-dashboard        NodePort    10.96.248.50     <none>        443:30001/TCP   16h\n"})}),"\n",(0,t.jsxs)(n.p,{children:["\u8bbf\u95ee\u5730\u5740\uff1a",(0,t.jsx)(n.a,{href:"http://192.168.137.101:30001",children:"http://192.168.137.101:30001"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get deployment --namespace=kubernetes-dashboard kubernetes-dashboard\n# \u6216\nkubectl describe deployment --namespace=kubernetes-dashboard kubernetes-dashboard\n\n# \u67e5\u770bservice\nkubectl get service --namespace=kubernetes-dashboard kubernetes-dashboard\n\n# \u53e6\u5916\u67e5\u770bpod\u72b6\u6001\nkubectl get pod --namespace=kubernetes-dashboard -o wide | grep dashboard\n\n# \u8f93\u51fa\ndashboard-metrics-scraper-6b4884c9d5-94r7k   1/1     Running   1          14h   10.244.1.4   node1   <none>           <none>\nkubernetes-dashboard-7f99b75bf4-xgvf6        1/1     Running   1          14h   10.244.1.5   node1   <none>           <none>\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u679c\u72b6\u6001\u4e00\u76f4\u662f ContainerCreating, \u4f7f\u7528describe\u67e5\u770b\u5177\u4f53\u8fc7\u7a0b"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'kubectl describe pod --namespace=kubernetes-dashboard\n\n# \u8f93\u51fa\nEvents:\n  Type    Reason     Age        From               Message\n  ----    ------     ----       ----               -------\n  Normal  Scheduled  <unknown>  default-scheduler  Successfully assigned kubernetes-dashboard/kubernetes-dashboard-7b544877d5-cd2b7 to ttg12\n  Normal  Pulling    9m36s      kubelet, ttg12     Pulling image "kubernetesui/dashboard:v2.0.0"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u521b\u5efaserviceaccount\u5e76\u7ed1\u5b9a\u9ed8\u8ba4cluster-admin\u7ba1\u7406\u5458\u96c6\u7fa4\u89d2\u8272",children:"2. \u521b\u5efaServiceAccount\u5e76\u7ed1\u5b9a\u9ed8\u8ba4cluster-admin\u7ba1\u7406\u5458\u96c6\u7fa4\u89d2\u8272\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u7528\u6237\nkubectl create serviceaccount dashboard-admin -n kube-system\n\n# \u7528\u6237\u6388\u6743\nkubectl create clusterrolebinding dashboard-admin --clusterrole=cluster-admin --serviceaccount=kube-system:dashboard-admin\n\n# \u83b7\u53d6\u7528\u6237Token\nkubectl describe secrets -n kube-system $(kubectl -n kube-system get secret | awk '/dashboard-admin/{print $1}')\n\n# \u4f7f\u7528\u8f93\u51fa\u7684Token\u767b\u5f55Dashboard\u3002\n\nName:         dashboard-admin-token-9jtrl\nNamespace:    kube-system\nLabels:       <none>\nAnnotations:  kubernetes.io/service-account.name: dashboard-admin\n              kubernetes.io/service-account.uid: c5ce8850-1c33-41e7-b17d-336bcde4ec6e\n\nType:  kubernetes.io/service-account-token\n\nData\n====\nca.crt:     1025 bytes\nnamespace:  11 bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6Il9HcDhZZmNiVTVHVTZsbDhxY29DNVUybnYzREZxMFUySGpLYmVxWGtyU1EifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tOWp0cmwiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYzVjZTg4NTAtMWMzMy00MWU3LWIxN2QtMzM2YmNkZTRlYzZlIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.dK2ITEiw1hpWWugY5hOoLFF1-AA_9S--pQNjKZ6UiTkKcizZl4AjLyga7iPvBPFxfxBBe0xmfGHrFN0tO7NzY9XEZyXtLfUNSkF1xHwnM-IfyMOA2td2B7hFwA11G5Bl7fP-QSW_g0n8brokh6znQQ5Bbtziaih2ZM-zkyq-BRqMovukXnZW0k2OFyUMzCXV5NmgVrDCr_yg2LbkIYgv_B1uUZpd6A5Ebkxo6CYFxAhXQdUl4doh3Lq0HwuPfe7Pu0vK_1KmdLXQoTNQpwXlBmNh0THA4A0MxlC_VpxUUkrghh0qf3J1-uWo7X2YD41TMfudeTfcfPFewB47yNgyyg\n\n# \u8bfb\u53d6token\n# kubectl get secret -n kube-system | grep admin | awk '{print $1}'\nkubectl describe secret -n kube-system $(kubectl get secret -n kube-system | grep admin | awk '{print $1}')  | grep '^token' | awk '{print $2}'\n\neyJhbGciOiJSUzI1NiIsImtpZCI6Il9HcDhZZmNiVTVHVTZsbDhxY29DNVUybnYzREZxMFUySGpLYmVxWGtyU1EifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4tOWp0cmwiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYzVjZTg4NTAtMWMzMy00MWU3LWIxN2QtMzM2YmNkZTRlYzZlIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmRhc2hib2FyZC1hZG1pbiJ9.dK2ITEiw1hpWWugY5hOoLFF1-AA_9S--pQNjKZ6UiTkKcizZl4AjLyga7iPvBPFxfxBBe0xmfGHrFN0tO7NzY9XEZyXtLfUNSkF1xHwnM-IfyMOA2td2B7hFwA11G5Bl7fP-QSW_g0n8brokh6znQQ5Bbtziaih2ZM-zkyq-BRqMovukXnZW0k2OFyUMzCXV5NmgVrDCr_yg2LbkIYgv_B1uUZpd6A5Ebkxo6CYFxAhXQdUl4doh3Lq0HwuPfe7Pu0vK_1KmdLXQoTNQpwXlBmNh0THA4A0MxlC_VpxUUkrghh0qf3J1-uWo7X2YD41TMfudeTfcfPFewB47yNgyyg\n"})}),"\n",(0,t.jsx)(n.h2,{id:"7-\u72b6\u6001\u67e5\u770b",children:"7. \u72b6\u6001\u67e5\u770b"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770b\u8282\u70b9\u72b6\u6001"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770bpod\u72b6\u6001"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get pod --all-namespaces\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770b\u526f\u672c\u6570"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get deployments --all-namespaces\nkubectl get pod -o wide --all-namespaces\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770bdeployment\u8be6\u7ec6\u4fe1\u606f"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl describe deployments --all-namespaces\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsx)(n.li,{children:"\u67e5\u770b\u96c6\u7fa4\u57fa\u672c\u7ec4\u4ef6\u72b6\u6001"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'kubectl get cs\n\nNAME                 STATUS    MESSAGE             ERROR\nscheduler            Healthy   ok\ncontroller-manager   Healthy   ok\netcd-0               Healthy   {"health":"true"}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"8-\u90e8\u7f72\u4e1a\u52a1\u670d\u52a1",children:"8. \u90e8\u7f72\u4e1a\u52a1\u670d\u52a1"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u521b\u5efa\u547d\u540d\u7a7a\u95f4",children:"1. \u521b\u5efa\u547d\u540d\u7a7a\u95f4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create namespace svc-pd-service\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u7f16\u5199yaml\u6587\u4ef6",children:"2. \u7f16\u5199yaml\u6587\u4ef6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml"})}),"\n",(0,t.jsx)(n.h3,{id:"3-\u6267\u884c\u90e8\u7f72",children:"3. \u6267\u884c\u90e8\u7f72"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u90e8\u7f72\uff0c\u4e0d\u80fd\u91cd\u590d\u4f7f\u7528\nkubectl create -f k8s.yaml\n\n# \u521b\u5efa\u90e8\u7f72\uff0c\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\nkubectl apply -f k8s.yaml\n"})}),"\n",(0,t.jsx)(n.h2,{id:"10-\u5f02\u5e38\u5904\u7406",children:"10. \u5f02\u5e38\u5904\u7406"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"CGroup\u4e0eDocker\u4e0d\u5339\u914d\uff0cCPU\u6838\u5fc3\u6570\u81f3\u5c11\u8981\u4e24\u4e2a\uff0c\u9700\u8981\u5173\u95edSwap\u5206\u533a"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'# \u62a5\u9519\nW0823 17:37:30.758727    2645 configset.go:202] WARNING: kubeadm cannot validate component configs for API groups [kubelet.config.k8s.io kubeproxy.config.k8s.io]\n[init] Using Kubernetes version: v1.18.0\n[preflight] Running pre-flight checks\n        [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd". Please follow the guide at https://kubernetes.io/docs/setup/cri/\nerror execution phase preflight: [preflight] Some fatal errors occurred:\n        [ERROR NumCPU]: the number of available CPUs 1 is less than the required 2\n        [ERROR Swap]: running with swap on is not supported. Please disable swap\n[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`\nTo see the stack trace of this error execute with --v=5 or higher\n\n# \u89e3\u51b3\u65b9\u6848\n\n# \u67e5\u770bdocker\u7684 Cgroup Driver\uff0c\u663e\u793a\u4e3acgroupfs\uff0c\u800ckubelet\u4e3asystemd\nsudo docker info | grep Cgroup \n# \u52a0\u5165 "exec-opts": ["native.cgroupdriver=systemd"]\nvim /etc/docker/daemon.json\n"exec-opts": ["native.cgroupdriver=systemd"]\n\n# \u91cd\u542fDocker\u548cK8s\nsystemctl daemon-reload && systemctl restart docker && systemctl restart kubelet\n'})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var t=s(96540);const r={},o=t.createContext(r);function l(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);