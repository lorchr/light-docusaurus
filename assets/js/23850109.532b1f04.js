"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[45347],{36557:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>t,frontMatter:()=>a,metadata:()=>d,toc:()=>c});var s=r(74848),l=r(28453);const a={},i=void 0,d={id:"shardingsphere/Shardingsphere-Proxy-Install",title:"Shardingsphere-Proxy-Install",description:"\u4e00\u3001Shardingsphere Proxy \u5b89\u88c5 (Docker\u7248)",source:"@site/middleware/shardingsphere/3-Shardingsphere-Proxy-Install.md",sourceDirName:"shardingsphere",slug:"/shardingsphere/Shardingsphere-Proxy-Install",permalink:"/light-docusaurus/middleware/shardingsphere/Shardingsphere-Proxy-Install",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/middleware/shardingsphere/3-Shardingsphere-Proxy-Install.md",tags:[],version:"current",lastUpdatedBy:"Lorchr",lastUpdatedAt:1714193875e3,sidebarPosition:3,frontMatter:{},sidebar:"middleware",previous:{title:"Shardingsphere-Jdbc-ReadWrite-Split",permalink:"/light-docusaurus/middleware/shardingsphere/Shardingsphere-Jdbc-ReadWrite-Split"}},o={},c=[{value:"\u4e00\u3001Shardingsphere Proxy \u5b89\u88c5 (Docker\u7248)",id:"\u4e00shardingsphere-proxy-\u5b89\u88c5-docker\u7248",level:2},{value:"\u4e8c\u3001Shardingsphere Proxy \u5b89\u88c5 (\u4e8c\u8fdb\u5236\u7248)",id:"\u4e8cshardingsphere-proxy-\u5b89\u88c5-\u4e8c\u8fdb\u5236\u7248",level:2},{value:"1. \u524d\u7f6e\u6761\u4ef6",id:"1-\u524d\u7f6e\u6761\u4ef6",level:3},{value:"2. \u5b89\u88c5",id:"2-\u5b89\u88c5",level:3},{value:"\u4e09\u3001\u914d\u7f6e <code>conf/server.yaml</code>",id:"\u4e09\u914d\u7f6e-confserveryaml",level:2},{value:"1. \u914d\u7f6e <code>server.yaml</code> (5.2.1 \u7248\u672c)",id:"1-\u914d\u7f6e-serveryaml-521-\u7248\u672c",level:3},{value:"2. \u914d\u7f6e <code>server.yaml</code> (5.4.1 \u7248\u672c)",id:"2-\u914d\u7f6e-serveryaml-541-\u7248\u672c",level:3},{value:"\u56db\u3001\u914d\u7f6e <code>conf/config-*.yaml</code>",id:"\u56db\u914d\u7f6e-confconfig-yaml",level:2},{value:"1. Mysql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e <code>conf/config-mysql-rws.yaml</code> (5.2.1 \u7248\u672c)",id:"1-mysql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-mysql-rwsyaml-521-\u7248\u672c",level:3},{value:"2. Mysql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e <code>conf/config-mysql-rws.yaml</code> (5.4.1 \u7248\u672c)",id:"2-mysql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-mysql-rwsyaml-541-\u7248\u672c",level:3},{value:"3. Pgsql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e <code>conf/config-pgsql-rws.yaml</code> (5.2.1 \u7248\u672c)",id:"3-pgsql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-pgsql-rwsyaml-521-\u7248\u672c",level:3},{value:"4. Pgsql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e <code>conf/config-pgsql-rws.yaml</code> (5.4.1 \u7248\u672c)",id:"4-pgsql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-pgsql-rwsyaml-541-\u7248\u672c",level:3},{value:"\u4e94\u3001\u6dfb\u52a0Mysql\u9a71\u52a8",id:"\u4e94\u6dfb\u52a0mysql\u9a71\u52a8",level:2},{value:"\u516d\u3001\u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy",id:"\u516d\u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",level:2},{value:"1. \u4f7f\u7528 MySQL \u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy\uff1a",id:"1-\u4f7f\u7528-mysql-\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",level:3},{value:"2. \u4f7f\u7528 PostgreSQL \u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy\uff1a",id:"2-\u4f7f\u7528-postgresql-\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",level:3},{value:"3. \u4f7f\u7528 openGauss \u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy\uff1a",id:"3-\u4f7f\u7528-opengauss-\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",level:3},{value:"\u4e03\u3001Spring Boot\u8fde\u63a5\u4ee3\u7406\u6570\u636e\u6e90",id:"\u4e03spring-boot\u8fde\u63a5\u4ee3\u7406\u6570\u636e\u6e90",level:2},{value:"\u516b\u3001\u603b\u7ed3",id:"\u516b\u603b\u7ed3",level:2},{value:"\u5171\u6027\u95ee\u9898",id:"\u5171\u6027\u95ee\u9898",level:3},{value:"Shardingsphere proxy 5.2.1",id:"shardingsphere-proxy-521",level:3},{value:"Shardingsphere proxy 5.4.1",id:"shardingsphere-proxy-541",level:3},{value:"\u4e5d\u3001\u53c2\u8003\u6587\u6863",id:"\u4e5d\u53c2\u8003\u6587\u6863",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h2,{id:"\u4e00shardingsphere-proxy-\u5b89\u88c5-docker\u7248",children:"\u4e00\u3001Shardingsphere Proxy \u5b89\u88c5 (Docker\u7248)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u4e0b\u8f7d\u955c\u50cf\ndocker pull apache/shardingsphere-proxy:5.2.1\n\n# \u521b\u5efa\u6587\u4ef6\u5939\nmkdir -p //d/docker/shardingsphere-proxy/{conf,data,logs,ext-lib}\n\n# \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6\ndocker run -d --name shardingsphere_proxy_temp --entrypoint=bash apache/shardingsphere-proxy:5.2.1 \\\n&& docker cp shardingsphere_proxy_temp:/opt/shardingsphere-proxy/conf d:/docker/shardingsphere-proxy/ \\\n&& docker rm shardingsphere_proxy_temp\n\n# \u5b89\u88c5Mysql\u9a71\u52a8\nwget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar -O d:/docker/shardingsphere-proxy/ext-lib/mysql-connector-java-8.0.11.jar\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --publish 13307:3307 \\\n  --volume //d/docker/shardingsphere-proxy/ext-lib:/opt/shardingsphere-proxy/ext-lib \\\n  --volume //d/docker/shardingsphere-proxy/conf:/opt/shardingsphere-proxy/conf \\\n  --volume //d/docker/shardingsphere-proxy/logs:/opt/shardingsphere-proxy/logs \\\n  --env PORT=3307 \\\n  --net dev \\\n  --ip 172.18.0.6 \\\n  --restart=on-failure:3 \\\n  --name shardingsphere-proxy \\\n  apache/shardingsphere-proxy:5.2.1\n\ndocker exec -it -u root shardingsphere-proxy /bin/bash\n\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6ce8:"})," \u914d\u7f6e\u6587\u4ef6\u90e8\u5206\u6309\u7167\u540e\u7eed\u7ae0\u8282\u7f16\u5199"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4e8cshardingsphere-proxy-\u5b89\u88c5-\u4e8c\u8fdb\u5236\u7248",children:"\u4e8c\u3001Shardingsphere Proxy \u5b89\u88c5 (\u4e8c\u8fdb\u5236\u7248)"}),"\n",(0,s.jsx)(n.h3,{id:"1-\u524d\u7f6e\u6761\u4ef6",children:"1. \u524d\u7f6e\u6761\u4ef6"}),"\n",(0,s.jsx)(n.p,{children:"\u8fd0\u884c\u9700\u8981Java\u73af\u5883\uff0cJdk\u7248\u672c\u5728 1.8 \u4ee5\u4e0a"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://openjdk.org/projects/jdk8/",children:"Jdk 1.8+"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://jdk.java.net/java-se-ri/8-MR5",children:"Jdk 1.8+"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"2-\u5b89\u88c5",children:"2. \u5b89\u88c5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/startup/bin/",children:"\u4e8c\u8fdb\u5236\u5b89\u88c5"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://shardingsphere.apache.org/document/current/cn/downloads/",children:"\u4e8c\u8fdb\u5236\u5b89\u88c5\u5305\u4e0b\u8f7d"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u4e0b\u8f7d\u5b89\u88c5\u5305\nwget https://dlcdn.apache.org/shardingsphere/5.4.1/apache-shardingsphere-5.4.1-shardingsphere-proxy-bin.tar.gz -O apache-shardingsphere-5.4.1-shardingsphere-proxy-bin.tar.gz\n\n# \u89e3\u538b\ntar -zxvf apache-shardingsphere-5.4.1-shardingsphere-proxy-bin.tar.gz -C /usr/local\nmv apache-shardingsphere-5.4.1-shardingsphere-proxy-bin shardingsphere-proxy\n\n# \u4e0b\u8f7dMysql\u4f9d\u8d56\nmkdir -p /usr/local/shardingsphere-proxy/ext-lib\nwget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar -O /usr/local/shardingsphere-proxy/ext-lib/mysql-connector-java-8.0.11.jar\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u64cd\u4f5c\u6307\u4ee4"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8\n/usr/local/shardingsphere-proxy/bin/start.sh\n\n# \u505c\u6b62\n/usr/local/shardingsphere-proxy/bin/stop.sh\n\n# \u67e5\u770b\u65e5\u5fd7\ntail -f logs/stdout.log\n\n# \u4f7f\u7528 psql \u547d\u4ee4\u884c\u8fde\u63a5\npsql -h 172.21.7.11 -p 3307 -U root -W root -d readwrite_pgsql\n\n# \u67e5\u770b\u6570\u636e\u8868\nSELECT tablename FROM pg_tables WHERE schemaname='public';\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u6ce8:"})," \u914d\u7f6e\u6587\u4ef6\u90e8\u5206\u6309\u7167\u540e\u7eed\u7ae0\u8282\u7f16\u5199"]}),"\n",(0,s.jsxs)(n.h2,{id:"\u4e09\u914d\u7f6e-confserveryaml",children:["\u4e09\u3001\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"conf/server.yaml"})]}),"\n",(0,s.jsx)(n.p,{children:"\u914d\u7f6eShardingSphere-Proxy \u8fd0\u884c\u6a21\u5f0f \u8ba4\u8bc1\u4fe1\u606f\u53ca\u5176\u4ed6\u5c5e\u6027\u7b49"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://shardingsphere.apache.org/document/5.4.1/cn/user-manual/shardingsphere-jdbc/yaml-config/mode/",children:"\u6a21\u5f0f\u914d\u7f6e"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://shardingsphere.apache.org/document/5.4.1/cn/user-manual/shardingsphere-proxy/yaml-config/authority/",children:"\u6743\u9650\u914d\u7f6e"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://shardingsphere.apache.org/document/5.4.1/cn/user-manual/shardingsphere-proxy/yaml-config/props/",children:"\u5c5e\u6027\u914d\u7f6e"})}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"1-\u914d\u7f6e-serveryaml-521-\u7248\u672c",children:["1. \u914d\u7f6e ",(0,s.jsx)(n.code,{children:"server.yaml"})," (5.2.1 \u7248\u672c)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"mode:\n  type: Standalone\n  repository:\n    type: JDBC\n\nrules:\n  - !AUTHORITY\n    users:\n      - root@%:root\n      - sharding@:sharding\n    provider:\n      type: ALL_PRIVILEGES_PERMITTED\n\nprops:\n#  max-connections-size-per-query: 1\n#  kernel-executor-size: 16  # Infinite by default.\n#  proxy-frontend-flush-threshold: 128  # The default value is 128.\n#  proxy-opentracing-enabled: false\n#  proxy-hint-enabled: false\n  sql-show: true\n\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"2-\u914d\u7f6e-serveryaml-541-\u7248\u672c",children:["2. \u914d\u7f6e ",(0,s.jsx)(n.code,{children:"server.yaml"})," (5.4.1 \u7248\u672c)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"mode:\n  type: Standalone\n  repository:\n    type: JDBC\n\nauthority:\n  users:\n    - user: root@%\n      password: root\n    - user: sharding\n      password: sharding\n    - user: postgres\n      password: postgres\n  privilege:\n    type: ALL_PERMITTED\n \nprops:\n#  max-connections-size-per-query: 1\n#  kernel-executor-size: 16  # Infinite by default.\n#  proxy-frontend-flush-threshold: 128  # The default value is 128.\n#  proxy-hint-enabled: false\n  sql-show: on\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"\u56db\u914d\u7f6e-confconfig-yaml",children:["\u56db\u3001\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"conf/config-*.yaml"})]}),"\n",(0,s.jsxs)(n.p,{children:["\u4fee\u6539 ",(0,s.jsx)(n.code,{children:"conf"})," \u76ee\u5f55\u4e0b\u4ee5 ",(0,s.jsx)(n.code,{children:"config-"})," \u524d\u7f00\u5f00\u5934\u7684\u6587\u4ef6\uff0c\u5982\uff1a",(0,s.jsx)(n.code,{children:"conf/config-sharding.yaml"})," \u6587\u4ef6\uff0c\u8fdb\u884c\u5206\u7247\u89c4\u5219\u3001\u8bfb\u5199\u5206\u79bb\u89c4\u5219\u914d\u7f6e\u3002\u914d\u7f6e\u65b9\u5f0f\u8bf7\u53c2\u8003",(0,s.jsx)(n.a,{href:"https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/",children:"\u914d\u7f6e\u624b\u518c"}),"\u3002",(0,s.jsx)(n.code,{children:"config-*.yaml"})," \u6587\u4ef6\u7684 ",(0,s.jsx)(n.code,{children:"*"})," \u90e8\u5206\u53ef\u4ee5\u4efb\u610f\u547d\u540d\u3002 ShardingSphere-Proxy \u652f\u6301\u914d\u7f6e\u591a\u4e2a\u903b\u8f91\u6570\u636e\u6e90\uff0c\u6bcf\u4e2a\u4ee5 ",(0,s.jsx)(n.code,{children:"config-"})," \u524d\u7f00\u547d\u540d\u7684 YAML \u914d\u7f6e\u6587\u4ef6\uff0c\u5373\u4e3a\u4e00\u4e2a\u903b\u8f91\u6570\u636e\u6e90\u3002"]}),"\n",(0,s.jsxs)(n.h3,{id:"1-mysql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-mysql-rwsyaml-521-\u7248\u672c",children:["1. Mysql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"conf/config-mysql-rws.yaml"})," (5.2.1 \u7248\u672c)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"databaseName: readwrite_mysql\n\ndataSources:\n write_ds:\n   url: jdbc:mysql://192.168.3.49:3316/mes_technical?serverTimezone=UTC&useSSL=false&allowPublicKeyRetrieval=true\n   username: root\n   password: admin\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n read_ds_0:\n   url: jdbc:mysql://192.168.3.49:3317/mes_technical?serverTimezone=UTC&useSSL=false&allowPublicKeyRetrieval=true\n   username: root\n   password: admin\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n\nrules:\n- !READWRITE_SPLITTING\n dataSources:\n   readwrite_ds:\n     staticStrategy:\n       writeDataSourceName: write_ds\n       readDataSourceNames:\n         - read_ds_0\n     loadBalancerName: random\n loadBalancers:\n   random:\n     type: RANDOM\n\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"2-mysql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-mysql-rwsyaml-541-\u7248\u672c",children:["2. Mysql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"conf/config-mysql-rws.yaml"})," (5.4.1 \u7248\u672c)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'databaseName: readwrite_mysql\n\ndataSources:\n write_ds:\n   url: jdbc:mysql://192.168.3.49:3316/mes_technical?serverTimezone=UTC&useSSL=false&allowPublicKeyRetrieval=true\n   username: root\n   password: admin\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n read_ds_0:\n   url: jdbc:mysql://192.168.3.49:3317/mes_technical?serverTimezone=UTC&useSSL=false&allowPublicKeyRetrieval=true\n   username: root\n   password: admin\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n\nrules:\n- !READWRITE_SPLITTING\n dataSources:\n   readwrite_ds:\n     writeDataSourceName: write_ds\n     readDataSourceNames:\n       - read_ds_0\n     loadBalancerName: random\n loadBalancers:\n   random:\n     type: RANDOM\n- !SINGLE\n  tables:\n    # MySQL \u98ce\u683c\n    # - ds_0.t_single # \u52a0\u8f7d\u6307\u5b9a\u5355\u8868\n    # - ds_1.*        # \u52a0\u8f7d\u6307\u5b9a\u6570\u636e\u6e90\u4e2d\u7684\u5168\u90e8\u5355\u8868\n    - "*.*"           # \u52a0\u8f7d\u5168\u90e8\u5355\u8868\n\n'})}),"\n",(0,s.jsxs)(n.h3,{id:"3-pgsql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-pgsql-rwsyaml-521-\u7248\u672c",children:["3. Pgsql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"conf/config-pgsql-rws.yaml"})," (5.2.1 \u7248\u672c)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"databaseName: readwrite_pgsql\n\ndataSources:\n primary_ds:\n   url: jdbc:postgresql://192.168.3.49:5433/mes_technical\n   username: postgres\n   password: postgres\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n replica_ds_0:\n   url: jdbc:postgresql://192.168.3.49:5434/mes_technical\n   username: postgres\n   password: postgres\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n\nrules:\n- !READWRITE_SPLITTING\n dataSources:\n   readwrite_ds:\n     staticStrategy:\n       writeDataSourceName: primary_ds\n       readDataSourceNames:\n         - replica_ds_0\n     loadBalancerName: random\n loadBalancers:\n   random:\n     type: RANDOM\n\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"4-pgsql-\u8bfb\u5199\u5206\u79bb\u914d\u7f6e-confconfig-pgsql-rwsyaml-541-\u7248\u672c",children:["4. Pgsql \u8bfb\u5199\u5206\u79bb\u914d\u7f6e ",(0,s.jsx)(n.code,{children:"conf/config-pgsql-rws.yaml"})," (5.4.1 \u7248\u672c)"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'databaseName: readwrite_pgsql\n\ndataSources:\n primary_ds:\n   url: jdbc:postgresql://192.168.3.49:5433/test\n   username: postgres\n   password: postgres\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n replica_ds_0:\n   url: jdbc:postgresql://192.168.3.49:5434/test\n   username: postgres\n   password: postgres\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n replica_ds_1:\n   url: jdbc:postgresql://192.168.3.34:5432/test\n   username: postgres\n   password: postgres\n   connectionTimeoutMilliseconds: 30000\n   idleTimeoutMilliseconds: 60000\n   maxLifetimeMilliseconds: 1800000\n   maxPoolSize: 50\n   minPoolSize: 1\n\nrules:\n- !READWRITE_SPLITTING\n dataSources:\n   readwrite_ds:\n     writeDataSourceName: primary_ds\n     readDataSourceNames:\n       - replica_ds_0\n       - replica_ds_1\n     loadBalancerName: random\n loadBalancers:\n   random:\n     type: RANDOM\n- !SINGLE\n  tables:\n    # PostgreSQL \u98ce\u683c\n    # - ds_1.public.t_single  # \u52a0\u8f7d\u6307\u5b9a\u5355\u8868\n    # - ds_2.public.*         # \u52a0\u8f7d\u6307\u5b9aschema\u4e2d\u7684\u5168\u90e8\u5355\u8868\n    # - ds_3.*.*              # \u52a0\u8f7d\u6240\u6709schema\u4e0b\u7684\u6240\u6709\u8868\n    - "*.*.*"                 # \u52a0\u8f7d\u5168\u90e8\u5355\u8868\n'})}),"\n",(0,s.jsx)(n.h2,{id:"\u4e94\u6dfb\u52a0mysql\u9a71\u52a8",children:"\u4e94\u3001\u6dfb\u52a0Mysql\u9a71\u52a8"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u540e\u7aef\u8fde\u63a5 ",(0,s.jsx)(n.code,{children:"PostgreSQL"})," \u6216 ",(0,s.jsx)(n.code,{children:"openGauss"})," \u6570\u636e\u5e93\uff0c\u4e0d\u9700\u8981\u5f15\u5165\u989d\u5916\u4f9d\u8d56\u3002"]}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u540e\u7aef\u8fde\u63a5 ",(0,s.jsx)(n.code,{children:"MySQL"})," \u6570\u636e\u5e93\uff0c\u8bf7\u4e0b\u8f7d ",(0,s.jsx)(n.a,{href:"https://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.49/mysql-connector-java-5.1.49.jar",children:"mysql-connector-java-5.1.49.jar"})," \u6216\u8005 ",(0,s.jsx)(n.a,{href:"https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar",children:"mysql-connector-java-8.0.11.jar"}),"\uff0c\u5e76\u5c06\u5176\u653e\u5165 ",(0,s.jsx)(n.code,{children:"ext-lib"})," \u76ee\u5f55\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u516d\u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",children:"\u516d\u3001\u4f7f\u7528\u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy"}),"\n",(0,s.jsxs)(n.p,{children:["\u6267\u884c ",(0,s.jsx)(n.code,{children:"MySQL"})," / ",(0,s.jsx)(n.code,{children:"PostgreSQL"})," / ",(0,s.jsx)(n.code,{children:"openGauss"})," \u7684\u5ba2\u6237\u7aef\u547d\u4ee4\u76f4\u63a5\u64cd\u4f5c ",(0,s.jsx)(n.code,{children:"ShardingSphere-Proxy"})," \u5373\u53ef\u3002"]}),"\n",(0,s.jsx)(n.h3,{id:"1-\u4f7f\u7528-mysql-\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",children:"1. \u4f7f\u7528 MySQL \u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root mysql-master /bin/bash\n\nmysql -h 172.18.0.6 -P 3307 -u root -p root -D readwrite_mysql\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-\u4f7f\u7528-postgresql-\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",children:"2. \u4f7f\u7528 PostgreSQL \u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root postgres-master /bin/bash\n\npsql -h 172.18.0.6 -p 3307 -U root -W root -d readwrite_pgsql\n\n# \u67e5\u770b\u6570\u636e\u5e93\u5217\u8868\nSELECT datname FROM pg_database;\n\n# \u67e5\u770b\u6570\u636e\u8868\u5217\u8868\nSELECT tablename FROM pg_tables WHERE schemaname='public';\n\n\\x on;\nSELECT * FROM pg_tablespace;\nSELECT * FROM pg_namespace;\n\\x off;\n\n# \u6d4b\u8bd5\ncreate table t1(id int);\ninsert into t1 values(1);\nselect * from t1;\ndrop table t1;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-\u4f7f\u7528-opengauss-\u5ba2\u6237\u7aef\u8fde\u63a5-shardingsphere-proxy",children:"3. \u4f7f\u7528 openGauss \u5ba2\u6237\u7aef\u8fde\u63a5 ShardingSphere-Proxy\uff1a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"gsql -r -h 172.18.0.6 -p 3307 -U root -W root\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u4e03spring-boot\u8fde\u63a5\u4ee3\u7406\u6570\u636e\u6e90",children:"\u4e03\u3001Spring Boot\u8fde\u63a5\u4ee3\u7406\u6570\u636e\u6e90"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  # \u4ee3\u7406\u7684\u662fPgsql\u65f6\uff0c\u6570\u636e\u5e93\u9a71\u52a8 \u8fde\u63a5URL\u5747\u9700\u8981\u6309\u7167Pgsql\u6765\u586b\u5199\n  # Host/port: \u586b\u5199 shardingsphere-proxy \u7684IP \u7aef\u53e3\n  # database: \u586b\u5199 shardingsphere-proxy config-*.yaml \u4e2d\u914d\u7f6e\u7684\u865a\u62df\u6570\u636e\u5e93\u540d\u79f0\n  # username/password: \u586b\u5199 shardingsphere-proxy server.yaml \u4e2d\u914d\u7f6e\u7684\u7528\u6237\u540d\u5bc6\u7801\n  datasource:\n    driver-class-name: org.postgresql.Driver\n    url: jdbc:postgresql://localhost:13307/readwrite_pgsql\n    username: root\n    password: root\n\n---\n\nspring:\n  # \u4ee3\u7406\u7684\u662fMysql\u65f6\uff0c\u6570\u636e\u5e93\u9a71\u52a8 \u8fde\u63a5URL\u5747\u9700\u8981\u6309\u7167Mysql\u6765\u586b\u5199\n  # Host/port: \u586b\u5199 shardingsphere-proxy \u7684IP \u7aef\u53e3\n  # database: \u586b\u5199 shardingsphere-proxy config-*.yaml \u4e2d\u914d\u7f6e\u7684\u865a\u62df\u6570\u636e\u5e93\u540d\u79f0\n  # username/password: \u586b\u5199 shardingsphere-proxy server.yaml \u4e2d\u914d\u7f6e\u7684\u7528\u6237\u540d\u5bc6\u7801\n  datasource:\n   driver-class-name: com.mysql.jdbc.Driver\n   url: jdbc:mysql://localhost:3307/readwrite_mysql\n   username: root\n   password: root\n\n"})}),"\n",(0,s.jsx)(n.h2,{id:"\u516b\u603b\u7ed3",children:"\u516b\u3001\u603b\u7ed3"}),"\n",(0,s.jsx)(n.p,{children:"\u56e0\u4e3a\u57285.2.1 \u4e4b\u524d\u548c\u4e4b\u540e\u5b58\u5728\u8f83\u5927\u7684\u7834\u574f\u6027\u66f4\u65b0\uff0c\u6240\u4ee5\u4e24\u90e8\u5206\u914d\u7f6e\u5b58\u5728\u8f83\u5927\u7684\u5dee\u5f02\u548c\u4e0d\u517c\u5bb9\u60c5\u51b5"}),"\n",(0,s.jsx)(n.h3,{id:"\u5171\u6027\u95ee\u9898",children:"\u5171\u6027\u95ee\u9898"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u591a\u6570\u636e\u5e93\u4ee3\u7406\u95ee\u9898\uff08\u9488\u5bf9\u8bfb\u5199\u5206\u79bb\uff09"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4e0d\u517c\u5bb9\u540c\u65f6\u4ee3\u7406 Mysql \u548c Pgsql\u3002\u9700\u8981\u642d\u5efa\u4e24\u4e2a Shardingsphere proxy\uff0c\u5206\u522b\u6765\u4ee3\u7406 Mysql \u548c Pgsql"}),"\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8e\u591a\u79df\u6237\u6bcf\u4e2a\u79df\u6237\u9700\u8981\u5355\u72ec\u4e00\u4efd\u914d\u7f6e\u6587\u4ef6\uff0c\u5982: ",(0,s.jsx)(n.code,{children:"config-tenant1.yaml"})," ",(0,s.jsx)(n.code,{children:"config-tenant2.yaml"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"config-tenant1.yaml"})," \u914d\u7f6e ",(0,s.jsx)(n.code,{children:"tenant1"})," \u7684\u6570\u636e\u6e90 ",(0,s.jsx)(n.code,{children:"tenant1_write"})," ",(0,s.jsx)(n.code,{children:"tenant1_read1"})," ",(0,s.jsx)(n.code,{children:"tenant1_read2"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"config-tenant2.yaml"})," \u914d\u7f6e ",(0,s.jsx)(n.code,{children:"tenant2"})," \u7684\u6570\u636e\u6e90 ",(0,s.jsx)(n.code,{children:"tenant2_write"})," ",(0,s.jsx)(n.code,{children:"tenant2_read1"})," ",(0,s.jsx)(n.code,{children:"tenant2_read2"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5bf9\u4e8e bool \u503c\u7684\u5904\u7406 Mysql \u4e0e Pgsql \u8868\u73b0\u4e0d\u4e00\u81f4"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5efa\u8bae\u4f7f\u7528\u5b57\u7b26\u4e32\u6216\u8005\u6570\u5b57\u6765\u5b58\u50a8\u5e03\u5c14\u503c"}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"True"}),(0,s.jsx)(n.th,{children:"False"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Mysql"}),(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Pgsql"}),(0,s.jsx)(n.td,{children:"t"}),(0,s.jsx)(n.td,{children:"f"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"shardingsphere-proxy-521",children:"Shardingsphere proxy 5.2.1"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5bf9 ",(0,s.jsx)(n.code,{children:"json"})," ",(0,s.jsx)(n.code,{children:"jsonb"})," \u7c7b\u578b\u7684\u5c5e\u6027\u652f\u6301\u4e0d\u597d","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"text"})," \u5927\u6587\u672c\u683c\u5f0f\uff0c\u53ef\u4ee5\u540c\u65f6\u907f\u514d\u5728\u4e0d\u540c\u6570\u636e\u5e93\u4e4b\u95f4\u7684\u517c\u5bb9\u6027\u95ee\u9898"]}),"\n",(0,s.jsxs)(n.li,{children:["\u5bf9\u4e8e\u7c7b\u578b ",(0,s.jsx)(n.code,{children:"TypeHandler"})," \u76f4\u63a5\u4f7f\u7528 MybatisPlus \u63d0\u4f9b\u7684 ",(0,s.jsx)(n.code,{children:"JacksonTypeHandler"})," ",(0,s.jsx)(n.code,{children:"FastjsonTypeHandler"})," ",(0,s.jsx)(n.code,{children:"GsonTypeHandler"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"shardingsphere-proxy-541",children:"Shardingsphere proxy 5.4.1"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4e0d\u652f\u6301\u7cfb\u7edf\u8868\u7684\u67e5\u8be2\uff0c\u5982 ",(0,s.jsx)(n.code,{children:"pg_namespace"})," ",(0,s.jsx)(n.code,{children:"pg_tablespace"})," \u7b49","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u76ee\u524d\u6d4b\u8bd5\u4ec5\u53ef\u4ee5\u4f7f\u7528 ",(0,s.jsx)(n.code,{children:"psql"})," \u547d\u4ee4\u884c\u7684\u65b9\u5f0f\u67e5\u8be2\u4ee3\u7406\u7684\u6570\u636e\u5e93\u8868\uff0c\u7cfb\u7edf\u8868\u67e5\u8be2\u62a5\u9519 ",(0,s.jsx)(n.code,{children:"Table or view 'pg_namespace' does not exists"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u57fa\u672c\u5904\u4e8e\u4e0d\u53ef\u7528\u7684\u72b6\u6001\uff0c\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528 5.2.1 \u7248\u672c ",(0,s.jsx)(n.a,{href:"https://github.com/apache/shardingsphere/issues/29387",children:"issue#29387"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u4e5d\u53c2\u8003\u6587\u6863",children:"\u4e5d\u3001\u53c2\u8003\u6587\u6863"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.51cto.com/u_12897/8329842",children:"SQL Server \u8bfb\u5199\u5206\u79bb"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.51cto.com/u_15101584/2623066",children:"oracle\u7684\u8bfb\u5199\u5206\u79bb\u5b9e\u73b0"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/zh-cn/sql/relational-databases/replication/configure-distribution?view=sql-server-ver16",children:"SQL Server \u914d\u7f6e\u5206\u53d1"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.csdn.net/weixin_47308871/article/details/126134314",children:"\u3010ShardingSphere-proxy +PostgreSQL\u5b9e\u73b0\u8bfb\u5199\u5206\u79bb\uff08\u9759\u6001\u7b56\u7565\uff09\u3011"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.csdn.net/apple_csdn/article/details/124454743",children:"\u3010Sharding Sphere\u3001Spring Boot\u3011Spring Boot\u6574\u5408Sharding Sphere Proxy\uff085.0.0\uff09"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.csdn.net/qq_32681589/article/details/134651667",children:"\u3010ShardingSphere\u4e13\u9898\u3011SpringBoot\u6574\u5408ShardingSphere\uff08\u4e00\u3001\u6570\u636e\u5206\u7247\u5165\u95e8\u53ca\u5b9e\u9a8c\uff09"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://blog.51cto.com/u_13171517/6596021",children:"shardingsphere-proxy \u5b9e\u73b0postgresql\u7684\u5206\u5e93\u5206\u8868"})}),"\n"]}),"\n"]})]})}function t(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>d});var s=r(96540);const l={},a=s.createContext(l);function i(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);