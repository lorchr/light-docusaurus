"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[48259],{3891:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/\u670d\u52a1\u5668\u6307\u6807-9a929449b1d9ca812747eb39c2185596.png"},4152:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort8-17423865f3633a51bd83aa50e2096db7.png"},4523:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort3-11cd4d2a95705cc91b1d01a5d8737037.png"},5911:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/prometheusWebUI-d1e1b884aa7c472dbd5dee9b523ef215.png"},6587:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Grafana\u6dfb\u52a0AlertManager\u6570\u636e\u6e90-06ac937875cd895fd344f073e12277f3.png"},12428:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot6-1b67d45d7826580f96f3b786f60ccccc.png"},14549:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Local1-063adfa69d6add7c712c8d636964479f.png"},22352:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/\u670d\u52a1\u5668\u76d1\u63a7\u6548\u679c\u5c55\u793a-8b94114c5b16f1ed2a173f4f6cfed6f5.png"},22735:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/\u5bfc\u5165\u65f6\u9700\u8981\u9009\u62e9\u6570\u636e\u6e90-88716082c5947662fe78fb7f82a926c4.png"},23465:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/architecture-07dae0368284dbd148521906c003ca15.svg"},24053:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot7-f9501fcda0bdfe173b691f0f776dec2d.png"},25281:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort9-b1c855deacbe684d8ef7347cdea7f45b.png"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>i});var s=r(96540);const o={},t=s.createContext(o);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(t.Provider,{value:n},e.children)}},29103:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort7-87d45ca866417948b44d2c21e67200d7.png"},31889:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot3-37358c833bc26a6a6f801d5e5226d34b.png"},34149:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"zh-cn/others/Prometheus-Grafana-System-Monitor","title":"\u76f8\u5173\u94fe\u63a5","description":"- Prometheus \u5b98\u7f51\u6587\u6863","source":"@site/docs/zh-cn/others/5-Prometheus-Grafana-System-Monitor.md","sourceDirName":"zh-cn/others","slug":"/zh-cn/others/Prometheus-Grafana-System-Monitor","permalink":"/docs/zh-cn/others/Prometheus-Grafana-System-Monitor","draft":false,"unlisted":false,"editUrl":"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/others/5-Prometheus-Grafana-System-Monitor.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"troch","previous":{"title":"LPG-Log-Collect","permalink":"/docs/zh-cn/others/LPG-Log-Collect"},"next":{"title":"\u4ecb\u7ecd","permalink":"/docs/zh-cn/others/Loki-Promtail-Prometheus-Grafana-Implement-System-Monitor-And-log-Collect"}}');var o=r(74848),t=r(28453);const a={},i="\u76f8\u5173\u94fe\u63a5",c={},h=[{value:"\u4e0b\u8f7d\u5b89\u88c5\u5305",id:"\u4e0b\u8f7d\u5b89\u88c5\u5305",level:2},{value:"\u5b89\u88c5 Prometheus",id:"\u5b89\u88c5-prometheus",level:2},{value:"\u5b89\u88c5 AlertManager",id:"\u5b89\u88c5-alertmanager",level:2},{value:"\u5b89\u88c5 Node Exporter",id:"\u5b89\u88c5-node-exporter",level:2},{value:"\u8bbf\u95ee\u6d4b\u8bd5",id:"\u8bbf\u95ee\u6d4b\u8bd5",level:2},{value:"\u4e0b\u8f7d\u955c\u50cf",id:"\u4e0b\u8f7d\u955c\u50cf",level:2},{value:"\u521d\u59cb\u5316\u914d\u7f6e",id:"\u521d\u59cb\u5316\u914d\u7f6e",level:2},{value:"\u90e8\u7f72Prometheus Grafana",id:"\u90e8\u7f72prometheus-grafana",level:2},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:2},{value:"\u6dfb\u52a0Prometheus Chart\u5230Helm",id:"\u6dfb\u52a0prometheus-chart\u5230helm",level:2},{value:"\u5b89\u88c5Prometheus Operator",id:"\u5b89\u88c5prometheus-operator",level:2},{value:"\u68c0\u67e5Prometheus Operator\u72b6\u6001",id:"\u68c0\u67e5prometheus-operator\u72b6\u6001",level:2},{value:"\u8bbf\u95eePrometheus \u548c Grafana Dashboards",id:"\u8bbf\u95eeprometheus-\u548c-grafana-dashboards",level:2},{value:"\u4e34\u65f6\u65b9\u6848\uff0cK8s \u7aef\u53e3\u8f6c\u53d1",id:"\u4e34\u65f6\u65b9\u6848k8s-\u7aef\u53e3\u8f6c\u53d1",level:3},{value:"\u4f7f\u7528 NodePort \u66b4\u9732\u670d\u52a1",id:"\u4f7f\u7528-nodeport-\u66b4\u9732\u670d\u52a1",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5-1",level:2},{value:"\u76f8\u5173\u670d\u52a1 \u8d44\u6e90\u7684\u89e3\u6790",id:"\u76f8\u5173\u670d\u52a1-\u8d44\u6e90\u7684\u89e3\u6790",level:2},{value:"statefulset\uff0cdeployment\uff0cdaemonset",id:"statefulsetdeploymentdaemonset",level:3},{value:"configmap, secret",id:"configmap-secret",level:3},{value:"CRDs",id:"crds",level:3},{value:"\u67e5\u770bPrometheus\u914d\u7f6e",id:"\u67e5\u770bprometheus\u914d\u7f6e",level:2},{value:"\u5b89\u88c5Prometheus + Grafana",id:"\u5b89\u88c5prometheus--grafana",level:2},{value:"Spring Boot\u9879\u76ee\u4fee\u6539",id:"spring-boot\u9879\u76ee\u4fee\u6539",level:2},{value:"\u6dfb\u52a0\u4f9d\u8d56",id:"\u6dfb\u52a0\u4f9d\u8d56",level:3},{value:"\u4fee\u6539 <code>application.yaml</code> \u4e2d\u6dfb\u52a0 Spring Boot Actuator \u76f8\u5173\u914d\u7f6e",id:"\u4fee\u6539-applicationyaml-\u4e2d\u6dfb\u52a0-spring-boot-actuator-\u76f8\u5173\u914d\u7f6e",level:3},{value:"\u901a\u8fc7 <code>/actuator/prometheus</code> \u6d4b\u8bd5\u914d\u7f6e\u662f\u5426\u6b63\u786e\uff1a",id:"\u901a\u8fc7-actuatorprometheus-\u6d4b\u8bd5\u914d\u7f6e\u662f\u5426\u6b63\u786e",level:3},{value:"K8s \u90e8\u7f72\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\uff0c\u4e3b\u8981\u662f <code>Service</code> \u548c <code>Deployment</code> \u4e2d\u6807\u7b7e\u7684\u5bf9\u5e94",id:"k8s-\u90e8\u7f72\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u4e3b\u8981\u662f-service-\u548c-deployment-\u4e2d\u6807\u7b7e\u7684\u5bf9\u5e94",level:3},{value:"\u6784\u5efa\u5bb9\u5668\u955c\u50cf\u5e76\u90e8\u7f72\u5230K8s",id:"\u6784\u5efa\u5bb9\u5668\u955c\u50cf\u5e76\u90e8\u7f72\u5230k8s",level:3},{value:"Prometheus\u914d\u7f6e\u4fee\u6539",id:"prometheus\u914d\u7f6e\u4fee\u6539",level:2},{value:"\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\uff08\u9488\u5bf9\u624b\u52a8\u6620\u5c04\u914d\u7f6e\u5230\u5bb9\u5668\u573a\u666f\uff09",id:"\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u9488\u5bf9\u624b\u52a8\u6620\u5c04\u914d\u7f6e\u5230\u5bb9\u5668\u573a\u666f",level:3},{value:"K8s\u90e8\u7f72\u6587\u4ef6\u4fee\u6539\uff08\u9488\u5bf9Prometheus Operator\u90e8\u7f72\u7684\u573a\u666f\uff09",id:"k8s\u90e8\u7f72\u6587\u4ef6\u4fee\u6539\u9488\u5bf9prometheus-operator\u90e8\u7f72\u7684\u573a\u666f",level:3},{value:"ServiceMonitor\u4e2d\u7684 <code>metadata.labels.realease: prometheus</code> \u8bf4\u660e",id:"servicemonitor\u4e2d\u7684-metadatalabelsrealease-prometheus-\u8bf4\u660e",level:3},{value:"\u67e5\u770bServiceMonitor",id:"\u67e5\u770bservicemonitor",level:4},{value:"\u67e5\u770bServiceMonitor\u8be6\u7ec6\u4fe1\u606f",id:"\u67e5\u770bservicemonitor\u8be6\u7ec6\u4fe1\u606f",level:4},{value:"\u67e5\u770bCRD",id:"\u67e5\u770bcrd",level:4},{value:"\u67e5\u770bCRD\u8be6\u7ec6\u4fe1\u606f",id:"\u67e5\u770bcrd\u8be6\u7ec6\u4fe1\u606f",level:4},{value:"\u672c\u5730\u90e8\u7f72 Spring Boot Jar\u5305",id:"\u672c\u5730\u90e8\u7f72-spring-boot-jar\u5305",level:2},{value:"\u4f7f\u7528Prometheus Operator\u914d\u7f6e\u91c7\u96c6\u672c\u5730\u670d\u52a1\u6307\u6807",id:"\u4f7f\u7528prometheus-operator\u914d\u7f6e\u91c7\u96c6\u672c\u5730\u670d\u52a1\u6307\u6807",level:2},{value:"\u521b\u5efaK8s\u90e8\u7f72\u8d44\u6e90\u6587\u4ef6",id:"\u521b\u5efak8s\u90e8\u7f72\u8d44\u6e90\u6587\u4ef6",level:3},{value:"\u90e8\u7f72\u8d44\u6e90\u670d\u52a1",id:"\u90e8\u7f72\u8d44\u6e90\u670d\u52a1",level:3},{value:"\u8bbf\u95ee\u9875\u9762",id:"\u8bbf\u95ee\u9875\u9762",level:3},{value:"Prometheus Service Discovery \u4e2d\u663e\u793a\u76ee\u6807\u670d\u52a1\u7684\u68c0\u6d4b\u6307\u6807\u6570\u636e\u88ab\u5220\u9664 \u3010dropped due to relabeling rules\u3011",id:"prometheus-service-discovery-\u4e2d\u663e\u793a\u76ee\u6807\u670d\u52a1\u7684\u68c0\u6d4b\u6307\u6807\u6570\u636e\u88ab\u5220\u9664-dropped-due-to-relabeling-rules",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"\u76f8\u5173\u94fe\u63a5",children:"\u76f8\u5173\u94fe\u63a5"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://prometheus.io/docs/introduction/overview/",children:"Prometheus \u5b98\u7f51\u6587\u6863"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://prometheus.io/download/",children:"Prometheus \u4e0b\u8f7d"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://prometheus.io/docs/prometheus/latest/querying/examples/",children:"PromQL \u5b66\u4e60"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://prometheus-operator.dev/",children:"Prometheus Operator \u6587\u6863"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://github.com/prometheus-operator/prometheus-operator",children:"Prometheus Operator Github"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://prometheus.io/docs/instrumenting/exporters/",children:"Prometheus \u793e\u533aExporter\u7ec4\u4ef6"})}),"\n"]}),"\n",(0,o.jsx)(n.li,{}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards",children:"Grafana\u5b98\u65b9\u76d1\u63a7\u9762\u677f"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/1860-node-exporter-full/",children:"\u76d1\u63a7\u9762\u677f-\u670d\u52a1\u5668\u8282\u70b9\u4fe1\u606f"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/6417-kubernetes-cluster-prometheus/",children:"\u76d1\u63a7\u9762\u677f-K8s\u96c6\u7fa4"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/8171-kubernetes-nodes/",children:"\u76d1\u63a7\u9762\u677f-K8s\u8282\u70b9"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/15759-kubernetes-views-nodes/",children:"\u76d1\u63a7\u9762\u677f-\u8282\u70b9\u89c6\u56fe\u7684K8s\u96c6\u7fa4"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/12856-jvm-micrometer/",children:"\u76d1\u63a7\u9762\u677f-JVM\u76d1\u63a7\u5927\u76d8"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/10280-microservices-spring-boot-2-1/",children:"\u76d1\u63a7\u9762\u677f-Spring Boot 2.x\u5e94\u7528"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/19004-spring-boot-statistics/",children:"\u76d1\u63a7\u9762\u677f-Spring Boot 3.x\u5e94\u7528"})}),"\n"]}),"\n",(0,o.jsx)(n.li,{}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://developer.aliyun.com/article/935461",children:"\u4f7f\u7528 Docker \u90e8\u7f72 Prometheus + Grafana \u76d1\u63a7\u5e73\u53f0"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://blog.csdn.net/yygabcd/article/details/147677521",children:"\u3010\u4f7f\u7528docker-compose\u65b9\u5f0f\u90e8\u7f72Prometheus+Grafana\u3011"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://juejin.cn/post/7354929098099146764",children:"\u3010Monitoring\u3011Prometheus\u5de5\u4f5c\u539f\u7406\u4ee5\u53caPrometheus\u67b6\u6784\u4ecb\u7ecd"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.jianshu.com/p/ce1e90dbd5ba",children:"\u3010k8s\u5b66\u4e60\u3011Kubernetes Operator\u7b80\u5355\u4ecb\u7ecd"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://juejin.cn/post/7356906581780742185",children:"\u3010Monitoring\u3011\u4f7f\u7528Helm\u548cPrometheus Operator\u5728Kubernetes\u4e2d\u5b89\u88c5Prometheus"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://juejin.cn/post/7357144204243976233",children:"\u3010Monitoring\u3011\u5728Kubernetes\u4e2dSpring Boot\u96c6\u6210Prometheus\u548cGrafana"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://developer.aliyun.com/article/836300",children:"\u4f7f\u7528 Prometheus + Grafana \u76d1\u63a7 k8s \u4e0a\u7684 Spring Boot \u5e94\u7528"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://blog.csdn.net/weixin_46619605/article/details/147603418",children:"Spring Boot \xd7 K8s \u76d1\u63a7\u5b9e\u6218-\u96c6\u6210 Prometheus \u4e0e Grafana"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://juejin.cn/post/7326355171901554723",children:"\u5982\u4f55\u4f7f\u7528 Helm \u5728 K8s \u4e0a\u96c6\u6210 Prometheus \u548c Grafana\uff5cPart 3"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.imooc.com/article/371443",children:"Prometheus\u5982\u4f55\u4e0eSpring Boot\u96c6\u6210\u5b9e\u73b0\u76d1\u63a7\u3001\u544a\u8b66\u548c\u65e5\u5fd7\u529f\u80fd"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.a,{href:"https://www.cnblogs.com/wxwbblog/p/18185045",children:"\u90e8\u7f72Prometheus Operator\u5b8c\u6574\u6d41\u7a0b\u53ca\u8e29\u5751\u89e3\u51b3\u601d\u8def"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h1,{id:"\u6574\u4f53\u67b6\u6784",children:"\u6574\u4f53\u67b6\u6784"}),"\n",(0,o.jsx)(n.p,{children:"Prometheus\u662f\u4e00\u6b3e\u7528\u6765\u505a\u76d1\u63a7\u548c\u9884\u8b66\u7684\u5f00\u6e90\u7684\u9879\u76ee\uff0c\u6700\u65e9\u662fSoundCloud\u516c\u53f8\u7684\u9879\u76ee\uff0c\u59cb\u4e8e2012\u5e74\u3002Prometheus\u4e0d\u4ec5\u53ef\u4ee5\u5de5\u4f5c\u5728\u4f20\u7edf\u7684\u6a21\u5f0f\u4e0a\uff08\u5373\u90e8\u7f72\u5728\u670d\u52a1\u5668\uff09\uff0c\u4e5f\u53ef\u4ee5\u5de5\u4f5c\u5728\u5bb9\u5668\u5e94\u7528\u4e2d\uff0c\u5982Kubernetes\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u4e0b\u9762\u662f\u5b98\u65b9\u53d1\u5e03\u7684\u7cfb\u7edf\u67b6\u6784\u56fe"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"\u7cfb\u7edf\u67b6\u6784",src:r(23465).A+"",width:"1351",height:"811"})}),"\n",(0,o.jsx)(n.p,{children:"\u4ece\u67b6\u6784\u56fe\u53ef\u4ee5\u770b\u51fa\uff0cPrometheus Server\u4e3b\u8981\u7531\u4e09\u4e2a\u90e8\u5206\u7ec4\u6210\uff1a"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"\u6570\u636e\u7684\u62c9\u53d6\uff08Retrieval\uff09"}),"\uff1a\u4ece\u5e94\u7528\u4e2d\uff08\u6216\u662f\u5176\u5b83\u76ee\u6807\u670d\u52a1\u5668\uff09\u62c9\u53d6metrics\u6570\u636e\uff0c\u7136\u540e\u5b58\u5165\u5230\u5b83\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4e2d\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"\u5b58\u50a8\uff08Storage\uff09"}),"\uff1a\u4e3b\u8981\u7528\u6765\u5b58\u50a8metrics\uff08\u6307\u6807\u76f8\u5173\uff09\u6570\u636e\uff0c\u662f\u57fa\u4e8e\u65f6\u95f4\u5e8f\u5217\u7684\u6570\u636e\u5e93(TSDB \u5373 Time Series DataBase)\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Web\u670d\u52a1\uff08HTTP Server\uff09"}),"\uff1a\u4f7f\u7528",(0,o.jsx)(n.code,{children:"PromQL"}),"\uff0c\u4ece\u5b83\u81ea\u5df1\u7684\u6570\u636e\u5e93\u4e2d\u68c0\u7d22\u6570\u636e\uff0c\u5165\u53e3\u53ef\u4ee5\u662fPromethous Web UI\u6216\u662f\u5176\u5b83\u7684UI\u5c55\u793a\u5e73\u53f0\u5982Grafana\u3002"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u8fc7\u53bb\u51e0\u5e74\uff0c\u5728\u5bb9\u5668\u7aef\uff0cPrometheus\u4f5c\u4e3aMonitoring\u5de5\u5177\u5c24\u5176\u91cd\u8981\u3002\u539f\u56e0\u662f\u5bb9\u5668\u5316\u7684\u670d\u52a1\u4f7f\u5f97DevOps\u5de5\u4f5c\u53d8\u5f97\u590d\u6742\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u5f88\u591a\u5f88\u591a\u4e2apod\u8fd0\u884c\u5728\u591a\u4e2aProd clusters\u4e0a\uff0c\u90a3\u4e48\u8fd9\u4e9bpod\u7684\u5065\u5eb7\u60c5\u51b5\u7684\u76d1\u63a7\u5c31\u663e\u5f97\u5f88\u91cd\u8981\uff0c\u5982\uff1a\u6709\u6ca1\u6709\u51fa\u73b0\u54cd\u5e94\u5ef6\u8fdf\uff0c\u8d1f\u8f7d\u8fc7\u91cd\uff0c\u8d44\u6e90\u4e0d\u8db3\uff0c\u51fa\u73b0\u4e86Error\u7b49\u7b49\u3002"}),"\n",(0,o.jsx)(n.p,{children:"\u5177\u4f53\u4e3e\u4f8b\uff0c\u5982Prod\u4e0a\u7684\u67d0\u4e2apod\u7684out of memory\u9519\u8bef\uff0c\u95f4\u63a5\u7684\u5bfc\u81f4\u4e86\u6570\u636e\u5e93\u7684\u4e24\u4e2apod\u51fa\u95ee\u9898\u4e86\uff0c\u7136\u540e\u8fd9\u4e24\u4e2adb pod\u4e3a\u7528\u6237\u767b\u9646\u9a8c\u8bc1\u63d0\u4f9b\u670d\u52a1\uff0c\u90a3\u4e48\u4ece\u800c\u4f7f\u5f97\u7528\u6237\u5728UI\u4e0a\u65e0\u6cd5\u767b\u9646\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u5feb\u901f\u5b9a\u4f4d\u54ea\u91cc\u51fa\u4e86\u95ee\u9898\uff1f\u4f46\u95ee\u9898\u7684\u5173\u952e\u662f\u5982\u679c\u6211\u4eec\u6709\u76d1\u63a7\u7cfb\u7edf\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u5feb\u901f\u77e5\u9053\u54ea\u4e9bpod\u662f\u4e0d\u5065\u5eb7\u7684\uff0c\u751a\u81f3\u5982\u679c\u6709\u67d0\u79cd\u9884\u8b66\u7cfb\u7edf\uff0c\u5f53\u67d0\u4e2apod\u5feb\u51fa\u73b0\u8d44\u6e90\u67af\u7aed\u7684\u95ee\u9898\u65f6\uff0c\u5c31\u53ef\u4ee5\u5148\u53d1\u51fa\u8b66\u62a5\uff08\u9884\u8b66\u529f\u80fd\uff09\u3002"}),"\n",(0,o.jsx)(n.h1,{id:"\u73af\u5883\u51c6\u5907",children:"\u73af\u5883\u51c6\u5907"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"\u540d\u79f0"}),(0,o.jsx)(n.th,{children:"IP"}),(0,o.jsx)(n.th,{children:"\u670d\u52a1"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u65e5\u5fd7\u670d\u52a1\u5668"}),(0,o.jsx)(n.td,{children:"192.168.137.121"}),(0,o.jsx)(n.td,{children:"Grafana + Loki"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5e94\u7528\u670d\u52a1\u5668"}),(0,o.jsx)(n.td,{children:"192.168.137.122"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5e94\u7528\u670d\u52a1\u5668"}),(0,o.jsx)(n.td,{children:"192.168.137.123"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5e94\u7528\u670d\u52a1\u5668"}),(0,o.jsx)(n.td,{children:"192.168.137.131"}),(0,o.jsx)(n.td,{})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5e94\u7528\u670d\u52a1\u5668"}),(0,o.jsx)(n.td,{children:"192.168.137.132"}),(0,o.jsx)(n.td,{children:"Spring Boot Service + Nginx  + Promtail"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"\u5e94\u7528\u670d\u52a1\u5668"}),(0,o.jsx)(n.td,{children:"192.168.137.133"}),(0,o.jsx)(n.td,{})]})]})]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"\u5e94\u7528"}),(0,o.jsx)(n.th,{children:"\u7248\u672c"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Loki"}),(0,o.jsx)(n.td,{children:"3.5.1"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Promtail"}),(0,o.jsx)(n.td,{children:"3.5.1"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Grafana"}),(0,o.jsx)(n.td,{children:"12.0.1"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Grafana-Enterprise"}),(0,o.jsx)(n.td,{children:"12.0.1"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Prometheus"}),(0,o.jsx)(n.td,{children:"3.4.1"})]})]})]}),"\n",(0,o.jsx)(n.h1,{id:"\u4e8c\u8fdb\u5236\u5b89\u88c5",children:"\u4e8c\u8fdb\u5236\u5b89\u88c5"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://prometheus.io/download/",children:"Prometheus\u53ca\u7ec4\u4ef6\u4e0b\u8f7d\u5730\u5740"}),"\n\u66f4\u591a\u7ec4\u4ef6\u53ef\u4ee5\u67e5\u8be2",(0,o.jsx)(n.a,{href:"https://prometheus.io/docs/instrumenting/exporters/",children:"Prometheus \u793e\u533aExporter\u7ec4\u4ef6"}),"\uff0c\u6240\u6709\u7684\u5b98\u65b9\u7ec4\u4ef6\u53ca\u90e8\u5206\u9ad8\u8d28\u91cf\u7684\u793e\u533a\u7ec4\u4ef6\u90fd\u6709\u7f57\u5217\uff0c\u57fa\u672c\u53ef\u4ee5\u6db5\u76d6\u4e3b\u6d41\u7684\u670d\u52a1\u5668\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u4e2d\u95f4\u4ef6\u76d1\u63a7\u6307\u6807\u7684\u91c7\u96c6\u63a8\u9001"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u4e0b\u8f7d\u5b89\u88c5\u5305",children:"\u4e0b\u8f7d\u5b89\u88c5\u5305"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"wget https://github.com/prometheus/prometheus/releases/download/v3.4.1/prometheus-3.4.1.linux-amd64.tar.gz\nwget https://github.com/prometheus/alertmanager/releases/download/v0.28.1/alertmanager-0.28.1.linux-amd64.tar.gz\nwget https://github.com/prometheus/node_exporter/releases/download/v1.9.1/node_exporter-1.9.1.linux-amd64.tar.gz\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5b89\u88c5-prometheus",children:"\u5b89\u88c5 Prometheus"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u89e3\u538b"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# \u89e3\u538b\ntar -zxvf prometheus-3.4.1.linux-amd64.tar.gz\ncd prometheus-3.4.1.linux-amd64\n\n# \u6d4b\u8bd5\n./prometheus --config.file="prometheus.yml"\n\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"prometheus.yml"})]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# my global config\nglobal:\n  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\n  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n  # scrape_timeout is set to the global default (10s).\n\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n          # - alertmanager:9093\n\n# Load rules once and periodically evaluate them according to the global \'evaluation_interval\'.\nrule_files:\n  # - "first_rules.yml"\n  # - "second_rules.yml"\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it\'s Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n  - job_name: "prometheus"\n\n    # metrics_path defaults to \'/metrics\'\n    # scheme defaults to \'http\'.\n\n    static_configs:\n      - targets: ["localhost:9090"]\n       # The label name is added as a label `label_name=<label_value>` to any timeseries scraped from this config.\n        labels:\n          app: "prometheus"\n\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"\u542f\u505c\u811a\u672c"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# \u542f\u52a8\u811a\u672c\ncat > startup.sh << \'EOF\'\n#!/bin/bash\nnohup ./prometheus --config.file="prometheus.yml" >./prometheus.log 2>&1 &\necho "$!" > pid\nEOF\n\n# \u505c\u6b62\u811a\u672c\ncat > shutdown.sh << \'EOF\'\n#!/bin/bash\nkill -9 `cat pid`\necho "\u5173\u95ed\u6210\u529f!"\nEOF\n\n# \u811a\u672c\u6dfb\u52a0\u6267\u884c\u6743\u9650\nchmod +x startup.sh shutdown.sh\n\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u5b89\u88c5-alertmanager",children:"\u5b89\u88c5 AlertManager"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u89e3\u538b"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# \u89e3\u538b\ntar -zxvf alertmanager-0.28.1.linux-amd64.tar.gz\ncd alertmanager-0.28.1.linux-amd64\n\n# \u6d4b\u8bd5\n./alertmanager --config.file="alertmanager.yml"\n\n'})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsxs)(n.li,{children:["\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"alertmanager.yml"})]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"route:\n  group_by: ['alertname']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 1h\n  receiver: 'web.hook'\nreceivers:\n  - name: 'web.hook'\n    webhook_configs:\n      - url: 'http://127.0.0.1:5001/'\ninhibit_rules:\n  - source_match:\n      severity: 'critical'\n    target_match:\n      severity: 'warning'\n    equal: ['alertname', 'dev', 'instance']\n\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"\u542f\u505c\u811a\u672c"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# \u542f\u52a8\u811a\u672c\ncat > startup.sh << \'EOF\'\n#!/bin/bash\nnohup ./alertmanager --config.file="alertmanager.yml" >./alertmanager.log 2>&1 &\necho "$!" > pid\nEOF\n\n# \u505c\u6b62\u811a\u672c\ncat > shutdown.sh << \'EOF\'\n#!/bin/bash\nkill -9 `cat pid`\necho "\u5173\u95ed\u6210\u529f!"\nEOF\n\n# \u811a\u672c\u6dfb\u52a0\u6267\u884c\u6743\u9650\nchmod +x startup.sh shutdown.sh\n\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u5b89\u88c5-node-exporter",children:"\u5b89\u88c5 Node Exporter"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"\u89e3\u538b"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u89e3\u538b\ntar -zxvf node_exporter-1.9.1.linux-amd64.tar.gz\ncd node_exporter-1.9.1.linux-amd64\n\n# \u6d4b\u8bd5\n./node_exporter\n\n"})}),"\n",(0,o.jsxs)(n.ol,{start:"2",children:["\n",(0,o.jsx)(n.li,{children:"\u542f\u505c\u811a\u672c"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8\u811a\u672c\ncat > startup.sh << 'EOF'\n#!/bin/bash\nnohup ./node_exporter >./node_exporter.log 2>&1 &\necho \"$!\" > pid\nEOF\n\n# \u505c\u6b62\u811a\u672c\ncat > shutdown.sh << 'EOF'\n#!/bin/bash\nkill -9 `cat pid`\necho \"\u5173\u95ed\u6210\u529f!\"\nEOF\n\n# \u811a\u672c\u6dfb\u52a0\u6267\u884c\u6743\u9650\nchmod +x startup.sh shutdown.sh\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u8bbf\u95ee\u6d4b\u8bd5",children:"\u8bbf\u95ee\u6d4b\u8bd5"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95eePrometheus\u76d1\u63a7\u6307\u6807\u9875\u9762","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Prometheus \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9090"})]}),"\n",(0,o.jsxs)(n.li,{children:["Prometheus \u81ea\u8eab\u6307\u6807 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9090/metrics"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95ee NodeExporter \u91c7\u96c6\u6307\u6807\u9875\u9762","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["NodeExporter \u91c7\u96c6\u6307\u6807 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9100/metrics"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h1,{id:"docker\u5b89\u88c5",children:"Docker\u5b89\u88c5"}),"\n",(0,o.jsx)(n.h2,{id:"\u4e0b\u8f7d\u955c\u50cf",children:"\u4e0b\u8f7d\u955c\u50cf"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u62c9\u53d6\u955c\u50cf\ndocker pull prom/prometheus:v3.4.1\ndocker pull prom/alertmanager:v0.28.1\ndocker pull prom/node-exporter:v1.9.1\n\n# \u5bfc\u51fa\u955c\u50cf\ndocker save -o prom_prometheus_v3.4.1.tar prom/prometheus:v3.4.1\ndocker save -o prom_alertmanager_v0.28.1.tar prom/alertmanager:v0.28.1\ndocker save -o prom_node-exporter_v1.9.1.tar prom/node-exporter:v1.9.1\n\n# \u5bfc\u5165\u955c\u50cf\ndocker load -i prom_prometheus_v3.4.1.tar\ndocker load -i prom_alertmanager_v0.28.1.tar\ndocker load -i prom_node-exporter_v1.9.1.tar\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u521d\u59cb\u5316\u914d\u7f6e",children:"\u521d\u59cb\u5316\u914d\u7f6e"}),"\n",(0,o.jsxs)(n.p,{children:["\u53ef\u4ee5\u5728\u5b98\u65b9\u4ee3\u7801\u4ed3\u5e93\u627e\u5230\u4e00\u4e9b\u914d\u7f6e\u793a\u4f8b\u6587\u4ef6 ",(0,o.jsx)(n.a,{href:"https://github.com/prometheus/prometheus/blob/main/documentation/examples/prometheus-docker.yml",children:"prometheus documentation examples"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u6587\u4ef6\nsudo mkdir -p /etc/{prometheus,alertmanager}\n\n# Prometheus\u6587\u4ef6\nsudo vim /etc/prometheus/prometheus.yaml\n\n# \u544a\u8b66\u89c4\u5219\u6587\u4ef6\nsudo vim /etc/prometheus/rules.yaml\n\n# \u544a\u8b66\u914d\u7f6e\u6587\u4ef6\nsudo vim /etc/alertmanager/alertmanager.yaml\n\n# \u67e5\u8be2\u5f53\u524d\u7528\u6237\u7684uid gid\uff0c\u9632\u6b62\u6302\u8f7d\u76ee\u5f55\u65f6\u5bb9\u5668\u65e0\u6743\u9650\u5199\u5165\u67d0\u4e9b\u76ee\u5f55\nid -u $USER  # \u663e\u793aUID\nid -g $USER  # \u663e\u793aGID\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Prometheus\u6587\u4ef6  ",(0,o.jsx)(n.code,{children:"prometheus.yaml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# \u5168\u5c40\u914d\u7f6e\nglobal:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n  # scrape_timeout is set to the global default (10s).\n# \u544a\u8b66\u914d\u7f6e\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets: ['alertmanager:9093']\n\n# \u52a0\u8f7d\u4e00\u6b21\u89c4\u5219\uff0c\u5e76\u6839\u636e\u5168\u5c40\u201c\u8bc4\u4f30\u95f4\u9694\u201d\u5b9a\u671f\u8bc4\u4f30\u5b83\u4eec\u3002\nrule_files:\n  - \"/etc/prometheus/rules.yaml\"\n# \u63a7\u5236Prometheus\u76d1\u89c6\u54ea\u4e9b\u8d44\u6e90\n# \u9ed8\u8ba4\u914d\u7f6e\u4e2d\uff0c\u6709\u4e00\u4e2a\u540d\u4e3aprometheus\u7684\u4f5c\u4e1a\uff0c\u5b83\u4f1a\u6536\u96c6Prometheus\u670d\u52a1\u5668\u516c\u5f00\u7684\u65f6\u95f4\u5e8f\u5217\u6570\u636e\u3002\nscrape_configs:\n  # \u4f5c\u4e1a\u540d\u79f0\u5c06\u4f5c\u4e3a\u6807\u7b7e\u201cjob=<job_name>`\u6dfb\u52a0\u5230\u6b64\u914d\u7f6e\u4e2d\u83b7\u53d6\u7684\u4efb\u4f55\u6570\u636e\u3002\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n  - job_name: 'node'\n    static_configs:\n      - targets: ['localhost:9100']\n        labels:\n          env: dev\n          role: docker\n  - job_name: 'linux'\n    static_configs:\n      - targets: ['192.168.137.122:9100']\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u544a\u8b66\u89c4\u5219\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"rules.yaml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'groups:\n- name: example\n  rules:\n # Alert for any instance that is unreachable for > 5 minutes.\n  - alert: InstanceDown\n    expr: up == 0\n    for: 5m\n    labels:\n      serverity: page\n    annotations:\n      summary: "Instance {{ $labels.instance }} down"\n      description: "{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes."\n\n'})}),"\n",(0,o.jsxs)(n.p,{children:["AlertManager\u544a\u8b66\u914d\u7f6e\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"alertmanager.yml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"global:\n  resolve_timeout: 5m\n  smtp_smarthost: 'smtp.qiye.aliyun.com:465'\n  smtp_from: 'hliu@pisx.com'\n  smtp_auth_username: 'hliu@pisx.com'\n  smtp_auth_password: 'Liuhui1993'\n  smtp_require_tls: true\n\nroute:\n  group_by: ['alertname']\n  group_wait: 10s\n  group_interval: 10s\n  repeat_interval: 1h\n  receiver: 'test-mails'\n\nreceivers:\n- name: 'test-mails'\n  email_configs:\n  - to: 'hliu@pisx.com'\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u90e8\u7f72prometheus-grafana",children:"\u90e8\u7f72Prometheus Grafana"}),"\n",(0,o.jsxs)(n.p,{children:["Docker Compose\u6587\u4ef6 ",(0,o.jsx)(n.code,{children:"docker-compose.yaml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"services:\n  prometheus:\n    # image: docker.io/prom/prometheus:v3.4.1\n    image: quay.io/prometheus/prometheus:v3.4.1\n    container: prometheus\n    volumes:\n      - ./prometheus/config:/etc/prometheus\n      - ./prometheus/data:/prometheus\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yaml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--web.console.libraries=/usr/share/prometheus/console_libraries'\n      - '--web.console.templates=/usr/share/prometheus/consoles'\n      - '--web.external-url=http://192.168.137.122:9090/'\n      - '--web.enable-lifecycle'\n    ports:\n      - 9090:9090\n    restart: always\n    # \u6dfb\u52a0\u7528\u6237\u6743\u9650\u914d\u7f6e\uff0c\u66ff\u6362\u4e3a\u5bbf\u4e3b\u673a\u7528\u6237UID:GID\n    user: \"1000:1000\"\n\n  alertmanager:\n    # image: docker.io/prom/alertmanager:v0.28.1\n    image: quay.io/prometheus/alertmanager:v0.28.1\n    container: alertmanager\n    ports:\n      - 9093:9093\n    volumes:\n      - ./alertmanager/config:/etc/alertmanager\n      - ./alertmanager/data:/alertmanager\n    command:\n      - '--config.file=/etc/alertmanager/alertmanager.yaml'\n      - '--storage.path=/alertmanager'\n    restart: always\n    # \u6dfb\u52a0\u7528\u6237\u6743\u9650\u914d\u7f6e\n    user: \"1000:1000\"\n\n  node-exporter:\n    # image: docker.io/prom/node-exporter:v1.9.1\n    image: quay.io/prometheus/node-exporter:v1.9.1\n    container: node-exporter\n    ports:\n      - 9100:9100\n    volumes:\n      - /proc:/host/proc:ro\n      - /sys:/host/sys:ro\n      - /:/host:ro,rslave\n    command:\n      - '--path.rootfs=/host'\n    restart: always\n    # node-exporter\u9700\u8981\u7279\u6b8a\u6743\u9650\n    privileged: true\n\n  grafana:\n    image: grafana/grafana:12.0.1\n    container: grafana\n    ports:\n      - 3000:3000\n    volumes:\n      - ./grafana/provisioning:/etc/grafana/provisioning\n      - ./grafana/data:/var/lib/grafana\n    environment:\n      - GF_INSTALL_PLUGINS=camptocamp-prometheus-alertmanager-datasource\n      # \u6dfb\u52a0Grafana\u6743\u9650\u914d\u7f6e\n      - GF_PATHS_PLUGINS=/var/lib/grafana/plugins\n      - GF_PATHS_DATA=/var/lib/grafana\n      - GF_PATHS_LOGS=/var/log/grafana\n    restart: always\n    # \u6dfb\u52a0\u7528\u6237\u6743\u9650\u914d\u7f6e\n    user: \"1000:1000\"\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u542f\u505c\u6307\u4ee4"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8\ndocker compose -f docker-compose.yaml up -d\n\n# \u67e5\u8be2\u5bb9\u5668\ndocker container ls\n\n# \u67e5\u8be2\u65e5\u5fd7\ndocker logs prometheus\n\n# \u505c\u6b62\ndocker compose -f docker-compose.yaml down\n\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95eePrometheus\u76d1\u63a7\u6307\u6807\u9875\u9762","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Prometheus \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9090"})]}),"\n",(0,o.jsxs)(n.li,{children:["Prometheus \u81ea\u8eab\u6307\u6807 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9090/metrics"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95ee NodeExporter \u91c7\u96c6\u6307\u6807\u9875\u9762","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["NodeExporter \u91c7\u96c6\u6307\u6807 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9100/metrics"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95eeGrafana\u9875\u9762","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Grafana \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:3000"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"admin"})," / ",(0,o.jsx)(n.code,{children:"admin"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u6d4b\u8bd5",children:"\u6d4b\u8bd5"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u6253\u5f00 Prometheus \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9090"}),"\n",(0,o.jsx)(n.img,{src:r(5911).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u6253\u5f00 Prometheus \u81ea\u8eab\u6307\u6807\u9875\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9090/metrics"}),"\n",(0,o.jsx)(n.img,{src:r(51232).A+"",width:"1900",height:"971"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u6253\u5f00 NodeExporter \u91c7\u96c6\u6307\u6807\u9875\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:9100/metrics"}),"\n",(0,o.jsx)(n.img,{src:r(3891).A+"",width:"1910",height:"971"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u6253\u5f00 Grafana \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.122:3000"}),"\uff0c\u5728\u6570\u636e\u6e90\u4e2d\u6dfb\u52a0 Prometheus \u548c AlertManager\u6570\u636e\u6e90\n",(0,o.jsx)(n.img,{src:r(56962).A+"",width:"1920",height:"922"}),"\n",(0,o.jsx)(n.img,{src:r(6587).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u4eceGrafana\u5b98\u65b9\u63d0\u4f9b\u6a21\u677f\u5730\u5740\u4e0b\u8f7d\u76d1\u63a7\u9762\u677f\u6a21\u677f: ",(0,o.jsx)(n.code,{children:"https://grafana.com/grafana/dashboards"}),"\n",(0,o.jsx)(n.img,{src:r(65332).A+"",width:"1920",height:"922"}),"\n",(0,o.jsx)(n.img,{src:r(86051).A+"",width:"1920",height:"922"}),"\n",(0,o.jsx)(n.img,{src:r(45345).A+"",width:"1920",height:"922"}),"\n",(0,o.jsx)(n.img,{src:r(22735).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u670d\u52a1\u5668\u76d1\u63a7\u6548\u679c\u5c55\u793a\n",(0,o.jsx)(n.img,{src:r(22352).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h1,{id:"kubernetes\u5b89\u88c5",children:"Kubernetes\u5b89\u88c5"}),"\n",(0,o.jsx)(n.p,{children:"\u8fd9\u91cc\u5c06\u91c7\u7528 Helm chart \u6765\u5b89\u88c5 Prometheus Operator\uff0c\u56e0\u4e3aOperator\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5e03\u7f72\u3001\u7ba1\u7406\u3001\u6062\u590dPrometheus\uff08\u56e0\u4e3aPrometheus\u662f\u6709\u72b6\u6001\u7684\u5e94\u7528\uff0c\u4e0d\u540c\u4e8e\u65e0\u72b6\u6001\u7684Java\u9879\u76ee\uff08Kubernetes\u53ef\u4ee5\u81ea\u52a8\u5316\u7ba1\u7406\u65e0\u72b6\u6001\u5e94\u7528\uff09\uff0c\u6709\u72b6\u6001\u7684\u5e94\u7528\u8fd0\u7ef4\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6240\u4ee5\u9700\u8981\u7279\u5b9a\u7684Operator\u6765\u7ba1\u7406\u3002\u5177\u4f53\u53ef\u4ee5\u770b\u6587\u7ae0\u5f00\u5934\u7684\u524d\u7f6e\u6587\u7ae0\u3002"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://juejin.cn/post/7356906581780742185",children:"\u3010Monitoring\u3011\u4f7f\u7528Helm\u548cPrometheus Operator\u5728Kubernetes\u4e2d\u5b89\u88c5Prometheus"})}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u6dfb\u52a0prometheus-chart\u5230helm",children:"\u6dfb\u52a0Prometheus Chart\u5230Helm"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bhelm\u7248\u672c\nhelm version\n\n# \u5982\u679c\u6dfb\u52a0\u4ed3\u5e93\u5931\u8d25\u53ef\u4ee5\u6dfb\u52a0\u4ee3\u7406\nexport http_proxy=http://192.168.137.1:4780\nexport https_proxy=http://192.168.137.1:4780\n\n# \u6dfb\u52a0chart\u4ed3\u5e93\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\n\n# \u66f4\u65b0chart\u4ed3\u5e93\nhelm repo update\n\n# \u67e5\u770b\u6dfb\u52a0\u5b8c\u6210\u540e\u7684\u4ed3\u5e93\nhelm repo list\n\n# \u67e5\u8be2prometheus\u7684chart\nhelm search repo prometheus-community/kube-prometheus-stack\n\n# \u62c9\u53d6chart\nhelm pull prometheus-community/kube-prometheus-stack\n# \u62c9\u53d6\u8f83\u6162\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ecegithub\u4e0b\u8f7d\n# wget https://github.com/prometheus-community/helm-charts/releases/download/kube-prometheus-stack-73.2.0/kube-prometheus-stack-73.2.0.tgz\n\n# \u6b64\u65f6\u4f1a\u6709\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u9ed8\u8ba4\u4e0b\u8f7d\u7684\u662f\u6700\u65b0\u7248\u672c\uff0c\u53ef\u80fd\u4e0eGrafana\u7248\u672c\u4e0d\u517c\u5bb9\uff0c\u9700\u8981\u53bbgithub\u786e\u8ba4\ntar -zxvf kube-prometheus-stack-73.2.0.tgz -C ~/\n\n# \u8fdb\u5165\u5230\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\ncd ~/kube-prometheus-stack\n\n# \u67e5\u770b\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\nvim values.yaml\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u5b89\u88c5prometheus-operator",children:"\u5b89\u88c5Prometheus Operator"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5\u65f6\u9700\u8981\u4ecedocker\u4ed3\u5e93\u62c9\u53d6\u955c\u50cf\uff0c\u53ef\u4ee5\u63d0\u524d\u51c6\u5907\u597d\ndocker pull quay.io/prometheus/prometheus:v3.4.1\ndocker pull quay.io/prometheus/alertmanager:v0.28.1\ndocker pull quay.io/prometheus/node-exporter:v1.9.1\ndocker pull quay.io/prometheus-operator/admission-webhook:v0.82.2\ndocker pull quay.io/prometheus-operator/prometheus-operator:v0.82.2\ndocker pull quay.io/prometheus-operator/prometheus-config-reloader:v0.82.2\ndocker pull quay.io/thanos/thanos:v0.38.0\ndocker pull registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.5.3\ndocker pull registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.15.0\n\n# registry.k8s.io \u62c9\u53d6\u5931\u8d25\uff0c\u4f7f\u7528\u4ee3\u7406\u62c9\u53d6\uff0c\u62c9\u53d6\u6210\u529f\u540e\u91cd\u65b0\u6253tag\u5373\u53ef\ndocker pull k8s.mirror.nju.edu.cn/ingress-nginx/kube-webhook-certgen:v1.5.3\ndocker tag  k8s.mirror.nju.edu.cn/ingress-nginx/kube-webhook-certgen:v1.5.3 registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.5.3\ndocker pull k8s.mirror.nju.edu.cn/kube-state-metrics/kube-state-metrics:v2.15.0\ndocker tag  k8s.mirror.nju.edu.cn/kube-state-metrics/kube-state-metrics:v2.15.0 registry.k8s.io/kube-state-metrics/kube-state-metrics:v2.15.0\n\n# \u62c9\u53d6\u955c\u50cf\u8f83\u6162\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u672c\u5730\u4ee3\u7406\nexport HTTP_PROXY=http://192.168.137.1:4780\nexport HTTPS_PROXY=http://192.168.137.1:4780\n\n# \u5b89\u88c5prometheus\uff0c\u4ece\u670d\u52a1\u5668\u4e0b\u8f7d kube-prometheus-stack-73.2.0.tgz \u5b89\u88c5\u5305\n# \u5982\u679c\u60f3\u8981\u4fee\u6539\u90e8\u5206\u914d\u7f6e\uff0c\u53ef\u4ee5\u65b0\u589e\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6 prometheus-values.yaml\uff0c\u5728install\u65f6\u5e26\u4e0a\u53c2\u6570\u5373\u53ef -f prometheus-values.yaml\n# helm install prometheus prometheus-community/kube-prometheus-stack --create-namespace --namespace monitoring\n\n# \u5b89\u88c5prometheus\uff0c\u5728 kube-prometheus-stack-73.2.0.tgz \u89e3\u538b\u76ee\u5f55\u6267\u884c\uff0c\u5982\u6709\u9700\u8981\u53ef\u4ee5\u5e26\u4e0a -f prometheus-values.yaml\ncd ~/kube-prometheus-stack\nhelm install prometheus . --create-namespace --namespace monitoring\n\n# \u5347\u7ea7\nhelm upgrade prometheus prometheus-community/kube-prometheus-stack\n\n# \u67e5\u770bHelm\u90e8\u7f72\u7684\u8d44\u6e90\nhelm ls --namespace monitoring\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u90e8\u7f72\u6210\u529f\u540e\u8f93\u51fa\u7684\u63d0\u793a\u4fe1\u606f\u5982\u4e0b"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'[diginn@k8s-master-01 kube-prometheus-stack]$ helm install prometheus . --create-namespace --namespace monitoring\nNAME: prometheus\nLAST DEPLOYED: Thu Jun 12 14:50:19 2025\nNAMESPACE: monitoring\nSTATUS: deployed\nREVISION: 1\nNOTES:\nkube-prometheus-stack has been installed. Check its status by running:\n  kubectl --namespace monitoring get pods -l "release=prometheus"\n\nGet Grafana \'admin\' user password by running:\n\n  kubectl --namespace monitoring get secrets prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 -d ; echo\n\nAccess Grafana local instance:\n\n  export POD_NAME=$(kubectl --namespace monitoring get pod -l "app.kubernetes.io/name=grafana,app.kubernetes.io/instance=prometheus" -oname)\n  kubectl --namespace monitoring port-forward $POD_NAME 3000\n\nVisit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create & configure Alertmanager and Prometheus instances using the Operator.\n\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u68c0\u67e5prometheus-operator\u72b6\u6001",children:"\u68c0\u67e5Prometheus Operator\u72b6\u6001"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b pod\nkubectl get pods -n monitoring -o wide\n\n# \u67e5\u770b\u670d\u52a1\u7aef\u53e3\u4fe1\u606f\nkubectl get svc -n monitoring\n\n# \u67e5\u770b\u8282\u70b9Pending\u539f\u56e0\nkubectl describe pod alertmanager-prometheus-kube-prometheus-alertmanager-0 -n monitoring\nkubectl describe pod prometheus-kube-prometheus-operator-5cfd684899-hdqf8 -n monitoring\nkubectl describe pod prometheus-kube-state-metrics-74b7dc4795-sx7bv -n monitoring\nkubectl describe pod prometheus-prometheus-kube-prometheus-prometheus-0 -n monitoring\n\n# \u5378\u8f7d\nhelm uninstall prometheus --namespace monitoring\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,o.jsx)(n.code,{children:"kubectl get pods -n monitoring -o wide"})," \u7684\u8f93\u51fa\u786e\u5b9apod\u7684\u72b6\u6001\uff0c\u5e76\u901a\u8fc7 ",(0,o.jsx)(n.code,{children:"kubectl describe pod <pod-name> -n monitoring"})," \u5b9a\u4f4d\u5177\u4f53\u7684\u5931\u8d25\u539f\u56e0"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"[diginn@k8s-master-01 kube-prometheus-stack]$ kubectl get pods -n monitoring -o wide\nNAME                                                     READY   STATUS        RESTARTS   AGE     IP                NODE            NOMINATED NODE   READINESS GATES\nalertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running       0          3m20s   10.244.44.211     k8s-node-02     <none>           <none>\nprometheus-grafana-76cd8bb66b-gwwp8                      3/3     Running       0          3m23s   10.244.151.143    k8s-master-01   <none>           <none>\nprometheus-kube-prometheus-operator-5cfd684899-hdqf8     1/1     Running       0          3m23s   10.244.151.144    k8s-master-01   <none>           <none>\nprometheus-kube-state-metrics-74b7dc4795-sx7bv           1/1     Running       0          3m23s   10.244.44.208     k8s-node-02     <none>           <none>\nprometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running       0          3m19s   10.244.95.47      k8s-master-02   <none>           <none>\nprometheus-prometheus-node-exporter-9chcv                0/1     Pending       0          3m23s   <none>            <none>          <none>           <none>\nprometheus-prometheus-node-exporter-c7lhf                0/1     Terminating   0          18m     <none>            k8s-node-03     <none>           <none>\nprometheus-prometheus-node-exporter-dt8n4                0/1     Terminating   0          18m     <none>            k8s-master-03   <none>           <none>\nprometheus-prometheus-node-exporter-jql69                0/1     Terminating   0          18m     <none>            k8s-node-01     <none>           <none>\nprometheus-prometheus-node-exporter-mv5t4                1/1     Running       0          3m23s   192.168.137.132   k8s-node-02     <none>           <none>\nprometheus-prometheus-node-exporter-n2bv8                0/1     Pending       0          3m23s   <none>            <none>          <none>           <none>\nprometheus-prometheus-node-exporter-r9sgg                1/1     Running       0          3m23s   192.168.137.121   k8s-master-01   <none>           <none>\nprometheus-prometheus-node-exporter-vt6sg                0/1     Pending       0          3m23s   <none>            <none>          <none>           <none>\nprometheus-prometheus-node-exporter-zcmql                1/1     Running       0          3m23s   192.168.137.122   k8s-master-02   <none>           <none>\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u8bbf\u95eeprometheus-\u548c-grafana-dashboards",children:"\u8bbf\u95eePrometheus \u548c Grafana Dashboards"}),"\n",(0,o.jsx)(n.h3,{id:"\u4e34\u65f6\u65b9\u6848k8s-\u7aef\u53e3\u8f6c\u53d1",children:"\u4e34\u65f6\u65b9\u6848\uff0cK8s \u7aef\u53e3\u8f6c\u53d1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u5148\u67e5\u770bservice\u7684\u7aef\u70b9\nkubectl get service -n monitoring\n\n# \u7136\u540e\u4f7f\u7528port-forward\u8fdb\u884c\u8f6c\u53d1\u4ee5\u4fbfkubernetes\u7fa4\u4f53\u5916\u53ef\u4ee5\u8bbf\u95ee\u5185\u90e8\u7684service\nnohup kubectl port-forward --address 0.0.0.0 service/prometheus-kube-prometheus-prometheus -n monitoring 39090:9090 > portforward-9090.log 2>&1 < /dev/null &\nnohup kubectl port-forward --address 0.0.0.0 service/prometheus-grafana -n monitoring 33000:80 > portforward-3000.log 2>&1 < /dev/null &\n\n# \u67e5\u770b\u8bbf\u95ee\u7aef\u70b9\nkubectl get svc -n monitoring | grep -E 'prometheus-kube-prometheus-prometheus|prometheus-grafana'\n\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u6d4f\u89c8\u5668\u8bbf\u95eePrometheus\u76d1\u63a7\u6307\u6807\u9875\u9762"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Prometheus \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:9090"})]}),"\n",(0,o.jsxs)(n.li,{children:["Prometheus \u81ea\u8eab\u6307\u6807 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:9090/metrics"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u6d4f\u89c8\u5668\u8bbf\u95eeGrafana\u9875\u9762"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Grafana \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:3000"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u8d26\u53f7 ",(0,o.jsx)(n.code,{children:"admin"})," / ",(0,o.jsx)(n.code,{children:"prom-operator"})]}),"\n",(0,o.jsxs)(n.li,{children:["\u5bc6\u7801 \u4f7f\u7528\u5b89\u88c5\u540e\u7684\u6307\u4ee4\u83b7\u53d6 ",(0,o.jsx)(n.code,{children:'kubectl --namespace monitoring get secrets prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 -d ; echo'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\u4f7f\u7528-nodeport-\u66b4\u9732\u670d\u52a1",children:"\u4f7f\u7528 NodePort \u66b4\u9732\u670d\u52a1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# 1. \u4fee\u6539 Prometheus \u670d\u52a1\u4e3a NodePort\nkubectl patch svc prometheus-kube-prometheus-prometheus -n monitoring -p \'{"spec": {"type": "NodePort"}}\'\n\n# 2. \u4fee\u6539 Grafana \u670d\u52a1\u4e3a NodePort\nkubectl patch svc prometheus-grafana -n monitoring -p \'{"spec": {"type": "NodePort"}}\'\n\n# 3. \u83b7\u53d6\u5b9e\u9645\u7aef\u53e3\u53f7\nkubectl get svc -n monitoring\n\n[diginn@k8s-master-01 kube-prometheus-stack]$ kubectl get svc -n monitoring\nNAME                                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE\nalertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP      55m\nprometheus-grafana                        NodePort    10.101.166.78    <none>        80:31145/TCP                    55m\nprometheus-kube-prometheus-alertmanager   ClusterIP   10.96.67.209     <none>        9093/TCP,8080/TCP               55m\nprometheus-kube-prometheus-operator       ClusterIP   10.99.164.53     <none>        443/TCP                         55m\nprometheus-kube-prometheus-prometheus     NodePort    10.101.131.197   <none>        9090:30203/TCP,8080:31517/TCP   55m\nprometheus-kube-state-metrics             ClusterIP   10.108.139.180   <none>        8080/TCP                        55m\nprometheus-operated                       ClusterIP   None             <none>        9090/TCP                        55m\nprometheus-prometheus-node-exporter       ClusterIP   10.100.224.184   <none>        9100/TCP                        55m\n\n# \u83b7\u53d6Grafana\u5bc6\u7801\n# 1. \u67e5\u770b\u547d\u540d\u7a7a\u95f4\u5185\u6240\u6709Secret\nkubectl get secrets -n monitoring\n\n# 2. \u67e5\u770bSecret\u5185\u5bb9\nkubectl get secret prometheus-grafana -n monitoring -o yaml\n\n# 3. \u590d\u5236admin-user admin-password\uff0c\u7528base64 decode\u4e0b\uff1a\necho "YWRtaW4=" | base64 -d; echo               # \u8d26\u53f7 admin-user\necho "cHJvbS1vcGVyYXRvcg==" | base64 -d; echo   # \u5bc6\u7801 admin-password\n\n# \u4e00\u6761\u6307\u4ee4\u83b7\u53d6\u7528\u6237\u540d\u5bc6\u7801\nkubectl --namespace monitoring get secrets prometheus-grafana -o jsonpath="{.data.admin-user}" | base64 -d ; echo\nkubectl --namespace monitoring get secrets prometheus-grafana -o jsonpath="{.data.admin-password}" | base64 -d ; echo\n\n'})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95eePrometheus\u76d1\u63a7\u6307\u6807\u9875\u9762","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Prometheus \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:30203"})]}),"\n",(0,o.jsxs)(n.li,{children:["Prometheus \u81ea\u8eab\u6307\u6807 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:30203/metrics"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u6d4b\u8bd5-1",children:"\u6d4b\u8bd5"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u8bbf\u95ee Prometheus \u4e3b\u754c\u9762\n",(0,o.jsx)(n.img,{src:r(39481).A+"",width:"1921",height:"980"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u8bbf\u95ee Prometheus \u81ea\u8eab\u6307\u6807\u9875\u9762\n",(0,o.jsx)(n.img,{src:r(83394).A+"",width:"1905",height:"975"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728 ",(0,o.jsx)(n.code,{children:"Status > Configuration"})," \u9875\u7b7e\u67e5\u770b\u5f53\u524d\u7684prometheus.yaml\n",(0,o.jsx)(n.img,{src:r(4523).A+"",width:"1916",height:"980"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728 ",(0,o.jsx)(n.code,{children:"Status > Target Health"})," \u9875\u7b7e\u67e5\u770b\u5f53\u524d\u7684Targets\uff0c\u5373\u4ece\u54ea\u91cc\u6293\u53d6\u6570\u636e\n",(0,o.jsx)(n.img,{src:r(54612).A+"",width:"1911",height:"979"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728 ",(0,o.jsx)(n.code,{children:"Status > Rule Health"})," \u9875\u7b7e\u67e5\u770b\u5f53\u524d\u914d\u7f6e\u7684\u89c4\u5219\n",(0,o.jsx)(n.img,{src:r(71293).A+"",width:"1915",height:"982"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u8bbf\u95ee Grafana \u4e3b\u754c\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:31145"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u8d26\u53f7 ",(0,o.jsx)(n.code,{children:"admin"})," / ",(0,o.jsx)(n.code,{children:"prom-operator"})," \uff08\u5bc6\u7801\u9700\u8981\u8bfbSecret\u6587\u4ef6\u83b7\u53d6\uff09"]}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{start:"7",children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728Datasource\u9875\u9762\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4\u5c06 Prometheus \u53ca AlertManger \u6dfb\u52a0\u8fdb\u6765\u4e86\n",(0,o.jsx)(n.img,{src:r(90086).A+"",width:"1914",height:"965"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5207\u6362\u5230Dashboards\u83dc\u5355\uff0c\u53ef\u4ee5\u770b\u5230\u9ed8\u8ba4prometheus\u4f1a\u6293\u53d6kubenetes components\u7684metrics\u5982Pod\u7b49\n",(0,o.jsx)(n.img,{src:r(29103).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728 ",(0,o.jsx)(n.code,{children:"Node Exporter / Nodes"})," \u9762\u677f\u4e2d\u53ef\u4ee5\u770b\u5230\u670d\u52a1\u5668\u7684\u76f8\u5173\u4fe1\u606f\n",(0,o.jsx)(n.img,{src:r(4152).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u5728",(0,o.jsx)(n.code,{children:"Kubernetes / Kubelet"})," \u53ef\u4ee5\u770b\u5230K8s\u96c6\u7fa4\u7684\u6574\u4f53\u7edf\u8ba1\u4fe1\u606f\n",(0,o.jsx)(n.img,{src:r(25281).A+"",width:"1920",height:"922"})]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u76f8\u5173\u670d\u52a1-\u8d44\u6e90\u7684\u89e3\u6790",children:"\u76f8\u5173\u670d\u52a1 \u8d44\u6e90\u7684\u89e3\u6790"}),"\n",(0,o.jsx)(n.p,{children:"\u5217\u51fa\u547d\u540d\u7a7a\u95f4\u4e0b\u7684\u6240\u6709\u8d44\u6e90\uff0c\u5305\u62ec\uff1aPod\uff0cService\uff0cDeployment\u7b49\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get all -n monitoring\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 ~]$  kubectl get all -n monitoring\nNAME                                                         READY   STATUS    RESTARTS       AGE\npod/alertmanager-prometheus-kube-prometheus-alertmanager-0   2/2     Running   2 (19h ago)    20h\npod/prometheus-grafana-76cd8bb66b-gwwp8                      3/3     Running   9 (17h ago)    20h\npod/prometheus-kube-prometheus-operator-5cfd684899-hdqf8     1/1     Running   3 (17h ago)    20h\npod/prometheus-kube-state-metrics-74b7dc4795-sx7bv           1/1     Running   16 (65m ago)   20h\npod/prometheus-prometheus-kube-prometheus-prometheus-0       2/2     Running   6 (17h ago)    20h\npod/prometheus-prometheus-node-exporter-9chcv                1/1     Running   0              20h\npod/prometheus-prometheus-node-exporter-mv5t4                1/1     Running   1 (19h ago)    20h\npod/prometheus-prometheus-node-exporter-n2bv8                1/1     Running   0              20h\npod/prometheus-prometheus-node-exporter-r9sgg                1/1     Running   3 (17h ago)    20h\npod/prometheus-prometheus-node-exporter-vt6sg                1/1     Running   0              20h\npod/prometheus-prometheus-node-exporter-zcmql                1/1     Running   5 (17h ago)    20h\n\nNAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                         AGE\nservice/alertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP      20h\nservice/prometheus-grafana                        NodePort    10.101.166.78    <none>        80:31145/TCP                    20h\nservice/prometheus-kube-prometheus-alertmanager   ClusterIP   10.96.67.209     <none>        9093/TCP,8080/TCP               20h\nservice/prometheus-kube-prometheus-operator       ClusterIP   10.99.164.53     <none>        443/TCP                         20h\nservice/prometheus-kube-prometheus-prometheus     NodePort    10.101.131.197   <none>        9090:30203/TCP,8080:31517/TCP   20h\nservice/prometheus-kube-state-metrics             ClusterIP   10.108.139.180   <none>        8080/TCP                        20h\nservice/prometheus-operated                       ClusterIP   None             <none>        9090/TCP                        20h\nservice/prometheus-prometheus-node-exporter       ClusterIP   10.100.224.184   <none>        9100/TCP                        20h\n\nNAME                                                 DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE\ndaemonset.apps/prometheus-prometheus-node-exporter   6         6         4       6            4           kubernetes.io/os=linux   20h\n\nNAME                                                  READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/prometheus-grafana                    1/1     1            1           20h\ndeployment.apps/prometheus-kube-prometheus-operator   1/1     1            1           20h\ndeployment.apps/prometheus-kube-state-metrics         1/1     1            1           20h\n\nNAME                                                             DESIRED   CURRENT   READY   AGE\nreplicaset.apps/prometheus-grafana-76cd8bb66b                    1         1         1       20h\nreplicaset.apps/prometheus-kube-prometheus-operator-5cfd684899   1         1         1       20h\nreplicaset.apps/prometheus-kube-state-metrics-74b7dc4795         1         1         1       20h\n\nNAME                                                                    READY   AGE\nstatefulset.apps/alertmanager-prometheus-kube-prometheus-alertmanager   1/1     20h\nstatefulset.apps/prometheus-prometheus-kube-prometheus-prometheus       1/1     20h\n\nNAME                            STATUS   COMPLETIONS   DURATION   AGE\njob.batch/loki-minio-post-job   Failed   0/1           63m        63m\n[diginn@k8s-master-01 ~]$\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"statefulsetdeploymentdaemonset",children:"statefulset\uff0cdeployment\uff0cdaemonset"}),"\n",(0,o.jsx)(n.p,{children:"\u5176\u4e2dstatefulset\u8d44\u6e90\u6709\u4e24\u4e2a\uff1a"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"statefulset.apps/prometheus-prometheus-kube-prometheus-prometheus"}),"\uff0c\u662fPrometheus\u4e09\u4e2aserver\uff08\u5373Retrival\uff0cStorage\uff0cHTTP Server\uff09\uff0c\u540d\u5b57\u4e2d\u95f4\u6709operator\uff0c\u8868\u793a\u8fd9\u4e2aprometheus\u5f52operator\u7ba1\u7406\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"statefulset.apps/alertmanager-prometheus-kube-prometheus-alertmanager"}),"\uff0c\u987e\u540d\u601d\u8bae\u662falert manager\uff0c\u4e5f\u662f\u5f52operator\u7ba1\u7406\u3002"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"deployment\u4e09\u4e2a\uff1a"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"deployment.apps/prometheus-kube-prometheus-operator"})," prometheus operator\u81ea\u5df1\u7684\u5b89\u88c5\u6e05\u5355\uff0c\u901a\u8fc7\u5b83\u521b\u5efa\u4e86Prometheus\u548cAlertmanager\u7684statefulset\uff08\u4e5f\u5c31\u662f\u4e0a\u9762\u4e24\u4e2astatefulset\uff09\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"deployment.apps/prometheus-grafana"})," grafana\u76f8\u5173\u7684\u5b89\u88c5\u6e05\u5355\uff0c"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"deployment.apps/prometheus-kube-state-metrics"})," \u5f53\u524d\u8fd9\u4e2aHelm chart\u76f8\u5173\u7684\uff0c\u5b83\u7528\u6765\u6293\u53d6k8s\u5f53\u524d\u7684cluster\u672c\u8eabcomponent\u76f8\u5173\u7684metrics\uff0c\u7528\u6765\u6d4b\u68c0\u5f53\u524ddeployment, statefulset, pod\u7684\u662f\u5426\u5065\u5eb7\uff0c\u8fd9\u4e9bmetrics\u6570\u636e\u53ef\u4ee5\u5728prometheus\u4e2d\u88ab\u5c55\u793a\u51fa\u6765\u3002"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Daemonset\u4f1a\u5728\u6bcf\u4e2akubernetes\u7684Worker\u8282\u70b9\u4e0a\u8fd0\u884c\u3002\u5f53\u524d\u7684\u8fd9\u4e2aprometheus daemenset\u7684\u4f5c\u7528\u662f\u4f1a\u628aWorker\u8282\u70b9\u4e0a\u7684\u6570\u636e\uff08\u6bd4\u5982cpu\u4f7f\u7528\u7387\u7b49\uff09\u8f6c\u5316\u4e3aPrometheus\u7684metrics\u683c\u5f0f\u7684\u6570\u636e\u3002"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"\u6ce8\uff1a"})," \u8fd9\u4e2aDaemonset\u8fd8\u9700\u8981\u548c",(0,o.jsx)(n.code,{children:"pod=pod/prometheus-prometheus-node-exporter-9chcv"}),"\u5408\u4f5c\u8fdb\u884c\u5de5\u4f5c\u3002"]}),"\n",(0,o.jsx)(n.h3,{id:"configmap-secret",children:"configmap, secret"}),"\n",(0,o.jsx)(n.p,{children:"\u9664\u4e86\u4e0a\u8ff0\u7684\u8d44\u6e90\uff0c\u8fd8\u5b89\u88c5\u4e86\u4e00\u4e9bconfigmap\uff0c\u8fd9\u4e9b\u914d\u7f6e\u6709\u4e9b\u662foperator\u76f8\u5173\u7684\uff0c\u914d\u7f6e\u4e86\u9ed8\u8ba4\u7684metrics\u8fde\u63a5\u7b49\u7b49\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get configmap -n monitoring\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 ~]$ kubectl get configmap -n monitoring\nNAME                                                           DATA   AGE\nkube-root-ca.crt                                               1      20h\nprometheus-grafana                                             1      20h\nprometheus-grafana-config-dashboards                           1      20h\nprometheus-kube-prometheus-alertmanager-overview               1      20h\nprometheus-kube-prometheus-apiserver                           1      20h\nprometheus-kube-prometheus-cluster-total                       1      20h\nprometheus-kube-prometheus-controller-manager                  1      20h\nprometheus-kube-prometheus-etcd                                1      20h\nprometheus-kube-prometheus-grafana-datasource                  1      20h\nprometheus-kube-prometheus-grafana-overview                    1      20h\nprometheus-kube-prometheus-k8s-coredns                         1      20h\nprometheus-kube-prometheus-k8s-resources-cluster               1      20h\nprometheus-kube-prometheus-k8s-resources-multicluster          1      20h\nprometheus-kube-prometheus-k8s-resources-namespace             1      20h\nprometheus-kube-prometheus-k8s-resources-node                  1      20h\nprometheus-kube-prometheus-k8s-resources-pod                   1      20h\nprometheus-kube-prometheus-k8s-resources-workload              1      20h\nprometheus-kube-prometheus-k8s-resources-workloads-namespace   1      20h\nprometheus-kube-prometheus-kubelet                             1      20h\nprometheus-kube-prometheus-namespace-by-pod                    1      20h\nprometheus-kube-prometheus-namespace-by-workload               1      20h\nprometheus-kube-prometheus-node-cluster-rsrc-use               1      20h\nprometheus-kube-prometheus-node-rsrc-use                       1      20h\nprometheus-kube-prometheus-nodes                               1      20h\nprometheus-kube-prometheus-nodes-aix                           1      20h\nprometheus-kube-prometheus-nodes-darwin                        1      20h\nprometheus-kube-prometheus-persistentvolumesusage              1      20h\nprometheus-kube-prometheus-pod-total                           1      20h\nprometheus-kube-prometheus-prometheus                          1      20h\nprometheus-kube-prometheus-proxy                               1      20h\nprometheus-kube-prometheus-scheduler                           1      20h\nprometheus-kube-prometheus-workload-total                      1      20h\nprometheus-prometheus-kube-prometheus-prometheus-rulefiles-0   35     20h\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"secrets\u76f8\u5173\u7684\u8d44\u6e90\uff0c\u5b58\u653eGrafana, Prometheus, Operator\u76f8\u5173\u7684\u654f\u611f\u6570\u636e\uff08username, password\u7b49\uff09\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get secret -n monitoring\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 ~]$ kubectl get secret -n monitoring\nNAME                                                                                  TYPE                 DATA   AGE\nalertmanager-prometheus-kube-prometheus-alertmanager                                  Opaque               1      20h\nalertmanager-prometheus-kube-prometheus-alertmanager-cluster-tls-config               Opaque               1      20h\nalertmanager-prometheus-kube-prometheus-alertmanager-generated                        Opaque               1      20h\nalertmanager-prometheus-kube-prometheus-alertmanager-tls-assets-0                     Opaque               0      20h\nalertmanager-prometheus-kube-prometheus-alertmanager-web-config                       Opaque               1      20h\nprometheus-grafana                                                                    Opaque               3      20h\nprometheus-kube-prometheus-admission                                                  Opaque               3      20h\nprometheus-prometheus-kube-prometheus-prometheus                                      Opaque               1      20h\nprometheus-prometheus-kube-prometheus-prometheus-thanos-prometheus-http-client-file   Opaque               1      20h\nprometheus-prometheus-kube-prometheus-prometheus-tls-assets-0                         Opaque               1      20h\nprometheus-prometheus-kube-prometheus-prometheus-web-config                           Opaque               1      20h\nsh.helm.release.v1.prometheus.v1                                                      helm.sh/release.v1   1      20h\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"crds",children:"CRDs"}),"\n",(0,o.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\u8fd8\u521b\u5efa\u4e86\u4e0d\u5c11\u7684CRD\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get crd -n monitoring\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 ~]$ kubectl get crd -n monitoring\nNAME                                                  CREATED AT\nalertmanagerconfigs.monitoring.coreos.com             2025-06-10T06:50:22Z\nalertmanagers.monitoring.coreos.com                   2025-06-10T06:50:22Z\nbgpconfigurations.crd.projectcalico.org               2025-04-01T02:59:52Z\nbgppeers.crd.projectcalico.org                        2025-04-01T02:59:52Z\nblockaffinities.crd.projectcalico.org                 2025-04-01T02:59:52Z\ncaliconodestatuses.crd.projectcalico.org              2025-04-01T02:59:52Z\ncephblockpoolradosnamespaces.ceph.rook.io             2025-06-04T07:20:00Z\ncephblockpools.ceph.rook.io                           2025-06-04T07:20:00Z\ncephbucketnotifications.ceph.rook.io                  2025-06-04T07:20:00Z\ncephbuckettopics.ceph.rook.io                         2025-06-04T07:20:00Z\ncephclients.ceph.rook.io                              2025-06-04T07:20:00Z\ncephclusters.ceph.rook.io                             2025-06-04T07:20:00Z\ncephcosidrivers.ceph.rook.io                          2025-06-04T07:20:00Z\ncephfilesystemmirrors.ceph.rook.io                    2025-06-04T07:20:00Z\ncephfilesystems.ceph.rook.io                          2025-06-04T07:20:00Z\ncephfilesystemsubvolumegroups.ceph.rook.io            2025-06-04T07:20:00Z\ncephnfses.ceph.rook.io                                2025-06-04T07:20:00Z\ncephobjectrealms.ceph.rook.io                         2025-06-04T07:20:00Z\ncephobjectstores.ceph.rook.io                         2025-06-04T07:20:00Z\ncephobjectstoreusers.ceph.rook.io                     2025-06-04T07:20:00Z\ncephobjectzonegroups.ceph.rook.io                     2025-06-04T07:20:00Z\ncephobjectzones.ceph.rook.io                          2025-06-04T07:20:00Z\ncephrbdmirrors.ceph.rook.io                           2025-06-04T07:20:00Z\nclusterinformations.crd.projectcalico.org             2025-04-01T02:59:52Z\nfelixconfigurations.crd.projectcalico.org             2025-04-01T02:59:52Z\nglobalnetworkpolicies.crd.projectcalico.org           2025-04-01T02:59:53Z\nglobalnetworksets.crd.projectcalico.org               2025-04-01T02:59:53Z\nhostendpoints.crd.projectcalico.org                   2025-04-01T02:59:53Z\ningressclassparameterses.configuration.konghq.com     2025-04-01T03:08:43Z\nipamblocks.crd.projectcalico.org                      2025-04-01T02:59:53Z\nipamconfigs.crd.projectcalico.org                     2025-04-01T02:59:53Z\nipamhandles.crd.projectcalico.org                     2025-04-01T02:59:53Z\nippools.crd.projectcalico.org                         2025-04-01T02:59:53Z\nipreservations.crd.projectcalico.org                  2025-04-01T02:59:54Z\nkongclusterplugins.configuration.konghq.com           2025-04-01T03:08:43Z\nkongconsumergroups.configuration.konghq.com           2025-04-01T03:08:43Z\nkongconsumers.configuration.konghq.com                2025-04-01T03:08:43Z\nkongingresses.configuration.konghq.com                2025-04-01T03:08:43Z\nkonglicenses.configuration.konghq.com                 2025-04-01T03:08:43Z\nkongplugins.configuration.konghq.com                  2025-04-01T03:08:43Z\nkongupstreampolicies.configuration.konghq.com         2025-04-01T03:08:43Z\nkongvaults.configuration.konghq.com                   2025-04-01T03:08:43Z\nkubecontrollersconfigurations.crd.projectcalico.org   2025-04-01T02:59:54Z\nnetworkpolicies.crd.projectcalico.org                 2025-04-01T02:59:54Z\nnetworksets.crd.projectcalico.org                     2025-04-01T02:59:54Z\nobjectbucketclaims.objectbucket.io                    2025-06-04T07:20:00Z\nobjectbuckets.objectbucket.io                         2025-06-04T07:20:00Z\npodmonitors.monitoring.coreos.com                     2025-06-10T06:50:22Z\nprobes.monitoring.coreos.com                          2025-06-10T06:50:22Z\nprometheusagents.monitoring.coreos.com                2025-06-10T06:50:23Z\nprometheuses.monitoring.coreos.com                    2025-06-10T06:50:23Z\nprometheusrules.monitoring.coreos.com                 2025-06-10T06:50:23Z\nscrapeconfigs.monitoring.coreos.com                   2025-06-10T06:50:24Z\nservicemonitors.monitoring.coreos.com                 2025-06-10T06:50:24Z\ntcpingresses.configuration.konghq.com                 2025-04-01T03:08:43Z\nthanosrulers.monitoring.coreos.com                    2025-06-10T06:50:24Z\nudpingresses.configuration.konghq.com                 2025-04-01T03:08:43Z\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5176\u4e2d",(0,o.jsx)(n.code,{children:"prometheuses.monitoring.coreos.com"}),"\u4e0e\u662f",(0,o.jsx)(n.code,{children:"ServiceMonitor"}),"\u5b9a\u4e49\u7684API\uff0c\u4e0eTarget\u81ea\u52a8\u53d1\u73b0\u6709\u5173\u3002\u6bd4\u5982\u6211\u4eec\u9700\u8981\u4e0eSpring Boot\u9879\u76ee\u96c6\u6210\uff0c\u5c31\u53ef\u80fd\u9700\u8981\u521b\u5efa\u81ea\u5df1\u7684ServiceMonitor\u3002"]}),"\n",(0,o.jsx)(n.h2,{id:"\u67e5\u770bprometheus\u914d\u7f6e",children:"\u67e5\u770bPrometheus\u914d\u7f6e"}),"\n",(0,o.jsx)(n.p,{children:"\u5bfc\u51fa\u4e0a\u8ff0\u7684statefulset\u7684\u5177\u4f53\u63cf\u8ff0\u4ee5\u53caoperator deployment\u7684\u63cf\u8ff0\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl describe statefulset prometheus-prometheus-kube-prometheus-prometheus -n monitoring > prometheus.yaml\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u5148\u770bstatefulset\u4e3aprometheus\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u770b\u5230\u4f7f\u7528\u7684\u662fv3.4.1\u7248\u672c\u7684prometheus\uff0c\u7aef\u53e3\u4e3a9090\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"Containers:\n  prometheus:\n    Image:      quay.io/prometheus/prometheus:v3.4.1\n    Port:       9090/TCP\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u53e6\u5916\u8fd8\u6709\u4e00\u4e9bmount\u76ee\u5f55\uff0c\u6bd4\u5982\u5728rules\u76ee\u5f55\u4e0b\u6709\u4e00\u4e9b\u89c4\u5219\u7684\u6587\u4ef6\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'Mounts:\n  /etc/prometheus/certs from tls-assets (ro)\n  /etc/prometheus/config_out from config-out (ro)\n  /etc/prometheus/rules/prometheus-prometheus-kube-prometheus-prometheus-rulefiles-0 from prometheus-prometheus-kube-prometheus-prometheus-rulefiles-0 (rw)\n  /etc/prometheus/web_config/web-config.yaml from web-config (ro,path="web-config.yaml")\n  /prometheus from prometheus-prometheus-kube-prometheus-prometheus-db (rw)\n\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5982\u679cprometheus\u76f8\u5173\u7684\u914d\u7f6e\u6709\u6539\u52a8\uff0cconfig-reloader\u8d1f\u8d23\u91cd\u65b0\u52a0\u8f7d\u8fd9\u4e9bconfig\uff0c\u53ef\u4ee5\u770b\u5230config\u901a\u8fc7pod\u5185\u7684\u76ee\u5f55\u6587\u4ef6",(0,o.jsx)(n.code,{children:"/etc/prometheus/config/prometheus.yaml"}),"\u8bfb\u53d6\u8fdb\u6765\u7684\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"config-reloader:\n  Image:      quay.io/prometheus-operator/prometheus-config-reloader:v0.82.2\n  Port:       8080/TCP\n  Host Port:  0/TCP\n  Command:\n    /bin/prometheus-config-reloader\n  Args:\n    --listen-address=:8080\n    --reload-url=http://127.0.0.1:9090/-/reload\n    --config-file=/etc/prometheus/config/prometheus.yaml.gz\n    --config-envsubst-file=/etc/prometheus/config_out/prometheus.env.yaml\n    --watched-dir=/etc/prometheus/rules/prometheus-prometheus-kube-prometheus-prometheus-rulefiles-0\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u81f3\u4e8e",(0,o.jsx)(n.code,{children:"prometheus.yaml"}),"\u662f\u600e\u4e48\u88ab\u52a0\u8f7d\u5230prometheus pod\u5185\u90e8\u76ee\u5f55",(0,o.jsx)(n.code,{children:"/etc/prometheus/config"}),"\u7684\uff0c\u53ef\u4ee5\u67e5\u770bconfig-reloader\u7684Mounts\u914d\u7f6e\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"Mounts:\n  /etc/prometheus/config from config (rw)\n  /etc/prometheus/config_out from config-out (rw)\n  /etc/prometheus/rules/prometheus-prometheus-kube-prometheus-prometheus-rulefiles-0 from prometheus-prometheus-kube-prometheus-prometheus-rulefiles-0 (rw)\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230",(0,o.jsx)(n.code,{children:"/etc/prometheus/config"}),"\u662f\u4ece",(0,o.jsx)(n.code,{children:"volumn=config"}),"\u52a0\u8f7d\u6765\u7684\u3002\u67e5\u770bvolumn\u914d\u7f6e\uff0cvolumn ",(0,o.jsx)(n.code,{children:"name=config"}),"\u7684\uff0ctype\u662f",(0,o.jsx)(n.code,{children:"secret"}),"\uff0c",(0,o.jsx)(n.code,{children:"name=prometheus-prometheus-kube-prometheus-prometheus"}),"\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"Volumes:\n  config:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  prometheus-prometheus-kube-prometheus-prometheus\n    Optional:    false\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u901a\u8fc7\u547d\u4ee4\u67e5\u770b",(0,o.jsx)(n.code,{children:"secret=prometheus-prometheus-kube-prometheus-prometheus"}),"\uff0c\u4ee5yaml\u683c\u5f0f\u5bfc\u51fa\uff0c\u53ef\u4ee5\u67e5\u770b\u8be5secret\u76f8\u5173\u7684\u914d\u7f6e\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'kubectl get secret prometheus-prometheus-kube-prometheus-prometheus -o yaml -n monitoring > secret.yaml\n\nkubectl --namespace monitoring get secrets prometheus-prometheus-kube-prometheus-prometheus -o jsonpath="{.data.prometheus.yaml.gz}" | base64 -d ; echo\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u540c\u6837\u7684\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u53e6\u5916\u4e24\u4e2a\u4e3b\u8981\u7684\u914d\u7f6e\u8fdb\u884c\u5bfc\u51fa\u67e5\u770b\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl describe statefulset alertmanager-prometheus-kube-prometheus-alertmanager -n monitoring > alertmanager.yaml\n\n\nkubectl describe deployment prometheus-kube-prometheus-operator -n monitoring > operator.yaml\n"})}),"\n",(0,o.jsx)(n.h1,{id:"\u9879\u76ee\u76d1\u63a7\u5b9e\u64cd",children:"\u9879\u76ee\u76d1\u63a7\u5b9e\u64cd"}),"\n",(0,o.jsx)(n.h2,{id:"\u5b89\u88c5prometheus--grafana",children:"\u5b89\u88c5Prometheus + Grafana"}),"\n",(0,o.jsx)(n.p,{children:"\u6b65\u9aa4\u7701\u7565\uff0c\u53c2\u8003\u524d\u9762\u3010Kubernetes\u5b89\u88c5\u3011\u7ae0\u8282"}),"\n",(0,o.jsx)(n.h2,{id:"spring-boot\u9879\u76ee\u4fee\u6539",children:"Spring Boot\u9879\u76ee\u4fee\u6539"}),"\n",(0,o.jsx)(n.h3,{id:"\u6dfb\u52a0\u4f9d\u8d56",children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"\x3c!-- \u5f00\u542f Spring Boot Actuator --\x3e\n<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-actuator</artifactId>\n</dependency>\n\x3c!-- \u5c06 Actuator \u6307\u6807\u8f6c\u6362\u4e3a Prometheus \u683c\u5f0f --\x3e\n<dependency>\n  <groupId>io.micrometer</groupId>\n  <artifactId>micrometer-registry-prometheus</artifactId>\n  <version>${micrometer.version}</version>\n</dependency>\n"})}),"\n",(0,o.jsxs)(n.h3,{id:"\u4fee\u6539-applicationyaml-\u4e2d\u6dfb\u52a0-spring-boot-actuator-\u76f8\u5173\u914d\u7f6e",children:["\u4fee\u6539 ",(0,o.jsx)(n.code,{children:"application.yaml"})," \u4e2d\u6dfb\u52a0 Spring Boot Actuator \u76f8\u5173\u914d\u7f6e"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'spring:\n  application:\n    name: pd-service-hzctm\n\n# \u5f00\u653e Actuator \u7ba1\u7406\u7aef\u70b9\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n    health:\n      show-details: always\n  metrics:\n    export:\n      prometheus:\n        enable: true\n    tags:\n      application: ${spring.application.name}\n\n'})}),"\n",(0,o.jsxs)(n.h3,{id:"\u901a\u8fc7-actuatorprometheus-\u6d4b\u8bd5\u914d\u7f6e\u662f\u5426\u6b63\u786e",children:["\u901a\u8fc7 ",(0,o.jsx)(n.code,{children:"/actuator/prometheus"})," \u6d4b\u8bd5\u914d\u7f6e\u662f\u5426\u6b63\u786e\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"curl -X GET -i 'http://localhost:31121/hzpublic/actuator/prometheus'\ncurl -X GET -i 'http://localhost:31122/hzctm/actuator/prometheus'\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u67e5\u8be2\u7ed3\u679c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u5c06\u6240\u6709\u66b4\u9732\u7684\u7aef\u70b9\u6570\u636e\u90fd\u5c55\u793a\u51fa\u6765\u4e86\n",(0,o.jsx)(n.img,{src:r(61827).A+"",width:"1631",height:"917"})]}),"\n",(0,o.jsxs)(n.h3,{id:"k8s-\u90e8\u7f72\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u4e3b\u8981\u662f-service-\u548c-deployment-\u4e2d\u6807\u7b7e\u7684\u5bf9\u5e94",children:["K8s \u90e8\u7f72\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\uff0c\u4e3b\u8981\u662f ",(0,o.jsx)(n.code,{children:"Service"})," \u548c ",(0,o.jsx)(n.code,{children:"Deployment"})," \u4e2d\u6807\u7b7e\u7684\u5bf9\u5e94"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-diff",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: svc-dz-service-hzpublic\n  namespace: hz-dev-service\n+  labels:\n+    app: hz-service-hzpublic\n+    job: hz-service-hzpublic-job\nspec:\n  type: NodePort\n  selector:\n    app: hz-service-hzpublic\n  ports:\n    - name: http\n      port: 31121\n      targetPort: 31121\n-      nodePort: 30121\n+      nodePort: 31121\n\n+ ---\n+ apiVersion: monitoring.coreos.com/v1\n+ kind: ServiceMonitor\n+ metadata:\n+   name: svc-dz-service-hzpublic\n+   namespace: hz-dev-service\n+   labels:\n+     app: hz-service-hzpublic\n+     release: prometheus\n+ spec:\n+   jobLabel: job\n+   endpoints:\n+     - interval: 5s\n+       path: /hzpublic/actuator/prometheus\n+       port: http\n+   namespaceSelector:\n+     any: true\n+   selector:\n+     matchLabels:\n+       app: hz-service-hzpublic\n+       job: hz-service-hzpublic-job\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hz-dev-service-hzpublic\n  namespace: hz-dev-service\nspec:\n  minReadySeconds: 50\n  revisionHistoryLimit: 3\n  strategy:\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 0\n  replicas: 1\n  selector:\n    matchLabels:\n      app: hz-service-hzpublic\n      version: "1.0.0"\n  template:\n    metadata:\n      labels:\n        app: hz-service-hzpublic\n        version: "1.0.0"\n+      annotations:\n+        promtail.io/scrape: "true" # promtail\u7b5b\u9009\u6807\u7b7e\uff0c\u9700\u8981\u8bbe\u7f6escrape\u4e3atrue\n+        promtail.io/path: "/logs/pd-service-hzpublic-all.log" # \u65e5\u5fd7\u6587\u4ef6\u7684\u8def\u5f84\u540d\u79f0\n    spec:\n      imagePullSecrets:\n        - name: pisxdocker\n      containers:\n        - name: hz-service-hzpublic\n-          image: 192.168.1.210:5000/library/pd-service-hzpublic:1.0.0\n-          imagePullPolicy: Always\n+          image: 192.168.1.210:5000/library/pd-service-hzpublic:prom-1.0.0\n+          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 31121\n          volumeMounts:\n            - name: logs-hz-service-hzpublic\n              mountPath: /logs\n          # \u542f\u52a8\u63a2\u9488\uff0c\u68c0\u6d4b\u7cfb\u7edf\u662f\u5426\u542f\u52a8\u6210\u529f\n          startupProbe:\n            httpGet:\n              path: /hzpublic/actuator/health/readiness\n              port: 31121\n            periodSeconds: 10 # \u63a2\u6d4b\u65f6\u95f4\u95f4\u9694\n            timeoutSeconds: 5 # \u8d85\u65f6\u65f6\u95f4\n            failureThreshold: 30 # \u91cd\u8bd5\u6b21\u6570\n          # \u5b58\u6d3b\u63a2\u9488\uff0c\u68c0\u6d4b\u7cfb\u7edf\u662f\u5426\u5b58\u6d3b\n          livenessProbe:\n            httpGet:\n              path: /hzpublic/actuator/health/liveness\n              port: 31121\n            initialDelaySeconds: 30\n            periodSeconds: 10\n            timeoutSeconds: 20\n            failureThreshold: 5\n          resources:\n            limits:\n              cpu: "2"\n              memory: "2048Mi"\n              ephemeral-storage: "2Gi"\n            requests:\n              cpu: "0.2"\n              memory: "1024Mi"\n          env:\n            - name: TZ\n              value: \'Asia/Shanghai\'\n      volumes:\n        - name: logs-hz-service-hzpublic\n          hostPath:\n            path: /data/logs\n\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u9700\u8981\u6ce8\u610f ",(0,o.jsx)(n.code,{children:"spec.selector"})," \u9700\u8981\u4e0e ",(0,o.jsx)(n.code,{children:"Pod"})," \u7684\u6807\u7b7e\u5bf9\u5e94\u3002\u4f8b\u5982\u4f7f\u7528 ",(0,o.jsx)(n.code,{children:"Deployment"})," \u90e8\u7f72\u5e94\u7528\uff0c\u5219\u9700\u8981\u4e0e ",(0,o.jsx)(n.code,{children:"Deployment"})," \u7684 ",(0,o.jsx)(n.code,{children:"spec.template.metadata.labels"})," \u5bf9\u5e94\uff0c\u8fd9\u6837 ",(0,o.jsx)(n.code,{children:"Service"})," \u624d\u80fd\u77e5\u9053\u5bf9\u5e94\u7684 ",(0,o.jsx)(n.code,{children:"Pod"})]}),"\n",(0,o.jsx)(n.h3,{id:"\u6784\u5efa\u5bb9\u5668\u955c\u50cf\u5e76\u90e8\u7f72\u5230k8s",children:"\u6784\u5efa\u5bb9\u5668\u955c\u50cf\u5e76\u90e8\u7f72\u5230K8s"}),"\n",(0,o.jsxs)(n.p,{children:["\u6784\u5efaDocker\u955c\u50cf\u7684 ",(0,o.jsx)(n.code,{children:"Dockerfile"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-Dockerfile",children:'FROM 192.168.1.210:5000/azul/zulu-openjdk-centos:17-jre-latest\nVOLUME /tmp\nADD pd-service-hzpublic.jar /\nENV JAVA_OPTS="-Xms1g -Xmx1g -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=512m \\\n           -Duser.timezone=Asia/Shanghai \\\n           -Dfile.encoding=UTF-8 \\\n           -Dsun.jnu.encoding=UTF-8 \\\n           -Djava.awt.headless=true \\\n           --add-modules java.se \\\n           --add-opens java.base/java.lang=ALL-UNNAMED \\\n           --add-opens java.base/sun.nio.ch=ALL-UNNAMED \\\n           --add-opens java.management/sun.management=ALL-UNNAMED \\\n           --add-opens jdk.management/com.sun.management.internal=ALL-UNNAMED \\\n           --add-exports java.base/jdk.internal.ref=ALL-UNNAMED"\nENTRYPOINT java ${JAVA_OPTS} -jar /pd-service-hzpublic.jar\n\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5e94\u7528\u90e8\u7f72\u7684 ",(0,o.jsx)(n.code,{children:"k8s-dev.yaml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: Service\nmetadata:\n  name: svc-hz-service-hzpublic\n  namespace: hz-dev-service\n  labels:\n    app: hz-service-hzpublic\n    job: hz-service-hzpublic-job\nspec:\n  type: NodePort\n  selector:\n    app: hz-service-hzpublic\n  ports:\n    - name: http\n      port: 31121\n      targetPort: 31121\n      nodePort: 31121\n\n---\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: svc-dz-service-hzpublic\n  namespace: hz-dev-service\n  labels:\n    app: hz-service-hzpublic\n    release: prometheus\nspec:\n  jobLabel: job\n  endpoints:\n    - interval: 5s\n      path: /hzpublic/actuator/prometheus\n      port: http\n  namespaceSelector:\n    any: true\n  selector:\n    matchLabels:\n      app: hz-service-hzpublic\n      job: hz-service-hzpublic-job\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: hz-dev-service-hzpublic\n  namespace: hz-dev-service\nspec:\n  minReadySeconds: 50\n  revisionHistoryLimit: 3\n  strategy:\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 0\n  replicas: 1\n  selector:\n    matchLabels:\n      app: hz-service-hzpublic\n      version: "1.0.0"\n  template:\n    metadata:\n      labels:\n        app: hz-service-hzpublic\n        version: "1.0.0"\n      annotations:\n        promtail.io/scrape: "true" # promtail\u7b5b\u9009\u6807\u7b7e\uff0c\u9700\u8981\u8bbe\u7f6escrape\u4e3atrue\n        promtail.io/path: "/logs/pd-service-hzpublic-all.log" # \u65e5\u5fd7\u6587\u4ef6\u7684\u8def\u5f84\u540d\u79f0\n    spec:\n      imagePullSecrets:\n        - name: pisxdocker\n      containers:\n        - name: hz-service-hzpublic\n          image: 192.168.1.210:5000/library/pd-service-hzpublic:prom-1.0.0\n          imagePullPolicy: IfNotPresent\n          ports:\n            - containerPort: 31121\n          volumeMounts:\n            - name: logs-hz-service-hzpublic\n              mountPath: /logs\n          # \u542f\u52a8\u63a2\u9488\uff0c\u68c0\u6d4b\u7cfb\u7edf\u662f\u5426\u542f\u52a8\u6210\u529f\n          startupProbe:\n            httpGet:\n              path: /hzpublic/actuator/health/readiness\n              port: 31121\n            periodSeconds: 10 # \u63a2\u6d4b\u65f6\u95f4\u95f4\u9694\n            timeoutSeconds: 5 # \u8d85\u65f6\u65f6\u95f4\n            failureThreshold: 30 # \u91cd\u8bd5\u6b21\u6570\n          # \u5b58\u6d3b\u63a2\u9488\uff0c\u68c0\u6d4b\u7cfb\u7edf\u662f\u5426\u5b58\u6d3b\n          livenessProbe:\n            httpGet:\n              path: /hzpublic/actuator/health/liveness\n              port: 31121\n            initialDelaySeconds: 30\n            periodSeconds: 10\n            timeoutSeconds: 20\n            failureThreshold: 5\n          resources:\n            limits:\n              cpu: "2"\n              memory: "2048Mi"\n              ephemeral-storage: "2Gi"\n            requests:\n              cpu: "0.2"\n              memory: "1024Mi"\n          env:\n            - name: TZ\n              value: \'Asia/Shanghai\'\n      volumes:\n        - name: logs-hz-service-hzpublic\n          hostPath:\n            path: /data/logs\n\n'})}),"\n",(0,o.jsx)(n.p,{children:"\u7f16\u8bd1\u955c\u50cf\u5e76\u4f7f\u7528K8s\u90e8\u7f72\u5e94\u7528"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u62c9\u53d6\u57fa\u7840\u955c\u50cf\ndocker pull azul/zulu-openjdk-centos:17-jre-latest\n\n# \u91cd\u65b0\u6253tag\ndocker tag azul/zulu-openjdk-centos:17-jre-latest 192.168.1.210:5000/azul/zulu-openjdk-centos:17-jre-latest\n\n# \u6784\u5efa\u955c\u50cf\ndocker build -t 192.168.1.210:5000/library/pd-service-hzpublic:prom-1.0.0 .\n\n# \u5bfc\u51fa\u955c\u50cf\ndocker save 192.168.1.210:5000/library/pd-service-hzpublic:prom-1.0.0 -o pd-service-hzpublic_prom-1.0.0.tar\n\n# \u53d1\u9001\u5230\u96c6\u7fa4\u5176\u4ed6\u8282\u70b9\nscp zulu-openjdk-centos_17-jre-latest.tar diginn@192.168.137.122:/home/diginn\nscp pd-service-hzpublic_prom-1.0.0.tar diginn@192.168.137.122:/home/diginn\n\n# \u5728\u96c6\u7fa4\u5176\u4ed6\u8282\u70b9\u5bfc\u5165\u955c\u50cf\ndocker load -i zulu-openjdk-centos_17-jre-latest.tar\ndocker load -i pd-service-hzpublic_prom-1.0.0.tar\n\n# \u521b\u5efa\u547d\u540d\u7a7a\u95f4\nkubectl create namespace hz-dev-service\nkubectl get namespace hz-dev-service\n\n# \u5982\u6709\u9700\u8981\uff0c\u5148\u5220\u9664\u518d\u90e8\u7f72\u670d\u52a1\nkubectl delete -f k8s-dev.yaml\nkubectl apply -f k8s-dev.yaml\n\n# \u67e5\u8be2Pod\nkubectl get pods -n hz-dev-service -o wide\n\n# \u67e5\u8be2pod\u8be6\u7ec6\u4fe1\u606f\nkubectl describe pod hz-dev-service-hzpublic-85d4549b5f-w9vd2 -n hz-dev-service\n\n# \u67e5\u770bPod\u65e5\u5fd7\nkubectl logs hz-dev-service-hzpublic-85d4549b5f-w9vd2 -n hz-dev-service\n\n# \u8fdb\u5165\u547d\u4ee4\u884c\u4ea4\u4e92\u6a21\u5f0f\uff0c\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u7684\u4f4d\u7f6e\nkubectl exec -it hz-dev-service-hzpublic-85d4549b5f-w9vd2 -n hz-dev-service -- /bin/bash\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u6d4b\u8bd5\u8c03\u7528prometheus\u7aef\u70b9 ",(0,o.jsx)(n.code,{children:"/actuator/prometheus"})," \u83b7\u53d6\u72b6\u6001\u4fe1\u606f"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u83b7\u53d6\u670d\u52a1\u7684\u8fd0\u884c\u7aef\u53e3\u4fe1\u606f\nkubectl get services -n hz-dev-service -o wide\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 services]$ kubectl get services -n hz-dev-service -o wide\nNAME                      TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)           AGE     SELECTOR\nsvc-dz-service-hzpublic   NodePort   10.101.31.91   <none>        31121:31121/TCP   7m13s   app=hz-service-hzpublic\n\n# \u8c03\u7528\u7aef\u70b9\ncurl -X GET -i 'http://192.168.137.121:31121/hzpublic/actuator/prometheus'\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\u548c\u672c\u5730\u8fd0\u884c\u6d4b\u8bd5\u4e00\u81f4\uff0c\u83b7\u53d6\u5230\u4e86\u5f00\u53d1\u7684\u6307\u6807\u4fe1\u606f\n",(0,o.jsx)(n.img,{src:r(83496).A+"",width:"1919",height:"909"})]}),"\n",(0,o.jsx)(n.h2,{id:"prometheus\u914d\u7f6e\u4fee\u6539",children:"Prometheus\u914d\u7f6e\u4fee\u6539"}),"\n",(0,o.jsx)(n.h3,{id:"\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\u9488\u5bf9\u624b\u52a8\u6620\u5c04\u914d\u7f6e\u5230\u5bb9\u5668\u573a\u666f",children:"\u914d\u7f6e\u6587\u4ef6\u4fee\u6539\uff08\u9488\u5bf9\u624b\u52a8\u6620\u5c04\u914d\u7f6e\u5230\u5bb9\u5668\u573a\u666f\uff09"}),"\n",(0,o.jsxs)(n.p,{children:["\u5982\u679c\u662f\u624b\u52a8\u6620\u5c04\u672c\u5730\u914d\u7f6e\u6587\u4ef6\u5230prometheus\u5bb9\u5668\u4e2d\uff0c\u5219\u76f4\u63a5\u4fee\u6539\u672c\u5730\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\uff0c\u5728 ",(0,o.jsx)(n.code,{children:"prometheus.yaml"})," \u4e2d\u6dfb\u52a0\u4e0a Service \u5bf9\u5e94\u7684\u4efb\u52a1"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"scrape_configs:\n  # ...\n  -  job_name: 'pd-service-hzpublic' # Prometheus \u4efb\u52a1\u540d\u79f0\uff0c\u81ea\u5b9a\u4e49\n     metrics_path: '/hzpublic/actuator/prometheus' # \u6307\u6807\u83b7\u53d6\u8def\u5f84\n     scrape_interval: 5s # \u6293\u53d6\u6307\u6807\u7684\u95f4\u9694\u65f6\u95f4\n     static_configs:\n       - targets: ['svc-dz-service-hzpublic:31121'] # \u6307\u6807\u8bbf\u95ee\u5165\u53e3\uff0c\u5373 k8s \u96c6\u7fa4\u7684 Service\n  -  job_name: 'pd-service-hzctm' # Prometheus \u4efb\u52a1\u540d\u79f0\uff0c\u81ea\u5b9a\u4e49\n     metrics_path: '/hzctm/actuator/prometheus' # \u6307\u6807\u83b7\u53d6\u8def\u5f84\n     scrape_interval: 5s # \u6293\u53d6\u6307\u6807\u7684\u95f4\u9694\u65f6\u95f4\n     static_configs:\n       - targets: ['192.168.137.132:31122'] # \u6307\u6807\u8bbf\u95ee\u5165\u53e3\uff0c\u672c\u5730\u670d\u52a1\u7684IP \u7aef\u53e3\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"k8s\u90e8\u7f72\u6587\u4ef6\u4fee\u6539\u9488\u5bf9prometheus-operator\u90e8\u7f72\u7684\u573a\u666f",children:"K8s\u90e8\u7f72\u6587\u4ef6\u4fee\u6539\uff08\u9488\u5bf9Prometheus Operator\u90e8\u7f72\u7684\u573a\u666f\uff09"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://blog.51cto.com/u_16213689/10372943",children:"k8s prometheus \u914d\u7f6e\u6587\u4ef6 \u4fee\u6539 k8s prometheus operator"})}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["\u4f7f\u7528Prometheus Operator\u90e8\u7f72\u65f6\uff0c\u6570\u636e\u91c7\u96c6\u662f\u4f9d\u8d56\u4e8e ",(0,o.jsx)(n.code,{children:"ServiceMonitor"})," \u7684\uff0c\u9700\u8981\u5728\u670d\u52a1\u90e8\u7f72\u4fe1\u606f\u4e2d\u6dfb\u52a0 ",(0,o.jsx)(n.code,{children:"ServiceMonitor"})," \u4fe1\u606f"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-diff",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: svc-hz-service-hzpublic\n  namespace: hz-dev-service\n# \u7528\u4e8e\u5339\u914d ServiceMonitor spec.selector.matchLabels\n+  labels:\n+    app: hz-service-hzpublic\n+    job: hz-service-hzpublic-job\nspec:\n  type: NodePort\n  selector:\n    app: hz-service-hzpublic\n  ports:\n    - name: http\n      port: 31121\n      targetPort: 31121\n      nodePort: 31121\n\n---\n# \u5b9a\u4e49 ServiceMonitor\n+ apiVersion: monitoring.coreos.com/v1\n+ kind: ServiceMonitor\n+ metadata:\n+  # \u5143\u6570\u636e\u4e2d name \u548c namespace \u4e0e Service \u4e2d\u4fdd\u6301\u4e00\u81f4 metadata.name metadata.namespace\n+  name: svc-dz-service-hzpublic\n+  namespace: hz-dev-service\n+  labels:\n+    app: hz-service-hzpublic\n+    # \u8fd9\u91cc\u7684label release \u662f\u56fa\u5b9a\u7684\uff0c\u53d6\u503c\u89c1\u4e0b\u65b9\u8be6\u7ec6\u8bf4\u660e\n+    release: prometheus\n+spec:\n+  jobLabel: job\n+  # \u91c7\u96c6\u76d1\u63a7\u6307\u6807\u8282\u70b9\u7684\u914d\u7f6e\uff1a \u91c7\u96c6\u95f4\u9694\uff0c\u91c7\u96c6\u7aef\u70b9\uff0c\u5bf9\u5e94\u7684\u670d\u52a1\u7aef\u53e3\u540d\u79f0(spec.port[*].name)\n+  endpoints:\n+    - interval: 5s\n+      path: /hzpublic/actuator/prometheus\n+      port: http\n+  namespaceSelector:\n+    any: true\n+  selector:\n+    matchLabels:\n+      # \u8fd9\u91cc\u5339\u914d\u7684\u662fService \u7684Metadata\u4e2d\u7684label\uff0c\u4eceService\u4e2d\u590d\u5236\u5373\u53ef metadata.labels\n+      app: hz-service-hzpublic\n+      job: hz-service-hzpublic-job\n\n---\n# ...\n# \u540e\u65b9\u7684\u4e0d\u9700\u8981\u4fee\u6539\uff0c\u4fdd\u6301\u539f\u6837\u5373\u53ef\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["\u5728Dashboard\u4e2d\u6dfb\u52a0Dashboard",(0,o.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/11378-justai-system-monitor/",children:"Spring Boot 2.1 System Monitor"}),"\n",(0,o.jsx)(n.img,{src:r(24053).A+"",width:"1920",height:"922"}),"\n\u6253\u5f00\u67e5\u770b\u6548\u679c\n",(0,o.jsx)(n.img,{src:r(94898).A+"",width:"1920",height:"922"})]}),"\n",(0,o.jsxs)(n.h3,{id:"servicemonitor\u4e2d\u7684-metadatalabelsrealease-prometheus-\u8bf4\u660e",children:["ServiceMonitor\u4e2d\u7684 ",(0,o.jsx)(n.code,{children:"metadata.labels.realease: prometheus"})," \u8bf4\u660e"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'# \u4e00\u952e\u67e5\u8be2 ServiceMonitor \u4e0b metadata.labels \u7684 K-V\u503c\nkubectl get prometheuses.monitoring.coreos.com -n monitoring -o jsonpath="{.items[0].spec.serviceMonitorSelector.matchLabels}"\n\n# \u5168\u91cf\u4fe1\u606f\u89c1\nkubectl get prometheuses.monitoring.coreos.com -n monitoring -o yaml\n\n'})}),"\n",(0,o.jsx)(n.h4,{id:"\u67e5\u770bservicemonitor",children:"\u67e5\u770bServiceMonitor"}),"\n",(0,o.jsx)(n.p,{children:"\u901a\u5730\u547d\u4ee4\u67e5\u770bServiceMonitor\uff0c\u662fKubernetes\u5b9a\u5236\u7684Kubernetes component\uff0c\u6b63\u662f\u4ee5\u4e0b\u8fd9\u4e9bServiceMonitor\u4ea7\u751f\u4e86\u4e0a\u8ff0Prometheus\u7684Targets\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get servicemonitor -n monitoring\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 services]$ kubectl get servicemonitor -n monitoring\nNAME                                                 AGE\nprometheus-grafana                                   25h\nprometheus-kube-prometheus-alertmanager              25h\nprometheus-kube-prometheus-apiserver                 25h\nprometheus-kube-prometheus-coredns                   25h\nprometheus-kube-prometheus-kube-controller-manager   25h\nprometheus-kube-prometheus-kube-etcd                 25h\nprometheus-kube-prometheus-kube-proxy                25h\nprometheus-kube-prometheus-kube-scheduler            25h\nprometheus-kube-prometheus-kubelet                   25h\nprometheus-kube-prometheus-operator                  25h\nprometheus-kube-prometheus-prometheus                25h\nprometheus-kube-state-metrics                        25h\nprometheus-prometheus-node-exporter                  25h\n\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u67e5\u770bservicemonitor\u8be6\u7ec6\u4fe1\u606f",children:"\u67e5\u770bServiceMonitor\u8be6\u7ec6\u4fe1\u606f"}),"\n",(0,o.jsx)(n.p,{children:"\u6211\u4eec\u67e5\u770b\u5176\u4e2d\u4e00\u4e2aservicemonitor\uff0c\u4ee5yaml\u5f62\u5f0f\u5c55\u793a\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'kubectl get servicemonitor prometheus-grafana -n monitoring -o yaml\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 services]$ kubectl get servicemonitor prometheus-grafana -n monitoring -o yaml\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  annotations:\n    meta.helm.sh/release-name: prometheus\n    meta.helm.sh/release-namespace: monitoring\n  creationTimestamp: "2025-06-10T07:32:22Z"\n  generation: 1\n  labels:\n    app.kubernetes.io/instance: prometheus\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/name: grafana\n    app.kubernetes.io/version: 12.0.0-security-01\n    helm.sh/chart: grafana-9.2.1\n  name: prometheus-grafana\n  namespace: monitoring\n  resourceVersion: "198613"\n  uid: 53d3048f-ca33-47bc-8387-acfc357b99ed\nspec:\n  endpoints:\n  - honorLabels: true\n    path: /metrics\n    port: http-web\n    scheme: http\n    scrapeTimeout: 30s\n  jobLabel: prometheus\n  namespaceSelector:\n    matchNames:\n    - monitoring\n  selector:\n    matchLabels:\n      app.kubernetes.io/instance: prometheus\n      app.kubernetes.io/name: grafana\n\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\u8d44\u6e90\u7c7b\u578b\u662f",(0,o.jsx)(n.code,{children:"ServiceMonitor"}),"\uff0c",(0,o.jsx)(n.code,{children:"endpoints"}),"\u7684\u7aef\u70b9\u662f",(0,o.jsx)(n.code,{children:"/metrics"}),"\uff0c\u5176\u4e2d\u4e00\u4e2a",(0,o.jsx)(n.code,{children:"label"}),"\u662f",(0,o.jsx)(n.code,{children:"app.kubernetes.io/instance: prometheus"}),"\uff0c\u8fd9\u91cc\u7684",(0,o.jsx)(n.code,{children:"label"}),"\u4e3a\u4ec0\u4e48\u662f",(0,o.jsx)(n.code,{children:"prometheus"}),"\u5462\uff1f"]}),"\n",(0,o.jsxs)(n.p,{children:["\u5176\u5b9e\u662f\u6211\u4eecchart\u7684name\uff0c\u6211\u4eec\u5728install prometheus\u7684\u65f6\u5019\u7528\u7684\u547d\u4ee4\u662f",(0,o.jsx)(n.code,{children:"helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring"}),"\uff0c\u90a3\u4e48\u8fd9\u91cc\u7684",(0,o.jsx)(n.code,{children:"release-name"}),"\u5c31\u662fprometheus\uff0c\u5982\u679c\u6211\u4eec\u6362\u6210abc\uff0c\u8fd9\u91cc\u7684",(0,o.jsx)(n.code,{children:"release-name"}),"\u4e5f\u4f1a\u662fabc\uff0c\u53ea\u8981",(0,o.jsx)(n.strong,{children:"\u548cCRD\u4e2d\u7684matchLabels\u5bf9\u5e94\u8d77\u6765\u5c31\u53ef\u4ee5\u4e86"})]}),"\n",(0,o.jsx)(n.h4,{id:"\u67e5\u770bcrd",children:"\u67e5\u770bCRD"}),"\n",(0,o.jsxs)(n.p,{children:["\u8981\u60f3\u770b\u5177\u4f53\u5185\u90e8\u662f\u600e\u4e48\u5173\u8054\u7684\uff0c\u6211\u4eec\u9700\u8981\u518d\u67e5\u770bCRD\u3002\u4e0a\u8ff0ServiceMonitor\u7684apiVersion\u4e3a\uff1a",(0,o.jsx)(n.code,{children:"apiVersion: monitoring.coreos.com/v1"}),"\uff0c\u6211\u4eec\u67e5\u770b\u4e0bCRD\uff0c\u9996\u5148\u5217\u51fa\u6240\u6709CRDs\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get crd -n monitoring | grep prometheuses.monitoring.coreos.com\n\n# \u8f93\u51fa\u7ed3\u679c\n[diginn@k8s-master-01 services]$ kubectl get crd -n monitoring | grep prometheuses.monitoring.coreos.com\nprometheuses.monitoring.coreos.com                    2025-06-10T06:50:23Z\n"})}),"\n",(0,o.jsx)(n.h4,{id:"\u67e5\u770bcrd\u8be6\u7ec6\u4fe1\u606f",children:"\u67e5\u770bCRD\u8be6\u7ec6\u4fe1\u606f"}),"\n",(0,o.jsx)(n.p,{children:"\u5177\u4f53\u67e5\u770bCRD=prometheuses.monitoring.coreos.com\uff0c\u4ee5yaml\u683c\u5f0f\u5c55\u793a\uff1a"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"kubectl get prometheuses.monitoring.coreos.com -n monitoring -o yaml\n\n# \u8f93\u51fa\u7ed3\u679c\uff0c\u91cd\u70b9\u5173\u6ce8PodMonitor ServiceMonitor\n\n# PodMonitor \u5339\u914d\u7684\u89c4\u5219\npodMonitorSelector:\n  matchLabels:\n    release: prometheus\n\n# ServiceMonitor \u5339\u914d\u7684\u89c4\u5219\uff0c\u8fd9\u91cc\u663e\u793a\u7684label\u540d\u79f0\u548c\u503c\u5c31\u662f\u4e0a\u9762 ServiceMonitor\u9700\u8981\u6dfb\u52a0\u7684\nserviceMonitorSelector:\n  matchLabels:\n    release: prometheus\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u8d44\u6e90\u5b9a\u4e49\u5f88\u957f\uff0c\u5176\u4e2d\u4e00\u6bb5\u5b9a\u4e49\uff0c\u6240\u4ee5\u6211\u4eec\u521b\u5efa\u7684ServiceMonitor\uff0c\u9700\u8981\u52a0\u4e0a\u8fd9\u4e2aLabel\uff0c\u5426\u5219\u5c31\u4e0d\u4f1a\u88ab\u5173\u8054\u4e0a\u5e76\u53d1\u73b0\uff0c\u5982\u679c\u6211\u4eecchart name\u4e3a\u5176\u5b83\u540d\u5b57\uff0c\u5982abc\uff0c\u90a3\u4e48\u5728\u5b89\u88c5\u751f\u6210CRD\u7684\u65f6\u5019\u8fd9\u91cc\u7684release\u5c31\u4f1a\u662fabc\uff0c\u800c\u4e0d\u662fprometheus"}),"\n",(0,o.jsx)(n.h2,{id:"\u672c\u5730\u90e8\u7f72-spring-boot-jar\u5305",children:"\u672c\u5730\u90e8\u7f72 Spring Boot Jar\u5305"}),"\n",(0,o.jsx)(n.p,{children:"\u914d\u7f6e\u73af\u5883\u53d8\u91cf"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u914d\u7f6e\u73af\u5883\u53d8\u91cf\ncat >> ~/.bashrc << 'EOF'\nexport JAVA_HOME=/home/diginn/jdk-17.0.0.1\nexport PATH=$JAVA_HOME/bin:$PATH\n\nEOF\n\n# \u52a0\u8f7d\u73af\u5883\u53d8\u91cf\nsource ~/.bashrc\njava --version\n\n# \u8fd0\u884cjar\u5305\njava -jar pd-service-hzctm.jar\n\n# \u65e5\u5fd7\u4f4d\u7f6e\n/home/diginn/logs/pd-service-hzctm-all.log\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u542f\u505c\u811a\u672c"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8\u811a\u672c\ncat > startup.sh << 'EOF'\n#!/bin/bash\nnohup java -jar pd-service-hzctm.jar > /dev/null 2>&1 &\necho \"$!\" > pid\nEOF\n\n# \u505c\u6b62\u811a\u672c\ncat > shutdown.sh << 'EOF'\n#!/bin/bash\nkill -9 `cat pid`\necho \"\u5173\u95ed\u6210\u529f!\"\nEOF\n\n# \u811a\u672c\u6dfb\u52a0\u6267\u884c\u6743\u9650\nchmod +x startup.sh shutdown.sh\n\n"})}),"\n",(0,o.jsx)(n.p,{children:"\u542f\u52a8\u670d\u52a1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"./startup.sh\n\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u4f7f\u7528prometheus-operator\u914d\u7f6e\u91c7\u96c6\u672c\u5730\u670d\u52a1\u6307\u6807",children:"\u4f7f\u7528Prometheus Operator\u914d\u7f6e\u91c7\u96c6\u672c\u5730\u670d\u52a1\u6307\u6807"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://www.modb.pro/db/392899",children:"\u4f7f\u7528Prometheus\u76d1\u63a7\u975eK8S\u96c6\u7fa4\u5185\u673a\u5668"})}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"\u521b\u5efak8s\u90e8\u7f72\u8d44\u6e90\u6587\u4ef6",children:"\u521b\u5efaK8s\u90e8\u7f72\u8d44\u6e90\u6587\u4ef6"}),"\n",(0,o.jsxs)(n.p,{children:["\u9996\u5148\u6211\u4eec\u65b0\u5efa\u4e00\u4e2a",(0,o.jsx)(n.code,{children:"ServiceMonitor"}),"\uff0c\u7528\u6765\u7edf\u4e00\u76d1\u63a7\u975ek8s\u96c6\u7fa4\u5185\u7684\u670d\u52a1\uff0c\u540d\u79f0\u5c31\u5b9a\u4e3a ",(0,o.jsx)(n.code,{children:"spring-boot-exporter"}),"\u3002\n\u53e6\u5916\u6211\u4eec\u8fd8\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u88ab\u76d1\u63a7\u673a\u5668\u7684",(0,o.jsx)(n.code,{children:"Service"}),"\u548c",(0,o.jsx)(n.code,{children:"Endpoint"}),"\u3002\u5c06endpoint\u4e2d\u7684port\u8bbe\u7f6e\u4e3a\u670d\u52a1\u7684\u8fd0\u884c\u7aef\u53e3\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u4ee5\u4e0b\u662fK8s\u8d44\u6e90\u90e8\u7f72\u6587\u4ef6\u7684\u793a\u4f8b: ",(0,o.jsx)(n.code,{children:"k8s-local.yaml"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: spring-boot-exporter\n  namespace: monitoring\n  # \u8fd9\u91cc\u7684labels\u8981\u548c ServiceMonitor \u7684 spec.selector.matchLabels \u4e00\u81f4\n  labels:\n    app: hz-service-hzctm\n    job: hz-service-hzctm-job\nspec:\n clusterIP: None\n type: ClusterIP\n\n---\n\napiVersion: v1\nkind: Endpoints\nmetadata:\n  name: spring-boot-exporter\n  namespace: monitoring\nsubsets:\n  # \u8fd9\u91ccIP\u7aef\u53e3\u4e3a\u672c\u5730\u670d\u52a1\u7684IP \u548c\u7aef\u53e3\n  - addresses:\n      - ip: 192.168.137.132\n    ports:\n      - name: http-metrics\n        port: 31122\n        protocol: TCP\n\n---\n\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: spring-boot-exporter\n  namespace: monitoring\n  labels:\n    app: hz-service-hzctm\n    # \u8fd9\u4e2a\u6807\u7b7e\u5fc5\u987b\u8981\u6709\uff0ckey\u548cvalue\u7684\u53d6\u503c\u89c1\u4e0a\u9762\u7ae0\u8282\u3010ServiceMonitor\u4e2d\u7684 `metadata.labels.realease: prometheus` \u8bf4\u660e\u3011\n    release: prometheus\nspec:\n  jobLabel: job\n  endpoints:\n    # \u6307\u6807\u91c7\u96c6\u7684\u7aef\u70b9\u4fe1\u606f\uff0c\u7aef\u53e3\u5f15\u7528\u4e0a\u9762Endpoints\u4e2d\u5b9a\u4e49\u7684port\uff0cpath\u4e3a\u6307\u6807\u7aef\u70b9\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u9700\u8981\u5305\u542b\u670d\u52a1\u7684contextpath\n    - port: http-metrics\n      interval: 5s\n      honorLabels: true\n      scheme: http\n      path: /hzctm/actuator/prometheus\n  selector:\n    # \u8fd9\u91cc\u7684\u53d6\u503c\u8981\u548cService \u7684 metadata.labels \u4e00\u81f4\n    matchLabels:\n      app: hz-service-hzctm\n      job: hz-service-hzctm-job\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u90e8\u7f72\u8d44\u6e90\u670d\u52a1",children:"\u90e8\u7f72\u8d44\u6e90\u670d\u52a1"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"# \u90e8\u7f72\nkubectl apply -f k8s-local.yaml\n\n# \u5220\u9664\nkubectl apply -f k8s-local.yaml\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u8bbf\u95ee\u9875\u9762",children:"\u8bbf\u95ee\u9875\u9762"}),"\n",(0,o.jsxs)(n.p,{children:["\u90e8\u7f72\u5b8c\u6210\u540e\u8bbf\u95eePrometheus \u7684\u670d\u52a1\u53d1\u73b0\u9875 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:30203/service-discovery"}),"\n",(0,o.jsx)(n.img,{src:r(14549).A+"",width:"1906",height:"976"}),"\n",(0,o.jsx)(n.img,{src:r(47198).A+"",width:"1920",height:"922"}),"\n\u53ef\u4ee5\u770b\u5230Prometheus\u5df2\u7ecf\u6709\u4e86\u672c\u5730\u670d\u52a1\u7684\u4fe1\u606f\uff0c\u5982\u679c",(0,o.jsx)(n.code,{children:"Target labels"}),"\u663e\u793a ",(0,o.jsx)(n.code,{children:"dropped due to relabeling rules"})," \u8868\u793a\u670d\u52a1\u7684\u914d\u7f6e\u5b58\u5728\u9519\u8bef\uff0c\u53c2\u8003\u5e38\u89c1\u95ee\u9898\u6765\u89e3\u51b3"]}),"\n",(0,o.jsxs)(n.p,{children:["\u8bbf\u95eeGrafana \u76d1\u63a7\u9762\u677f\u9875\u9762 ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:31145/dashboards"})," \u6253\u5f00 ",(0,o.jsx)(n.code,{children:"Spring Boot 2.1 System Monitor"}),"\n",(0,o.jsx)(n.img,{src:r(65511).A+"",width:"1920",height:"922"}),"\n\u5728\u8fd9\u91cc\u5df2\u7ecf\u6709\u4e86\u672c\u5730\u670d\u52a1\u7684\u4fe1\u606f"]}),"\n",(0,o.jsx)(n.h1,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,o.jsx)(n.h2,{id:"prometheus-service-discovery-\u4e2d\u663e\u793a\u76ee\u6807\u670d\u52a1\u7684\u68c0\u6d4b\u6307\u6807\u6570\u636e\u88ab\u5220\u9664-dropped-due-to-relabeling-rules",children:"Prometheus Service Discovery \u4e2d\u663e\u793a\u76ee\u6807\u670d\u52a1\u7684\u68c0\u6d4b\u6307\u6807\u6570\u636e\u88ab\u5220\u9664 \u3010dropped due to relabeling rules\u3011"}),"\n",(0,o.jsxs)(n.p,{children:["\u8bbf\u95eePrometheus \u670d\u52a1\u53d1\u73b0\u9875\u9762: ",(0,o.jsx)(n.code,{children:"http://192.168.137.121:30203/service-discovery?search=svc-dz-service-hzpublic"})]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://stackoverflow.com/questions/67818375/prometheus-target-discovery-dropped-target-labels",children:"Prometheus \u4e2d\u663e\u793a\u6307\u6807\u88ab\u5220\u9664"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://relabeler.promlabs.com/",children:"\u5728\u7ebf\u6821\u9a8cK8s\u670d\u52a1labels\u4e0ePrometheus Relabeling rules"})}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["\u9519\u8bef\u4fe1\u606f\n",(0,o.jsx)(n.img,{src:r(31889).A+"",width:"1921",height:"971"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"\u5f02\u5e38\u539f\u56e0"}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"namespace\u9519\u8bef\uff0c\u5982ServiceMonitor \u7684 namespace \u4e0eservice\u7684\u4e0d\u4e00\u81f4"}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsx)(n.li,{children:"\u89e3\u51b3\u65b9\u6848"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["\u4ece ",(0,o.jsx)(n.code,{children:"Service Discovery"})," \u590d\u5236 ",(0,o.jsx)(n.code,{children:"Discovered labels"})," \u4e0e ",(0,o.jsx)(n.code,{children:"Configuraitons"})," \u7684\u6307\u5b9ajob\u7684 ",(0,o.jsx)(n.code,{children:"relabel_configs"})," ",(0,o.jsx)(n.a,{href:"https://relabeler.promlabs.com/",children:"\u6bd4\u5bf9\u6821\u9a8c"}),"\n",(0,o.jsx)(n.img,{src:r(87326).A+"",width:"1924",height:"977"}),"\n",(0,o.jsx)(n.img,{src:r(63111).A+"",width:"1920",height:"922"}),"\n",(0,o.jsx)(n.img,{src:r(12428).A+"",width:"1604",height:"1005"})]}),"\n",(0,o.jsx)(n.p,{children:"\u786e\u8ba4\u5339\u914d\u89c4\u5219\u662f\u5728\u54ea\u4e00\u6b65\u5931\u8d25\u7684\uff0c\u7136\u540e\u9488\u5bf9\u8fd9\u4e00\u6b65\u6bd4\u5bf9\u7684tag\u4fee\u6539\u670d\u52a1\u90e8\u7f72\u914d\u7f6e"})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},39481:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort1-bd925894f82147ecacf86cc07c4ca2c3.png"},45345:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/\u5bfc\u5165\u4e0b\u8f7d\u7684json\u6587\u4ef6-2d55b872d7c6bff3c45407029fec7071.png"},47198:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Local2-5415c2438bc464d2cb397f5917f1b216.png"},51232:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/prometheus\u81ea\u8eab\u6307\u6807-fa88bc5cfe41ab9f17b2e50256072c9a.png"},54612:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort4-d9eeaeb62672c8f5c3f5ab60f89e02de.png"},56962:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Grafana\u6dfb\u52a0Prometheus\u6570\u636e\u6e90-fd85a2b0b3b9095a473d497a28125877.png"},61827:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot1-e97bff2befb2dfebae64dbee97149324.png"},63111:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot5-0133da56623bfdfbe83fb79e4986c4e9.png"},65332:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/\u5b98\u65b9\u63d0\u4f9b\u7684\u76d1\u63a7\u9762\u677f-828d24b3555b02ec089018e9f6ca720d.png"},65511:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/Local3-c543e56342e764fd7ea4f270e921288d.png"},71293:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort5-bd121e86c8b607b1870cfbda5c368dc6.png"},83394:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort2-35cb5b638df3afe48bf93e9215f5f8f7.png"},83496:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot2-b699d24489d739b6d82b8d7cad762393.png"},86051:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/\u4e0b\u8f7d\u9762\u677f\u5b9a\u4e49JSON-36508fd43b7ebd22b3d5d97f434b3417.png"},87326:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot4-1fff91456fef1617a0b102e2ae0293c1.png"},90086:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/NodePort6-986d43ddf3ce98527f1da03de497a710.png"},94898:(e,n,r)=>{r.d(n,{A:()=>s});const s=r.p+"assets/images/SpringBoot8-01d1c3c83cb6e9dc3c5600955d323b94.png"}}]);