"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[19490],{43782:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var r=t(74848),i=t(28453);const o={},s=void 0,a={id:"zh-cn/spring-authorization-server/SAS-Frontend-Backend-Separate",title:"SAS-Frontend-Backend-Separate",description:"- Spring Authorization Server\u5165\u95e8 (\u5341\u4e8c) \u5b9e\u73b0\u6388\u6743\u7801\u6a21\u5f0f\u4f7f\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u767b\u5f55\u9875\u9762",source:"@site/docs/zh-cn/spring-authorization-server/12-SAS-Frontend-Backend-Separate.md",sourceDirName:"zh-cn/spring-authorization-server",slug:"/zh-cn/spring-authorization-server/SAS-Frontend-Backend-Separate",permalink:"/docs/zh-cn/spring-authorization-server/SAS-Frontend-Backend-Separate",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-authorization-server/12-SAS-Frontend-Backend-Separate.md",tags:[],version:"current",sidebarPosition:12,frontMatter:{},sidebar:"troch",previous:{title:"SAS-OAuth2-Extension-Grant-Type",permalink:"/docs/zh-cn/spring-authorization-server/SAS-OAuth2-Extension-Grant-Type"},next:{title:"SAS-Github-Gitee-Login",permalink:"/docs/zh-cn/spring-authorization-server/SAS-Github-Gitee-Login"}},c={},d=[{value:"\u4e00\u3001\u5b9e\u73b0\u601d\u8def\u5206\u6790",id:"\u4e00\u5b9e\u73b0\u601d\u8def\u5206\u6790",level:2},{value:"1. \u5148\u770b\u4e00\u4e0b\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5728\u6846\u67b6\u4e2d\u7684\u8df3\u8f6c\u60c5\u51b5",id:"1-\u5148\u770b\u4e00\u4e0b\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5728\u6846\u67b6\u4e2d\u7684\u8df3\u8f6c\u60c5\u51b5",level:3},{value:"2. \u5148\u67e5\u770b\u4e0b\u6846\u67b6\u600e\u4e48\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f",id:"2-\u5148\u67e5\u770b\u4e0b\u6846\u67b6\u600e\u4e48\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f",level:3},{value:"3. \u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f",id:"3-\u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f",level:3},{value:"\u4e8c\u3001\u6539\u9020\u5206\u6790",id:"\u4e8c\u6539\u9020\u5206\u6790",level:2},{value:"\u4e09\u3001\u4ee3\u7801\u5b9e\u73b0",id:"\u4e09\u4ee3\u7801\u5b9e\u73b0",level:2},{value:"1. \u521b\u5efa<code>LoginSuccessHandler</code>\u7c7b\u5e76\u5b9e\u73b0<code>AuthenticationSuccessHandler</code>\u63a5\u53e3",id:"1-\u521b\u5efaloginsuccesshandler\u7c7b\u5e76\u5b9e\u73b0authenticationsuccesshandler\u63a5\u53e3",level:3},{value:"2. \u521b\u5efa<code>LoginFailureHandler</code>\u7c7b\u5e76\u5b9e\u73b0<code>AuthenticationFailureHandler</code>\u63a5\u53e3",id:"2-\u521b\u5efaloginfailurehandler\u7c7b\u5e76\u5b9e\u73b0authenticationfailurehandler\u63a5\u53e3",level:3},{value:"3. \u521b\u5efa<code>LoginTargetAuthenticationEntryPoint</code>\u7c7b\u5e76\u7ee7\u627f<code>LoginUrlAuthenticationEntryPoint</code>\u7c7b",id:"3-\u521b\u5efalogintargetauthenticationentrypoint\u7c7b\u5e76\u7ee7\u627floginurlauthenticationentrypoint\u7c7b",level:3},{value:"1. \u5728<code>SecurityConstants</code>\u4e2d\u6dfb\u52a0<code>NONCE_HEADER_NAME</code>",id:"1-\u5728securityconstants\u4e2d\u6dfb\u52a0nonce_header_name",level:4},{value:"4. \u5728support\u5305\u4e0b\u521b\u5efa<code>RedisSecurityContextRepository</code>\u5e76\u5b9e\u73b0<code>SecurityContextRepository</code>",id:"4-\u5728support\u5305\u4e0b\u521b\u5efaredissecuritycontextrepository\u5e76\u5b9e\u73b0securitycontextrepository",level:3},{value:"1. \u8865\u5145<code>SupplierDeferredSecurityContext</code>\u7c7b",id:"1-\u8865\u5145supplierdeferredsecuritycontext\u7c7b",level:4},{value:"5. \u5c06\u4ee5\u4e0a\u81ea\u5df1\u521b\u5efa\u7684\u7c7b\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d",id:"5-\u5c06\u4ee5\u4e0a\u81ea\u5df1\u521b\u5efa\u7684\u7c7b\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d",level:3},{value:"1. \u914d\u7f6e\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e",id:"1-\u914d\u7f6e\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e",level:4},{value:"2. \u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe(\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e)",id:"2-\u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e",level:4},{value:"3. \u5728AuthorizationConfig\u4e2d\u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668",id:"3-\u5728authorizationconfig\u4e2d\u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668",level:4},{value:"4. RedisConstants\u4e2d\u6dfb\u52a0\u5e38\u91cf",id:"4-redisconstants\u4e2d\u6dfb\u52a0\u5e38\u91cf",level:4},{value:"5. \u5982\u679c\u6ca1\u6709RedisOperator\u53ef\u4ee5\u770b\u4e0b\u6211\u4e4b\u524d\u7684\u4f18\u5316\u7bc7",id:"5-\u5982\u679c\u6ca1\u6709redisoperator\u53ef\u4ee5\u770b\u4e0b\u6211\u4e4b\u524d\u7684\u4f18\u5316\u7bc7",level:4},{value:"6. \u5b8c\u6574\u7684AuthorizationConfig\u5982\u4e0b",id:"6-\u5b8c\u6574\u7684authorizationconfig\u5982\u4e0b",level:4},{value:"6. \u7f16\u5199\u767b\u5f55\u9875\u9762",id:"6-\u7f16\u5199\u767b\u5f55\u9875\u9762",level:3},{value:"\u56db\u3001\u6d4b\u8bd5",id:"\u56db\u6d4b\u8bd5",level:2},{value:"1. \u7ec4\u88c5url\u53d1\u8d77\u6388\u6743\u8bf7\u6c42",id:"1-\u7ec4\u88c5url\u53d1\u8d77\u6388\u6743\u8bf7\u6c42",level:3},{value:"2. \u68c0\u6d4b\u5230\u672a\u767b\u5f55\uff0c\u91cd\u5b9a\u5411\u81f3vue\u9879\u76ee\u7684\u767b\u5f55\u9875\u9762",id:"2-\u68c0\u6d4b\u5230\u672a\u767b\u5f55\u91cd\u5b9a\u5411\u81f3vue\u9879\u76ee\u7684\u767b\u5f55\u9875\u9762",level:3},{value:"3. \u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u63d0\u4ea4",id:"3-\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u63d0\u4ea4",level:3},{value:"4. \u6388\u6743\u786e\u8ba4\u63d0\u4ea4",id:"4-\u6388\u6743\u786e\u8ba4\u63d0\u4ea4",level:4},{value:"\u4e94\u3001\u5199\u5728\u6700\u540e",id:"\u4e94\u5199\u5728\u6700\u540e",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",del:"del",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://juejin.cn/post/7254096495184134181",children:"Spring Authorization Server\u5165\u95e8 (\u5341\u4e8c) \u5b9e\u73b0\u6388\u6743\u7801\u6a21\u5f0f\u4f7f\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u767b\u5f55\u9875\u9762"})}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2023-12-01\u4fee\u6539\uff1a\u5728",(0,r.jsx)(n.a,{href:"https://gitee.com/vains-Sofia/authorization-example/tree/session-data-redis",children:"session-data-redis(Github)"}),"\u5206\u652f\u4e2d\u6dfb\u52a0\u4e86\u57fa\u4e8e",(0,r.jsx)(n.code,{children:"spring-session-data-redis"}),"\u7684\u5b9e\u73b0\uff0c\u65e0\u9700\u501f\u52a9",(0,r.jsx)(n.code,{children:"nonceId"}),"\u6765\u4fdd\u6301\u8ba4\u8bc1\u72b6\u6001\uff0c\u8be5\u5206\u652f\u5df2\u53bb\u9664\u6240\u6709",(0,r.jsx)(n.code,{children:"nonceId"}),"\u76f8\u5173\u5185\u5bb9\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f",(0,r.jsx)(n.code,{children:"axios"}),"\u5728\u521d\u59cb\u5316\u65f6\u9700\u8981\u6dfb\u52a0\u914d\u7f6e",(0,r.jsx)(n.code,{children:"withCredentials: true"}),"\uff0c\u8ba9\u8bf7\u6c42\u643a\u5e26",(0,r.jsx)(n.code,{children:"cookie"}),"\u3002\u5f53\u7136\u4e00\u4e9b\u54cd\u5e94json\u7684\u5904\u7406\u8fd8\u662f\u4f7f\u7528\u4e0b\u65b9\u7684\u5185\u5bb9\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4eca\u5929\u7684\u4e3b\u9898\u5c31\u662f\u4f7f\u7528\u5355\u72ec\u90e8\u7f72\u7684\u767b\u5f55\u9875\u9762\u66ff\u6362\u8ba4\u8bc1\u670d\u52a1\u5668\u9ed8\u8ba4\u7684\u767b\u5f55\u9875\u9762(\u524d\u540e\u7aef\u5206\u79bb\u65f6\u4f7f\u7528\u524d\u7aef\u7684\u767b\u5f55\u9875\u9762)\uff0c\u76ee\u524d\u5728\u7f51\u4e0a\u80fd\u641c\u5230\u7684\u5f88\u591a\u90fd\u662f\u7406\u8bba\uff0c\u6ca1\u6709\u5f88\u597d\u7684\u4e00\u4e2a\u793a\u4f8b\uff0c\u6211\u5c31\u6309\u7167\u6211\u81ea\u5df1\u7684\u60f3\u6cd5\u5199\u4e86\u4e00\u4e2a\u5b9e\u73b0\uff0c\u7ed9\u5927\u5bb6\u63d0\u4f9b\u4e00\u4e2a\u601d\u8def\uff0c\u5982\u679c\u6709\u4ec0\u4e48\u95ee\u9898\u6216\u8005\u66f4\u597d\u7684\u60f3\u6cd5\u53ef\u4ee5\u5728\u8bc4\u8bba\u533a\u63d0\u51fa\uff0c\u8c22\u8c22\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u4e00\u5b9e\u73b0\u601d\u8def\u5206\u6790",children:"\u4e00\u3001\u5b9e\u73b0\u601d\u8def\u5206\u6790"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u5148\u770b\u4e00\u4e0b\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5728\u6846\u67b6\u4e2d\u7684\u8df3\u8f6c\u60c5\u51b5",children:"1. \u5148\u770b\u4e00\u4e0b\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bf7\u6c42\u5728\u6846\u67b6\u4e2d\u7684\u8df3\u8f6c\u60c5\u51b5"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(32338).A+"",width:"1157",height:"706"})}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0Spring Authorization Server(Spring Security)\u6846\u67b6\u9ed8\u8ba4\u4f7f\u7528session\u5b58\u50a8\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u8fd9\u6837\u5728\u767b\u5f55\u4ee5\u540e\u91cd\u5b9a\u5411\u56de\u8bf7\u6c42\u6388\u6743\u63a5\u53e3\u65f6(",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),")\u5904\u7406\u8be5\u8bf7\u6c42\u7684\u8fc7\u6ee4\u5668\u53ef\u4ee5\u4ece",(0,r.jsx)(n.code,{children:"session"}),"\u4e2d\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\uff0c\u4ece\u800c\u8d70\u540e\u8fb9\u7684\u6d41\u7a0b\uff0c\u4f46\u662f\u5f53\u8fd9\u4e00\u5957\u653e\u5728\u5355\u72ec\u90e8\u7f72\u7684\u767b\u5f55\u9875\u9762\u4e2d\u5c31\u4e0d\u884c\u4e86\uff0c\u5728\u8bf7\u6c42\u6388\u6743\u65f6\u54ea\u6015\u767b\u5f55\u8fc7\u4e5f\u65e0\u6cd5\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\uff0c\u56e0\u4e3a\u4ed6\u4eec\u4e0d\u518d\u662f\u540c\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"session"}),"\u4e2d\u4e86\uff1b\u6240\u4ee5\u5173\u952e\u70b9\u5c31\u5728\u4e8e\u600e\u4e48\u5b58\u50a8\u3001\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"2-\u5148\u67e5\u770b\u4e0b\u6846\u67b6\u600e\u4e48\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f",children:"2. \u5148\u67e5\u770b\u4e0b\u6846\u67b6\u600e\u4e48\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f"}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u5728\u5904\u7406",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),"\u63a5\u53e3\u7684\u8fc7\u6ee4\u5668",(0,r.jsx)(n.code,{children:"OAuth2AuthorizationEndpointFilter"}),"\u4e2d\u770b\u4e00\u4e0b\u5b9e\u73b0\u903b\u8f91\uff0c\u770b\u4e00\u4e0b\u5bf9\u4e8e\u8ba4\u8bc1\u4fe1\u606f\u7684\u5904\u7406\uff0c\u5982\u4e0b\u56fe"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(35781).A+"",width:"1444",height:"933"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5148\u7531",(0,r.jsx)(n.code,{children:"converter"}),"\u5904\u7406\uff0c\u4e4b\u540e\u518d\u7531",(0,r.jsx)(n.code,{children:"provider"}),"\u5904\u7406\uff0c\u4e4b\u540e\u5224\u65ad\u8ba4\u8bc1\u4fe1\u606f\u662f\u5426\u5df2\u7ecf\u8ba4\u8bc1\u8fc7\u4e86\uff0c\u6ca1\u8ba4\u8bc1\u8fc7\u4e0d\u5904\u7406\uff0c\u4ea4\u7ed9\u540e\u8fb9\u7684\u8fc7\u6ee4\u5668\u5904\u7406\uff0c\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b",(0,r.jsx)(n.code,{children:"converter"}),"\u4e2d\u7684\u903b\u8f91\uff0c\u5982\u4e0b\u56fe\u6240\u793a"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(55148).A+"",width:"1472",height:"929"})}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u5982\u56fe\u6240\u793a\uff0c\u8fd9\u91cc\u76f4\u63a5\u4ece",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u4e2d\u83b7\u53d6\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u5c31\u9700\u8981\u627e\u4e00\u4e0b\u5b83\u662f\u600e\u4e48\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u5e76\u653e\u5165",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u4e2d\u7684\u3002\n\u5728",(0,r.jsx)(n.code,{children:"OAuth2AuthorizationEndpointFilter"}),"\u4e2d\u6253\u4e00\u4e2a\u65ad\u70b9\uff0c\u8bf7\u6c42\u4e00\u4e0b",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),"\u63a5\u53e3\uff0c"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(37359).A+"",width:"1361",height:"942"})}),"\n",(0,r.jsxs)(n.p,{children:["\u65ad\u70b9\u65ad\u4f4f\u4ee5\u540e\u67e5\u770b\u4e00\u4e0b\u8fc7\u6ee4\u5668\u94fe\uff0c\u53d1\u73b0\u5728",(0,r.jsx)(n.code,{children:"OAuth2AuthorizationEndpointFilter"}),"\u4e4b\u524d\u6709\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"SecurityContextHolderFilter"}),"\u8fc7\u6ee4\u5668\uff0c\u540d\u5b57\u8868\u8fbe\u7684\u7279\u5f81\u5f88\u660e\u663e\uff0c\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u6ee4\u5668\u4e2d\u7684\u903b\u8f91\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(61438).A+"",width:"1490",height:"967"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4ece\u65ad\u70b9\u622a\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\u662f\u4ece",(0,r.jsx)(n.code,{children:"securityContextRepository"}),"\u4e2d\u83b7\u53d6\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u7136\u540e\u901a\u8fc7",(0,r.jsx)(n.code,{children:"securityContextHolderStrategy"}),"\u4fdd\u5b58\uff0c\u770b\u4e00\u4e0b\u662f\u4e0d\u662f\u5728\u8fd9\u91cc\u8bbe\u7f6e\u7684\u8ba4\u8bc1\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(31457).A+"",width:"966",height:"487"})}),"\n",(0,r.jsxs)(n.p,{children:["\u65ad\u70b9\u8fdb\u5165\u65b9\u6cd5\u540e\u53d1\u73b0\u5c06\u8ba4\u8bc1\u4fe1\u606f\u7684",(0,r.jsx)(n.code,{children:"context"}),"\u8bbe\u7f6e\u5230\u4e86",(0,r.jsx)(n.code,{children:"contextHolder"}),"\u4e2d\uff0c\u90a3\u8fd9\u91cc\u548c",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f\u8bf7\u63a5\u7740\u5f80\u4e0b\u770b"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(33144).A+"",width:"1125",height:"369"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u7684",(0,r.jsx)(n.code,{children:"getContext"}),"\u65b9\u6cd5\u662f\u4ece\u5f53\u524d\u7c7b\u4e2d\u7684\u5c5e\u6027\u83b7\u53d6\uff0c\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b",(0,r.jsx)(n.code,{children:"securityContextHolderStrategy"}),"\u7684\u5b9a\u4e49"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(73835).A+"",width:"1318",height:"578"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5b83\u662f\u901a\u8fc7\u8c03\u7528",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u7684",(0,r.jsx)(n.code,{children:"getContextHolderStrategy"}),"\u65b9\u6cd5\u5b8c\u6210\u5b9e\u4f8b\u5316\u7684\uff0c\u770b\u4e0b\u8fd9\u4e2a\u65b9\u6cd5"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(5850).A+"",width:"1133",height:"385"})}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u8ffd\u8e2a\u5230\u8fd9\u91cc\u5e94\u8be5\u5c31\u5dee\u4e0d\u591a\u4e86\uff0c\u6846\u67b6\u4ece",(0,r.jsx)(n.code,{children:"securityContextRepository"}),"\u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\uff0c\u7136\u540e\u901a\u8fc7",(0,r.jsx)(n.code,{children:"securityContextHolderStrategy"}),"\u653e\u5165",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u4e2d\uff0c\u8ba9\u540e\u8fb9\u7684\u8fc7\u6ee4\u5668\u53ef\u4ee5\u76f4\u63a5\u4ece",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u7684\u5730\u65b9\u7ed3\u675f\u4e86\uff0c\u63a5\u4e0b\u6765\u770b\u4e00\u4e0b\u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f\u7684\u5730\u65b9\uff0c\u5206\u6790\u5b8c\u83b7\u53d6\u7684\u5730\u65b9\uff0c\u5b58\u50a8\u7684\u5730\u65b9\u5c31\u5f88\u7b80\u5355\u4e86\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"3-\u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f",children:"3. \u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f"}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u770b\u8fc7\u4e4b\u524d\u6587\u7ae0\u6216\u8005\u5176\u5b83\u5173\u4e8e\u767b\u5f55\u5206\u6790\u7684\u6587\u7ae0\u5e94\u8be5\u77e5\u9053\uff0c\u6846\u67b6\u5bf9\u4e8e\u767b\u5f55\u7684\u5904\u7406\u662f\u57fa\u4e8e",(0,r.jsx)(n.code,{children:"UsernamePasswordAuthenticationFilter"}),"\u548c\u7236\u7c7b",(0,r.jsx)(n.code,{children:"AbstractAuthenticationProcessingFilter"}),"\uff0c\u5728\u7236\u7c7b\u4e2d\u8c03\u7528\u5b50\u7c7b\u7684\u6821\u9a8c\uff0c\u91cd\u70b9\u662f\u8ba4\u8bc1\u6210\u529f\u540e\u7684\u5904\u7406\uff0c\u5982\u4e0b\u56fe"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(56116).A+"",width:"1454",height:"927"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8ba4\u8bc1\u6210\u529f\u540e\u8c03\u7528\u4e86",(0,r.jsx)(n.code,{children:"successfulAuthentication"}),"\u65b9\u6cd5\uff0c\u770b\u4e00\u4e0b\u8be5\u65b9\u6cd5\u7684\u5b9e\u73b0"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(33069).A+"",width:"1454",height:"900"})}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u5176\u5b83\u7684\u4e0d\u662f\u672c\u7bc7\u6587\u7ae0\u7684\u91cd\u70b9\uff0c\u4e3b\u8981\u662f\u7ea2\u6846\u4e2d\u7684\u4ee3\u7801\uff0c\u8fd9\u91cc\u5c06\u767b\u9646\u540e\u7684\u8ba4\u8bc1\u4fe1\u606f\u5b58\u50a8\u5728",(0,r.jsx)(n.code,{children:"securityContextRepository"}),"\u4e2d\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u5230\u8fd9\u91cc\u903b\u8f91\u5c31\u901a\u4e86\uff0c\u767b\u5f55\u540e\u5c06\u8ba4\u8bc1\u4fe1\u606f\u5b58\u50a8\u5728",(0,r.jsx)(n.code,{children:"securityContextRepository"}),"\u4e2d\uff0c\u8bbf\u95ee\u65f6\u4ece",(0,r.jsx)(n.code,{children:"securityContextRepository"}),"\u4e2d\u53d6\u51fa\u8ba4\u8bc1\u4fe1\u606f\u5e76\u653e\u5728",(0,r.jsx)(n.code,{children:"SecurityContextHolder"}),"\u4e2d\uff0c\u8fd9\u6837\u5c31\u4fdd\u6301\u4e86\u767b\u9646\u72b6\u6001\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u4e8c\u6539\u9020\u5206\u6790",children:"\u4e8c\u3001\u6539\u9020\u5206\u6790"}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\u4f7f\u7528\u524d\u540e\u7aef\u5206\u79bb\u7684\u767b\u5f55\u9875\u9762\uff0c\u90a3\u4e48\u767b\u5f55\u63a5\u53e3\u5c31\u9700\u8981\u54cd\u5e94json\u4e86\uff0c\u4e0d\u80fd\u518d\u4f7f\u7528\u9ed8\u8ba4\u7684\u6210\u529f/\u5931\u8d25\u5904\u7406\u4e86\uff0c\u6240\u4ee5\u8981\u91cd\u5199\u767b\u5f55\u6210\u529f\u548c\u5931\u8d25\u7684\u5904\u7406\u5668\uff1b\u91cd\u5b9a\u5411\u4e5f\u4e0d\u80fd\u7531\u8ba4\u8bc1\u670d\u52a1\u6765\u91cd\u5b9a\u5411\u4e86\uff0c\u5e94\u8be5\u7531\u524d\u7aef\u91cd\u5b9a\u5411\uff1b\u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f\u7684\u5bb9\u5668\u4e5f\u4e0d\u80fd\u4ee5",(0,r.jsx)(n.code,{children:"session"}),"\u4e3a\u4e3b\u4e86\uff0c\u4f7f\u7528redis\u6765\u66ff\u6362",(0,r.jsx)(n.code,{children:"session"}),"\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\xa0",(0,r.jsxs)(n.del,{children:["\u4f7f\u7528redis\u540e\u6ca1\u6709",(0,r.jsx)(n.code,{children:"session"}),"\u4e86\uff0c\u4e5f\u5c31\u4e0d\u80fd\u786e\u5b9a\u8bf7\u6c42\u662f\u54ea\u4e00\u4e2a\uff0c\u672c\u4eba\u62d9\u89c1\u662f\u5728\u767b\u5f55\u65f6\u643a\u5e26\u4e00\u4e2a\u552f\u4e00\u5b57\u7b26\u4e32\uff0c\u8bf7\u6c42\u6210\u529f\u540e\u524d\u7aef\u91cd\u5b9a\u5411\u81f3\u9700\u8981\u8ba4\u8bc1\u7684\u8bf7\u6c42\u65f6\u643a\u5e26\u8be5\u552f\u4e00\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837\u8bf7\u6c42\u65f6\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u552f\u4e00\u5b57\u7b26\u4e32\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\u3002"]})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2023-07-11\u4fee\u6539\uff1a\u53ea\u8981\u7528\u6237\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee\u8ba4\u8bc1\u670d\u52a1\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"session"}),"\uff0c\u6240\u4ee5\u5f53\u8bf7\u6c42\u6388\u6743\u65f6\u6216\u8005\u8bbf\u95ee\u5176\u5b83\u9700\u8981\u767b\u5f55\u7684\u63a5\u53e3\u65f6\uff0c\u901a\u8fc7\u672a\u767b\u5f55\u5904\u7406\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762\u65f6\u83b7\u53d6\u5f53\u524d\u8bf7\u6c42\u7684",(0,r.jsx)(n.code,{children:"sessionId"}),"\uff0c\u653e\u5165\u91cd\u5b9a\u5411\u5730\u5740\u7684\u53c2\u6570\u4e2d\uff1b\u6d4f\u89c8\u5668\u4e2d\u5728\u767b\u5f55\u9875\u9762\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u63d0\u4ea4\u65f6\u643a\u5e26\u5730\u5740\u680f\u4e2d\u7684",(0,r.jsx)(n.code,{children:"sessionId"}),"\uff1b\u5b58\u53d6\u8ba4\u8bc1\u4fe1\u606f\u65f6\u83b7\u53d6",(0,r.jsx)(n.code,{children:"sessionId"}),"\u7684\u987a\u5e8f\u4e3a\uff1a\u8bf7\u6c42\u5934 ---\x3e>> \u8bf7\u6c42\u53c2\u6570 ---\x3e>> \u5f53\u524d",(0,r.jsx)(n.code,{children:"session"}),"\uff1b\u8fd9\u6837\u4e00\u6765\u5c31\u53ef\u4ee5\u901a\u8fc7",(0,r.jsx)(n.code,{children:"session"}),"\u5c06\u8ba4\u8bc1\u670d\u52a1\u548c\u5355\u72ec\u90e8\u7f72\u7684\u767b\u5f55\u9875\u9762\u4e2d\u7684\u8bf7\u6c42\u4e32\u8054\u8d77\u6765\u4e86\uff0c\u8be6\u7ec6\u5b9e\u73b0\u8bf7\u770b\u4e0b\u65b9\u4ee3\u7801"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4e3b\u8981\u5c31\u662f\u91cd\u5b9a\u5411\u65f6\u5c06\u5f53\u524d\u8bf7\u6c42\u653e\u5165",(0,r.jsx)(n.code,{children:"target"}),"\u53c2\u6570\u4e2d\uff0c\u5f53\u524d",(0,r.jsx)(n.code,{children:"sessionId"}),"\u653e\u5165",(0,r.jsx)(n.code,{children:"nonceId"}),"\u53c2\u6570\u4e2d"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2023-07-21\u4fee\u6539\u5185\u5bb9\uff1aoauth\u534f\u8bae\u4e2d\u6709",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\uff0c\u4e3a\u9632\u6b62\u51b2\u7a81\uff0c",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\u6539\u4e3a",(0,r.jsx)(n.code,{children:"nonceId"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u601d\u8def\u6e05\u6670\u4ee5\u540e\u7f16\u7801\u5c31\u5f88\u5feb\u4e86"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u91cd\u5199\u767b\u5f55\u6210\u529f\u5904\u7406(\u54cd\u5e94json)\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u91cd\u5199\u767b\u5f55\u5931\u8d25\u5904\u7406(\u54cd\u5e94json)\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u91cd\u5199\u672a\u767b\u5f55\u5904\u7406\uff0c\u91cd\u5b9a\u5411\u5230\u767b\u5f55\u9875\u9762\u65f6\u643a\u5e26\u5f53\u524d\u8bf7\u6c42url\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u91cd\u5199\u8ba4\u8bc1\u4fe1\u606f\u5b58\u53d6\u903b\u8f91\uff0c\u4f7f\u7528redis\u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u5c06\u4ee5\u4e0a\u5185\u5bb9\u6dfb\u52a0\u5230Spring Authorization Server\u914d\u7f6e\u4e2d\uff0c\u4f7f\u5176\u5728\u8fc7\u6ee4\u5668\u94fe\u4e2d\u751f\u6548"}),"\n",(0,r.jsx)(n.li,{children:"\u524d\u7aef\u4ee3\u7801\u7f16\u5199\uff0c\u6309\u7167\u8981\u6c42\u4f20\u9012\u552f\u4e00\u5b57\u7b26\u4e32\u5e76\u5728\u767b\u5f55\u6210\u529f\u540e\u91cd\u5b9a\u5411\u81f3\u53c2\u6570\u4e2d\u643a\u5e26\u7684\u5730\u5740"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u4e09\u4ee3\u7801\u5b9e\u73b0",children:"\u4e09\u3001\u4ee3\u7801\u5b9e\u73b0"}),"\n",(0,r.jsxs)(n.h3,{id:"1-\u521b\u5efaloginsuccesshandler\u7c7b\u5e76\u5b9e\u73b0authenticationsuccesshandler\u63a5\u53e3",children:["1. \u521b\u5efa",(0,r.jsx)(n.code,{children:"LoginSuccessHandler"}),"\u7c7b\u5e76\u5b9e\u73b0",(0,r.jsx)(n.code,{children:"AuthenticationSuccessHandler"}),"\u63a5\u53e3"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"package com.example.authorization.handler;  \n  \nimport com.example.model.Result;  \nimport com.example.util.JsonUtils;  \nimport jakarta.servlet.http.HttpServletRequest;  \nimport jakarta.servlet.http.HttpServletResponse;  \nimport org.springframework.http.MediaType;  \nimport org.springframework.security.core.Authentication;  \nimport org.springframework.security.web.authentication.AuthenticationSuccessHandler;  \n  \nimport java.io.IOException;  \nimport java.nio.charset.StandardCharsets;  \n  \n/**  \n* \u767b\u5f55\u6210\u529f\u5904\u7406\u7c7b  \n*  \n* @author vains  \n*/  \npublic class LoginSuccessHandler implements AuthenticationSuccessHandler {  \n  \n    @Override  \n    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException {  \n        Result<String> success = Result.success();  \n        response.setCharacterEncoding(StandardCharsets.UTF_8.name());  \n        response.setContentType(MediaType.APPLICATION_JSON_VALUE);  \n        response.getWriter().write(JsonUtils.objectCovertToJson(success));  \n        response.getWriter().flush();  \n    }  \n  \n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"2-\u521b\u5efaloginfailurehandler\u7c7b\u5e76\u5b9e\u73b0authenticationfailurehandler\u63a5\u53e3",children:["2. \u521b\u5efa",(0,r.jsx)(n.code,{children:"LoginFailureHandler"}),"\u7c7b\u5e76\u5b9e\u73b0",(0,r.jsx)(n.code,{children:"AuthenticationFailureHandler"}),"\u63a5\u53e3"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"package com.example.authorization.handler;  \n  \nimport com.example.model.Result;  \nimport com.example.util.JsonUtils;  \nimport jakarta.servlet.http.HttpServletRequest;  \nimport jakarta.servlet.http.HttpServletResponse;  \nimport org.springframework.http.HttpStatus;  \nimport org.springframework.http.MediaType;  \nimport org.springframework.security.core.AuthenticationException;  \nimport org.springframework.security.web.authentication.AuthenticationFailureHandler;  \n  \nimport java.io.IOException;  \nimport java.nio.charset.StandardCharsets;  \n  \n/**  \n* \u767b\u5f55\u5931\u8d25\u5904\u7406\u7c7b  \n*  \n* @author vains  \n*/  \npublic class LoginFailureHandler implements AuthenticationFailureHandler {  \n  \n    @Override  \n    public void onAuthenticationFailure(HttpServletRequest request, HttpServletResponse response, AuthenticationException exception) throws IOException {  \n        // \u767b\u5f55\u5931\u8d25\uff0c\u5199\u56de401\u4e0e\u5177\u4f53\u7684\u5f02\u5e38  \n        Result<String> success = Result.error(HttpStatus.UNAUTHORIZED.value(), exception.getMessage());  \n        response.setCharacterEncoding(StandardCharsets.UTF_8.name());  \n        response.setContentType(MediaType.APPLICATION_JSON_VALUE);  \n        response.getWriter().write(JsonUtils.objectCovertToJson(success));  \n        response.getWriter().flush();  \n    }  \n  \n}\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"3-\u521b\u5efalogintargetauthenticationentrypoint\u7c7b\u5e76\u7ee7\u627floginurlauthenticationentrypoint\u7c7b",children:["3. \u521b\u5efa",(0,r.jsx)(n.code,{children:"LoginTargetAuthenticationEntryPoint"}),"\u7c7b\u5e76\u7ee7\u627f",(0,r.jsx)(n.code,{children:"LoginUrlAuthenticationEntryPoint"}),"\u7c7b"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2023-07-11\u6dfb\u52a0\u903b\u8f91\uff1a\u91cd\u5b9a\u5411\u5730\u5740\u6dfb\u52a0",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u7684\u503c\u4e3a",(0,r.jsx)(n.code,{children:"sessionId"}),"\uff0c\u8be6\u60c5\u8bf7\u67e5\u770b\u4ee3\u7801"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package com.example.authorization.handler;\n\nimport com.example.constant.SecurityConstants;\nimport jakarta.servlet.ServletException;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.security.core.AuthenticationException;\nimport org.springframework.security.web.DefaultRedirectStrategy;\nimport org.springframework.security.web.RedirectStrategy;\nimport org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint;\nimport org.springframework.security.web.util.UrlUtils;\nimport org.springframework.util.ObjectUtils;\n\nimport java.io.IOException;\nimport java.net.URLEncoder;\nimport java.nio.charset.StandardCharsets;\n\n/**\n * \u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u5904\u7406\n *\n * @author vains\n */\n@Slf4j\npublic class LoginTargetAuthenticationEntryPoint extends LoginUrlAuthenticationEntryPoint {\n\n    private final RedirectStrategy redirectStrategy = new DefaultRedirectStrategy();\n\n    /**\n     * @param loginFormUrl URL where the login page can be found. Should either be\n     *                     relative to the web-app context path (include a leading {@code /}) or an absolute\n     *                     URL.\n     */\n    public LoginTargetAuthenticationEntryPoint(String loginFormUrl) {\n        super(loginFormUrl);\n    }\n\n    @Override\n    public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException {\n\n        // \u83b7\u53d6\u767b\u5f55\u8868\u5355\u7684\u5730\u5740\n        String loginForm = determineUrlToUseForThisRequest(request, response, authException);\n        if (!UrlUtils.isAbsoluteUrl(loginForm)) {\n            // \u4e0d\u662f\u7edd\u5bf9\u8def\u5f84\u8c03\u7528\u7236\u7c7b\u65b9\u6cd5\u5904\u7406\n            super.commence(request, response, authException);\n            return;\n        }\n\n        StringBuffer requestUrl = request.getRequestURL();\n        if (!ObjectUtils.isEmpty(request.getQueryString())) {\n            requestUrl.append("?").append(request.getQueryString());\n        }\n\n        // 2023-07-11\u6dfb\u52a0\u903b\u8f91\uff1a\u91cd\u5b9a\u5411\u5730\u5740\u6dfb\u52a0nonce\u53c2\u6570\uff0c\u8be5\u53c2\u6570\u7684\u503c\u4e3asessionId\n        // \u7edd\u5bf9\u8def\u5f84\u5728\u91cd\u5b9a\u5411\u524d\u6dfb\u52a0target\u53c2\u6570\n        String targetParameter = URLEncoder.encode(requestUrl.toString(), StandardCharsets.UTF_8);\n        String targetUrl = loginForm + "?target=" + targetParameter + "&" + SecurityConstants.NONCE_HEADER_NAME + "=" + request.getSession(Boolean.FALSE).getId();\n        log.debug("\u91cd\u5b9a\u5411\u81f3\u524d\u540e\u7aef\u5206\u79bb\u7684\u767b\u5f55\u9875\u9762\uff1a{}", targetUrl);\n        this.redirectStrategy.sendRedirect(request, response, targetUrl);\n\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"1-\u5728securityconstants\u4e2d\u6dfb\u52a0nonce_header_name",children:["1. \u5728",(0,r.jsx)(n.code,{children:"SecurityConstants"}),"\u4e2d\u6dfb\u52a0",(0,r.jsx)(n.code,{children:"NONCE_HEADER_NAME"})]}),"\n",(0,r.jsxs)(n.p,{children:["2023-07-21\u4fee\u6539\u5185\u5bb9\uff1aoauth\u534f\u8bae\u4e2d\u6709",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\uff0c\u4e3a\u9632\u6b62\u51b2\u7a81\uff0c",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\u6539\u4e3a",(0,r.jsx)(n.code,{children:"nonceId"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u968f\u673a\u5b57\u7b26\u4e32\u8bf7\u6c42\u5934\u540d\u5b57\n */\npublic static final String NONCE_HEADER_NAME = "nonceId";\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"4-\u5728support\u5305\u4e0b\u521b\u5efaredissecuritycontextrepository\u5e76\u5b9e\u73b0securitycontextrepository",children:["4. \u5728support\u5305\u4e0b\u521b\u5efa",(0,r.jsx)(n.code,{children:"RedisSecurityContextRepository"}),"\u5e76\u5b9e\u73b0",(0,r.jsx)(n.code,{children:"SecurityContextRepository"})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"2023-07-11\u65b0\u589e\u903b\u8f91\uff1a\u5982\u679c\u8bf7\u6c42\u5934\u4e0e\u8bf7\u6c42\u53c2\u6570\u4e2d\u83b7\u53d6\u4e0d\u5230\u968f\u673a\u5b57\u7b26\u4e32nonce\u5219\u83b7\u53d6\u5f53\u524dsession\u7684sessionId\uff0c\u8be6\u60c5\u8bf7\u67e5\u770b\u4ee3\u7801"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package com.example.support;\n\nimport com.example.model.security.SupplierDeferredSecurityContext;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport jakarta.servlet.http.HttpSession;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.core.context.DeferredSecurityContext;\nimport org.springframework.security.core.context.SecurityContext;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.security.core.context.SecurityContextHolderStrategy;\nimport org.springframework.security.web.context.HttpRequestResponseHolder;\nimport org.springframework.security.web.context.SecurityContextRepository;\nimport org.springframework.stereotype.Component;\nimport org.springframework.util.ObjectUtils;\n\nimport java.util.function.Supplier;\n\nimport static com.example.constant.RedisConstants.DEFAULT_TIMEOUT_SECONDS;\nimport static com.example.constant.RedisConstants.SECURITY_CONTEXT_PREFIX_KEY;\nimport static com.example.constant.SecurityConstants.NONCE_HEADER_NAME;\n\n/**\n * \u57fa\u4e8eredis\u5b58\u50a8\u8ba4\u8bc1\u4fe1\u606f\n *\n * @author vains\n */\n@Component\n@RequiredArgsConstructor\npublic class RedisSecurityContextRepository implements SecurityContextRepository {\n\n    private final RedisOperator<SecurityContext> redisOperator;\n\n    private final SecurityContextHolderStrategy securityContextHolderStrategy = SecurityContextHolder\n            .getContextHolderStrategy();\n\n\n    @Override\n    public SecurityContext loadContext(HttpRequestResponseHolder requestResponseHolder) {\n//        HttpServletRequest request = requestResponseHolder.getRequest();\n//        return readSecurityContextFromRedis(request);\n        // \u65b9\u6cd5\u5df2\u8fc7\u65f6\uff0c\u4f7f\u7528 loadDeferredContext \u65b9\u6cd5\n        throw new UnsupportedOperationException("Method deprecated.");\n    }\n\n    @Override\n    public void saveContext(SecurityContext context, HttpServletRequest request, HttpServletResponse response) {\n        String nonce = getNonce(request);\n        if (ObjectUtils.isEmpty(nonce)) {\n            return;\n        }\n\n        // \u5982\u679c\u5f53\u524d\u7684context\u662f\u7a7a\u7684\uff0c\u5219\u79fb\u9664\n        SecurityContext emptyContext = this.securityContextHolderStrategy.createEmptyContext();\n        if (emptyContext.equals(context)) {\n            redisOperator.delete((SECURITY_CONTEXT_PREFIX_KEY + nonce));\n        } else {\n            // \u4fdd\u5b58\u8ba4\u8bc1\u4fe1\u606f\n            redisOperator.set((SECURITY_CONTEXT_PREFIX_KEY + nonce), context, DEFAULT_TIMEOUT_SECONDS);\n        }\n    }\n\n    @Override\n    public boolean containsContext(HttpServletRequest request) {\n        String nonce = getNonce(request);\n        if (ObjectUtils.isEmpty(nonce)) {\n            return false;\n        }\n        // \u68c0\u9a8c\u5f53\u524d\u8bf7\u6c42\u662f\u5426\u6709\u8ba4\u8bc1\u4fe1\u606f\n        return redisOperator.get((SECURITY_CONTEXT_PREFIX_KEY + nonce)) != null;\n    }\n\n    @Override\n    public DeferredSecurityContext loadDeferredContext(HttpServletRequest request) {\n        Supplier<SecurityContext> supplier = () -> readSecurityContextFromRedis(request);\n        return new SupplierDeferredSecurityContext(supplier, this.securityContextHolderStrategy);\n    }\n\n    /**\n     * \u4eceredis\u4e2d\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\n     *\n     * @param request \u5f53\u524d\u8bf7\u6c42\n     * @return \u8ba4\u8bc1\u4fe1\u606f\n     */\n    private SecurityContext readSecurityContextFromRedis(HttpServletRequest request) {\n        if (request == null) {\n            return null;\n        }\n\n        String nonce = getNonce(request);\n        if (ObjectUtils.isEmpty(nonce)) {\n            return null;\n        }\n\n        // \u6839\u636e\u7f13\u5b58id\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\n        return redisOperator.get((SECURITY_CONTEXT_PREFIX_KEY + nonce));\n    }\n\n    /**\n     * \u5148\u4ece\u8bf7\u6c42\u5934\u4e2d\u627e\uff0c\u627e\u4e0d\u5230\u53bb\u8bf7\u6c42\u53c2\u6570\u4e2d\u627e\uff0c\u627e\u4e0d\u5230\u83b7\u53d6\u5f53\u524dsession\u7684id\n     *  2023-07-11\u65b0\u589e\u903b\u8f91\uff1a\u83b7\u53d6\u5f53\u524dsession\u7684sessionId\n     *\n     * @param request \u5f53\u524d\u8bf7\u6c42\n     * @return \u968f\u673a\u5b57\u7b26\u4e32(sessionId)\uff0c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u672c\u6765\u662f\u524d\u7aef\u751f\u6210\uff0c\u73b0\u5728\u6539\u4e3a\u540e\u7aef\u83b7\u53d6\u7684sessionId\n     */\n    private String getNonce(HttpServletRequest request) {\n        String nonce = request.getHeader(NONCE_HEADER_NAME);\n        if (ObjectUtils.isEmpty(nonce)) {\n            nonce = request.getParameter(NONCE_HEADER_NAME);\n            HttpSession session = request.getSession(Boolean.FALSE);\n            if (ObjectUtils.isEmpty(nonce) && session != null) {\n                nonce = session.getId();\n            }\n        }\n        return nonce;\n    }\n\n}\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"1-\u8865\u5145supplierdeferredsecuritycontext\u7c7b",children:["1. \u8865\u5145",(0,r.jsx)(n.code,{children:"SupplierDeferredSecurityContext"}),"\u7c7b"]}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u7c7b\u9ed8\u8ba4\u5305\u5916\u65e0\u6cd5\u8bbf\u95ee\uff0c\u5c06\u6846\u67b6\u4e2d\u7684\u590d\u5236\u4e00\u4efd\u66b4\u9732\u51fa\u6765"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package com.example.model.security;\n\nimport java.util.function.Supplier;\n\nimport org.apache.commons.logging.Log;\nimport org.apache.commons.logging.LogFactory;\n\nimport org.springframework.core.log.LogMessage;\nimport org.springframework.security.core.context.DeferredSecurityContext;\nimport org.springframework.security.core.context.SecurityContext;\nimport org.springframework.security.core.context.SecurityContextHolderStrategy;\n\n/**\n * @author Steve Riesenberg\n * @since 5.8\n */\npublic final class SupplierDeferredSecurityContext implements DeferredSecurityContext {\n\n    private static final Log logger = LogFactory.getLog(SupplierDeferredSecurityContext.class);\n\n    private final Supplier<SecurityContext> supplier;\n\n    private final SecurityContextHolderStrategy strategy;\n\n    private SecurityContext securityContext;\n\n    private boolean missingContext;\n\n    public SupplierDeferredSecurityContext(Supplier<SecurityContext> supplier, SecurityContextHolderStrategy strategy) {\n        this.supplier = supplier;\n        this.strategy = strategy;\n    }\n\n    @Override\n    public SecurityContext get() {\n        init();\n        return this.securityContext;\n    }\n\n    @Override\n    public boolean isGenerated() {\n        init();\n        return this.missingContext;\n    }\n\n    private void init() {\n        if (this.securityContext != null) {\n            return;\n        }\n\n        this.securityContext = this.supplier.get();\n        this.missingContext = (this.securityContext == null);\n        if (this.missingContext) {\n            this.securityContext = this.strategy.createEmptyContext();\n            if (logger.isTraceEnabled()) {\n                logger.trace(LogMessage.format("Created %s", this.securityContext));\n            }\n        }\n    }\n\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"5-\u5c06\u4ee5\u4e0a\u81ea\u5df1\u521b\u5efa\u7684\u7c7b\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d",children:"5. \u5c06\u4ee5\u4e0a\u81ea\u5df1\u521b\u5efa\u7684\u7c7b\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d"}),"\n",(0,r.jsx)(n.h4,{id:"1-\u914d\u7f6e\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e",children:"1. \u914d\u7f6e\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// \u4e3b\u8981\u662f\u4ee5\u4e0b\u4e24\u5904\u914d\u7f6e\n// \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f \nhttp.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n// \u8fd9\u91cc\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u672a\u767b\u5f55\u5904\u7406\uff0c\u5e76\u8bbe\u7f6e\u767b\u5f55\u5730\u5740\u4e3a\u524d\u7aef\u7684\u767b\u5f55\u5730\u5740\nhttp\n        // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n        .exceptionHandling((exceptions) -> exceptions\n                .defaultAuthenticationEntryPointFor(\n                // \u8fd9\u91cc\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u672a\u767b\u5f55\u5904\u7406\uff0c\u5e76\u8bbe\u7f6e\u767b\u5f55\u5730\u5740\u4e3a\u524d\u7aef\u7684\u767b\u5f55\u5730\u5740\n                        new LoginTargetAuthenticationEntryPoint("http://127.0.0.1:5173"),\n                        new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                )\n        )\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u914d\u7f6e\u7aef\u70b9\u7684\u8fc7\u6ee4\u5668\u94fe\n *\n * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n * @return \u8fc7\u6ee4\u5668\u94fe\n * @throws Exception \u629b\u51fa\n */\n@Bean\npublic SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http,\n                                                                  RegisteredClientRepository registeredClientRepository,\n                                                                  AuthorizationServerSettings authorizationServerSettings) throws Exception {\n    // \u914d\u7f6e\u9ed8\u8ba4\u7684\u8bbe\u7f6e\uff0c\u5ffd\u7565\u8ba4\u8bc1\u7aef\u70b9\u7684csrf\u6821\u9a8c\n    OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);\n\n    // \u65b0\u5efa\u8bbe\u5907\u7801converter\u548cprovider\n    DeviceClientAuthenticationConverter deviceClientAuthenticationConverter =\n            new DeviceClientAuthenticationConverter(\n                    authorizationServerSettings.getDeviceAuthorizationEndpoint());\n    DeviceClientAuthenticationProvider deviceClientAuthenticationProvider =\n            new DeviceClientAuthenticationProvider(registeredClientRepository);\n\n    // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n    http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n    http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n            // \u5f00\u542fOpenID Connect 1.0\u534f\u8bae\u76f8\u5173\u7aef\u70b9\n            .oidc(Customizer.withDefaults())\n            // \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7528\u6237\u786e\u8ba4\u6388\u6743\u9875\n            .authorizationEndpoint(authorizationEndpoint -> authorizationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI))\n            // \u8bbe\u7f6e\u8bbe\u5907\u7801\u7528\u6237\u9a8c\u8bc1url(\u81ea\u5b9a\u4e49\u7528\u6237\u9a8c\u8bc1\u9875)\n            .deviceAuthorizationEndpoint(deviceAuthorizationEndpoint ->\n                    deviceAuthorizationEndpoint.verificationUri("/activate")\n            )\n            // \u8bbe\u7f6e\u9a8c\u8bc1\u8bbe\u5907\u7801\u7528\u6237\u786e\u8ba4\u9875\u9762\n            .deviceVerificationEndpoint(deviceVerificationEndpoint ->\n                    deviceVerificationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI)\n            )\n            .clientAuthentication(clientAuthentication ->\n                    // \u5ba2\u6237\u7aef\u8ba4\u8bc1\u6dfb\u52a0\u8bbe\u5907\u7801\u7684converter\u548cprovider\n                    clientAuthentication\n                            .authenticationConverter(deviceClientAuthenticationConverter)\n                            .authenticationProvider(deviceClientAuthenticationProvider)\n            );\n    http\n            // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n            .exceptionHandling((exceptions) -> exceptions\n                    .defaultAuthenticationEntryPointFor(\n                            new LoginTargetAuthenticationEntryPoint("http://127.0.0.1:5173"),\n                            new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                    )\n            )\n            // \u5904\u7406\u4f7f\u7528access token\u8bbf\u95ee\u7528\u6237\u4fe1\u606f\u7aef\u70b9\u548c\u5ba2\u6237\u7aef\u6ce8\u518c\u7aef\u70b9\n            .oauth2ResourceServer((resourceServer) -> resourceServer\n                    .jwt(Customizer.withDefaults()));\n\n    // \u81ea\u5b9a\u4e49\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\u8f6c\u6362\u5668\n    SmsCaptchaGrantAuthenticationConverter converter = new SmsCaptchaGrantAuthenticationConverter();\n    // \u81ea\u5b9a\u4e49\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\u8ba4\u8bc1\u63d0\u4f9b\n    SmsCaptchaGrantAuthenticationProvider provider = new SmsCaptchaGrantAuthenticationProvider();\n    http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n            // \u8ba9\u8ba4\u8bc1\u670d\u52a1\u5668\u5143\u6570\u636e\u4e2d\u6709\u81ea\u5b9a\u4e49\u7684\u8ba4\u8bc1\u65b9\u5f0f\n            .authorizationServerMetadataEndpoint(metadata -> metadata.authorizationServerMetadataCustomizer(customizer -> customizer.grantType(SecurityConstants.GRANT_TYPE_SMS_CODE)))\n            // \u6dfb\u52a0\u81ea\u5b9a\u4e49grant_type\u2014\u2014\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\n            .tokenEndpoint(tokenEndpoint -> tokenEndpoint\n                    .accessTokenRequestConverter(converter)\n                    .authenticationProvider(provider));\n\n    DefaultSecurityFilterChain build = http.build();\n\n    // \u4ece\u6846\u67b6\u4e2d\u83b7\u53d6provider\u4e2d\u6240\u9700\u7684bean\n    OAuth2TokenGenerator<?> tokenGenerator = http.getSharedObject(OAuth2TokenGenerator.class);\n    AuthenticationManager authenticationManager = http.getSharedObject(AuthenticationManager.class);\n    OAuth2AuthorizationService authorizationService = http.getSharedObject(OAuth2AuthorizationService.class);\n    // \u4ee5\u4e0a\u4e09\u4e2abean\u5728build()\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528\u662f\u56e0\u4e3a\u8c03\u7528build\u65b9\u6cd5\u65f6\u6846\u67b6\u4f1a\u5c1d\u8bd5\u83b7\u53d6\u8fd9\u4e9b\u7c7b\uff0c\n    // \u5982\u679c\u83b7\u53d6\u4e0d\u5230\u5219\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u653e\u5165SharedObject\u4e2d\uff0c\u6240\u4ee5\u8981\u5728build\u65b9\u6cd5\u8c03\u7528\u4e4b\u540e\u83b7\u53d6\n    // \u5728\u901a\u8fc7set\u65b9\u6cd5\u8bbe\u7f6e\u8fdbprovider\u4e2d\uff0c\u4f46\u662f\u5982\u679c\u5728build\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528authenticationProvider(provider)\n    // \u6846\u67b6\u4f1a\u63d0\u793aunsupported_grant_type\uff0c\u56e0\u4e3a\u5df2\u7ecf\u521d\u59cb\u5316\u5b8c\u4e86\uff0c\u5728\u6dfb\u52a0\u5c31\u4e0d\u4f1a\u751f\u6548\u4e86\n    provider.setTokenGenerator(tokenGenerator);\n    provider.setAuthorizationService(authorizationService);\n    provider.setAuthenticationManager(authenticationManager);\n\n    return build;\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"2-\u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e",children:"2. \u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe(\u8d44\u6e90\u670d\u52a1\u5668\u914d\u7f6e)"}),"\n",(0,r.jsx)(n.p,{children:"\u914d\u7f6e\u5730\u65b9\u8ddf\u4e0a\u8fb9\u5dee\u4e0d\u591a\uff0c\u81ea\u5b9a\u4e49\u767b\u5f55\u6210\u529f/\u5931\u8d25\u5904\u7406\uff0c\u4f7f\u7528redis\u66ff\u6362session\u7684\u5b58\u50a8\uff0c\u56e0\u4e3a\u524d\u540e\u7aef\u5206\u79bb\u4e86\uff0c\u8fd8\u8981\u914d\u7f6e\u89e3\u51b3\u8de8\u57df\u95ee\u9898\u7684\u8fc7\u6ee4\u5668\uff0c\u5e76\u7981\u7528cors\u4e0ecsrf\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8de8\u57df\u8fc7\u6ee4\u5668\u4e00\u5b9a\u8981\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d\uff0c\u4e0d\u7136\u53ea\u6ce8\u5165ioc\u4e2d\u5bf9\u4e8esecurity\u7aef\u70b9\u4e0d\u751f\u6548\uff01"}),"\n",(0,r.jsx)(n.li,{children:"\u8de8\u57df\u8fc7\u6ee4\u5668\u4e00\u5b9a\u8981\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d\uff0c\u4e0d\u7136\u53ea\u6ce8\u5165ioc\u4e2d\u5bf9\u4e8esecurity\u7aef\u70b9\u4e0d\u751f\u6548\uff01"}),"\n",(0,r.jsx)(n.li,{children:"\u8de8\u57df\u8fc7\u6ee4\u5668\u4e00\u5b9a\u8981\u6dfb\u52a0\u81f3security\u914d\u7f6e\u4e2d\uff0c\u4e0d\u7136\u53ea\u6ce8\u5165ioc\u4e2d\u5bf9\u4e8esecurity\u7aef\u70b9\u4e0d\u751f\u6548\uff01"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe\n *\n * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n * @return \u8fc7\u6ee4\u5668\u94fe\n * @throws Exception \u629b\u51fa\n */\n@Bean\npublic SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {\n    // \u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668\n    http.addFilter(corsFilter());\n    // \u7981\u7528 csrf \u4e0e cors\n    http.csrf(AbstractHttpConfigurer::disable);\n    http.cors(AbstractHttpConfigurer::disable);\n    http.authorizeHttpRequests((authorize) -> authorize\n                    // \u653e\u884c\u9759\u6001\u8d44\u6e90\n                    .requestMatchers("/assets/**", "/webjars/**", "/login", "/getCaptcha", "/getSmsCaptcha").permitAll()\n                    .anyRequest().authenticated()\n            )\n            // \u6307\u5b9a\u767b\u5f55\u9875\u9762\n            .formLogin(formLogin ->\n                    formLogin.loginPage("/login")\n                            // \u767b\u5f55\u6210\u529f\u548c\u5931\u8d25\u6539\u4e3a\u5199\u56dejson\uff0c\u4e0d\u91cd\u5b9a\u5411\u4e86\n                            .successHandler(new LoginSuccessHandler())\n                            .failureHandler(new LoginFailureHandler())\n            );\n    // \u6dfb\u52a0BearerTokenAuthenticationFilter\uff0c\u5c06\u8ba4\u8bc1\u670d\u52a1\u5f53\u505a\u4e00\u4e2a\u8d44\u6e90\u670d\u52a1\uff0c\u89e3\u6790\u8bf7\u6c42\u5934\u4e2d\u7684token\n    http.oauth2ResourceServer((resourceServer) -> resourceServer\n            .jwt(Customizer.withDefaults())\n            .accessDeniedHandler(SecurityUtils::exceptionHandler)\n            .authenticationEntryPoint(SecurityUtils::exceptionHandler)\n    );\n    http\n            // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n            .exceptionHandling((exceptions) -> exceptions\n                    .defaultAuthenticationEntryPointFor(\n                            new LoginTargetAuthenticationEntryPoint("http://127.0.0.1:5173"),\n                            new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                    )\n            );\n\n    // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n    http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n    return http.build();\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"3-\u5728authorizationconfig\u4e2d\u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668",children:"3. \u5728AuthorizationConfig\u4e2d\u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**\n * \u8de8\u57df\u8fc7\u6ee4\u5668\u914d\u7f6e\n *\n * @return CorsFilter\n */\n@Bean\npublic CorsFilter corsFilter() {\n\n    // \u521d\u59cb\u5316cors\u914d\u7f6e\u5bf9\u8c61\n    CorsConfiguration configuration = new CorsConfiguration();\n\n    // \u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u7684\u57df\u540d,\u5982\u679c\u5141\u8bb8\u643a\u5e26cookie\u7684\u8bdd,\u8def\u5f84\u5c31\u4e0d\u80fd\u5199*\u53f7, *\u8868\u793a\u6240\u6709\u7684\u57df\u540d\u90fd\u53ef\u4ee5\u8de8\u57df\u8bbf\u95ee\n    configuration.addAllowedOrigin("http://127.0.0.1:5173");\n    // \u8bbe\u7f6e\u8de8\u57df\u8bbf\u95ee\u53ef\u4ee5\u643a\u5e26cookie\n    configuration.setAllowCredentials(true);\n    // \u5141\u8bb8\u6240\u6709\u7684\u8bf7\u6c42\u65b9\u6cd5 ==> GET POST PUT Delete\n    configuration.addAllowedMethod("*");\n    // \u5141\u8bb8\u643a\u5e26\u4efb\u4f55\u5934\u4fe1\u606f\n    configuration.addAllowedHeader("*");\n\n    // \u521d\u59cb\u5316cors\u914d\u7f6e\u6e90\u5bf9\u8c61\n    UrlBasedCorsConfigurationSource configurationSource = new UrlBasedCorsConfigurationSource();\n\n    // \u7ed9\u914d\u7f6e\u6e90\u5bf9\u8c61\u8bbe\u7f6e\u8fc7\u6ee4\u7684\u53c2\u6570\n    // \u53c2\u6570\u4e00: \u8fc7\u6ee4\u7684\u8def\u5f84 == > \u6240\u6709\u7684\u8def\u5f84\u90fd\u8981\u6c42\u6821\u9a8c\u662f\u5426\u8de8\u57df\n    // \u53c2\u6570\u4e8c: \u914d\u7f6e\u7c7b\n    configurationSource.registerCorsConfiguration("/**", configuration);\n\n    // \u8fd4\u56de\u914d\u7f6e\u597d\u7684\u8fc7\u6ee4\u5668\n    return new CorsFilter(configurationSource);\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"4-redisconstants\u4e2d\u6dfb\u52a0\u5e38\u91cf",children:"4. RedisConstants\u4e2d\u6dfb\u52a0\u5e38\u91cf"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'/**  \n * \u8ba4\u8bc1\u4fe1\u606f\u5b58\u50a8\u524d\u7f00  \n */  \npublic static final String SECURITY_CONTEXT_PREFIX_KEY = "security_context:";\n'})}),"\n",(0,r.jsxs)(n.h4,{id:"5-\u5982\u679c\u6ca1\u6709redisoperator\u53ef\u4ee5\u770b\u4e0b\u6211\u4e4b\u524d\u7684\u4f18\u5316\u7bc7",children:["5. \u5982\u679c\u6ca1\u6709RedisOperator\u53ef\u4ee5\u770b\u4e0b\u6211\u4e4b\u524d\u7684",(0,r.jsx)(n.a,{href:"https://juejin.cn/post/7253331974050299963",children:"\u4f18\u5316\u7bc7"})]}),"\n",(0,r.jsx)(n.h4,{id:"6-\u5b8c\u6574\u7684authorizationconfig\u5982\u4e0b",children:"6. \u5b8c\u6574\u7684AuthorizationConfig\u5982\u4e0b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'package com.example.config;\n\nimport com.example.authorization.device.DeviceClientAuthenticationConverter;\nimport com.example.authorization.device.DeviceClientAuthenticationProvider;\nimport com.example.authorization.handler.LoginFailureHandler;\nimport com.example.authorization.handler.LoginSuccessHandler;\nimport com.example.authorization.handler.LoginTargetAuthenticationEntryPoint;\nimport com.example.authorization.sms.SmsCaptchaGrantAuthenticationConverter;\nimport com.example.authorization.sms.SmsCaptchaGrantAuthenticationProvider;\nimport com.example.constant.SecurityConstants;\nimport com.example.support.RedisSecurityContextRepository;\nimport com.example.util.SecurityUtils;\nimport com.nimbusds.jose.jwk.JWKSet;\nimport com.nimbusds.jose.jwk.RSAKey;\nimport com.nimbusds.jose.jwk.source.ImmutableJWKSet;\nimport com.nimbusds.jose.jwk.source.JWKSource;\nimport com.nimbusds.jose.proc.SecurityContext;\nimport lombok.RequiredArgsConstructor;\nimport lombok.SneakyThrows;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.MediaType;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.security.access.annotation.Secured;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.Customizer;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.oauth2.core.AuthorizationGrantType;\nimport org.springframework.security.oauth2.core.ClientAuthenticationMethod;\nimport org.springframework.security.oauth2.core.oidc.OidcScopes;\nimport org.springframework.security.oauth2.jwt.JwtClaimsSet;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\nimport org.springframework.security.oauth2.server.authorization.JdbcOAuth2AuthorizationConsentService;\nimport org.springframework.security.oauth2.server.authorization.JdbcOAuth2AuthorizationService;\nimport org.springframework.security.oauth2.server.authorization.OAuth2AuthorizationConsentService;\nimport org.springframework.security.oauth2.server.authorization.OAuth2AuthorizationService;\nimport org.springframework.security.oauth2.server.authorization.client.JdbcRegisteredClientRepository;\nimport org.springframework.security.oauth2.server.authorization.client.RegisteredClient;\nimport org.springframework.security.oauth2.server.authorization.client.RegisteredClientRepository;\nimport org.springframework.security.oauth2.server.authorization.config.annotation.web.configuration.OAuth2AuthorizationServerConfiguration;\nimport org.springframework.security.oauth2.server.authorization.config.annotation.web.configurers.OAuth2AuthorizationServerConfigurer;\nimport org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;\nimport org.springframework.security.oauth2.server.authorization.settings.ClientSettings;\nimport org.springframework.security.oauth2.server.authorization.token.JwtEncodingContext;\nimport org.springframework.security.oauth2.server.authorization.token.OAuth2TokenCustomizer;\nimport org.springframework.security.oauth2.server.authorization.token.OAuth2TokenGenerator;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationConverter;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtGrantedAuthoritiesConverter;\nimport org.springframework.security.web.DefaultSecurityFilterChain;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.util.matcher.MediaTypeRequestMatcher;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\n\nimport java.security.KeyPair;\nimport java.security.KeyPairGenerator;\nimport java.security.interfaces.RSAPrivateKey;\nimport java.security.interfaces.RSAPublicKey;\nimport java.util.*;\nimport java.util.stream.Collectors;\n\n/**\n * \u8ba4\u8bc1\u914d\u7f6e\n * {@link EnableMethodSecurity} \u5f00\u542f\u5168\u5c40\u65b9\u6cd5\u8ba4\u8bc1\uff0c\u542f\u7528JSR250\u6ce8\u89e3\u652f\u6301\uff0c\u542f\u7528\u6ce8\u89e3 {@link Secured} \u652f\u6301\uff0c\n * \u5728Spring Security 6.0\u7248\u672c\u4e2d\u5c06@Configuration\u6ce8\u89e3\u4ece@EnableWebSecurity, @EnableMethodSecurity, @EnableGlobalMethodSecurity\n * \u548c @EnableGlobalAuthentication \u4e2d\u79fb\u9664\uff0c\u4f7f\u7528\u8fd9\u4e9b\u6ce8\u89e3\u9700\u624b\u52a8\u6dfb\u52a0 @Configuration \u6ce8\u89e3\n * {@link EnableWebSecurity} \u6ce8\u89e3\u6709\u4e24\u4e2a\u4f5c\u7528:\n * 1. \u52a0\u8f7d\u4e86WebSecurityConfiguration\u914d\u7f6e\u7c7b, \u914d\u7f6e\u5b89\u5168\u8ba4\u8bc1\u7b56\u7565\u3002\n * 2. \u52a0\u8f7d\u4e86AuthenticationConfiguration, \u914d\u7f6e\u4e86\u8ba4\u8bc1\u4fe1\u606f\u3002\n *\n * @author vains\n */\n@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\n@EnableMethodSecurity(jsr250Enabled = true, securedEnabled = true)\npublic class AuthorizationConfig {\n\n    private static final String CUSTOM_CONSENT_PAGE_URI = "/oauth2/consent";\n\n    private final RedisSecurityContextRepository redisSecurityContextRepository;\n\n    /**\n     * \u914d\u7f6e\u7aef\u70b9\u7684\u8fc7\u6ee4\u5668\u94fe\n     *\n     * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n     * @return \u8fc7\u6ee4\u5668\u94fe\n     * @throws Exception \u629b\u51fa\n     */\n    @Bean\n    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http,\n                                                                      RegisteredClientRepository registeredClientRepository,\n                                                                      AuthorizationServerSettings authorizationServerSettings) throws Exception {\n        // \u914d\u7f6e\u9ed8\u8ba4\u7684\u8bbe\u7f6e\uff0c\u5ffd\u7565\u8ba4\u8bc1\u7aef\u70b9\u7684csrf\u6821\u9a8c\n        OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);\n\n        // \u65b0\u5efa\u8bbe\u5907\u7801converter\u548cprovider\n        DeviceClientAuthenticationConverter deviceClientAuthenticationConverter =\n                new DeviceClientAuthenticationConverter(\n                        authorizationServerSettings.getDeviceAuthorizationEndpoint());\n        DeviceClientAuthenticationProvider deviceClientAuthenticationProvider =\n                new DeviceClientAuthenticationProvider(registeredClientRepository);\n\n        // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n        http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n        http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n                // \u5f00\u542fOpenID Connect 1.0\u534f\u8bae\u76f8\u5173\u7aef\u70b9\n                .oidc(Customizer.withDefaults())\n                // \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7528\u6237\u786e\u8ba4\u6388\u6743\u9875\n                .authorizationEndpoint(authorizationEndpoint -> authorizationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI))\n                // \u8bbe\u7f6e\u8bbe\u5907\u7801\u7528\u6237\u9a8c\u8bc1url(\u81ea\u5b9a\u4e49\u7528\u6237\u9a8c\u8bc1\u9875)\n                .deviceAuthorizationEndpoint(deviceAuthorizationEndpoint ->\n                        deviceAuthorizationEndpoint.verificationUri("/activate")\n                )\n                // \u8bbe\u7f6e\u9a8c\u8bc1\u8bbe\u5907\u7801\u7528\u6237\u786e\u8ba4\u9875\u9762\n                .deviceVerificationEndpoint(deviceVerificationEndpoint ->\n                        deviceVerificationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI)\n                )\n                .clientAuthentication(clientAuthentication ->\n                        // \u5ba2\u6237\u7aef\u8ba4\u8bc1\u6dfb\u52a0\u8bbe\u5907\u7801\u7684converter\u548cprovider\n                        clientAuthentication\n                                .authenticationConverter(deviceClientAuthenticationConverter)\n                                .authenticationProvider(deviceClientAuthenticationProvider)\n                );\n        http\n                // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n                .exceptionHandling((exceptions) -> exceptions\n                        .defaultAuthenticationEntryPointFor(\n                                new LoginTargetAuthenticationEntryPoint("http://127.0.0.1:5173"),\n                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                        )\n                )\n                // \u5904\u7406\u4f7f\u7528access token\u8bbf\u95ee\u7528\u6237\u4fe1\u606f\u7aef\u70b9\u548c\u5ba2\u6237\u7aef\u6ce8\u518c\u7aef\u70b9\n                .oauth2ResourceServer((resourceServer) -> resourceServer\n                        .jwt(Customizer.withDefaults()));\n\n        // \u81ea\u5b9a\u4e49\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\u8f6c\u6362\u5668\n        SmsCaptchaGrantAuthenticationConverter converter = new SmsCaptchaGrantAuthenticationConverter();\n        // \u81ea\u5b9a\u4e49\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\u8ba4\u8bc1\u63d0\u4f9b\n        SmsCaptchaGrantAuthenticationProvider provider = new SmsCaptchaGrantAuthenticationProvider();\n        http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n                // \u8ba9\u8ba4\u8bc1\u670d\u52a1\u5668\u5143\u6570\u636e\u4e2d\u6709\u81ea\u5b9a\u4e49\u7684\u8ba4\u8bc1\u65b9\u5f0f\n                .authorizationServerMetadataEndpoint(metadata -> metadata.authorizationServerMetadataCustomizer(customizer -> customizer.grantType(SecurityConstants.GRANT_TYPE_SMS_CODE)))\n                // \u6dfb\u52a0\u81ea\u5b9a\u4e49grant_type\u2014\u2014\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\n                .tokenEndpoint(tokenEndpoint -> tokenEndpoint\n                        .accessTokenRequestConverter(converter)\n                        .authenticationProvider(provider));\n\n        DefaultSecurityFilterChain build = http.build();\n\n        // \u4ece\u6846\u67b6\u4e2d\u83b7\u53d6provider\u4e2d\u6240\u9700\u7684bean\n        OAuth2TokenGenerator<?> tokenGenerator = http.getSharedObject(OAuth2TokenGenerator.class);\n        AuthenticationManager authenticationManager = http.getSharedObject(AuthenticationManager.class);\n        OAuth2AuthorizationService authorizationService = http.getSharedObject(OAuth2AuthorizationService.class);\n        // \u4ee5\u4e0a\u4e09\u4e2abean\u5728build()\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528\u662f\u56e0\u4e3a\u8c03\u7528build\u65b9\u6cd5\u65f6\u6846\u67b6\u4f1a\u5c1d\u8bd5\u83b7\u53d6\u8fd9\u4e9b\u7c7b\uff0c\n        // \u5982\u679c\u83b7\u53d6\u4e0d\u5230\u5219\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u653e\u5165SharedObject\u4e2d\uff0c\u6240\u4ee5\u8981\u5728build\u65b9\u6cd5\u8c03\u7528\u4e4b\u540e\u83b7\u53d6\n        // \u5728\u901a\u8fc7set\u65b9\u6cd5\u8bbe\u7f6e\u8fdbprovider\u4e2d\uff0c\u4f46\u662f\u5982\u679c\u5728build\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528authenticationProvider(provider)\n        // \u6846\u67b6\u4f1a\u63d0\u793aunsupported_grant_type\uff0c\u56e0\u4e3a\u5df2\u7ecf\u521d\u59cb\u5316\u5b8c\u4e86\uff0c\u5728\u6dfb\u52a0\u5c31\u4e0d\u4f1a\u751f\u6548\u4e86\n        provider.setTokenGenerator(tokenGenerator);\n        provider.setAuthorizationService(authorizationService);\n        provider.setAuthenticationManager(authenticationManager);\n\n        return build;\n    }\n\n    /**\n     * \u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe\n     *\n     * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n     * @return \u8fc7\u6ee4\u5668\u94fe\n     * @throws Exception \u629b\u51fa\n     */\n    @Bean\n    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {\n        // \u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668\n        http.addFilter(corsFilter());\n        // \u7981\u7528 csrf \u4e0e cors\n        http.csrf(AbstractHttpConfigurer::disable);\n        http.cors(AbstractHttpConfigurer::disable);\n        http.authorizeHttpRequests((authorize) -> authorize\n                        // \u653e\u884c\u9759\u6001\u8d44\u6e90\n                        .requestMatchers("/assets/**", "/webjars/**", "/login", "/getCaptcha", "/getSmsCaptcha").permitAll()\n                        .anyRequest().authenticated()\n                )\n                // \u6307\u5b9a\u767b\u5f55\u9875\u9762\n                .formLogin(formLogin ->\n                        formLogin.loginPage("/login")\n                                // \u767b\u5f55\u6210\u529f\u548c\u5931\u8d25\u6539\u4e3a\u5199\u56dejson\uff0c\u4e0d\u91cd\u5b9a\u5411\u4e86\n                                .successHandler(new LoginSuccessHandler())\n                                .failureHandler(new LoginFailureHandler())\n                );\n        // \u6dfb\u52a0BearerTokenAuthenticationFilter\uff0c\u5c06\u8ba4\u8bc1\u670d\u52a1\u5f53\u505a\u4e00\u4e2a\u8d44\u6e90\u670d\u52a1\uff0c\u89e3\u6790\u8bf7\u6c42\u5934\u4e2d\u7684token\n        http.oauth2ResourceServer((resourceServer) -> resourceServer\n                .jwt(Customizer.withDefaults())\n                .accessDeniedHandler(SecurityUtils::exceptionHandler)\n                .authenticationEntryPoint(SecurityUtils::exceptionHandler)\n        );\n        http\n                // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n                .exceptionHandling((exceptions) -> exceptions\n                        .defaultAuthenticationEntryPointFor(\n                                new LoginTargetAuthenticationEntryPoint("http://127.0.0.1:5173"),\n                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                        )\n                );\n\n        // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n        http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n        return http.build();\n    }\n\n    /**\n     * \u8de8\u57df\u8fc7\u6ee4\u5668\u914d\u7f6e\n     *\n     * @return CorsFilter\n     */\n    @Bean\n    public CorsFilter corsFilter() {\n\n        // \u521d\u59cb\u5316cors\u914d\u7f6e\u5bf9\u8c61\n        CorsConfiguration configuration = new CorsConfiguration();\n\n        // \u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u7684\u57df\u540d,\u5982\u679c\u5141\u8bb8\u643a\u5e26cookie\u7684\u8bdd,\u8def\u5f84\u5c31\u4e0d\u80fd\u5199*\u53f7, *\u8868\u793a\u6240\u6709\u7684\u57df\u540d\u90fd\u53ef\u4ee5\u8de8\u57df\u8bbf\u95ee\n        configuration.addAllowedOrigin("http://127.0.0.1:5173");\n        // \u8bbe\u7f6e\u8de8\u57df\u8bbf\u95ee\u53ef\u4ee5\u643a\u5e26cookie\n        configuration.setAllowCredentials(true);\n        // \u5141\u8bb8\u6240\u6709\u7684\u8bf7\u6c42\u65b9\u6cd5 ==> GET POST PUT Delete\n        configuration.addAllowedMethod("*");\n        // \u5141\u8bb8\u643a\u5e26\u4efb\u4f55\u5934\u4fe1\u606f\n        configuration.addAllowedHeader("*");\n\n        // \u521d\u59cb\u5316cors\u914d\u7f6e\u6e90\u5bf9\u8c61\n        UrlBasedCorsConfigurationSource configurationSource = new UrlBasedCorsConfigurationSource();\n\n        // \u7ed9\u914d\u7f6e\u6e90\u5bf9\u8c61\u8bbe\u7f6e\u8fc7\u6ee4\u7684\u53c2\u6570\n        // \u53c2\u6570\u4e00: \u8fc7\u6ee4\u7684\u8def\u5f84 == > \u6240\u6709\u7684\u8def\u5f84\u90fd\u8981\u6c42\u6821\u9a8c\u662f\u5426\u8de8\u57df\n        // \u53c2\u6570\u4e8c: \u914d\u7f6e\u7c7b\n        configurationSource.registerCorsConfiguration("/**", configuration);\n\n        // \u8fd4\u56de\u914d\u7f6e\u597d\u7684\u8fc7\u6ee4\u5668\n        return new CorsFilter(configurationSource);\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49jwt\uff0c\u5c06\u6743\u9650\u4fe1\u606f\u653e\u81f3jwt\u4e2d\n     *\n     * @return OAuth2TokenCustomizer\u7684\u5b9e\u4f8b\n     */\n    @Bean\n    public OAuth2TokenCustomizer<JwtEncodingContext> oAuth2TokenCustomizer() {\n        return context -> {\n            // \u68c0\u67e5\u767b\u5f55\u7528\u6237\u4fe1\u606f\u662f\u4e0d\u662fUserDetails\uff0c\u6392\u9664\u6389\u6ca1\u6709\u7528\u6237\u53c2\u4e0e\u7684\u6d41\u7a0b\n            if (context.getPrincipal().getPrincipal() instanceof UserDetails user) {\n                // \u83b7\u53d6\u7533\u8bf7\u7684scopes\n                Set<String> scopes = context.getAuthorizedScopes();\n                // \u83b7\u53d6\u7528\u6237\u7684\u6743\u9650\n                Collection<? extends GrantedAuthority> authorities = user.getAuthorities();\n                // \u63d0\u53d6\u6743\u9650\u5e76\u8f6c\u4e3a\u5b57\u7b26\u4e32\n                Set<String> authoritySet = Optional.ofNullable(authorities).orElse(Collections.emptyList()).stream()\n                        // \u83b7\u53d6\u6743\u9650\u5b57\u7b26\u4e32\n                        .map(GrantedAuthority::getAuthority)\n                        // \u53bb\u91cd\n                        .collect(Collectors.toSet());\n\n                // \u5408\u5e76scope\u4e0e\u7528\u6237\u4fe1\u606f\n                authoritySet.addAll(scopes);\n\n                JwtClaimsSet.Builder claims = context.getClaims();\n                // \u5c06\u6743\u9650\u4fe1\u606f\u653e\u5165jwt\u7684claims\u4e2d\uff08\u4e5f\u53ef\u4ee5\u751f\u6210\u4e00\u4e2a\u4ee5\u6307\u5b9a\u5b57\u7b26\u5206\u5272\u7684\u5b57\u7b26\u4e32\u653e\u5165\uff09\n                claims.claim(SecurityConstants.AUTHORITIES_KEY, authoritySet);\n                // \u653e\u5165\u5176\u5b83\u81ea\u5b9a\u5185\u5bb9\n                // \u89d2\u8272\u3001\u5934\u50cf...\n            }\n        };\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49jwt\u89e3\u6790\u5668\uff0c\u8bbe\u7f6e\u89e3\u6790\u51fa\u6765\u7684\u6743\u9650\u4fe1\u606f\u7684\u524d\u7f00\u4e0e\u5728jwt\u4e2d\u7684key\n     *\n     * @return jwt\u89e3\u6790\u5668 JwtAuthenticationConverter\n     */\n    @Bean\n    public JwtAuthenticationConverter jwtAuthenticationConverter() {\n        JwtGrantedAuthoritiesConverter grantedAuthoritiesConverter = new JwtGrantedAuthoritiesConverter();\n        // \u8bbe\u7f6e\u89e3\u6790\u6743\u9650\u4fe1\u606f\u7684\u524d\u7f00\uff0c\u8bbe\u7f6e\u4e3a\u7a7a\u662f\u53bb\u6389\u524d\u7f00\n        grantedAuthoritiesConverter.setAuthorityPrefix("");\n        // \u8bbe\u7f6e\u6743\u9650\u4fe1\u606f\u5728jwt claims\u4e2d\u7684key\n        grantedAuthoritiesConverter.setAuthoritiesClaimName(SecurityConstants.AUTHORITIES_KEY);\n\n        JwtAuthenticationConverter jwtAuthenticationConverter = new JwtAuthenticationConverter();\n        jwtAuthenticationConverter.setJwtGrantedAuthoritiesConverter(grantedAuthoritiesConverter);\n        return jwtAuthenticationConverter;\n    }\n\n\n    /**\n     * \u5c06AuthenticationManager\u6ce8\u5165ioc\u4e2d\uff0c\u5176\u5b83\u9700\u8981\u4f7f\u7528\u5730\u65b9\u53ef\u4ee5\u76f4\u63a5\u4eceioc\u4e2d\u83b7\u53d6\n     *\n     * @param authenticationConfiguration \u5bfc\u51fa\u8ba4\u8bc1\u914d\u7f6e\n     * @return AuthenticationManager \u8ba4\u8bc1\u7ba1\u7406\u5668\n     */\n    @Bean\n    @SneakyThrows\n    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) {\n        return authenticationConfiguration.getAuthenticationManager();\n    }\n\n    /**\n     * \u914d\u7f6e\u5bc6\u7801\u89e3\u6790\u5668\uff0c\u4f7f\u7528BCrypt\u7684\u65b9\u5f0f\u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u548c\u9a8c\u8bc1\n     *\n     * @return BCryptPasswordEncoder\n     */\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    /**\n     * \u914d\u7f6e\u5ba2\u6237\u7aefRepository\n     *\n     * @param jdbcTemplate    db \u6570\u636e\u6e90\u4fe1\u606f\n     * @param passwordEncoder \u5bc6\u7801\u89e3\u6790\u5668\n     * @return \u57fa\u4e8e\u6570\u636e\u5e93\u7684repository\n     */\n    @Bean\n    public RegisteredClientRepository registeredClientRepository(JdbcTemplate jdbcTemplate, PasswordEncoder passwordEncoder) {\n        RegisteredClient registeredClient = RegisteredClient.withId(UUID.randomUUID().toString())\n                // \u5ba2\u6237\u7aefid\n                .clientId("messaging-client")\n                // \u5ba2\u6237\u7aef\u79d8\u94a5\uff0c\u4f7f\u7528\u5bc6\u7801\u89e3\u6790\u5668\u52a0\u5bc6\n                .clientSecret(passwordEncoder.encode("123456"))\n                // \u5ba2\u6237\u7aef\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u57fa\u4e8e\u8bf7\u6c42\u5934\u7684\u8ba4\u8bc1\n                .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)\n                // \u914d\u7f6e\u8d44\u6e90\u670d\u52a1\u5668\u4f7f\u7528\u8be5\u5ba2\u6237\u7aef\u83b7\u53d6\u6388\u6743\u65f6\u652f\u6301\u7684\u65b9\u5f0f\n                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\n                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)\n                .authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)\n                // \u5ba2\u6237\u7aef\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8ba4\u8bc1\n                .authorizationGrantType(new AuthorizationGrantType(SecurityConstants.GRANT_TYPE_SMS_CODE))\n                // \u6388\u6743\u7801\u6a21\u5f0f\u56de\u8c03\u5730\u5740\uff0coauth2.1\u5df2\u6539\u4e3a\u7cbe\u51c6\u5339\u914d\uff0c\u4e0d\u80fd\u53ea\u8bbe\u7f6e\u57df\u540d\uff0c\u5e76\u4e14\u5c4f\u853d\u4e86localhost\uff0c\u672c\u673a\u4f7f\u7528127.0.0.1\u8bbf\u95ee\n                .redirectUri("http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc")\n                .redirectUri("https://www.baidu.com")\n                // \u8be5\u5ba2\u6237\u7aef\u7684\u6388\u6743\u8303\u56f4\uff0cOPENID\u4e0ePROFILE\u662fIdToken\u7684scope\uff0c\u83b7\u53d6\u6388\u6743\u65f6\u8bf7\u6c42OPENID\u7684scope\u65f6\u8ba4\u8bc1\u670d\u52a1\u4f1a\u8fd4\u56deIdToken\n                .scope(OidcScopes.OPENID)\n                .scope(OidcScopes.PROFILE)\n                // \u81ea\u5b9ascope\n                .scope("message.read")\n                .scope("message.write")\n                // \u5ba2\u6237\u7aef\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u7528\u6237\u9700\u8981\u786e\u8ba4\u6388\u6743\n                .clientSettings(ClientSettings.builder().requireAuthorizationConsent(true).build())\n                .build();\n\n        // \u57fa\u4e8edb\u5b58\u50a8\u5ba2\u6237\u7aef\uff0c\u8fd8\u6709\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u5b9e\u73b0 InMemoryRegisteredClientRepository\n        JdbcRegisteredClientRepository registeredClientRepository = new JdbcRegisteredClientRepository(jdbcTemplate);\n\n        // \u521d\u59cb\u5316\u5ba2\u6237\u7aef\n        RegisteredClient repositoryByClientId = registeredClientRepository.findByClientId(registeredClient.getClientId());\n        if (repositoryByClientId == null) {\n            registeredClientRepository.save(registeredClient);\n        }\n        // \u8bbe\u5907\u7801\u6388\u6743\u5ba2\u6237\u7aef\n        RegisteredClient deviceClient = RegisteredClient.withId(UUID.randomUUID().toString())\n                .clientId("device-message-client")\n                // \u516c\u5171\u5ba2\u6237\u7aef\n                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)\n                // \u8bbe\u5907\u7801\u6388\u6743\n                .authorizationGrantType(AuthorizationGrantType.DEVICE_CODE)\n                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)\n                // \u81ea\u5b9ascope\n                .scope("message.read")\n                .scope("message.write")\n                .build();\n        RegisteredClient byClientId = registeredClientRepository.findByClientId(deviceClient.getClientId());\n        if (byClientId == null) {\n            registeredClientRepository.save(deviceClient);\n        }\n\n        // PKCE\u5ba2\u6237\u7aef\n        RegisteredClient pkceClient = RegisteredClient.withId(UUID.randomUUID().toString())\n                .clientId("pkce-message-client")\n                // \u516c\u5171\u5ba2\u6237\u7aef\n                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)\n                // \u6388\u6743\u7801\u6a21\u5f0f\uff0c\u56e0\u4e3a\u662f\u6269\u5c55\u6388\u6743\u7801\u6d41\u7a0b\uff0c\u6240\u4ee5\u6d41\u7a0b\u8fd8\u662f\u6388\u6743\u7801\u7684\u6d41\u7a0b\uff0c\u6539\u53d8\u7684\u53ea\u662f\u53c2\u6570\n                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\n                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)\n                // \u6388\u6743\u7801\u6a21\u5f0f\u56de\u8c03\u5730\u5740\uff0coauth2.1\u5df2\u6539\u4e3a\u7cbe\u51c6\u5339\u914d\uff0c\u4e0d\u80fd\u53ea\u8bbe\u7f6e\u57df\u540d\uff0c\u5e76\u4e14\u5c4f\u853d\u4e86localhost\uff0c\u672c\u673a\u4f7f\u7528127.0.0.1\u8bbf\u95ee\n                .redirectUri("http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc")\n                .clientSettings(ClientSettings.builder().requireProofKey(Boolean.TRUE).build())\n                // \u81ea\u5b9ascope\n                .scope("message.read")\n                .scope("message.write")\n                .build();\n        RegisteredClient findPkceClient = registeredClientRepository.findByClientId(pkceClient.getClientId());\n        if (findPkceClient == null) {\n            registeredClientRepository.save(pkceClient);\n        }\n        return registeredClientRepository;\n    }\n\n    /**\n     * \u914d\u7f6e\u57fa\u4e8edb\u7684oauth2\u7684\u6388\u6743\u7ba1\u7406\u670d\u52a1\n     *\n     * @param jdbcTemplate               db\u6570\u636e\u6e90\u4fe1\u606f\n     * @param registeredClientRepository \u4e0a\u8fb9\u6ce8\u5165\u7684\u5ba2\u6237\u7aefrepository\n     * @return JdbcOAuth2AuthorizationService\n     */\n    @Bean\n    public OAuth2AuthorizationService authorizationService(JdbcTemplate jdbcTemplate, RegisteredClientRepository registeredClientRepository) {\n        // \u57fa\u4e8edb\u7684oauth2\u8ba4\u8bc1\u670d\u52a1\uff0c\u8fd8\u6709\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u670d\u52a1\u5b9e\u73b0InMemoryOAuth2AuthorizationService\n        return new JdbcOAuth2AuthorizationService(jdbcTemplate, registeredClientRepository);\n    }\n\n    /**\n     * \u914d\u7f6e\u57fa\u4e8edb\u7684\u6388\u6743\u786e\u8ba4\u7ba1\u7406\u670d\u52a1\n     *\n     * @param jdbcTemplate               db\u6570\u636e\u6e90\u4fe1\u606f\n     * @param registeredClientRepository \u5ba2\u6237\u7aefrepository\n     * @return JdbcOAuth2AuthorizationConsentService\n     */\n    @Bean\n    public OAuth2AuthorizationConsentService authorizationConsentService(JdbcTemplate jdbcTemplate, RegisteredClientRepository registeredClientRepository) {\n        // \u57fa\u4e8edb\u7684\u6388\u6743\u786e\u8ba4\u7ba1\u7406\u670d\u52a1\uff0c\u8fd8\u6709\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u670d\u52a1\u5b9e\u73b0InMemoryOAuth2AuthorizationConsentService\n        return new JdbcOAuth2AuthorizationConsentService(jdbcTemplate, registeredClientRepository);\n    }\n\n    /**\n     * \u914d\u7f6ejwk\u6e90\uff0c\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\uff0c\u516c\u5f00\u7528\u4e8e\u68c0\u7d22\u5339\u914d\u6307\u5b9a\u9009\u62e9\u5668\u7684JWK\u7684\u65b9\u6cd5\n     *\n     * @return JWKSource\n     */\n    @Bean\n    public JWKSource<SecurityContext> jwkSource() {\n        KeyPair keyPair = generateRsaKey();\n        RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();\n        RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();\n        RSAKey rsaKey = new RSAKey.Builder(publicKey)\n                .privateKey(privateKey)\n                .keyID(UUID.randomUUID().toString())\n                .build();\n        JWKSet jwkSet = new JWKSet(rsaKey);\n        return new ImmutableJWKSet<>(jwkSet);\n    }\n\n    /**\n     * \u751f\u6210rsa\u5bc6\u94a5\u5bf9\uff0c\u63d0\u4f9b\u7ed9jwk\n     *\n     * @return \u5bc6\u94a5\u5bf9\n     */\n    private static KeyPair generateRsaKey() {\n        KeyPair keyPair;\n        try {\n            KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");\n            keyPairGenerator.initialize(2048);\n            keyPair = keyPairGenerator.generateKeyPair();\n        } catch (Exception ex) {\n            throw new IllegalStateException(ex);\n        }\n        return keyPair;\n    }\n\n    /**\n     * \u914d\u7f6ejwt\u89e3\u6790\u5668\n     *\n     * @param jwkSource jwk\u6e90\n     * @return JwtDecoder\n     */\n    @Bean\n    public JwtDecoder jwtDecoder(JWKSource<SecurityContext> jwkSource) {\n        return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource);\n    }\n\n    /**\n     * \u6dfb\u52a0\u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u8bbe\u7f6ejwt\u7b7e\u53d1\u8005\u3001\u9ed8\u8ba4\u7aef\u70b9\u8bf7\u6c42\u5730\u5740\u7b49\n     *\n     * @return AuthorizationServerSettings\n     */\n    @Bean\n    public AuthorizationServerSettings authorizationServerSettings() {\n        return AuthorizationServerSettings.builder()\n                /*\n                    \u8bbe\u7f6etoken\u7b7e\u53d1\u5730\u5740(http(s)://{ip}:{port}/context-path, http(s)://domain.com/context-path)\n                    \u5982\u679c\u9700\u8981\u901a\u8fc7ip\u8bbf\u95ee\u8fd9\u91cc\u5c31\u662fip\uff0c\u5982\u679c\u662f\u6709\u57df\u540d\u6620\u5c04\u5c31\u586b\u57df\u540d\uff0c\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u8bbf\u95ee\u8be5\u670d\u52a1\u8fd9\u91cc\u5c31\u586b\u4ec0\u4e48\n                 */\n                .issuer("http://192.168.120.33:8080")\n                .build();\n    }\n\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"6-\u7f16\u5199\u767b\u5f55\u9875\u9762",children:"6. \u7f16\u5199\u767b\u5f55\u9875\u9762"}),"\n",(0,r.jsx)(n.p,{children:"\u524d\u7aef\u6709\u4ee5\u4e0b\u51e0\u70b9\u8981\u6c42"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.del,{children:"1. \u8bf7\u6c42\u767b\u5f55\u63a5\u53e3\u65f6\u9700\u8981\u9644\u52a0\u4e00\u4e2akey\u4e3anonce\u7684\u53c2\u6570\uff0c\u8bf7\u6c42\u5934\u6216\u8bf7\u6c42\u4f53\u4e2d\u90fd\u53ef\u4ee5"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u8bf7\u6c42\u767b\u5f55\u63a5\u53e3\u4e4b\u524d\u83b7\u53d6\u5f53\u524d\u5730\u5740\u680f\u4e2d\u7684noncenonceId\u53c2\u6570\uff0c\u5c06\u5176\u6dfb\u52a0\u81f3\u8bf7\u6c42\u5934\u6216\u8bf7\u6c42\u4f53\u4e2d\u3002"}),"\n",(0,r.jsxs)(n.li,{children:["\u8bf7\u6c42\u6210\u529f\u540e\u83b7\u53d6\u5f53\u524d\u9875\u9762\u5730\u5740\u680f\u4e2d\u7684target\u7684\u53c2\u6570\uff0c\u91cd\u5b9a\u5411\u5230\u8be5\u5730\u5740 \uff0c",(0,r.jsx)(n.del,{children:"\u5e76\u643a\u5e26\u521a\u624d\u767b\u5f55\u65f6\u643a\u5e26\u7684nonce\u53c2\u6570"})]}),"\n",(0,r.jsx)(n.li,{children:"\u767b\u5f55\u65f6\u533a\u5206\u5bc6\u7801\u6a21\u5f0f\u767b\u5f55\u4e0e\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55"}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2023-07-11\u4fee\u6539\u5185\u5bb9\uff1a\u5728\u8bf7\u6c42\u767b\u5f55\u63a5\u53e3\u65f6\u643a\u5e26\u7684",(0,r.jsx)(n.del,{children:"nonce"})," ",(0,r.jsx)(n.code,{children:"nonceId"}),"\u503c\u4ece\u524d\u7aef\u81ea\u5df1\u751f\u6210\u7684\u968f\u673a\u5b57\u7b26\u4e32\u6539\u4e3a\u540e\u7aef\u91cd\u5b9a\u5411\u8fc7\u6765\u65f6\u643a\u5e26\u7684",(0,r.jsx)(n.del,{children:"nonce"})," ",(0,r.jsx)(n.code,{children:"nonceId"}),"\u53c2\u6570"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["2023-07-21\u4fee\u6539\u5185\u5bb9\uff1aoauth\u534f\u8bae\u4e2d\u6709",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\uff0c\u4e3a\u9632\u6b62\u51b2\u7a81\uff0c",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\u6539\u4e3a",(0,r.jsx)(n.code,{children:"nonceId"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u65b0\u5efa\u4e00\u4e2avue\u9879\u76ee\uff0c\u5f15\u5165",(0,r.jsx)(n.code,{children:"axios"}),"\u548c",(0,r.jsx)(n.code,{children:"naive ui"}),"\uff0c\u8fd9\u91cc\u53ea\u7ed9\u51fa\u767b\u5f55\u9875\u9762\u7684\u4ee3\u7801\uff0c\u7a0d\u540e\u6211\u4f1a\u5c06\u524d\u7aef\u7684\u4ee3\u7801\u4e0a\u4f20\u81f3gitee"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5 vite\nnpm install -g create-vite\n\n# \u521b\u5efa\u9879\u76ee\u76ee\u5f55\nmkdir sas-frontend\ncd ./sas-frontend\n\n# \u521d\u59cb\u5316\u9879\u76ee\ncreate-vite ./ --template vue-ts\n\n# \u5b89\u88c5\u4f9d\u8d56 \u6d4b\u8bd5\u8fd0\u884c\nnpm install\nnpm run dev\n\n# \u5b89\u88c5\u4f9d\u8d56\nnpm config set registry http://registry.npm.taobao.com\nnpm install axios --registry=http://registry.npm.taobao.com\nnpm install --save-dev naive-ui unplugin-auto-import unplugin-vue-components\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-vue",children:'<script setup lang="ts">\nimport { ref } from \'vue\'\nimport HelloWorld from \'./components/HelloWorld.vue\'\nimport axios from \'axios\'\nimport { type CountdownProps, createDiscreteApi } from \'naive-ui\'\n\nconst { message } = createDiscreteApi([\'message\'])\n\n// \u5b9a\u4e49\u767b\u5f55\u63d0\u4ea4\u7684\u5bf9\u8c61\nconst loginModel = ref({\n  code: \'\',\n  username: \'\',\n  password: \'\',\n  loginType: \'\',\n  captchaId: \'\',\n  nonce: getQueryString(\'nonceId\')\n})\n\n// \u56fe\u5f62\u9a8c\u8bc1\u7801\u7684base64\u6570\u636e\nlet captchaImage = ref(\'\')\n// \u56fe\u5f62\u9a8c\u8bc1\u7801\u7684\u503c\nlet captchaCode = \'\'\n// \u662f\u5426\u5f00\u59cb\u5012\u8ba1\u65f6\nconst counterActive = ref(false)\n\n/**\n * \u83b7\u53d6\u56fe\u5f62\u9a8c\u8bc1\u7801\n */\nconst getCaptcha = () => {\n  axios({\n    method: \'GET\',\n    url: \'http://192.168.1.102:8080/getCaptcha\'\n  }).then((r) => {\n    let result = r.data\n    if (result.success) {\n      captchaCode = result.data.code\n      captchaImage.value = result.data.imageData\n      loginModel.value.captchaId = result.data.captchaId\n    } else {\n      message.warning(result.message)\n    }\n  })\n}\n\n/**\n * \u63d0\u4ea4\u767b\u5f55\u8868\u5355\n */\nconst submitLogin = () => {\n  loginModel.value.loginType = \'passwordLogin\'\n  axios({\n    method: \'post\',\n    url: \'http://192.168.1.102:8080/login\',\n    headers: {\n      nonceId: loginModel.value.nonce,\n      \'Content-Type\': \'application/x-www-form-urlencoded\'\n    },\n    data: loginModel.value\n  }).then((r) => {\n    let result = r.data\n    if (result.success) {\n      // message.info(`\u767b\u5f55\u6210\u529f`)\n      let target = getQueryString(\'target\')\n      if (target) {\n        window.location.href = target\n      }\n    } else {\n      message.warning(result.message)\n    }\n  })\n}\n\n/**\n * \u63d0\u4ea4\u77ed\u4fe1\u767b\u5f55\u8868\u5355\n */\nconst submitSmsLogin = () => {\n  loginModel.value.loginType = \'smsCaptcha\'\n  axios({\n    method: \'post\',\n    url: \'http://192.168.1.102:8080/login\',\n    headers: {\n      nonceId: loginModel.value.nonce,\n      \'Content-Type\': \'application/x-www-form-urlencoded\'\n    },\n    data: loginModel.value\n  }).then((r) => {\n    let result = r.data\n    if (result.success) {\n      message.info(`\u767b\u5f55\u6210\u529f`)\n      let target = getQueryString(\'target\')\n      if (target) {\n        window.location.href = target\n      }\n    } else {\n      message.warning(result.message)\n    }\n  })\n}\n\n/**\n * \u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\n */\nconst getSmsCaptcha = () => {\n  if (!loginModel.value.username) {\n    message.warning(\'\u8bf7\u5148\u8f93\u5165\u624b\u673a\u53f7.\')\n    return\n  }\n  if (!loginModel.value.code) {\n    message.warning(\'\u8bf7\u5148\u8f93\u5165\u9a8c\u8bc1\u7801.\')\n    return\n  }\n  if (loginModel.value.code !== captchaCode) {\n    message.warning(\'\u9a8c\u8bc1\u7801\u9519\u8bef.\')\n    return\n  }\n  axios({\n    method: \'get\',\n    url: `http://192.168.1.102:8080/getSmsCaptcha?phone=${loginModel.value.username}`\n  }).then((r) => {\n    let result = r.data\n    if (result.success) {\n      message.info(`\u83b7\u53d6\u77ed\u4fe1\u9a8c\u8bc1\u7801\u6210\u529f\uff0c\u56fa\u5b9a\u4e3a\uff1a${result.data}`)\n      counterActive.value = true\n    } else {\n      message.warning(result.message)\n    }\n  })\n}\n\n/**\n * \u5207\u6362\u65f6\u66f4\u65b0\u9a8c\u8bc1\u7801\n */\nconst handleUpdateValue = () => {\n  getCaptcha()\n}\n\n/**\n * \u5012\u8ba1\u65f6\u7ed3\u675f\n */\nconst onFinish = () => {\n  counterActive.value = false\n}\n\n/**\n * \u5012\u8ba1\u65f6\u663e\u793a\u5185\u5bb9\n */\nconst renderCountdown: CountdownProps[\'render\'] = ({ hours, minutes, seconds }) => {\n  return `${seconds}`\n}\n\n/**\n * \u83b7\u53d6\u5730\u5740\u680f\u53c2\u6570\n * @param name \u5730\u5740\u680f\u53c2\u6570\u7684key\n */\nfunction getQueryString(name: string) {\n  var reg = new RegExp(\'(^|&)\' + name + \'=([^&]*)(&|$)\', \'i\')\n\n  var r = window.location.search.substr(1).match(reg)\n\n  if (r != null) {\n    return unescape(r[2])\n  }\n\n  return null\n}\n\ngetCaptcha()\n<\/script>\n\n<template>\n  <header>\n    <img alt="Vue logo" class="logo" src="./assets/logo.svg" width="125" height="125" />\n\n    <div class="wrapper">\n      <HelloWorld msg="\u7edf\u4e00\u8ba4\u8bc1\u5e73\u53f0" />\n    </div>\n  </header>\n\n  <main>\n    <n-card title="">\n      <n-tabs\n        default-value="signin"\n        size="large"\n        justify-content="space-evenly"\n        @update:value="handleUpdateValue"\n      >\n        <n-tab-pane name="signin" tab="\u8d26\u53f7\u767b\u5f55">\n          <n-form>\n            <n-form-item-row label="\u7528\u6237\u540d">\n              <n-input v-model:value="loginModel.username" placeholder="\u624b\u673a\u53f7 / \u90ae\u7bb1" />\n            </n-form-item-row>\n            <n-form-item-row label="\u5bc6\u7801">\n              <n-input\n                v-model:value="loginModel.password"\n                type="password"\n                show-password-on="mousedown"\n                placeholder="\u5bc6\u7801"\n              />\n            </n-form-item-row>\n            <n-form-item-row label="\u9a8c\u8bc1\u7801">\n              <n-input-group>\n                <n-input v-model:value="loginModel.code" placeholder="\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801" />\n                <n-image\n                  @click="getCaptcha"\n                  width="130"\n                  height="34"\n                  :src="captchaImage"\n                  preview-disabled\n                />\n              </n-input-group>\n            </n-form-item-row>\n          </n-form>\n          <n-button type="info" @click="submitLogin" block strong> \u767b\u5f55 </n-button>\n        </n-tab-pane>\n        <n-tab-pane name="signup" tab="\u77ed\u4fe1\u767b\u5f55">\n          <n-form>\n            <n-form-item-row label="\u624b\u673a\u53f7">\n              <n-input v-model:value="loginModel.username" placeholder="\u624b\u673a\u53f7 / \u90ae\u7bb1" />\n            </n-form-item-row>\n            <n-form-item-row label="\u9a8c\u8bc1\u7801">\n              <n-input-group>\n                <n-input v-model:value="loginModel.code" placeholder="\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801" />\n                <n-image\n                  @click="getCaptcha"\n                  width="130"\n                  height="34"\n                  :src="captchaImage"\n                  preview-disabled\n                />\n              </n-input-group>\n            </n-form-item-row>\n            <n-form-item-row label="\u9a8c\u8bc1\u7801">\n              <n-input-group>\n                <n-input v-model:value="loginModel.password" placeholder="\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801" />\n                <n-button\n                  type="info"\n                  @click="getSmsCaptcha"\n                  style="width: 130px"\n                  :disabled="counterActive"\n                >\n                  \u83b7\u53d6\u9a8c\u8bc1\u7801\n                  <span v-if="counterActive">\n                    (\n                    <n-countdown\n                      :render="renderCountdown"\n                      :on-finish="onFinish"\n                      :duration="59 * 1000"\n                      :active="counterActive"\n                    />\n                    )</span\n                  >\n                </n-button>\n              </n-input-group>\n            </n-form-item-row>\n          </n-form>\n          <n-button type="info" @click="submitSmsLogin" block strong> \u767b\u5f55 </n-button>\n        </n-tab-pane>\n      </n-tabs>\n    </n-card>\n  </main>\n</template>\n\n<style scoped>\nheader {\n  line-height: 1.5;\n}\n\n.logo {\n  display: block;\n  margin: 0 auto 2rem;\n}\n\n@media (min-width: 1024px) {\n  header {\n    display: flex;\n    place-items: center;\n    padding-right: calc(var(--section-gap) / 2);\n  }\n\n  .logo {\n    margin: 0 2rem 0 0;\n  }\n\n  header .wrapper {\n    display: flex;\n    place-items: flex-start;\n    flex-wrap: wrap;\n  }\n}\n</style>\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u793a\u4f8b\u9879\u76ee\u53ea\u662f\u4e00\u4e2a\u5f88\u7b80\u964b\u7684\u9875\u9762\uff0c\u5927\u5bb6\u4f7f\u7528\u81ea\u5df1\u7684\u9875\u9762\u5373\u53ef(\u5982\u679c\u6709\u524d\u7aef\u5927\u4f6c\u6574\u4e2a\u6f02\u4eae\u7684\u767b\u5f55\u9875\u9762\u5c31\u597d\u4e86\uff0c\u6c42\u4e00\u4e2a\u6f02\u4eae\u7684\u767b\u5f55\u9875\u9762)"})}),"\n",(0,r.jsx)(n.p,{children:"\u5230\u6b64\u4e3a\u6b62\uff0c\u7f16\u7801\u90e8\u5206\u5c31\u7ed3\u675f\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u8be5\u6d4b\u8bd5\u4e86(\u8001\u4e09\u6837\u4e86\uff0c\u7406\u8bba\u3001\u7f16\u7801\u3001\u6d4b\u8bd5)"}),"\n",(0,r.jsx)(n.h2,{id:"\u56db\u6d4b\u8bd5",children:"\u56db\u3001\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u7ec4\u88c5url\u53d1\u8d77\u6388\u6743\u8bf7\u6c42",children:"1. \u7ec4\u88c5url\u53d1\u8d77\u6388\u6743\u8bf7\u6c42"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"http://192.168.1.102:8080/oauth2/authorize?client_id=messaging-client&response_type=code&scope=message.read&redirect_uri=http://127.0.0.1:8000/login/oauth2/code/messaging-client-oidc\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u68c0\u6d4b\u5230\u672a\u767b\u5f55\u91cd\u5b9a\u5411\u81f3vue\u9879\u76ee\u7684\u767b\u5f55\u9875\u9762",children:"2. \u68c0\u6d4b\u5230\u672a\u767b\u5f55\uff0c\u91cd\u5b9a\u5411\u81f3vue\u9879\u76ee\u7684\u767b\u5f55\u9875\u9762"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.del,{children:"\u91cd\u5b9a\u5411\u65f6\u5c06\u5f53\u524d\u8bf7\u6c42\u653e\u5165target\u53c2\u6570\u4e2d"})}),"\n",(0,r.jsxs)(n.p,{children:["\u91cd\u5b9a\u5411\u65f6\u5c06\u5f53\u524d\u8bf7\u6c42\u653e\u5165target\u53c2\u6570\u4e2d\uff0c\u5f53\u524d",(0,r.jsx)(n.code,{children:"sessionId"}),"\u653e\u5165",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\u4e2d"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(2554).A+"",width:"1920",height:"981"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770b\u4e00\u4e0bnetwork\uff0c\u8ba4\u8bc1\u670d\u52a1\u6309\u89c4\u5219\u643a\u5e26target\u4e0enonce\u53c2\u6570\u91cd\u5b9a\u5411\uff0c\u6ca1\u6709\u95ee\u9898"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(49003).A+"",width:"1920",height:"981"})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u63d0\u4ea4",children:"3. \u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u63d0\u4ea4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(96768).A+"",width:"1920",height:"985"})}),"\n",(0,r.jsx)(n.p,{children:"\u67e5\u770bnetwork"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(27497).A+"",width:"1920",height:"986"})}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0",(0,r.jsxs)(n.del,{children:["\u767b\u5f55\u6210\u529f\u540e\u4f1a\u91cd\u5b9a\u5411\u56de",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),"\u63a5\u53e3\u5e76\u643a\u5e26",(0,r.jsx)(n.code,{children:"nonce"}),"\u53c2\u6570\uff0c",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),"\u6839\u636e",(0,r.jsx)(n.code,{children:"nonce"}),"\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\u540e\u4f1a\u751f\u6210\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"code"}),"\uff0c\u7136\u540e\u643a\u5e26",(0,r.jsx)(n.code,{children:"code"}),"\u8df3\u8f6c\u81f3\u56de\u8c03\u5730\u5740\u3002"]})]}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0\u4e0d\u9700\u8981\u643a\u5e26\u4efb\u4f55\u53c2\u6570\uff0c\u56e0\u4e3a\u5728\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u4e4b\u524d\u5df2\u7ecf\u83b7\u53d6\u5230",(0,r.jsx)(n.code,{children:"sessionId"}),"\uff0c\u5e76\u6839\u636e",(0,r.jsx)(n.code,{children:"sessionId"}),"\u5b58\u50a8\u767b\u5f55\u65f6\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u6240\u4ee5\u91cd\u5b9a\u5411\u56de",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),"\u63a5\u53e3\u65f6\u80fd\u591f\u6839\u636e",(0,r.jsx)(n.code,{children:"sessionId"}),"\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\u3002\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\u540e\u68c0\u6d4b\u5230\u672a\u6388\u6743\u786e\u8ba4\uff0c\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"4-\u6388\u6743\u786e\u8ba4\u63d0\u4ea4",children:"4. \u6388\u6743\u786e\u8ba4\u63d0\u4ea4"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(87782).A+"",width:"1919",height:"982"})}),"\n",(0,r.jsxs)(n.p,{children:["\u6388\u6743\u786e\u8ba4\u540e\u751f\u6210code\u5e76\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u56de\u8c03\u5730\u5740(",(0,r.jsx)(n.code,{children:"redirect_uri"}),")"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"img",src:t(87255).A+"",width:"1920",height:"183"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4e94\u5199\u5728\u6700\u540e",children:"\u4e94\u3001\u5199\u5728\u6700\u540e"}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0",(0,r.jsxs)(n.del,{children:["\u5728\u8e29\u4e86\u4e0d\u77e5\u9053\u591a\u5c11\u5751\u4ee5\u540e\u7ec8\u4e8e\u7b97\u662f\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u4e1c\u897f\uff0c\u4f46\u662f\u76ee\u524d\u53ea\u652f\u6301\u4e0d\u9700\u8981\u6388\u6743\u786e\u8ba4\u7684\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u9700\u8981\u6388\u6743\u786e\u8ba4\u90a3\u4e48\u5c31\u4f1a\u5728\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762\u65f6\u56e0\u4e3a\u83b7\u53d6\u4e0d\u5230\u767b\u5f55\u4fe1\u606f\u800c\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762\uff0c\u8fd9\u91cc\u4e5f\u6bd4\u8f83\u5751\uff0c\u6ca1\u6709\u80fd\u591f\u66f4\u6539\u6388\u6743\u786e\u8ba4\u8bf7\u6c42\u7684\u5730\u65b9\uff0c\u53ea\u80fd\u53e6\u8f9f\u8e4a\u5f84\u4fee\u6539\u73b0\u5728\u7684",(0,r.jsx)(n.code,{children:"RedisSecurityContextRepository"}),"\u4ece\u800c\u4f7f\u6388\u6743\u786e\u8ba4\u8bf7\u6c42\u4e5f\u80fd\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\uff0c\u5c31\u662f\u5728\u83b7\u53d6\u8ba4\u8bc1\u4fe1\u606f\u540e\u5b58\u5165",(0,r.jsx)(n.code,{children:"session"}),"\u4e2d\u4e00\u4efd\uff0c\u56e0\u4e3a\u4ece",(0,r.jsx)(n.code,{children:"/oauth2/authorize"}),"\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762\u662f\u540c\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"session"}),"\uff0c\u6240\u4ee5\u5b58\u5165",(0,r.jsx)(n.code,{children:"session"}),"\u540e\u5c31\u53ef\u4ee5\u83b7\u53d6\u4e86\uff0c\u4f46\u662f\u6211\u89c9\u5f97\u65e2\u7136\u90fd\u5df2\u7ecf\u524d\u540e\u7aef\u5206\u79bb\u4e86\uff0c\u4e5f\u5c31\u6ca1\u5fc5\u8981\u5728\u52a0\u6388\u6743\u786e\u8ba4\u4e86\uff1b\u5f53\u7136\u4e5f\u4e0d\u6392\u9664\u6709\u9700\u8981\u8fd9\u4e1c\u897f\u7684\u4eba\uff0c\u540e\u671f\u770b\u770b\u6709\u6ca1\u6709\u9700\u8981\u7684\uff0c\u5982\u679c\u6709\u9700\u8981\u7684\u6211\u4f1a\u5199\u4e00\u4e0b\u6269\u5c55\u7bc7\u3002"]})]}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u73b0\u5728\u6539\u4e3a\u901a\u8fc7",(0,r.jsx)(n.code,{children:"sessionId"}),"\u4e32\u8054\u8ba4\u8bc1\u670d\u52a1\u4e0e\u5355\u72ec\u90e8\u7f72\u7684\u767b\u5f55\u9875\u9762\u7684\u8bf7\u6c42\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u51fa\u73b0\u53ea\u80fd\u83b7\u53d6\u4e00\u6b21\u8ba4\u8bc1\u4fe1\u606f\u7684\u95ee\u9898\u4e86\uff0c\u53ea\u8981\u5728\u540c\u4e00\u4e2a\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee\u8ba4\u8bc1\u670d\u52a1\uff0c\u90a3\u4e48\u4f7f\u7528\u7684",(0,r.jsx)(n.code,{children:"session"}),"\u5c31\u53ea\u4f1a\u662f\u540c\u4e00\u4e2a\uff0c\u5f53\u4ece\u5176\u5b83\u7cfb\u7edf\u8df3\u8f6c\u81f3\u8ba4\u8bc1\u670d\u52a1\u65f6\u53ea\u8981\u767b\u5f55\u8fc7\u5c31\u4e0d\u9700\u8981\u5728\u767b\u5f55\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u6839\u636e\u6d4f\u89c8\u5668\u4e0e\u8ba4\u8bc1\u670d\u52a1\u4e4b\u95f4\u4ea7\u751f\u7684",(0,r.jsx)(n.code,{children:"session"}),"\u7684id\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u8ba4\u8bc1\u4fe1\u606f\uff0c\u8ba4\u8bc1\u4fe1\u606f\u7684\u5b58\u6d3b\u65f6\u95f4\u5c31\u662f\u5728redis\u4e2d\u8bbe\u7f6e\u7684key\u7684\u5b58\u6d3b\u65f6\u95f4\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u867d\u7136\u73b0\u5728\u4e5f\u662f\u9760",(0,r.jsx)(n.code,{children:"session"}),"\u5173\u8054\uff0c\u4f46\u73b0\u5728\u5c06\u539f\u5148\u5b58\u50a8\u5728",(0,r.jsx)(n.code,{children:"session"}),"\u4e2d\u7684\u8ba4\u8bc1\u4fe1\u606f\u5b58\u50a8\u5230\u4e86redis\u4e2d\uff0c\u7f29\u5c0f\u4e86\u670d\u52a1\u5668\u5b58\u50a8",(0,r.jsx)(n.code,{children:"session"}),"\u6240\u9700\u7684\u7a7a\u95f4\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7",(0,r.jsx)(n.code,{children:"sessionId"}),"\u5c06\u5176\u5173\u8054\u8d77\u6765\uff0c\u89e3\u51b3\u4e86\u8ba4\u8bc1\u670d\u52a1\u4e0e\u767b\u5f55\u9875\u9762\u4e0d\u5728\u540c\u4e00\u57df\u4ece\u800c\u56e0\u4e3a",(0,r.jsx)(n.code,{children:"session"}),"\u7684\u4e0d\u540c\u800c\u83b7\u53d6\u4e0d\u5230\u8ba4\u8bc1\u4fe1\u606f\u7684\u95ee\u9898\u3002\u8fd9\u4e5f\u7b26\u5408sso\u7684\u7279\u70b9\uff0c\u5176\u5b83\u57df\u540d\u4e0b\u7684\u670d\u52a1\u9700\u8981\u8ba4\u8bc1\u65f6\u9700\u8981\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762\u767b\u5f55\uff0c\u767b\u5f55\u540e\u53e6\u5916\u7684\u670d\u52a1\u518d\u6b21\u8bf7\u6c42\u8ba4\u8bc1\u670d\u52a1\u8ba4\u8bc1\u65f6\u5c31\u4e0d\u9700\u8981\u8ba4\u8bc1\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u83b7\u53d6\u5230\u8ba4\u8bc1\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\u672c\u6765\u60f3\u5199\u70b9\u57fa\u7840\u7684\u4e1c\u897f\uff0c\u4f46\u662f\u5144\u5f1f\u4eec\u592a\u76f8\u4fe1\u6211\u4e86\uff0c\u51c0\u6574\u4e9b\u9ad8\u7aef\u64cd\u4f5c\uff0c\u5509 (\u256f\xb0\u0414\xb0)\u256f\ufe35 \u253b\u2501\u253b"}),"\n",(0,r.jsx)(n.p,{children:"\u8981\u662f\u6709\u95ee\u9898\u8bf7\u5728\u8bc4\u8bba\u533a\u63d0\u51fa\uff0c\u4ee5\u9632\u8bef\u4eba\u5b50\u5f1f"}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee3\u7801\u5df2\u63d0\u4ea4\u81f3Gitee\u7684",(0,r.jsx)(n.code,{children:"\u6388\u6743\u7801\u6a21\u5f0f\u524d\u540e\u7aef\u5206\u79bb\u7684\u767b\u5f55\u9875\u9762"}),"\u5206\u652f\uff0c\u5982\u679c\u6709\u9057\u6f0f\u5185\u5bb9\u5927\u5bb6\u4e5f\u53ef\u4ee5\u62c9\u53d6\u4e00\u4e0b\u5b8c\u6574\u4ee3\u7801\u770b\u770b\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://gitee.com/vains-Sofia/authorization-example/tree/%E6%8E%88%E6%9D%83%E7%A0%81%E6%A8%A1%E5%BC%8F%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E7%9A%84%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2/",children:"\u4ed3\u5e93\u5730\u5740"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},32338:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-1-4aebd7521e20b2dbb7b1c49937273d1e.awebp"},56116:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-10-f4784770753a6fe834798295d7e5c95f.awebp"},33069:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-11-fb59640cc3f05dbf6a41441052f2e221.awebp"},2554:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-12-a7ca56995740e1826227d5fbe4058c2d.awebp"},49003:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-13-6b5b6a61c83c79eb1f64bd409d853d2a.awebp"},96768:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-14-da0c8fa42194ab9636a425a73cd756b2.awebp"},27497:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-15-6cd252828fd7045087b1be4f44f7ab88.awebp"},87782:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-16-19b964ea148606db61680db88d1bd137.awebp"},87255:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-17-4b919bae52a3121ce9d3f68d8efb7623.awebp"},35781:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-2-80a6b8526915d22d57fd7cf59292e3e8.awebp"},55148:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-3-80118904c86cb72301a836629caf0f14.awebp"},37359:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-4-2153d20709aeaa8392926bac50eadc2d.awebp"},61438:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-5-b49072259a2d6ab774cec623d820d7b8.awebp"},31457:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-6-a4322cdaf0dd190bfe83a2e0e71e3dc2.awebp"},33144:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-7-26c224b8cb63e84980282c20a832d4cb.awebp"},73835:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-8-4b2ee3d0fdeb24faeed0e64be6a72947.awebp"},5850:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/12-9-6436dc8f6613cabc68c3271eeb40f316.awebp"},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var r=t(96540);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);