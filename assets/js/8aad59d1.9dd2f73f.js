"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[1341],{71336:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var a=t(85893),s=t(11151);const i={},r=void 0,c={id:"zh-cn/spring-security/oauth2/LDAP-Login",title:"LDAP-Login",description:"\u4e00\u3001\u73af\u5883\u51c6\u5907",source:"@site/docs/zh-cn/spring-security/oauth2/3-LDAP-Login.md",sourceDirName:"zh-cn/spring-security/oauth2",slug:"/zh-cn/spring-security/oauth2/LDAP-Login",permalink:"/light-docusaurus/docs/zh-cn/spring-security/oauth2/LDAP-Login",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-security/oauth2/3-LDAP-Login.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{},sidebar:"troch",previous:{title:"Add-Customeized-Grant-Type",permalink:"/light-docusaurus/docs/zh-cn/spring-security/oauth2/Add-Customeized-Grant-Type"},next:{title:"SAML(ADFS)-Login",permalink:"/light-docusaurus/docs/zh-cn/spring-security/oauth2/SAML(ADFS)-Login"}},o={},l=[{value:"\u4e00\u3001\u73af\u5883\u51c6\u5907",id:"\u4e00\u73af\u5883\u51c6\u5907",level:2},{value:"1.1 OpenLDAP",id:"11-openldap",level:3},{value:"1.2 Apache Directory Server",id:"12-apache-directory-server",level:3},{value:"1.3 Apache Directory Studio",id:"13-apache-directory-studio",level:3},{value:"1. \u4e0b\u8f7d\u5ba2\u6237\u7aef Studio Client",id:"1-\u4e0b\u8f7d\u5ba2\u6237\u7aef-studio-client",level:4},{value:"2. \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 <code>ApacheDirectoryStudio.ini</code> \uff08\u5ba2\u6237\u7aef\u8fd0\u884c\u9700\u8981 Jdk11 \u4ee5\u4e0a\uff09",id:"2-\u4fee\u6539\u914d\u7f6e\u6587\u4ef6-apachedirectorystudioini-\u5ba2\u6237\u7aef\u8fd0\u884c\u9700\u8981-jdk11-\u4ee5\u4e0a",level:4},{value:"3. \u8fd0\u884c\u7a0b\u5e8f\uff0c\u65b0\u5efaLDAP\u8fde\u63a5",id:"3-\u8fd0\u884c\u7a0b\u5e8f\u65b0\u5efaldap\u8fde\u63a5",level:4},{value:"4. \u521b\u5efa\u81ea\u5df1\u7684Partition",id:"4-\u521b\u5efa\u81ea\u5df1\u7684partition",level:4},{value:"5. \u65b0\u589e\u5c5e\u6027",id:"5-\u65b0\u589e\u5c5e\u6027",level:4},{value:"6. \u65b0\u589e\u7528\u6237",id:"6-\u65b0\u589e\u7528\u6237",level:4},{value:"\u4e8c\u3001\u642d\u5efa\u670d\u52a1",id:"\u4e8c\u642d\u5efa\u670d\u52a1",level:2},{value:"2.1 \u914d\u7f6e",id:"21-\u914d\u7f6e",level:3},{value:"2.2 \u914d\u7f6e\u7c7b",id:"22-\u914d\u7f6e\u7c7b",level:3},{value:"2.3 \u4e1a\u52a1\u7c7b",id:"23-\u4e1a\u52a1\u7c7b",level:3},{value:"\u4e09\u3001\u6d4b\u8bd5\u6548\u679c",id:"\u4e09\u6d4b\u8bd5\u6548\u679c",level:2},{value:"\u56db\u3001\u96c6\u6210OAuth2",id:"\u56db\u96c6\u6210oauth2",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.ah)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"\u4e00\u73af\u5883\u51c6\u5907",children:"\u4e00\u3001\u73af\u5883\u51c6\u5907"}),"\n",(0,a.jsx)(n.h3,{id:"11-openldap",children:"1.1 OpenLDAP"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://www.openldap.org/",children:"OpenLDAP"})," ",(0,a.jsx)(n.a,{href:"https://github.com/openldap/openldap",children:"Github"})]}),"\n",(0,a.jsxs)(n.li,{children:["bitnami OpenLDAP ",(0,a.jsx)(n.a,{href:"https://hub.docker.com/r/bitnami/openldap",children:"Docker"})," ",(0,a.jsx)(n.a,{href:"https://github.com/bitnami/containers",children:"Github"})]}),"\n",(0,a.jsxs)(n.li,{children:["osixia OpenLDAP ",(0,a.jsx)(n.a,{href:"https://hub.docker.com/r/osixia/openldap",children:"Docker"})," ",(0,a.jsx)(n.a,{href:"https://github.com/osixia/docker-openldap",children:"Github"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"docker run --detach \\\n  --publish 1389:1389 \\\n  --publish 1636:1636 \\\n  --env LDAP_ADMIN_USERNAME=admin \\\n  --env LDAP_ADMIN_PASSWORD=admin \\\n  --env LDAP_USERS=light \\\n  --env LDAP_PASSWORDS=light \\\n  --env LDAP_ROOT=dc=light,dc=org \\\n  --env LDAP_ADMIN_DN=cn=admin,dc=light,dc=org \\\n  --network dev \\\n  --restart=no \\\n  --name openldap \\\n  bitnami/openldap:latest\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Account","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"user: cn=light,ou=users,dc=light,dc=org  password: light"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"12-apache-directory-server",children:"1.2 Apache Directory Server"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"https://directory.apache.org/",children:"ApacheDS"})," ",(0,a.jsx)(n.a,{href:"https://directory.apache.org/apacheds/",children:"Download"})," ",(0,a.jsx)(n.a,{href:"https://directory.apache.org/studio",children:"Studio Client"})]}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/apache/directory-server",children:"Apache Directory Server"})}),"\n",(0,a.jsxs)(n.li,{children:["itzg ApacheDS ",(0,a.jsx)(n.a,{href:"https://hub.docker.com/r/itzg/apacheds",children:" Docker"})]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"docker run --detach \\\n  --publish 10389:10389 \\\n  --network dev \\\n  --restart=no \\\n  --name apache-ds \\\n  itzg/apacheds:latest\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Account","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"user: uid=admin,ou=system  password secret"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"13-apache-directory-studio",children:"1.3 Apache Directory Studio"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://directory.apache.org/studio",children:"Studio Client"})}),"\n"]}),"\n",(0,a.jsxs)(n.h4,{id:"1-\u4e0b\u8f7d\u5ba2\u6237\u7aef-studio-client",children:["1. \u4e0b\u8f7d\u5ba2\u6237\u7aef ",(0,a.jsx)(n.a,{href:"https://directory.apache.org/studio",children:"Studio Client"})]}),"\n",(0,a.jsxs)(n.h4,{id:"2-\u4fee\u6539\u914d\u7f6e\u6587\u4ef6-apachedirectorystudioini-\u5ba2\u6237\u7aef\u8fd0\u884c\u9700\u8981-jdk11-\u4ee5\u4e0a",children:["2. \u4fee\u6539\u914d\u7f6e\u6587\u4ef6 ",(0,a.jsx)(n.code,{children:"ApacheDirectoryStudio.ini"})," \uff08\u5ba2\u6237\u7aef\u8fd0\u884c\u9700\u8981 Jdk11 \u4ee5\u4e0a\uff09"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",children:"-startup\nplugins/org.eclipse.equinox.launcher_1.6.0.v20200915-1508.jar\n--launcher.library\nplugins/org.eclipse.equinox.launcher.win32.win32.x86_64_1.2.0.v20200915-1442\n/studio-rcp/resources/icons/linux/studio.xpm\n###\n#Uncomment_to_configure_the_language\n#https://directory.apache.org/studio/faqs.html#how-to-set-the-language-of-studio\n#-nl\n#en\n###\n#Uncomment_to_configure_Java_version_to_use\n#https://directory.apache.org/studio/faqs.html#how-to-set-the-java-vm-to-use\n#-vm\n#/usr/lib/jvm/java-11-openjdk/bin/java\n-vmargs\n-Dosgi.requiredJavaVersion=11\n###\n#Uncomment_to_configure_heap_memory\n#https://directory.apache.org/studio/faqs.html#how-to-increase-the-heap-memory\n#-Xms1g\n#-Xmx2g\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6dfb\u52a0\u4e24\u884c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",children:"-vm\nD:/Develop/jdk/jdk-17/bin/java\n"})}),"\n",(0,a.jsx)(n.h4,{id:"3-\u8fd0\u884c\u7a0b\u5e8f\u65b0\u5efaldap\u8fde\u63a5",children:"3. \u8fd0\u884c\u7a0b\u5e8f\uff0c\u65b0\u5efaLDAP\u8fde\u63a5"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img",src:t(2668).Z+"",width:"1921",height:"916"})}),"\n",(0,a.jsxs)(n.p,{children:["\u8f93\u5165ldap\u5730\u5740\u7aef\u53e3\uff0c\u8f93\u5165\u5b8c\u6210\u6821\u9a8cip\u7aef\u53e3\u662f\u5426\u53ef\u7528\n",(0,a.jsx)(n.img,{alt:"img",src:t(60202).Z+"",width:"650",height:"761"})]}),"\n",(0,a.jsx)(n.p,{children:"\u70b9\u51fb\u4e0b\u4e00\u6b65\uff0c\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u5e76\u6821\u9a8c"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"OpenLDAP: cn=light,ou=users,dc=light,dc=org / light"}),"\n",(0,a.jsx)(n.li,{children:"ApacheDS: uid=admin,ou=system / secret"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"img",src:t(50887).Z+"",width:"650",height:"761"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5207\u6362\u8ba4\u8bc1\u6a21\u5f0f\u91cd\u8bd5\uff0c\u6309\u4e0a\u9762\u7684\u811a\u672c\uff0c\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"No Authentication"})," \u5373\u53ef\n",(0,a.jsx)(n.img,{alt:"img",src:t(92469).Z+"",width:"650",height:"761"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u70b9\u51fb\u5b8c\u6210\uff0c\u8fde\u63a5\u6210\u529f\u540e\u5373\u53ef\u5728\u5de6\u4fa7\u770b\u5230\u5bf9\u5e94\u7684\u8fde\u63a5\u548cldap\u4fe1\u606f\n",(0,a.jsx)(n.img,{alt:"img",src:t(23118).Z+"",width:"605",height:"1001"})]}),"\n",(0,a.jsx)(n.h4,{id:"4-\u521b\u5efa\u81ea\u5df1\u7684partition",children:"4. \u521b\u5efa\u81ea\u5df1\u7684Partition"}),"\n",(0,a.jsxs)(n.p,{children:["Partition\u5c31\u597d\u6bd4\u4e00\u4e2a\u5b8c\u6574\u7684\u5206\u533a\u5217\u8868\uff0c\u5728ApacheDS\u4e2d\uff0c\u6709\u4e00\u4e2a\u9ed8\u8ba4\u7684partition\u662f ",(0,a.jsx)(n.code,{children:"dc=example,dc=com"}),"\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2aPartition\n",(0,a.jsx)(n.img,{alt:"img",src:t(89624).Z+"",width:"1325",height:"947"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728Partitions General Detail \u9875\u9762\u4e2d\uff0c\u586b\u5165\u4f60\u81ea\u5df1\u7684Partition ID\u548cSuffix\u5373\u53ef\u4fdd\u5b58\u914d\u7f6e\n",(0,a.jsx)(n.img,{alt:"img",src:t(98634).Z+"",width:"1565",height:"861"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"})," \u65b0\u5efaPartition\u540e\u9700\u8981\u91cd\u542f ApacheDS \u624d\u80fd\u6b63\u5e38\u8bfb\u53d6\u5230"]}),"\n",(0,a.jsx)(n.h4,{id:"5-\u65b0\u589e\u5c5e\u6027",children:"5. \u65b0\u589e\u5c5e\u6027"}),"\n",(0,a.jsxs)(n.p,{children:["Ldap\u81ea\u5e26\u4e00\u4e9bobjectClass\uff0c\u8fd9\u4e9bobjectClass\u5305\u542b\u5e38\u7528\u7684\u5c5e\u6027\u3002\u4f46\u5728\u4e00\u822c\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\uff0c\u9700\u8981\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u5c5e\u6027\uff0c\u6bd4\u5982\u7528\u6237\u7684roleId\u548cgroupId\u8fd9\u4e24\u4e2a\u5c5e\u6027\n\u9996\u5148\u6253\u5f00Schema Editor\u89c6\u56fe\n",(0,a.jsx)(n.img,{alt:"img",src:t(97509).Z+"",width:"1217",height:"988"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u65b0\u589eSchema\u9879\u76ee\uff0c\u9009\u62e9\u79bb\u7ebf/\u5728\u7ebf\u5e76\u63d0\u4f9b\u9879\u76ee\u540d\u79f0\uff0cNext \u5e76\u5168\u9009\u6240\u6709\u7c7b\u578b\n",(0,a.jsx)(n.img,{alt:"img",src:t(76358).Z+"",width:"1929",height:"1039"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u6253\u5f00\u8fde\u63a5\uff0c\u521b\u5efa\u5177\u6709\u552f\u4e00\u540d\u79f0\u7684\u65b0Schema\n",(0,a.jsx)(n.img,{alt:"img",src:t(38995).Z+"",width:"1929",height:"1039"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728Schema\u4e0b\u53ef\u4ee5\u4e3a\u8fd9\u4e9b\u5c5e\u6027\u521b\u5efa\u65b0\u7684\u5c5e\u6027\n",(0,a.jsx)(n.img,{alt:"img",src:t(61447).Z+"",width:"1929",height:"1039"}),"\n",(0,a.jsx)(n.img,{alt:"img",src:t(3995).Z+"",width:"650",height:"645"}),"\n",(0,a.jsx)(n.img,{alt:"img",src:t(50392).Z+"",width:"650",height:"645"})]}),"\n",(0,a.jsx)(n.p,{children:"\u5728Schema\u4e0b\u53ef\u4ee5\u4e3a\u8fd9\u4e9b\u5c5e\u6027\u521b\u5efa\u65b0\u7684\u5bf9\u8c61"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.img,{alt:"img",src:t(83737).Z+"",width:"612",height:"495"}),"\n",(0,a.jsx)(n.img,{alt:"img",src:t(24176).Z+"",width:"612",height:"495"}),"\n",(0,a.jsx)(n.img,{alt:"img",src:t(86570).Z+"",width:"612",height:"495"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u5b8c\u6210\u6240\u6709\u64cd\u4f5c\u540e\uff0c\u53ef\u4ee5\u5bfc\u51fa\u4e3a.ldif \u6587\u4ef6\n",(0,a.jsx)(n.img,{alt:"img",src:t(30114).Z+"",width:"948",height:"834"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ldif",children:'# Generated by Apache Directory Studio on 2023\u5e7412\u670828\u65e5 \u4e0b\u53485:02:28\n\n# SCHEMA "LIGHT"\ndn: cn=light, ou=schema\nobjectclass: metaSchema\nobjectclass: top\ncn: light\n\ndn: ou=attributetypes, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: attributetypes\n\ndn: m-oid=1.2.3.4.5.6.11, ou=attributetypes, cn=light, ou=schema\nobjectclass: metaAttributeType\nobjectclass: metaTop\nobjectclass: top\nm-oid: 1.2.3.4.5.6.11\nm-name: groupId\nm-description:: 57uEaWQ=\nm-equality: bigIntegerMatch\nm-ordering: bigIntegerMatch\nm-substr: bigIntegerMatch\nm-syntax: 1.3.6.1.4.1.18060.0.4.1.0.3\nm-length: 20\n\ndn: m-oid=1.2.3.4.5.6.12, ou=attributetypes, cn=light, ou=schema\nobjectclass: metaAttributeType\nobjectclass: metaTop\nobjectclass: top\nm-oid: 1.2.3.4.5.6.12\nm-name: roleId\nm-description:: 6KeS6ImyaWQ=\nm-equality: bigIntegerMatch\nm-ordering: bigIntegerMatch\nm-substr: bigIntegerMatch\nm-syntax: 1.3.6.1.4.1.18060.0.4.1.0.3\nm-length: 20\n\ndn: ou=comparators, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: comparators\n\ndn: ou=ditcontentrules, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: ditcontentrules\n\ndn: ou=ditstructurerules, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: ditstructurerules\n\ndn: ou=matchingrules, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: matchingrules\n\ndn: ou=matchingruleuse, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: matchingruleuse\n\ndn: ou=nameforms, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: nameforms\n\ndn: ou=normalizers, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: normalizers\n\ndn: ou=objectclasses, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: objectClasses\n\ndn: m-oid=1.2.3.4.5.6.10, ou=objectclasses, cn=light, ou=schema\nobjectclass: metaObjectClass\nobjectclass: metaTop\nobjectclass: top\nm-oid: 1.2.3.4.5.6.10\nm-name: authority\nm-description:: 5p2D6ZmQ\nm-typeObjectClass: AUXILIARY\nm-must: groupId\nm-must: roleId\n\ndn: ou=syntaxcheckers, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: syntaxcheckers\n\ndn: ou=syntaxes, cn=light, ou=schema\nobjectclass: organizationalUnit\nobjectclass: top\nou: syntaxes\n\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u73b0\u5728\u8f6c\u5230\xa0LDAP\u6d4f\u89c8\u5668\u900f\u89c6\u56fe(Windows -> Open Perspective -> LDAP)\uff0c\u53f3\u952e\u70b9\u51fb\xa0",(0,a.jsx)(n.code,{children:"ou = schema"}),"\xa0\u5bf9\u8c61\uff0c\u7136\u540e\u70b9\u51fb\u5bfc\u5165LDIF\uff0c\u5bfc\u5165\u4e0a\u9762\u7684LDIF\u6587\u4ef6\n",(0,a.jsx)(n.img,{alt:"img",src:t(8384).Z+"",width:"958",height:"890"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u6210\u529f\u5b8c\u6210\u5e76\u5237\u65b0ou = schema\u5bf9\u8c61\uff0c\u60a8\u53ef\u4ee5\u770b\u5230\u6dfb\u52a0\u7684\u5bf9\u8c61\n",(0,a.jsx)(n.img,{alt:"img",src:t(70871).Z+"",width:"1120",height:"794"})]}),"\n",(0,a.jsx)(n.h4,{id:"6-\u65b0\u589e\u7528\u6237",children:"6. \u65b0\u589e\u7528\u6237"}),"\n",(0,a.jsxs)(n.p,{children:["\u65b0\u589e\u7528\u6237\uff0c\u6211\u4eec\u90fd\u901a\u8fc7ldif\u5bfc\u5165\u7684\u65b9\u5f0f\n",(0,a.jsx)(n.img,{alt:"img",src:t(23386).Z+"",width:"921",height:"832"})]}),"\n",(0,a.jsx)(n.p,{children:"\u65b0\u589e\u4e00\u4e2aou (people)\n\u901a\u8fc7ldif\u6587\u4ef6\u7684\u5bfc\u5165\u5f62\u5f0f\u8fdc\u6bd4\u624b\u52a8\u6dfb\u52a0\u66f4\u4e3a\u65b9\u4fbf\uff0c\u4e0b\u9762\u662f\u6dfb\u52a0ou\u7684ldif\u914d\u7f6e\u6587\u4ef6\u5185\u5bb9\u3002\u5e76\u4e14\u5c06\u4ed6\u4eec\u5bfc\u5165\u8fdb\u53bb"}),"\n",(0,a.jsx)(n.p,{children:"people.ldif"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ldif",children:"dn: ou=people,dc=light,dc=com\nou: group\nobjectclass: top\nobjectclass: organizationalUnit\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u65b0\u589e\u4e00\u4e2a\u7528\u6237 (tom)"}),"\n",(0,a.jsx)(n.p,{children:"tom.ldif"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ldif",children:"dn: uid=tom, ou=people, dc=light,dc=com\nobjectClass: organizationalPerson\nobjectClass: person\nobjectClass: inetOrgPerson\nobjectClass: top\nobjectClass: authority\ncn: tom\nsn: tom\nmobile: 123456\ndisplayName: tom\nmail: 123456@qq.com\nuid: tom\nuserPassword: 123456\ngroupId: 630030462375411712\nroleId: 703667259852726272\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5bfc\u5165\u7ed3\u679c\u5982\u56fe\n",(0,a.jsx)(n.img,{alt:"img",src:t(27163).Z+"",width:"1149",height:"731"})]}),"\n",(0,a.jsx)(n.h2,{id:"\u4e8c\u642d\u5efa\u670d\u52a1",children:"\u4e8c\u3001\u642d\u5efa\u670d\u52a1"}),"\n",(0,a.jsx)(n.h3,{id:"21-\u914d\u7f6e",children:"2.1 \u914d\u7f6e"}),"\n",(0,a.jsx)(n.p,{children:"pom.ml"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:"<dependency>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-starter-data-ldap</artifactId>\n</dependency>\n"})}),"\n",(0,a.jsx)(n.p,{children:"application.yaml"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  ldap:\n    urls: ldap://localhost:10389\n    base: ou=people,dc=light,dc=com\n    username: uid=admin,ou=system\n    password: secret\n    base-environment.java.naming.ldap.attributes.binary: objectGUID\n"})}),"\n",(0,a.jsx)(n.h3,{id:"22-\u914d\u7f6e\u7c7b",children:"2.2 \u914d\u7f6e\u7c7b"}),"\n",(0,a.jsxs)(n.p,{children:["\u521b\u5efa\u914d\u7f6e\u7c7b\uff0c\u5b8c\u6210\u7528Spring LDAP\u8fde\u63a5LDAP\u670d\u52a1\u5668\uff0c\u5b9a\u4e49",(0,a.jsx)(n.code,{children:"LdapTemplate"}),"\uff0c\u540e\u7eed\u901a\u8fc7\u5b83\u5b8c\u6210\u5bf9ldap\u76ee\u5f55\u6811\u7684CRUD\u64cd\u4f5c"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'/**\n * @see org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration\n */\n@Configuration\npublic class LdapConfig {\n\n    @Resource\n    private LdapTemplate ldapTemplate;\n\n    @Bean\n    public LdapContextSource contextSource() {\n        LdapContextSource contextSource = new LdapContextSource();\n        Map<String, Object> config = new HashMap<>();\n        contextSource.setUrl(urls);\n        contextSource.setBase(base);\n        contextSource.setUserDn(username);\n        contextSource.setPassword(password);\n        // \u89e3\u51b3\u4e71\u7801\n        config.put("java.naming.ldap.attributes.binary", "objectGUID");\n        contextSource.setPooled(true);\n        contextSource.setBaseEnvironmentProperties(config);\n        return contextSource;\n    }\n\n    @Bean\n    public LdapTemplate ldapTemplate() {\n        if (null == ldapTemplate) {\n            ldapTemplate = new LdapTemplate(contextSource());\n        }\n        return ldapTemplate;\n    }\n\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"23-\u4e1a\u52a1\u7c7b",children:"2.3 \u4e1a\u52a1\u7c7b"}),"\n",(0,a.jsxs)(n.p,{children:["\u4ee5\u4e0b\u5c31\u662f\u901a\u8fc7",(0,a.jsx)(n.code,{children:"LdapTemplate"}),"\u5b8c\u6210CRUD\u529f\u80fd\uff0c\u540e\u7eed\u521b\u65b0\u5e73\u53f0\u5bf9\u7528\u6237\u8fdb\u884c\u589e\u5220\u6539\u67e5\u64cd\u4f5c\u90fd\u4f1a\u8c03\u7528\u8fd9\u4e9b\u63a5\u53e3\u5c06\u7528\u6237\u4fe1\u606f\u540c\u6b65\u5230LDAP\u670d\u52a1\u5668\u4e2d"]}),"\n",(0,a.jsx)(n.p,{children:"LdapTestController.java"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@RestController\n@RequestMapping("ldap")\npublic class LdapTestController {\n\n    @Resource\n    private LdapService ldapService;\n\n    @Resource\n    private LdapAuthenticationProvider ldapAuthenticationProvider;\n\n    @GetMapping("userExists")\n    public ResultResponse<Boolean> userExists(String username) {\n        ldapService.userExists(username);\n        return ResultResponse.SUCCESS(true);\n    }\n\n    @GetMapping("userInfo")\n    public ResultResponse<UserInfo> userInfo(String username) throws NamingException {\n        UserInfo adapter = ldapService.userInfo(username);\n        return ResultResponse.SUCCESS(adapter);\n    }\n\n    @PostMapping("authenticate")\n    public ResultResponse<Object> authenticate(@RequestBody LoginParam user) {\n        UsernamePasswordAuthenticationToken token = new UsernamePasswordAuthenticationToken(user.getUsername(), user.getPassword());\n        Authentication authentication = ldapAuthenticationProvider.authenticate(token);\n        return ResultResponse.SUCCESS(authentication.getPrincipal());\n    }\n\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"LdapService.java"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public interface LdapService {\n\n    /**\n     * \u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\n     * @param username \u7528\u6237\u540d\n     * @return \n     */\n    void userExists(String username);\n\n    /**\n     * \u6839\u636e\u7528\u6237\u540d\u67e5\u8be2\u7528\u6237\u4fe1\u606f\n     * @param username \u7528\u6237\u540d\n     * @return \n     */\n    UserInfo userInfo(String username) throws NamingException;\n\n    /**\n     * \u767b\u5f55\u8ba4\u8bc1\n     * @param username \u7528\u6237\u540d\n     * @param password \u5bc6\u7801\n     * @return\n     */\n    boolean authentication(String username, String password);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"LdapServiceImpl.java"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Service\npublic class LdapServiceImpl implements LdapService {\n\n    public static final Logger log = LoggerFactory.getLogger(LdapServiceImpl.class);\n\n    @Resource\n    private LdapTemplate ldapTemplate;\n\n    @Override\n    public void userExists(String username) {\n        ldapTemplate.lookup("uid=" + username);\n    }\n\n    @Override\n    public UserInfo userInfo(String username) {\n        Object result = ldapTemplate.lookup("uid=" + username);\n        if (result instanceof DirContextAdapter) {\n            return parse((DirContextAdapter) result);\n        }\n        return null;\n    }\n\n    @Override\n    public boolean authentication(String username, String password) {\n        EqualsFilter filter = new EqualsFilter("uid", username);\n        return ldapTemplate.authenticate("", filter.encode(), password);\n    }\n\n    public UserInfo parse(DirContextAdapter adapter) {\n        Map<String, LdapAttributeVO> attributeMap = parseAttributes(adapter);\n\n        LdapAttributeVO uid = attributeMap.get("uid");\n        LdapAttributeVO userPassword = attributeMap.get("userPassword");\n        LdapAttributeVO displayName = attributeMap.get("displayName");\n        LdapAttributeVO mobile = attributeMap.get("mobile");\n        LdapAttributeVO mail = attributeMap.get("mail");\n//        LdapAttributeVO groupId = attributeMap.get("groupId");\n//        LdapAttributeVO roleId = attributeMap.get("roleId");\n//        List<Long> groupIds = Arrays.stream(groupId.getValue().toString().split(",")).map(Long::valueOf).collect(Collectors.toList());\n//        List<Long> roleIds = Arrays.stream(roleId.getValue().toString().split(",")).map(Long::valueOf).collect(Collectors.toList());\n\n        Object value = userPassword.getValue();\n        String password = (value instanceof String) ? (String) value : new String((byte[]) value);\n        UserInfo userInfo = new UserInfo();\n        userInfo.setUsername(parseValue(uid.getValue().toString()));\n        userInfo.setRealname(parseValue(displayName.getValue().toString()));\n        userInfo.setPassword(password);\n        userInfo.setEmail(parseValue(mail.getValue().toString()));\n        userInfo.setPhone(parseValue(mobile.getValue().toString()));\n//        userInfo.setGroupIdList(groupIds);\n//        userInfo.setRoleIdList(roleIds);\n\n        return userInfo;\n    }\n\n    public String parseValue(String value) {\n        Charset charset = CharsetTool.detect(value);\n        if (StandardCharsets.UTF_8.equals(charset)) {\n            return value;\n        }\n        return new String(value.getBytes(charset), StandardCharsets.UTF_8);\n    }\n\n    public Map<String, LdapAttributeVO> parseAttributes(DirContextAdapter adapter) {\n        Map<String, LdapAttributeVO> attributeMap = new HashMap<>(16);\n        NamingEnumeration<? extends Attribute> attributesEnum = adapter.getAttributes().getAll();\n        try {\n            while (attributesEnum.hasMoreElements()) {\n                Attribute attribute = attributesEnum.next();\n\n                LdapAttributeVO attributeVO = convertAttribute(attribute);\n                attributeMap.put(attributeVO.getName(), attributeVO);\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n\n        return attributeMap;\n    }\n\n    public LdapAttributeVO convertAttribute(Attribute attribute) throws NamingException {\n        String id = attribute.getID();\n        Object value = attribute.get();\n        String name = id;\n        List<String> langTags = new ArrayList<>();\n        List<String> options = new ArrayList<>();\n        if (id.contains(";")) {\n            String[] ids = id.split(";");\n            name = ids[0];\n            for (int i = 1, len = ids.length; i < len; i++) {\n                String tag = ids[i];\n                if (tag.startsWith("lang-")) {\n                    tag = tag.substring("lang-".length());\n                    langTags.add(tag);\n                } else {\n                    options.add(tag);\n                }\n            }\n        }\n        LdapAttributeVO ldapAttributeVO = new LdapAttributeVO();\n        ldapAttributeVO.setName(name);\n        ldapAttributeVO.setLangTags(langTags);\n        ldapAttributeVO.setOptions(options);\n        ldapAttributeVO.setValue(value);\n        return ldapAttributeVO;\n    }\n\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"LdapAttributeVO.java"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"@Data\npublic class LdapAttributeVO implements Serializable {\n\n    private static final long serialVersionUID = -1L;\n\n    /**\n     * \u5c5e\u6027\u540d\n     */\n    private String name;\n    /**\n     * \u5c5e\u6027\u8bed\u8a00\u6807\u7b7e\n     */\n    private List<String> langTags;\n    /**\n     * \u5c5e\u6027\u989d\u5916\u914d\u7f6e\u4fe1\u606f\n     */\n    private List<String> options;\n\n    /**\n     * \u503c\n     */\n    private Object value;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"UserInfo.java"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Data\npublic class UserInfo implements Serializable {\n\n    private static final long serialVersionUID = 1L;\n    /**\n     * \u7528\u6237\u6765\u6e90\u7684\u7b2c\u4e09\u65b9\u7cfb\u7edf\u7cfb\u7edf\u6807\u8bc6\uff0c\u5982\uff1aldap\uff0cwecom\uff0cdingtalk\u7b49\n     */\n    @NotNull(message = "\u7b2c\u4e09\u65b9\u7cfb\u7edf\u7cfb\u7edf\u6807\u8bc6\u4e0d\u80fd\u4e3a\u7a7a")\n    private String thirdSource;\n    /**\n     * \u7528\u6237\u540d\n     */\n    @NotNull(message = "\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a")\n    private String username;\n    /**\n     * \u7528\u6237\u59d3\u540d\n     */\n    @NotNull(message = "\u7528\u6237\u771f\u5b9e\u540d\u5b57\u4e0d\u80fd\u4e3a\u7a7a")\n    private String realname;\n    /**\n     * \u5bc6\u7801\n     */\n    @NotNull\n    @Length(min = 5, max = 50, message = "\u7528\u6237\u5bc6\u7801\u957f\u5ea6\u5e94\u8be5\u57285 -50\u4e4b\u95f4")\n    private String password;\n    /**\n     * \u90ae\u7bb1\n     */\n    @NotNull(message = "\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a")\n    private String email;\n    /**\n     * \u624b\u673a\u53f7\n     */\n    @NotNull(message = "\u624b\u673a\u53f7\u4e0d\u80fd\u4e3a\u7a7a")\n    private String phone;\n    /**\n     * \u4e3b\u90e8\u95e8\n     */\n    @NotNull(message = "\u4e3b\u90e8\u95e8\u4e0d\u80fd\u4e3a\u7a7a")\n    private Long mainDepartmentId;\n    /**\n     * \u72b6\u6001 0-\u6b63\u5e38\uff1b1-\u5220\u9664\u3001\u51bb\u7ed3\n     */\n    @NotNull(message = "\u72b6\u6001\u4e0d\u80fd\u4e3a\u7a7a")\n    @Max(value = 1, message = "\u72b6\u6001\u6700\u5927\u4e3a1")\n    @Min(value = 0, message = "\u72b6\u6001\u6700\u5c0f\u4e3a0")\n    private Integer status;\n    /**\n     * \u89d2\u8272id\u96c6\u5408\n     */\n    private List<Long> roleIdList;\n    /**\n     * \u5206\u7ec4id\u96c6\u5408\n     */\n    private List<Long> groupIdList;\n\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u4e09\u6d4b\u8bd5\u6548\u679c",children:"\u4e09\u3001\u6d4b\u8bd5\u6548\u679c"}),"\n",(0,a.jsx)(n.h2,{id:"\u56db\u96c6\u6210oauth2",children:"\u56db\u3001\u96c6\u6210OAuth2"})]})}function u(e={}){const{wrapper:n}={...(0,s.ah)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},2668:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-1-3071f7e3b84b18588e93713191948ad6.PNG"},38995:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-10-e04f03f4cf4308f6a4590ca489642234.PNG"},61447:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-11-eeff09e51ddf78503a4de001c6c84911.PNG"},3995:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-12-310d99c0bc064afeae14b2c23bf536cb.PNG"},50392:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-13-63c9fe749dc6896e352c76ff35d53cde.PNG"},83737:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-14-61fe9427c6fc0a0844e75a29c575fa2f.PNG"},24176:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-15-b1bdc6d1d4125500a0b53b0d94617b1c.PNG"},86570:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-16-f117e46bcd4fd1e145a21eadd82d15ec.PNG"},30114:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-17-c9e5e7056fc5912a248f701ed60ee6ab.PNG"},8384:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-18-11648fd312f491ef050753f92d0a9a14.PNG"},70871:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-19-6445a0d0491c65803ac54db4c94bfc39.PNG"},60202:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-2-466b227f46b0d26505517249f6bc8894.PNG"},23386:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-20-651baa6c3dba29757ede7d1f35872a65.PNG"},27163:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-21-4804adc5b2b0b17d7242695e30887ef9.PNG"},50887:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-3-ccdcdc87698684096c65bb18a45143db.PNG"},92469:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-4-6659e4ad8665b3affb115168b7c46474.PNG"},23118:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-5-045215a3909e543d58184723a481828c.PNG"},89624:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-6-86823be0e46cdfc9d336d5cae19abb03.PNG"},98634:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-7-b5c2241d47fcef3388990f21f786ba5e.PNG"},97509:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-8-e7888d75292634c9151435889b077ee8.PNG"},76358:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/3-9-3c9cb913fecc685baf4bed6b1c2e6680.PNG"},11151:(e,n,t)=>{t.d(n,{ah:()=>i});var a=t(67294);const s=a.createContext({});function i(e){const n=a.useContext(s);return a.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}}}]);