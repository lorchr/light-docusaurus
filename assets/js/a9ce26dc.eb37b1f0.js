"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[50850],{44373:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var i=r(74848),t=r(28453);const c={},a=void 0,o={id:"zh-cn/java/Java-Concurrent-CyclicBarrier",title:"Java-Concurrent-CyclicBarrier",description:"- Java\u5e76\u53d1\u7cfb\u5217[8]----CyclicBarrier\u6e90\u7801\u5206\u6790",source:"@site/docs/zh-cn/java/5-Java-Concurrent-CyclicBarrier.md",sourceDirName:"zh-cn/java",slug:"/zh-cn/java/Java-Concurrent-CyclicBarrier",permalink:"/docs/zh-cn/java/Java-Concurrent-CyclicBarrier",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/java/5-Java-Concurrent-CyclicBarrier.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"troch",previous:{title:"Java-Concurrent-CountDownlatch",permalink:"/docs/zh-cn/java/Java-Concurrent-CountDownlatch"},next:{title:"Java-Concurrent-ConcurrentHashMap",permalink:"/docs/zh-cn/java/Java-Concurrent-ConcurrentHashMap"}},s={},l=[];function d(n){const e={a:"a",code:"code",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://cnblogs.com/liuyun1995/p/8529360.html",children:"Java\u5e76\u53d1\u7cfb\u5217[8]----CyclicBarrier\u6e90\u7801\u5206\u6790"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:"https://mp.weixin.qq.com/s/tCuiiY-g13M1R1Fu5hoT-Q",children:"\u301095\u671f\u3011Java\u5e76\u53d1\u7cfb\u5217 | CyclicBarrier\u6e90\u7801\u5206\u6790"})}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"\u73b0\u5b9e\u751f\u6d3b\u4e2d\u6211\u4eec\u7ecf\u5e38\u4f1a\u9047\u5230\u8fd9\u6837\u7684\u60c5\u666f\uff0c\u5728\u8fdb\u884c\u67d0\u4e2a\u6d3b\u52a8\u524d\u9700\u8981\u7b49\u5f85\u4eba\u5168\u90e8\u90fd\u9f50\u4e86\u624d\u5f00\u59cb\u3002\u4f8b\u5982\u5403\u996d\u65f6\u8981\u7b49\u5168\u5bb6\u4eba\u90fd\u4e0a\u5ea7\u4e86\u624d\u52a8\u7b77\u5b50\uff0c\u65c5\u6e38\u65f6\u8981\u7b49\u5168\u90e8\u4eba\u90fd\u5230\u9f50\u4e86\u624d\u51fa\u53d1\uff0c\u6bd4\u8d5b\u65f6\u8981\u7b49\u8fd0\u52a8\u5458\u90fd\u4e0a\u573a\u540e\u624d\u5f00\u59cb\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u5728JUC\u5305\u4e2d\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u4e00\u4e2a\u540c\u6b65\u5de5\u5177\u7c7b\u80fd\u591f\u5f88\u597d\u7684\u6a21\u62df\u8fd9\u7c7b\u573a\u666f\uff0c\u5b83\u5c31\u662f",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u7c7b\u3002\u5229\u7528",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u7c7b\u53ef\u4ee5\u5b9e\u73b0\u4e00\u7ec4\u7ebf\u7a0b\u76f8\u4e92\u7b49\u5f85\uff0c\u5f53\u6240\u6709\u7ebf\u7a0b\u90fd\u5230\u8fbe\u67d0\u4e2a\u5c4f\u969c\u70b9\u540e\u518d\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002\u4e0b\u56fe\u6f14\u793a\u4e86\u8fd9\u4e00\u8fc7\u7a0b\u3002"]}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"CyclicBarrier-1",src:r(91553).A+"",width:"402",height:"425"})}),"\n",(0,i.jsx)(e.p,{children:"\u5728CyclicBarrier\u7c7b\u7684\u5185\u90e8\u6709\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u5728\u5230\u8fbe\u5c4f\u969c\u70b9\u7684\u65f6\u5019\u90fd\u4f1a\u8c03\u7528await\u65b9\u6cd5\u5c06\u81ea\u5df1\u963b\u585e\uff0c\u6b64\u65f6\u8ba1\u6570\u5668\u4f1a\u51cf1\uff0c\u5f53\u8ba1\u6570\u5668\u51cf\u4e3a0\u7684\u65f6\u5019\u6240\u6709\u56e0\u8c03\u7528await\u65b9\u6cd5\u800c\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u5c06\u88ab\u5524\u9192\u3002\u8fd9\u5c31\u662f\u5b9e\u73b0\u4e00\u7ec4\u7ebf\u7a0b\u76f8\u4e92\u7b49\u5f85\u7684\u539f\u7406\uff0c\u4e0b\u9762\u6211\u4eec\u5148\u770b\u770bCyclicBarrier\u6709\u54ea\u4e9b\u6210\u5458\u53d8\u91cf\u3002"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"//\u540c\u6b65\u64cd\u4f5c\u9501\nprivate final ReentrantLock lock = new ReentrantLock();\n//\u7ebf\u7a0b\u62e6\u622a\u5668\nprivate final Condition trip = lock.newCondition();\n//\u6bcf\u6b21\u62e6\u622a\u7684\u7ebf\u7a0b\u6570\nprivate final int parties;\n//\u6362\u4ee3\u524d\u6267\u884c\u7684\u4efb\u52a1\nprivate final Runnable barrierCommand;\n//\u8868\u793a\u6805\u680f\u7684\u5f53\u524d\u4ee3\nprivate Generation generation = new Generation();\n//\u8ba1\u6570\u5668\nprivate int count;\n\n//\u9759\u6001\u5185\u90e8\u7c7bGeneration\nprivate static class Generation {\n    boolean broken = false;\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4e0a\u9762\u8d34\u51fa\u4e86",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u6240\u6709\u7684\u6210\u5458\u53d8\u91cf\uff0c\u53ef\u4ee5\u770b\u5230",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u5185\u90e8\u662f\u901a\u8fc7\u6761\u4ef6\u961f\u5217trip\u6765\u5bf9\u7ebf\u7a0b\u8fdb\u884c\u963b\u585e\u7684\uff0c\u5e76\u4e14\u5176\u5185\u90e8\u7ef4\u62a4\u4e86\u4e24\u4e2aint\u578b\u7684\u53d8\u91cf",(0,i.jsx)(e.code,{children:"parties"}),"\u548c",(0,i.jsx)(e.code,{children:"count"}),"\uff0c",(0,i.jsx)(e.code,{children:"partie"}),"s\u8868\u793a\u6bcf\u6b21\u62e6\u622a\u7684\u7ebf\u7a0b\u6570\uff0c\u8be5\u503c\u5728\u6784\u9020\u65f6\u8fdb\u884c\u8d4b\u503c\u3002",(0,i.jsx)(e.code,{children:"count"}),"\u662f\u5185\u90e8\u8ba1\u6570\u5668\uff0c\u5b83\u7684\u521d\u59cb\u503c\u548c",(0,i.jsx)(e.code,{children:"parties"}),"\u76f8\u540c\uff0c\u4ee5\u540e\u968f\u7740\u6bcf\u6b21",(0,i.jsx)(e.code,{children:"await"}),"\u65b9\u6cd5\u7684\u8c03\u7528\u800c\u51cf1\uff0c\u76f4\u5230\u51cf\u4e3a0\u5c31\u5c06\u6240\u6709\u7ebf\u7a0b\u5524\u9192\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["CyclicBarrier\u6709\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7b",(0,i.jsx)(e.code,{children:"Generation"}),"\uff0c\u8be5\u7c7b\u7684\u5bf9\u8c61\u4ee3\u8868\u6805\u680f\u7684\u5f53\u524d\u4ee3\uff0c\u5c31\u50cf\u73a9\u6e38\u620f\u65f6\u4ee3\u8868\u7684\u672c\u5c40\u6e38\u620f\uff0c\u5229\u7528\u5b83\u53ef\u4ee5\u5b9e\u73b0\u5faa\u73af\u7b49\u5f85\u3002barrierCommand\u8868\u793a\u6362\u4ee3\u524d\u6267\u884c\u7684\u4efb\u52a1\uff0c\u5f53count\u51cf\u4e3a0\u65f6\u8868\u793a\u672c\u5c40\u6e38\u620f\u7ed3\u675f\uff0c\u9700\u8981\u8f6c\u5230\u4e0b\u4e00\u5c40\u3002\u5728\u8f6c\u5230\u4e0b\u4e00\u5c40\u6e38\u620f\u4e4b\u524d\u4f1a\u5c06\u6240\u6709\u963b\u585e\u7684\u7ebf\u7a0b\u5524\u9192\uff0c\u5728\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u4e4b\u524d\u4f60\u53ef\u4ee5\u901a\u8fc7\u6307\u5b9abarrierCommand\u6765\u6267\u884c\u81ea\u5df1\u7684\u4efb\u52a1\u3002\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u5b83\u7684\u6784\u9020\u5668\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"//\u6784\u9020\u56681\npublic CyclicBarrier(int parties, Runnable barrierAction) {\n    if (parties <= 0) throw new IllegalArgumentException();\n    this.parties = parties;\n    this.count = parties;\n    this.barrierCommand = barrierAction;\n}\n\n//\u6784\u9020\u56682\npublic CyclicBarrier(int parties) {\n    this(parties, null);\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u6709\u4e24\u4e2a\u6784\u9020\u5668\uff0c\u5176\u4e2d\u6784\u9020\u56681\u662f\u5b83\u7684\u6838\u5fc3\u6784\u9020\u5668\uff0c\u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u6307\u5b9a\u672c\u5c40\u6e38\u620f\u7684\u53c2\u4e0e\u8005\u6570\u91cf(\u8981\u62e6\u622a\u7684\u7ebf\u7a0b\u6570)\u4ee5\u53ca\u672c\u5c40\u7ed3\u675f\u65f6\u8981\u6267\u884c\u7684\u4efb\u52a1\uff0c\u8fd8\u53ef\u4ee5\u770b\u5230\u8ba1\u6570\u5668count\u7684\u521d\u59cb\u503c\u88ab\u8bbe\u7f6e\u4e3a",(0,i.jsx)(e.code,{children:"parties"}),"\u3002",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u7c7b\u6700\u4e3b\u8981\u7684\u529f\u80fd\u5c31\u662f\u4f7f\u5148\u5230\u8fbe\u5c4f\u969c\u70b9\u7684\u7ebf\u7a0b\u963b\u585e\u5e76\u7b49\u5f85\u540e\u9762\u7684\u7ebf\u7a0b\uff0c\u5176\u4e2d\u5b83\u63d0\u4f9b\u4e86\u4e24\u79cd\u7b49\u5f85\u7684\u65b9\u6cd5\uff0c\u5206\u522b\u662f\u5b9a\u65f6\u7b49\u5f85\u548c\u975e\u5b9a\u65f6\u7b49\u5f85\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"//\u975e\u5b9a\u65f6\u7b49\u5f85\npublic int await() throws InterruptedException, BrokenBarrierException {\n    try {\n        return dowait(false, 0L);\n    } catch (TimeoutException toe) {\n        throw new Error(toe);\n    }\n}\n\n//\u5b9a\u65f6\u7b49\u5f85\npublic int await(long timeout, TimeUnit unit) throws InterruptedException, BrokenBarrierException, TimeoutException {\n    return dowait(true, unit.toNanos(timeout));\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\u4e0d\u7ba1\u662f\u5b9a\u65f6\u7b49\u5f85\u8fd8\u662f\u975e\u5b9a\u65f6\u7b49\u5f85\uff0c\u5b83\u4eec\u90fd\u8c03\u7528\u4e86",(0,i.jsx)(e.code,{children:"dowait"}),"\u65b9\u6cd5\uff0c\u53ea\u4e0d\u8fc7\u662f\u4f20\u5165\u7684\u53c2\u6570\u4e0d\u540c\u800c\u5df2\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u770b",(0,i.jsx)(e.code,{children:"dowait"}),"\u65b9\u6cd5\u90fd\u505a\u4e86\u4e9b\u4ec0\u4e48\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"//\u6838\u5fc3\u7b49\u5f85\u65b9\u6cd5\nprivate int dowait(boolean timed, long nanos) throws InterruptedException, BrokenBarrierException, TimeoutException {\n    final ReentrantLock lock = this.lock;\n    lock.lock();\n    try {\n        final Generation g = generation;\n        //\u68c0\u67e5\u5f53\u524d\u6805\u680f\u662f\u5426\u88ab\u6253\u7ffb\n        if (g.broken) {\n            throw new BrokenBarrierException();\n        }\n        //\u68c0\u67e5\u5f53\u524d\u7ebf\u7a0b\u662f\u5426\u88ab\u4e2d\u65ad\n        if (Thread.interrupted()) {\n            //\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u4f1a\u505a\u4ee5\u4e0b\u4e09\u4ef6\u4e8b\n            //1.\u6253\u7ffb\u5f53\u524d\u6805\u680f\n            //2.\u5524\u9192\u62e6\u622a\u7684\u6240\u6709\u7ebf\u7a0b\n            //3.\u629b\u51fa\u4e2d\u65ad\u5f02\u5e38\n            breakBarrier();\n            throw new InterruptedException();\n        }\n       //\u6bcf\u6b21\u90fd\u5c06\u8ba1\u6570\u5668\u7684\u503c\u51cf1\n       int index = --count;\n       //\u8ba1\u6570\u5668\u7684\u503c\u51cf\u4e3a0\u5219\u9700\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u5e76\u8f6c\u6362\u5230\u4e0b\u4e00\u4ee3\n       if (index == 0) {\n           boolean ranAction = false;\n           try {\n               //\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u524d\u5148\u6267\u884c\u6307\u5b9a\u7684\u4efb\u52a1\n               final Runnable command = barrierCommand;\n               if (command != null) {\n                   command.run();\n               }\n               ranAction = true;\n               //\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u5e76\u8f6c\u5230\u4e0b\u4e00\u4ee3\n               nextGeneration();\n               return 0;\n           } finally {\n               //\u786e\u4fdd\u5728\u4efb\u52a1\u672a\u6210\u529f\u6267\u884c\u65f6\u80fd\u5c06\u6240\u6709\u7ebf\u7a0b\u5524\u9192\n               if (!ranAction) {\n                   breakBarrier();\n               }\n           }\n       }\n\n       //\u5982\u679c\u8ba1\u6570\u5668\u4e0d\u4e3a0\u5219\u6267\u884c\u6b64\u5faa\u73af\n       for (;;) {\n           try {\n               //\u6839\u636e\u4f20\u5165\u7684\u53c2\u6570\u6765\u51b3\u5b9a\u662f\u5b9a\u65f6\u7b49\u5f85\u8fd8\u662f\u975e\u5b9a\u65f6\u7b49\u5f85\n               if (!timed) {\n                   trip.await();\n               }else if (nanos > 0L) {\n                   nanos = trip.awaitNanos(nanos);\n               }\n           } catch (InterruptedException ie) {\n               //\u82e5\u5f53\u524d\u7ebf\u7a0b\u5728\u7b49\u5f85\u671f\u95f4\u88ab\u4e2d\u65ad\u5219\u6253\u7ffb\u6805\u680f\u5524\u9192\u5176\u4ed6\u7ebf\u7a0b\n               if (g == generation && ! g.broken) {\n                   breakBarrier();\n                   throw ie;\n               } else {\n                   //\u82e5\u5728\u6355\u83b7\u4e2d\u65ad\u5f02\u5e38\u524d\u5df2\u7ecf\u5b8c\u6210\u5728\u6805\u680f\u4e0a\u7684\u7b49\u5f85, \u5219\u76f4\u63a5\u8c03\u7528\u4e2d\u65ad\u64cd\u4f5c\n                   Thread.currentThread().interrupt();\n               }\n           }\n           //\u5982\u679c\u7ebf\u7a0b\u56e0\u4e3a\u6253\u7ffb\u6805\u680f\u64cd\u4f5c\u800c\u88ab\u5524\u9192\u5219\u629b\u51fa\u5f02\u5e38\n           if (g.broken) {\n               throw new BrokenBarrierException();\n           }\n           //\u5982\u679c\u7ebf\u7a0b\u56e0\u4e3a\u6362\u4ee3\u64cd\u4f5c\u800c\u88ab\u5524\u9192\u5219\u8fd4\u56de\u8ba1\u6570\u5668\u7684\u503c\n           if (g != generation) {\n               return index;\n           }\n           //\u5982\u679c\u7ebf\u7a0b\u56e0\u4e3a\u65f6\u95f4\u5230\u4e86\u800c\u88ab\u5524\u9192\u5219\u6253\u7ffb\u6805\u680f\u5e76\u629b\u51fa\u5f02\u5e38\n           if (timed && nanos <= 0L) {\n               breakBarrier();\n               throw new TimeoutException();\n           }\n       }\n    } finally {\n        lock.unlock();\n    }\n}\n"})}),"\n",(0,i.jsx)(e.p,{children:"\u4e0a\u9762\u8d34\u51fa\u7684\u4ee3\u7801\u4e2d\u6ce8\u91ca\u90fd\u6bd4\u8f83\u8be6\u7ec6\uff0c\u6211\u4eec\u53ea\u6311\u4e00\u4e9b\u91cd\u8981\u7684\u6765\u8bb2\u3002"}),"\n",(0,i.jsxs)(e.p,{children:["\u53ef\u4ee5\u770b\u5230\u5728",(0,i.jsx)(e.code,{children:"dowait"}),"\u65b9\u6cd5\u4e2d\u6bcf\u6b21\u90fd\u5c06",(0,i.jsx)(e.code,{children:"count"}),"\u51cf1\uff0c\u51cf\u5b8c\u540e\u7acb\u9a6c\u8fdb\u884c\u5224\u65ad\u770b\u770b\u662f\u5426\u7b49\u4e8e0\uff0c\u5982\u679c\u7b49\u4e8e0\u7684\u8bdd\u5c31\u4f1a\u5148\u53bb\u6267\u884c\u4e4b\u524d\u6307\u5b9a\u597d\u7684\u4efb\u52a1\uff0c\u6267\u884c\u5b8c\u4e4b\u540e\u518d\u8c03\u7528",(0,i.jsx)(e.code,{children:"nextGeneration"}),"\u65b9\u6cd5\u5c06\u6805\u680f\u8f6c\u5230\u4e0b\u4e00\u4ee3\uff0c\u5728\u8be5\u65b9\u6cd5\u4e2d\u4f1a\u5c06\u6240\u6709\u7ebf\u7a0b\u5524\u9192\uff0c\u5c06\u8ba1\u6570\u5668\u7684\u503c\u91cd\u65b0\u8bbe\u4e3a",(0,i.jsx)(e.code,{children:"parties"}),"\uff0c\u6700\u540e\u4f1a\u91cd\u65b0\u8bbe\u7f6e\u6805\u680f\u4ee3\u6b21\uff0c\u5728\u6267\u884c\u5b8c",(0,i.jsx)(e.code,{children:"nextGeneration"}),"\u65b9\u6cd5\u4e4b\u540e\u5c31\u610f\u5473\u7740\u6e38\u620f\u8fdb\u5165\u4e0b\u4e00\u5c40\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u8ba1\u6570\u5668\u6b64\u65f6\u8fd8\u4e0d\u7b49\u4e8e0\u7684\u8bdd\u5c31\u8fdb\u5165for\u5faa\u73af\uff0c\u6839\u636e\u53c2\u6570\u6765\u51b3\u5b9a\u662f\u8c03\u7528",(0,i.jsx)(e.code,{children:"trip.awaitNanos(nanos)"}),"\u8fd8\u662f",(0,i.jsx)(e.code,{children:"trip.await()"}),"\u65b9\u6cd5\uff0c\u8fd9\u4e24\u65b9\u6cd5\u5bf9\u5e94\u7740\u5b9a\u65f6\u548c\u975e\u5b9a\u65f6\u7b49\u5f85\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u5728\u7b49\u5f85\u8fc7\u7a0b\u4e2d\u5f53\u524d\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u5c31\u4f1a\u6267\u884c",(0,i.jsx)(e.code,{children:"breakBarrier"}),"\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u53eb\u505a\u6253\u7834\u6805\u680f\uff0c\u610f\u5473\u7740\u6e38\u620f\u5728\u4e2d\u9014\u88ab\u6390\u65ad\uff0c\u8bbe\u7f6e",(0,i.jsx)(e.code,{children:"generation"}),"\u7684",(0,i.jsx)(e.code,{children:"broken"}),"\u72b6\u6001\u4e3atrue\u5e76\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u3002\u540c\u65f6\u8fd9\u4e5f\u8bf4\u660e\u5728\u7b49\u5f85\u8fc7\u7a0b\u4e2d\u6709\u4e00\u4e2a\u7ebf\u7a0b\u88ab\u4e2d\u65ad\u6574\u76d8\u6e38\u620f\u5c31\u7ed3\u675f\uff0c\u6240\u6709\u4e4b\u524d\u88ab\u963b\u585e\u7684\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u5524\u9192\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u7ebf\u7a0b\u9192\u6765\u540e\u4f1a\u6267\u884c\u4e0b\u9762\u4e09\u4e2a\u5224\u65ad\uff0c\u770b\u770b\u662f\u5426\u56e0\u4e3a\u8c03\u7528",(0,i.jsx)(e.code,{children:"breakBarrier"}),"\u65b9\u6cd5\u800c\u88ab\u5524\u9192\uff0c\u5982\u679c\u662f\u5219\u629b\u51fa\u5f02\u5e38\uff1b\u770b\u770b\u662f\u5426\u662f\u6b63\u5e38\u7684\u6362\u4ee3\u64cd\u4f5c\u800c\u88ab\u5524\u9192\uff0c\u5982\u679c\u662f\u5219\u8fd4\u56de\u8ba1\u6570\u5668\u7684\u503c\uff1b\u770b\u770b\u662f\u5426\u56e0\u4e3a\u8d85\u65f6\u800c\u88ab\u5524\u9192\uff0c\u5982\u679c\u662f\u7684\u8bdd\u5c31\u8c03\u7528",(0,i.jsx)(e.code,{children:"breakBarrier"}),"\u6253\u7834\u6805\u680f\u5e76\u629b\u51fa\u5f02\u5e38\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u8fd9\u91cc\u8fd8\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u5176\u4e2d\u6709\u4e00\u4e2a\u7ebf\u7a0b\u56e0\u4e3a\u7b49\u5f85\u8d85\u65f6\u800c\u9000\u51fa\uff0c\u90a3\u4e48\u6574\u76d8\u6e38\u620f\u4e5f\u4f1a\u7ed3\u675f\uff0c\u5176\u4ed6\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u5524\u9192\u3002\u4e0b\u9762\u8d34\u51fa",(0,i.jsx)(e.code,{children:"nextGeneration"}),"\u65b9\u6cd5\u548c",(0,i.jsx)(e.code,{children:"breakBarrier"}),"\u65b9\u6cd5\u7684\u5177\u4f53\u4ee3\u7801\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:"//\u5207\u6362\u6805\u680f\u5230\u4e0b\u4e00\u4ee3\nprivate void nextGeneration() {\n    //\u5524\u9192\u6761\u4ef6\u961f\u5217\u6240\u6709\u7ebf\u7a0b\n    trip.signalAll();\n    //\u8bbe\u7f6e\u8ba1\u6570\u5668\u7684\u503c\u4e3a\u9700\u8981\u62e6\u622a\u7684\u7ebf\u7a0b\u6570\n    count = parties;\n    //\u91cd\u65b0\u8bbe\u7f6e\u6805\u680f\u4ee3\u6b21\n    generation = new Generation();\n}\n\n//\u6253\u7ffb\u5f53\u524d\u6805\u680f\nprivate void breakBarrier() {\n    //\u5c06\u5f53\u524d\u6805\u680f\u72b6\u6001\u8bbe\u7f6e\u4e3a\u6253\u7ffb\n    generation.broken = true;\n    //\u8bbe\u7f6e\u8ba1\u6570\u5668\u7684\u503c\u4e3a\u9700\u8981\u62e6\u622a\u7684\u7ebf\u7a0b\u6570\n    count = parties;\n    //\u5524\u9192\u6240\u6709\u7ebf\u7a0b\n    trip.signalAll();\n}\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u4e0a\u9762\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u6e90\u7801\u5c06",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u7684\u539f\u7406\u57fa\u672c\u90fd\u8bb2\u6e05\u695a\u4e86\uff0c\u4e0b\u9762\u6211\u4eec\u5c31\u901a\u8fc7\u4e00\u4e2a\u8d5b\u9a6c\u7684\u4f8b\u5b50\u6765\u6df1\u5165\u638c\u63e1\u5b83\u7684\u4f7f\u7528\u3002"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-java",children:'class Horse implements Runnable {\n\n    private static int counter = 0;\n    private final int id = counter++;\n    private int strides = 0;\n    private static Random rand = new Random(47);\n    private static CyclicBarrier barrier;\n\n    public Horse(CyclicBarrier b) { barrier = b; }\n\n    @Override\n    public void run() {\n        try {\n            while(!Thread.interrupted()) {\n                synchronized(this) {\n                    //\u8d5b\u9a6c\u6bcf\u6b21\u968f\u673a\u8dd1\u51e0\u6b65\n                    strides += rand.nextInt(3);\n                }\n                barrier.await();\n            }\n        } catch(Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    public String tracks() {\n        StringBuilder s = new StringBuilder();\n        for(int i = 0; i < getStrides(); i++) {\n            s.append("*");\n        }\n        s.append(id);\n        return s.toString();\n    }\n\n    public synchronized int getStrides() { return strides; }\n    public String toString() { return "Horse " + id + " "; }\n\n}\n\npublic class HorseRace implements Runnable {\n\n    private static final int FINISH_LINE = 75;\n    private static List<Horse> horses = new ArrayList<Horse>();\n    private static ExecutorService exec = Executors.newCachedThreadPool();\n\n    @Override\n    public void run() {\n        StringBuilder s = new StringBuilder();\n        //\u6253\u5370\u8d5b\u9053\u8fb9\u754c\n        for(int i = 0; i < FINISH_LINE; i++) {\n            s.append("=");\n        }\n        System.out.println(s);\n        //\u6253\u5370\u8d5b\u9a6c\u8f68\u8ff9\n        for(Horse horse : horses) {\n            System.out.println(horse.tracks());\n        }\n        //\u5224\u65ad\u662f\u5426\u7ed3\u675f\n        for(Horse horse : horses) {\n            if(horse.getStrides() >= FINISH_LINE) {\n                System.out.println(horse + "won!");\n                exec.shutdownNow();\n                return;\n            }\n        }\n        //\u4f11\u606f\u6307\u5b9a\u65f6\u95f4\u518d\u5230\u4e0b\u4e00\u8f6e\n        try {\n            TimeUnit.MILLISECONDS.sleep(200);\n        } catch(InterruptedException e) {\n            System.out.println("barrier-action sleep interrupted");\n        }\n    }\n\n    public static void main(String[] args) {\n        CyclicBarrier barrier = new CyclicBarrier(7, new HorseRace());\n        for(int i = 0; i < 7; i++) {\n            Horse horse = new Horse(barrier);\n            horses.add(horse);\n            exec.execute(horse);\n        }\n    }\n\n}\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u8be5\u8d5b\u9a6c\u7a0b\u5e8f\u4e3b\u8981\u662f\u901a\u8fc7\u5728\u63a7\u5236\u53f0\u4e0d\u505c\u7684\u6253\u5370\u5404\u8d5b\u9a6c\u7684\u5f53\u524d\u8f68\u8ff9\uff0c\u4ee5\u6b64\u8fbe\u5230\u52a8\u6001\u663e\u793a\u7684\u6548\u679c\u3002\u6574\u573a\u6bd4\u8d5b\u6709\u591a\u4e2a\u8f6e\u6b21\uff0c\u6bcf\u4e00\u8f6e\u6b21\u5404\u4e2a\u8d5b\u9a6c\u90fd\u4f1a\u968f\u673a\u8d70\u4e0a\u51e0\u6b65\u7136\u540e\u8c03\u7528await\u65b9\u6cd5\u8fdb\u884c\u7b49\u5f85\uff0c\u5f53\u6240\u6709\u8d5b\u9a6c\u8d70\u5b8c\u4e00\u8f6e\u7684\u65f6\u5019\u5c06\u4f1a\u6267\u884c\u4efb\u52a1\u5c06\u6240\u6709\u8d5b\u9a6c\u7684\u5f53\u524d\u8f68\u8ff9\u6253\u5370\u5230\u63a7\u5236\u53f0\u4e0a\u3002\u8fd9\u6837\u6bcf\u4e00\u8f6e\u4e0b\u6765\u5404\u8d5b\u9a6c\u7684\u8f68\u8ff9\u90fd\u5728\u4e0d\u505c\u7684\u589e\u957f\uff0c\u5f53\u5176\u4e2d\u67d0\u4e2a\u8d5b\u9a6c\u7684\u8f68\u8ff9\u6700\u5148\u589e\u957f\u5230\u6307\u5b9a\u7684\u503c\u7684\u65f6\u5019\u5c06\u4f1a\u7ed3\u675f\u6574\u573a\u6bd4\u8d5b\uff0c\u8be5\u8d5b\u9a6c\u6210\u4e3a\u6574\u573a\u6bd4\u8d5b\u7684\u80dc\u5229\u8005\uff01\u7a0b\u5e8f\u7684\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{alt:"img",src:r(17718).A+"",width:"703",height:"381"})}),"\n",(0,i.jsxs)(e.p,{children:["\u81f3\u6b64\u6211\u4eec\u96be\u514d\u4f1a\u5c06",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u4e0e",(0,i.jsx)(e.code,{children:"CountDownLatch"}),"\u8fdb\u884c\u4e00\u756a\u6bd4\u8f83\u3002\u8fd9\u4e24\u4e2a\u7c7b\u90fd\u53ef\u4ee5\u5b9e\u73b0\u4e00\u7ec4\u7ebf\u7a0b\u5728\u5230\u8fbe\u67d0\u4e2a\u6761\u4ef6\u4e4b\u524d\u8fdb\u884c\u7b49\u5f85\uff0c\u5b83\u4eec\u5185\u90e8\u90fd\u6709\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u5f53\u8ba1\u6570\u5668\u7684\u503c\u4e0d\u65ad\u7684\u51cf\u4e3a0\u7684\u65f6\u5019\u6240\u6709\u963b\u585e\u7684\u7ebf\u7a0b\u5c06\u4f1a\u88ab\u5524\u9192\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u6709\u533a\u522b\u7684\u662f",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u7684\u8ba1\u6570\u5668\u7531\u81ea\u5df1\u63a7\u5236\uff0c\u800c",(0,i.jsx)(e.code,{children:"CountDownLatch"}),"\u7684\u8ba1\u6570\u5668\u5219\u7531\u4f7f\u7528\u8005\u6765\u63a7\u5236\uff0c\u5728",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u4e2d\u7ebf\u7a0b\u8c03\u7528",(0,i.jsx)(e.code,{children:"await"}),"\u65b9\u6cd5\u4e0d\u4ec5\u4f1a\u5c06\u81ea\u5df1\u963b\u585e\u8fd8\u4f1a\u5c06\u8ba1\u6570\u5668\u51cf1\uff0c\u800c\u5728",(0,i.jsx)(e.code,{children:"CountDownLatch"}),"\u4e2d\u7ebf\u7a0b\u8c03\u7528",(0,i.jsx)(e.code,{children:"await"}),"\u65b9\u6cd5\u53ea\u662f\u5c06\u81ea\u5df1\u963b\u585e\u800c\u4e0d\u4f1a\u51cf\u5c11\u8ba1\u6570\u5668\u7684\u503c\u3002"]}),"\n",(0,i.jsxs)(e.p,{children:["\u53e6\u5916\uff0c",(0,i.jsx)(e.code,{children:"CountDownLatch"}),"\u53ea\u80fd\u62e6\u622a\u4e00\u8f6e\uff0c\u800c",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u53ef\u4ee5\u5b9e\u73b0\u5faa\u73af\u62e6\u622a\u3002\u4e00\u822c\u6765\u8bf4\u7528",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u53ef\u4ee5\u5b9e\u73b0",(0,i.jsx)(e.code,{children:"CountDownLatch"}),"\u7684\u529f\u80fd\uff0c\u800c\u53cd\u4e4b\u5219\u4e0d\u80fd\uff0c\u4f8b\u5982\u4e0a\u9762\u7684\u8d5b\u9a6c\u7a0b\u5e8f\u5c31\u53ea\u80fd\u4f7f\u7528",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\u6765\u5b9e\u73b0\u3002\u603b\u4e4b\uff0c\u8fd9\u4e24\u4e2a\u7c7b\u7684\u5f02\u540c\u70b9\u5927\u81f4\u5982\u6b64\uff0c\u81f3\u4e8e\u4f55\u65f6\u4f7f\u7528",(0,i.jsx)(e.code,{children:"CyclicBarrier"}),"\uff0c\u4f55\u65f6\u4f7f\u7528",(0,i.jsx)(e.code,{children:"CountDownLatch"}),"\uff0c\u8fd8\u9700\u8981\u8bfb\u8005\u81ea\u5df1\u53bb\u62ff\u634f\u3002"]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(d,{...n})}):d(n)}},91553:(n,e,r)=>{r.d(e,{A:()=>i});const i=r.p+"assets/images/CyclicBarrier-1-a906856be76b9a7751a8fcf143a52ee7.gif"},17718:(n,e,r)=>{r.d(e,{A:()=>i});const i=r.p+"assets/images/CyclicBarrier-2-5064a6d3cb151d5d3574769ea3d0c95b.gif"},28453:(n,e,r)=>{r.d(e,{R:()=>a,x:()=>o});var i=r(96540);const t={},c=i.createContext(t);function a(n){const e=i.useContext(c);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:a(n.components),i.createElement(c.Provider,{value:e},n.children)}}}]);