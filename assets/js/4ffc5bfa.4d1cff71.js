"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[3747],{3905:(e,n,r)=>{r.d(n,{Zo:()=>c,kt:()=>k});var s=r(67294);function d(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);n&&(s=s.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,s)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){d(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function a(e,n){if(null==e)return{};var r,s,d=function(e,n){if(null==e)return{};var r,s,d={},t=Object.keys(e);for(s=0;s<t.length;s++)r=t[s],n.indexOf(r)>=0||(d[r]=e[r]);return d}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(s=0;s<t.length;s++)r=t[s],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(d[r]=e[r])}return d}var o=s.createContext({}),l=function(e){var n=s.useContext(o),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},c=function(e){var n=l(e.components);return s.createElement(o.Provider,{value:n},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var n=e.children;return s.createElement(s.Fragment,{},n)}},m=s.forwardRef((function(e,n){var r=e.components,d=e.mdxType,t=e.originalType,o=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),u=l(r),m=d,k=u["".concat(o,".").concat(m)]||u[m]||p[m]||t;return r?s.createElement(k,i(i({ref:n},c),{},{components:r})):s.createElement(k,i({ref:n},c))}));function k(e,n){var r=arguments,d=n&&n.mdxType;if("string"==typeof e||d){var t=r.length,i=new Array(t);i[0]=m;var a={};for(var o in n)hasOwnProperty.call(n,o)&&(a[o]=n[o]);a.originalType=e,a[u]="string"==typeof e?e:d,i[1]=a;for(var l=2;l<t;l++)i[l]=r[l];return s.createElement.apply(null,i)}return s.createElement.apply(null,r)}m.displayName="MDXCreateElement"},91059:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>a,toc:()=>l});var s=r(87462),d=(r(67294),r(3905));const t={},i=void 0,a={unversionedId:"zh-cn/devenv/Docker-Redis",id:"zh-cn/devenv/Docker-Redis",title:"Docker-Redis",description:"- Redis Offical",source:"@site/docs/zh-cn/devenv/Docker-Redis.md",sourceDirName:"zh-cn/devenv",slug:"/zh-cn/devenv/Docker-Redis",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Redis",draft:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/devenv/Docker-Redis.md",tags:[],version:"current",frontMatter:{},sidebar:"troch",previous:{title:"Docker-Oracle",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Oracle"},next:{title:"Docker-Nginx",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Nginx"}},o={},l=[{value:"1. Docker\u5b89\u88c5",id:"1-docker\u5b89\u88c5",level:2},{value:"2. \u914d\u7f6e",id:"2-\u914d\u7f6e",level:2},{value:"3. Redis Stream \u57fa\u672c\u547d\u4ee4",id:"3-redis-stream-\u57fa\u672c\u547d\u4ee4",level:2},{value:"4. Redis Lua\u811a\u672c",id:"4-redis-lua\u811a\u672c",level:2},{value:"4.1 \u6279\u91cf\u5220\u9664\u76f8\u540c\u524d\u7f00\u7684\u5143\u7d20",id:"41-\u6279\u91cf\u5220\u9664\u76f8\u540c\u524d\u7f00\u7684\u5143\u7d20",level:3},{value:"4.2 \u83b7\u53d6\u5206\u5e03\u5f0f\u9501",id:"42-\u83b7\u53d6\u5206\u5e03\u5f0f\u9501",level:2},{value:"4.3  \u91ca\u653e\u5206\u5e03\u5f0f\u9501",id:"43--\u91ca\u653e\u5206\u5e03\u5f0f\u9501",level:2},{value:"4.4 \u5206\u5e03\u5f0f\u9501\u7eed\u7ea6",id:"44-\u5206\u5e03\u5f0f\u9501\u7eed\u7ea6",level:2},{value:"5. Docker Compose\u8fd0\u884cRedis\u96c6\u7fa4",id:"5-docker-compose\u8fd0\u884credis\u96c6\u7fa4",level:2},{value:"5.1 Cluster\u96c6\u7fa4",id:"51-cluster\u96c6\u7fa4",level:3}],c={toc:l},u="wrapper";function p(e){let{components:n,...r}=e;return(0,d.kt)(u,(0,s.Z)({},c,r,{components:n,mdxType:"MDXLayout"}),(0,d.kt)("ul",null,(0,d.kt)("li",{parentName:"ul"},(0,d.kt)("a",{parentName:"li",href:"https://redis.io/"},"Redis Offical")),(0,d.kt)("li",{parentName:"ul"},(0,d.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/redis"},"Redis Docker")),(0,d.kt)("li",{parentName:"ul"},(0,d.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/redislabs/redisinsight"},"RedisInsight Docker"))),(0,d.kt)("h2",{id:"1-docker\u5b89\u88c5"},"1. Docker\u5b89\u88c5"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-shell"},'# \u521b\u5efaNetwork\ndocker network create dev\n\n# \u83b7\u53d6\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6 http://download.redis.io/redis-stable/redis.conf\ncurl https://raw.githubusercontent.com/redis/redis/6.2/redis.conf -o D:/docker/redis/conf/redis.conf\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --publish 6379:6379 \\\n  --net dev \\\n  --restart=no \\\n  --name redis \\\n  redis:6.2\n\ndocker run -d \\\n  --publish 38001:8001 \\\n  --net dev \\\n  --restart=no \\\n  --name redisinsight \\\n  redislabs/redisinsight:1.14.0\n\nvim ./redis.conf\n\ndocker run -d \\\n  --publish 6379:6379 \\\n  --volume //d/docker/redis/conf/redis.conf:/etc/redis/redis.conf \\\n  --net dev \\\n  --restart=no \\\n  --name redis \\\n  redis:6.2 redis-server /etc/redis/redis.conf\n\n# \u542f\u52a8\u65f6\u6307\u5b9a\u5bc6\u7801\ndocker run -d \\\n  --publish 6379:6379 \\\n  --net dev \\\n  --restart=no \\\n  --name redis \\\n  redis:6.2 --requirepass "admin"\n\ndocker exec -it -u root redis /bin/bash\n\n# redis-cli \u8bbe\u7f6e\u5bc6\u7801\ncd /usr/local/bin\n\nredis-cli\nconfig get requirepass\nconfig set requirepass "admin"\n\ndocker container restart redis\n\ndocker cp redis:/usr/local/bin/redis.conf ./redis.conf\n')),(0,d.kt)("ul",null,(0,d.kt)("li",{parentName:"ul"},"Account",(0,d.kt)("ul",{parentName:"li"},(0,d.kt)("li",{parentName:"ul"},"/admin")))),(0,d.kt)("p",null,(0,d.kt)("a",{parentName:"p",href:"http://localhost:38001"},"RedisInsight")),(0,d.kt)("h2",{id:"2-\u914d\u7f6e"},"2. \u914d\u7f6e"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-conf"},"# \u7ed1\u5b9a\u672c\u673a\u7684IP\u5730\u5740\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u53ea\u80fd\u901a\u8fc7\u8be5IP\u8bbf\u95eeredis\uff0c\u672c\u673a\u591a\u4e2a\u7f51\u5361\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u5176\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\uff08\u7a7a\u683c\u5206\u9694\uff09\n# bind 127.0.0.1              \u672c\u673a\u56de\u73af\u5730\u5740\uff0c\u53ea\u80fd\u672c\u673a\u8bbf\u95ee\n# bind 192.168.0.2 127.0.0.1  \u53ef\u4ee5\u672c\u673a\u548c \u901a\u8fc7192.168.0.2 \u6240\u5c5e\u7f51\u5361\u8bbf\u95ee\uff08\u5373\u540c\u7f51\u6bb5\uff09\n# bind * -::1                 \u901a\u8fc7\u672c\u673a\u6240\u6709\u7684\u7f51\u5361\u8bbf\u95ee\nbind 192.168.0.2\n# \u8bbe\u7f6e\u5bc6\u7801\nrequirepass admin\n#\u4fee\u6539\u4e3a\u5b88\u62a4\u6a21\u5f0f\ndaemonize yes\n# \u5173\u95ed\u4fdd\u62a4\u6a21\u5f0f\nprotected-mode no\n#\u8bbe\u7f6e\u8fdb\u7a0b\u9501\u6587\u4ef6\npidfile /usr/local/redis/redis.pid\n#\u7aef\u53e3\nport 6379\n#\u5ba2\u6237\u7aef\u8d85\u65f6\u65f6\u95f4\ntimeout 300\n#\u65e5\u5fd7\u7ea7\u522b\nloglevel debug\n#\u65e5\u5fd7\u6587\u4ef6\u4f4d\u7f6e\nlogfile /usr/local/redis/log-redis.log\n#\u8bbe\u7f6e\u6570\u636e\u5e93\u7684\u6570\u91cf\uff0c\u9ed8\u8ba4\u6570\u636e\u5e93\u4e3a0\uff0c\u53ef\u4ee5\u4f7f\u7528SELECT <dbid>\u547d\u4ee4\u5728\u8fde\u63a5\u4e0a\u6307\u5b9a\u6570\u636e\u5e93id\ndatabases 8\n##\u6307\u5b9a\u5728\u591a\u957f\u65f6\u95f4\u5185\uff0c\u6709\u591a\u5c11\u6b21\u66f4\u65b0\u64cd\u4f5c\uff0c\u5c31\u5c06\u6570\u636e\u540c\u6b65\u5230\u6570\u636e\u6587\u4ef6\uff0c\u53ef\u4ee5\u591a\u4e2a\u6761\u4ef6\u914d\u5408\n#save <seconds> <changes>\n#Redis\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e2d\u63d0\u4f9b\u4e86\u4e09\u4e2a\u6761\u4ef6\uff1a\nsave 3600 1\nsave 300 10\nsave 60 10000\n#\u6307\u5b9a\u5b58\u50a8\u81f3\u672c\u5730\u6570\u636e\u5e93\u65f6\u662f\u5426\u538b\u7f29\u6570\u636e\uff0c\u9ed8\u8ba4\u4e3ayes\uff0cRedis\u91c7\u7528LZF\u538b\u7f29\uff0c\u5982\u679c\u4e3a\u4e86\u8282\u7701CPU\u65f6\u95f4\uff0c\n#\u53ef\u4ee5\u5173\u95ed\u8be5#\u9009\u9879\uff0c\u4f46\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u6587\u4ef6\u53d8\u7684\u5de8\u5927\nrdbcompression yes\n#\u6307\u5b9a\u672c\u5730\u6570\u636e\u5e93\u6587\u4ef6\u540d\ndbfilename dump.rdb\n#\u6307\u5b9a\u672c\u5730\u6570\u636e\u5e93\u8def\u5f84\ndir /usr/local/redis/db/\n#\u6307\u5b9a\u662f\u5426\u5728\u6bcf\u6b21\u66f4\u65b0\u64cd\u4f5c\u540e\u8fdb\u884c\u65e5\u5fd7\u8bb0\u5f55\uff0cRedis\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u5f02\u6b65\u7684\u628a\u6570\u636e\u5199\u5165\u78c1\u76d8\uff0c\u5982\u679c\u4e0d\u5f00\u542f\uff0c\u53ef\u80fd\n#\u4f1a\u5728\u65ad\u7535\u65f6\u5bfc\u81f4\u4e00\u6bb5\u65f6\u95f4\u5185\u7684\u6570\u636e\u4e22\u5931\u3002\u56e0\u4e3a redis\u672c\u8eab\u540c\u6b65\u6570\u636e\u6587\u4ef6\u662f\u6309\u4e0a\u9762save\u6761\u4ef6\u6765\u540c\u6b65\u7684\uff0c\u6240\u4ee5\u6709\n#\u7684\u6570\u636e\u4f1a\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\u4e2d\nappendonly no\n#\u6307\u5b9a\u66f4\u65b0\u65e5\u5fd7\u6761\u4ef6\uff0c\u5171\u67093\u4e2a\u53ef\u9009\u503c\uff1a\n#no\uff1a\u8868\u793a\u7b49\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u884c\u6570\u636e\u7f13\u5b58\u540c\u6b65\u5230\u78c1\u76d8\uff08\u5feb\uff09\n#always\uff1a\u8868\u793a\u6bcf\u6b21\u66f4\u65b0\u64cd\u4f5c\u540e\u624b\u52a8\u8c03\u7528fsync()\u5c06\u6570\u636e\u5199\u5230\u78c1\u76d8\uff08\u6162\uff0c\u5b89\u5168\uff09\n#everysec\uff1a\u8868\u793a\u6bcf\u79d2\u540c\u6b65\u4e00\u6b21\uff08\u6298\u8877\uff0c\u9ed8\u8ba4\u503c\uff09\nappendfsync everysec\n")),(0,d.kt)("h2",{id:"3-redis-stream-\u57fa\u672c\u547d\u4ee4"},"3. Redis Stream \u57fa\u672c\u547d\u4ee4"),(0,d.kt)("ul",null,(0,d.kt)("li",{parentName:"ul"},(0,d.kt)("a",{parentName:"li",href:"https://blog.csdn.net/qq_43956758/article/details/109860706"},"https://blog.csdn.net/qq_43956758/article/details/109860706"))),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"# \u521b\u5efastream\nXADD maintenance_order:event_alarm * type customIncident;\n\n# \u521b\u5efaconsumer group\nXGROUP CREATE maintenance_order:event_alarm default_group 0;\n\n# \u83b7\u53d6stream\u5143\u7d20\u4e2a\u6570\nXLEN maintenance_order:event_alarm;\n\n# \u83b7\u53d6stream\u4e2d\u6240\u6709\u5143\u7d20 - \u6700\u5c0f\u503c + \u505a\u5927\u503c\nXRANGE maintenance_order:event_alarm - +;\n\n# \u83b7\u53d6stream\u4fe1\u606f\nXINFO STREAM maintenance_order:event_alarm;\n\n# \u83b7\u53d6stream \u7684consumer group\u4fe1\u606f\nXINFO GROUPS maintenance_order:event_alarm;\n\n# \u6d88\u8d39\u6570\u636e\nXREADGROUP GROUP default_group default_consumer COUNT 1 STREAMS maintenance_order:event_alarm >;\n\n# \u5220\u9664\u6d88\u606f\nXDEL maintenance_order:event_alarm record_id;\n\n# \u5220\u9664stream\nDEL maintenance_order:event_alarm;\n\n-- \u5220\u9664stream\nDEL maintenance_order:event_alarm;\n\n-- \u8bbe\u5907\u544a\u8b66\nkeys device_alarm_matching*\ndel device_alarm_matching:\n\n-- \u5220\u9664\u544a\u8b66\u5386\u53f2\nkeys thing_alarm_matching*\n")),(0,d.kt)("h2",{id:"4-redis-lua\u811a\u672c"},"4. Redis Lua\u811a\u672c"),(0,d.kt)("h3",{id:"41-\u6279\u91cf\u5220\u9664\u76f8\u540c\u524d\u7f00\u7684\u5143\u7d20"},"4.1 \u6279\u91cf\u5220\u9664\u76f8\u540c\u524d\u7f00\u7684\u5143\u7d20"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"local keys = redis.call('keys', ARGV[1] .. '*'); \nfor idx, val in ipairs(keys) do \n    redis.call('del', val); \nend \nreturn keys;\n")),(0,d.kt)("p",null,"\u547d\u4ee4\u884c\u7528\u6cd5\uff1a"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-shell"},"EVAL \"local keys = redis.call('keys', ARGV[1] .. '*'); for i, key in ipairs(keys) do redis.call('del', key); end return keys;\" 0 <prefix>\n")),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"local keys = redis.call('keys', ARGV[1]);\nlocal temp = {};\nfor idx, val in ipairs(keys) do\n    table.insert(temp, {val, redis.call('del', val)});\nend\nreturn temp;\n")),(0,d.kt)("p",null,"\u547d\u4ee4\u884c\u7528\u6cd5\uff1a"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-shell"},"EVAL \"local keys = redis.call('keys', ARGV[1]); local temp = {}; for idx, val in ipairs(keys) do table.insert(temp, {val, redis.call('del', val) }); end return temp;\" 0 prefix*\n")),(0,d.kt)("h2",{id:"42-\u83b7\u53d6\u5206\u5e03\u5f0f\u9501"},"4.2 \u83b7\u53d6\u5206\u5e03\u5f0f\u9501"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"if redis.call('setnx', KEYS[1], ARGV[1]) == 1 then\n    return redis.call('expire', KEYS[1], ARGV[2]);\nelse\n    return 0;\nend\n")),(0,d.kt)("p",null,"\u53ef\u91cd\u5165\u7248"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"if ((redis.call('exists', KEYS[1]) == 0)\n      or (redis.call('hexists', KEYS[1], ARGV[1]) == 1)) then\n    redis.call('hincrby', KEYS[1], ARGV[1], 1);\n    redis.call('expire', KEYS[1], ARGV[2]);\n    return nil;\nend\n                \nreturn redis.call('ttl', KEYS[1]);\n")),(0,d.kt)("h2",{id:"43--\u91ca\u653e\u5206\u5e03\u5f0f\u9501"},"4.3  \u91ca\u653e\u5206\u5e03\u5f0f\u9501"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"if redis.call('exists', KEYS[1]) == 0 then\n    return 1;\nend\n                \nif redis.call('get', KEYS[1]) == ARGV[1] then\n    return redis.call('del', KEYS[1]);\nelse\n    return 0;\nend\n")),(0,d.kt)("h2",{id:"44-\u5206\u5e03\u5f0f\u9501\u7eed\u7ea6"},"4.4 \u5206\u5e03\u5f0f\u9501\u7eed\u7ea6"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-lua"},"if redis.call('exists', KEYS[1]) == 0 then\n    return 0;\nend\n                \nif redis.call('get', KEYS[1]) == ARGV[1] then\n    local ttl = redis.call('ttl', KEYS[1]);\n    return redis.call('expire', KEYS[1], ARGV[2]);\nelse\n    return 0;\nend\n")),(0,d.kt)("h2",{id:"5-docker-compose\u8fd0\u884credis\u96c6\u7fa4"},"5. Docker Compose\u8fd0\u884cRedis\u96c6\u7fa4"),(0,d.kt)("h3",{id:"51-cluster\u96c6\u7fa4"},"5.1 Cluster\u96c6\u7fa4"),(0,d.kt)("ol",null,(0,d.kt)("li",{parentName:"ol"},"redis.conf")),(0,d.kt)("p",null,"\u914d\u7f6e\u4ee5",(0,d.kt)("inlineCode",{parentName:"p"},"6381"),"\u8282\u70b9\u4e3a\u4f8b\uff0c\u5176\u4f59\u8282\u70b9\u5c06\u6587\u4ef6\u4e2d\u7684\u6240\u6709",(0,d.kt)("inlineCode",{parentName:"p"},"6381"),"\u6539\u4e3a\u5bf9\u5e94\u503c\u5373\u53ef\uff0c\u5982\uff1a",(0,d.kt)("inlineCode",{parentName:"p"},"6382")," ",(0,d.kt)("inlineCode",{parentName:"p"},"6383"),"\u7b49"),(0,d.kt)("p",null,(0,d.kt)("inlineCode",{parentName:"p"},"sed -i 's/6381/6382/g' redis.conf")),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-conf"},'# \u7aef\u53e3\nport 6381\n# \u7ed1\u5b9a\u5ba2\u6237\u7aef\u8bbf\u95eeIP\nbind 0.0.0.0 -::0\n# \u5bc6\u7801\nrequirepass admin\nmasterauth admin\n# \u5173\u95ed\u4fdd\u62a4\u6a21\u5f0f\nprotected-mode no\n# \u662f\u5426\u4ee5\u5b88\u8fdb\u7a0b\u6a21\u5f0f\u8fd0\u884c\ndaemonize no\n\n# \u8d85\u65f6\u65f6\u95f4\ntcp-keepalive 500\ntimeout 100\n# aof\nappendonly yes\nappendfilename "appendonly-redis.aof"\n# \u5f53daemonize=yes\u65f6\u5019\u624d\u4f1a\u751f\u6548\npidfile /var/run/redis_6381.pid\n# log \u65e5\u5fd7\u7ea7\u522b\nloglevel notice\n# \u65e5\u5fd7\u6587\u4ef6\u5b58\u653e\u8def\u5f84\nlogfile "redis_6381.log"\n\n# \u5f00\u542f\u96c6\u7fa4\u6a21\u5f0f\ncluster-enabled yes \n# \u96c6\u7fa4\u914d\u7f6e\u6587\u4ef6\ncluster-config-file nodes-6381.conf\n# \u96c6\u7fa4\u8d85\u65f6\u65f6\u95f4\ncluster-node-timeout 5000\n\n# \u4ee5\u4e0b\u914d\u7f6e\u7528\u4e8eDocker NAT\u7f51\u7edc\u73af\u5883\u4e2d\n# \u96c6\u7fa4\u5bf9\u5916ip  \u5bbf\u4e3b\u673a\u7684IP\u5730\u5740\ncluster-announce-ip  192.168.9.75\ncluster-announce-port 6381\ncluster-announce-bus-port 16381\n')),(0,d.kt)("ol",{start:2},(0,d.kt)("li",{parentName:"ol"},"redis-cluster.yaml")),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.7"\n\nservices:\n  redis-node-1:\n    image: redis:6.2\n    container_name: redis-node-1\n    hostname: redis-node-1\n    ports:\n      - 6381:6381\n      - 16381:16381\n    networks:\n      redis-network:\n        ipv4_address: 172.222.0.11\n    extra_hosts:\n      - "redis-node-1:172.222.0.11"\n      - "redis-node-2:172.222.0.12"\n      - "redis-node-3:172.222.0.13"\n      - "redis-node-4:172.222.0.14"\n      - "redis-node-5:172.222.0.15"\n      - "redis-node-6:172.222.0.16"\n    volumes:\n      - //d/docker/redis-cluster/6381/data:/data\n      - //d/docker/redis-cluster/6381:/usr/local/etc/redis\n    restart: no\n    command:\n      redis-server /usr/local/etc/redis/redis.conf\n  \n  redis-node-2:\n    image: redis:6.2\n    container_name: redis-node-2\n    hostname: redis-node-2\n    ports:\n      - 6382:6382\n      - 16382:16382\n    networks:\n      redis-network:\n        ipv4_address: 172.222.0.12\n    extra_hosts:\n      - "redis-node-1:172.222.0.11"\n      - "redis-node-2:172.222.0.12"\n      - "redis-node-3:172.222.0.13"\n      - "redis-node-4:172.222.0.14"\n      - "redis-node-5:172.222.0.15"\n      - "redis-node-6:172.222.0.16"\n    volumes:\n      - //d/docker/redis-cluster/6382/data:/data\n      - //d/docker/redis-cluster/6382:/usr/local/etc/redis\n    restart: no\n    command:\n      redis-server /usr/local/etc/redis/redis.conf\n  \n  redis-node-3:\n    image: redis:6.2\n    container_name: redis-node-3\n    hostname: redis-node-3\n    ports:\n      - 6383:6383\n      - 16383:16383\n    networks:\n      redis-network:\n        ipv4_address: 172.222.0.13\n    extra_hosts:\n      - "redis-node-1:172.222.0.11"\n      - "redis-node-2:172.222.0.12"\n      - "redis-node-3:172.222.0.13"\n      - "redis-node-4:172.222.0.14"\n      - "redis-node-5:172.222.0.15"\n      - "redis-node-6:172.222.0.16"\n    volumes:\n      - //d/docker/redis-cluster/6383/data:/data\n      - //d/docker/redis-cluster/6383:/usr/local/etc/redis\n    restart: no\n    command:\n      redis-server /usr/local/etc/redis/redis.conf\n  \n  redis-node-4:\n    image: redis:6.2\n    container_name: redis-node-4\n    hostname: redis-node-4\n    ports:\n      - 6384:6384\n      - 16384:16384\n    networks:\n      redis-network:\n        ipv4_address: 172.222.0.14\n    extra_hosts:\n      - "redis-node-1:172.222.0.11"\n      - "redis-node-2:172.222.0.12"\n      - "redis-node-3:172.222.0.13"\n      - "redis-node-4:172.222.0.14"\n      - "redis-node-5:172.222.0.15"\n      - "redis-node-6:172.222.0.16"\n    volumes:\n      - //d/docker/redis-cluster/6384/data:/data\n      - //d/docker/redis-cluster/6384:/usr/local/etc/redis\n    restart: no\n    command:\n      redis-server /usr/local/etc/redis/redis.conf\n  \n  redis-node-5:\n    image: redis:6.2\n    container_name: redis-node-5\n    hostname: redis-node-5\n    ports:\n      - 6385:6385\n      - 16385:16385\n    networks:\n      redis-network:\n        ipv4_address: 172.222.0.15\n    extra_hosts:\n      - "redis-node-1:172.222.0.11"\n      - "redis-node-2:172.222.0.12"\n      - "redis-node-3:172.222.0.13"\n      - "redis-node-4:172.222.0.14"\n      - "redis-node-5:172.222.0.15"\n      - "redis-node-6:172.222.0.16"\n    volumes:\n      - //d/docker/redis-cluster/6385/data:/data\n      - //d/docker/redis-cluster/6385:/usr/local/etc/redis\n    restart: no\n    command:\n      redis-server /usr/local/etc/redis/redis.conf\n\n  redis-node-6:\n    image: redis:6.2\n    container_name: redis-node-6\n    hostname: redis-node-6\n    ports:\n      - 6386:6386\n      - 16386:16386\n    networks:\n      redis-network:\n        ipv4_address: 172.222.0.16\n    extra_hosts:\n      - "redis-node-1:172.222.0.11"\n      - "redis-node-2:172.222.0.12"\n      - "redis-node-3:172.222.0.13"\n      - "redis-node-4:172.222.0.14"\n      - "redis-node-5:172.222.0.15"\n      - "redis-node-6:172.222.0.16"\n    volumes:\n      - //d/docker/redis-cluster/6386/data:/data\n      - //d/docker/redis-cluster/6386:/usr/local/etc/redis\n    restart: no\n    command:\n      redis-server /usr/local/etc/redis/redis.conf\n\n  redis-cluster:\n    image: redis:6.2\n    # \u6ce8\u610f\uff1a \u5982\u679c\u96c6\u7fa4\u6709\u5bc6\u7801\uff0c\u9700\u8981\u7528 -a \u6307\u5b9a\u5bc6\u7801\uff0c\u5426\u5219\u4f1a\u521d\u59cb\u5316\u5931\u8d25\n    command: \'redis-cli -a admin --cluster create \n              172.222.0.11:6381 172.222.0.12:6382 172.222.0.13:6383 \n              172.222.0.14:6384 172.222.0.15:6385 172.222.0.16:6386\n              --cluster-replicas 1 --cluster-yes\'\n    networks:\n      - redis-network\n    depends_on:\n      - redis-node-1\n      - redis-node-2\n      - redis-node-3\n      - redis-node-4\n      - redis-node-5\n      - redis-node-6\n\nnetworks:\n  redis-network:\n    name: redis-network\n    driver: bridge\n    ipam:\n      driver: default\n      config:\n        - subnet: 172.222.0.0/24\n')),(0,d.kt)("ol",{start:3},(0,d.kt)("li",{parentName:"ol"},"\u542f\u52a8\u96c6\u7fa4")),(0,d.kt)("p",null,"\u4e0a\u9762\u811a\u672c\u542f\u52a8\u4e4b\u540e\u5c06\u4f1a\u662f\u4e09\u4e3b\u4e09\u4ece\u6a21\u5f0f\uff1b"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-shell"},"# \u521b\u5efa\u76ee\u5f55\nmkdir -p //d/docker/redis-cluster/temp/data\n\n# \u521b\u5efa\u914d\u7f6e\u6587\u4ef6\ncd //d/docker/redis-cluster/\ntouch temp/redis.conf\nvim temp/redis.conf\n\n# \u590d\u5236\u5176\u4ed6\u8282\u70b9\u7684\u76ee\u5f55\ncp -R temp 6381\ncp -R temp 6382\ncp -R temp 6383\ncp -R temp 6384\ncp -R temp 6385\ncp -R temp 6386\n\n# \u4fee\u6539\u8282\u70b9\u7684\u7aef\u53e3\u914d\u7f6e\nsed -i 's/6379/6381/g' 6381/redis.conf\nsed -i 's/6379/6382/g' 6382/redis.conf\nsed -i 's/6379/6383/g' 6383/redis.conf\nsed -i 's/6379/6384/g' 6384/redis.conf\nsed -i 's/6379/6385/g' 6385/redis.conf\nsed -i 's/6379/6386/g' 6386/redis.conf\n\n# \u542f\u52a8redis\u96c6\u7fa4\ndocker compose -f redis-cluster.yaml up -d\n# docker compose -f redis-cluster.yaml down\n\n# \u76ee\u524d\u53ea\u662f\u5c06 redis \u5404\u4e2a\u5bb9\u5668\u542f\u52a8\u6210\u529f\uff0c\u8fd8\u9700\u8981\u5c06 6 \u4e2a\u8282\u70b9\u914d\u7f6e\u6210\u96c6\u7fa4\u6a21\u5f0f\uff1b\n# \u968f\u4fbf\u9009\u62e9\u4e00\u53f0\u673a\u5668\uff0c\u8fdb\u5165\u7ec8\u7aef\u6a21\u5f0f\uff0c\u901a\u8fc7\u4e0b\u9762\u547d\u4ee4\u5373\u53ef\u7ed1\u5b9a redis \u96c6\u7fa4: \nredis-cli -h 172.222.0.11 -p 6381 -a admin --cluster create 172.222.0.16:6381 172.222.0.11:6382 172.222.0.12:6383 172.222.0.13:6384 172.222.0.14:6385 172.222.0.15:6386 --cluster-replicas 1 --cluster-yes\n\n# \u8fdb\u5165\u4e00\u4e2a\u8282\u70b9\u5bb9\u5668\ndocker exec -it -u root redis-node-1 /bin/bash\n\n# \u767b\u5f55\u96c6\u7fa4\nredis-cli -h 172.222.0.11 -p 6381 -a admin -c\n\n# \u67e5\u770b\u96c6\u7fa4\u4fe1\u606f\ncluster info\n\n# \u67e5\u770b\u96c6\u7fa4\u8282\u70b9\ncluster nodes\n\n# \u67e5\u770b\u54c8\u5e0c\u69fd\u4fe1\u606f\ncluster slots\n\n# \u6d4b\u8bd5\nredis-cli -h 172.222.0.11 -p 6381 -a admin -c\nset foo bar\nexit\nredis-cli -h 172.222.0.12 -p 6382 -a admin -c\nget foo\n")),(0,d.kt)("p",null,(0,d.kt)("strong",{parentName:"p"},"\u6ce8\u610f")," \u96c6\u7fa4\u6a21\u5f0f\u4e0b\u767b\u5f55\u9700\u8981\u5e26 ",(0,d.kt)("inlineCode",{parentName:"p"},"-c"),"\u542f\u7528\u96c6\u7fa4\u6a21\u5f0f\uff0c\u5426\u5219\u6267\u884c\u6307\u4ee4\u4f1a\u51fa\u73b0 ",(0,d.kt)("inlineCode",{parentName:"p"},"(error) MOVED 12182 172.222.0.13:6383"),"\u9519\u8bef"))}p.isMDXComponent=!0}}]);