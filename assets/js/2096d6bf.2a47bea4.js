"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[50430],{3181:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard1-0a1561b665fc7ceb1bafcbe42e5cef37.png"},13657:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51653-dfa9a314fcdf72901c561f34075f60b4.png"},15823:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard\u8bbf\u95ee\u5f02\u5e384-1dc60fb44ed04edd7606a74c2721b33d.png"},20582:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51654-dae07990d13ed2d9e4695dffea588bf1.png"},25215:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard3-770691a11156f6df4d80dfba9fa53e03.png"},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var r=s(96540);const d={},l=r.createContext(d);function c(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:c(e.components),r.createElement(l.Provider,{value:n},e.children)}},30037:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/\u52a0\u5165Master\u8282\u70b9\u5f02\u5e381-43ace62326b94ce3322277969d63a50f.png"},30198:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/\u8bc1\u4e66\u6709\u6548\u671f1-1594e2c1abed0a01952cc7f5c1fd6353.png"},30448:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard\u8bbf\u95ee\u5f02\u5e383-e4ed3877f124ddec9866622eecf4588f.png"},33104:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51652-4b20714148f0958ebb72ee2222a29612.png"},35039:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Calico\u8fd0\u884c\u5f02\u5e382-7af266490fa16e07f79ca2801af6dc29.png"},36697:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard\u8bbf\u95ee\u5f02\u5e382-f552d8551ae50e7ab6f381e45224814d.png"},39255:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Node\u8282\u70b9\u52a0\u51653-0607e32f85fff09761daed40f7b2f7f1.png"},40692:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51656-2109608e5122e5cbce3baed570063ed2.png"},44173:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/\u8bc1\u4e66\u6709\u6548\u671f2-4b83258994142b7e99aa3989e4a5b91c.png"},45813:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/VIP2-815cdf626c67885544299a174714a9e3.png"},49262:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Node\u8282\u70b9\u52a0\u51652-adbd5105901597141505eb9e6bfd3487.png"},53762:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard\u8bbf\u95ee\u5f02\u5e381-6988afb0e50db0bf57ae61e054094a68.png"},54699:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c59-087937d1f25ebecb134ee152f4078159.png"},59599:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51655-9daf8c453fa9a4b296171ef366fa3e5e.png"},62686:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/\u52a0\u5165Master\u8282\u70b9\u5f02\u5e382-02157077b0669256838a1d8dd979d215.png"},63127:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c55-fbf05c0e484d3e76c291c3ff5c2262f1.png"},68037:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Node\u8282\u70b9\u52a0\u51651-ed5aaafa07f03e15a9b35d6af3bc0730.png"},71414:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard2-3456c9cffc7ef6f747b1b8392a87d760.png"},72577:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c53-38dcadf90f7c6e7423b6d35ad1da94dd.png"},74355:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c51-a97dd6f2888b352f36edba06a3a56a0c.png"},74396:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c56-1fdd07228504a3078291dca02aa4d94c.png"},78462:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/VIP1-be0e45302eaf3e0510c33eee1fc9e4e7.png"},83512:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c52-da6542721734d458e93808727b2e8693.png"},86603:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51651-d33e2d019cf49be6524b4cd4dd4c60ed.png"},89486:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c54-67368f70c6a17e3d06228d78e8bad347.png"},90276:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/\u8bc1\u4e66\u6709\u6548\u671f3-f07a694fb1b5dab5c32576a7baa1eb4e.png"},91042:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c58-22d9933263debf40e9c427bb2259ebb0.png"},91909:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s\u5b89\u88c57-aca1530d81e322dd9332835645233e44.png"},93297:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"zh-cn/k8s/Build-K8s-Multi-Master-Cluster","title":"Build-K8s-Multi-Master-Cluster","description":"\u4e00\u3001\u76f8\u5173\u94fe\u63a5","source":"@site/docs/zh-cn/k8s/5-Build-K8s-Multi-Master-Cluster.md","sourceDirName":"zh-cn/k8s","slug":"/zh-cn/k8s/Build-K8s-Multi-Master-Cluster","permalink":"/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/k8s/5-Build-K8s-Multi-Master-Cluster.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"troch","previous":{"title":"K8s-Commands","permalink":"/docs/zh-cn/k8s/K8s-Commands"},"next":{"title":"Build-K8s-Multi-Master-Cluster-Offline","permalink":"/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster-Offline"}}');var d=s(74848),l=s(28453);const c={},i=void 0,t={},a=[{value:"\u4e00\u3001\u76f8\u5173\u94fe\u63a5",id:"\u4e00\u76f8\u5173\u94fe\u63a5",level:2},{value:"\u4e8c\u3001\u73af\u5883\u4ecb\u7ecd",id:"\u4e8c\u73af\u5883\u4ecb\u7ecd",level:2},{value:"2.1 \u8f6f\u4ef6\u7248\u672c",id:"21-\u8f6f\u4ef6\u7248\u672c",level:3},{value:"2.2 \u670d\u52a1\u5668\u89c4\u5212",id:"22-\u670d\u52a1\u5668\u89c4\u5212",level:3},{value:"\u4e09\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u51c6\u5907\u5de5\u4f5c",id:"\u4e09\u6240\u6709\u8282\u70b9\u51c6\u5907\u5de5\u4f5c",level:2},{value:"3.1 \u521b\u5efa\u64cd\u4f5c\u7528\u6237",id:"31-\u521b\u5efa\u64cd\u4f5c\u7528\u6237",level:3},{value:"3.2 \u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a",id:"32-\u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a",level:3},{value:"3.3 \u7981\u7528 SELinux",id:"33-\u7981\u7528-selinux",level:3},{value:"3.4 \u914d\u7f6e\u5185\u6838\u53c2\u6570",id:"34-\u914d\u7f6e\u5185\u6838\u53c2\u6570",level:3},{value:"3.5 \u914d\u7f6e\u7f51\u7edc\u53c2\u6570",id:"35-\u914d\u7f6e\u7f51\u7edc\u53c2\u6570",level:3},{value:"3.6 \u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts",id:"36-\u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts",level:3},{value:"3.7 \u8bbe\u7f6e\u65f6\u533a",id:"37-\u8bbe\u7f6e\u65f6\u533a",level:3},{value:"3.8 \u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\uff0c\u5728K8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c",id:"38-\u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u5728k8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c",level:3},{value:"3.9 \u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219",id:"39-\u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219",level:3},{value:"3.10 \u3010\u5728\u7ebf\u3011\u4f9d\u8d56\u9879\u5b89\u88c5",id:"310-\u5728\u7ebf\u4f9d\u8d56\u9879\u5b89\u88c5",level:3},{value:"3.10 \u3010\u79bb\u7ebf\u3011\u4f9d\u8d56\u9879\u5b89\u88c5",id:"310-\u79bb\u7ebf\u4f9d\u8d56\u9879\u5b89\u88c5",level:3},{value:"\u56db\u3001\u3010\u6240\u6709\u8282\u70b9\u3011Docker\u5b89\u88c5\u914d\u7f6e\uff08\u5bb9\u5668\u8fd0\u884c\u65f6\uff09",id:"\u56db\u6240\u6709\u8282\u70b9docker\u5b89\u88c5\u914d\u7f6e\u5bb9\u5668\u8fd0\u884c\u65f6",level:2},{value:"4.1 \u5378\u8f7d\u5df2\u6709Docker Engine",id:"41-\u5378\u8f7d\u5df2\u6709docker-engine",level:3},{value:"4.2 \u6dfb\u52a0Docker yum\u4ed3\u5e93",id:"42-\u6dfb\u52a0docker-yum\u4ed3\u5e93",level:3},{value:"4.3 \u3010\u5728\u7ebf\u3011\u5b89\u88c5Docker",id:"43-\u5728\u7ebf\u5b89\u88c5docker",level:3},{value:"4.3 \u3010\u79bb\u7ebf\u3011\u5b89\u88c5Docker",id:"43-\u79bb\u7ebf\u5b89\u88c5docker",level:3},{value:"4.4 \u5982\u679c\u9700\u8981\u5378\u8f7d\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4",id:"44-\u5982\u679c\u9700\u8981\u5378\u8f7d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4",level:3},{value:"4.5 \u914d\u7f6eDocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93",id:"45-\u914d\u7f6edocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93",level:3},{value:"4.6 \u5b89\u88c5cri-dockerd\u9a71\u52a8\uff08Docker\u4e0eK8s\u96c6\u6210\u7684\u9002\u914d\u5c42\uff09",id:"46-\u5b89\u88c5cri-dockerd\u9a71\u52a8docker\u4e0ek8s\u96c6\u6210\u7684\u9002\u914d\u5c42",level:3},{value:"4.6.1 \u3010\u63a8\u8350\u3011rpm\u5b89\u88c5",id:"461-\u63a8\u8350rpm\u5b89\u88c5",level:4},{value:"4.6.2 \u6e90\u7801\u5b89\u88c5",id:"462-\u6e90\u7801\u5b89\u88c5",level:4},{value:"4.6.3 \u3010\u4ec5\u6e90\u7801\u5b89\u88c5\u3011\u6ce8\u518c\u4e3a\u7cfb\u7edf\u670d\u52a1",id:"463-\u4ec5\u6e90\u7801\u5b89\u88c5\u6ce8\u518c\u4e3a\u7cfb\u7edf\u670d\u52a1",level:4},{value:"4.6.4 \u3010\u4ec5\u6e90\u7801\u5b89\u88c5\u3011\u542f\u52a8 cri-dockerd",id:"464-\u4ec5\u6e90\u7801\u5b89\u88c5\u542f\u52a8-cri-dockerd",level:4},{value:"\u4e94\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u5b89\u88c5 kubeadm\u3001kubelet \u548c kubectl",id:"\u4e94\u6240\u6709\u8282\u70b9\u5b89\u88c5-kubeadmkubelet-\u548c-kubectl",level:2},{value:"5.1 \u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a MAC \u5730\u5740\u548c product_uuid \u7684\u552f\u4e00\u6027",id:"51-\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a-mac-\u5730\u5740\u548c-product_uuid-\u7684\u552f\u4e00\u6027",level:3},{value:"5.2 \u6dfb\u52a0 Kubernetes \u7684 yum \u4ed3\u5e93",id:"52-\u6dfb\u52a0-kubernetes-\u7684-yum-\u4ed3\u5e93",level:3},{value:"5.3 \u3010\u5728\u7ebf\u3011\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl",id:"53-\u5728\u7ebf\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl",level:3},{value:"5.3 \u3010\u79bb\u7ebf\u3011\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl",id:"53-\u79bb\u7ebf\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl",level:3},{value:"5.4 \u4e0b\u8f7dK8s\u4f9d\u8d56\u955c\u50cf",id:"54-\u4e0b\u8f7dk8s\u4f9d\u8d56\u955c\u50cf",level:3},{value:"\u516d\u3001\u3010\u4ec5Master\u8282\u70b9\u3011\u5b89\u88c5HAProxy Keepalived",id:"\u516d\u4ec5master\u8282\u70b9\u5b89\u88c5haproxy-keepalived",level:2},{value:"6.1 \u5f00\u653e\u7aef\u53e3",id:"61-\u5f00\u653e\u7aef\u53e3",level:3},{value:"6.2 \u3010\u5728\u7ebf\u3011\u5b89\u88c5Keepalived HAProxy",id:"62-\u5728\u7ebf\u5b89\u88c5keepalived-haproxy",level:3},{value:"6.2 \u3010\u79bb\u7ebf\u3011\u5b89\u88c5Keepalived HAProxy",id:"62-\u79bb\u7ebf\u5b89\u88c5keepalived-haproxy",level:3},{value:"6.3 \u914d\u7f6eHAProxy",id:"63-\u914d\u7f6ehaproxy",level:3},{value:"6.4 \u914d\u7f6eKeepalived",id:"64-\u914d\u7f6ekeepalived",level:3},{value:"6.4.1 <code>192.168.137.121</code>\u4f5c\u4e3aVIP\u7684\u4e3b\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",id:"641-192168137121\u4f5c\u4e3avip\u7684\u4e3b\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",level:4},{value:"6.4.2 <code>192.168.137.122</code>\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",id:"642-192168137122\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",level:4},{value:"6.4.3 <code>192.168.137.123</code>\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",id:"643-192168137123\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",level:4},{value:"6.5 \u542f\u52a8Keepalived HAProxy",id:"65-\u542f\u52a8keepalived-haproxy",level:3},{value:"\u4e03\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc",id:"\u4e03\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc",level:2},{value:"7.1 \u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9",id:"71-\u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9",level:3},{value:"7.2 \u914d\u7f6eMaster\u8282\u70b9",id:"72-\u914d\u7f6emaster\u8282\u70b9",level:3},{value:"\u516b\u3001\u3010\u5176\u4ed6Master\u8282\u70b9\u3011Master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",id:"\u516b\u5176\u4ed6master\u8282\u70b9master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",level:2},{value:"8.1 \u8282\u70b9\u521d\u59cb\u5316",id:"81-\u8282\u70b9\u521d\u59cb\u5316",level:3},{value:"8.2 \u73af\u5883\u68c0\u67e5",id:"82-\u73af\u5883\u68c0\u67e5",level:3},{value:"8.3 \u52a0\u5165Master\u8282\u70b9",id:"83-\u52a0\u5165master\u8282\u70b9",level:3},{value:"8.3.1 \u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684Token",id:"831-\u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684token",level:4},{value:"8.3.2 \u521d\u59cb\u5316Master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230 etcd \u4e2d",id:"832-\u521d\u59cb\u5316master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230-etcd-\u4e2d",level:4},{value:"8.3.3 \u52a0\u5165\u65b0\u7684Master\u8282\u70b9",id:"833-\u52a0\u5165\u65b0\u7684master\u8282\u70b9",level:4},{value:"8.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",id:"84-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",level:3},{value:"\u4e5d\u3001\u3010\u6240\u6709Node\u8282\u70b9\u3011Node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",id:"\u4e5d\u6240\u6709node\u8282\u70b9node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",level:2},{value:"9.1 Node\u8282\u70b9\u521d\u59cb\u5316",id:"91-node\u8282\u70b9\u521d\u59cb\u5316",level:3},{value:"9.2 \u73af\u5883\u68c0\u67e5",id:"92-\u73af\u5883\u68c0\u67e5",level:3},{value:"9.3 \u52a0\u5165Node\u8282\u70b9",id:"93-\u52a0\u5165node\u8282\u70b9",level:3},{value:"9.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",id:"94-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",level:3},{value:"\u5341\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f",id:"\u5341\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f",level:2},{value:"10.1 \u5f00\u653e\u7aef\u53e3(calico)",id:"101-\u5f00\u653e\u7aef\u53e3calico",level:3},{value:"10.2 \u5b89\u88c5Calico\u7f51\u7edc\u670d\u52a1",id:"102-\u5b89\u88c5calico\u7f51\u7edc\u670d\u52a1",level:3},{value:"10.3 \u68c0\u67e5\u8282\u70b9\u72b6\u6001",id:"103-\u68c0\u67e5\u8282\u70b9\u72b6\u6001",level:3},{value:"10.4 \u68c0\u67e5CoreDNS\u662f\u5426\u6b63\u5e38",id:"104-\u68c0\u67e5coredns\u662f\u5426\u6b63\u5e38",level:3},{value:"10.5 \u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb",id:"105-\u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb",level:3},{value:"10.6 \u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\uff0c\u65b9\u4fbf\u7ba1\u7406",id:"106-\u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\u65b9\u4fbf\u7ba1\u7406",level:3},{value:"\u5341\u4e00\u3001\u5b89\u88c5Dashboard",id:"\u5341\u4e00\u5b89\u88c5dashboard",level:2},{value:"11.1 Helm\u5b89\u88c5",id:"111-helm\u5b89\u88c5",level:3},{value:"11.2 \u3010\u4ec5\u5728\u7ebf\u3011\u914d\u7f6eDashboard\u4ed3\u5e93\u5e76\u62c9\u53d6\u9ed8\u8ba4\u914d\u7f6e",id:"112-\u4ec5\u5728\u7ebf\u914d\u7f6edashboard\u4ed3\u5e93\u5e76\u62c9\u53d6\u9ed8\u8ba4\u914d\u7f6e",level:3},{value:"11.3 \u4fee\u6539Dashboard\u914d\u7f6e\u5e76\u5b89\u88c5",id:"113-\u4fee\u6539dashboard\u914d\u7f6e\u5e76\u5b89\u88c5",level:3},{value:"11.4 \u521b\u5efaToken",id:"114-\u521b\u5efatoken",level:3},{value:"11.5 \u8bbf\u95eeDashboard",id:"115-\u8bbf\u95eedashboard",level:3},{value:"11.6 \u5220\u9664Dashboard",id:"116-\u5220\u9664dashboard",level:3},{value:"\u5341\u4e8c\u3001\u5e38\u7528\u547d\u4ee4",id:"\u5341\u4e8c\u5e38\u7528\u547d\u4ee4",level:2},{value:"\u521d\u59cb\u5316\u5e38\u7528",id:"\u521d\u59cb\u5316\u5e38\u7528",level:3},{value:"12.1 \u57fa\u7840\u64cd\u4f5c\u547d\u4ee4",id:"121-\u57fa\u7840\u64cd\u4f5c\u547d\u4ee4",level:3},{value:"12.2 \u8d44\u6e90\u76f8\u5173",id:"122-\u8d44\u6e90\u76f8\u5173",level:3},{value:"12.3 \u96c6\u7fa4\u76f8\u5173",id:"123-\u96c6\u7fa4\u76f8\u5173",level:3},{value:"12.4 Daemonsets \u76f8\u5173",id:"124-daemonsets-\u76f8\u5173",level:3},{value:"12.5 Deployments\u76f8\u5173",id:"125-deployments\u76f8\u5173",level:3},{value:"12.6 \u4e8b\u4ef6\u76f8\u5173",id:"126-\u4e8b\u4ef6\u76f8\u5173",level:3},{value:"12.7 \u65e5\u5fd7\u76f8\u5173",id:"127-\u65e5\u5fd7\u76f8\u5173",level:3},{value:"12.8 Namespace \u76f8\u5173",id:"128-namespace-\u76f8\u5173",level:3},{value:"12.9 Nodes \u76f8\u5173",id:"129-nodes-\u76f8\u5173",level:3},{value:"12.10 Pods \u64cd\u4f5c\u76f8\u5173",id:"1210-pods-\u64cd\u4f5c\u76f8\u5173",level:3},{value:"12.11 Replication Controller \u76f8\u5173",id:"1211-replication-controller-\u76f8\u5173",level:3},{value:"12.12 ReplicaSets \u76f8\u5173",id:"1212-replicasets-\u76f8\u5173",level:3},{value:"12.13 Sercrets \u76f8\u5173",id:"1213-sercrets-\u76f8\u5173",level:3},{value:"12.14 Services \u76f8\u5173",id:"1214-services-\u76f8\u5173",level:3},{value:"12.15 Service Account\u76f8\u5173",id:"1215-service-account\u76f8\u5173",level:3},{value:"12.16 StatefulSets \u76f8\u5173",id:"1216-statefulsets-\u76f8\u5173",level:3},{value:"12.17 \u5e38\u7528\u53c2\u6570",id:"1217-\u5e38\u7528\u53c2\u6570",level:3},{value:"12.18 \u6ce8\u610f\u4e8b\u9879",id:"1218-\u6ce8\u610f\u4e8b\u9879",level:3},{value:"\u5341\u4e09\u3001K8s\u7f51\u7edc\u8bbe\u8ba1",id:"\u5341\u4e09k8s\u7f51\u7edc\u8bbe\u8ba1",level:2},{value:"1. K8s \u7f51\u7edc\u7684\u6838\u5fc3\u9700\u6c42",id:"1-k8s-\u7f51\u7edc\u7684\u6838\u5fc3\u9700\u6c42",level:3},{value:"2. K8s \u7f51\u7edc\u6a21\u578b\u8bbe\u8ba1",id:"2-k8s-\u7f51\u7edc\u6a21\u578b\u8bbe\u8ba1",level:3},{value:"1. <strong>Pod \u7f51\u7edc</strong>",id:"1-pod-\u7f51\u7edc",level:4},{value:"2. <strong>Service \u7f51\u7edc</strong>",id:"2-service-\u7f51\u7edc",level:4},{value:"3. <strong>\u7f51\u7edc\u63d2\u4ef6\uff08CNI\uff09</strong>",id:"3-\u7f51\u7edc\u63d2\u4ef6cni",level:4},{value:"4. <strong>\u7f51\u7edc\u7b56\u7565\uff08NetworkPolicy\uff09</strong>",id:"4-\u7f51\u7edc\u7b56\u7565networkpolicy",level:4},{value:"3. \u5173\u952e\u7ec4\u4ef6\u8be6\u89e3",id:"3-\u5173\u952e\u7ec4\u4ef6\u8be6\u89e3",level:3},{value:"1. <strong>kube-proxy</strong>",id:"1-kube-proxy",level:4},{value:"2. <strong>CoreDNS</strong>",id:"2-coredns",level:4},{value:"3. <strong>Ingress Controller</strong>",id:"3-ingress-controller",level:4},{value:"4. \u7f51\u7edc\u901a\u4fe1\u793a\u4f8b",id:"4-\u7f51\u7edc\u901a\u4fe1\u793a\u4f8b",level:3},{value:"1. <strong>Pod A \u2192 Pod B</strong>",id:"1-pod-a--pod-b",level:4},{value:"2. <strong>Pod A \u2192 Service S</strong>",id:"2-pod-a--service-s",level:4},{value:"3. <strong>\u5916\u90e8\u8bbf\u95ee Service S</strong>",id:"3-\u5916\u90e8\u8bbf\u95ee-service-s",level:4},{value:"5. \u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5",id:"5-\u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5",level:3},{value:"6. \u603b\u7ed3",id:"6-\u603b\u7ed3",level:3},{value:"\u5341\u56db\u3001\u95ee\u9898",id:"\u5341\u56db\u95ee\u9898",level:2},{value:"1. \u52a0\u5165\u65b0\u7684Master\u8282\u70b9\u65f6\u62a5\u9519 <code>cluster that doesn&#39;t have a stable controlPlaneEndpoint address</code>",id:"1-\u52a0\u5165\u65b0\u7684master\u8282\u70b9\u65f6\u62a5\u9519-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address",level:3},{value:"\u89e3\u51b3",id:"\u89e3\u51b3",level:4},{value:"2. Calico \u670d\u52a1\u8fd0\u884c\u5f02\u5e38",id:"2-calico-\u670d\u52a1\u8fd0\u884c\u5f02\u5e38",level:3},{value:"\u89e3\u51b3",id:"\u89e3\u51b3-1",level:4},{value:"3. Dashboard\u8bbf\u95ee\u5f02\u5e38",id:"3-dashboard\u8bbf\u95ee\u5f02\u5e38",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h2,{id:"\u4e00\u76f8\u5173\u94fe\u63a5",children:"\u4e00\u3001\u76f8\u5173\u94fe\u63a5"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/",children:"Kubernetes\u751f\u4ea7\u73af\u5883\u5b89\u88c5\u6ce8\u610f\u4e8b\u9879"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/",children:"Kubernetes \u5bb9\u5668\u8fd0\u884c\u65f6"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/",children:"\u4f7f\u7528 kubeadm \u5f15\u5bfc\u96c6\u7fa4"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://docs.docker.com/engine/install/#server",children:"Docker \u5bb9\u5668\u8fd0\u884c\u65f6\u5b89\u88c5"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://download.docker.com/linux/centos/8/x86_64/stable/Packages/",children:"Docker rpm\u5b89\u88c5\u5305\u4e0b\u8f7d"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://mirantis.github.io/cri-dockerd/usage/install/",children:"\u5b89\u88c5CRI-Dockerd"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/",children:"Kubernetes\u8fd0\u884c\u5fc5\u8981\u7684\u7aef\u53e3"})}),"\n",(0,d.jsx)(n.li,{}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/releases/download/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.30.md#v13011",children:"Kubernetes\u66f4\u65b0\u5386\u53f2"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.downloadkubernetes.com/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/",children:"\u5728 Linux \u7cfb\u7edf\u4e2d\u5b89\u88c5\u5e76\u8bbe\u7f6e kubectl"})}),"\n",(0,d.jsx)(n.li,{}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://github.com/helm/helm/releases",children:"\u5f00\u6e90\u9879\u76ee Helm \u7528\u4e8e\u5b89\u88c5Dashbaord"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://github.com/kube-vip/kube-vip",children:"\u5f00\u6e90\u9879\u76ee kube-vip \u63a7\u5236\u9762\u865a\u62dfIP"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://github.com/cloudnativer/kube-install",children:"\u5f00\u6e90\u9879\u76ee kube-install \u79bb\u7ebf\u5b89\u88c5K8s"})}),"\n",(0,d.jsx)(n.li,{}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://cloud.tencent.com/developer/article/2505531",children:"Kubernetes(k8s)-\u9ad8\u53ef\u7528\u96c6\u7fa4\u90e8\u7f72v1.32.2(\u751f\u4ea7\u53ef\u7528)"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://blog.csdn.net/tonyhi6/article/details/139019297",children:"Centos8.5 \u57fa\u4e8e k8s v1.30.1 \u90e8\u7f72\u9ad8\u53ef\u7528\u96c6\u7fa4"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://blog.csdn.net/qq_33342132/article/details/135751063",children:"\u5728\u5df2\u6709\u7684\u9ad8\u53ef\u7528kubernetes/k8s\u96c6\u7fa4\u4e2d\u6dfb\u52a0master\u8282\u70b9"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://bbs.huaweicloud.com/blogs/368244",children:"k8s \u96c6\u7fa4\u6dfb\u52a0Master\u548cnode\u8282\u70b9"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://blog.csdn.net/Lfwthotpt/article/details/105892926",children:"\u7406\u8bba+\u5b9e\u64cd\uff1ak8s\u5355\u8282\u70b9\u96c6\u7fa4\u52a0\u5165master\u8282\u70b9"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://blog.csdn.net/qq_42895490/article/details/139564373",children:"k8s v1.30.1 \u9ad8\u53ef\u7528\u7248\u672c\u642d\u5efa"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/524772977",children:"Kubernetes \u7f51\u7edc\u63d2\u4ef6 Calico \u5b8c\u5168\u8fd0\u7ef4\u6307\u5357"})}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u4e8c\u73af\u5883\u4ecb\u7ecd",children:"\u4e8c\u3001\u73af\u5883\u4ecb\u7ecd"}),"\n",(0,d.jsx)(n.h3,{id:"21-\u8f6f\u4ef6\u7248\u672c",children:"2.1 \u8f6f\u4ef6\u7248\u672c"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7248\u672c"}),(0,d.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u64cd\u4f5c\u7cfb\u7edf"}),(0,d.jsx)(n.td,{children:"CentOS 8.5"}),(0,d.jsx)(n.td,{children:"\u5185\u6838\u7248\u672c 4.18.0-348.7.1.el8_5.x86_64"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Kubernates"}),(0,d.jsx)(n.td,{children:"1.30.11"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u5bb9\u5668\u8fd0\u884c\u65f6"}),(0,d.jsx)(n.td,{children:"Docker-CE-26.1.3-1"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"K8s\u7f51\u7edc\u7ec4\u4ef6"}),(0,d.jsx)(n.td,{children:"Calico-v3.25"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Helm"}),(0,d.jsx)(n.td,{children:"helm-v3.17.2"}),(0,d.jsx)(n.td,{children:"\u7528\u4e8e\u5b89\u88c5Dashboard"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"K8s Dashbaord"}),(0,d.jsx)(n.td,{children:"kubernetes-dashboard-7.7.0"}),(0,d.jsx)(n.td,{})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"22-\u670d\u52a1\u5668\u89c4\u5212",children:"2.2 \u670d\u52a1\u5668\u89c4\u5212"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u7f51\u7edc\u4fe1\u606f\nip a\n\n# \u67e5\u770bMAC\u5730\u5740\nip link | grep link/ether\n\n# \u67e5\u770b product_uuid\nsudo cat /sys/class/dmi/id/product_uuid\n\n"})}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u64cd\u4f5c\u7cfb\u7edf"}),(0,d.jsx)(n.th,{children:"\u5185\u5b58"}),(0,d.jsx)(n.th,{children:"\u4e3b\u673a\u540d"}),(0,d.jsx)(n.th,{children:"IP"}),(0,d.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cent OS 8.5"}),(0,d.jsx)(n.td,{children:"4G"}),(0,d.jsx)(n.td,{children:"k8s-master-01"}),(0,d.jsx)(n.td,{children:"192.168.137.121"}),(0,d.jsx)(n.td,{children:"Master"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cent OS 8.5"}),(0,d.jsx)(n.td,{children:"4G"}),(0,d.jsx)(n.td,{children:"k8s-master-02"}),(0,d.jsx)(n.td,{children:"192.168.137.122"}),(0,d.jsx)(n.td,{children:"Master"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cent OS 8.5"}),(0,d.jsx)(n.td,{children:"4G"}),(0,d.jsx)(n.td,{children:"k8s-master-03"}),(0,d.jsx)(n.td,{children:"192.168.137.123"}),(0,d.jsx)(n.td,{children:"Master"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cent OS 8.5"}),(0,d.jsx)(n.td,{children:"4G"}),(0,d.jsx)(n.td,{children:"k8s-node-01"}),(0,d.jsx)(n.td,{children:"192.168.137.131"}),(0,d.jsx)(n.td,{children:"Node"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cent OS 8.5"}),(0,d.jsx)(n.td,{children:"4G"}),(0,d.jsx)(n.td,{children:"k8s-node-02"}),(0,d.jsx)(n.td,{children:"192.168.137.132"}),(0,d.jsx)(n.td,{children:"Node"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cent OS 8.5"}),(0,d.jsx)(n.td,{children:"4G"}),(0,d.jsx)(n.td,{children:"k8s-node-03"}),(0,d.jsx)(n.td,{children:"192.168.137.133"}),(0,d.jsx)(n.td,{children:"Node"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"-"}),(0,d.jsx)(n.td,{children:"-"}),(0,d.jsx)(n.td,{children:"vip"}),(0,d.jsx)(n.td,{children:"192.168.137.140"}),(0,d.jsx)(n.td,{children:"\u865a\u62dfIP\uff0c\u65e0\u5b9e\u4f53"})]})]})]}),"\n",(0,d.jsx)(n.h2,{id:"\u4e09\u6240\u6709\u8282\u70b9\u51c6\u5907\u5de5\u4f5c",children:"\u4e09\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u51c6\u5907\u5de5\u4f5c"}),"\n",(0,d.jsx)(n.h3,{id:"31-\u521b\u5efa\u64cd\u4f5c\u7528\u6237",children:"3.1 \u521b\u5efa\u64cd\u4f5c\u7528\u6237"}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u679c\u6ca1\u6709\u4e13\u95e8\u7684\u64cd\u4f5c\u7528\u6237\uff0c\u53ef\u4ee5\u6309\u4e0b\u9762\u7684\u64cd\u4f5c\u521b\u5efa\u65b0\u7684\u7528\u6237\uff0c\u540e\u7eed\u64cd\u4f5c\u5747\u4f7f\u7528\u6b64\u65b0\u7528\u6237\u6765\u6267\u884c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# 1. \u521b\u5efa\u7528\u6237\nsudo useradd -m diginn\n\n# 2. \u8bbe\u7f6e\u5bc6\u7801\nsudo passwd diginn\n\n# 3. \u8d4b\u4e88root\u6743\u9650\nsudo visudo\n# \u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\ndiginn   ALL=(ALL)   ALL\n\n# 4. \u6d4b\u8bd5\u6743\u9650\nsu - diginn\nsudo whoami\n\n# \u663e\u793a root \u5373\u8868\u793adiginn\u7528\u6237\u6709 sudo \u6743\u9650\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"32-\u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a",children:"3.2 \u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u4e34\u65f6\u7981\u7528\nsudo swapoff -a\n# \u6c38\u4e45\u7981\u7528\nsudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab\n\n# \u67e5\u770bswap\u5206\u533a\nswapon --show\n"})}),"\n",(0,d.jsx)(n.h3,{id:"33-\u7981\u7528-selinux",children:"3.3 \u7981\u7528 SELinux"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u4e34\u65f6\u7981\u7528\nsudo setenforce 0\n# \u6c38\u4e45\u7981\u7528\nsudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n\n# \u68c0\u67e5SELinux\u72b6\u6001\nsestatus\ngetenforce\n"})}),"\n",(0,d.jsx)(n.h3,{id:"34-\u914d\u7f6e\u5185\u6838\u53c2\u6570",children:"3.4 \u914d\u7f6e\u5185\u6838\u53c2\u6570"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u7acb\u5373\u751f\u6548\nsudo modprobe ip_vs\nsudo modprobe ip_vs_rr\nsudo modprobe ip_vs_sh\nsudo modprobe ip_vs_wrr\nsudo modprobe nf_conntrack\nsudo modprobe br_netfilter\nsudo modprobe overlay\nsudo modprobe nf_nat\nsudo modprobe xt_conntrack\nsudo modprobe veth  \nsudo modprobe ip_tables\nsudo modprobe ip6_tables\nsudo modprobe nf_defrag_ipv6\nsudo modprobe ebtables\nsudo modprobe dummy\nsudo modprobe xt_set\n\n# \u914d\u7f6e\u542f\u52a8\u8bb0\u8f7d\ncat <<EOF | sudo tee -a /etc/modules\nip_vs\nip_vs_rr\nip_vs_sh\nip_vs_wrr\nnf_conntrack\nbr_netfilter\noverlay\nnf_nat\nxt_conntrack\nveth\nip_tables\nip6_tables\nnf_defrag_ipv6\nebtables\ndummy\nxt_set\nEOF\n\n# \u9a8c\u8bc1\u662f\u5426\u52a0\u8f7d\u6210\u529f\nlsmod | grep -E "ip_vs|nf_conntrack|br_netfilter|overlay|nf_nat|xt_conntrack|veth|ip_tables|ip6_tables|nf_defrag_ipv6|ebtables|dummy|xt_set"\n\n'})}),"\n",(0,d.jsx)(n.h3,{id:"35-\u914d\u7f6e\u7f51\u7edc\u53c2\u6570",children:"3.5 \u914d\u7f6e\u7f51\u7edc\u53c2\u6570"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n\n# \u5e94\u7528 sysctl \u53c2\u6570\u800c\u4e0d\u91cd\u65b0\u542f\u52a8\nsudo sysctl --system\n\n# \u9a8c\u8bc1\nsudo sysctl net.ipv4.ip_forward\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"36-\u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts",children:"3.6 \u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# master\u4e3b\u673a\nsudo hostnamectl  set-hostname  k8s-master-01\nsudo hostnamectl  set-hostname  k8s-master-02\nsudo hostnamectl  set-hostname  k8s-master-03\n# node\u4e3b\u673a\nsudo hostnamectl  set-hostname  k8s-node-01\nsudo hostnamectl  set-hostname  k8s-node-02\nsudo hostnamectl  set-hostname  k8s-node-03\n\n\n# \u4fee\u6539/etc/hosts\u5185\u5bb9\uff08\u96c6\u7fa4\u5185\u6bcf\u4e00\u4e2a\u4e3b\u673a\u90fd\u8981\u914d\u7f6e\uff09\ncat <<EOF | sudo tee -a /etc/hosts\n\n192.168.137.121   k8s-master-01\n192.168.137.122   k8s-master-02\n192.168.137.123   k8s-master-03\n\n192.168.137.131   k8s-node-01\n192.168.137.132   k8s-node-02\n192.168.137.133   k8s-node-03\nEOF\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"37-\u8bbe\u7f6e\u65f6\u533a",children:"3.7 \u8bbe\u7f6e\u65f6\u533a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u65f6\u533a\ntimedatectl\n\n# \u67e5\u770b\u6240\u6709\u53ef\u7528\u65f6\u533a\ntimedatectl list-timezones\n\n# \u8bbe\u7f6e\u4e3a\u4e0a\u6d77\u65f6\u533a\nsudo timedatectl set-timezone Asia/Shanghai\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"38-\u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u5728k8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c",children:"3.8 \u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\uff0c\u5728K8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c"}),"\n",(0,d.jsx)(n.p,{children:"\u7531\u4e8e\u5404\u4e2a\u7ec4\u4ef6\u4e4b\u95f4\u901a\u8baf\u903b\u8f91\u5341\u5206\u590d\u6742\uff0c\u4e14\u4e0d\u540c\u7248\u672c\u4e4b\u95f4\u7684\u7f51\u7edc\u89c4\u5219\u8fd8\u5b58\u5728\u533a\u522b\uff0c\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u5efa\u8bae\u5728\u4e0d\u80fd\u5173\u95ed\u9632\u706b\u5899\u7684\u60c5\u51b5\u4e0b\u914d\u7f6e\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c\uff0c"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.strong,{children:"\u5982\u679c\u6309\u6b64\u5904\u914d\u7f6e\uff0c\u540e\u7eed\u5173\u4e8e\u5f00\u653e\u7f51\u7edc\u7aef\u53e3\u7684\u547d\u4ee4\u90fd\u53ef\u4ee5\u8df3\u8fc7\u3002"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u5728\u9632\u706b\u5899\u4e2d\u542f\u7528 Masquerade\uff08NAT\uff09\nsudo firewall-cmd --permanent --zone=public --add-masquerade\n\n# K8s\u7684Master \u8282\u70b9\u53caNode\u8282\u70b9\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.121/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.122/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.123/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.131/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.132/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.133/32" accept\'\n\n# Service \u7f51\u7edc\u53ca Pod\u7f51\u7edc\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="10.244.0.0/16" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="10.96.0.0/12" accept\'\n\n# \u5141\u8bb8 Pod \u7f51\u6bb5\u5230\u7f51\u5173 DNS\uff08192.168.137.1\uff09\u7684 UDP 53 \u6d41\u91cf\n# \u5982\u679c\u662f\u5728\u865a\u62df\u673a\u90e8\u7f72\uff0c\u8fd9\u91cc\u662f\u7269\u7406\u673a\u7684ip\uff0c\u540c\u65f6\u6ce8\u610f\u7269\u7406\u673a\u5173\u95ed\u9632\u706b\u5899\uff0c\u907f\u514dpod\u7f51\u7edcdns\u8bf7\u6c42\u62a5\u9519\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family=ipv4 source address=10.244.0.0/16 destination address=192.168.137.1/32 port port=53 protocol=udp accept\'\n\n# \u5141\u8bb8 Pod \u7f51\u6bb5\u5230\u5916\u90e8 DNS\uff08\u5982 8.8.8.8\uff09\u7684 UDP 53 \u6d41\u91cf\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family=ipv4 source address=10.244.0.0/16 destination address=8.8.8.8/32 port port=53 protocol=udp accept\'\n\n# \u3010Calico\u3011 IP-in-IP \u9700\u8981\u5f00\u653e\u534f\u8bae\u53f7\u4e3a4\u7684\u6d41\u91cf\nsudo firewall-cmd --permanent --add-rich-rule=\'rule protocol value="4" accept\'\n\n\n# \u3010Keepalived\u3011\u6dfb\u52a0\u6c38\u4e45\u89c4\u5219\u5141\u8bb8VRRP\u534f\u8bae\nsudo firewall-cmd --permanent --add-protocol=vrrp\n# \u3010Keepalived\u3011\u82e5\u4e0a\u8ff0\u547d\u4ee4\u62a5\u9519\uff08\u534f\u8bae\u540d\u79f0\u4e0d\u652f\u6301\uff09\uff0c\u6539\u7528\u5bcc\u89c4\u5219\u6307\u5b9a\u534f\u8bae\u53f7\nsudo firewall-cmd --permanent --add-rich-rule=\'rule protocol value="112" accept\'\n\n# \u3010Keepalived\u3011VRRP\u9ed8\u8ba4\u4f7f\u7528\u7ec4\u64ad\u5730\u5740224.0.0.18\u3002\u5141\u8bb8\u76f8\u5173\u7ec4\u64ad\u901a\u4fe1\nsudo firewall-cmd --permanent --add-rich-rule=\'rule family="ipv4" source address="224.0.0.18/32" accept\'\n\n# \u91cd\u65b0\u52a0\u8f7d\u9632\u706b\u5899\u89c4\u5219\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u89c4\u5219\nsudo firewall-cmd --list-all --zone=public\n\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u67e5\u770b\u89c4\u5219\u7684\u8f93\u51fa\u793a\u4f8b\u5982\u4e0b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'[diginn@k8s-master-01 ~]$ sudo firewall-cmd --list-all --zone=public\npublic (active)\n  target: default\n  icmp-block-inversion: no\n  interfaces: enp0s3\n  sources:\n  services: cockpit dhcpv6-client ssh\n  ports:\n  protocols: vrrp\n  forward: no\n  masquerade: yes\n  forward-ports:\n  source-ports:\n  icmp-blocks:\n  rich rules:\n        rule family="ipv4" source address="192.168.137.131/32" accept\n        rule family="ipv4" source address="192.168.137.133/32" accept\n        rule family="ipv4" source address="192.168.137.121/32" accept\n        rule family="ipv4" source address="10.244.0.0/16" destination address="192.168.137.1/32" port port="53" protocol="udp" accept\n        rule family="ipv4" source address="10.244.0.0/16" destination address="8.8.8.8/32" port port="53" protocol="udp" accept\n        rule protocol value="4" accept\n        rule family="ipv4" source address="192.168.137.132/32" accept\n        rule protocol value="112" accept\n        rule family="ipv4" source address="192.168.137.122/32" accept\n        rule family="ipv4" source address="224.0.0.18/32" accept\n        rule family="ipv4" source address="192.168.137.123/32" accept\n        rule family="ipv4" source address="10.96.0.0/12" accept\n        rule family="ipv4" source address="10.244.0.0/16" accept\n\n'})}),"\n",(0,d.jsx)(n.h3,{id:"39-\u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219",children:"3.9 \u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/",children:"Kubernates\u8fd0\u884c\u5fc5\u8981\u7684\u7aef\u53e3"})}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u7ecf\u5b9e\u9645\u591a\u6b21\u6d4b\u8bd5\uff0c\u8fd9\u4e2a\u63a5\u53e3\u5217\u8868\u7f3a\u5c11\u5f88\u591a\u7aef\u53e3\uff0c\u4ec5kubernetes\u6838\u5fc3\u7684\u7aef\u53e3\uff0c\u4e00\u4e9b\u5fc5\u8981\u7684\u7ec4\u4ef6\u7aef\u53e3\u5e76\u6ca1\u6709\u5217\u51fa\u6765\uff0c\u540c\u4e00\u7ec4\u4ef6\u5728\u4e0d\u540c\u5de5\u4f5c\u6a21\u5f0f\u4e0b\u7684\u89c4\u5219\u8fd8\u4e0d\u76f8\u540c\uff0c\u5efa\u8bae\u7b2c\u4e00\u6b21\u90e8\u7f72\u65f6\u5173\u95ed\u9632\u706b\u5899\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u63a7\u5236\u9762"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u534f\u8bae"}),(0,d.jsx)(n.th,{children:"\u65b9\u5411"}),(0,d.jsx)(n.th,{children:"\u7aef\u53e3\u8303\u56f4"}),(0,d.jsx)(n.th,{children:"\u76ee\u7684"}),(0,d.jsx)(n.th,{children:"\u4f7f\u7528\u8005"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"6443"}),(0,d.jsx)(n.td,{children:"Kubernetes API \u670d\u52a1\u5668"}),(0,d.jsx)(n.td,{children:"\u6240\u6709"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"2379-2380"}),(0,d.jsx)(n.td,{children:"etcd \u670d\u52a1\u5668\u5ba2\u6237\u7aef API"}),(0,d.jsx)(n.td,{children:"kube-apiserver\u3001etcd"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"10250"}),(0,d.jsx)(n.td,{children:"kubelet API"}),(0,d.jsx)(n.td,{children:"\u81ea\u8eab\u3001\u63a7\u5236\u9762"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"10259"}),(0,d.jsx)(n.td,{children:"kube-scheduler"}),(0,d.jsx)(n.td,{children:"\u81ea\u8eab"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"10257"}),(0,d.jsx)(n.td,{children:"kube-controller-manager"}),(0,d.jsx)(n.td,{children:"\u81ea\u8eab"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u5de5\u4f5c\u8282\u70b9"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u534f\u8bae"}),(0,d.jsx)(n.th,{children:"\u65b9\u5411"}),(0,d.jsx)(n.th,{children:"\u7aef\u53e3\u8303\u56f4"}),(0,d.jsx)(n.th,{children:"\u76ee\u7684"}),(0,d.jsx)(n.th,{children:"\u4f7f\u7528\u8005"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"10250"}),(0,d.jsx)(n.td,{children:"kubelet API"}),(0,d.jsx)(n.td,{children:"\u81ea\u8eab\u3001\u63a7\u5236\u9762"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"10256"}),(0,d.jsx)(n.td,{children:"kube-proxy"}),(0,d.jsx)(n.td,{children:"\u81ea\u8eab\u3001\u8d1f\u8f7d\u5747\u8861\u5668"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TCP"}),(0,d.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,d.jsx)(n.td,{children:"30000-32767"}),(0,d.jsx)(n.td,{children:"NodePort Services\u2020"}),(0,d.jsx)(n.td,{children:"\u6240\u6709"})]})]})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5173\u95ed\u9632\u706b\u5899\uff08\u4e0d\u63a8\u8350\uff09\nsudo systemctl stop firewalld\nsudo systemctl disable firewalld\n\n## \u6253\u5f00\u7aef\u53e3\nsudo firewall-cmd --permanent --zone=public --add-port=6443/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=2379-2380/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10250/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10256/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10257/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10259/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=30000-32767/tcp\n\n# HTTP HTTPS\nsudo firewall-cmd --permanent --add-port=80/tcp\nsudo firewall-cmd --permanent --add-port=443/tcp\n\n# CoreDNS\nsudo firewall-cmd --permanent --add-port=53/tcp\nsudo firewall-cmd --permanent --add-port=53/udp\nsudo firewall-cmd --permanent --add-port=9153/udp\n\n# DHCP\nsudo firewall-cmd --permanent --add-port=67/udp\nsudo firewall-cmd --permanent --add-port=68/udp\n\n# ETCD\nsudo firewall-cmd --permanent --add-port=6666/tcp\nsudo firewall-cmd --permanent --add-port=6667/tcp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-port\n\n# \u67e5\u770b\u6240\u6709\u9632\u706b\u5899\u89c4\u5219\nsudo firewall-cmd --list-all\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u53ef\u4ee5\u7528 ",(0,d.jsx)(n.code,{children:"netcat"})," \u68c0\u67e5\u7aef\u53e3\u662f\u5426\u5f00\u653e"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5netcat\nsudo dnf install -y nc\n\nnc 127.0.0.1 6443 -zv -w 2\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"310-\u5728\u7ebf\u4f9d\u8d56\u9879\u5b89\u88c5",children:"3.10 \u3010\u5728\u7ebf\u3011\u4f9d\u8d56\u9879\u5b89\u88c5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"sudo dnf install -y vim wget tar unzip ebtables ethtool nc net-tools yum-utils iproute-tc ipset ipvsadm bash-completion\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"310-\u79bb\u7ebf\u4f9d\u8d56\u9879\u5b89\u88c5",children:"3.10 \u3010\u79bb\u7ebf\u3011\u4f9d\u8d56\u9879\u5b89\u88c5"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://mirrors.aliyun.com/centos/8.5.2111/BaseOS/x86_64/os/Packages/",children:"\u963f\u91cc\u4e91CentOS8\u955c\u50cf"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u9700\u8981\u672c\u5730\u51c6\u5907\u4e00\u53f0\u4e0e\u670d\u52a1\u5668\u7cfb\u7edf\u7248\u672c\u4e00\u81f4\u7684\u865a\u62df\u673a\uff0c\u5728\u865a\u62df\u673a\u4e0a\u4e0b\u8f7d\u5404\u79cd\u4f9d\u8d56\u5305"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# 1. \u9700\u8981\u5148\u5b89\u88c5 yum-utils \u6765\u4e0b\u8f7d\u5176\u4ed6\u7684\u4f9d\u8d56\ncurl https://mirrors.aliyun.com/centos/8.5.2111/BaseOS/x86_64/os/Packages/yum-utils-4.0.21-3.el8.noarch.rpm -o ./yum-utils-4.0.21-3.el8.noarch.rpm\nrpm -ivh yum-utils-4.0.21-3.el8.noarch.rpm\n\n# 2. \u672c\u5730\u865a\u62df\u673a\u4e0b\u8f7d\u4f9d\u8d56\nmkdir -p ~/k8s-install/lib/ && cd ~/k8s-install/\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/vim             vim\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/tar             tar\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/unzip           unzip\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/wget            wget\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/tree            tree\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/nc              nc\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/ebtables        ebtables\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/ethtool         ethtool\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/net-tools       net-tools\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/iproute-tc      iproute-tc\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/ipset           ipset\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/ipvsadm         ipvsadm\nyumdownloader --archlist=x86_64 --resolve --destdir=./lib/bash-completion bash-completion\n\n# HAProxy Keepalived Nginx \u5355\u72ec\u76ee\u5f55\nyumdownloader --archlist=x86_64 --resolve --destdir=./haproxy     haproxy\nyumdownloader --archlist=x86_64 --resolve --destdir=./keepalived  keepalived\nyumdownloader --archlist=x86_64 --resolve --destdir=./nginx       nginx\n\n# 3. \u6253\u5305\u4f9d\u8d56\u4e3a\u538b\u7f29\u5305\ntar -zcvf lib.tar.gz ./lib \n\n# 4. \u4e0b\u8f7d\u5b8c\u6210\u540e\u4f20\u8f93\u5230\u5185\u7f51\u673a\u5668\u4e0a\n\n# 5. \u5185\u7f51\u673a\u5b89\u88c5\u5b89\u88c5\nsudo rpm -ivh ./lib/vim/*.rpm\nsudo rpm -ivh ./lib/tar/*.rpm\nsudo rpm -ivh ./lib/unzip/*.rpm\nsudo rpm -ivh ./lib/wget/*.rpm\nsudo rpm -ivh ./lib/nc/*.rpm\nsudo rpm -ivh ./lib/ebtables/*.rpm\nsudo rpm -ivh ./lib/ethtool/*.rpm\nsudo rpm -ivh ./lib/net-tools/*.rpm\nsudo rpm -ivh ./lib/iproute-tc/*.rpm\nsudo rpm -ivh ./lib/ipset/*.rpm\nsudo rpm -ivh ./lib/ipvsadm/*.rpm\nsudo rpm -ivh ./lib/bash-completion/*.rpm\n\n"})}),"\n",(0,d.jsx)(n.h2,{id:"\u56db\u6240\u6709\u8282\u70b9docker\u5b89\u88c5\u914d\u7f6e\u5bb9\u5668\u8fd0\u884c\u65f6",children:"\u56db\u3001\u3010\u6240\u6709\u8282\u70b9\u3011Docker\u5b89\u88c5\u914d\u7f6e\uff08\u5bb9\u5668\u8fd0\u884c\u65f6\uff09"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://docs.docker.com/engine/install/centos/",children:"CentOS\u5b89\u88c5Docker"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://developer.aliyun.com/mirror/docker-ce",children:"\u963f\u91cc\u4e91Docker\u955c\u50cf"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://download.docker.com/linux/centos/8/x86_64/stable/Packages/",children:"Docker\u79bb\u7ebf\u5b89\u88c5\u5305\u4e0b\u8f7d"})}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"41-\u5378\u8f7d\u5df2\u6709docker-engine",children:"4.1 \u5378\u8f7d\u5df2\u6709Docker Engine"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"sudo dnf remove docker \\\n                docker-client \\\n                docker-client-latest \\\n                docker-common \\\n                docker-latest \\\n                docker-latest-logrotate \\\n                docker-logrotate \\\n                docker-engine\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"42-\u6dfb\u52a0docker-yum\u4ed3\u5e93",children:"4.2 \u6dfb\u52a0Docker yum\u4ed3\u5e93"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u6dfb\u52a0docker\u4ed3\u5e93\u6e90\nsudo dnf install -y dnf-plugins-core\nsudo dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\n\n# \u5982\u679c\u5b98\u65b9\u6e90\u4e0b\u8f7d\u901f\u5ea6\u6162\uff0c\u53ef\u4ee5\u4f7f\u7528\u963f\u91cc\u6e90\nsudo dnf config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n\n# \u67e5\u770bDocker\u6e90\ncat /etc/yum.repos.d/docker-ce.repo\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"43-\u5728\u7ebf\u5b89\u88c5docker",children:"4.3 \u3010\u5728\u7ebf\u3011\u5b89\u88c5Docker"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bDocker\u7684\u7248\u672c\nsudo dnf list docker-ce.x86_64 --showduplicates | sort -r\n\n# \u5b89\u88c5\u6700\u65b0\u7248\u672cDocker\nsudo dnf install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n\n# \u5b89\u88c5\u6307\u5b9a\u7248\u672c\u7684Docker\n# sudo dnf install docker-ce-3:26.1.3-1.el8 docker-ce-cli-1:26.1.3-1.el8 containerd.io docker-buildx-plugin docker-compose-plugin\n\n# \u8fd0\u884cDocker Engine\nsudo systemctl enable --now docker\n\n# \u5c06\u5f53\u524d\u7528\u6237\u52a0\u5165\u5230docker\u64cd\u4f5c\u7ec4 \u8bbe\u7f6e\u5b8c\u540e\u9700\u8981\u91cd\u65b0\u767b\u5f55\nsudo usermod -aG docker $USER\n\n# \u6d4b\u8bd5Docker\u662f\u5426\u5b89\u88c5\u6210\u529f\ndocker run hello-world\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"43-\u79bb\u7ebf\u5b89\u88c5docker",children:"4.3 \u3010\u79bb\u7ebf\u3011\u5b89\u88c5Docker"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"mkdir -p ~/k8s-install/docker/ && cd ~/k8s-install/\n\n# \u4e0b\u8f7d\u5b89\u88c5\u5305\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/containerd.io-1.6.9-3.1.el8.x86_64.rpm -o ./docker/containerd.io-1.6.9-3.1.el8.x86_64.rpm\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-buildx-plugin-0.14.0-1.el8.x86_64.rpm -o ./docker/docker-buildx-plugin-0.14.0-1.el8.x86_64.rpm\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-26.1.3-1.el8.x86_64.rpm -o ./docker/docker-ce-26.1.3-1.el8.x86_64.rpm\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-cli-26.1.3-1.el8.x86_64.rpm -o ./docker/docker-ce-cli-26.1.3-1.el8.x86_64.rpm\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-ce-rootless-extras-26.1.3-1.el8.x86_64.rpm -o ./docker/docker-ce-rootless-extras-26.1.3-1.el8.x86_64.rpm\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-compose-plugin-2.6.0-3.el8.x86_64.rpm -o ./docker/docker-compose-plugin-2.6.0-3.el8.x86_64.rpm\ncurl -sSLf https://download.docker.com/linux/centos/8/x86_64/stable/Packages/docker-scan-plugin-0.23.0-1.el8.x86_64.rpm -o ./docker/docker-scan-plugin-0.23.0-1.el8.x86_64.rpm\n\n\n# \u4e0b\u8f7d\u4f9d\u8d56\u5305\n\nyumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-ce              docker-ce \nyumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-ce-cli          docker-ce-cli\nyumdownloader --archlist=x86_64 --resolve --destdir=./docker/containerd             containerd.io\nyumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-buildx-plugin   docker-buildx-plugin\nyumdownloader --archlist=x86_64 --resolve --destdir=./docker/docker-compose-plugin  docker-compose-plugin\n\n\n# \u5b89\u88c5\u79bb\u7ebf\u5305\nsudo rpm -ivh ./docker/docker-ce/*.rpm\nsudo rpm -ivh ./docker/docker-ce-cli/*.rpm\nsudo rpm -ivh ./docker/containerd/*.rpm\nsudo rpm -ivh ./docker/docker-buildx-plugin/*.rpm\nsudo rpm -ivh ./docker/docker-compose-plugin/*.rpm\n\n# \u8fd0\u884cDocker Engine\nsudo systemctl enable --now docker\n\n# \u5c06\u5f53\u524d\u7528\u6237\u52a0\u5165\u5230docker\u64cd\u4f5c\u7ec4 \u8bbe\u7f6e\u5b8c\u540e\u9700\u8981\u91cd\u65b0\u767b\u5f55\nsudo usermod -aG docker $USER\n\n# \u6d4b\u8bd5Docker\u662f\u5426\u5b89\u88c5\u6210\u529f\ndocker run hello-world\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"44-\u5982\u679c\u9700\u8981\u5378\u8f7d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4",children:"4.4 \u5982\u679c\u9700\u8981\u5378\u8f7d\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5378\u8f7d docker\nsudo dnf remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras\n\n# \u5220\u9664\u76f8\u5173\u76ee\u5f55\nsudo rm -rf /var/lib/docker\nsudo rm -rf /var/lib/containerd\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"45-\u914d\u7f6edocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93",children:"4.5 \u914d\u7f6eDocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u914d\u7f6e\u9a71\u52a8\ncat <<EOF | sudo tee /etc/docker/daemon.json\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "registry-mirrors": [\n    "https://docker.hpcloud.cloud",\n    "https://docker.m.daocloud.io",\n    "https://docker.unsee.tech",\n    "https://docker.1panel.live",\n    "http://mirrors.ustc.edu.cn",\n    "https://docker.chenby.cn",\n    "http://mirror.azure.cn",\n    "https://dockerpull.org",\n    "https://dockerhub.icu",\n    "https://hub.rat.dev"\n  ]\n}\nEOF\n\n# \u91cd\u542fdocker\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n\n'})}),"\n",(0,d.jsx)(n.h3,{id:"46-\u5b89\u88c5cri-dockerd\u9a71\u52a8docker\u4e0ek8s\u96c6\u6210\u7684\u9002\u914d\u5c42",children:"4.6 \u5b89\u88c5cri-dockerd\u9a71\u52a8\uff08Docker\u4e0eK8s\u96c6\u6210\u7684\u9002\u914d\u5c42\uff09"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://mirantis.github.io/cri-dockerd/usage/install/",children:"CRI-Dockerd\u5b89\u88c5\u6587\u6863"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["Docker Engine \u6ca1\u6709\u5b9e\u73b0 ",(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/architecture/cri/",children:"CRI"}),"\uff0c \u800c\u8fd9\u662f\u5bb9\u5668\u8fd0\u884c\u65f6\u5728 Kubernetes \u4e2d\u5de5\u4f5c\u6240\u9700\u8981\u7684\u3002 \u4e3a\u6b64\uff0c\u5fc5\u987b\u5b89\u88c5\u4e00\u4e2a\u989d\u5916\u7684\u670d\u52a1 ",(0,d.jsx)(n.a,{href:"https://github.com/Mirantis/cri-dockerd",children:"cri-dockerd"}),"\u3002 cri-dockerd \u662f\u4e00\u4e2a\u57fa\u4e8e\u4f20\u7edf\u7684\u5185\u7f6e Docker \u5f15\u64ce\u652f\u6301\u7684\u9879\u76ee\uff0c \u5b83\u5728 1.24 \u7248\u672c\u4ece kubelet \u4e2d",(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/dockershim",children:"\u79fb\u9664"}),"\u3002"]}),"\n",(0,d.jsx)(n.h4,{id:"461-\u63a8\u8350rpm\u5b89\u88c5",children:"4.6.1 \u3010\u63a8\u8350\u3011rpm\u5b89\u88c5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"mkdir -p ~/k8s-install/cri/ && cd ~/k8s-install/\ncurl -sSLf https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.14/cri-dockerd-0.3.14-3.el8.x86_64.rpm -o ./cri/cri-dockerd-0.3.14-3.el8.x86_64.rpm\n\nsudo rpm -ivh ./cri/cri-dockerd-0.3.14-3.el8.x86_64.rpm\n\n# \u542f\u52a8\nsudo systemctl daemon-reload\nsudo systemctl enable cri-docker\nsudo systemctl start cri-docker\nsudo systemctl status cri-docker\n\n\n# \u68c0\u67e5CRI\u5957\u63a5\u5b57\nll /run/cri-dockerd.sock\n\nll /var/run/cri-dockerd.sock\n\n"})}),"\n",(0,d.jsx)(n.h4,{id:"462-\u6e90\u7801\u5b89\u88c5",children:"4.6.2 \u6e90\u7801\u5b89\u88c5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"mkdir -p ~/k8s-install/cri/ && cd ~/k8s-install/\n\n# \u4e0b\u8f7d cri-dockerd\uff08\u6ce8\u610f\u7cfb\u7edf\u7248\u672c\uff0c\u8fd9\u91cc\u662famd64\uff09\ncurl -sSLf https://github.com/Mirantis/cri-dockerd/releases/download/v0.3.14/cri-dockerd-0.3.14.amd64.tgz -o ./cri/cri-dockerd-0.3.14.amd64.tgz\n\nscp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.121:/home/diginn/k8s-install/cri/\nscp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.123:/home/diginn/k8s-install/cri/\nscp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.131:/home/diginn/k8s-install/cri/\nscp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.132:/home/diginn/k8s-install/cri/\nscp -r ./cri/cri-dockerd-0.3.14.amd64.tgz diginn@192.168.137.133:/home/diginn/k8s-install/cri/\n\n# \u89e3\u538b\ntar -zxvf ./cri/cri-dockerd-0.3.14.amd64.tgz\n\n# \u79fb\u52a8\u5230\u7cfb\u7edf\u8def\u5f84\nsudo mv ./cri/cri-dockerd/cri-dockerd /usr/local/bin/\n"})}),"\n",(0,d.jsx)(n.h4,{id:"463-\u4ec5\u6e90\u7801\u5b89\u88c5\u6ce8\u518c\u4e3a\u7cfb\u7edf\u670d\u52a1",children:"4.6.3 \u3010\u4ec5\u6e90\u7801\u5b89\u88c5\u3011\u6ce8\u518c\u4e3a\u7cfb\u7edf\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'sudo tee /etc/systemd/system/cri-docker.service <<EOF\n[Unit]\nDescription=CRI Interface for Docker Application Container Engine\nDocumentation=https://docs.mirantis.com\nAfter=network-online.target firewalld.service docker.service\nWants=network-online.target\nRequires=cri-docker.socket\n\n[Service]\nType=notify\nExecStart=/usr/local/bin/cri-dockerd --container-runtime-endpoint fd:// --network-plugin=cni --pod-infra-container-image=registry.aliyuncs.com/google_containers/pause:3.10\nExecReload=/bin/kill -s HUP $MAINPID\nTimeoutSec=0\nRestartSec=2\nRestart=always\n\n# Note that StartLimit* options were moved from "Service" to "Unit" in systemd 229.\n# Both the old, and new location are accepted by systemd 229 and up, so using the old location\n# to make them work for either version of systemd.\nStartLimitBurst=3\n\n# Note that StartLimitInterval was renamed to StartLimitIntervalSec in systemd 230.\n# Both the old, and new name are accepted by systemd 230 and up, so using the old name to make\n# this option work for either version of systemd.\nStartLimitInterval=60s\n\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNOFILE=infinity\nLimitNPROC=infinity\nLimitCORE=infinity\n\n# Comment TasksMax if your systemd version does not support it.\n# Only systemd 226 and above support this option.\nTasksMax=infinity\nDelegate=yes\nKillMode=process\n\n[Install]\nWantedBy=multi-user.target\nEOF\n\n'})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# cri-docker.socket\nsudo tee /etc/systemd/system/cri-docker.socket <<EOF\n[Unit]\nDescription=CRI Docker Socket for the API\nPartOf=cri-docker.service\n\n[Socket]\nListenStream=%t/cri-dockerd.sock\nSocketMode=0660\nSocketUser=root\nSocketGroup=docker\n\n[Install]\nWantedBy=sockets.target\nEOF\n\n"})}),"\n",(0,d.jsx)(n.h4,{id:"464-\u4ec5\u6e90\u7801\u5b89\u88c5\u542f\u52a8-cri-dockerd",children:"4.6.4 \u3010\u4ec5\u6e90\u7801\u5b89\u88c5\u3011\u542f\u52a8 cri-dockerd"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8cri-dockerd\nsudo systemctl daemon-reload\nsudo systemctl enable --now cri-docker.socket\n\n\n# \u68c0\u67e5CRI\u5957\u63a5\u5b57\nll /run/cri-dockerd.sock\n\nll /var/run/cri-dockerd.sock\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u5bf9\u4e8e ",(0,d.jsx)(n.code,{children:"cri-dockerd"}),"\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cCRI \u5957\u63a5\u5b57\u662f ",(0,d.jsx)(n.code,{children:"/run/cri-dockerd.sock"}),"\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"\u4e94\u6240\u6709\u8282\u70b9\u5b89\u88c5-kubeadmkubelet-\u548c-kubectl",children:"\u4e94\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u5b89\u88c5 kubeadm\u3001kubelet \u548c kubectl"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.downloadkubernetes.com/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u9700\u8981\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\u5b89\u88c5\u4ee5\u4e0b\u7684\u8f6f\u4ef6\u5305\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"kubeadm"}),"\uff1a\u7528\u6765\u521d\u59cb\u5316\u96c6\u7fa4\u7684\u6307\u4ee4\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"kubelet"}),"\uff1a\u5728\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7528\u6765\u542f\u52a8 Pod \u548c\u5bb9\u5668\u7b49\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"kubectl"}),"\uff1a\u7528\u6765\u4e0e\u96c6\u7fa4\u901a\u4fe1\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"Pod"}),": Kubernetes\u7684\u6700\u5c0f\u5de5\u4f5c\u5355\u5143\u3002\u6bcf\u4e2a",(0,d.jsx)(n.code,{children:"Pod"}),"\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5bb9\u5668\u3002",(0,d.jsx)(n.code,{children:"Pod"}),"\u4e2d\u7684\u5bb9\u5668\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u88ab",(0,d.jsx)(n.code,{children:"Master"}),"\u8c03\u5ea6\u5230\u4e00\u4e2a",(0,d.jsx)(n.code,{children:"Node"}),"\u4e0a\u8fd0\u884c."]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"kubeadm"})," \u4e0d\u80fd\u5e2e\u4f60\u5b89\u88c5\u6216\u8005\u7ba1\u7406 ",(0,d.jsx)(n.code,{children:"kubelet"})," \u6216 ",(0,d.jsx)(n.code,{children:"kubectl"}),"\uff0c \u6240\u4ee5\u4f60\u9700\u8981\u786e\u4fdd\u5b83\u4eec\u4e0e\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"kubeadm"})," \u5b89\u88c5\u7684\u63a7\u5236\u5e73\u9762\u7684\u7248\u672c\u76f8\u5339\u914d\u3002 \u5982\u679c\u4e0d\u8fd9\u6837\u505a\uff0c\u5219\u5b58\u5728\u53d1\u751f\u7248\u672c\u504f\u5dee\u7684\u98ce\u9669\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u9884\u6599\u4e4b\u5916\u7684\u9519\u8bef\u548c\u95ee\u9898\u3002 \u7136\u800c\uff0c\u63a7\u5236\u5e73\u9762\u4e0e ",(0,d.jsx)(n.code,{children:"kubelet"})," \u4e4b\u95f4\u53ef\u4ee5\u5b58\u5728\u4e00\u4e2a\u6b21\u8981\u7248\u672c\u7684\u504f\u5dee\uff0c\u4f46 ",(0,d.jsx)(n.code,{children:"kubelet"})," \u7684\u7248\u672c\u4e0d\u53ef\u4ee5\u8d85\u8fc7 API \u670d\u52a1\u5668\u7684\u7248\u672c\u3002 \u4f8b\u5982\uff0c1.7.0 \u7248\u672c\u7684 ",(0,d.jsx)(n.code,{children:"kubelet"})," \u53ef\u4ee5\u5b8c\u5168\u517c\u5bb9 1.8.0 \u7248\u672c\u7684 API \u670d\u52a1\u5668\uff0c\u53cd\u4e4b\u5219\u4e0d\u53ef\u4ee5\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["\u6709\u5173\u5b89\u88c5 ",(0,d.jsx)(n.code,{children:"kubectl"})," \u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",(0,d.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/tasks/tools/",children:"\u5b89\u88c5\u548c\u8bbe\u7f6e kubectl"})," \u6587\u6863\u3002"]}),"\n",(0,d.jsx)(n.h3,{id:"51-\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a-mac-\u5730\u5740\u548c-product_uuid-\u7684\u552f\u4e00\u6027",children:"5.1 \u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a MAC \u5730\u5740\u548c product_uuid \u7684\u552f\u4e00\u6027"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 ",(0,d.jsx)(n.code,{children:"ip link"})," \u6216 ",(0,d.jsx)(n.code,{children:"ifconfig -a"})," \u6765\u83b7\u53d6\u7f51\u7edc\u63a5\u53e3\u7684 MAC \u5730\u5740"]}),"\n"]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"sudo cat /sys/class/dmi/id/product_uuid"})," \u547d\u4ee4\u5bf9 ",(0,d.jsx)(n.code,{children:"product_uuid"})," \u6821\u9a8c"]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"\nip link | grep link/ether\n\n# \u67e5\u770b product_uuid\nsudo cat /sys/class/dmi/id/product_uuid\n"})}),"\n",(0,d.jsx)(n.h3,{id:"52-\u6dfb\u52a0-kubernetes-\u7684-yum-\u4ed3\u5e93",children:"5.2 \u6dfb\u52a0 Kubernetes \u7684 yum \u4ed3\u5e93"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u6b64\u64cd\u4f5c\u4f1a\u8986\u76d6 /etc/yum.repos.d/kubernetes.repo \u4e2d\u73b0\u5b58\u7684\u6240\u6709\u914d\u7f6e\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://pkgs.k8s.io/core:/stable:/v1.30/rpm/repodata/repomd.xml.key\nexclude=kubelet kubeadm kubectl cri-tools kubernetes-cni\nEOF\n\n\n# \u5982\u679c\u6162\uff0c\u53ef\u4ee5\u6539\u6210\u963f\u91cc\u4e91\u7684\u6e90\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/\nenabled=1\ngpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetesnew/core/stable/v1.30/rpm/repodata/repomd.xml.key\nEOF\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"53-\u5728\u7ebf\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl",children:"5.3 \u3010\u5728\u7ebf\u3011\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\nsudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\n\n# \u67e5\u770b\u7248\u672c\nkubeadm version \n\nkubectl version --client\n\nkubelet --version\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(74355).A+"",width:"1661",height:"916"}),"\n",(0,d.jsx)(n.img,{src:s(83512).A+"",width:"1661",height:"916"})]}),"\n",(0,d.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'sudo vim /etc/sysconfig/kubelet\n# \u5c06KUBELET_EXTRA_ARGS \u7684\u503c\u8bbe\u7f6e\u4e3a\nKUBELET_EXTRA_ARGS="--cgroup-driver=systemd"\n\n# \u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8\nsudo systemctl enable --now kubelet\n\n'})}),"\n",(0,d.jsx)(n.h3,{id:"53-\u79bb\u7ebf\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl",children:"5.3 \u3010\u79bb\u7ebf\u3011\u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.downloadkubernetes.com/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/",children:"\u963f\u91cc\u4e91Kubeadm Kubectl Kubelet\u4e0b\u8f7d"})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"mkdir -p ~/k8s-install/k8s/ && cd ~/k8s-install/\n\n# \u4e8c\u8fdb\u5236\u5305\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/apiextensions-apiserver ./k8s/apiextensions-apiserver\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-aggregator         ./k8s/kube-aggregator\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-apiserver          ./k8s/kube-apiserver\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-controller-manager ./k8s/kube-controller-manager\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-log-runner         ./k8s/kube-log-runner\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-proxy              ./k8s/kube-proxy\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kube-scheduler          ./k8s/kube-scheduler\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubeadm                 ./k8s/kubeadm\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubectl                 ./k8s/kubectl\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubectl-convert         ./k8s/kubectl-convert\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/kubelet                 ./k8s/kubelet\nwget https://dl.k8s.io/v1.30.11/bin/linux/amd64/mounter                 ./k8s/mounter\n\n# \u9002\u7528\u4e8eCentOS\u7684RPM\u5305\nwget https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/kubeadm-1.30.11-150500.1.1.x86_64.rpm -O ./k8s/kubeadm-1.30.11-150500.1.1.x86_64.rpm\nwget https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/kubectl-1.30.11-150500.1.1.x86_64.rpm -O ./k8s/kubectl-1.30.11-150500.1.1.x86_64.rpm\nwget https://mirrors.aliyun.com/kubernetes-new/core/stable/v1.30/rpm/x86_64/kubelet-1.30.11-150500.1.1.x86_64.rpm -O ./k8s/kubelet-1.30.11-150500.1.1.x86_64.rpm\n\n# 1. \u4e0b\u8f7d\u4f9d\u8d56\u5305\nyumdownloader --archlist=x86_64 --resolve --destdir=./k8s/kubeadm kubeadm\nyumdownloader --archlist=x86_64 --resolve --destdir=./k8s/kubectl kubectl\nyumdownloader --archlist=x86_64 --resolve --destdir=./k8s/kubelet kubelet\n\n# 2. \u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\nsudo rpm -ivh ./k8s/kubeadm/*.rpm\nsudo rpm -ivh ./k8s/kubectl/*.rpm\nsudo rpm -ivh ./k8s/kubelet/*.rpm\n\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'sudo vim /etc/sysconfig/kubelet\n# \u5c06KUBELET_EXTRA_ARGS \u7684\u503c\u8bbe\u7f6e\u4e3a\nKUBELET_EXTRA_ARGS="--cgroup-driver=systemd"\n\n# \u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8\nsudo systemctl enable --now kubelet\n\n'})}),"\n",(0,d.jsx)(n.h3,{id:"54-\u4e0b\u8f7dk8s\u4f9d\u8d56\u955c\u50cf",children:"5.4 \u4e0b\u8f7dK8s\u4f9d\u8d56\u955c\u50cf"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u521d\u59cb\u5316\u6240\u9700\u7684\u955c\u50cf\nkubeadm config images list\n\n# \u62c9\u53d6\u955c\u50cf\nkubeadm config images pull\n\n# \u5b98\u65b9\u4e0b\u8f7d\u6162\uff0c\u53ef\u4ee5\u4f7f\u7528\u963f\u91cc\u4e91\u7684\u4e0b\u8f7d\ndocker pull registry.aliyuncs.com/google_containers/kube-apiserver:v1.30.11\ndocker pull registry.aliyuncs.com/google_containers/kube-controller-manager:v1.30.11\ndocker pull registry.aliyuncs.com/google_containers/kube-scheduler:v1.30.11\ndocker pull registry.aliyuncs.com/google_containers/kube-proxy:v1.30.11\ndocker pull registry.aliyuncs.com/google_containers/coredns:v1.11.3\ndocker pull registry.aliyuncs.com/google_containers/pause:3.9\ndocker pull registry.aliyuncs.com/google_containers/etcd:3.5.15-0\n\n# \u91cd\u65b0\u6253Tag\ndocker tag registry.aliyuncs.com/google_containers/kube-apiserver:v1.30.11          registry.k8s.io/kube-apiserver:v1.30.11\ndocker tag registry.aliyuncs.com/google_containers/kube-controller-manager:v1.30.11 registry.k8s.io/kube-controller-manager:v1.30.11\ndocker tag registry.aliyuncs.com/google_containers/kube-scheduler:v1.30.11          registry.k8s.io/kube-scheduler:v1.30.11\ndocker tag registry.aliyuncs.com/google_containers/kube-proxy:v1.30.11              registry.k8s.io/kube-proxy:v1.30.11\ndocker tag registry.aliyuncs.com/google_containers/coredns:v1.11.3                  registry.k8s.io/coredns/coredns:v1.11.3\ndocker tag registry.aliyuncs.com/google_containers/pause:3.9                        registry.k8s.io/pause:3.9\ndocker tag registry.aliyuncs.com/google_containers/etcd:3.5.15-0                    registry.k8s.io/etcd:3.5.15-0\n\n# \u5220\u9664\u963f\u91cc\u4e91Tag\ndocker rmi registry.aliyuncs.com/google_containers/kube-apiserver:v1.30.11\ndocker rmi registry.aliyuncs.com/google_containers/kube-controller-manager:v1.30.11\ndocker rmi registry.aliyuncs.com/google_containers/kube-scheduler:v1.30.11\ndocker rmi registry.aliyuncs.com/google_containers/kube-proxy:v1.30.11\ndocker rmi registry.aliyuncs.com/google_containers/coredns:v1.11.3\ndocker rmi registry.aliyuncs.com/google_containers/pause:3.9\ndocker rmi registry.aliyuncs.com/google_containers/etcd:3.5.15-0\n\n# \u67e5\u770b\u955c\u50cf\u5217\u8868\ndocker image list\n\n# \u5bfc\u51fa\u955c\u50cf\n./docker_image_tool.sh export ~/k8s-install/images/\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(72577).A+"",width:"1661",height:"916"})}),"\n",(0,d.jsx)(n.h2,{id:"\u516d\u4ec5master\u8282\u70b9\u5b89\u88c5haproxy-keepalived",children:"\u516d\u3001\u3010\u4ec5Master\u8282\u70b9\u3011\u5b89\u88c5HAProxy Keepalived"}),"\n",(0,d.jsx)(n.p,{children:"\u5728 k8s \u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 haproxy \u548c keepalived \u4f5c\u4e3a\u9ad8\u53ef\u7528\u7684\u7ec4\u4ef6\uff0c\u5bf9\u4e8e k8s \u7684\u9ad8\u53ef\u7528\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u65b9\u9762\uff1a apiserver \u548c etcd\u3002 apiserver \u662f k8s \u7684\u5165\u53e3\uff0cetcd \u5219\u4e3a k8s \u7684\u6570\u636e\u5b58\u50a8\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u4e3b\u8981\u8bb2\u8ff0\u5982\u4f55\u5bf9 apiserver \u8fdb\u884c\u9ad8\u53ef\u7528\u7684\u914d\u7f6e\uff0cetcd \u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u5c06\u5728\u96c6\u7fa4\u7684\u751f\u6210\u7684\u65f6\u5019\uff0c\u7531 kubeadm \u8fdb\u884c\u81ea\u884c\u914d\u7f6e\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"61-\u5f00\u653e\u7aef\u53e3",children:"6.1 \u5f00\u653e\u7aef\u53e3"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.cnblogs.com/tanghu/p/12617840.html",children:"CentOS7\u4e0b\u914d\u7f6e\u9632\u706b\u5899\u653e\u8fc7Keepalived"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.cnblogs.com/lgh344902118/p/7737129.html",children:"centos7 keepalived\u4ee5\u53ca\u9632\u706b\u5899\u914d\u7f6e"})}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u6dfb\u52a0\u6c38\u4e45\u89c4\u5219\u5141\u8bb8VRRP\u534f\u8bae\nsudo firewall-cmd --permanent --add-protocol=vrrp\n# \u82e5\u4e0a\u8ff0\u547d\u4ee4\u62a5\u9519\uff08\u534f\u8bae\u540d\u79f0\u4e0d\u652f\u6301\uff09\uff0c\u6539\u7528\u5bcc\u89c4\u5219\u6307\u5b9a\u534f\u8bae\u53f7\nsudo firewall-cmd --permanent --add-rich-rule=\'rule protocol value="112" accept\'\n\n# VRRP\u9ed8\u8ba4\u4f7f\u7528\u7ec4\u64ad\u5730\u5740224.0.0.18\u3002\u5141\u8bb8\u76f8\u5173\u7ec4\u64ad\u901a\u4fe1\nsudo firewall-cmd --permanent --add-rich-rule=\'rule family="ipv4" source address="224.0.0.18/32" accept\'\n\n# HAProxy\u4ee3\u7406\u63a5\u53e3\nsudo firewall-cmd --permanent --zone=public --add-port=16443/tcp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-all\n\n# protocols: vrrp\n# rich rules: \n#     rule protocol value="112" accept\n#     rule family="ipv4" source address="224.0.0.18/32" accept\n\n'})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(45813).A+"",width:"1676",height:"975"})}),"\n",(0,d.jsxs)(n.p,{children:["\u5728\u914d\u7f6e\u9632\u706b\u5899\u89c4\u5219\u4e4b\u540e\uff0c",(0,d.jsx)(n.code,{children:"192.168.137.140"})," IP\u4ec5\u5728Keepalived\u4e3b\u8282\u70b9\u4e0a\uff0c\u5907\u4efd\u8282\u70b9\u6ca1\u6709\u8fd9\u4e2aip\uff0c\u5907\u4efd\u8282\u70b9\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2aIP\u8bbf\u95ee\u5230\u4e3b\u8282\u70b9"]}),"\n",(0,d.jsx)(n.h3,{id:"62-\u5728\u7ebf\u5b89\u88c5keepalived-haproxy",children:"6.2 \u3010\u5728\u7ebf\u3011\u5b89\u88c5Keepalived HAProxy"}),"\n",(0,d.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6240\u6709Master\u8282\u70b9\u90fd\u8981\u6267\u884c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5728\u7ebf\u5b89\u88c5keepalived haproxy\nsudo yum install -y keepalived haproxy\n\n# \u79bb\u7ebf\u5b89\u88c5keepalived haproxy\nsudo rpm -ivh ~/k8s-install/haproxy/*.rpm\nsudo rpm -ivh ~/k8s-install/keepalived/*.rpm\n\n# \u5907\u4efd\u914d\u7f6e\u6587\u4ef6\nsudo mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bakup\nsudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bakup\n\n# \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\nll /etc/keepalived/\nll /etc/haproxy/\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"62-\u79bb\u7ebf\u5b89\u88c5keepalived-haproxy",children:"6.2 \u3010\u79bb\u7ebf\u3011\u5b89\u88c5Keepalived HAProxy"}),"\n",(0,d.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6240\u6709Master\u8282\u70b9\u90fd\u8981\u6267\u884c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u79bb\u7ebf\u5b89\u88c5keepalived haproxy\nsudo rpm -ivh ./haproxy/*.rpm\nsudo rpm -ivh ./keepalived/*.rpm\n\n# \u5907\u4efd\u914d\u7f6e\u6587\u4ef6\nsudo mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bakup\nsudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bakup\n\n# \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\nll /etc/keepalived/\nll /etc/haproxy/\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"63-\u914d\u7f6ehaproxy",children:"6.3 \u914d\u7f6eHAProxy"}),"\n",(0,d.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6240\u6709Master\u8282\u70b9\u90fd\u8981\u6267\u884c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/haproxy/haproxy.cfg\nglobal\n    log /dev/log    local0\n    log /dev/log    local1 notice\n    chroot /var/lib/haproxy\n    stats timeout 30s\n    user haproxy\n    group haproxy\n    daemon\n\ndefaults\n    log     global\n    mode    tcp\n    option  tcplog\n    option  dontlognull\n    timeout connect 5000\n    timeout client  50000\n    timeout server  50000\n\nfrontend https-in\n    bind *:16443\n    mode tcp\n    option tcplog\n\n    default_backend servers-backend\n\nbackend servers-backend\n    mode tcp\n    balance roundrobin\n    option tcp-check\n\n    server k8s-master-01 192.168.137.121:6443 check\n    server k8s-master-02 192.168.137.122:6443 check\n    server k8s-master-03 192.168.137.123:6443 check\nEOF\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"64-\u914d\u7f6ekeepalived",children:"6.4 \u914d\u7f6eKeepalived"}),"\n",(0,d.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6bcf\u4e2aMaster\u8282\u70b9\u6267\u884c\u5bf9\u5e94\u7684\u914d\u7f6e"}),"\n",(0,d.jsxs)(n.h4,{id:"641-192168137121\u4f5c\u4e3avip\u7684\u4e3b\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",children:["6.4.1 ",(0,d.jsx)(n.code,{children:"192.168.137.121"}),"\u4f5c\u4e3aVIP\u7684\u4e3b\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n}\nvrrp_instance VI_1 {\n    state MASTER                    # \u8bbe\u7f6e\u4e3a\u4e3b\u8282\u70b9\n    interface enp0s3                # \u7f51\u7edc\u63a5\u53e3\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\n    virtual_router_id 51            # VRRP \u8def\u7531ID\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    priority 100                    # \u4f18\u5148\u7ea7\uff0c\u4e3b\u8282\u70b9\u5fc5\u987b\u9ad8\u4e8e\u5907\u4efd\u8282\u70b9\n    advert_int 1                    # VRRP\u901a\u544a\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\n    unicast_peer {                  # \u914d\u7f6eunicast_peers\uff0c\u6307\u5b9a\u5176\u4ed6\u4e24\u53f0\u670d\u52a1\u5668\u7684IP\n        192.168.137.122\n        192.168.137.123\n    }\n\n    authentication {\n        auth_type PASS              # \u8ba4\u8bc1\u7c7b\u578b\n        auth_pass 1234              # \u8ba4\u8bc1\u5bc6\u7801\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    }\n    virtual_ipaddress {\n        192.168.137.140             # \u865a\u62dfIP\u5730\u5740\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\n    }\n}\nEOF\n\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"642-192168137122\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",children:["6.4.2 ",(0,d.jsx)(n.code,{children:"192.168.137.122"}),"\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n}\n\nvrrp_instance VI_1 {\n    state BACKUP                    # \u8bbe\u7f6e\u4e3a\u5907\u4efd\u8282\u70b9\n    interface enp0s3                # \u786e\u4fdd\u4f7f\u7528\u6b63\u786e\u7684\u7f51\u7edc\u63a5\u53e3\u540d\u79f0\n    virtual_router_id 51            # VRRP \u8def\u7531ID\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    priority 50                     # \u4f18\u5148\u7ea7\uff0c\u5907\u4efd\u8282\u70b9\u5fc5\u987b\u4f4e\u4e8e\u4e3b\u8282\u70b9\n    advert_int 1                    # VRRP\u901a\u544a\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\n    unicast_peer {                  # \u914d\u7f6eunicast_peers\uff0c\u6307\u5b9a\u5176\u4ed6\u4e24\u53f0\u670d\u52a1\u5668\u7684IP\n        192.168.137.121\n        192.168.137.123\n    }\n\n    authentication {\n        auth_type PASS              # \u8ba4\u8bc1\u7c7b\u578b\n        auth_pass 1234              # \u8ba4\u8bc1\u5bc6\u7801\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    }\n\n    virtual_ipaddress {\n        192.168.137.140             # \u865a\u62dfIP\u5730\u5740\uff0c\u4e0e\u4e3b\u8282\u70b9\u76f8\u540c\n    }\n}\nEOF\n\n"})}),"\n",(0,d.jsxs)(n.h4,{id:"643-192168137123\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",children:["6.4.3 ",(0,d.jsx)(n.code,{children:"192.168.137.123"}),"\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n}\n\nvrrp_instance VI_1 {\n    state BACKUP                    # \u8bbe\u7f6e\u4e3a\u5907\u4efd\u8282\u70b9\n    interface enp0s3                # \u786e\u4fdd\u4f7f\u7528\u6b63\u786e\u7684\u7f51\u7edc\u63a5\u53e3\u540d\u79f0\n    virtual_router_id 51            # VRRP \u8def\u7531ID\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    priority 40                     # \u4f18\u5148\u7ea7\uff0c\u5907\u4efd\u8282\u70b9\u5fc5\u987b\u4f4e\u4e8e\u4e3b\u8282\u70b9\n    advert_int 1                    # VRRP\u901a\u544a\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\n    unicast_peer {                  # \u914d\u7f6eunicast_peers\uff0c\u6307\u5b9a\u5176\u4ed6\u4e24\u53f0\u670d\u52a1\u5668\u7684IP\n        192.168.137.121\n        192.168.137.122\n    }\n\n    authentication {\n        auth_type PASS              # \u8ba4\u8bc1\u7c7b\u578b\n        auth_pass 1234              # \u8ba4\u8bc1\u5bc6\u7801\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    }\n\n    virtual_ipaddress {\n        192.168.137.140             # \u865a\u62dfIP\u5730\u5740\uff0c\u4e0e\u4e3b\u8282\u70b9\u76f8\u540c\n    }\n}\nEOF\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"65-\u542f\u52a8keepalived-haproxy",children:"6.5 \u542f\u52a8Keepalived HAProxy"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\ncat /etc/haproxy/haproxy.cfg\ncat /etc/keepalived/keepalived.conf\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start keepalived\nsudo systemctl start haproxy\n\n# \u5f00\u673a\u81ea\u542f\nsudo systemctl enable --now keepalived\nsudo systemctl enable --now haproxy\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status keepalived\nsudo systemctl status haproxy\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(78462).A+"",width:"1676",height:"975"})}),"\n",(0,d.jsxs)(n.p,{children:["\u5728\u914d\u7f6e\u9632\u706b\u5899\u89c4\u5219\u4e4b\u524d\uff0c\u6bcf\u53f0\u673a\u5668\u90fd\u6709 ",(0,d.jsx)(n.code,{children:"192.168.137.140"})," IP"]}),"\n",(0,d.jsx)(n.h2,{id:"\u4e03\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc",children:"\u4e03\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc"}),"\n",(0,d.jsx)(n.h3,{id:"71-\u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9",children:"7.1 \u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u79bb\u7ebf\u90e8\u7f72\u65f6\uff0c\u9700\u8981\u5c06 ",(0,d.jsx)(n.code,{children:"--image-repository"})," \u8bbe\u7f6e\u4e3a\u672c\u5730\u955c\u50cf\u4ed3\u5e93\u5730\u5740\uff0c\u6216\u8005\u5f53\u524d\u670d\u52a1\u5668\u4e0a\u7684\u955c\u50cf\u524d\u7f00\uff0c\u5426\u5219\u56de\u51fa\u73b0\u670d\u52a1\u90e8\u7f72\u627e\u4e0d\u5230\u955c\u50cf\u7684\u60c5\u51b5"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u3010\u9ed8\u8ba4\u3011\u9ed8\u8ba4\u7684\u955c\u50cf\u4ed3\u5e93\u65e0\u6cd5\u8bbf\u95ee  ",(0,d.jsx)(n.code,{children:"--image-repository=registry.k8s.io"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u3010\u5728\u7ebf\u3011\u5728\u7ebf\u4f7f\u7528\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93  ",(0,d.jsx)(n.code,{children:"--image-repository=registry.aliyuncs.com/google_containers"})]}),"\n",(0,d.jsxs)(n.li,{children:["\u3010\u79bb\u7ebf\u3011\u79bb\u7ebf\u4f7f\u7528\u81ea\u5efa\u955c\u50cf\u4ed3\u5e93    ",(0,d.jsx)(n.code,{children:"--image-repository=registry.example.com"})]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5982\u679c\u79bb\u7ebf\u4ed3\u5e93\u7684\u524d\u7f00\u4e3a registry.example.com\uff0c\u7ed9\u955c\u50cf\u91cd\u65b0\u6253Tag\ndocker tag registry.k8s.io/kube-apiserver:v1.30.11          registry.example.com/kube-apiserver:v1.30.11\ndocker tag registry.k8s.io/kube-controller-manager:v1.30.11 registry.example.com/kube-controller-manager:v1.30.11 \ndocker tag registry.k8s.io/kube-scheduler:v1.30.11          registry.example.com/kube-scheduler:v1.30.11\ndocker tag registry.k8s.io/kube-proxy:v1.30.11              registry.example.com/kube-proxy:v1.30.11\ndocker tag registry.k8s.io/coredns/coredns:v1.11.3          registry.example.com/coredns:v1.11.3\ndocker tag registry.k8s.io/pause:3.9                        registry.example.com/pause:3.9    \ndocker tag registry.k8s.io/etcd:3.5.15-0                    registry.example.com/etcd:3.5.15-0\n\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u96c6\u7fa4\nsudo kubeadm init \\\n  --kubernetes-version=v1.30.11 \\\n  --control-plane-endpoint=192.168.137.140:16443 \\\n  --image-repository=registry.k8s.io \\\n  # --image-repository=registry.aliyuncs.com/google_containers \\\n  --service-cidr=10.96.0.0/12 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --upload-certs \\\n  --cri-socket=unix:///var/run/cri-dockerd.sock\n\n# \u67e5\u770b\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\nsudo kubectl -n kube-system get cm kubeadm-config -o yaml\n\n# \u5982\u679c\u521d\u59cb\u5316\u5f02\u5e38\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u91cd\u7f6e\nsudo kubeadm reset --cri-socket=unix:///var/run/cri-dockerd.sock\n\n"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"kubernetes-version"}),": K8s\u7248\u672c\uff0c\u4e0e\u4e0a\u9762\u5b89\u88c5\u7684\u4e00\u81f4"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"--control-plane-endpoint"}),": \u63a7\u5236\u9762\u7aef\u70b9\uff0c\u914d\u7f6eVIP\u7684\u5730\u5740 ",(0,d.jsx)(n.code,{children:"192.168.137.140"})," \u7aef\u53e3\u4e3aHAProxy\u4ee3\u7406\u7684\u7aef\u53e3"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"apiserver-advertise-address"}),": master\u4e3b\u673a\u5185\u7f51IP\u5730\u5740"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"image-repository"}),": \u6307\u5b9a\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u3002\u7531\u4e8ekubeadm \u9ed8\u8ba4\u4ece\u5b98\u7f51",(0,d.jsx)(n.a,{href:"http://k8s.grc.io%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F%EF%BC%8C%E5%9B%BD%E5%86%85%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%9B%A0%E6%AD%A4%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80",children:"http://k8s.grc.io\u4e0b\u8f7d\u6240\u9700\u955c\u50cf\uff0c\u56fd\u5185\u65e0\u6cd5\u8bbf\u95ee\uff0c\u56e0\u6b64\u9700\u8981\u6307\u5b9a\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u5730\u5740"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"service-cidr"}),": \u96c6\u7fa4\u5185\u90e8\u865a\u62df\u7f51\u7edc\uff0cPod\u7edf\u4e00\u8bbf\u95ee\u5165\u53e3"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"pod-network-cidr"}),": \u5b9a\u4e49pod\u7f51\u6bb5\u4e3a, ",(0,d.jsx)(n.code,{children:"10.244.0.0/16"})]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u6267\u884c\u540e\u6253\u5370\u7684\u65e5\u5fd7\u4fe1\u606f"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u7b49\u5f85\u6210\u529f\u540e\u6309\u7167\u63d0\u793a\u914d\u7f6e\u8bbf\u95ee\u7684.kube/config\u5373\u53ef\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nYou can now join any number of the control-plane node running the following command on each as root:\n\n  kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \\\n        --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1 \\\n        --control-plane --certificate-key 3f3d619638bb3cb780d9a54bc2153d61996c9a367d79e8f584992fa961d2659b\n\nPlease note that the certificate-key gives access to cluster sensitive data, keep it secret!\nAs a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use\n"kubeadm init phase upload-certs --upload-certs" to reload certs afterward.\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \\\n        --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1\n'})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(89486).A+"",width:"1676",height:"917"}),"\n",(0,d.jsx)(n.img,{src:s(63127).A+"",width:"1676",height:"917"})]}),"\n",(0,d.jsx)(n.h3,{id:"72-\u914d\u7f6emaster\u8282\u70b9",children:"7.2 \u914d\u7f6eMaster\u8282\u70b9"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u6309\u7167\u5b89\u88c5\u5b8c\u6210\u7684\u63d0\u793a\u6267\u884c\u547d\u4ee4\uff08\u6b64\u65f6\u9700\u8981\u4f7f\u7528\u666e\u901a\u7528\u6237\uff09\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# \u83b7\u53d6\u8282\u70b9\u4fe1\u606f\u548cpod\u4fe1\u606f\nkubectl get nodes\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(74396).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h2,{id:"\u516b\u5176\u4ed6master\u8282\u70b9master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",children:"\u516b\u3001\u3010\u5176\u4ed6Master\u8282\u70b9\u3011Master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4"}),"\n",(0,d.jsx)(n.h3,{id:"81-\u8282\u70b9\u521d\u59cb\u5316",children:"8.1 \u8282\u70b9\u521d\u59cb\u5316"}),"\n",(0,d.jsx)(n.p,{children:"\u6309\u987a\u5e8f\u6267\u884c\u4e0a\u9762 \u3010\u4e09\u3001\u56db\u3001\u4e94\u3011 \u7684\u6240\u6709\u914d\u7f6e\u53ca\u5b89\u88c5\u547d\u4ee4\uff0c\u6b64\u5904\u4e0d\u518d\u91cd\u590d"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u5728 ",(0,d.jsx)(n.code,{children:"192.168.137.122"})," ",(0,d.jsx)(n.code,{children:"192.168.137.123"})," \u9700\u8981\u6309\u7167 \u3010\u516d\u3011 \u7684\u6b65\u9aa4\u5b89\u88c5\u914d\u7f6eHAProxy keepalived"]}),"\n",(0,d.jsx)(n.h3,{id:"82-\u73af\u5883\u68c0\u67e5",children:"8.2 \u73af\u5883\u68c0\u67e5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bDocker\u7248\u672c\ndocker version\n\n# \u67e5\u770bK8s\u7248\u672c\nkubeadm version \n\nkubectl version --client\n\nkubelet --version\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(86603).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h3,{id:"83-\u52a0\u5165master\u8282\u70b9",children:"8.3 \u52a0\u5165Master\u8282\u70b9"}),"\n",(0,d.jsx)(n.h4,{id:"831-\u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684token",children:"8.3.1 \u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684Token"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5728Master\u8282\u70b9\u6253\u5370\u52a0\u5165\u8282\u70b9\u6307\u4ee4\nsudo kubeadm token create --print-join-command\n\n# \u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\nkubeadm join 192.168.137.140:16443 --token lp0sqf.ikkxltrxmirs15zn \\\n  --discovery-token-ca-cert-hash sha256:1dfe993019b8a38fa80357e0a91490c7e2fc0ab3a0a3b16ddc4c7644af04a4ae\n\n"})}),"\n",(0,d.jsx)(n.h4,{id:"832-\u521d\u59cb\u5316master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230-etcd-\u4e2d",children:"8.3.2 \u521d\u59cb\u5316Master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230 etcd \u4e2d"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u5728Master\u8282\u70b9\u6267\u884c\u4e0a\u4f20\u8bc1\u4e66\u6307\u4ee4\nsudo kubeadm init phase upload-certs --upload-certs\n\n# \u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\n[diginn@k8s-master-01 k8s]$ sudo kubeadm init phase upload-certs --upload-certs\nI0326 14:09:10.693417   10336 version.go:256] remote version is much newer: v1.32.3; falling back to: stable-1.30\n[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace\n[upload-certs] Using certificate key:\n273174b4ecf9ae7ea9e366cbfe26895f5de0e5a41f1aca60a52a86bc59d10758\n\n'})}),"\n",(0,d.jsx)(n.h4,{id:"833-\u52a0\u5165\u65b0\u7684master\u8282\u70b9",children:"8.3.3 \u52a0\u5165\u65b0\u7684Master\u8282\u70b9"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"sudo kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \\\n        --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1 \\\n        --control-plane --certificate-key 3f3d619638bb3cb780d9a54bc2153d61996c9a367d79e8f584992fa961d2659b \\\n        --cri-socket=unix:///var/run/cri-dockerd.sock\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u8981\u52a0\u4e0a",(0,d.jsx)(n.code,{children:"-control-plane"})," ",(0,d.jsx)(n.code,{children:"--certificate-key"})," \uff0c\u4e0d\u7136\u5c31\u4f1a\u6dfb\u52a0\u4e3anode\u8282\u70b9\u800c\u4e0d\u662fmaster"]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(33104).A+"",width:"1676",height:"917"}),"\n",(0,d.jsx)(n.img,{src:s(13657).A+"",width:"1676",height:"917"})]}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(20582).A+"",width:"1676",height:"917"}),"\n",(0,d.jsx)(n.img,{src:s(59599).A+"",width:"1676",height:"917"})]}),"\n",(0,d.jsx)(n.h3,{id:"84-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",children:"8.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(40692).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h2,{id:"\u4e5d\u6240\u6709node\u8282\u70b9node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",children:"\u4e5d\u3001\u3010\u6240\u6709Node\u8282\u70b9\u3011Node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4"}),"\n",(0,d.jsx)(n.h3,{id:"91-node\u8282\u70b9\u521d\u59cb\u5316",children:"9.1 Node\u8282\u70b9\u521d\u59cb\u5316"}),"\n",(0,d.jsx)(n.p,{children:"\u6309\u987a\u5e8f\u6267\u884c\u4e0a\u9762 \u3010\u4e09\u3001\u56db\u3001\u4e94\u3011 \u7684\u6240\u6709\u914d\u7f6e\u53ca\u5b89\u88c5\u547d\u4ee4\uff0c\u6b64\u5904\u4e0d\u518d\u91cd\u590d"}),"\n",(0,d.jsx)(n.h3,{id:"92-\u73af\u5883\u68c0\u67e5",children:"9.2 \u73af\u5883\u68c0\u67e5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bDocker\u7248\u672c\ndocker version\n\n# \u67e5\u770bK8s\u7248\u672c\nkubeadm version \n\nkubectl version --client\n\nkubelet --version\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(68037).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h3,{id:"93-\u52a0\u5165node\u8282\u70b9",children:"9.3 \u52a0\u5165Node\u8282\u70b9"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5728Master\u8282\u70b9\u6253\u5370\u52a0\u5165\u8282\u70b9\u6307\u4ee4\nkubeadm token create --print-join-command\n\n# \u6307\u5b9a\u8fd0\u884c\u65f6\uff08\u6dfb\u52a0--cri-socket\u53c2\u6570\uff09\nsudo kubeadm join 192.168.137.140:16443 --token qcijsr.wrehhv9qqqic9ce6 \\\n  --discovery-token-ca-cert-hash sha256:19a7d01e6cb761d17cbd3fae2bd40ebb25eeb833ad12c3110b5c0f26057e46f1 \\\n  --cri-socket=unix:///var/run/cri-dockerd.sock\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(49262).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h3,{id:"94-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",children:"9.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165"}),"\n",(0,d.jsxs)(n.p,{children:["\u7531\u4e8e\u9700\u8981\u7b49\u5f85 ",(0,d.jsx)(n.code,{children:"Master"})," \u4e0b\u53d1\u955c\u50cf\u53caPod\u542f\u52a8\uff0c\u9700\u8981\u7b49\u5f852\u5206\u949f\u5de6\u53f3Node\u7684\u72b6\u6001\u624d\u4f1a\u53d8\u6210",(0,d.jsx)(n.code,{children:"Ready"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(39255).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h2,{id:"\u5341\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f",children:"\u5341\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f"}),"\n",(0,d.jsx)(n.h3,{id:"101-\u5f00\u653e\u7aef\u53e3calico",children:"10.1 \u5f00\u653e\u7aef\u53e3(calico)"}),"\n",(0,d.jsx)(n.p,{children:"\u6839\u636e\u5b89\u88c5\u7684\u7f51\u7edc\u63d2\u4ef6\u4e0d\u540c\uff0c\u8fd9\u91cc\u9700\u8981\u5f00\u653e\u7684\u7aef\u53e3\u4e5f\u4e0d\u540c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# BGP \u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=179/tcp\n\n# \u6839\u636e\u5c01\u88c5\u6a21\u5f0f\u9009\u62e9 IP-in-IP \u6216 VXLAN\n# IP-in-IP\nsudo firewall-cmd --permanent --add-rich-rule='rule protocol value=\"4\" accept'\n# \u6216 VXLAN\nsudo firewall-cmd --permanent --add-port=8472/udp\n\n# Typha \u7aef\u53e3\uff08\u82e5\u542f\u7528\uff09\nsudo firewall-cmd --permanent --add-port=5473/tcp\n\n# \u6307\u6807\u7aef\u53e3\uff08\u6309\u9700\uff09\nsudo firewall-cmd --permanent --add-port=9099/tcp\nsudo firewall-cmd --permanent --add-port=9091/tcp\n\n# CoreDNS\u9700\u8981\u7684\u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=53/udp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-port\n\n# \u67e5\u770b\u9632\u706b\u5899\u6240\u6709\u89c4\u5219\nsudo firewall-cmd --list-all\n"})}),"\n",(0,d.jsx)(n.h3,{id:"102-\u5b89\u88c5calico\u7f51\u7edc\u670d\u52a1",children:"10.2 \u5b89\u88c5Calico\u7f51\u7edc\u670d\u52a1"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'mkdir -p ~/k8s-install/calico/ && cd ~/k8s-install/\n\n# \u4e0b\u8f7dcalico.yaml\n# wget https://raw.githubusercontent.com/projectcalico/calico/refs/heads/release-v3.25/manifests/calico.yaml -0 ./calico/calico.yaml\ncurl -sSLf https://docs.tigera.io/archive/v3.25/manifests/calico.yaml -o ./calico/calico.yaml\n\n# \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 CALICO_IPV4POOL_CIDR\nsudo vim ./calico/calico.yaml\n\n# \u5728 CLUSTER_TYPE \u540e\u6dfb\u52a0 IP_AUTODETECTION_METHOD value \u4e3a\u7f51\u5361\u540d\u79f0\n# Cluster type to identify the deployment type\n- name: CLUSTER_TYPE\n  value: "k8s,bgp"\n- name: IP_AUTODETECTION_METHOD\n  value: "interface=enp0s3"\n\n# ...\n\n# \u6b64\u5904value\u548ckubeadm init\u7684 --pod-network-cidr \u4e00\u81f4\n# - name: CALICO_IPV4POOL_CIDR\n#   value: "192.168.0.0/16"\n- name: CALICO_IPV4POOL_CIDR\n  value: "10.244.0.0/16"\n\n# \u542f\u52a8calico\nkubectl apply -f ./calico/calico.yaml\n\n# \u5982\u679c\u6709\u5f02\u5e38\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u5220\u9664\u91cd\u65b0\u5b89\u88c5\nkubectl delete -f ./calico/calico.yaml\n\n'})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(91909).A+"",width:"1676",height:"916"}),"\n",(0,d.jsx)(n.img,{src:s(91042).A+"",width:"1676",height:"917"})]}),"\n",(0,d.jsx)(n.h3,{id:"103-\u68c0\u67e5\u8282\u70b9\u72b6\u6001",children:"10.3 \u68c0\u67e5\u8282\u70b9\u72b6\u6001"}),"\n",(0,d.jsx)(n.p,{children:"\u7b49\u5f85 calico \u5bb9\u5668\u955c\u50cf\u4e0b\u8f7d\u542f\u52a8\u5b8c\u6210\uff0c\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(54699).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h3,{id:"104-\u68c0\u67e5coredns\u662f\u5426\u6b63\u5e38",children:"10.4 \u68c0\u67e5CoreDNS\u662f\u5426\u6b63\u5e38"}),"\n",(0,d.jsxs)(n.p,{children:["\u5b89\u88c5 Pod \u7f51\u7edc\u540e\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728 ",(0,d.jsx)(n.code,{children:"kubectl get pods --all-namespaces"})," \u8f93\u51fa\u4e2d\u68c0\u67e5 CoreDNS Pod \u662f\u5426 Running \u6765\u786e\u8ba4\u5176\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u3002 \u4e00\u65e6 CoreDNS Pod \u542f\u7528\u5e76\u8fd0\u884c\uff0c\u4f60\u5c31\u53ef\u4ee5\u7ee7\u7eed\u52a0\u5165\u8282\u70b9\u3002"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get pods --all-namespaces | grep coredns\n\n# \u67e5\u770b\u65e5\u5fd7\u53ca\u72b6\u6001\nkubectl logs -n kube-system coredns-cb4864fb5-4mj8d\n\nkubectl describe pod -n kube-system coredns-cb4864fb5-4mj8d\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"105-\u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb",children:"10.5 \u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb"}),"\n",(0,d.jsx)(n.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u51fa\u4e8e\u5b89\u5168\u539f\u56e0\uff0c\u4f60\u7684\u96c6\u7fa4\u4e0d\u4f1a\u5728\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\u3002 \u5982\u679c\u4f60\u5e0c\u671b\u80fd\u591f\u5728\u5355\u673a Kubernetes \u96c6\u7fa4\u7b49\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\uff0c\u8bf7\u8fd0\u884c\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u5141\u8bb8pod\u8fd0\u884c\u5728\u63a7\u5236\u5e73\u9762\u8282\u70b9\nkubectl taint nodes --all node-role.kubernetes.io/control-plane-\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"106-\u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\u65b9\u4fbf\u7ba1\u7406",children:"10.6 \u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\uff0c\u65b9\u4fbf\u7ba1\u7406"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u67e5\u770b\u5f53\u524d\u6709\u6548\u671f"}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u6709\u6548\u671f\nopenssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not\n\n# \u8f93\u51fa\u4ee5\u4e0b\u7ed3\u679c\uff0c\u9ed8\u8ba4\u53ea\u6709\u4e00\u5e74\u7684\u6709\u6548\u671f\n[diginn@k8s-master-01 k8s]$ openssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not\n            Not Before: Mar 26 07:14:03 2025 GMT\n            Not After : Mar 26 07:19:03 2026 GMT\n\n# \u67e5\u770b\u5404\u9879\u670d\u52a1\u8bc1\u4e66\u7684\u6709\u6548\u671f\nsudo kubeadm certs check-expiration\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(30198).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsxs)(n.ol,{start:"2",children:["\n",(0,d.jsxs)(n.li,{children:["\u5ef6\u957f\u8bc1\u4e66\u6709\u6548\u671f",(0,d.jsx)(n.a,{href:"https://github.com/yuyicai/update-kube-cert",children:"\u66f4\u65b0K8s\u8bc1\u4e66\u6709\u6548\u671f\u811a\u672c"})]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"cd ~/k8s-install/\n\n# \u4e0b\u8f7d\u811a\u672c\nwget https://raw.githubusercontent.com/yuyicai/update-kube-cert/refs/heads/master/update-kubeadm-cert.sh  -O ./update-kubeadm-cert.sh\n\n# \u6267\u884c\u811a\u672c\nchmod +x ./update-kubeadm-cert.sh\nsudo ./update-kubeadm-cert.sh all\n\n# \u67e5\u770b\u6709\u6548\u671f\nopenssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not\n\n# \u67e5\u770b\u5404\u9879\u670d\u52a1\u8bc1\u4e66\u7684\u6709\u6548\u671f\nsudo kubeadm certs check-expiration\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(44173).A+"",width:"1676",height:"917"}),"\n",(0,d.jsx)(n.img,{src:s(90276).A+"",width:"1676",height:"917"})]}),"\n",(0,d.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c\u670d\u52a1\u53caCA\u8bc1\u4e66\u90fd\u5ef6\u957f\u5230\u4e8610\u5e74"}),"\n",(0,d.jsx)(n.h2,{id:"\u5341\u4e00\u5b89\u88c5dashboard",children:"\u5341\u4e00\u3001\u5b89\u88c5Dashboard"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.cnblogs.com/baoshu/p/13296659.html",children:"kubernetes\u7cfb\u5217(\u5341\u516d) - Helm\u5b89\u88c5\u548c\u5165\u95e8"})}),"\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.cnblogs.com/baoshu/p/13326480.html",children:"kubernetes\u7cfb\u5217(\u5341\u4e03) - \u901a\u8fc7helm\u5b89\u88c5dashboard\u8be6\u7ec6\u6559\u7a0b"})}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"Kubernetes\u4eea\u8868\u677f\u662fKubernetes\u96c6\u7fa4\u7684\u901a\u7528\u3001\u57fa\u4e8eWeb\u7684UI\u3002\u5b83\u5141\u8bb8\u7528\u6237\u7ba1\u7406\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u5e76\u5bf9\u5176\u8fdb\u884c\u6545\u969c\u6392\u9664\uff0c\u4ee5\u53ca\u7ba1\u7406\u96c6\u7fa4\u672c\u8eab\u3002"}),"\n",(0,d.jsx)(n.p,{children:"\u4ece7.x\u7248\u5f00\u59cb\uff0c\u4e0d\u518d\u652f\u6301\u57fa\u4e8eManifest\u7684\u5b89\u88c5\u3002\u73b0\u5728\u53ea\u652f\u6301\u57fa\u4e8eHelm\u7684\u5b89\u88c5\u3002\u7531\u4e8e\u591a\u5bb9\u5668\u8bbe\u7f6e\u548c\u5bf9Kong\u7f51\u5173API\u4ee3\u7406\u7684\u4e25\u91cd\u4f9d\u8d56 \u8981\u8f7b\u677e\u652f\u6301\u57fa\u4e8e\u6e05\u5355\u5b89\u88c5\u662f\u4e0d\u53ef\u884c\u7684\u3002"}),"\n",(0,d.jsx)(n.h3,{id:"111-helm\u5b89\u88c5",children:"11.1 Helm\u5b89\u88c5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'mkdir -p ~/k8s-install/helm/ && cd ~/k8s-install/\n\n# Helm \u4e0b\u8f7d\nwget https://get.helm.sh/helm-v3.17.2-linux-amd64.tar.gz -O ./helm/helm-v3.17.2-linux-amd64.tar.gz\n\n# \u89e3\u538b\ntar -zxvf ./helm/helm-v3.17.2-linux-amd64.tar.gz\n\n# \u79fb\u52a8\u5230bin\u76ee\u5f55\nsudo mv ./linux-amd64/helm  /usr/bin/\n\n# \u67e5\u770b\u7248\u672c\nhelm version\n\n# \u5b89\u88c5\u547d\u4ee4\u8865\u5168\nsudo yum install -y bash-completion\n\necho "source <(helm completion bash)" >> ~/.bashrc\n\n'})}),"\n",(0,d.jsx)(n.h3,{id:"112-\u4ec5\u5728\u7ebf\u914d\u7f6edashboard\u4ed3\u5e93\u5e76\u62c9\u53d6\u9ed8\u8ba4\u914d\u7f6e",children:"11.2 \u3010\u4ec5\u5728\u7ebf\u3011\u914d\u7f6eDashboard\u4ed3\u5e93\u5e76\u62c9\u53d6\u9ed8\u8ba4\u914d\u7f6e"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u6dfb\u52a0helmhub\u4e0a\u7684dashboard\u5b98\u65b9repo\u4ed3\u5e93\nhelm repo add kubernetes-dashboard https://kubernetes.github.io/dashboard/\n\n# \u67e5\u770b\u6dfb\u52a0\u5b8c\u6210\u540e\u7684\u4ed3\u5e93\nhelm repo list\n\n# \u67e5\u8be2dashboard\u7684chart\nhelm search repo kubernetes-dashboard\n\n# \u65b0\u5efa\u6587\u4ef6\u5939\u7528\u4e8e\u4fdd\u5b58chart\nmkdir -p dashboard-chart && cd dashboard-chart\n\n# \u62c9\u53d6chart\nhelm pull kubernetes-dashboard/kubernetes-dashboard\n\n# \u6b64\u65f6\u4f1a\u6709\u4e00\u4e2a\u538b\u7f29\u5305\uff0c\u9ed8\u8ba4\u4e0b\u8f7d\u7684\u662f\u6700\u65b0\u7248\u672c\uff0c\u53ef\u80fd\u4e0ekubernates\u7248\u672c\u4e0d\u517c\u5bb9\uff0c\u9700\u8981\u53bbgithub\u786e\u8ba4\ntar -zxvf kubernetes-dashboard-7.11.1.tgz\n\n# \u8fdb\u5165\u5230\u89e3\u538b\u540e\u7684\u6587\u4ef6\u5939\ncd kubernetes-dashboard\n\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u679c\u4e0b\u8f7d\u8f83\u6162\uff0c\u53ef\u4ee5\u4eceGithub\u76f4\u63a5\u4e0b\u8f7d\u540e\u4e0a\u4f20\u5230\u670d\u52a1\u5668"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"mkdir -p ~/k8s-install/dashboard/ && cd ~/k8s-install/\n\n# \u6700\u540e\u4e00\u4e2a\u786e\u8ba4\u652f\u6301 kubernates 1.30 \u7684 dashboard \u7248\u672c \nwget https://github.com/kubernetes/dashboard/releases/download/kubernetes-dashboard-7.7.0/kubernetes-dashboard-7.7.0.tgz -O ./dashboard/kubernetes-dashboard-7.7.0.tgz\n\n# \u5b89\u88c5\u6240\u9700\u7684\u5bb9\u5668\u955c\u50cf\u4e5f\u53ef\u4ee5\u5728 release\u9875\u9762\u627e\u5230 https://github.com/kubernetes/dashboard/releases/tag/kubernetes-dashboard-7.7.0\ndocker pull kubernetesui/dashboard-api:1.8.1\ndocker pull kubernetesui/dashboard-auth:1.1.3\ndocker pull kubernetesui/dashboard-metrics-scraper:1.1.1\ndocker pull kubernetesui/dashboard-web:1.4.0\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"113-\u4fee\u6539dashboard\u914d\u7f6e\u5e76\u5b89\u88c5",children:"11.3 \u4fee\u6539Dashboard\u914d\u7f6e\u5e76\u5b89\u88c5"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u89e3\u538b\ntar -zxvf ./dashboard/kubernetes-dashboard-7.7.0.tgz\ncd kubernetes-dashboard\n\n# \u5907\u4efd\u539f\u59cb\u914d\u7f6e\u6587\u4ef6\ncp values.yaml values.yaml.bakup\n\n# \u4fee\u6539\u914d\u7f6e\nvim values.yaml\n\n# \u5982\u679c\u4f7f\u7528Nginx\u4ee3\u7406\uff0c\u53ef\u4ee5\u5728\u6b64\u5904\u914d\u7f6e\u57df\u540d\ningress:\n  enabled: false\n  hosts:\n    # Keep 'localhost' host only if you want to access Dashboard using 'kubectl port-forward ...' on:\n    # https://localhost:8443\n    - dashboard.example.com\n\n\n# \u5b89\u88c5Dashboard  \u6267\u884c\u8def\u5f84\u5728values.yaml\u76ee\u5f55\nhelm install kubernetes-dashboard . --create-namespace --namespace kubernetes-dashboard -f values.yaml\n\n# \u67e5\u770bHelm\u90e8\u7f72\u7684\u8d44\u6e90\nhelm ls --namespace kubernetes-dashboard\n\n# \u67e5\u770bdashboard pod\nkubectl get pods -n kubernetes-dashboard -o wide\n\n# \u67e5\u770b\u670d\u52a1\u7aef\u53e3\u4fe1\u606f\nkubectl get svc -n kubernetes-dashboard\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(3181).A+"",width:"1676",height:"916"})}),"\n",(0,d.jsx)(n.h3,{id:"114-\u521b\u5efatoken",children:"11.4 \u521b\u5efaToken"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'cat > dashboard-adminuser.yaml << EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n  - kind: ServiceAccount\n    name: admin-user\n    namespace: kubernetes-dashboard\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: "admin-user"\ntype: kubernetes.io/service-account-token\nEOF\n\n# \u521b\u5efa\u8d26\u6237 \u6388\u4e88\u89d2\u8272\u6743\u9650 \u521b\u5efaToken\nkubectl apply -f dashboard-adminuser.yaml\n\n# \u83b7\u53d6token\nkubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={".data.token"} | base64 -d\n\neyJhbGciOiJSUzI1NiIsImtpZCI6IjJtWTBjMHlsN2tSVkVaamI1WGU0YTZkMi1EclRfUXdBLUdnR3VFRDl1QTAifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIyZDAxMDdkYy04YTk3LTQ2YjItOTMwMC1iOGMyNGIzZTdkNGEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.k9ndYMW8yKPkZUg-EXkNDM9Uye7OdbZAo5JvfEb9Nad77KQigh6tCplWeYNXuOzjo0H1s7Huy4Jkwv5z7fvybI_y7RjjOGrtTnrYXEsMlXi7y8Gm0YYthnCiYYBU-Jwkk6rreJOpHoJ2hjryQgfQx3rS85fBtn8KdjronMFor3ZTCqSk1QTI387EzOgnLJ5YbJLdQJVCxheIr6Aso6bwKYk7H9lDKCP684cgsYJ-ZbRuYe2Ec-Mr2u_OvoLckGgojJSqNbVJ1zMBs9sHxuEBYut-TvpdL-HRJDDUTI8Y1mBZlS6l4rYUANcC6qVufQAbQq8FNMB_q3qdQzTxt39hzg\n\nkubectl describe secret -n kubernetes-dashboard $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk \'{print $1}\')\n\n'})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(71414).A+"",width:"1676",height:"916"})}),"\n",(0,d.jsx)(n.h3,{id:"115-\u8bbf\u95eedashboard",children:"11.5 \u8bbf\u95eeDashboard"}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u679c\u9700\u8981\u76f4\u63a5\u4f7f\u7528\u96c6\u7fa4\u7684IP\u7aef\u53e3\u8bbf\u95eeDashboard\uff0c\u6309\u7167\u4e0b\u9762\u914d\u7f6e\u6620\u5c04\u7684\u7aef\u53e3\uff0c\u914d\u7f6e\u5b8c\u6210\u540e\u56de\u91cd\u65b0\u8fd0\u884c\u65b0\u7684\u5bb9\u5668\uff0c\u53ef\u80fd\u9700\u8981\u7b49\u5f85\u51e0\u5206\u949f"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u7f16\u8f91\u7f51\u5173\u5bf9\u5916\u7aef\u53e3\nkubectl edit svc kubernetes-dashboard-kong-proxy -n kubernetes-dashboard\n\n# \u4fee\u6539\u4ee5\u4e0b\u5185\u5bb9\nspec:\n  type: NodePort\n  ports:\n  - name: kong-proxy-tls\n    nodePort: 30443\n    port: 443\n    protocol: TCP\n    targetPort: 8443\n\n# \u68c0\u67e5\u7aef\u53e3\nkubectl get svc -n kubernetes-dashboard\n\n# \u67e5\u770bkong-proxy\u6240\u5728\u7684\u8282\u70b9\nkubectl get pods -n kubernetes-dashboard -o wide\n\nkubectl logs -n kubernetes-dashboard kubernetes-dashboard-kong-7696bb8c88-c2qkt\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(25215).A+"",width:"1676",height:"916"})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95ee ",(0,d.jsx)(n.code,{children:"https://192.168.137.131:30443"}),"\uff0c\u8f93\u5165\u524d\u9762\u751f\u6210\u7684Token\u5373\u53ef\u8bbf\u95ee\u9875\u9762"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(97184).A+"",width:"1892",height:"972"})}),"\n",(0,d.jsx)(n.h3,{id:"116-\u5220\u9664dashboard",children:"11.6 \u5220\u9664Dashboard"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:'# \u7528Helm\u5378\u8f7d Dashboard\n[diginn@k8s-master-01 k8s]$ helm -n kubernetes-dashboard uninstall kubernetes-dashboard\nrelease "kubernetes-dashboard" uninstalled\n[diginn@k8s-master-01 k8s]$\n\n# \u68c0\u67e5pod\u662f\u5426\u5b58\u5728\n[diginn@k8s-master-01 k8s]$ kubectl -n kubernetes-dashboard get pods\nNo resources found in kubernetes-dashboard namespace.\n[diginn@k8s-master-01 k8s]$\n\n# \u68c0\u67e5service\u662f\u5426\u5b58\u5728\n[diginn@k8s-master-01 k8s]$ kubectl -n kubernetes-dashboard get svc\nNo resources found in kubernetes-dashboard namespace.\n[diginn@k8s-master-01 k8s]$\n\n# \u5220\u9664\u547d\u540d\u7a7a\u95f4\n[diginn@k8s-master-01 k8s]$ kubectl delete namespace kubernetes-dashboard\nnamespace "kubernetes-dashboard" deleted\n\n'})}),"\n",(0,d.jsx)(n.h2,{id:"\u5341\u4e8c\u5e38\u7528\u547d\u4ee4",children:"\u5341\u4e8c\u3001\u5e38\u7528\u547d\u4ee4"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://www.cnblogs.com/kangao/p/17526694.html",children:"k8s \u64cd\u4f5c\u547d\u4ee4 \u5408\u96c6"})}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"\u521d\u59cb\u5316\u5e38\u7528",children:"\u521d\u59cb\u5316\u5e38\u7528"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u91cd\u7f6e\u5f53\u524d\u8282\u70b9 \u5c06 kubeadm init \u53ca  kubeadm join\u751f\u6210\u7684\u5185\u5bb9\u91cd\u7f6e\nsudo kubeadm reset --cri-socket=unix:///var/run/cri-dockerd.sock\n\n# \u83b7\u53d6\u6240\u6709\u8282\u70b9\nkubectl get nodes\n\n# \u83b7\u53d6\u6240\u6709Pod\nkubectl get pods --all-namespaces\n\n# \u521b\u5efa\u8d44\u6e90\u5bf9\u8c61\nkubectl create -f calico.yaml\n\n# \u5220\u9664\u8d44\u6e90\u5bf9\u8c61\nkubectl delete -f calico.yaml\n\nkubectl logs -n kube-system calico-node-hqf25\n"})}),"\n",(0,d.jsx)(n.h3,{id:"121-\u57fa\u7840\u64cd\u4f5c\u547d\u4ee4",children:"12.1 \u57fa\u7840\u64cd\u4f5c\u547d\u4ee4"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get pods -o=json\nkubectl get pods -o=yaml\nkubectl get pods -o=wide\nkubectl get pods -n=<namespace_name>\nkubectl create -f ./\nkubectl logs -l name=\n"})}),"\n",(0,d.jsx)(n.h3,{id:"122-\u8d44\u6e90\u76f8\u5173",children:"12.2 \u8d44\u6e90\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u8d44\u6e90\u5bf9\u8c61\nkubectl create -f <file.yaml>\n\n# \u5220\u9664\u8d44\u6e90\u5bf9\u8c61\nkubectl delete -f <file.yaml>\n"})}),"\n",(0,d.jsx)(n.h3,{id:"123-\u96c6\u7fa4\u76f8\u5173",children:"12.3 \u96c6\u7fa4\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl cluster-info \u2013 Display endpoint information about the master and services in the cluster.\nkubectl version \u2013 Display the Kubernetes version running on the client and server.\nkubectl config view \u2013 Get the configuration of the cluster.\nkubectl config view -o jsonpath='{.users[*].name}' \u2013 Get a list of users.\nkubectl config current-context \u2013 Display the current context.\nkubectl config get-contexts \u2013 Display a list of contexts.\nkubectl config use-context \u2013 Set the default context.\nkubectl api-resources \u2013 List the API resources that are available.\nkubectl api-versions \u2013 List the API versions that are available. kubectl get all --all-namespaces\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"124-daemonsets-\u76f8\u5173",children:"12.4 Daemonsets \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get daemonset \u2013 List one or more daemonsets.\nkubectl edit daemonset <daemonset_name> \u2013 Edit and update the definition of one or more daemonset.\nkubectl delete daemonset <daemonset_name> \u2013 Delete a daemonset.\nkubectl create daemonset <daemonset_name> \u2013 Create a new daemonset.\nkubectl rollout daemonset \u2013 Manage the rollout of a daemonset.\nkubectl describe ds <daemonset_name> -n <namespace_name> \u2013 Display the detailed state of daemonsets within a namespace.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"125-deployments\u76f8\u5173",children:"12.5 Deployments\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get deployment \u2013 List one or more deployments.\nkubectl describe deployment <deployment_name> \u2013 Display the detailed state of one or more deployments.\nkubectl edit deployment <deployment_name> \u2013 Edit and update the definition of one or more deployments on the server.\nkubectl create deployment <deployment_name> \u2013 Create a new deployment.\nkubectl delete deployment <deployment_name> \u2013 Delete deployments.\nkubectl rollout status deployment <deployment_name> \u2013 See the rollout status of a deployment.\nkubectl set image deployment/ =image: \u2013 Perform a rolling update (K8S default), set the image of the container to a new version for a particular deployment.\nkubectl rollout undo deployment/ \u2013 Rollback a previous deployment.\nkubectl replace --force -f \u2013 Perform a replace deployment \u2014 Force replace, delete and then re-create the resource.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"126-\u4e8b\u4ef6\u76f8\u5173",children:"12.6 \u4e8b\u4ef6\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get events \u2013 List recent events for all resources in the system.\nkubectl get events \u2013field-selector type=Warning \u2013 List Warnings only.\nkubectl get events --sort-by=.metadata.creationTimestamp \u2013 List events sorted by timestamp.\nkubectl get events --field-selector involvedObject.kind!=Pod \u2013 List events but exclude Pod events.\nkubectl get events --field-selector involvedObject.kind=Node, involvedObject.name=<node_name> \u2013 Pull events for a single node with a specific name.\nkubectl get events --field-selector type!=Normal \u2013 Filter out normal events from a list of events.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"127-\u65e5\u5fd7\u76f8\u5173",children:"12.7 \u65e5\u5fd7\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl logs <pod_name> \u2013 Print the logs for a pod.\nkubectl logs --since=6h <pod_name> \u2013 Print the logs for the last 6 hours for a pod.\nkubectl logs --tail=50 <pod_name> \u2013 Get the most recent 50 lines of logs.\nkubectl logs -f <service_name> [-c <$container>] \u2013 Get logs from a service and optionally select which container.\nkubectl logs -f <pod_name> \u2013 Print the logs for a pod and follow new logs.\nkubectl logs -c <container_name> <pod_name> \u2013 Print the logs for a container in a pod.\nkubectl logs <pod_name> pod.log \u2013 Output the logs for a pod into a file named \u2018pod.log'.\nkubectl logs --previous <pod_name> \u2013 View the logs for a previously failed pod.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"128-namespace-\u76f8\u5173",children:"12.8 Namespace \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl create namespace <namespace_name> \u2013 Create a namespace.\nkubectl get namespace <namespace_name> \u2013 List one or more namespaces.\nkubectl describe namespace <namespace_name> \u2013 Display the detailed state of one or more namespaces.\nkubectl delete namespace <namespace_name> \u2013 Delete a namespace.\nkubectl edit namespace <namespace_name> \u2013 Edit and update the definition of a namespace.\nkubectl top namespace <namespace_name> \u2013 Display Resource (CPU/Memory/Storage) usage for a namespace.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"129-nodes-\u76f8\u5173",children:"12.9 Nodes \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl taint node <node_name> \u2013 Update the taints on one or more nodes.\nkubectl get node \u2013 List one or more nodes.\nkubectl delete node <node_name> \u2013 Delete a node or multiple nodes.\nkubectl top node <node_name> \u2013 Display Resource usage (CPU/Memory/Storage) for nodes.\nkubectl get pods -o wide | grep <node_name> \u2013 Pods running on a node.\nkubectl annotate node <node_name> \u2013 Annotate a node.\nkubectl cordon node <node_name> \u2013 Mark a node as unschedulable.\nkubectl uncordon node <node_name> \u2013 Mark node as schedulable.\nkubectl drain node <node_name> \u2013 Drain a node in preparation for maintenance.\nkubectl label node \u2013 Add or update the labels of one or more nodes.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1210-pods-\u64cd\u4f5c\u76f8\u5173",children:"12.10 Pods \u64cd\u4f5c\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get pod \u2013 List one or more pods.\nkubectl get pods --sort-by='.status.containerStatuses[0].restartCount' \u2013 List pods Sorted by Restart Count.\nkubectl get pods --field-selector=status.phase=Running \u2013 Get all running pods in the namespace.\nkubectl delete pod <pod_name> \u2013 Delete a pod.\nkubectl describe pod <pod_name> \u2013 Display the detailed state of a pods.\nkubectl create pod <pod_name> \u2013 Create a pod.\nkubectl exec <pod_name> -c <container_name> \u2013 Execute a command against a container in a pod. Read more: Using Kubectl Exec: Connect to Your Kubernetes Containers\nkubectl exec -it <pod_name> /bin/sh \u2013 Get an interactive shell on a single-container pod.\nkubectl top pod \u2013 Display Resource usage (CPU/Memory/Storage) for pods.\nkubectl annotate pod <pod_name> \u2013 Add or update the annotations of a pod.\nkubectl label pods <pod_name> new-label= \u2013 Add or update the label of a pod.\nkubectl get pods --show-labels \u2013 Get pods and show labels.\nkubectl port-forward : \u2013 Listen on a port on the local machine and forward to a port on a specified pod.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1211-replication-controller-\u76f8\u5173",children:"12.11 Replication Controller \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get rc \u2013 List the replication controllers.\nkubectl get rc --namespace=\u201d<namespace_name>\u201d \u2013 List the replication controllers by namespace.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1212-replicasets-\u76f8\u5173",children:"12.12 ReplicaSets \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get replicasets \u2013 List ReplicaSets.\nkubectl describe replicasets <replicaset_name> \u2013 Display the detailed state of one or more ReplicaSets.\nkubectl scale --replicas=[x] \u2013 Scale a ReplicaSet.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1213-sercrets-\u76f8\u5173",children:"12.13 Sercrets \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl create secret \u2013 Create a secret.\nkubectl get secrets \u2013 List secrets.\nkubectl describe secrets \u2013 List details about secrets.\nkubectl delete secret <secret_name> \u2013 Delete a secret.\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1214-services-\u76f8\u5173",children:"12.14 Services \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get services \u2013 List one or more services.\nkubectl describe services \u2013 Display the detailed state of a service.\nkubectl expose deployment [deployment_name] \u2013 Expose a replication controller, service, deployment, or pod as a new Kubernetes service.\nkubectl edit services \u2013 Edit and update the definition of one or more services\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1215-service-account\u76f8\u5173",children:"12.15 Service Account\u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get serviceaccounts \u2013 List service accounts.\nkubectl describe serviceaccounts \u2013 Display the detailed state of one or more service accounts.\nkubectl replace serviceaccount \u2013 Replace a service account.\nkubectl delete serviceaccount <service_account_name> \u2013 Delete a service account\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1216-statefulsets-\u76f8\u5173",children:"12.16 StatefulSets \u76f8\u5173"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl get statefulset \u2013 List StatefulSet\nkubectl delete statefulset/[stateful_set_name] --cascade=false \u2013 Delete StatefulSet only (not pods).\n\n"})}),"\n",(0,d.jsx)(n.h3,{id:"1217-\u5e38\u7528\u53c2\u6570",children:"12.17 \u5e38\u7528\u53c2\u6570"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u53c2\u6570"}),(0,d.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"-n <namespace>"})}),(0,d.jsxs)(n.td,{children:["\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\uff08\u5982 ",(0,d.jsx)(n.code,{children:"kubectl get pods -n kube-system"}),"\uff09"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"--all-namespaces"})}),(0,d.jsx)(n.td,{children:"\u8de8\u6240\u6709\u547d\u540d\u7a7a\u95f4\u64cd\u4f5c"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"-o yaml/json/wide"})}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u8f93\u51fa\u683c\u5f0f"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"--dry-run=client"})}),(0,d.jsx)(n.td,{children:"\u6a21\u62df\u6267\u884c\uff08\u751f\u6210YAML\u4f46\u4e0d\u521b\u5efa\u8d44\u6e90\uff09"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"1218-\u6ce8\u610f\u4e8b\u9879",children:"12.18 \u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,d.jsx)(n.code,{children:"--force --grace-period=0"})," \u5f3a\u5236\u5220\u9664\u8d44\u6e90\u65f6\u9700\u8c28\u614e\uff08\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\uff09\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u67e5\u770b\u65e5\u5fd7\u65f6\uff0c\u82e5Pod\u6709\u591a\u4e2a\u5bb9\u5668\uff0c\u9700\u6307\u5b9a\u5bb9\u5668\u540d\uff1a",(0,d.jsx)(n.code,{children:"kubectl logs <pod-name> -c <container-name>"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u590d\u6742\u64cd\u4f5c\u5efa\u8bae\u4f18\u5148\u4f7f\u7528YAML\u6587\u4ef6\uff08",(0,d.jsx)(n.code,{children:"kubectl apply -f"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"\u5341\u4e09k8s\u7f51\u7edc\u8bbe\u8ba1",children:"\u5341\u4e09\u3001K8s\u7f51\u7edc\u8bbe\u8ba1"}),"\n",(0,d.jsx)(n.p,{children:"\u5728K8s\u7684\u5b89\u88c5\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u6700\u590d\u6742\u4e5f\u6700\u96be\u6392\u67e5\u7684\u95ee\u9898\u901a\u5e38\u90fd\u662f\u7f51\u7edc\u95ee\u9898\uff0cK8s\u7684\u8bbe\u8ba1\u51b3\u5b9a\u4e86\u7f51\u7edc\u7ed3\u6784\u7684\u590d\u6742\u5ea6\uff0c\u53ef\u4ee5\u7528AI\u68b3\u7406\u4e00\u4e0bK8s\u7684\u7f51\u7edc\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"\u7406\u89e3 Kubernetes\uff08K8s\uff09\u7f51\u7edc\u9700\u8981\u4ece\u5b83\u7684\u8bbe\u8ba1\u7406\u5ff5\u3001\u6838\u5fc3\u7ec4\u4ef6\u53ca\u7f51\u7edc\u6a21\u578b\u5165\u624b\u3002K8s \u7f51\u7edc\u6a21\u578b\u65e8\u5728\u89e3\u51b3\u5bb9\u5668\u5316\u5e94\u7528\u4e2d\u590d\u6742\u7684\u901a\u4fe1\u9700\u6c42\uff0c\u4ee5\u4e0b\u662f\u9010\u6b65\u62c6\u89e3\u7684\u5173\u952e\u70b9\uff1a"}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"1-k8s-\u7f51\u7edc\u7684\u6838\u5fc3\u9700\u6c42",children:"1. K8s \u7f51\u7edc\u7684\u6838\u5fc3\u9700\u6c42"}),"\n",(0,d.jsx)(n.p,{children:"K8s \u7f51\u7edc\u9700\u6ee1\u8db3\u4ee5\u4e0b\u57fa\u672c\u6761\u4ef6\uff1a"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Pod \u95f4\u76f4\u63a5\u901a\u4fe1"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u6240\u6709 Pod \u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 IP \u5730\u5740\u901a\u4fe1\uff0c\u65e0\u9700 NAT\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u65e0\u8bba Pod \u662f\u5426\u5728\u540c\u4e00\u8282\u70b9\u4e0a\uff0c\u7f51\u7edc\u5fc5\u987b\u652f\u6301\u8de8\u8282\u70b9\u901a\u4fe1\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8282\u70b9\u4e0e Pod \u901a\u4fe1"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u8282\u70b9\uff08\u7269\u7406\u673a/\u865a\u62df\u673a\uff09\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5176\u4e0a\u7684 Pod\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Service \u62bd\u8c61"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u901a\u8fc7 Service \u4e3a\u4e00\u7ec4 Pod \u63d0\u4f9b\u7a33\u5b9a\u7684\u865a\u62df IP\uff08ClusterIP\uff09\u548c DNS \u540d\u79f0\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u652f\u6301\u8d1f\u8f7d\u5747\u8861\u548c\u6d41\u91cf\u8f6c\u53d1\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5916\u90e8\u8bbf\u95ee"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"Ingress"})," \u6216 ",(0,d.jsx)(n.code,{children:"LoadBalancer"})," \u7c7b\u578b Service \u66b4\u9732\u670d\u52a1\u5230\u96c6\u7fa4\u5916\u90e8\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"2-k8s-\u7f51\u7edc\u6a21\u578b\u8bbe\u8ba1",children:"2. K8s \u7f51\u7edc\u6a21\u578b\u8bbe\u8ba1"}),"\n",(0,d.jsx)(n.p,{children:"K8s \u672c\u8eab\u4e0d\u76f4\u63a5\u5b9e\u73b0\u7f51\u7edc\u529f\u80fd\uff0c\u800c\u662f\u5b9a\u4e49\u4e86\u4e00\u5957\u6807\u51c6\u6a21\u578b\uff0c\u4f9d\u8d56\u63d2\u4ef6\uff08CNI\uff09\u5b9e\u73b0\u3002\u6838\u5fc3\u8bbe\u8ba1\u5982\u4e0b\uff1a"}),"\n",(0,d.jsxs)(n.h4,{id:"1-pod-\u7f51\u7edc",children:["1. ",(0,d.jsx)(n.strong,{children:"Pod \u7f51\u7edc"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u6bcf\u4e2a Pod \u62e5\u6709\u72ec\u7acb IP"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Pod \u5185\u7684\u5bb9\u5668\u5171\u4eab\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff0c\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"localhost"})," \u76f4\u63a5\u901a\u4fe1\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u6bcf\u4e2a Pod \u7684 IP \u5728\u6574\u4e2a\u96c6\u7fa4\u4e2d\u552f\u4e00\uff08\u79f0\u4e3a ",(0,d.jsx)(n.code,{children:"Pod IP"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8de8\u8282\u70b9\u901a\u4fe1"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u4e0d\u540c\u8282\u70b9\u4e0a\u7684 Pod \u53ef\u4ee5\u76f4\u63a5\u901a\u4fe1\uff0c\u65e0\u9700 NAT\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u7531 CNI \u63d2\u4ef6\uff08\u5982 Calico\u3001Flannel\u3001Cilium \u7b49\uff09\u5b9e\u73b0\u5e95\u5c42\u7f51\u7edc\u96a7\u9053\uff08\u5982 VXLAN\u3001IPIP\uff09\u6216\u8def\u7531\u7b56\u7565\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"2-service-\u7f51\u7edc",children:["2. ",(0,d.jsx)(n.strong,{children:"Service \u7f51\u7edc"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Service \u7684\u865a\u62df IP\uff08ClusterIP\uff09"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Service \u4e0d\u662f\u5b9e\u4f53\u7ec4\u4ef6\uff0c\u800c\u662f\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"kube-proxy"})," \u5728\u8282\u70b9\u4e0a\u914d\u7f6e\u7684 iptables/IPVS \u89c4\u5219\u5b9e\u73b0\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u6d41\u91cf\u4ece Service IP \u8f6c\u53d1\u5230\u540e\u7aef Pod\uff08\u8d1f\u8f7d\u5747\u8861\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"DNS \u670d\u52a1\u53d1\u73b0"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["CoreDNS \u4e3a Service \u63d0\u4f9b DNS \u8bb0\u5f55\uff08\u5982 ",(0,d.jsx)(n.code,{children:"my-svc.my-namespace.svc.cluster.local"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"3-\u7f51\u7edc\u63d2\u4ef6cni",children:["3. ",(0,d.jsx)(n.strong,{children:"\u7f51\u7edc\u63d2\u4ef6\uff08CNI\uff09"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"CNI \u7684\u4f5c\u7528"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u8d1f\u8d23\u4e3a Pod \u5206\u914d IP\u3001\u914d\u7f6e\u7f51\u7edc\u63a5\u53e3\u3001\u8def\u7531\u89c4\u5219\u7b49\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u5e38\u89c1\u63d2\u4ef6\uff1aCalico\uff08\u57fa\u4e8e BGP \u8def\u7531\uff09\u3001Flannel\uff08\u57fa\u4e8e VXLAN \u96a7\u9053\uff09\u3001Cilium\uff08\u57fa\u4e8e eBPF\uff09\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u9009\u62e9 CNI \u63d2\u4ef6\u7684\u5f71\u54cd"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u6027\u80fd\uff08\u5982\u5ef6\u8fdf\u3001\u541e\u5410\u91cf\uff09\u3001\u7f51\u7edc\u7b56\u7565\u652f\u6301\uff08NetworkPolicy\uff09\u3001\u591a\u96c6\u7fa4\u4e92\u8054\u80fd\u529b\u7b49\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"4-\u7f51\u7edc\u7b56\u7565networkpolicy",children:["4. ",(0,d.jsx)(n.strong,{children:"\u7f51\u7edc\u7b56\u7565\uff08NetworkPolicy\uff09"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"NetworkPolicy"})," \u5b9a\u4e49 Pod \u95f4\u7684\u901a\u4fe1\u89c4\u5219\uff08\u767d\u540d\u5355\uff09\uff0c\u5b9e\u73b0\u5fae\u670d\u52a1\u7f51\u7edc\u5b89\u5168\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u9700\u8981 CNI \u63d2\u4ef6\u652f\u6301\uff08\u5982 Calico\u3001Cilium\uff09\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"3-\u5173\u952e\u7ec4\u4ef6\u8be6\u89e3",children:"3. \u5173\u952e\u7ec4\u4ef6\u8be6\u89e3"}),"\n",(0,d.jsxs)(n.h4,{id:"1-kube-proxy",children:["1. ",(0,d.jsx)(n.strong,{children:"kube-proxy"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u4f5c\u7528"}),"\uff1a\u7ef4\u62a4\u8282\u70b9\u4e0a\u7684\u7f51\u7edc\u89c4\u5219\uff0c\u5b9e\u73b0 Service \u7684\u6d41\u91cf\u8f6c\u53d1\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5b9e\u73b0\u65b9\u5f0f"}),"\uff1a","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"iptables \u6a21\u5f0f"}),"\uff1a\u901a\u8fc7 iptables \u89c4\u5219\u5339\u914d\u76ee\u6807 IP \u548c\u7aef\u53e3\uff0c\u8f6c\u53d1\u5230\u968f\u673a\u540e\u7aef Pod\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"IPVS \u6a21\u5f0f"}),"\uff1a\u57fa\u4e8e\u5185\u6838\u7684 IP Virtual Server\uff0c\u6027\u80fd\u66f4\u9ad8\uff0c\u9002\u5408\u5927\u89c4\u6a21\u96c6\u7fa4\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"2-coredns",children:["2. ",(0,d.jsx)(n.strong,{children:"CoreDNS"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u4f5c\u7528"}),"\uff1a\u4e3a Service \u548c Pod \u63d0\u4f9b DNS \u89e3\u6790\u670d\u52a1\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8bb0\u5f55\u7c7b\u578b"}),"\uff1a","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"A"})," \u8bb0\u5f55\uff1aService \u7684 ClusterIP\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"SRV"})," \u8bb0\u5f55\uff1a\u670d\u52a1\u7aef\u53e3\u4fe1\u606f\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["Pod \u7684 DNS \u8bb0\u5f55\uff08\u9700\u663e\u5f0f\u914d\u7f6e ",(0,d.jsx)(n.code,{children:"hostname"})," \u548c ",(0,d.jsx)(n.code,{children:"subdomain"}),"\uff09\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"3-ingress-controller",children:["3. ",(0,d.jsx)(n.strong,{children:"Ingress Controller"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u4f5c\u7528"}),"\uff1a\u901a\u8fc7 HTTP/HTTPS \u8def\u7531\u89c4\u5219\u66b4\u9732\u670d\u52a1\u5230\u96c6\u7fa4\u5916\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5e38\u89c1\u5b9e\u73b0"}),"\uff1aNginx Ingress\u3001Traefik\u3001HAProxy\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"4-\u7f51\u7edc\u901a\u4fe1\u793a\u4f8b",children:"4. \u7f51\u7edc\u901a\u4fe1\u793a\u4f8b"}),"\n",(0,d.jsx)(n.p,{children:"\u5047\u8bbe\u96c6\u7fa4\u4e2d\u6709\u4ee5\u4e0b\u8d44\u6e90\uff1a"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["Pod A\uff08IP: ",(0,d.jsx)(n.code,{children:"10.244.1.2"}),"\uff0c\u8282\u70b9: Node1\uff09"]}),"\n",(0,d.jsxs)(n.li,{children:["Pod B\uff08IP: ",(0,d.jsx)(n.code,{children:"10.244.2.3"}),"\uff0c\u8282\u70b9: Node2\uff09"]}),"\n",(0,d.jsxs)(n.li,{children:["Service S\uff08ClusterIP: ",(0,d.jsx)(n.code,{children:"10.96.0.10"}),"\uff0c\u540e\u7aef\u4e3a Pod A \u548c Pod B\uff09"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"1-pod-a--pod-b",children:["1. ",(0,d.jsx)(n.strong,{children:"Pod A \u2192 Pod B"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u76f4\u63a5\u901a\u8fc7 Pod IP ",(0,d.jsx)(n.code,{children:"10.244.2.3"})," \u901a\u4fe1\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"CNI \u63d2\u4ef6\u786e\u4fdd\u8de8\u8282\u70b9\u6d41\u91cf\u901a\u8fc7\u96a7\u9053\u6216\u8def\u7531\u5230\u8fbe\u76ee\u6807\u8282\u70b9\u3002"}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"2-pod-a--service-s",children:["2. ",(0,d.jsx)(n.strong,{children:"Pod A \u2192 Service S"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u8bf7\u6c42\u53d1\u9001\u5230 ",(0,d.jsx)(n.code,{children:"10.96.0.10:80"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"kube-proxy"})," \u901a\u8fc7 iptables/IPVS \u5c06\u6d41\u91cf\u8f6c\u53d1\u5230 Pod A \u6216 Pod B\u3002"]}),"\n"]}),"\n",(0,d.jsxs)(n.h4,{id:"3-\u5916\u90e8\u8bbf\u95ee-service-s",children:["3. ",(0,d.jsx)(n.strong,{children:"\u5916\u90e8\u8bbf\u95ee Service S"})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"NodePort"}),"\uff08\u5982 ",(0,d.jsx)(n.code,{children:"30080"}),"\uff09\u6216 ",(0,d.jsx)(n.code,{children:"LoadBalancer"})," \u7c7b\u578b\u7684 Service\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"Ingress \u63a7\u5236\u5668\u6839\u636e\u57df\u540d\u548c\u8def\u5f84\u8def\u7531\u5230 Service\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"5-\u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5",children:"5. \u5e38\u89c1\u95ee\u9898\u4e0e\u6392\u67e5"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Pod \u65e0\u6cd5\u8de8\u8282\u70b9\u901a\u4fe1"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u68c0\u67e5 CNI \u63d2\u4ef6\u662f\u5426\u5b89\u88c5\uff0c\u8282\u70b9\u9632\u706b\u5899\u662f\u5426\u5f00\u653e VXLAN/BGP \u7aef\u53e3\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Service \u65e0\u6cd5\u8bbf\u95ee"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u68c0\u67e5 ",(0,d.jsx)(n.code,{children:"kube-proxy"})," \u662f\u5426\u8fd0\u884c\uff0ciptables/IPVS \u89c4\u5219\u662f\u5426\u6b63\u786e\u3002"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"DNS \u89e3\u6790\u5931\u8d25\uff08CoreDNS Pending\uff09"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u786e\u4fdd\u7f51\u7edc\u63d2\u4ef6\u5df2\u5b89\u88c5\uff0cCoreDNS Pod \u8c03\u5ea6\u6b63\u5e38\uff08\u5982\u5bb9\u5fcd\u4e3b\u8282\u70b9\u6c61\u70b9\uff09\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h3,{id:"6-\u603b\u7ed3",children:"6. \u603b\u7ed3"}),"\n",(0,d.jsxs)(n.p,{children:["K8s \u7f51\u7edc\u7684\u6838\u5fc3\u662f ",(0,d.jsx)(n.strong,{children:"Pod \u76f4\u63a5\u901a\u4fe1 + Service \u62bd\u8c61 + CNI \u63d2\u4ef6\u5b9e\u73b0"}),"\uff0c\u7406\u89e3\u5176\u5206\u5c42\u6a21\u578b\u548c\u7ec4\u4ef6\u534f\u4f5c\u662f\u5173\u952e\u3002\u5b9e\u9645\u5e94\u7528\u4e2d\u9700\u6839\u636e\u573a\u666f\u9009\u62e9\u5408\u9002\u7684 CNI \u63d2\u4ef6\uff0c\u5e76\u901a\u8fc7 ",(0,d.jsx)(n.code,{children:"kubectl describe"}),"\u3001",(0,d.jsx)(n.code,{children:"kubectl logs"})," \u7b49\u5de5\u5177\u6392\u67e5\u7f51\u7edc\u95ee\u9898\u3002"]}),"\n",(0,d.jsx)(n.h2,{id:"\u5341\u56db\u95ee\u9898",children:"\u5341\u56db\u3001\u95ee\u9898"}),"\n",(0,d.jsxs)(n.h3,{id:"1-\u52a0\u5165\u65b0\u7684master\u8282\u70b9\u65f6\u62a5\u9519-cluster-that-doesnt-have-a-stable-controlplaneendpoint-address",children:["1. \u52a0\u5165\u65b0\u7684Master\u8282\u70b9\u65f6\u62a5\u9519 ",(0,d.jsx)(n.code,{children:"cluster that doesn't have a stable controlPlaneEndpoint address"})]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"[diginn@centos ~]$ sudo kubeadm join 192.168.137.121:6443 --token dvoeut.f4ebwfjuvxfrq8en \\\n>   --discovery-token-ca-cert-hash sha256:6dc91db6dcca58593100b04e03f2f534490fdecdcdb19717775fb7940df32c35 \\\n>   --control-plane --certificate-key a42a3d42d713581b588a689b64cc78c47bed8c320c01e763ccc358abde775918 \\\n>   --cri-socket=unix:///var/run/cri-dockerd.sock\n[sudo] diginn \u7684\u5bc6\u7801\uff1a\n[preflight] Running pre-flight checks\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\nerror execution phase preflight:\nOne or more conditions for hosting a new control plane instance is not satisfied.\n\nunable to add a new control plane instance to a cluster that doesn't have a stable controlPlaneEndpoint address\n\nPlease ensure that:\n* The cluster has a stable controlPlaneEndpoint address.\n* The certificates that must be shared among control plane instances are provided.\n\n\nTo see the stack trace of this error execute with --v=5 or higher\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(30037).A+"",width:"1661",height:"916"})}),"\n",(0,d.jsx)(n.h4,{id:"\u89e3\u51b3",children:"\u89e3\u51b3"}),"\n",(0,d.jsx)(n.p,{children:"\u5982\u679c\u5728\u7b2c\u4e00\u4e2a\u96c6\u7fa4\u4f7f\u7528kubeadm\u521d\u59cb\u5316\u65f6\u6ca1\u6709\u6307\u5b9avip\u5219\u4f1a\u51fa\u73b0\u4e0a\u8ff0\u62a5\u9519"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b ",(0,d.jsx)(n.code,{children:"kubeadm-config.yaml"})]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl -n kube-system get cm kubeadm-config -o yaml | grep controlPlaneEndpoint\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:["\u5982\u679c\u6ca1\u6709\u7b5b\u9009\u5230 ",(0,d.jsx)(n.code,{children:"controlPlaneEndpoint"})," \uff0c\u4ee3\u8868\u521d\u59cb\u5316\u65f6\u6ca1\u6709\u914d\u7f6e"]}),"\n",(0,d.jsxs)(n.ol,{start:"2",children:["\n",(0,d.jsxs)(n.li,{children:["\u7f16\u8f91",(0,d.jsx)(n.code,{children:"kubeadm-config"}),"\uff0c\u6dfb\u52a0",(0,d.jsx)(n.code,{children:"controlPlaneEndpoint"})]}),"\n"]}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"kubectl -n kube-system edit cm kubeadm-config\n\n"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-yaml",children:"data:\n  ClusterConfiguration: |\n    apiServer:\n      timeoutForControlPlane: 4m0s\n    apiVersion: kubeadm.k8s.io/v1beta3\n    certificatesDir: /etc/kubernetes/pki\n    clusterName: kubernetes\n    # \u6b64\u5904\u52a0\u52a0\u5165\u9ad8\u53ef\u7528vip\n    controlPlaneEndpoint: 192.168.137.140:16443\n    controllerManager: {}\n    dns: {}\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(62686).A+"",width:"1661",height:"916"})}),"\n",(0,d.jsx)(n.h3,{id:"2-calico-\u670d\u52a1\u8fd0\u884c\u5f02\u5e38",children:"2. Calico \u670d\u52a1\u8fd0\u884c\u5f02\u5e38"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:(0,d.jsx)(n.a,{href:"https://blog.csdn.net/qq_43024789/article/details/136127430",children:"\u8bb0\u5f55\u4e00\u6b21K8s \u96c6\u7fa4\u6545\u969c\uff08\u8def\u7531&Calico\uff09"})}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u96c6\u7fa4\u5728\u52a0\u5165\u8282\u70b9\u540e ",(0,d.jsx)(n.code,{children:"calico-node"})," \u670d\u52a1\u8fd0\u884c\u72b6\u6001\u5f02\u5e38\n",(0,d.jsx)(n.img,{src:s(98180).A+"",width:"1676",height:"916"})]}),"\n",(0,d.jsx)(n.h4,{id:"\u89e3\u51b3-1",children:"\u89e3\u51b3"}),"\n",(0,d.jsx)(n.p,{children:"calico\u5404\u8282\u70b9\u4e4b\u95f4\u901a\u8baf\u9700\u8981\u5f00\u653e\u4e00\u4e9b\u7aef\u53e3\uff0c\u7aef\u53e3\u5f00\u653e\u540e\u8bbf\u95ee\u6b63\u5e38"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# BGP \u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=179/tcp\n\n# \u6839\u636e\u5c01\u88c5\u6a21\u5f0f\u9009\u62e9 IP-in-IP \u6216 VXLAN\n# IP-in-IP\nsudo firewall-cmd --permanent --add-rich-rule='rule protocol value=\"4\" accept'\n# \u6216 VXLAN\nsudo firewall-cmd --permanent --add-port=8472/udp\n\n# Typha \u7aef\u53e3\uff08\u82e5\u542f\u7528\uff09\nsudo firewall-cmd --permanent --add-port=5473/tcp\n\n# \u6307\u6807\u7aef\u53e3\uff08\u6309\u9700\uff09\nsudo firewall-cmd --permanent --add-port=9099/tcp\nsudo firewall-cmd --permanent --add-port=9091/tcp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-port\n\n# \u67e5\u8be2\u6240\u6709calico-node \nkubectl get pods -n kube-system -l k8s-app=calico-node\n\n# \u5220\u9664\u6240\u6709calico-node \nkubectl delete pods -n kube-system -l k8s-app=calico-node\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(35039).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.h3,{id:"3-dashboard\u8bbf\u95ee\u5f02\u5e38",children:"3. Dashboard\u8bbf\u95ee\u5f02\u5e38"}),"\n",(0,d.jsx)(n.p,{children:"\u8bbf\u95eeDashboard\u65f6\u62a5\u9519"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"failed the initial dns/balancer resolve for 'kubernetes-dashboard-web' with: failed to receive reply from UDP server 10.96.0.10:53: no route to host.\n\nrequest_id: d4fe874d5f8e335cd8fdb52ae1d33c04\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(53762).A+"",width:"1701",height:"771"})}),"\n",(0,d.jsx)(n.p,{children:"\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5c5e\u4e8e\u7f51\u7edc\u95ee\u9898\u7684\u8303\u7574\uff0c\u901a\u5e38\u662fCoreDNS\u7684\u95ee\u9898"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u627eCoreDNS Pod\nkubectl get pods -n kube-system -l k8s-app=kube-dns\n\n# \u67e5\u770b\u65e5\u5fd7\u662f\u5426\u6709\u5f02\u5e38\nkubectl logs -n kube-system coredns-cb4864fb5-4mj8d\nkubectl logs -n kube-system coredns-cb4864fb5-gxrdp\n\n# \u786e\u8ba4CoreDNS\u7684ip\nkubectl get svc -n kube-system kube-dns\n\n# \u786e\u8ba4\u9632\u706b\u5899\u7684\u653e\u884c\u89c4\u5219\nsudo firewall-cmd --list-port\n\n# \u8fdb\u5165\u5bb9\u5668\u5185\u90e8\u4ea4\u4e92\u6a21\u5f0f\nkubectl exec -it -n kube-system coredns-cb4864fb5-4mj8d -- sh\n\n"})}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{src:s(36697).A+"",width:"1676",height:"917"})}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"# 1. \u6240\u6709\u8282\u70b9\u5f00\u653eCoreDNS\u76f8\u5173\u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=53/tcp\nsudo firewall-cmd --permanent --add-port=53/udp\nsudo firewall-cmd --permanent --add-port=9153/udp\n# DHCP\u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=67/udp\nsudo firewall-cmd --permanent --add-port=68/udp\nsudo firewall-cmd --reload\n\n\n# 2. \u5728Master\u8282\u70b9\u4e0a\u5220\u9664 coredns \u548c calico-node \u76f8\u5173pods\uff0c\u7b49\u5f85\u91cd\u5efa\nkubectl delete pods -n kube-system -l k8s-app=calico-node\nkubectl delete pods -n kube-system -l k8s-app=kube-dns\n\n# 3. \u5728Master\u8282\u70b9\u4e0a\u5220\u9664 kubernetes-dashboard \u76f8\u5173pods\uff0c\u7b49\u5f85\u91cd\u5efa\nkubectl get pods -n kubernetes-dashboard\nkubectl delete pods --all -n kubernetes-dashboard\n\n# 4. \u9a8c\u8bc1\nsudo firewall-cmd --list-all\nkubectl get pods --all-namespaces -o wide\n\n"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.img,{src:s(30448).A+"",width:"1676",height:"917"}),"\n",(0,d.jsx)(n.img,{src:s(15823).A+"",width:"1869",height:"989"})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},97184:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Dashboard4-601e097c5d4648ddc67a03f96bea4f4e.png"},98180:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/Calico\u8fd0\u884c\u5f02\u5e381-919d7cf0af0018fc482deae08eabccd1.png"}}]);