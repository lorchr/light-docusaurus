"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[65537],{88436:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>t});var l=s(74848),r=s(28453);const c={},i=void 0,a={id:"zh-cn/database/Mysql-Cluster-Install",title:"Mysql-Cluster-Install",description:"Mysql \u96c6\u7fa4\u5b89\u88c5\uff08Docker\u7248\uff09",source:"@site/docs/zh-cn/database/10-Mysql-Cluster-Install.md",sourceDirName:"zh-cn/database",slug:"/zh-cn/database/Mysql-Cluster-Install",permalink:"/docs/zh-cn/database/Mysql-Cluster-Install",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/database/10-Mysql-Cluster-Install.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{},sidebar:"troch",previous:{title:"Mycat",permalink:"/docs/zh-cn/database/Mycat"},next:{title:"Pgsql-Cluster-Install",permalink:"/docs/zh-cn/database/Pgsql-Cluster-Install"}},d={},t=[{value:"Mysql \u96c6\u7fa4\u5b89\u88c5\uff08Docker\u7248\uff09",id:"mysql-\u96c6\u7fa4\u5b89\u88c5docker\u7248",level:2},{value:"1. \u4e3b\u5e93\u914d\u7f6e\uff08Master\uff09",id:"1-\u4e3b\u5e93\u914d\u7f6emaster",level:3},{value:"1. \u521d\u59cb\u5316\u6570\u636e\u5e93",id:"1-\u521d\u59cb\u5316\u6570\u636e\u5e93",level:4},{value:"2. \u914d\u7f6e <code>/etc/mysql/conf.d/mysql.cnf</code>",id:"2-\u914d\u7f6e-etcmysqlconfdmysqlcnf",level:4},{value:"3. \u521b\u5efa\u540c\u6b65\u7528\u6237",id:"3-\u521b\u5efa\u540c\u6b65\u7528\u6237",level:4},{value:"4. \u91cd\u542f\u6570\u636e\u5e93",id:"4-\u91cd\u542f\u6570\u636e\u5e93",level:4},{value:"2. \u4ece\u5e93\u914d\u7f6e\uff08Slave\uff09",id:"2-\u4ece\u5e93\u914d\u7f6eslave",level:3},{value:"1. \u521d\u59cb\u5316\u6570\u636e\u5e93",id:"1-\u521d\u59cb\u5316\u6570\u636e\u5e93-1",level:4},{value:"2. \u914d\u7f6e <code>/etc/mysql/conf.d/mysql.cnf</code>",id:"2-\u914d\u7f6e-etcmysqlconfdmysqlcnf-1",level:4},{value:"3. \u91cd\u542f\u6570\u636e\u5e93",id:"3-\u91cd\u542f\u6570\u636e\u5e93",level:4},{value:"3. \u8fde\u63a5Master\u548cSlave",id:"3-\u8fde\u63a5master\u548cslave",level:3},{value:"1. \u4e3b\u5e93\u64cd\u4f5c",id:"1-\u4e3b\u5e93\u64cd\u4f5c",level:4},{value:"2. \u4ece\u5e93\u64cd\u4f5c",id:"2-\u4ece\u5e93\u64cd\u4f5c",level:4},{value:"4. \u5e38\u89c1\u9519\u8bef",id:"4-\u5e38\u89c1\u9519\u8bef",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"mysql-\u96c6\u7fa4\u5b89\u88c5docker\u7248",children:"Mysql \u96c6\u7fa4\u5b89\u88c5\uff08Docker\u7248\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/songwenjie/p/9371422.html",children:"\u57fa\u4e8eDocker\u7684Mysql\u4e3b\u4ece\u590d\u5236\u642d\u5efa"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4e3a\u4e86\u56fa\u5b9aIP\u53ef\u4ee5\u5355\u72ec\u521b\u5efa\u4e00\u4e2a\u7f51\u7edc"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"master: 172.18.0.4"}),"\n",(0,l.jsx)(n.li,{children:"slave: 172.18.0.5"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u7f51\u7edc\ndocker network create --subnet=172.18.0.0/16 dev\n\n# \u5bb9\u5668\u521b\u5efa\u540e\u53ef\u4ee5\u4f7f\u7528\u6b64\u547d\u4ee4\u67e5\u770b\u5bb9\u5668IP\ndocker inspect mysql-master | grep IPAddress\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f:"})," \u5982\u679c\u5355\u72ec\u521b\u5efa\u7f51\u7edc\uff0c\u5176\u4ed6\u975e\u672c\u7f51\u7edc\u7684\u5bb9\u5668\u65e0\u6cd5\u8bbf\u95ee\u6b64\u7f51\u7edc"]}),"\n",(0,l.jsx)(n.h3,{id:"1-\u4e3b\u5e93\u914d\u7f6emaster",children:"1. \u4e3b\u5e93\u914d\u7f6e\uff08Master\uff09"}),"\n",(0,l.jsx)(n.h4,{id:"1-\u521d\u59cb\u5316\u6570\u636e\u5e93",children:"1. \u521d\u59cb\u5316\u6570\u636e\u5e93"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u6587\u4ef6\u5939\nmkdir -p //d/docker/mysql-master/{conf,data,logs}\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --publish 3316:3306 \\\n  --volume //d/docker/mysql-master/data:/var/lib/mysql \\\n  --volume //d/docker/mysql-master/conf:/etc/mysql/conf.d \\\n  --volume //d/docker/mysql-master/logs:/var/log/mysql \\\n  --env MYSQL_ROOT_PASSWORD=admin \\\n  --env MYSQL_DATABASE=test \\\n  --env MYSQL_USER=test \\\n  --env MYSQL_PASSWORD=test \\\n  --net dev \\\n  --ip 172.18.0.4 \\\n  --restart=on-failure:3 \\\n  --name mysql-master \\\n  mysql:8.0\n\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"2-\u914d\u7f6e-etcmysqlconfdmysqlcnf",children:["2. \u914d\u7f6e ",(0,l.jsx)(n.code,{children:"/etc/mysql/conf.d/mysql.cnf"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"//d/docker/mysql-master/conf"})," \u4e0b\u65b0\u5efa\u6587\u4ef6 ",(0,l.jsx)(n.code,{children:"mysql.cnf"})," \u5373\u53ef"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-conf",children:"[mysqld]\n# \u540c\u4e00\u5c40\u57df\u7f51\u5185\u6ce8\u610f\u8981\u552f\u4e00\nserver-id=100\n# \u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u529f\u80fd\uff0c\u53ef\u4ee5\u968f\u4fbf\u53d6\uff08\u5173\u952e\uff09\nlog-bin=mysql-bin\n# \u751f\u6210\u4e8c\u8fdb\u5236\u6587\u4ef6\u7684\u540d\u79f0\u683c\u5f0f\nlog-bin-index=mysql-bin.index\n# binary log \u4e8c\u8fdb\u5236\u65e5\u5fd7\u6587\u4ef6\u7684\u683c\u5f0f\uff0c\u6709\u4e09\u79cd\uff08statement \uff0c row , mixed\uff09\uff0c\u53ef\u4ee5\u6839\u636e\u573a\u666f\u9009\u7528\uff0cmysql\u9ed8\u8ba4\u91c7\u7528statement\uff0c\u5efa\u8bae\u4f7f\u7528mixed\nbinlog_format=MIXED\n# \u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u5c06\u4e8c\u8fdb\u5236\u6587\u4ef6\u5199\u5165\u78c1\u76d8\u5e76\u7acb\u5373\u6267\u884c\u5237\u65b0\u64cd\u4f5c\uff0c\u76f8\u5f53\u4e8e\u662f\u540c\u6b65\u5199\u5165\u78c1\u76d8\uff0c\u4e0d\u7ecf\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u5b58\nsync_binlog=1\n# \u81ea\u52a8\u6e05\u9664\uff08purge\uff09\u8bbe\u5b9a\u5929\u6570\u524d\u751f\u6210\u7684binlog\u65e5\u5fd7\u6587\u4ef6\nexpire_logs_days=90\n# \u63d0\u4ea4\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u5c31\u5fc5\u987b\u628a redo log \u4ece\u5185\u5b58\u5237\u5165\u5230\u78c1\u76d8\u6587\u4ef6\u91cc\u53bb\uff0c\u53ea\u8981\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\uff0c\u90a3\u4e48 redo log \u5c31\u5fc5\u7136\u5728\u78c1\u76d8\u91cc\u4e86\ninnodb_flush_log_at_trx_commit=1\n\n# \u9700\u8981\u540c\u6b65\u7684\u6570\u636e\u5e93\uff0c\u591a\u4e2a\u5e93\u5728slave\u7aef\u6307\u5b9a\n# binlog-do-db=test\n# \u5ffd\u7565\u7684\u6570\u636e\u5e93\n# binlog_ignore_db=mysql\n"})}),"\n",(0,l.jsx)(n.h4,{id:"3-\u521b\u5efa\u540c\u6b65\u7528\u6237",children:"3. \u521b\u5efa\u540c\u6b65\u7528\u6237"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root mysql-master /bin/bash\n\nmysql -u root -p\n\nSHOW DATABASES;\nUSE mysql;\nSELECT user, host, authentication_string, plugin FROM user;\nDROP USER 'slave'@'%';\nCREATE USER 'slave'@'%' IDENTIFIED BY 'slave';\nGRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'slave'@'%';\nFLUSH PRIVILEGES;\n\ndocker container restart mysql-master\n"})}),"\n",(0,l.jsx)(n.h4,{id:"4-\u91cd\u542f\u6570\u636e\u5e93",children:"4. \u91cd\u542f\u6570\u636e\u5e93"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker container restart mysql-master\n"})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u4ece\u5e93\u914d\u7f6eslave",children:"2. \u4ece\u5e93\u914d\u7f6e\uff08Slave\uff09"}),"\n",(0,l.jsx)(n.h4,{id:"1-\u521d\u59cb\u5316\u6570\u636e\u5e93-1",children:"1. \u521d\u59cb\u5316\u6570\u636e\u5e93"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u6587\u4ef6\u5939\nmkdir -p //d/docker/mysql-slave/{conf,data,logs}\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --publish 3326:3306 \\\n  --volume //d/docker/mysql-slave/data:/var/lib/mysql \\\n  --volume //d/docker/mysql-slave/conf:/etc/mysql/conf.d \\\n  --volume //d/docker/mysql-slave/logs:/var/log/mysql \\\n  --env MYSQL_ROOT_PASSWORD=admin \\\n  --env MYSQL_DATABASE=test \\\n  --env MYSQL_USER=test \\\n  --env MYSQL_PASSWORD=test \\\n  --net dev \\\n  --ip 172.18.0.5 \\\n  --restart=on-failure:3 \\\n  --name mysql-slave \\\n  mysql:8.0\n\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"2-\u914d\u7f6e-etcmysqlconfdmysqlcnf-1",children:["2. \u914d\u7f6e ",(0,l.jsx)(n.code,{children:"/etc/mysql/conf.d/mysql.cnf"})]}),"\n",(0,l.jsxs)(n.p,{children:["\u5728 ",(0,l.jsx)(n.code,{children:"//d/docker/mysql-slave/conf"})," \u4e0b\u65b0\u5efa\u6587\u4ef6 ",(0,l.jsx)(n.code,{children:"mysql.cnf"})," \u5373\u53ef"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-conf",children:"[mysqld]\n## \u8bbe\u7f6eserver_id,\u6ce8\u610f\u8981\u552f\u4e00\nserver-id=101\n## \u5f00\u542f\u4e8c\u8fdb\u5236\u65e5\u5fd7\u529f\u80fd\uff0c\u4ee5\u5907Slave\u4f5c\u4e3a\u5176\u5b83Slave\u7684Master\u65f6\u4f7f\u7528\nlog-bin=mysql-slave-bin\n## relay_log\u914d\u7f6e\u4e2d\u7ee7\u65e5\u5fd7\nrelay_log=mysqld-relay-bin\n# \u4e2d\u7ee7\u65e5\u5fd7\u6587\u4ef6\u7684\u547d\u540d\u683c\u5f0f\nrelay-log-index=mysqld-relay-bin.index\n\n# \u6307\u5b9a\u8981\u590d\u5236\u7684\u5e93\uff0c\u591a\u4e2a\u6dfb\u52a0\u591a\u884c\n# \u5728master\u7aef\u4e0d\u6307\u5b9a binlog-do-db \uff0c\u5728slave\u7aef\u7528 replicate-do-db \u6765\u8fc7\u6ee4\n# replicate-do-db=test1\n# replicate-do-db=test2\n# \u5ffd\u7565\u7684\u6570\u636e\u5e93\uff0c\u591a\u4e2a\u6570\u636e\u5e93\u5199\u591a\u6761\n# replicate-ignore-db=mysql\n"})}),"\n",(0,l.jsx)(n.h4,{id:"3-\u91cd\u542f\u6570\u636e\u5e93",children:"3. \u91cd\u542f\u6570\u636e\u5e93"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker container restart mysql-slave\n"})}),"\n",(0,l.jsx)(n.h3,{id:"3-\u8fde\u63a5master\u548cslave",children:"3. \u8fde\u63a5Master\u548cSlave"}),"\n",(0,l.jsx)(n.h4,{id:"1-\u4e3b\u5e93\u64cd\u4f5c",children:"1. \u4e3b\u5e93\u64cd\u4f5c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root mysql-master /bin/bash\n\nmysql -u root -p\n\n# \u67e5\u770blog_bin\u662f\u5426\u5f00\u542f\nshow variables like 'log_bin';\n\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| log_bin       | ON    |\n+---------------+-------+\n\n# \u67e5\u770bmaster\u8282\u70b9\u72b6\u6001\nshow master status;\n\n+------------------+----------+--------------+------------------+-------------------+\n| File             | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |\n+------------------+----------+--------------+------------------+-------------------+\n| mysql-bin.000001 |      157 |              |                  |                   |\n+------------------+----------+--------------+------------------+-------------------+\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"File"}),"\u548c",(0,l.jsx)(n.code,{children:"Position"}),"\u5b57\u6bb5\u7684\u503c\u540e\u9762\u5c06\u4f1a\u7528\u5230\uff0c\u5728\u540e\u9762\u7684\u64cd\u4f5c\u5b8c\u6210\u4e4b\u524d\uff0c\u9700\u8981\u4fdd\u8bc1Master\u5e93\u4e0d\u80fd\u505a\u4efb\u4f55\u64cd\u4f5c\uff0c\u5426\u5219\u5c06\u4f1a\u5f15\u8d77\u72b6\u6001\u53d8\u5316\uff0cFile\u548cPosition\u5b57\u6bb5\u7684\u503c\u53d8\u5316\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"2-\u4ece\u5e93\u64cd\u4f5c",children:"2. \u4ece\u5e93\u64cd\u4f5c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root mysql-slave /bin/bash\n\nmysql -u root -p\n\n# \u540c\u6b65\u4e3b\u5e93 master_log_file \u53ca master_log_pos \u7684\u503c\u662f\u524d\u9762\u4e3b\u5e93\u8bb0\u5f55\u7684\u503c\nCHANGE MASTER TO master_host='172.18.0.4', master_port=3306, master_user='slave', master_password='slave', master_log_file='mysql-bin.000001', master_log_pos= 157, master_connect_retry=30, get_master_public_key=1;\n\n# \u67e5\u770b\u4e3b\u4ece\u540c\u6b65\u72b6\u6001\nshow slave status \\G;\n\n# \u5f00\u542f\u4e3b\u4ece\u590d\u5236\uff0c\u51fa\u73b0\u5f02\u5e38\u53ef\u4ee5\u505c\u6b62\u540c\u6b65\uff0c\u91cd\u7f6e\u4e2d\u7ee7\u65e5\u5fd7\uff0c\u4fee\u590d\u540e\u518d\u6b21\u5f00\u542f\nstart slave;\n# stop slave;\n# reset slave;\n\n# \u67e5\u770b\u4e3b\u4ece\u540c\u6b65\u72b6\u6001\nshow slave status \\G;\n\n# \u8f93\u51fa\u7ed3\u679c\uff1a\u5982\u679c\u4e0a\u9762\u4e24\u884c\u4e3a Yes \u8868\u793a\u5df2\u7ecf\u6b63\u5e38\u5f00\u542f\u4e3b\u4ece\u590d\u5236\uff0c\u5426\u5219\u6839\u636e\u9519\u8bef\u7801\u548c\u9519\u8bef\u4fe1\u606f\u6392\u67e5\u95ee\u9898\n Slave_IO_Running: Yes\nSlave_SQL_Running: Yes\n    Last_IO_Errno: \u9519\u8bef\u7801\n    Last_IO_Error: \u9519\u8bef\u4fe1\u606f\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u547d\u4ee4\u8bf4\u660e\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_host"})," : Master\u7684\u5730\u5740\uff0c\u6307\u7684\u662f\u5bb9\u5668\u7684\u72ec\u7acbip\uff0c\u53ef\u4ee5\u901a\u8fc7",(0,l.jsx)(n.code,{children:"docker inspect --format='{{.NetworkSettings.IPAddress}}' mysql-master"}),"  \u67e5\u8be2\u5bb9\u5668\u7684ip"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_port"})," : Master\u7684\u7aef\u53e3\u53f7\uff0c\u6307\u7684\u662f\u5bb9\u5668\u7684\u7aef\u53e3\u53f7"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_user"})," : \u7528\u4e8e\u6570\u636e\u540c\u6b65\u7684\u7528\u6237"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_password"})," : \u7528\u4e8e\u540c\u6b65\u7684\u7528\u6237\u7684\u5bc6\u7801"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_log_file"})," : \u6307\u5b9a Slave \u4ece\u54ea\u4e2a\u65e5\u5fd7\u6587\u4ef6\u5f00\u59cb\u590d\u5236\u6570\u636e\uff0c\u5373\u4e0a\u6587\u4e2d\u63d0\u5230\u7684 ",(0,l.jsx)(n.code,{children:"File"})," \u5b57\u6bb5\u7684\u503c"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_log_pos"})," : \u4ece\u54ea\u4e2a ",(0,l.jsx)(n.code,{children:"Position"})," \u5f00\u59cb\u8bfb\uff0c\u5373\u4e0a\u6587\u4e2d\u63d0\u5230\u7684 ",(0,l.jsx)(n.code,{children:"Position"})," \u5b57\u6bb5\u7684\u503c"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"master_connect_retry"})," : \u5982\u679c\u8fde\u63a5\u5931\u8d25\uff0c\u91cd\u8bd5\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\u662f\u79d2\uff0c\u9ed8\u8ba4\u662f60\u79d2"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"get_master_public_key"})," : \u83b7\u53d6\u4e3b\u5e93\u5bc6\u94a5"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u5728Slave \u4e2d\u7684mysql\u7ec8\u7aef\u6267\u884c ",(0,l.jsx)(n.code,{children:"show slave status \\G;"})," \u7528\u4e8e\u67e5\u770b\u4e3b\u4ece\u540c\u6b65\u72b6\u6001\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c",(0,l.jsx)(n.code,{children:"Slave_IO_Running"})," \u548c",(0,l.jsx)(n.code,{children:" Slave_SQL_Running"})," \u90fd\u662f",(0,l.jsx)(n.code,{children:"No"}),"\uff0c\u56e0\u4e3a\u6211\u4eec\u8fd8\u6ca1\u6709\u5f00\u542f\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u3002\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"start slave;"})," \u5f00\u542f\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\uff0c\u7136\u540e\u518d\u6b21\u67e5\u8be2\u4e3b\u4ece\u540c\u6b65\u72b6\u6001 ",(0,l.jsx)(n.code,{children:"show slave status \\G;"}),"\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"Slave_IO_Running"})," \u548c ",(0,l.jsx)(n.code,{children:"Slave_SQL_Running"})," \u90fd\u662f",(0,l.jsx)(n.code,{children:"Yes"}),"\uff0c\u8bf4\u660e\u4e3b\u4ece\u590d\u5236\u5df2\u7ecf\u5f00\u542f\u3002\u6b64\u65f6\u53ef\u4ee5\u6d4b\u8bd5\u6570\u636e\u540c\u6b65\u662f\u5426\u6210\u529f\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"4-\u5e38\u89c1\u9519\u8bef",children:"4. \u5e38\u89c1\u9519\u8bef"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u767b\u5f55\u51fa\u73b0 ",(0,l.jsx)(n.code,{children:"mysql: [Warning] World-writable config file '/etc/mysql/conf.d/mysql.cnf' is ignored."}),"\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u8fd9\u4e2a\u8b66\u544a\u51fa\u73b0\u7684\u539f\u56e0\u662f MySQL \u53d1\u73b0\u6302\u8f7d\u7684\u914d\u7f6e\u6587\u4ef6 ",(0,l.jsx)(n.code,{children:"/etc/mysql/conf.d/mysql.cnf"})," \u5177\u6709\u5168\u5c40\u53ef\u5199\u6743\u9650\uff0c\u56e0\u6b64\u5ffd\u7565\u4e86\u8be5\u6587\u4ef6\u3002MySQL \u5f15\u64ce\u975e\u5e38\u6ce8\u91cd\u5b89\u5168\u6027\u548c\u6570\u636e\u5b8c\u6574\u6027\u3002\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u5177\u6709\u5168\u5c40\u53ef\u5199\u6743\u9650\uff0c\u4efb\u4f55\u7528\u6237\u90fd\u53ef\u4ee5\u4fee\u6539\u8be5\u6587\u4ef6\uff0c\u5305\u62ec\u6076\u610f\u7528\u6237\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u6f5c\u5728\u7684\u5b89\u5168\u98ce\u9669\u548c\u6570\u636e\u635f\u574f\u3002\u4e3a\u4e86\u63d0\u9ad8\u5b89\u5168\u6027\uff0c\u5f53 MySQL \u68c0\u6d4b\u5230\u6302\u8f7d\u7684\u914d\u7f6e\u6587\u4ef6\u5177\u6709\u5168\u5c40\u53ef\u5199\u6743\u9650\u65f6\uff0c\u5b83\u4f1a\u53d1\u51fa\u8b66\u544a\u5e76\u5ffd\u7565\u8be5\u6587\u4ef6\u3002\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u786e\u4fdd\u53ea\u6709\u6388\u6743\u7684\u7528\u6237\u80fd\u591f\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u5e76\u5bf9 MySQL \u8fdb\u884c\u66f4\u6539\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u5c06 dos \u6587\u4ef6\u8f6c\u4e3a unix \u6587\u4ef6\nawk \'{ sub("\\r$", ""); print }\' /etc/mysql/conf.d/mysql.cnf > /etc/mysql/conf.d/mysql.cnf\n\n# \u4fee\u6539\u6743\u9650\nchmod 644 /etc/mysql/conf.d/mysql.cnf\n'})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"start slave;"})," \u5f00\u542f\u4e3b\u4ece\u540c\u6b65\u51fa\u73b0 ",(0,l.jsx)(n.code,{children:"Authentication plugin 'caching_sha2_password' reported error: Authentication requires secure connection."})]}),"\n"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"Last_IO_Error: Error connecting to source 'slave@172.18.0.4:3306'. This was attempt 1/86400, with a delay of 30 seconds between attempts. Message: Authentication plugin 'caching_sha2_password' reported error: Authentication requires secure connection."}),"\n"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/sha256-pluggable-authentication.html",children:"Section 6.4.1.3, \u201cSHA-256 Pluggable Authentication\u201d."})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password",children:"caching_sha2_password as the Preferred Authentication Plugin."})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/encrypted-connections.html",children:"Section 6.3, \u201cUsing Encrypted Connections\u201d"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://dev.mysql.com/doc/refman/8.0/en/caching-sha2-pluggable-authentication.html",children:"MySQL :: MySQL 8.0 Reference Manual :: 6.4.1.2 Caching SHA-2 Pluggable Authentication"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Mysql 8.0 \u9ed8\u8ba4\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"caching_sha2_password"})," \u63d2\u4ef6\u5bf9\u767b\u5f55\u4fe1\u606f\u8fdb\u884c\u52a0\u5bc6\uff0c\u6b64\u65b9\u5f0f\u9700\u8981\u914d\u7f6e\u8ba4\u8bc1\u516c\u94a5\uff0c\u53ef\u4ee5\u6539\u4e3a ",(0,l.jsx)(n.code,{children:"mysql_native_password"})," \u63d2\u4ef6\u8ba4\u8bc1\u6216\u8005\u914d\u7f6e\u83b7\u53d6Master\u8282\u70b9\u7684\u516c\u94a5"]}),"\n",(0,l.jsxs)(n.p,{children:["\u65b9\u6848\u4e00: ",(0,l.jsx)(n.a,{href:"https://blog.csdn.net/qq_58645958/article/details/130272982",children:"\u4fee\u6539\u7528\u6237\u7684\u8ba4\u8bc1\u65b9\u5f0f"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root mysql-master /bin/bash\n\nmysql -u root -p\n\nUSE mysql;\nSELECT plugin FROM `user` WHERE user = 'slave';\n# \u5c06 caching_sha2_password \u6539\u4e3a mysql_native_password\nALTER USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY 'slave';\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u65b9\u6848\u4e8c: ",(0,l.jsx)(n.a,{href:"https://blog.csdn.net/weixin_55136824/article/details/131822062",children:"\u6dfb\u52a0\u8bfb\u53d6\u4e3b\u5e93\u516c\u94a5\u914d\u7f6e"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"docker exec -it -u root mysql-slave /bin/bash\n\nmysql -u root -p\n\nCHANGE MASTER TO GET_MASTER_PUBLIC_KEY=1;\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"ERROR 1872 (HY000): Replica failed to initialize applier metadata structure from the repository"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u56e0\u4e3a\u4ece\u6570\u636e\u5e93\u53ef\u80fd\u4ee5\u524d\u914d\u7f6e\u8fc7\uff0c\u751f\u6210\u8fc7 \u4e2d\u7ee7\u65e5\u5fd7\u6587\u4ef6\uff0c\u5bfc\u81f4 \u4ece\u6570\u636e\u5e93 slave \u4e2d\u8fd8\u8bb0\u5f55\u7740\u65e7\u6570\u636e\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528 \u547d\u4ee4 ",(0,l.jsx)(n.code,{children:"reset slave;"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var l=s(96540);const r={},c=l.createContext(r);function i(e){const n=l.useContext(c);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),l.createElement(c.Provider,{value:n},e.children)}}}]);