"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[27454],{1437:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51654-9881a4c80c6d871b6decc7ea7cb07f0e.png"},2240:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>d,toc:()=>i});const d=JSON.parse('{"id":"zh-cn/k8s/Build-K8s-Multi-Master-Cluster-Offline","title":"Build-K8s-Multi-Master-Cluster-Offline","description":"\u4e00\u3001\u76f8\u5173\u94fe\u63a5","source":"@site/docs/zh-cn/k8s/6-Build-K8s-Multi-Master-Cluster-Offline.md","sourceDirName":"zh-cn/k8s","slug":"/zh-cn/k8s/Build-K8s-Multi-Master-Cluster-Offline","permalink":"/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster-Offline","draft":false,"unlisted":false,"editUrl":"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/k8s/6-Build-K8s-Multi-Master-Cluster-Offline.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{},"sidebar":"troch","previous":{"title":"Build-K8s-Multi-Master-Cluster","permalink":"/docs/zh-cn/k8s/Build-K8s-Multi-Master-Cluster"},"next":{"title":"Test","permalink":"/docs/category/test"}}');var l=s(74848),r=s(28453);const c={},t=void 0,a={},i=[{value:"\u4e00\u3001\u76f8\u5173\u94fe\u63a5",id:"\u4e00\u76f8\u5173\u94fe\u63a5",level:2},{value:"\u4e8c\u3001\u73af\u5883\u4ecb\u7ecd",id:"\u4e8c\u73af\u5883\u4ecb\u7ecd",level:2},{value:"2.1 \u8f6f\u4ef6\u7248\u672c",id:"21-\u8f6f\u4ef6\u7248\u672c",level:3},{value:"2.2 \u670d\u52a1\u5668\u89c4\u5212",id:"22-\u670d\u52a1\u5668\u89c4\u5212",level:3},{value:"\u4e09\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u51c6\u5907\u5de5\u4f5c",id:"\u4e09\u6240\u6709\u8282\u70b9\u51c6\u5907\u5de5\u4f5c",level:2},{value:"3.1 \u521b\u5efa\u64cd\u4f5c\u7528\u6237",id:"31-\u521b\u5efa\u64cd\u4f5c\u7528\u6237",level:3},{value:"3.2 \u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a",id:"32-\u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a",level:3},{value:"3.3 \u7981\u7528 SELinux",id:"33-\u7981\u7528-selinux",level:3},{value:"3.4 \u914d\u7f6e\u5185\u6838\u53c2\u6570",id:"34-\u914d\u7f6e\u5185\u6838\u53c2\u6570",level:3},{value:"3.5 \u914d\u7f6e\u7f51\u7edc\u53c2\u6570",id:"35-\u914d\u7f6e\u7f51\u7edc\u53c2\u6570",level:3},{value:"3.6 \u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts",id:"36-\u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts",level:3},{value:"3.7 \u8bbe\u7f6e\u65f6\u533a",id:"37-\u8bbe\u7f6e\u65f6\u533a",level:3},{value:"3.8 \u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\uff0c\u5728K8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c",id:"38-\u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u5728k8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c",level:3},{value:"3.9 \u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219",id:"39-\u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219",level:3},{value:"3.10 \u5b89\u88c5\u5305\u4e0a\u4f20\u89e3\u538b",id:"310-\u5b89\u88c5\u5305\u4e0a\u4f20\u89e3\u538b",level:3},{value:"3.11 \u4f9d\u8d56\u9879\u5b89\u88c5",id:"311-\u4f9d\u8d56\u9879\u5b89\u88c5",level:3},{value:"\u56db\u3001\u3010\u6240\u6709\u8282\u70b9\u3011Docker\u5b89\u88c5\u914d\u7f6e\uff08\u5bb9\u5668\u8fd0\u884c\u65f6\uff09",id:"\u56db\u6240\u6709\u8282\u70b9docker\u5b89\u88c5\u914d\u7f6e\u5bb9\u5668\u8fd0\u884c\u65f6",level:2},{value:"4.1 \u5378\u8f7d\u5df2\u6709Docker Engine",id:"41-\u5378\u8f7d\u5df2\u6709docker-engine",level:3},{value:"4.2 \u5b89\u88c5Docker",id:"42-\u5b89\u88c5docker",level:3},{value:"4.3 \u5982\u679c\u9700\u8981\u5378\u8f7d\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4",id:"43-\u5982\u679c\u9700\u8981\u5378\u8f7d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4",level:3},{value:"4.4 \u914d\u7f6eDocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93",id:"44-\u914d\u7f6edocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93",level:3},{value:"4.5 \u5b89\u88c5cri-dockerd\u9a71\u52a8\uff08Docker\u4e0eK8s\u96c6\u6210\u7684\u9002\u914d\u5c42\uff09",id:"45-\u5b89\u88c5cri-dockerd\u9a71\u52a8docker\u4e0ek8s\u96c6\u6210\u7684\u9002\u914d\u5c42",level:3},{value:"\u4e94\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u5b89\u88c5 kubeadm\u3001kubelet \u548c kubectl",id:"\u4e94\u6240\u6709\u8282\u70b9\u5b89\u88c5-kubeadmkubelet-\u548c-kubectl",level:2},{value:"5.1 \u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a MAC \u5730\u5740\u548c product_uuid \u7684\u552f\u4e00\u6027",id:"51-\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a-mac-\u5730\u5740\u548c-product_uuid-\u7684\u552f\u4e00\u6027",level:3},{value:"5.2 \u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl",id:"52-\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl",level:3},{value:"5.3 \u4e0b\u8f7dK8s\u4f9d\u8d56\u955c\u50cf",id:"53-\u4e0b\u8f7dk8s\u4f9d\u8d56\u955c\u50cf",level:3},{value:"\u516d\u3001\u3010\u4ec5Master\u8282\u70b9\u3011\u5b89\u88c5HAProxy Keepalived",id:"\u516d\u4ec5master\u8282\u70b9\u5b89\u88c5haproxy-keepalived",level:2},{value:"6.1 \u5f00\u653e\u7aef\u53e3",id:"61-\u5f00\u653e\u7aef\u53e3",level:3},{value:"6.2 \u5b89\u88c5Keepalived HAProxy",id:"62-\u5b89\u88c5keepalived-haproxy",level:3},{value:"6.3 \u914d\u7f6eHAProxy",id:"63-\u914d\u7f6ehaproxy",level:3},{value:"6.4 \u914d\u7f6eKeepalived",id:"64-\u914d\u7f6ekeepalived",level:3},{value:"6.4.1 <code>192.168.137.121</code>\u4f5c\u4e3aVIP\u7684\u4e3b\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",id:"641-192168137121\u4f5c\u4e3avip\u7684\u4e3b\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",level:4},{value:"6.4.2 <code>192.168.137.122</code>\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",id:"642-192168137122\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",level:4},{value:"6.4.3 <code>192.168.137.123</code>\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",id:"643-192168137123\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",level:4},{value:"6.5 \u542f\u52a8Keepalived HAProxy",id:"65-\u542f\u52a8keepalived-haproxy",level:3},{value:"\u4e03\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc",id:"\u4e03\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc",level:2},{value:"7.1 \u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9",id:"71-\u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9",level:3},{value:"7.2 \u914d\u7f6eMaster\u8282\u70b9",id:"72-\u914d\u7f6emaster\u8282\u70b9",level:3},{value:"\u516b\u3001\u3010\u5176\u4ed6Master\u8282\u70b9\u3011Master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",id:"\u516b\u5176\u4ed6master\u8282\u70b9master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",level:2},{value:"8.1 \u8282\u70b9\u521d\u59cb\u5316",id:"81-\u8282\u70b9\u521d\u59cb\u5316",level:3},{value:"8.2 \u73af\u5883\u68c0\u67e5",id:"82-\u73af\u5883\u68c0\u67e5",level:3},{value:"8.3 \u52a0\u5165Master\u8282\u70b9",id:"83-\u52a0\u5165master\u8282\u70b9",level:3},{value:"8.3.1 \u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684Token",id:"831-\u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684token",level:4},{value:"8.3.2 \u521d\u59cb\u5316Master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230 etcd \u4e2d",id:"832-\u521d\u59cb\u5316master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230-etcd-\u4e2d",level:4},{value:"8.3.3 \u52a0\u5165\u65b0\u7684Master\u8282\u70b9",id:"833-\u52a0\u5165\u65b0\u7684master\u8282\u70b9",level:4},{value:"8.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",id:"84-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",level:3},{value:"\u4e5d\u3001\u3010\u6240\u6709Node\u8282\u70b9\u3011Node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",id:"\u4e5d\u6240\u6709node\u8282\u70b9node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",level:2},{value:"9.1 Node\u8282\u70b9\u521d\u59cb\u5316",id:"91-node\u8282\u70b9\u521d\u59cb\u5316",level:3},{value:"9.2 \u73af\u5883\u68c0\u67e5",id:"92-\u73af\u5883\u68c0\u67e5",level:3},{value:"9.3 \u52a0\u5165Node\u8282\u70b9",id:"93-\u52a0\u5165node\u8282\u70b9",level:3},{value:"9.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",id:"94-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",level:3},{value:"\u5341\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f",id:"\u5341\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f",level:2},{value:"10.1 \u5f00\u653e\u7aef\u53e3(calico)",id:"101-\u5f00\u653e\u7aef\u53e3calico",level:3},{value:"10.2 \u5b89\u88c5Calico\u7f51\u7edc\u670d\u52a1",id:"102-\u5b89\u88c5calico\u7f51\u7edc\u670d\u52a1",level:3},{value:"10.3 \u68c0\u67e5\u8282\u70b9\u72b6\u6001",id:"103-\u68c0\u67e5\u8282\u70b9\u72b6\u6001",level:3},{value:"10.4 \u68c0\u67e5CoreDNS\u662f\u5426\u6b63\u5e38",id:"104-\u68c0\u67e5coredns\u662f\u5426\u6b63\u5e38",level:3},{value:"10.5 \u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb",id:"105-\u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb",level:3},{value:"10.6 \u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\uff0c\u65b9\u4fbf\u7ba1\u7406",id:"106-\u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\u65b9\u4fbf\u7ba1\u7406",level:3},{value:"\u5341\u4e00\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u5b89\u88c5Dashboard",id:"\u5341\u4e00\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u5b89\u88c5dashboard",level:2},{value:"11.1 Helm\u5b89\u88c5",id:"111-helm\u5b89\u88c5",level:3},{value:"11.2 \u4fee\u6539Dashboard\u914d\u7f6e\u5e76\u5b89\u88c5",id:"112-\u4fee\u6539dashboard\u914d\u7f6e\u5e76\u5b89\u88c5",level:3},{value:"11.3 \u521b\u5efaToken",id:"113-\u521b\u5efatoken",level:3},{value:"11.4 \u8bbf\u95eeDashboard",id:"114-\u8bbf\u95eedashboard",level:3},{value:"11.5 \u5220\u9664Dashboard",id:"115-\u5220\u9664dashboard",level:3},{value:"\u5341\u4e8c\u3001\u5e38\u7528\u547d\u4ee4",id:"\u5341\u4e8c\u5e38\u7528\u547d\u4ee4",level:2},{value:"\u521d\u59cb\u5316\u5e38\u7528",id:"\u521d\u59cb\u5316\u5e38\u7528",level:3},{value:"12.1 \u57fa\u7840\u64cd\u4f5c\u547d\u4ee4",id:"121-\u57fa\u7840\u64cd\u4f5c\u547d\u4ee4",level:3},{value:"12.2 \u8d44\u6e90\u76f8\u5173",id:"122-\u8d44\u6e90\u76f8\u5173",level:3},{value:"12.3 \u96c6\u7fa4\u76f8\u5173",id:"123-\u96c6\u7fa4\u76f8\u5173",level:3},{value:"12.4 Daemonsets \u76f8\u5173",id:"124-daemonsets-\u76f8\u5173",level:3},{value:"12.5 Deployments\u76f8\u5173",id:"125-deployments\u76f8\u5173",level:3},{value:"12.6 \u4e8b\u4ef6\u76f8\u5173",id:"126-\u4e8b\u4ef6\u76f8\u5173",level:3},{value:"12.7 \u65e5\u5fd7\u76f8\u5173",id:"127-\u65e5\u5fd7\u76f8\u5173",level:3},{value:"12.8 Namespace \u76f8\u5173",id:"128-namespace-\u76f8\u5173",level:3},{value:"12.9 Nodes \u76f8\u5173",id:"129-nodes-\u76f8\u5173",level:3},{value:"12.10 Pods \u64cd\u4f5c\u76f8\u5173",id:"1210-pods-\u64cd\u4f5c\u76f8\u5173",level:3},{value:"12.11 Replication Controller \u76f8\u5173",id:"1211-replication-controller-\u76f8\u5173",level:3},{value:"12.12 ReplicaSets \u76f8\u5173",id:"1212-replicasets-\u76f8\u5173",level:3},{value:"12.13 Sercrets \u76f8\u5173",id:"1213-sercrets-\u76f8\u5173",level:3},{value:"12.14 Services \u76f8\u5173",id:"1214-services-\u76f8\u5173",level:3},{value:"12.15 Service Account\u76f8\u5173",id:"1215-service-account\u76f8\u5173",level:3},{value:"12.16 StatefulSets \u76f8\u5173",id:"1216-statefulsets-\u76f8\u5173",level:3},{value:"12.17 \u5e38\u7528\u53c2\u6570",id:"1217-\u5e38\u7528\u53c2\u6570",level:3},{value:"12.18 \u6ce8\u610f\u4e8b\u9879",id:"1218-\u6ce8\u610f\u4e8b\u9879",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\u4e00\u76f8\u5173\u94fe\u63a5",children:"\u4e00\u3001\u76f8\u5173\u94fe\u63a5"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/",children:"Kubernetes\u751f\u4ea7\u73af\u5883\u5b89\u88c5\u6ce8\u610f\u4e8b\u9879"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/",children:"Kubernetes \u5bb9\u5668\u8fd0\u884c\u65f6"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/",children:"\u4f7f\u7528 kubeadm \u5f15\u5bfc\u96c6\u7fa4"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.docker.com/engine/install/#server",children:"Docker \u5bb9\u5668\u8fd0\u884c\u65f6\u5b89\u88c5"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://download.docker.com/linux/centos/8/x86_64/stable/Packages/",children:"Docker rpm\u5b89\u88c5\u5305\u4e0b\u8f7d"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://mirantis.github.io/cri-dockerd/usage/install/",children:"\u5b89\u88c5CRI-Dockerd"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/",children:"Kubernetes\u8fd0\u884c\u5fc5\u8981\u7684\u7aef\u53e3"})}),"\n",(0,l.jsx)(n.li,{}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/releases/download/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG-1.30.md#v13011",children:"Kubernetes\u66f4\u65b0\u5386\u53f2"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.downloadkubernetes.com/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/",children:"\u5728 Linux \u7cfb\u7edf\u4e2d\u5b89\u88c5\u5e76\u8bbe\u7f6e kubectl"})}),"\n",(0,l.jsx)(n.li,{}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/helm/helm/releases",children:"\u5f00\u6e90\u9879\u76ee Helm \u7528\u4e8e\u5b89\u88c5Dashbaord"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/kube-vip/kube-vip",children:"\u5f00\u6e90\u9879\u76ee kube-vip \u63a7\u5236\u9762\u865a\u62dfIP"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/cloudnativer/kube-install",children:"\u5f00\u6e90\u9879\u76ee kube-install \u79bb\u7ebf\u5b89\u88c5K8s"})}),"\n",(0,l.jsx)(n.li,{}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.tencent.com/developer/article/2505531",children:"Kubernetes(k8s)-\u9ad8\u53ef\u7528\u96c6\u7fa4\u90e8\u7f72v1.32.2(\u751f\u4ea7\u53ef\u7528)"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.csdn.net/tonyhi6/article/details/139019297",children:"Centos8.5 \u57fa\u4e8e k8s v1.30.1 \u90e8\u7f72\u9ad8\u53ef\u7528\u96c6\u7fa4"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.csdn.net/qq_33342132/article/details/135751063",children:"\u5728\u5df2\u6709\u7684\u9ad8\u53ef\u7528kubernetes/k8s\u96c6\u7fa4\u4e2d\u6dfb\u52a0master\u8282\u70b9"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://bbs.huaweicloud.com/blogs/368244",children:"k8s \u96c6\u7fa4\u6dfb\u52a0Master\u548cnode\u8282\u70b9"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.csdn.net/Lfwthotpt/article/details/105892926",children:"\u7406\u8bba+\u5b9e\u64cd\uff1ak8s\u5355\u8282\u70b9\u96c6\u7fa4\u52a0\u5165master\u8282\u70b9"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://blog.csdn.net/qq_42895490/article/details/139564373",children:"k8s v1.30.1 \u9ad8\u53ef\u7528\u7248\u672c\u642d\u5efa"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://zhuanlan.zhihu.com/p/524772977",children:"Kubernetes \u7f51\u7edc\u63d2\u4ef6 Calico \u5b8c\u5168\u8fd0\u7ef4\u6307\u5357"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4e8c\u73af\u5883\u4ecb\u7ecd",children:"\u4e8c\u3001\u73af\u5883\u4ecb\u7ecd"}),"\n",(0,l.jsx)(n.h3,{id:"21-\u8f6f\u4ef6\u7248\u672c",children:"2.1 \u8f6f\u4ef6\u7248\u672c"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u540d\u79f0"}),(0,l.jsx)(n.th,{children:"\u7248\u672c"}),(0,l.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u64cd\u4f5c\u7cfb\u7edf"}),(0,l.jsx)(n.td,{children:"CentOS 8.5"}),(0,l.jsx)(n.td,{children:"\u5185\u6838\u7248\u672c 4.18.0-348.7.1.el8_5.x86_64"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Kubernates"}),(0,l.jsx)(n.td,{children:"1.30.11"}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u5bb9\u5668\u8fd0\u884c\u65f6"}),(0,l.jsx)(n.td,{children:"Docker-CE-26.1.3-1"}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"K8s\u7f51\u7edc\u7ec4\u4ef6"}),(0,l.jsx)(n.td,{children:"Calico-v3.25"}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Helm"}),(0,l.jsx)(n.td,{children:"helm-v3.17.2"}),(0,l.jsx)(n.td,{children:"\u7528\u4e8e\u5b89\u88c5Dashboard"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"K8s Dashbaord"}),(0,l.jsx)(n.td,{children:"kubernetes-dashboard-7.7.0"}),(0,l.jsx)(n.td,{})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"22-\u670d\u52a1\u5668\u89c4\u5212",children:"2.2 \u670d\u52a1\u5668\u89c4\u5212"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u7f51\u7edc\u4fe1\u606f\nip a\n\n# \u67e5\u770bMAC\u5730\u5740\nip link | grep link/ether\n\n# \u67e5\u770b product_uuid\nsudo cat /sys/class/dmi/id/product_uuid\n\n"})}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u64cd\u4f5c\u7cfb\u7edf"}),(0,l.jsx)(n.th,{children:"\u5185\u5b58"}),(0,l.jsx)(n.th,{children:"\u4e3b\u673a\u540d"}),(0,l.jsx)(n.th,{children:"IP"}),(0,l.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cent OS 8.5"}),(0,l.jsx)(n.td,{children:"4G"}),(0,l.jsx)(n.td,{children:"k8s-master-01"}),(0,l.jsx)(n.td,{children:"192.168.137.121"}),(0,l.jsx)(n.td,{children:"Master"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cent OS 8.5"}),(0,l.jsx)(n.td,{children:"4G"}),(0,l.jsx)(n.td,{children:"k8s-master-02"}),(0,l.jsx)(n.td,{children:"192.168.137.122"}),(0,l.jsx)(n.td,{children:"Master"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cent OS 8.5"}),(0,l.jsx)(n.td,{children:"4G"}),(0,l.jsx)(n.td,{children:"k8s-master-03"}),(0,l.jsx)(n.td,{children:"192.168.137.123"}),(0,l.jsx)(n.td,{children:"Master"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cent OS 8.5"}),(0,l.jsx)(n.td,{children:"4G"}),(0,l.jsx)(n.td,{children:"k8s-node-01"}),(0,l.jsx)(n.td,{children:"192.168.137.131"}),(0,l.jsx)(n.td,{children:"Node"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cent OS 8.5"}),(0,l.jsx)(n.td,{children:"4G"}),(0,l.jsx)(n.td,{children:"k8s-node-02"}),(0,l.jsx)(n.td,{children:"192.168.137.132"}),(0,l.jsx)(n.td,{children:"Node"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Cent OS 8.5"}),(0,l.jsx)(n.td,{children:"4G"}),(0,l.jsx)(n.td,{children:"k8s-node-03"}),(0,l.jsx)(n.td,{children:"192.168.137.133"}),(0,l.jsx)(n.td,{children:"Node"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"-"}),(0,l.jsx)(n.td,{children:"-"}),(0,l.jsx)(n.td,{children:"vip"}),(0,l.jsx)(n.td,{children:"192.168.137.140"}),(0,l.jsx)(n.td,{children:"\u865a\u62dfIP\uff0c\u65e0\u5b9e\u4f53"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"\u4e09\u6240\u6709\u8282\u70b9\u51c6\u5907\u5de5\u4f5c",children:"\u4e09\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u51c6\u5907\u5de5\u4f5c"}),"\n",(0,l.jsx)(n.h3,{id:"31-\u521b\u5efa\u64cd\u4f5c\u7528\u6237",children:"3.1 \u521b\u5efa\u64cd\u4f5c\u7528\u6237"}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u6ca1\u6709\u4e13\u95e8\u7684\u64cd\u4f5c\u7528\u6237\uff0c\u53ef\u4ee5\u6309\u4e0b\u9762\u7684\u64cd\u4f5c\u521b\u5efa\u65b0\u7684\u7528\u6237\uff0c\u540e\u7eed\u64cd\u4f5c\u5747\u4f7f\u7528\u6b64\u65b0\u7528\u6237\u6765\u6267\u884c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# 1. \u521b\u5efa\u7528\u6237\nsudo useradd -m diginn\n\n# 2. \u8bbe\u7f6e\u5bc6\u7801\nsudo passwd diginn\n\n# 3. \u8d4b\u4e88root\u6743\u9650\nsudo visudo\n# \u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\ndiginn   ALL=(ALL)   ALL\n\n# 4. \u6d4b\u8bd5\u6743\u9650\nsu - diginn\nsudo whoami\n\n# \u663e\u793a root \u5373\u8868\u793adiginn\u7528\u6237\u6709 sudo \u6743\u9650\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"32-\u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a",children:"3.2 \u7981\u7528\u7cfb\u7edf\u4ea4\u6362\u5206\u533a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u4e34\u65f6\u7981\u7528\nsudo swapoff -a\n# \u6c38\u4e45\u7981\u7528\nsudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab\n\n# \u67e5\u770bswap\u5206\u533a\nswapon --show\n"})}),"\n",(0,l.jsx)(n.h3,{id:"33-\u7981\u7528-selinux",children:"3.3 \u7981\u7528 SELinux"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u4e34\u65f6\u7981\u7528\nsudo setenforce 0\n# \u6c38\u4e45\u7981\u7528\nsudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config\n\n# \u68c0\u67e5SELinux\u72b6\u6001\nsestatus\ngetenforce\n"})}),"\n",(0,l.jsx)(n.h3,{id:"34-\u914d\u7f6e\u5185\u6838\u53c2\u6570",children:"3.4 \u914d\u7f6e\u5185\u6838\u53c2\u6570"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u7acb\u5373\u751f\u6548\nsudo modprobe ip_vs\nsudo modprobe ip_vs_rr\nsudo modprobe ip_vs_sh\nsudo modprobe ip_vs_wrr\nsudo modprobe nf_conntrack\nsudo modprobe br_netfilter\nsudo modprobe overlay\nsudo modprobe nf_nat\nsudo modprobe xt_conntrack\nsudo modprobe veth  \nsudo modprobe ip_tables\nsudo modprobe ip6_tables\nsudo modprobe nf_defrag_ipv6\nsudo modprobe ebtables\nsudo modprobe dummy\nsudo modprobe xt_set\n\n# \u914d\u7f6e\u542f\u52a8\u8bb0\u8f7d\ncat <<EOF | sudo tee -a /etc/modules\nip_vs\nip_vs_rr\nip_vs_sh\nip_vs_wrr\nnf_conntrack\nbr_netfilter\noverlay\nnf_nat\nxt_conntrack\nveth\nip_tables\nip6_tables\nnf_defrag_ipv6\nebtables\ndummy\nxt_set\nEOF\n\n# \u9a8c\u8bc1\u662f\u5426\u52a0\u8f7d\u6210\u529f\nlsmod | grep -E "ip_vs|nf_conntrack|br_netfilter|overlay|nf_nat|xt_conntrack|veth|ip_tables|ip6_tables|nf_defrag_ipv6|ebtables|dummy|xt_set"\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"35-\u914d\u7f6e\u7f51\u7edc\u53c2\u6570",children:"3.5 \u914d\u7f6e\u7f51\u7edc\u53c2\u6570"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/sysctl.d/99-kubernetes-cri.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n\n# \u5e94\u7528 sysctl \u53c2\u6570\u800c\u4e0d\u91cd\u65b0\u542f\u52a8\nsudo sysctl --system\n\n# \u9a8c\u8bc1\nsudo sysctl net.ipv4.ip_forward\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"36-\u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts",children:"3.6 \u8bbe\u7f6e\u4e3b\u673a\u540d\u548chosts"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# master\u4e3b\u673a\nsudo hostnamectl  set-hostname  k8s-master-01\nsudo hostnamectl  set-hostname  k8s-master-02\nsudo hostnamectl  set-hostname  k8s-master-03\n# node\u4e3b\u673a\nsudo hostnamectl  set-hostname  k8s-node-01\nsudo hostnamectl  set-hostname  k8s-node-02\nsudo hostnamectl  set-hostname  k8s-node-03\n\n\n# \u4fee\u6539/etc/hosts\u5185\u5bb9\uff08\u96c6\u7fa4\u5185\u6bcf\u4e00\u4e2a\u4e3b\u673a\u90fd\u8981\u914d\u7f6e\uff09\ncat <<EOF | sudo tee -a /etc/hosts\n\n192.168.137.121   k8s-master-01\n192.168.137.122   k8s-master-02\n192.168.137.123   k8s-master-03\n\n192.168.137.131   k8s-node-01\n192.168.137.132   k8s-node-02\n192.168.137.133   k8s-node-03\nEOF\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"37-\u8bbe\u7f6e\u65f6\u533a",children:"3.7 \u8bbe\u7f6e\u65f6\u533a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u65f6\u533a\ntimedatectl\n\n# \u67e5\u770b\u6240\u6709\u53ef\u7528\u65f6\u533a\ntimedatectl list-timezones\n\n# \u8bbe\u7f6e\u4e3a\u4e0a\u6d77\u65f6\u533a\nsudo timedatectl set-timezone Asia/Shanghai\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"38-\u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u5728k8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c",children:"3.8 \u6253\u901a\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\uff0c\u5728K8s\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c"}),"\n",(0,l.jsx)(n.p,{children:"\u7531\u4e8e\u5404\u4e2a\u7ec4\u4ef6\u4e4b\u95f4\u901a\u8baf\u903b\u8f91\u5341\u5206\u590d\u6742\uff0c\u4e14\u4e0d\u540c\u7248\u672c\u4e4b\u95f4\u7684\u7f51\u7edc\u89c4\u5219\u8fd8\u5b58\u5728\u533a\u522b\uff0c\u5bf9\u4e8e\u751f\u4ea7\u73af\u5883\uff0c\u5efa\u8bae\u5728\u4e0d\u80fd\u5173\u95ed\u9632\u706b\u5899\u7684\u60c5\u51b5\u4e0b\u914d\u7f6e\u8282\u70b9\u4e4b\u95f4\u76f4\u63a5\u653e\u884c\uff0c"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u5982\u679c\u6309\u6b64\u5904\u914d\u7f6e\uff0c\u540e\u7eed\u5173\u4e8e\u5f00\u653e\u7f51\u7edc\u7aef\u53e3\u7684\u547d\u4ee4\u90fd\u53ef\u4ee5\u8df3\u8fc7\u3002"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u5728\u9632\u706b\u5899\u4e2d\u542f\u7528 Masquerade\uff08NAT\uff09\nsudo firewall-cmd --permanent --zone=public --add-masquerade\n\n# K8s\u7684Master \u8282\u70b9\u53caNode\u8282\u70b9\n# \u8fd9\u91cc 192.168.137.121/32 \u9650\u5b9a\u4e86\u5f53\u524dIP\uff0c\u5982\u679c\u8981\u5141\u8bb8 192.168.137.x \u6574\u4e2a\u7f51\u6bb5\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a 192.168.137.0/24\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.121/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.122/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.123/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.131/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.132/32" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="192.168.137.133/32" accept\'\n\n# Service \u7f51\u7edc\u53ca Pod\u7f51\u7edc\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="10.244.0.0/16" accept\'\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family="ipv4" source address="10.96.0.0/12" accept\'\n\n# \u5141\u8bb8 Pod \u7f51\u6bb5\u5230\u7f51\u5173 DNS\uff08192.168.137.1\uff09\u7684 UDP 53 \u6d41\u91cf\n# \u5982\u679c\u662f\u5728\u865a\u62df\u673a\u90e8\u7f72\uff0c\u8fd9\u91cc\u662f\u7269\u7406\u673a\u7684ip\uff0c\u540c\u65f6\u6ce8\u610f\u7269\u7406\u673a\u5173\u95ed\u9632\u706b\u5899\uff0c\u907f\u514dpod\u7f51\u7edcdns\u8bf7\u6c42\u62a5\u9519\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family=ipv4 source address=10.244.0.0/16 destination address=192.168.137.1/32 port port=53 protocol=udp accept\'\n\n# \u5141\u8bb8 Pod \u7f51\u6bb5\u5230\u5916\u90e8 DNS\uff08\u5982 8.8.8.8\uff09\u7684 UDP 53 \u6d41\u91cf\nsudo firewall-cmd --permanent --zone=public --add-rich-rule=\'rule family=ipv4 source address=10.244.0.0/16 destination address=8.8.8.8/32 port port=53 protocol=udp accept\'\n\n# \u3010Calico\u3011 IP-in-IP \u9700\u8981\u5f00\u653e\u534f\u8bae\u53f7\u4e3a4\u7684\u6d41\u91cf\nsudo firewall-cmd --permanent --add-rich-rule=\'rule protocol value="4" accept\'\n\n\n# \u3010Keepalived\u3011\u6dfb\u52a0\u6c38\u4e45\u89c4\u5219\u5141\u8bb8VRRP\u534f\u8bae\nsudo firewall-cmd --permanent --add-protocol=vrrp\n# \u3010Keepalived\u3011\u82e5\u4e0a\u8ff0\u547d\u4ee4\u62a5\u9519\uff08\u534f\u8bae\u540d\u79f0\u4e0d\u652f\u6301\uff09\uff0c\u6539\u7528\u5bcc\u89c4\u5219\u6307\u5b9a\u534f\u8bae\u53f7\nsudo firewall-cmd --permanent --add-rich-rule=\'rule protocol value="112" accept\'\n\n# \u3010Keepalived\u3011VRRP\u9ed8\u8ba4\u4f7f\u7528\u7ec4\u64ad\u5730\u5740224.0.0.18\u3002\u5141\u8bb8\u76f8\u5173\u7ec4\u64ad\u901a\u4fe1\nsudo firewall-cmd --permanent --add-rich-rule=\'rule family="ipv4" source address="224.0.0.18/32" accept\'\n\n# \u91cd\u65b0\u52a0\u8f7d\u9632\u706b\u5899\u89c4\u5219\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u89c4\u5219\nsudo firewall-cmd --list-all --zone=public\n\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b\u89c4\u5219\u7684\u8f93\u51fa\u793a\u4f8b\u5982\u4e0b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'[diginn@k8s-master-01 ~]$ sudo firewall-cmd --list-all --zone=public\n[sudo] diginn \u7684\u5bc6\u7801\uff1a\npublic (active)\n  target: default\n  icmp-block-inversion: no\n  interfaces: enp0s3\n  sources:\n  services: cockpit dhcpv6-client ssh\n  ports:\n  protocols: vrrp\n  forward: no\n  masquerade: yes\n  forward-ports:\n  source-ports:\n  icmp-blocks:\n  rich rules:\n        rule family="ipv4" source address="224.0.0.18/32" accept\n        rule family="ipv4" source address="192.168.137.131/32" accept\n        rule family="ipv4" source address="10.96.0.0/12" accept\n        rule protocol value="4" accept\n        rule family="ipv4" source address="192.168.137.121/32" accept\n        rule family="ipv4" source address="192.168.137.123/32" accept\n        rule family="ipv4" source address="192.168.137.132/32" accept\n        rule family="ipv4" source address="192.168.137.133/32" accept\n        rule family="ipv4" source address="10.244.0.0/16" accept\n        rule family="ipv4" source address="10.244.0.0/16" destination address="192.168.137.1/32" port port="53" protocol="udp" accept\n        rule protocol value="112" accept\n        rule family="ipv4" source address="192.168.137.122/32" accept\n        rule family="ipv4" source address="10.244.0.0/16" destination address="8.8.8.8/32" port port="53" protocol="udp" accept\n\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(93970).A+"",width:"1567",height:"975"})}),"\n",(0,l.jsx)(n.h3,{id:"39-\u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219",children:"3.9 \u914d\u7f6e\u9632\u706b\u5899\u653e\u884c\u89c4\u5219"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/reference/networking/ports-and-protocols/",children:"Kubernates\u8fd0\u884c\u5fc5\u8981\u7684\u7aef\u53e3"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u7ecf\u5b9e\u9645\u591a\u6b21\u6d4b\u8bd5\uff0c\u8fd9\u4e2a\u63a5\u53e3\u5217\u8868\u7f3a\u5c11\u5f88\u591a\u7aef\u53e3\uff0c\u4ec5kubernetes\u6838\u5fc3\u7684\u7aef\u53e3\uff0c\u4e00\u4e9b\u5fc5\u8981\u7684\u7ec4\u4ef6\u7aef\u53e3\u5e76\u6ca1\u6709\u5217\u51fa\u6765\uff0c\u540c\u4e00\u7ec4\u4ef6\u5728\u4e0d\u540c\u5de5\u4f5c\u6a21\u5f0f\u4e0b\u7684\u89c4\u5219\u8fd8\u4e0d\u76f8\u540c\uff0c\u5efa\u8bae\u7b2c\u4e00\u6b21\u90e8\u7f72\u65f6\u5173\u95ed\u9632\u706b\u5899\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u63a7\u5236\u9762"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u534f\u8bae"}),(0,l.jsx)(n.th,{children:"\u65b9\u5411"}),(0,l.jsx)(n.th,{children:"\u7aef\u53e3\u8303\u56f4"}),(0,l.jsx)(n.th,{children:"\u76ee\u7684"}),(0,l.jsx)(n.th,{children:"\u4f7f\u7528\u8005"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"6443"}),(0,l.jsx)(n.td,{children:"Kubernetes API \u670d\u52a1\u5668"}),(0,l.jsx)(n.td,{children:"\u6240\u6709"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"2379-2380"}),(0,l.jsx)(n.td,{children:"etcd \u670d\u52a1\u5668\u5ba2\u6237\u7aef API"}),(0,l.jsx)(n.td,{children:"kube-apiserver\u3001etcd"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"10250"}),(0,l.jsx)(n.td,{children:"kubelet API"}),(0,l.jsx)(n.td,{children:"\u81ea\u8eab\u3001\u63a7\u5236\u9762"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"10259"}),(0,l.jsx)(n.td,{children:"kube-scheduler"}),(0,l.jsx)(n.td,{children:"\u81ea\u8eab"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"10257"}),(0,l.jsx)(n.td,{children:"kube-controller-manager"}),(0,l.jsx)(n.td,{children:"\u81ea\u8eab"})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"\u5de5\u4f5c\u8282\u70b9"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u534f\u8bae"}),(0,l.jsx)(n.th,{children:"\u65b9\u5411"}),(0,l.jsx)(n.th,{children:"\u7aef\u53e3\u8303\u56f4"}),(0,l.jsx)(n.th,{children:"\u76ee\u7684"}),(0,l.jsx)(n.th,{children:"\u4f7f\u7528\u8005"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"10250"}),(0,l.jsx)(n.td,{children:"kubelet API"}),(0,l.jsx)(n.td,{children:"\u81ea\u8eab\u3001\u63a7\u5236\u9762"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"10256"}),(0,l.jsx)(n.td,{children:"kube-proxy"}),(0,l.jsx)(n.td,{children:"\u81ea\u8eab\u3001\u8d1f\u8f7d\u5747\u8861\u5668"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TCP"}),(0,l.jsx)(n.td,{children:"\u5165\u7ad9"}),(0,l.jsx)(n.td,{children:"30000-32767"}),(0,l.jsx)(n.td,{children:"NodePort Services\u2020"}),(0,l.jsx)(n.td,{children:"\u6240\u6709"})]})]})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5173\u95ed\u9632\u706b\u5899\uff08\u4e0d\u63a8\u8350\uff09\nsudo systemctl stop firewalld\nsudo systemctl disable firewalld\n\n## \u6253\u5f00\u7aef\u53e3\nsudo firewall-cmd --permanent --zone=public --add-port=6443/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=2379-2380/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10250/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10256/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10257/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=10259/tcp\nsudo firewall-cmd --permanent --zone=public --add-port=30000-32767/tcp\n\n# HTTP HTTPS\nsudo firewall-cmd --permanent --add-port=80/tcp\nsudo firewall-cmd --permanent --add-port=443/tcp\n\n# CoreDNS\nsudo firewall-cmd --permanent --add-port=53/tcp\nsudo firewall-cmd --permanent --add-port=53/udp\nsudo firewall-cmd --permanent --add-port=9153/udp\n\n# DHCP\nsudo firewall-cmd --permanent --add-port=67/udp\nsudo firewall-cmd --permanent --add-port=68/udp\n\n# ETCD\nsudo firewall-cmd --permanent --add-port=6666/tcp\nsudo firewall-cmd --permanent --add-port=6667/tcp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-port\n\n# \u67e5\u770b\u6240\u6709\u9632\u706b\u5899\u89c4\u5219\nsudo firewall-cmd --list-all\n\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u53ef\u4ee5\u7528 ",(0,l.jsx)(n.code,{children:"netcat"})," \u68c0\u67e5\u7aef\u53e3\u662f\u5426\u5f00\u653e"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5b89\u88c5netcat\nsudo dnf install -y nc\n\nnc 127.0.0.1 6443 -zv -w 2\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"310-\u5b89\u88c5\u5305\u4e0a\u4f20\u89e3\u538b",children:"3.10 \u5b89\u88c5\u5305\u4e0a\u4f20\u89e3\u538b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# 1. \u5c06 k8s-1.30.11-offline.tar.gz \u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff08192.168.137.121\uff09\n\n# 2. \u5c06 tar-1.30-5.el8.x86_64.rpm \u4e5f\u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff08192.168.137.121\uff09\n\n# 3. \u68c0\u67e5\u672c\u5730\u662f\u5426\u6709tar\uff0c\u6ca1\u6709\u5219\u5b89\u88c5 tar\ntar --version\nsudo rpm -ivh ./tar-1.30-5.el8.x86_64.rpm\n\n# 4. \u5c06tar\u5b89\u88c5\u5305\u53ca\u79bb\u7ebf\u5b89\u88c5\u5305\u4f20\u8f93\u5230\u5176\u4ed6\u9700\u8981\u5b89\u88c5\u7684\u8282\u70b9\nscp -r ./k8s-1.30.11-offline.tar.gz diginn@192.168.137.122:/home/diginn/\nscp -r ./tar-1.30-5.el8.x86_64.rpm diginn@192.168.137.122:/home/diginn/\n\n# ...  \u5176\u4ed6\u8282\u70b9\u7701\u7565\uff0c\u4fee\u6539ip\u5373\u53ef\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"311-\u4f9d\u8d56\u9879\u5b89\u88c5",children:"3.11 \u4f9d\u8d56\u9879\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# 1. \u89e3\u538b\u538b\u7f29\u5305\ntar -zxvf ./k8s-1.30.11-offline.tar.gz\ncd k8s-install\n\n# 2. \u5b89\u88c5\u5404\u79cd\u4f9d\u8d56\nsudo rpm -ivh ./lib/vim/*.rpm\nsudo rpm -ivh ./lib/tar/*.rpm\nsudo rpm -ivh ./lib/unzip/*.rpm\nsudo rpm -ivh ./lib/wget/*.rpm\nsudo rpm -ivh ./lib/nc/*.rpm\nsudo rpm -ivh ./lib/ebtables/*.rpm\nsudo rpm -ivh ./lib/ethtool/*.rpm\nsudo rpm -ivh ./lib/net-tools/*.rpm\nsudo rpm -ivh ./lib/iproute-tc/*.rpm\nsudo rpm -ivh ./lib/ipset/*.rpm\nsudo rpm -ivh ./lib/ipvsadm/*.rpm\nsudo rpm -ivh ./lib/bash-completion/*.rpm\n\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u56db\u6240\u6709\u8282\u70b9docker\u5b89\u88c5\u914d\u7f6e\u5bb9\u5668\u8fd0\u884c\u65f6",children:"\u56db\u3001\u3010\u6240\u6709\u8282\u70b9\u3011Docker\u5b89\u88c5\u914d\u7f6e\uff08\u5bb9\u5668\u8fd0\u884c\u65f6\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.docker.com/engine/install/centos/",children:"CentOS\u5b89\u88c5Docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://developer.aliyun.com/mirror/docker-ce",children:"\u963f\u91cc\u4e91Docker\u955c\u50cf"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://download.docker.com/linux/centos/8/x86_64/stable/Packages/",children:"Docker\u79bb\u7ebf\u5b89\u88c5\u5305\u4e0b\u8f7d"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"41-\u5378\u8f7d\u5df2\u6709docker-engine",children:"4.1 \u5378\u8f7d\u5df2\u6709Docker Engine"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo dnf remove docker \\\n                docker-client \\\n                docker-client-latest \\\n                docker-common \\\n                docker-latest \\\n                docker-latest-logrotate \\\n                docker-logrotate \\\n                docker-engine\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"42-\u5b89\u88c5docker",children:"4.2 \u5b89\u88c5Docker"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u6b64\u5904\u76ee\u5f55\u4e3a\u79bb\u7ebf\u5b89\u88c5\u5305\u89e3\u538b\u540e\u7684\u76ee\u5f55\ncd ~/k8s-install\n\n# \u5b89\u88c5\u79bb\u7ebf\u5305\nsudo rpm -ivh ./docker/docker-ce/*.rpm\nsudo rpm -ivh ./docker/docker-ce-cli/*.rpm\nsudo rpm -ivh ./docker/containerd/*.rpm\nsudo rpm -ivh ./docker/docker-buildx-plugin/*.rpm\nsudo rpm -ivh ./docker/docker-compose-plugin/*.rpm\n\n# \u8fd0\u884cDocker Engine\nsudo systemctl enable --now docker\n\n# \u5c06\u5f53\u524d\u7528\u6237\u52a0\u5165\u5230docker\u64cd\u4f5c\u7ec4 \u8bbe\u7f6e\u5b8c\u540e\u9700\u8981\u91cd\u65b0\u767b\u5f55\nsudo usermod -aG docker $USER\n\n# \u6d4b\u8bd5Docker\u662f\u5426\u5b89\u88c5\u6210\u529f\ndocker run hello-world\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(83584).A+"",width:"1567",height:"975"})}),"\n",(0,l.jsx)(n.h3,{id:"43-\u5982\u679c\u9700\u8981\u5378\u8f7d\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4",children:"4.3 \u5982\u679c\u9700\u8981\u5378\u8f7d\uff0c\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5378\u8f7d docker\nsudo dnf remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras\n\n# \u5220\u9664\u76f8\u5173\u76ee\u5f55\nsudo rm -rf /var/lib/docker\nsudo rm -rf /var/lib/containerd\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"44-\u914d\u7f6edocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93",children:"4.4 \u914d\u7f6eDocker\u9a71\u52a8\u53ca\u955c\u50cf\u4ed3\u5e93"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u914d\u7f6e\u9a71\u52a8\ncat <<EOF | sudo tee /etc/docker/daemon.json\n{\n  "exec-opts": ["native.cgroupdriver=systemd"],\n  "log-driver": "json-file",\n  "log-opts": {\n    "max-size": "100m"\n  },\n  "storage-driver": "overlay2",\n  "registry-mirrors": [\n    "https://docker.hpcloud.cloud",\n    "https://docker.m.daocloud.io",\n    "https://docker.unsee.tech",\n    "https://docker.1panel.live",\n    "http://mirrors.ustc.edu.cn",\n    "https://docker.chenby.cn",\n    "http://mirror.azure.cn",\n    "https://dockerpull.org",\n    "https://dockerhub.icu",\n    "https://hub.rat.dev"\n  ]\n}\nEOF\n\n# \u91cd\u542fdocker\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"45-\u5b89\u88c5cri-dockerd\u9a71\u52a8docker\u4e0ek8s\u96c6\u6210\u7684\u9002\u914d\u5c42",children:"4.5 \u5b89\u88c5cri-dockerd\u9a71\u52a8\uff08Docker\u4e0eK8s\u96c6\u6210\u7684\u9002\u914d\u5c42\uff09"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://mirantis.github.io/cri-dockerd/usage/install/",children:"CRI-Dockerd\u5b89\u88c5\u6587\u6863"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Docker Engine \u6ca1\u6709\u5b9e\u73b0 ",(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/concepts/architecture/cri/",children:"CRI"}),"\uff0c \u800c\u8fd9\u662f\u5bb9\u5668\u8fd0\u884c\u65f6\u5728 Kubernetes \u4e2d\u5de5\u4f5c\u6240\u9700\u8981\u7684\u3002 \u4e3a\u6b64\uff0c\u5fc5\u987b\u5b89\u88c5\u4e00\u4e2a\u989d\u5916\u7684\u670d\u52a1 ",(0,l.jsx)(n.a,{href:"https://github.com/Mirantis/cri-dockerd",children:"cri-dockerd"}),"\u3002 cri-dockerd \u662f\u4e00\u4e2a\u57fa\u4e8e\u4f20\u7edf\u7684\u5185\u7f6e Docker \u5f15\u64ce\u652f\u6301\u7684\u9879\u76ee\uff0c \u5b83\u5728 1.24 \u7248\u672c\u4ece kubelet \u4e2d",(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/dockershim",children:"\u79fb\u9664"}),"\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo rpm -ivh ./cri/cri-dockerd-0.3.14-3.el8.x86_64.rpm\n\n# \u542f\u52a8\nsudo systemctl daemon-reload\nsudo systemctl enable cri-docker\nsudo systemctl start cri-docker\nsudo systemctl status cri-docker\n\n\n# \u68c0\u67e5CRI\u5957\u63a5\u5b57\nll /run/cri-dockerd.sock\n\nll /var/run/cri-dockerd.sock\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(7911).A+"",width:"1567",height:"975"})}),"\n",(0,l.jsx)(n.h2,{id:"\u4e94\u6240\u6709\u8282\u70b9\u5b89\u88c5-kubeadmkubelet-\u548c-kubectl",children:"\u4e94\u3001\u3010\u6240\u6709\u8282\u70b9\u3011\u5b89\u88c5 kubeadm\u3001kubelet \u548c kubectl"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.downloadkubernetes.com/",children:"Kubernetes\u4e0b\u8f7d"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u9700\u8981\u5728\u6bcf\u53f0\u673a\u5668\u4e0a\u5b89\u88c5\u4ee5\u4e0b\u7684\u8f6f\u4ef6\u5305\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kubeadm"}),"\uff1a\u7528\u6765\u521d\u59cb\u5316\u96c6\u7fa4\u7684\u6307\u4ee4\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kubelet"}),"\uff1a\u5728\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7528\u6765\u542f\u52a8 Pod \u548c\u5bb9\u5668\u7b49\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kubectl"}),"\uff1a\u7528\u6765\u4e0e\u96c6\u7fa4\u901a\u4fe1\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"Pod"}),": Kubernetes\u7684\u6700\u5c0f\u5de5\u4f5c\u5355\u5143\u3002\u6bcf\u4e2a",(0,l.jsx)(n.code,{children:"Pod"}),"\u5305\u542b\u4e00\u4e2a\u6216\u591a\u4e2a\u5bb9\u5668\u3002",(0,l.jsx)(n.code,{children:"Pod"}),"\u4e2d\u7684\u5bb9\u5668\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u88ab",(0,l.jsx)(n.code,{children:"Master"}),"\u8c03\u5ea6\u5230\u4e00\u4e2a",(0,l.jsx)(n.code,{children:"Node"}),"\u4e0a\u8fd0\u884c."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kubeadm"})," \u4e0d\u80fd\u5e2e\u4f60\u5b89\u88c5\u6216\u8005\u7ba1\u7406 ",(0,l.jsx)(n.code,{children:"kubelet"})," \u6216 ",(0,l.jsx)(n.code,{children:"kubectl"}),"\uff0c \u6240\u4ee5\u4f60\u9700\u8981\u786e\u4fdd\u5b83\u4eec\u4e0e\u901a\u8fc7 ",(0,l.jsx)(n.code,{children:"kubeadm"})," \u5b89\u88c5\u7684\u63a7\u5236\u5e73\u9762\u7684\u7248\u672c\u76f8\u5339\u914d\u3002 \u5982\u679c\u4e0d\u8fd9\u6837\u505a\uff0c\u5219\u5b58\u5728\u53d1\u751f\u7248\u672c\u504f\u5dee\u7684\u98ce\u9669\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u9884\u6599\u4e4b\u5916\u7684\u9519\u8bef\u548c\u95ee\u9898\u3002 \u7136\u800c\uff0c\u63a7\u5236\u5e73\u9762\u4e0e ",(0,l.jsx)(n.code,{children:"kubelet"})," \u4e4b\u95f4\u53ef\u4ee5\u5b58\u5728\u4e00\u4e2a\u6b21\u8981\u7248\u672c\u7684\u504f\u5dee\uff0c\u4f46 ",(0,l.jsx)(n.code,{children:"kubelet"})," \u7684\u7248\u672c\u4e0d\u53ef\u4ee5\u8d85\u8fc7 API \u670d\u52a1\u5668\u7684\u7248\u672c\u3002 \u4f8b\u5982\uff0c1.7.0 \u7248\u672c\u7684 ",(0,l.jsx)(n.code,{children:"kubelet"})," \u53ef\u4ee5\u5b8c\u5168\u517c\u5bb9 1.8.0 \u7248\u672c\u7684 API \u670d\u52a1\u5668\uff0c\u53cd\u4e4b\u5219\u4e0d\u53ef\u4ee5\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:["\u6709\u5173\u5b89\u88c5 ",(0,l.jsx)(n.code,{children:"kubectl"})," \u7684\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605",(0,l.jsx)(n.a,{href:"https://kubernetes.io/zh-cn/docs/tasks/tools/",children:"\u5b89\u88c5\u548c\u8bbe\u7f6e kubectl"})," \u6587\u6863\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"51-\u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a-mac-\u5730\u5740\u548c-product_uuid-\u7684\u552f\u4e00\u6027",children:"5.1 \u786e\u4fdd\u6bcf\u4e2a\u8282\u70b9\u4e0a MAC \u5730\u5740\u548c product_uuid \u7684\u552f\u4e00\u6027"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 ",(0,l.jsx)(n.code,{children:"ip link"})," \u6216 ",(0,l.jsx)(n.code,{children:"ifconfig -a"})," \u6765\u83b7\u53d6\u7f51\u7edc\u63a5\u53e3\u7684 MAC \u5730\u5740"]}),"\n"]}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"sudo cat /sys/class/dmi/id/product_uuid"})," \u547d\u4ee4\u5bf9 ",(0,l.jsx)(n.code,{children:"product_uuid"})," \u6821\u9a8c"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"\nip link | grep link/ether\n\n# \u67e5\u770b product_uuid\nsudo cat /sys/class/dmi/id/product_uuid\n"})}),"\n",(0,l.jsx)(n.h3,{id:"52-\u5b89\u88c5-kubeletkubeadm-\u548c-kubectl",children:"5.2 \u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u6b64\u5904\u76ee\u5f55\u4e3a\u79bb\u7ebf\u5b89\u88c5\u5305\u7684\u89e3\u538b\u540e\u7684\u76ee\u5f55\ncd ~/k8s-install\n\n# \u5b89\u88c5 kubelet\u3001kubeadm \u548c kubectl\nsudo rpm -ivh ./k8s/kubeadm/*.rpm\nsudo rpm -ivh ./k8s/kubectl/*.rpm\nsudo rpm -ivh ./k8s/kubelet/*.rpm\n\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4fee\u6539\u914d\u7f6e"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'sudo vim /etc/sysconfig/kubelet\n# \u5c06KUBELET_EXTRA_ARGS \u7684\u503c\u8bbe\u7f6e\u4e3a\nKUBELET_EXTRA_ARGS="--cgroup-driver=systemd"\n\n# \u542f\u7528 kubelet \u4ee5\u786e\u4fdd\u5b83\u5728\u542f\u52a8\u65f6\u81ea\u52a8\u542f\u52a8\nsudo systemctl enable --now kubelet\n\n'})}),"\n",(0,l.jsx)(n.h3,{id:"53-\u4e0b\u8f7dk8s\u4f9d\u8d56\u955c\u50cf",children:"5.3 \u4e0b\u8f7dK8s\u4f9d\u8d56\u955c\u50cf"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u521d\u59cb\u5316\u6240\u9700\u7684\u955c\u50cf\nkubeadm config images list\n\n# \u52a0\u8f7d\u955c\u50cf\ncd ~/k8s-install/\n./docker_image_tool.sh import images\n\n# \u67e5\u770b\u955c\u50cf\u5217\u8868\ndocker image list\n\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(6830).A+"",width:"1567",height:"975"}),"\n",(0,l.jsx)(n.img,{src:s(9253).A+"",width:"1567",height:"975"})]}),"\n",(0,l.jsx)(n.h2,{id:"\u516d\u4ec5master\u8282\u70b9\u5b89\u88c5haproxy-keepalived",children:"\u516d\u3001\u3010\u4ec5Master\u8282\u70b9\u3011\u5b89\u88c5HAProxy Keepalived"}),"\n",(0,l.jsx)(n.p,{children:"\u5728 k8s \u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u4e2d\uff0c\u901a\u5e38\u4f7f\u7528 haproxy \u548c keepalived \u4f5c\u4e3a\u9ad8\u53ef\u7528\u7684\u7ec4\u4ef6\uff0c\u5bf9\u4e8e k8s \u7684\u9ad8\u53ef\u7528\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u65b9\u9762\uff1a apiserver \u548c etcd\u3002 apiserver \u662f k8s \u7684\u5165\u53e3\uff0cetcd \u5219\u4e3a k8s \u7684\u6570\u636e\u5b58\u50a8\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u4e3b\u8981\u8bb2\u8ff0\u5982\u4f55\u5bf9 apiserver \u8fdb\u884c\u9ad8\u53ef\u7528\u7684\u914d\u7f6e\uff0cetcd \u7684\u9ad8\u53ef\u7528\u914d\u7f6e\u5c06\u5728\u96c6\u7fa4\u7684\u751f\u6210\u7684\u65f6\u5019\uff0c\u7531 kubeadm \u8fdb\u884c\u81ea\u884c\u914d\u7f6e\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"61-\u5f00\u653e\u7aef\u53e3",children:"6.1 \u5f00\u653e\u7aef\u53e3"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/tanghu/p/12617840.html",children:"CentOS7\u4e0b\u914d\u7f6e\u9632\u706b\u5899\u653e\u8fc7Keepalived"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/lgh344902118/p/7737129.html",children:"centos7 keepalived\u4ee5\u53ca\u9632\u706b\u5899\u914d\u7f6e"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u6dfb\u52a0\u6c38\u4e45\u89c4\u5219\u5141\u8bb8VRRP\u534f\u8bae\nsudo firewall-cmd --permanent --add-protocol=vrrp\n# \u82e5\u4e0a\u8ff0\u547d\u4ee4\u62a5\u9519\uff08\u534f\u8bae\u540d\u79f0\u4e0d\u652f\u6301\uff09\uff0c\u6539\u7528\u5bcc\u89c4\u5219\u6307\u5b9a\u534f\u8bae\u53f7\nsudo firewall-cmd --permanent --add-rich-rule=\'rule protocol value="112" accept\'\n\n# VRRP\u9ed8\u8ba4\u4f7f\u7528\u7ec4\u64ad\u5730\u5740224.0.0.18\u3002\u5141\u8bb8\u76f8\u5173\u7ec4\u64ad\u901a\u4fe1\nsudo firewall-cmd --permanent --add-rich-rule=\'rule family="ipv4" source address="224.0.0.18/32" accept\'\n\n# HAProxy\u4ee3\u7406\u63a5\u53e3\nsudo firewall-cmd --permanent --zone=public --add-port=16443/tcp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-all\n\n# protocols: vrrp\n# rich rules: \n#     rule protocol value="112" accept\n#     rule family="ipv4" source address="224.0.0.18/32" accept\n\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u5728\u914d\u7f6e\u9632\u706b\u5899\u89c4\u5219\u4e4b\u540e\uff0c",(0,l.jsx)(n.code,{children:"192.168.137.140"})," IP\u4ec5\u5728Keepalived\u4e3b\u8282\u70b9\u4e0a\uff0c\u5907\u4efd\u8282\u70b9\u6ca1\u6709\u8fd9\u4e2aip\uff0c\u5907\u4efd\u8282\u70b9\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2aIP\u8bbf\u95ee\u5230\u4e3b\u8282\u70b9"]}),"\n",(0,l.jsx)(n.h3,{id:"62-\u5b89\u88c5keepalived-haproxy",children:"6.2 \u5b89\u88c5Keepalived HAProxy"}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6240\u6709Master\u8282\u70b9\u90fd\u8981\u6267\u884c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cd ~/k8s-install\n\n# \u79bb\u7ebf\u5b89\u88c5keepalived haproxy\nsudo rpm -ivh ./haproxy/*.rpm\nsudo rpm -ivh ./keepalived/*.rpm\n\n# \u5907\u4efd\u914d\u7f6e\u6587\u4ef6\nsudo mv /etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf.bakup\nsudo mv /etc/haproxy/haproxy.cfg /etc/haproxy/haproxy.cfg.bakup\n\n# \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\nll /etc/keepalived/\nll /etc/haproxy/\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"63-\u914d\u7f6ehaproxy",children:"6.3 \u914d\u7f6eHAProxy"}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6240\u6709Master\u8282\u70b9\u90fd\u8981\u6267\u884c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/haproxy/haproxy.cfg\nglobal\n    log /dev/log    local0\n    log /dev/log    local1 notice\n    chroot /var/lib/haproxy\n    stats timeout 30s\n    user haproxy\n    group haproxy\n    daemon\n\ndefaults\n    log     global\n    mode    tcp\n    option  tcplog\n    option  dontlognull\n    timeout connect 5000\n    timeout client  50000\n    timeout server  50000\n\nfrontend https-in\n    bind *:16443\n    mode tcp\n    option tcplog\n\n    default_backend servers-backend\n\nbackend servers-backend\n    mode tcp\n    balance roundrobin\n    option tcp-check\n\n    server k8s-master-01 192.168.137.121:6443 check\n    server k8s-master-02 192.168.137.122:6443 check\n    server k8s-master-03 192.168.137.123:6443 check\nEOF\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"64-\u914d\u7f6ekeepalived",children:"6.4 \u914d\u7f6eKeepalived"}),"\n",(0,l.jsx)(n.p,{children:"\u6b64\u6b65\u9aa4\u6bcf\u4e2aMaster\u8282\u70b9\u6267\u884c\u5bf9\u5e94\u7684\u914d\u7f6e"}),"\n",(0,l.jsxs)(n.h4,{id:"641-192168137121\u4f5c\u4e3avip\u7684\u4e3b\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",children:["6.4.1 ",(0,l.jsx)(n.code,{children:"192.168.137.121"}),"\u4f5c\u4e3aVIP\u7684\u4e3b\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n}\nvrrp_instance VI_1 {\n    state MASTER                    # \u8bbe\u7f6e\u4e3a\u4e3b\u8282\u70b9\n    interface enp0s3                # \u7f51\u7edc\u63a5\u53e3\uff0c\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\n    virtual_router_id 51            # VRRP \u8def\u7531ID\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    priority 100                    # \u4f18\u5148\u7ea7\uff0c\u4e3b\u8282\u70b9\u5fc5\u987b\u9ad8\u4e8e\u5907\u4efd\u8282\u70b9\n    advert_int 1                    # VRRP\u901a\u544a\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\n    unicast_peer {                  # \u914d\u7f6eunicast_peers\uff0c\u6307\u5b9a\u5176\u4ed6\u4e24\u53f0\u670d\u52a1\u5668\u7684IP\n        192.168.137.122\n        192.168.137.123\n    }\n\n    authentication {\n        auth_type PASS              # \u8ba4\u8bc1\u7c7b\u578b\n        auth_pass 1234              # \u8ba4\u8bc1\u5bc6\u7801\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    }\n    virtual_ipaddress {\n        192.168.137.140             # \u865a\u62dfIP\u5730\u5740\uff0c\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u4fee\u6539\n    }\n}\nEOF\n\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"642-192168137122\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",children:["6.4.2 ",(0,l.jsx)(n.code,{children:"192.168.137.122"}),"\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n}\n\nvrrp_instance VI_1 {\n    state BACKUP                    # \u8bbe\u7f6e\u4e3a\u5907\u4efd\u8282\u70b9\n    interface enp0s3                # \u786e\u4fdd\u4f7f\u7528\u6b63\u786e\u7684\u7f51\u7edc\u63a5\u53e3\u540d\u79f0\n    virtual_router_id 51            # VRRP \u8def\u7531ID\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    priority 50                     # \u4f18\u5148\u7ea7\uff0c\u5907\u4efd\u8282\u70b9\u5fc5\u987b\u4f4e\u4e8e\u4e3b\u8282\u70b9\n    advert_int 1                    # VRRP\u901a\u544a\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\n    unicast_peer {                  # \u914d\u7f6eunicast_peers\uff0c\u6307\u5b9a\u5176\u4ed6\u4e24\u53f0\u670d\u52a1\u5668\u7684IP\n        192.168.137.121\n        192.168.137.123\n    }\n\n    authentication {\n        auth_type PASS              # \u8ba4\u8bc1\u7c7b\u578b\n        auth_pass 1234              # \u8ba4\u8bc1\u5bc6\u7801\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    }\n\n    virtual_ipaddress {\n        192.168.137.140             # \u865a\u62dfIP\u5730\u5740\uff0c\u4e0e\u4e3b\u8282\u70b9\u76f8\u540c\n    }\n}\nEOF\n\n"})}),"\n",(0,l.jsxs)(n.h4,{id:"643-192168137123\u4f5c\u4e3avip\u7684\u5907\u4efd\u8282\u70b9\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b",children:["6.4.3 ",(0,l.jsx)(n.code,{children:"192.168.137.123"}),"\u4f5c\u4e3aVIP\u7684\u5907\u4efd\u8282\u70b9\uff0c\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"cat <<EOF | sudo tee /etc/keepalived/keepalived.conf\n! Configuration File for keepalived\nglobal_defs {\n    router_id LVS_DEVEL\n}\n\nvrrp_instance VI_1 {\n    state BACKUP                    # \u8bbe\u7f6e\u4e3a\u5907\u4efd\u8282\u70b9\n    interface enp0s3                # \u786e\u4fdd\u4f7f\u7528\u6b63\u786e\u7684\u7f51\u7edc\u63a5\u53e3\u540d\u79f0\n    virtual_router_id 51            # VRRP \u8def\u7531ID\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    priority 40                     # \u4f18\u5148\u7ea7\uff0c\u5907\u4efd\u8282\u70b9\u5fc5\u987b\u4f4e\u4e8e\u4e3b\u8282\u70b9\n    advert_int 1                    # VRRP\u901a\u544a\u95f4\u9694\uff0c\u5355\u4f4d\u79d2\n    unicast_peer {                  # \u914d\u7f6eunicast_peers\uff0c\u6307\u5b9a\u5176\u4ed6\u4e24\u53f0\u670d\u52a1\u5668\u7684IP\n        192.168.137.121\n        192.168.137.122\n    }\n\n    authentication {\n        auth_type PASS              # \u8ba4\u8bc1\u7c7b\u578b\n        auth_pass 1234              # \u8ba4\u8bc1\u5bc6\u7801\uff0c\u4e3b\u5907\u8282\u70b9\u5fc5\u987b\u76f8\u540c\n    }\n\n    virtual_ipaddress {\n        192.168.137.140             # \u865a\u62dfIP\u5730\u5740\uff0c\u4e0e\u4e3b\u8282\u70b9\u76f8\u540c\n    }\n}\nEOF\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"65-\u542f\u52a8keepalived-haproxy",children:"6.5 \u542f\u52a8Keepalived HAProxy"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\ncat /etc/haproxy/haproxy.cfg\ncat /etc/keepalived/keepalived.conf\n\n# \u542f\u52a8\u670d\u52a1\nsudo systemctl start keepalived\nsudo systemctl start haproxy\n\n# \u5f00\u673a\u81ea\u542f\nsudo systemctl enable --now keepalived\nsudo systemctl enable --now haproxy\n\n# \u67e5\u770b\u72b6\u6001\nsudo systemctl status keepalived\nsudo systemctl status haproxy\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(29283).A+"",width:"1567",height:"975"})}),"\n",(0,l.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\uff0c\u53ea\u6709 ",(0,l.jsx)(n.code,{children:"192.168.137.121"})," \u6709\u865a\u62dfIP ",(0,l.jsx)(n.code,{children:"192.168.137.140"})]}),"\n",(0,l.jsx)(n.h2,{id:"\u4e03\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc",children:"\u4e03\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u4f7f\u7528kubeadm\u521b\u5efa\u96c6\u7fa4\u5e76\u914d\u7f6e\u7f51\u7edc"}),"\n",(0,l.jsx)(n.h3,{id:"71-\u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9",children:"7.1 \u542f\u52a8\u96c6\u7fa4\u4e3b\u8282\u70b9"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u79bb\u7ebf\u90e8\u7f72\u65f6\uff0c\u9700\u8981\u5c06 ",(0,l.jsx)(n.code,{children:"--image-repository"})," \u8bbe\u7f6e\u4e3a\u672c\u5730\u955c\u50cf\u4ed3\u5e93\u5730\u5740\uff0c\u6216\u8005\u5f53\u524d\u670d\u52a1\u5668\u4e0a\u7684\u955c\u50cf\u524d\u7f00\uff0c\u5426\u5219\u56de\u51fa\u73b0\u670d\u52a1\u90e8\u7f72\u627e\u4e0d\u5230\u955c\u50cf\u7684\u60c5\u51b5"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u3010\u9ed8\u8ba4\u3011\u9ed8\u8ba4\u7684\u955c\u50cf\u4ed3\u5e93\u65e0\u6cd5\u8bbf\u95ee  ",(0,l.jsx)(n.code,{children:"--image-repository=registry.k8s.io"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u3010\u5728\u7ebf\u3011\u5728\u7ebf\u4f7f\u7528\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93  ",(0,l.jsx)(n.code,{children:"--image-repository=registry.aliyuncs.com/google_containers"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u3010\u79bb\u7ebf\u3011\u79bb\u7ebf\u4f7f\u7528\u81ea\u5efa\u955c\u50cf\u4ed3\u5e93    ",(0,l.jsx)(n.code,{children:"--image-repository=registry.example.com"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5982\u679c\u79bb\u7ebf\u4ed3\u5e93\u7684\u524d\u7f00\u4e3a registry.example.com\uff0c\u7ed9\u955c\u50cf\u91cd\u65b0\u6253Tag\ndocker tag registry.k8s.io/kube-apiserver:v1.30.11          registry.example.com/kube-apiserver:v1.30.11\ndocker tag registry.k8s.io/kube-controller-manager:v1.30.11 registry.example.com/kube-controller-manager:v1.30.11 \ndocker tag registry.k8s.io/kube-scheduler:v1.30.11          registry.example.com/kube-scheduler:v1.30.11\ndocker tag registry.k8s.io/kube-proxy:v1.30.11              registry.example.com/kube-proxy:v1.30.11\ndocker tag registry.k8s.io/coredns/coredns:v1.11.3          registry.example.com/coredns:v1.11.3\ndocker tag registry.k8s.io/pause:3.9                        registry.example.com/pause:3.9    \ndocker tag registry.k8s.io/etcd:3.5.15-0                    registry.example.com/etcd:3.5.15-0\n\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u96c6\u7fa4\nsudo kubeadm init \\\n  --kubernetes-version=v1.30.11 \\\n  --control-plane-endpoint=192.168.137.140:16443 \\\n  --image-repository=registry.k8s.io \\\n  --service-cidr=10.96.0.0/12 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --upload-certs \\\n  --cri-socket=unix:///var/run/cri-dockerd.sock\n\n# \u67e5\u770b\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\nsudo kubectl -n kube-system get cm kubeadm-config -o yaml\n\n# \u5982\u679c\u521d\u59cb\u5316\u5f02\u5e38\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u91cd\u7f6e\nsudo kubeadm reset --cri-socket=unix:///var/run/cri-dockerd.sock\n\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"kubernetes-version"}),": K8s\u7248\u672c\uff0c\u4e0e\u4e0a\u9762\u5b89\u88c5\u7684\u4e00\u81f4"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"--control-plane-endpoint"}),": \u63a7\u5236\u9762\u7aef\u70b9\uff0c\u914d\u7f6eVIP\u7684\u5730\u5740 ",(0,l.jsx)(n.code,{children:"192.168.137.140"})," \u7aef\u53e3\u4e3aHAProxy\u4ee3\u7406\u7684\u7aef\u53e3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"apiserver-advertise-address"}),": master\u4e3b\u673a\u5185\u7f51IP\u5730\u5740"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"image-repository"}),": \u6307\u5b9a\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u5730\u5740\u3002\u7531\u4e8ekubeadm \u9ed8\u8ba4\u4ece\u5b98\u7f51",(0,l.jsx)(n.a,{href:"http://k8s.grc.io%E4%B8%8B%E8%BD%BD%E6%89%80%E9%9C%80%E9%95%9C%E5%83%8F%EF%BC%8C%E5%9B%BD%E5%86%85%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%9B%A0%E6%AD%A4%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E4%BB%93%E5%BA%93%E5%9C%B0%E5%9D%80",children:"http://k8s.grc.io\u4e0b\u8f7d\u6240\u9700\u955c\u50cf\uff0c\u56fd\u5185\u65e0\u6cd5\u8bbf\u95ee\uff0c\u56e0\u6b64\u9700\u8981\u6307\u5b9a\u963f\u91cc\u4e91\u955c\u50cf\u4ed3\u5e93\u5730\u5740"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"service-cidr"}),": \u96c6\u7fa4\u5185\u90e8\u865a\u62df\u7f51\u7edc\uff0cPod\u7edf\u4e00\u8bbf\u95ee\u5165\u53e3"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"pod-network-cidr"}),": \u5b9a\u4e49pod\u7f51\u6bb5\u4e3a, ",(0,l.jsx)(n.code,{children:"10.244.0.0/16"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u6267\u884c\u540e\u6253\u5370\u7684\u65e5\u5fd7\u4fe1\u606f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u7b49\u5f85\u6210\u529f\u540e\u6309\u7167\u63d0\u793a\u914d\u7f6e\u8bbf\u95ee\u7684.kube/config\u5373\u53ef\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nYou can now join any number of the control-plane node running the following command on each as root:\n\n  kubeadm join 192.168.137.140:16443 --token 2r9al6.7aihc5kam8ipilf2 \\\n        --discovery-token-ca-cert-hash sha256:92617f50af1f76b87c539ce97614eadaef174e5d4c27e0d858ad1713d0e15fca \\\n        --control-plane --certificate-key 3add7e76c93d21c016162a9cb89f3bff78b2a358f79b78995855d6d306380d28\n\nPlease note that the certificate-key gives access to cluster sensitive data, keep it secret!\nAs a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use\n"kubeadm init phase upload-certs --upload-certs" to reload certs afterward.\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.137.140:16443 --token 2r9al6.7aihc5kam8ipilf2 \\\n        --discovery-token-ca-cert-hash sha256:92617f50af1f76b87c539ce97614eadaef174e5d4c27e0d858ad1713d0e15fca\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(66456).A+"",width:"1567",height:"917"}),"\n",(0,l.jsx)(n.img,{src:s(62067).A+"",width:"1567",height:"917"})]}),"\n",(0,l.jsx)(n.h3,{id:"72-\u914d\u7f6emaster\u8282\u70b9",children:"7.2 \u914d\u7f6eMaster\u8282\u70b9"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u6309\u7167\u5b89\u88c5\u5b8c\u6210\u7684\u63d0\u793a\u6267\u884c\u547d\u4ee4\uff08\u6b64\u65f6\u9700\u8981\u4f7f\u7528\u666e\u901a\u7528\u6237\uff09\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n# \u83b7\u53d6\u8282\u70b9\u4fe1\u606f\u548cpod\u4fe1\u606f\nkubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(30154).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h2,{id:"\u516b\u5176\u4ed6master\u8282\u70b9master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",children:"\u516b\u3001\u3010\u5176\u4ed6Master\u8282\u70b9\u3011Master\u8282\u70b9\u52a0\u5165\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.h3,{id:"81-\u8282\u70b9\u521d\u59cb\u5316",children:"8.1 \u8282\u70b9\u521d\u59cb\u5316"}),"\n",(0,l.jsx)(n.p,{children:"\u6309\u987a\u5e8f\u6267\u884c\u4e0a\u9762 \u3010\u4e09\u3001\u56db\u3001\u4e94\u3011 \u7684\u6240\u6709\u914d\u7f6e\u53ca\u5b89\u88c5\u547d\u4ee4\uff0c\u6b64\u5904\u4e0d\u518d\u91cd\u590d"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u5728 ",(0,l.jsx)(n.code,{children:"192.168.137.122"})," ",(0,l.jsx)(n.code,{children:"192.168.137.123"})," \u9700\u8981\u6309\u7167 \u3010\u516d\u3011 \u7684\u6b65\u9aa4\u5b89\u88c5\u914d\u7f6eHAProxy keepalived"]}),"\n",(0,l.jsx)(n.h3,{id:"82-\u73af\u5883\u68c0\u67e5",children:"8.2 \u73af\u5883\u68c0\u67e5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bDocker\u7248\u672c\ndocker version\n\n# \u67e5\u770bK8s\u7248\u672c\nkubeadm version \n\nkubectl version --client\n\nkubelet --version\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(16400).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h3,{id:"83-\u52a0\u5165master\u8282\u70b9",children:"8.3 \u52a0\u5165Master\u8282\u70b9"}),"\n",(0,l.jsx)(n.h4,{id:"831-\u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684token",children:"8.3.1 \u751f\u6210\u52a0\u5165\u96c6\u7fa4\u7684Token"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5728\u521d\u59cb\u5316\u7684Master\u8282\u70b9\u6253\u5370\u52a0\u5165\u8282\u70b9\u6307\u4ee4\nsudo kubeadm token create --print-join-command\n\n# \u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\n[diginn@k8s-master-01 k8s-install]$ sudo kubeadm token create --print-join-command\nkubeadm join 192.168.137.140:16443 --token hug90i.rk23nqjt4tm0jnwq --discovery-token-ca-cert-hash sha256:92617f50af1f76b87c539ce97614eadaef174e5d4c27e0d858ad1713d0e15fca\n\n"})}),"\n",(0,l.jsx)(n.h4,{id:"832-\u521d\u59cb\u5316master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230-etcd-\u4e2d",children:"8.3.2 \u521d\u59cb\u5316Master\u8282\u70b9\u65f6\u4e0a\u4f20\u8bc1\u4e66\u5230 etcd \u4e2d"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u5728Master\u8282\u70b9\u6267\u884c\u4e0a\u4f20\u8bc1\u4e66\u6307\u4ee4\nsudo kubeadm init phase upload-certs --upload-certs\n\n# \u8f93\u51fa\u5185\u5bb9\u5982\u4e0b\n[diginn@k8s-master-01 k8s-install]$ sudo kubeadm init phase upload-certs --upload-certs\nI0401 10:48:50.757795   11069 version.go:256] remote version is much newer: v1.32.3; falling back to: stable-1.30\n[upload-certs] Storing the certificates in Secret "kubeadm-certs" in the "kube-system" Namespace\n[upload-certs] Using certificate key:\n861a7ce66363657e5de05431f426e1bcf29eac99301dbd4b57cecdfbc4a02bbb\n\n'})}),"\n",(0,l.jsx)(n.h4,{id:"833-\u52a0\u5165\u65b0\u7684master\u8282\u70b9",children:"8.3.3 \u52a0\u5165\u65b0\u7684Master\u8282\u70b9"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u6307\u5b9a\u8fd0\u884c\u65f6\uff08\u6dfb\u52a0 --cri-socket \u53c2\u6570\uff09\nsudo kubeadm join 192.168.137.140:16443 --token hug90i.rk23nqjt4tm0jnwq \\\n        --discovery-token-ca-cert-hash sha256:92617f50af1f76b87c539ce97614eadaef174e5d4c27e0d858ad1713d0e15fca \\\n        --control-plane --certificate-key 861a7ce66363657e5de05431f426e1bcf29eac99301dbd4b57cecdfbc4a02bbb \\\n        --cri-socket=unix:///var/run/cri-dockerd.sock\n\n# \u914d\u7f6e\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"\u6ce8\u610f"})," \u8981\u52a0\u4e0a",(0,l.jsx)(n.code,{children:"-control-plane"})," ",(0,l.jsx)(n.code,{children:"--certificate-key"})," \uff0c\u4e0d\u7136\u5c31\u4f1a\u6dfb\u52a0\u4e3anode\u8282\u70b9\u800c\u4e0d\u662fmaster"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(30219).A+"",width:"1567",height:"917"}),"\n",(0,l.jsx)(n.img,{src:s(39714).A+"",width:"1567",height:"917"})]}),"\n",(0,l.jsx)(n.h3,{id:"84-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",children:"8.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165"}),"\n",(0,l.jsxs)(n.p,{children:["\u7531\u4e8e\u6b64\u65f6\u8fd8\u6ca1\u6709\u914d\u7f6e\u7f51\u7edc\u63d2\u4ef6\uff0c\u8282\u70b9\u7684\u72b6\u6001\u5747\u4e3a",(0,l.jsx)(n.code,{children:"NotReady"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(1437).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h2,{id:"\u4e5d\u6240\u6709node\u8282\u70b9node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4",children:"\u4e5d\u3001\u3010\u6240\u6709Node\u8282\u70b9\u3011Node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4"}),"\n",(0,l.jsx)(n.h3,{id:"91-node\u8282\u70b9\u521d\u59cb\u5316",children:"9.1 Node\u8282\u70b9\u521d\u59cb\u5316"}),"\n",(0,l.jsx)(n.p,{children:"\u6309\u987a\u5e8f\u6267\u884c\u4e0a\u9762 \u3010\u4e09\u3001\u56db\u3001\u4e94\u3011 \u7684\u6240\u6709\u914d\u7f6e\u53ca\u5b89\u88c5\u547d\u4ee4\uff0c\u6b64\u5904\u4e0d\u518d\u91cd\u590d"}),"\n",(0,l.jsx)(n.h3,{id:"92-\u73af\u5883\u68c0\u67e5",children:"9.2 \u73af\u5883\u68c0\u67e5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770bDocker\u7248\u672c\ndocker version\n\n# \u67e5\u770bK8s\u7248\u672c\nkubeadm version \n\nkubectl version --client\n\nkubelet --version\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(6630).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h3,{id:"93-\u52a0\u5165node\u8282\u70b9",children:"9.3 \u52a0\u5165Node\u8282\u70b9"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5728\u521d\u59cb\u5316Master\u8282\u70b9\u6253\u5370\u52a0\u5165\u8282\u70b9\u6307\u4ee4\nkubeadm token create --print-join-command\n\n# \u8f93\u51fa\u5982\u4e0b\n[diginn@k8s-master-01 k8s-install]$ kubeadm token create --print-join-command\nkubeadm join 192.168.137.140:16443 --token q7tomc.lzxefwohdr7vibs6 --discovery-token-ca-cert-hash sha256:92617f50af1f76b87c539ce97614eadaef174e5d4c27e0d858ad1713d0e15fca\n\n# \u6307\u5b9a\u8fd0\u884c\u65f6\uff08\u6dfb\u52a0 --cri-socket \u53c2\u6570\uff09\nsudo kubeadm join 192.168.137.140:16443 --token q7tomc.lzxefwohdr7vibs6 \\\n    --discovery-token-ca-cert-hash sha256:92617f50af1f76b87c539ce97614eadaef174e5d4c27e0d858ad1713d0e15fca \\\n    --cri-socket=unix:///var/run/cri-dockerd.sock\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(87837).A+"",width:"1567",height:"975"})}),"\n",(0,l.jsx)(n.h3,{id:"94-\u5728\u4e3bmaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165",children:"9.4 \u5728\u4e3bMaster\u8282\u70b9\u67e5\u770b\u65b0\u7684\u8282\u70b9\u662f\u5426\u6210\u529f\u52a0\u5165"}),"\n",(0,l.jsxs)(n.p,{children:["\u7531\u4e8e\u6b64\u65f6\u8fd8\u6ca1\u6709\u914d\u7f6e\u7f51\u7edc\u63d2\u4ef6\uff0c\u8282\u70b9\u7684\u72b6\u6001\u5747\u4e3a",(0,l.jsx)(n.code,{children:"NotReady"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(71156).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5341\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f",children:"\u5341\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u7f51\u7edc\u63d2\u4ef6\u5b89\u88c5\u53ca\u8bc1\u4e66\u5ef6\u671f"}),"\n",(0,l.jsx)(n.h3,{id:"101-\u5f00\u653e\u7aef\u53e3calico",children:"10.1 \u5f00\u653e\u7aef\u53e3(calico)"}),"\n",(0,l.jsx)(n.p,{children:"\u6839\u636e\u5b89\u88c5\u7684\u7f51\u7edc\u63d2\u4ef6\u4e0d\u540c\uff0c\u8fd9\u91cc\u9700\u8981\u5f00\u653e\u7684\u7aef\u53e3\u4e5f\u4e0d\u540c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# BGP \u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=179/tcp\n\n# \u6839\u636e\u5c01\u88c5\u6a21\u5f0f\u9009\u62e9 IP-in-IP \u6216 VXLAN\n# IP-in-IP\nsudo firewall-cmd --permanent --add-rich-rule='rule protocol value=\"4\" accept'\n# \u6216 VXLAN\nsudo firewall-cmd --permanent --add-port=8472/udp\n\n# Typha \u7aef\u53e3\uff08\u82e5\u542f\u7528\uff09\nsudo firewall-cmd --permanent --add-port=5473/tcp\n\n# \u6307\u6807\u7aef\u53e3\uff08\u6309\u9700\uff09\nsudo firewall-cmd --permanent --add-port=9099/tcp\nsudo firewall-cmd --permanent --add-port=9091/tcp\n\n# CoreDNS\u9700\u8981\u7684\u7aef\u53e3\nsudo firewall-cmd --permanent --add-port=53/udp\n\n# \u91cd\u542f\u9632\u706b\u5899\nsudo firewall-cmd --reload\n\n# \u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3\nsudo firewall-cmd --list-port\n\n# \u67e5\u770b\u9632\u706b\u5899\u6240\u6709\u89c4\u5219\nsudo firewall-cmd --list-all\n"})}),"\n",(0,l.jsx)(n.h3,{id:"102-\u5b89\u88c5calico\u7f51\u7edc\u670d\u52a1",children:"10.2 \u5b89\u88c5Calico\u7f51\u7edc\u670d\u52a1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'cd ~/k8s-install\n\n# \u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 CALICO_IPV4POOL_CIDR\nsudo vim ./calico/calico.yaml\n\n# ========== \u4fee\u6539\u7684\u5185\u5bb9\u5982\u4e0b ==========\n# \u5728 CLUSTER_TYPE \u540e\u6dfb\u52a0 IP_AUTODETECTION_METHOD value \u4e3a\u7f51\u5361\u540d\u79f0\n# Cluster type to identify the deployment type\n- name: CLUSTER_TYPE\n  value: "k8s,bgp"\n- name: IP_AUTODETECTION_METHOD\n  value: "interface=enp0s3"\n\n# ...\n\n# \u6b64\u5904value\u548ckubeadm init\u7684 --pod-network-cidr \u4e00\u81f4\n# - name: CALICO_IPV4POOL_CIDR\n#   value: "192.168.0.0/16"\n- name: CALICO_IPV4POOL_CIDR\n  value: "10.244.0.0/16"\n\n'})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(60137).A+"",width:"1567",height:"917"}),"\n",(0,l.jsx)(n.img,{src:s(11954).A+"",width:"1567",height:"917"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u542f\u52a8calico\nkubectl apply -f ./calico/calico.yaml\n\n# \u5982\u679c\u6709\u5f02\u5e38\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u547d\u4ee4\u5220\u9664\u91cd\u65b0\u5b89\u88c5\nkubectl delete -f ./calico/calico.yaml\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(33499).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h3,{id:"103-\u68c0\u67e5\u8282\u70b9\u72b6\u6001",children:"10.3 \u68c0\u67e5\u8282\u70b9\u72b6\u6001"}),"\n",(0,l.jsx)(n.p,{children:"\u7b49\u5f85 calico \u5bb9\u5668\u955c\u50cf\u4e0b\u8f7d\u542f\u52a8\u5b8c\u6210\uff0c\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get nodes\n\nkubectl get pods --all-namespaces\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(78692).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h3,{id:"104-\u68c0\u67e5coredns\u662f\u5426\u6b63\u5e38",children:"10.4 \u68c0\u67e5CoreDNS\u662f\u5426\u6b63\u5e38"}),"\n",(0,l.jsxs)(n.p,{children:["\u5b89\u88c5 Pod \u7f51\u7edc\u540e\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u5728 ",(0,l.jsx)(n.code,{children:"kubectl get pods --all-namespaces"})," \u8f93\u51fa\u4e2d\u68c0\u67e5 CoreDNS Pod \u662f\u5426 Running \u6765\u786e\u8ba4\u5176\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u3002 \u4e00\u65e6 CoreDNS Pod \u542f\u7528\u5e76\u8fd0\u884c\uff0c\u4f60\u5c31\u53ef\u4ee5\u7ee7\u7eed\u52a0\u5165\u8282\u70b9\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get pods --all-namespaces | grep coredns\n\n# \u67e5\u770b\u65e5\u5fd7\u53ca\u72b6\u6001\nkubectl logs -n kube-system coredns-cb4864fb5-4mj8d\n\nkubectl describe pod -n kube-system coredns-cb4864fb5-4mj8d\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"105-\u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb",children:"10.5 \u63a7\u5236\u5e73\u9762\u8282\u70b9\u9694\u79bb"}),"\n",(0,l.jsx)(n.p,{children:"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u51fa\u4e8e\u5b89\u5168\u539f\u56e0\uff0c\u4f60\u7684\u96c6\u7fa4\u4e0d\u4f1a\u5728\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\u3002 \u5982\u679c\u4f60\u5e0c\u671b\u80fd\u591f\u5728\u5355\u673a Kubernetes \u96c6\u7fa4\u7b49\u63a7\u5236\u5e73\u9762\u8282\u70b9\u4e0a\u8c03\u5ea6 Pod\uff0c\u8bf7\u8fd0\u884c\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u5141\u8bb8pod\u8fd0\u884c\u5728\u63a7\u5236\u5e73\u9762\u8282\u70b9\nkubectl taint nodes --all node-role.kubernetes.io/control-plane-\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"106-\u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\u65b9\u4fbf\u7ba1\u7406",children:"10.6 \u5ef6\u957f\u8bc1\u4e66\u4f7f\u7528\u65f6\u95f4\uff0c\u65b9\u4fbf\u7ba1\u7406"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u67e5\u770b\u5f53\u524d\u6709\u6548\u671f"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u67e5\u770b\u6709\u6548\u671f\nopenssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not\n\n# \u67e5\u770b\u5404\u9879\u670d\u52a1\u8bc1\u4e66\u7684\u6709\u6548\u671f\nsudo kubeadm certs check-expiration\n\n"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(32775).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsxs)(n.li,{children:["\u5ef6\u957f\u8bc1\u4e66\u6709\u6548\u671f",(0,l.jsx)(n.a,{href:"https://github.com/yuyicai/update-kube-cert",children:"\u66f4\u65b0K8s\u8bc1\u4e66\u6709\u6548\u671f\u811a\u672c"})]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u6267\u884c\u811a\u672c\nsudo ./update-kubeadm-cert.sh all\n\n# \u67e5\u770b\u6709\u6548\u671f\nopenssl x509 -in /etc/kubernetes/pki/apiserver.crt -noout -text | grep Not\n\n# \u67e5\u770b\u5404\u9879\u670d\u52a1\u8bc1\u4e66\u7684\u6709\u6548\u671f\nsudo kubeadm certs check-expiration\n\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(30124).A+"",width:"1567",height:"917"}),"\n",(0,l.jsx)(n.img,{src:s(66037).A+"",width:"1567",height:"917"})]}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0c\u670d\u52a1\u53caCA\u8bc1\u4e66\u90fd\u5ef6\u957f\u5230\u4e8610\u5e74"}),"\n",(0,l.jsx)(n.h2,{id:"\u5341\u4e00\u7b2c\u4e00\u4e2amaster\u8282\u70b9\u5b89\u88c5dashboard",children:"\u5341\u4e00\u3001\u3010\u7b2c\u4e00\u4e2aMaster\u8282\u70b9\u3011\u5b89\u88c5Dashboard"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/baoshu/p/13296659.html",children:"kubernetes\u7cfb\u5217(\u5341\u516d) - Helm\u5b89\u88c5\u548c\u5165\u95e8"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/baoshu/p/13326480.html",children:"kubernetes\u7cfb\u5217(\u5341\u4e03) - \u901a\u8fc7helm\u5b89\u88c5dashboard\u8be6\u7ec6\u6559\u7a0b"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Kubernetes\u4eea\u8868\u677f\u662fKubernetes\u96c6\u7fa4\u7684\u901a\u7528\u3001\u57fa\u4e8eWeb\u7684UI\u3002\u5b83\u5141\u8bb8\u7528\u6237\u7ba1\u7406\u96c6\u7fa4\u4e2d\u8fd0\u884c\u7684\u5e94\u7528\u7a0b\u5e8f\u5e76\u5bf9\u5176\u8fdb\u884c\u6545\u969c\u6392\u9664\uff0c\u4ee5\u53ca\u7ba1\u7406\u96c6\u7fa4\u672c\u8eab\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u4ece7.x\u7248\u5f00\u59cb\uff0c\u4e0d\u518d\u652f\u6301\u57fa\u4e8eManifest\u7684\u5b89\u88c5\u3002\u73b0\u5728\u53ea\u652f\u6301\u57fa\u4e8eHelm\u7684\u5b89\u88c5\u3002\u7531\u4e8e\u591a\u5bb9\u5668\u8bbe\u7f6e\u548c\u5bf9Kong\u7f51\u5173API\u4ee3\u7406\u7684\u4e25\u91cd\u4f9d\u8d56 \u8981\u8f7b\u677e\u652f\u6301\u57fa\u4e8e\u6e05\u5355\u5b89\u88c5\u662f\u4e0d\u53ef\u884c\u7684\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"111-helm\u5b89\u88c5",children:"11.1 Helm\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'cd ~/k8s-install\n\n# \u89e3\u538b\ntar -zxvf ./helm/helm-v3.17.2-linux-amd64.tar.gz\n\n# \u79fb\u52a8\u5230bin\u76ee\u5f55\nsudo mv ./linux-amd64/helm  /usr/bin/\n\n# \u67e5\u770b\u7248\u672c\nhelm version\n\n# \u914d\u7f6e\u81ea\u52a8\u8865\u5168\necho "source <(helm completion bash)" >> ~/.bashrc\n\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(6729).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h3,{id:"112-\u4fee\u6539dashboard\u914d\u7f6e\u5e76\u5b89\u88c5",children:"11.2 \u4fee\u6539Dashboard\u914d\u7f6e\u5e76\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# 1. \u89e3\u538b\ntar -zxvf ./dashboard/kubernetes-dashboard-7.7.0.tgz\ncd kubernetes-dashboard\n\n# 2. \u5907\u4efd\u539f\u59cb\u914d\u7f6e\u6587\u4ef6\ncp values.yaml values.yaml.bakup\n\n# 3. \u4fee\u6539\u914d\u7f6e\nvim values.yaml\n\n# \u5982\u679c\u4f7f\u7528Nginx\u4ee3\u7406\uff0c\u53ef\u4ee5\u5728\u6b64\u5904\u914d\u7f6e\u57df\u540d\ningress:\n  enabled: false\n  hosts:\n    # Keep 'localhost' host only if you want to access Dashboard using 'kubectl port-forward ...' on:\n    # https://localhost:8443\n    - dashboard.example.com\n\n\n# 4. \u5b89\u88c5Dashboard  \u6267\u884c\u8def\u5f84\u5728values.yaml\u76ee\u5f55\nhelm install kubernetes-dashboard . --create-namespace --namespace kubernetes-dashboard -f values.yaml\n\n# 5. \u67e5\u770bHelm\u90e8\u7f72\u7684\u8d44\u6e90\nhelm ls --namespace kubernetes-dashboard\n\n# 6. \u67e5\u770bdashboard pod\nkubectl get pods -n kubernetes-dashboard -o wide\n\n# 7. \u67e5\u770b\u670d\u52a1\u7aef\u53e3\u4fe1\u606f\nkubectl get svc -n kubernetes-dashboard\n\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(99284).A+"",width:"1567",height:"917"}),"\n",(0,l.jsx)(n.img,{src:s(21743).A+"",width:"1567",height:"917"})]}),"\n",(0,l.jsx)(n.h3,{id:"113-\u521b\u5efatoken",children:"11.3 \u521b\u5efaToken"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'cat > dashboard-adminuser.yaml << EOF\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n  - kind: ServiceAccount\n    name: admin-user\n    namespace: kubernetes-dashboard\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: admin-user\n  namespace: kubernetes-dashboard\n  annotations:\n    kubernetes.io/service-account.name: "admin-user"\ntype: kubernetes.io/service-account-token\nEOF\n\n# \u521b\u5efa\u8d26\u6237 \u6388\u4e88\u89d2\u8272\u6743\u9650 \u521b\u5efaToken\nkubectl apply -f dashboard-adminuser.yaml\n\n# \u83b7\u53d6token\nkubectl get secret admin-user -n kubernetes-dashboard -o jsonpath={".data.token"} | base64 -d\n\neyJhbGciOiJSUzI1NiIsImtpZCI6IkZvMml4OGhLVFpTTXN6Vm9pTXo2MEpoMjFWblNKUVA1Q0JjOHkwWGRJWkEifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI3NDhhY2M3Ni0wZDZlLTQyZjUtOWY3ZC00ODA4ZTcyYzQ3MDEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.ZORtrGEtEicJyFbvrXgzSbrUizM_VF8FJD-QloxyRWDXzD2v4hoGe5FQ8EskWCBVkPiACldk4SnAwk8L5yZGD5ENLLQxftSkxmm_1Zup7L8R0on8ZEpRlEQZ2kZ8oLtLKcX-WK46B8DciJf-kJzfMp9LJVgCgQDLS-jIDPwUKbz9Do8MkPl4ngAIxsMcJNCQ7qd0YlV93Ja6zCOdhjk9Ir5ZC6RKWW-n_w-6IfjLUAEE6wH_rtbDRlmCLUyvyBlgIuVFNUJjck_3WLToDXBavdd4cHFnOGQaPqrd0EOb-lyJ5zqAnT0Syredam-mVkSSi0f0RqCf8eo1KCee6wi1hw\n\nkubectl describe secret -n kubernetes-dashboard $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk \'{print $1}\')\n\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(52998).A+"",width:"1567",height:"917"})}),"\n",(0,l.jsx)(n.h3,{id:"114-\u8bbf\u95eedashboard",children:"11.4 \u8bbf\u95eeDashboard"}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u9700\u8981\u76f4\u63a5\u4f7f\u7528\u96c6\u7fa4\u7684IP\u7aef\u53e3\u8bbf\u95eeDashboard\uff0c\u6309\u7167\u4e0b\u9762\u914d\u7f6e\u6620\u5c04\u7684\u7aef\u53e3\uff0c\u914d\u7f6e\u5b8c\u6210\u540e\u56de\u91cd\u65b0\u8fd0\u884c\u65b0\u7684\u5bb9\u5668\uff0c\u53ef\u80fd\u9700\u8981\u7b49\u5f85\u51e0\u5206\u949f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u7f16\u8f91\u7f51\u5173\u5bf9\u5916\u7aef\u53e3\nkubectl edit svc kubernetes-dashboard-kong-proxy -n kubernetes-dashboard\n\n# \u4fee\u6539\u4ee5\u4e0b\u5185\u5bb9\nspec:\n  type: NodePort\n  ports:\n  - name: kong-proxy-tls\n    nodePort: 30443\n    port: 443\n    protocol: TCP\n    targetPort: 8443\n\n# \u68c0\u67e5\u7aef\u53e3\nkubectl get svc -n kubernetes-dashboard\n\n# \u67e5\u770bkong-proxy\u6240\u5728\u7684\u8282\u70b9\nkubectl get pods -n kubernetes-dashboard -o wide\n\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.img,{src:s(41625).A+"",width:"1567",height:"917"}),"\n",(0,l.jsx)(n.img,{src:s(25872).A+"",width:"1567",height:"917"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u6d4f\u89c8\u5668\u8bbf\u95ee ",(0,l.jsx)(n.code,{children:"https://192.168.137.131:30443"}),"\uff0c\u8f93\u5165\u524d\u9762\u751f\u6210\u7684Token\u5373\u53ef\u8bbf\u95ee\u9875\u9762"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:s(91275).A+"",width:"1894",height:"982"})}),"\n",(0,l.jsx)(n.h3,{id:"115-\u5220\u9664dashboard",children:"11.5 \u5220\u9664Dashboard"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'# \u7528Helm\u5378\u8f7d Dashboard\n[diginn@k8s-master-01 k8s]$ helm -n kubernetes-dashboard uninstall kubernetes-dashboard\nrelease "kubernetes-dashboard" uninstalled\n[diginn@k8s-master-01 k8s]$\n\n# \u68c0\u67e5pod\u662f\u5426\u5b58\u5728\n[diginn@k8s-master-01 k8s]$ kubectl -n kubernetes-dashboard get pods\nNo resources found in kubernetes-dashboard namespace.\n[diginn@k8s-master-01 k8s]$\n\n# \u68c0\u67e5service\u662f\u5426\u5b58\u5728\n[diginn@k8s-master-01 k8s]$ kubectl -n kubernetes-dashboard get svc\nNo resources found in kubernetes-dashboard namespace.\n[diginn@k8s-master-01 k8s]$\n\n# \u5220\u9664\u547d\u540d\u7a7a\u95f4\n[diginn@k8s-master-01 k8s]$ kubectl delete namespace kubernetes-dashboard\nnamespace "kubernetes-dashboard" deleted\n\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5341\u4e8c\u5e38\u7528\u547d\u4ee4",children:"\u5341\u4e8c\u3001\u5e38\u7528\u547d\u4ee4"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.cnblogs.com/kangao/p/17526694.html",children:"k8s \u64cd\u4f5c\u547d\u4ee4 \u5408\u96c6"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u521d\u59cb\u5316\u5e38\u7528",children:"\u521d\u59cb\u5316\u5e38\u7528"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u91cd\u7f6e\u5f53\u524d\u8282\u70b9 \u5c06 kubeadm init \u53ca  kubeadm join\u751f\u6210\u7684\u5185\u5bb9\u91cd\u7f6e\nsudo kubeadm reset --cri-socket=unix:///var/run/cri-dockerd.sock\n\n# \u83b7\u53d6\u6240\u6709\u8282\u70b9\nkubectl get nodes\n\n# \u83b7\u53d6\u6240\u6709Pod\nkubectl get pods --all-namespaces\n\n# \u521b\u5efa\u8d44\u6e90\u5bf9\u8c61\nkubectl create -f calico.yaml\n\n# \u5220\u9664\u8d44\u6e90\u5bf9\u8c61\nkubectl delete -f calico.yaml\n\nkubectl logs -n kube-system calico-node-hqf25\n"})}),"\n",(0,l.jsx)(n.h3,{id:"121-\u57fa\u7840\u64cd\u4f5c\u547d\u4ee4",children:"12.1 \u57fa\u7840\u64cd\u4f5c\u547d\u4ee4"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get pods -o=json\nkubectl get pods -o=yaml\nkubectl get pods -o=wide\nkubectl get pods -n=<namespace_name>\nkubectl create -f ./\nkubectl logs -l name=\n"})}),"\n",(0,l.jsx)(n.h3,{id:"122-\u8d44\u6e90\u76f8\u5173",children:"12.2 \u8d44\u6e90\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efa\u8d44\u6e90\u5bf9\u8c61\nkubectl create -f <file.yaml>\n\n# \u5220\u9664\u8d44\u6e90\u5bf9\u8c61\nkubectl delete -f <file.yaml>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"123-\u96c6\u7fa4\u76f8\u5173",children:"12.3 \u96c6\u7fa4\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl cluster-info \u2013 Display endpoint information about the master and services in the cluster.\nkubectl version \u2013 Display the Kubernetes version running on the client and server.\nkubectl config view \u2013 Get the configuration of the cluster.\nkubectl config view -o jsonpath='{.users[*].name}' \u2013 Get a list of users.\nkubectl config current-context \u2013 Display the current context.\nkubectl config get-contexts \u2013 Display a list of contexts.\nkubectl config use-context \u2013 Set the default context.\nkubectl api-resources \u2013 List the API resources that are available.\nkubectl api-versions \u2013 List the API versions that are available. kubectl get all --all-namespaces\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"124-daemonsets-\u76f8\u5173",children:"12.4 Daemonsets \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get daemonset \u2013 List one or more daemonsets.\nkubectl edit daemonset <daemonset_name> \u2013 Edit and update the definition of one or more daemonset.\nkubectl delete daemonset <daemonset_name> \u2013 Delete a daemonset.\nkubectl create daemonset <daemonset_name> \u2013 Create a new daemonset.\nkubectl rollout daemonset \u2013 Manage the rollout of a daemonset.\nkubectl describe ds <daemonset_name> -n <namespace_name> \u2013 Display the detailed state of daemonsets within a namespace.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"125-deployments\u76f8\u5173",children:"12.5 Deployments\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get deployment \u2013 List one or more deployments.\nkubectl describe deployment <deployment_name> \u2013 Display the detailed state of one or more deployments.\nkubectl edit deployment <deployment_name> \u2013 Edit and update the definition of one or more deployments on the server.\nkubectl create deployment <deployment_name> \u2013 Create a new deployment.\nkubectl delete deployment <deployment_name> \u2013 Delete deployments.\nkubectl rollout status deployment <deployment_name> \u2013 See the rollout status of a deployment.\nkubectl set image deployment/ =image: \u2013 Perform a rolling update (K8S default), set the image of the container to a new version for a particular deployment.\nkubectl rollout undo deployment/ \u2013 Rollback a previous deployment.\nkubectl replace --force -f \u2013 Perform a replace deployment \u2014 Force replace, delete and then re-create the resource.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"126-\u4e8b\u4ef6\u76f8\u5173",children:"12.6 \u4e8b\u4ef6\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get events \u2013 List recent events for all resources in the system.\nkubectl get events \u2013field-selector type=Warning \u2013 List Warnings only.\nkubectl get events --sort-by=.metadata.creationTimestamp \u2013 List events sorted by timestamp.\nkubectl get events --field-selector involvedObject.kind!=Pod \u2013 List events but exclude Pod events.\nkubectl get events --field-selector involvedObject.kind=Node, involvedObject.name=<node_name> \u2013 Pull events for a single node with a specific name.\nkubectl get events --field-selector type!=Normal \u2013 Filter out normal events from a list of events.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"127-\u65e5\u5fd7\u76f8\u5173",children:"12.7 \u65e5\u5fd7\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl logs <pod_name> \u2013 Print the logs for a pod.\nkubectl logs --since=6h <pod_name> \u2013 Print the logs for the last 6 hours for a pod.\nkubectl logs --tail=50 <pod_name> \u2013 Get the most recent 50 lines of logs.\nkubectl logs -f <service_name> [-c <$container>] \u2013 Get logs from a service and optionally select which container.\nkubectl logs -f <pod_name> \u2013 Print the logs for a pod and follow new logs.\nkubectl logs -c <container_name> <pod_name> \u2013 Print the logs for a container in a pod.\nkubectl logs <pod_name> pod.log \u2013 Output the logs for a pod into a file named \u2018pod.log'.\nkubectl logs --previous <pod_name> \u2013 View the logs for a previously failed pod.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"128-namespace-\u76f8\u5173",children:"12.8 Namespace \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl create namespace <namespace_name> \u2013 Create a namespace.\nkubectl get namespace <namespace_name> \u2013 List one or more namespaces.\nkubectl describe namespace <namespace_name> \u2013 Display the detailed state of one or more namespaces.\nkubectl delete namespace <namespace_name> \u2013 Delete a namespace.\nkubectl edit namespace <namespace_name> \u2013 Edit and update the definition of a namespace.\nkubectl top namespace <namespace_name> \u2013 Display Resource (CPU/Memory/Storage) usage for a namespace.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"129-nodes-\u76f8\u5173",children:"12.9 Nodes \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl taint node <node_name> \u2013 Update the taints on one or more nodes.\nkubectl get node \u2013 List one or more nodes.\nkubectl delete node <node_name> \u2013 Delete a node or multiple nodes.\nkubectl top node <node_name> \u2013 Display Resource usage (CPU/Memory/Storage) for nodes.\nkubectl get pods -o wide | grep <node_name> \u2013 Pods running on a node.\nkubectl annotate node <node_name> \u2013 Annotate a node.\nkubectl cordon node <node_name> \u2013 Mark a node as unschedulable.\nkubectl uncordon node <node_name> \u2013 Mark node as schedulable.\nkubectl drain node <node_name> \u2013 Drain a node in preparation for maintenance.\nkubectl label node \u2013 Add or update the labels of one or more nodes.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1210-pods-\u64cd\u4f5c\u76f8\u5173",children:"12.10 Pods \u64cd\u4f5c\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get pod \u2013 List one or more pods.\nkubectl get pods --sort-by='.status.containerStatuses[0].restartCount' \u2013 List pods Sorted by Restart Count.\nkubectl get pods --field-selector=status.phase=Running \u2013 Get all running pods in the namespace.\nkubectl delete pod <pod_name> \u2013 Delete a pod.\nkubectl describe pod <pod_name> \u2013 Display the detailed state of a pods.\nkubectl create pod <pod_name> \u2013 Create a pod.\nkubectl exec <pod_name> -c <container_name> \u2013 Execute a command against a container in a pod. Read more: Using Kubectl Exec: Connect to Your Kubernetes Containers\nkubectl exec -it <pod_name> /bin/sh \u2013 Get an interactive shell on a single-container pod.\nkubectl top pod \u2013 Display Resource usage (CPU/Memory/Storage) for pods.\nkubectl annotate pod <pod_name> \u2013 Add or update the annotations of a pod.\nkubectl label pods <pod_name> new-label= \u2013 Add or update the label of a pod.\nkubectl get pods --show-labels \u2013 Get pods and show labels.\nkubectl port-forward : \u2013 Listen on a port on the local machine and forward to a port on a specified pod.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1211-replication-controller-\u76f8\u5173",children:"12.11 Replication Controller \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get rc \u2013 List the replication controllers.\nkubectl get rc --namespace=\u201d<namespace_name>\u201d \u2013 List the replication controllers by namespace.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1212-replicasets-\u76f8\u5173",children:"12.12 ReplicaSets \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get replicasets \u2013 List ReplicaSets.\nkubectl describe replicasets <replicaset_name> \u2013 Display the detailed state of one or more ReplicaSets.\nkubectl scale --replicas=[x] \u2013 Scale a ReplicaSet.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1213-sercrets-\u76f8\u5173",children:"12.13 Sercrets \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl create secret \u2013 Create a secret.\nkubectl get secrets \u2013 List secrets.\nkubectl describe secrets \u2013 List details about secrets.\nkubectl delete secret <secret_name> \u2013 Delete a secret.\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1214-services-\u76f8\u5173",children:"12.14 Services \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get services \u2013 List one or more services.\nkubectl describe services \u2013 Display the detailed state of a service.\nkubectl expose deployment [deployment_name] \u2013 Expose a replication controller, service, deployment, or pod as a new Kubernetes service.\nkubectl edit services \u2013 Edit and update the definition of one or more services\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1215-service-account\u76f8\u5173",children:"12.15 Service Account\u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get serviceaccounts \u2013 List service accounts.\nkubectl describe serviceaccounts \u2013 Display the detailed state of one or more service accounts.\nkubectl replace serviceaccount \u2013 Replace a service account.\nkubectl delete serviceaccount <service_account_name> \u2013 Delete a service account\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1216-statefulsets-\u76f8\u5173",children:"12.16 StatefulSets \u76f8\u5173"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl get statefulset \u2013 List StatefulSet\nkubectl delete statefulset/[stateful_set_name] --cascade=false \u2013 Delete StatefulSet only (not pods).\n\n"})}),"\n",(0,l.jsx)(n.h3,{id:"1217-\u5e38\u7528\u53c2\u6570",children:"12.17 \u5e38\u7528\u53c2\u6570"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u53c2\u6570"}),(0,l.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"-n <namespace>"})}),(0,l.jsxs)(n.td,{children:["\u6307\u5b9a\u547d\u540d\u7a7a\u95f4\uff08\u5982 ",(0,l.jsx)(n.code,{children:"kubectl get pods -n kube-system"}),"\uff09"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"--all-namespaces"})}),(0,l.jsx)(n.td,{children:"\u8de8\u6240\u6709\u547d\u540d\u7a7a\u95f4\u64cd\u4f5c"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"-o yaml/json/wide"})}),(0,l.jsx)(n.td,{children:"\u6307\u5b9a\u8f93\u51fa\u683c\u5f0f"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"--dry-run=client"})}),(0,l.jsx)(n.td,{children:"\u6a21\u62df\u6267\u884c\uff08\u751f\u6210YAML\u4f46\u4e0d\u521b\u5efa\u8d44\u6e90\uff09"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"1218-\u6ce8\u610f\u4e8b\u9879",children:"12.18 \u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,l.jsx)(n.code,{children:"--force --grace-period=0"})," \u5f3a\u5236\u5220\u9664\u8d44\u6e90\u65f6\u9700\u8c28\u614e\uff08\u53ef\u80fd\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\uff09\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u67e5\u770b\u65e5\u5fd7\u65f6\uff0c\u82e5Pod\u6709\u591a\u4e2a\u5bb9\u5668\uff0c\u9700\u6307\u5b9a\u5bb9\u5668\u540d\uff1a",(0,l.jsx)(n.code,{children:"kubectl logs <pod-name> -c <container-name>"}),"\u3002"]}),"\n",(0,l.jsxs)(n.li,{children:["\u590d\u6742\u64cd\u4f5c\u5efa\u8bae\u4f18\u5148\u4f7f\u7528YAML\u6587\u4ef6\uff08",(0,l.jsx)(n.code,{children:"kubectl apply -f"}),"\uff09\u3002"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},6630:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Node\u8282\u70b9\u52a0\u51651-7d1097e46c0abe52cb67549f9048cb8b.png"},6729:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Helm\u5b89\u88c51-13051358469186d6129ea07ccec8b46e.png"},6830:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Docker\u955c\u50cf\u5bfc\u51651-b8c0aab9175a6c0954486f88b4be585a.png"},7911:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/CRI-Docker1-b6cf14f42b30573ce1fed7886c98bdee.png"},9253:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Docker\u955c\u50cf\u5bfc\u51652-4667e47e3decbb211f62e98057fca70d.png"},11954:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Calico2-1ac664b44701aee18b297cf7ecf2544f.png"},16400:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51651-97672f7682f709fc6ef697cad1665a55.png"},21743:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Dashboard2-7d0479a4165a34350080944fe297fd8b.png"},25872:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Dashboard5-709e759dfce0f890b8959269fca25fc1.png"},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var d=s(96540);const l={},r=d.createContext(l);function c(e){const n=d.useContext(r);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),d.createElement(r.Provider,{value:n},e.children)}},29283:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/VIP1-db9caaaadb946ba2129c03227dfdc6c1.png"},30124:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u8bc1\u4e66\u6709\u6548\u671f2-822a81d75dee51a10dfa0d238b787b02.png"},30154:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u96c6\u7fa4\u521d\u59cb\u53163-752773e13d5fd372b9d588052b4b05fd.png"},30219:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51652-bf83de05f889302dde868608dab58174.png"},32775:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u8bc1\u4e66\u6709\u6548\u671f1-d88b2eb5435558feac004a50e3b0a864.png"},33499:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Calico3-42bf59cae9069b8eb17d17f80daf334b.png"},39714:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Master\u8282\u70b9\u52a0\u51653-7b0ffd50777761aa41842792ee0fc866.png"},41625:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Dashboard4-7565e5078bef0ab64b5291d468efa622.png"},52998:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Dashboard3-ed750b2df3856cc551a611aa614ea7fc.png"},60137:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Calico1-86d9168e8aacaf76de028c8bee5a4bf2.png"},62067:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u96c6\u7fa4\u521d\u59cb\u53162-7466bb6058d2dec6f63b60665f92e360.png"},66037:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u8bc1\u4e66\u6709\u6548\u671f3-a6fa929edb5c994567a594de9aa36daf.png"},66456:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u96c6\u7fa4\u521d\u59cb\u53161-4e729410694feb9d8acfcf5a5c825033.png"},71156:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Node\u8282\u70b9\u52a0\u51653-c728a7aca3534f628993348a4624f0db.png"},78692:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Calico4-9bafae2674df0468d3dcf6d5812ad783.png"},83584:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/DockerInfo1-00a599573e33dfb0b7664f823f83cacf.png"},87837:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Node\u8282\u70b9\u52a0\u51652-d9efc62d02397e1632bed51c4c1192fe.png"},91275:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Dashboard6-eb2d84299db837d65125d52e35e3a9e8.png"},93970:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/\u9632\u706b\u5899\u8bbe\u7f6e1-eb9ed8558dbcf87278b5a678a21aed21.png"},99284:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/Dashboard1-5bb15935c5be3136bc863212087b36ee.png"}}]);