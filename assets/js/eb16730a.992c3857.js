"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[298],{3905:(e,n,r)=>{r.d(n,{Zo:()=>u,kt:()=>k});var a=r(67294);function o(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function t(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(n){o(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,a,o=function(e,n){if(null==e)return{};var r,a,o={},t=Object.keys(e);for(a=0;a<t.length;a++)r=t[a],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);for(a=0;a<t.length;a++)r=t[a],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var i=a.createContext({}),c=function(e){var n=a.useContext(i),r=n;return e&&(r="function"==typeof e?e(n):l(l({},n),e)),r},u=function(e){var n=c(e.components);return a.createElement(i.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var r=e.components,o=e.mdxType,t=e.originalType,i=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(r),m=o,k=p["".concat(i,".").concat(m)]||p[m]||d[m]||t;return r?a.createElement(k,l(l({ref:n},u),{},{components:r})):a.createElement(k,l({ref:n},u))}));function k(e,n){var r=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var t=r.length,l=new Array(t);l[0]=m;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[p]="string"==typeof e?e:o,l[1]=s;for(var c=2;c<t;c++)l[c]=r[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},32981:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>d,frontMatter:()=>t,metadata:()=>s,toc:()=>c});var a=r(87462),o=(r(67294),r(3905));const t={},l=void 0,s={unversionedId:"zh-cn/devenv/Docker-Sonarqube",id:"zh-cn/devenv/Docker-Sonarqube",title:"Docker-Sonarqube",description:"- SonarQube Offical",source:"@site/docs/zh-cn/devenv/25-Docker-Sonarqube.md",sourceDirName:"zh-cn/devenv",slug:"/zh-cn/devenv/Docker-Sonarqube",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Sonarqube",draft:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/devenv/25-Docker-Sonarqube.md",tags:[],version:"current",sidebarPosition:25,frontMatter:{},sidebar:"troch",previous:{title:"Docker-Nodered",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Nodered"},next:{title:"Docker-Gitea",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Gitea"}},i={},c=[{value:"1. Docker\u5b89\u88c5",id:"1-docker\u5b89\u88c5",level:2},{value:"2. \u9879\u76ee\u626b\u63cf",id:"2-\u9879\u76ee\u626b\u63cf",level:2},{value:"1. IDEA Plugin SonarAnalyzer",id:"1-idea-plugin-sonaranalyzer",level:3},{value:"2. IDEA Pluin SonarLint",id:"2-idea-pluin-sonarlint",level:3},{value:"3. Sonar-Scanner-Cli",id:"3-sonar-scanner-cli",level:3},{value:"4. SonarScanner-For-Maven",id:"4-sonarscanner-for-maven",level:3},{value:"3. \u542f\u52a8\u62a5\u9519",id:"3-\u542f\u52a8\u62a5\u9519",level:2}],u={toc:c},p="wrapper";function d(e){let{components:n,...r}=e;return(0,o.kt)(p,(0,a.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.sonarsource.com/products/sonarqube/"},"SonarQube Offical")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://hub.docker.com/_/sonarqube"},"SonarQube Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://hub.docker.com/r/sonarsource/sonar-scanner-cli"},"Sonar-Scanner-Cli")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sonarsource.com/sonarqube/latest/requirements/prerequisites-and-overview/"},"SonarQube Offical Document")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sonarsource.com/sonarqube/latest/analyzing-source-code/scanners/sonarscanner/"},"Sonar-Scanner-Cli Offical Document"))),(0,o.kt)("h2",{id:"1-docker\u5b89\u88c5"},"1. Docker\u5b89\u88c5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# \u521b\u5efa\u6587\u4ef6\u76ee\u5f55\nmkdir -p //d/docker/sonarqube/data\nmkdir -p //d/docker/sonarqube/conf\nmkdir -p //d/docker/sonarqube/log\nmkdir -p //d/docker/sonarqube/extensions/downloads\nmkdir -p //d/docker/sonarqube/extensions/plugins\n\n# \u521b\u5efa\u6570\u636e\u5377\ndocker vaolume create --name sonarqube_data\ndocker vaolume create --name sonarqube_conf\ndocker vaolume create --name sonarqube_log\ndocker vaolume create --name sonarqube_extensions\n\n# \u83b7\u53d6\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\ndocker run -d --name sonarqube_temp sonarqube:10.2-community \\\n&& docker cp sonarqube_temp:/opt/sonarqube/conf/sonar.properties D:/docker/sonarqube/conf/sonar.properties.default \\\n&& docker stop sonarqube_temp && docker rm sonarqube_temp\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --publish 9000:9000 \\\n  --publish 9001:9001 \\\n  --publish 9092:9092 \\\n  --volume //d/docker/sonarqube/data:/opt/sonarqube/data \\\n  --volume //d/docker/sonarqube/conf:/opt/sonarqube/conf \\\n  --volume //d/docker/sonarqube/log:/opt/sonarqube/logs \\\n  --volume //d/docker/sonarqube/extensions:/opt/sonarqube/extensions \\\n  --env SONAR_JDBC_URL=jdbc:postgresql://postgres:5432/sonarqube?currentSchema=public \\\n  --env SONAR_JDBC_USERNAME=postgres \\\n  --env SONAR_JDBC_PASSWORD=postgres \\\n  --net dev \\\n  --restart=on-failure:3 \\\n  --name sonarqube \\\n  sonarqube:9.9-community\n\ndocker exec -it -u root sonarqube /bin/bash\n\nvim /opt/sonarqube/conf/sonar.properties\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://localhost:9000"},"Dashboard"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"admin/admin (\u9ed8\u8ba4)"),(0,o.kt)("li",{parentName:"ul"},"admin/sonarqube")))),(0,o.kt)("h2",{id:"2-\u9879\u76ee\u626b\u63cf"},"2. \u9879\u76ee\u626b\u63cf"),(0,o.kt)("h3",{id:"1-idea-plugin-sonaranalyzer"},"1. IDEA Plugin SonarAnalyzer"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"SonarQube\u521b\u5efa\u9879\u76ee\uff0c\u5e76\u751f\u6210Token ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:9000/account/security")),(0,o.kt)("li",{parentName:"ol"},"\u5b89\u88c5SonarAnalyzer\u63d2\u4ef6"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Settings")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Tools")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"SonarAnalyzer")," \u914d\u7f6eSonarqube server\u5730\u5740\u4ee5\u53caToken"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Settings")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Tools")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"SonarAnalyzer")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Project Settings"),"\u6dfb\u52a0Sonarqube\u4e0a\u521b\u5efa\u7684\u9879\u76ee\u540d\u79f0 ",(0,o.kt)("inlineCode",{parentName:"li"},"sonar.projectKey")," "),(0,o.kt)("li",{parentName:"ol"},"\u9009\u62e9\u63d2\u4ef6",(0,o.kt)("inlineCode",{parentName:"li"},"SonarAnalyzer")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"\u5206\u6790Project\u4e0b\u7684\u6587\u4ef6")),(0,o.kt)("li",{parentName:"ol"},"\u672c\u5730\u5206\u6790\u5b8c\u6bd5\u540e\uff0c\u53ef\u4ee5\u5728\u6b64\u9875\u9762\u770b\u5230\u670d\u52a1\u7aef\u7684\u5206\u6790\u4efb\u52a1 ",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:9000/dashboard?id=project_name")," "),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:9000/project/background_tasks?id=project_name"))))),(0,o.kt)("h3",{id:"2-idea-pluin-sonarlint"},"2. IDEA Pluin SonarLint"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"SonarQube\u521b\u5efa\u9879\u76ee\uff0c\u5e76\u751f\u6210Token ",(0,o.kt)("inlineCode",{parentName:"li"},"http://localhost:9000/account/security")),(0,o.kt)("li",{parentName:"ol"},"\u5b89\u88c5SonarLint\u63d2\u4ef6"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Settings")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Tools")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"SonarLint")," \u914d\u7f6eSonarqube server\u5730\u5740\u4ee5\u53caToken"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Settings")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Tools")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"SonarLint")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Project Settings"),"\u9009\u62e9server\u53caSonarqube\u4e0a\u521b\u5efa\u7684projectKey"),(0,o.kt)("li",{parentName:"ol"},"\u914d\u7f6e\u5b8c\u6210\u70b9\u51fb",(0,o.kt)("inlineCode",{parentName:"li"},"Update Local Storage"),"\u66f4\u65b0\u670d\u52a1\u5668\u4e0a\u7684\u914d\u7f6e\u4fe1\u606f"),(0,o.kt)("li",{parentName:"ol"},"\u53f3\u952e\u70b9\u51fb\u9879\u76ee\u6839\u76ee\u5f55\uff0c\u9009\u62e9",(0,o.kt)("inlineCode",{parentName:"li"},"SonarLint")," - ",(0,o.kt)("inlineCode",{parentName:"li"},"Analyze With SonarLint"))),(0,o.kt)("h3",{id:"3-sonar-scanner-cli"},"3. Sonar-Scanner-Cli"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"# \u7b80\u5355\u547d\u4ee4\ndocker run -it --rm -v /path/to/your/code:/usr/src sonarsource/sonar-scanner-cli\n\n# \u5b8c\u6574\u547d\u4ee4\ndocker run -it --rm \\\n    --volume /path/to/your/code:/usr/src \\\n    -Dsonar.projectKey=your_project_key \\\n    -Dsonar.sources=. \\\n    -Dsonar.host.url=http://your_sonarqube_server:9000 \\\n    -Dsonar.login=your_sonarqube_token \\\n    --net dev \\\n    --name sonar-scanner \\\n    sonarsource/sonar-scanner-cli:5\n")),(0,o.kt)("p",null,"\u4e5f\u53ef\u4ee5\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u5efa",(0,o.kt)("inlineCode",{parentName:"p"},"sonar-project.properties"),"\u914d\u7f6e\u6587\u4ef6\u6307\u5b9a\u76f8\u5173\u53c2\u6570"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-properties"},"sonar.projectKey=\u9879\u76eekey,\u5728SonarQube\u65b0\u5efa\u9875\u9762\u65f6\u83b7\u53d6 \nsonar.projectName=\u9879\u76ee\u540d\u79f0 \nsonar.projectVersion=\u9879\u76ee\u7248\u672c \nsonar.sources=\u6e90\u7801\u5730\u5740\uff0c\u4f8b\u5982\uff1asrc \nsonar.java.binaries=\u4e8c\u8fdb\u5236\u4ee3a\u7801\u5730\u5740\uff0c\u4f8b\u5982\uff1a./target/classes \nsonar.branch.name=\u4ee3\u7801\u5206\u652f\uff0c\u4f8b\u5982\uff1amaster \nsonar.sourceEncoding=\u6e90\u7801\u7f16\u7801\u683c\u5f0f\uff0cUTF-8 \nsonar.host.url=SonarQubet\u5730\u5740\uff0chtp:/127.0.0.1:9000 \nsonar.login=SonarQube\u767b\u9646\u8d26\u53f7\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528sonar.token\u66ff\u6362\uff0ctoken\u5728SonarQube\u521b\u5efa\u9879\u76ee\u65f6\u83b7\u53d6 \nsonar.password=SonarQube\u767b\u9646\u5bc6\u7801\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528sonar.token\u66ff\u6362\uff0ctoken\u5728SonarQubet\u521b\u5efa\u9879\u76ee\u65f6\u83b7\u53d6 \nsonar.language=\u6307\u5b9a\u626b\u63cf\u7684\u8bed\u8a00\uff0c\u9009\u586b\uff0c\u4f8b\u5982\uff1aJava\n")),(0,o.kt)("h3",{id:"4-sonarscanner-for-maven"},"4. SonarScanner-For-Maven"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.sonarsource.com/sonarqube/9.9/analyzing-source-code/scanners/sonarscanner-for-maven/"},"sonarscanner-for-maven"))),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"maven/conf/settings.xml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"<settings>\n    <pluginGroups>\n        <pluginGroup>org.sonarsource.scanner.maven</pluginGroup>\n    </pluginGroups>\n    <profiles>\n        <profile>\n            <id>sonar</id>\n            <activation>\n                <activeByDefault>true</activeByDefault>\n            </activation>\n            <properties>\n                \x3c!-- Optional URL to server. Default value is http://localhost:9000 --\x3e\n                <sonar.host.url>\n                  http://localhost:9000\n                </sonar.host.url>\n            </properties>\n        </profile>\n     </profiles>\n</settings>\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"pom.xml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"<build>\n  <plugins>\n    <plugin>\n      <groupId>org.sonarsource.scanner.maven</groupId>\n      <artifactId>sonar-maven-plugin</artifactId>\n    </plugin>\n  </plugins>\n  <pluginManagement>\n    <plugins>\n      <plugin>\n        <groupId>org.sonarsource.scanner.maven</groupId>\n        <artifactId>sonar-maven-plugin</artifactId>\n        <version>3.7.0.1746</version>\n      </plugin>\n    </plugins>\n  </pluginManagement>\n</build>\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"http://localhost:9000/dashboard?id=project_name&selectedTutorial=local"},"scripts"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"mvn clean verify sonar:sonar \\\n  -Dsonar.projectKey=project_name \\\n  -Dsonar.host.url=http://localhost:9000 \\\n  -Dsonar.login=sqp_954d00a0bbe6390cc16300191b1fe82f9e899453\n")),(0,o.kt)("h2",{id:"3-\u542f\u52a8\u62a5\u9519"},"3. \u542f\u52a8\u62a5\u9519"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5185\u6838\u53c2\u6570\u8bbe\u7f6e\u8fc7\u4f4e")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"node validation exception\n[1] bootstrap checks failed. You must address the points described in the following [1] lines before starting Elasticsearch.\nbootstrap check failure [1] of [1]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]\nERROR: Elasticsearch did not exit normally - check the logs at /opt/sonarqube/logs/sonarqube.log\n")),(0,o.kt)("p",null,"Linux\u76f4\u63a5\u7f16\u8f91\uff0cWindows\u4e0b\u7f16\u8f91WLS(WLS2)\u914d\u7f6e\u6587\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"sudo vim /etc/sysctl.conf\n\n# \u589e\u52a0\u4ee5\u4e0b\u914d\u7f6e\nvm.max_map_count=262144\nfs.file-max=65535\n\n# \u5e94\u7528\u66f4\u65b0\nsudo sysctl -p\n")))}d.isMDXComponent=!0}}]);