"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[4938],{9941:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>l,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var r=n(85893),s=n(11151);const i={},a=void 0,o={id:"zh-cn/spring-authorization-server/SAS-Wechat-Login",title:"SAS-Wechat-Login",description:"- Spring Authorization Server\u5165\u95e8 (\u5341\u56db) \u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55",source:"@site/docs/zh-cn/spring-authorization-server/14-SAS-Wechat-Login.md",sourceDirName:"zh-cn/spring-authorization-server",slug:"/zh-cn/spring-authorization-server/SAS-Wechat-Login",permalink:"/light-docusaurus/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-authorization-server/14-SAS-Wechat-Login.md",tags:[],version:"current",sidebarPosition:14,frontMatter:{},sidebar:"troch",previous:{title:"SAS-Github-Gitee-Login",permalink:"/light-docusaurus/docs/zh-cn/spring-authorization-server/SAS-Github-Gitee-Login"},next:{title:"SAS-Separate-Consent-And-Device-Authorize-Page",permalink:"/light-docusaurus/docs/zh-cn/spring-authorization-server/SAS-Separate-Consent-And-Device-Authorize-Page"}},c={},d=[{value:"\u4e00\u3001\u524d\u8a00",id:"\u4e00\u524d\u8a00",level:2},{value:"\u4e8c\u3001\u5b9a\u5236\u5206\u6790",id:"\u4e8c\u5b9a\u5236\u5206\u6790",level:2},{value:"1. \u7b2c\u4e00\u6b65\uff1a\u7528\u6237\u540c\u610f\u6388\u6743\u83b7\u53d6code",id:"1-\u7b2c\u4e00\u6b65\u7528\u6237\u540c\u610f\u6388\u6743\u83b7\u53d6code",level:3},{value:"2. \u7b2c\u4e8c\u6b65\uff1a\u901a\u8fc7code\u6362\u53d6\u7f51\u9875\u6388\u6743access_token",id:"2-\u7b2c\u4e8c\u6b65\u901a\u8fc7code\u6362\u53d6\u7f51\u9875\u6388\u6743access_token",level:3},{value:"3. \u7b2c\u4e09\u6b65\uff1a\u62c9\u53d6\u7528\u6237\u4fe1\u606f(\u9700scope\u4e3a snsapi_userinfo)",id:"3-\u7b2c\u4e09\u6b65\u62c9\u53d6\u7528\u6237\u4fe1\u606f\u9700scope\u4e3a-snsapi_userinfo",level:3},{value:"\u4e09\u3001\u7f16\u7801\u90e8\u5206",id:"\u4e09\u7f16\u7801\u90e8\u5206",level:2},{value:"1. \u7f16\u7801\u5185\u5bb9",id:"1-\u7f16\u7801\u5185\u5bb9",level:3},{value:"2. \u5728<code>com.example.authorization.wechat</code>\u5305\u4e2d\u6dfb\u52a0<code>WechatAuthorizationRequestConsumer</code>\u7c7b",id:"2-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatauthorizationrequestconsumer\u7c7b",level:3},{value:"3. \u5728<code>com.example.authorization.wechat</code>\u5305\u4e2d\u6dfb\u52a0<code>WechatCodeGrantRequestEntityConverter</code>\u7c7b",id:"3-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatcodegrantrequestentityconverter\u7c7b",level:3},{value:"4. \u5728<code>com.example.authorization.wechat</code>\u5305\u4e2d\u6dfb\u52a0<code>WechatMapAccessTokenResponseConverter</code>\u7c7b",id:"4-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatmapaccesstokenresponseconverter\u7c7b",level:3},{value:"5. \u5728<code>com.example.authorization.wechat</code>\u5305\u4e2d\u6dfb\u52a0<code>WechatUserRequestEntityConverter</code>\u7c7b",id:"5-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatuserrequestentityconverter\u7c7b",level:3},{value:"6. \u5728<code>com.example.authorization.wechat</code>\u5305\u4e2d\u6dfb\u52a0<code>WechatUserResponseConverter</code>\u7c7b",id:"6-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatuserresponseconverter\u7c7b",level:3},{value:"7. \u5c06\u4e0a\u8fb9\u7684\u7c7b\u6dfb\u52a0\u81f3\u914d\u7f6e\u4e2d\uff0c\u4f7f\u5176\u751f\u6548",id:"7-\u5c06\u4e0a\u8fb9\u7684\u7c7b\u6dfb\u52a0\u81f3\u914d\u7f6e\u4e2d\u4f7f\u5176\u751f\u6548",level:3},{value:"1. <code>AuthorizationConfig</code>\u7c7b\u7684\u914d\u7f6e",id:"1-authorizationconfig\u7c7b\u7684\u914d\u7f6e",level:4},{value:"2. <code>CustomOauth2UserService</code>\u6539\u9020",id:"2-customoauth2userservice\u6539\u9020",level:4},{value:"8. \u7528\u6237\u4fe1\u606f\u5904\u7406\u7b56\u7565\u6dfb\u52a0<code>WechatUserConverter</code>\u7c7b\uff0c\u4f7f\u5176\u89e3\u6790\u5fae\u4fe1\u7528\u6237\u4fe1\u606f",id:"8-\u7528\u6237\u4fe1\u606f\u5904\u7406\u7b56\u7565\u6dfb\u52a0wechatuserconverter\u7c7b\u4f7f\u5176\u89e3\u6790\u5fae\u4fe1\u7528\u6237\u4fe1\u606f",level:3},{value:"9. yml\u4e2d\u6dfb\u52a0\u5fae\u4fe1\u5e94\u7528\u914d\u7f6e\u4fe1\u606f",id:"9-yml\u4e2d\u6dfb\u52a0\u5fae\u4fe1\u5e94\u7528\u914d\u7f6e\u4fe1\u606f",level:3},{value:"10. \u767b\u5f55\u9875\u9762\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55\u5165\u53e3",id:"10-\u767b\u5f55\u9875\u9762\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55\u5165\u53e3",level:3},{value:"11.\u8865\u5145",id:"11\u8865\u5145",level:3},{value:"\u56db\u3001\u5fae\u4fe1\u6d4b\u8bd5\u53f7\u914d\u7f6e\u7b80\u8981\u8bf4\u660e",id:"\u56db\u5fae\u4fe1\u6d4b\u8bd5\u53f7\u914d\u7f6e\u7b80\u8981\u8bf4\u660e",level:2},{value:"\u4e94\u3001\u6d4b\u8bd5",id:"\u4e94\u6d4b\u8bd5",level:2},{value:"1. \u5fae\u4fe1\u5185\u6253\u5f00\u6388\u6743\u7533\u8bf7\u5730\u5740",id:"1-\u5fae\u4fe1\u5185\u6253\u5f00\u6388\u6743\u7533\u8bf7\u5730\u5740",level:3},{value:"2. \u8ba4\u8bc1\u670d\u52a1\u68c0\u6d4b\u5230\u672a\u767b\u5f55\uff0c\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",id:"2-\u8ba4\u8bc1\u670d\u52a1\u68c0\u6d4b\u5230\u672a\u767b\u5f55\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",level:3},{value:"3. \u70b9\u51fb\u5fae\u4fe1\u767b\u5f55\u56fe\u6807\uff0c\u7531\u8ba4\u8bc1\u670d\u52a1\u91cd\u5b9a\u5411\u81f3\u5fae\u4fe1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\uff0c\u5fae\u4fe1\u6d4f\u89c8\u5668\u5f39\u6846\u7533\u8bf7\u6388\u6743",id:"3-\u70b9\u51fb\u5fae\u4fe1\u767b\u5f55\u56fe\u6807\u7531\u8ba4\u8bc1\u670d\u52a1\u91cd\u5b9a\u5411\u81f3\u5fae\u4fe1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\u5fae\u4fe1\u6d4f\u89c8\u5668\u5f39\u6846\u7533\u8bf7\u6388\u6743",level:3},{value:"4. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u5fae\u4fe1\u5f15\u5bfc\u8bf7\u6c42\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\uff0c\u8ba4\u8bc1\u670d\u52a1\u6839\u636ecode\u6362\u53d6access_token\uff0c\u518d\u6839\u636eaccess_token\u548copenid\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",id:"4-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u5fae\u4fe1\u5f15\u5bfc\u8bf7\u6c42\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u8ba4\u8bc1\u670d\u52a1\u6839\u636ecode\u6362\u53d6access_token\u518d\u6839\u636eaccess_token\u548copenid\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",level:3},{value:"5. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u4f1a\u53d1\u73b0\u9875\u9762\u6ca1\u6709\u8df3\u8f6c\uff0c\u8fd9\u662f\u56e0\u4e3a\u8bf7\u6c42\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\u643a\u5e26\u7684redirect_uri\u662f\u4e00\u4e2a\u4e0d\u53ef\u7528\u7684\u670d\u52a1\uff0c\u52a0\u8f7d\u5931\u8d25\u4e86\uff0c\u867d\u7136\u52a0\u8f7d\u5931\u8d25\u4e86\u4f46\u662f\u5f53\u524d\u94fe\u63a5\u5df2\u7ecf\u662f\u56de\u8c03\u5730\u5740\u4e86\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u70b9\u53f3\u4e0a\u89d2\u7684\u4e09\u4e2a\u70b9\uff0c\u9009\u62e9\u590d\u5236\u94fe\u63a5\uff0c\u7136\u540e\u5c31\u80fd\u83b7\u53d6code\u4e86",id:"5-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u4f1a\u53d1\u73b0\u9875\u9762\u6ca1\u6709\u8df3\u8f6c\u8fd9\u662f\u56e0\u4e3a\u8bf7\u6c42\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\u643a\u5e26\u7684redirect_uri\u662f\u4e00\u4e2a\u4e0d\u53ef\u7528\u7684\u670d\u52a1\u52a0\u8f7d\u5931\u8d25\u4e86\u867d\u7136\u52a0\u8f7d\u5931\u8d25\u4e86\u4f46\u662f\u5f53\u524d\u94fe\u63a5\u5df2\u7ecf\u662f\u56de\u8c03\u5730\u5740\u4e86\u8fd9\u65f6\u5019\u53ef\u4ee5\u70b9\u53f3\u4e0a\u89d2\u7684\u4e09\u4e2a\u70b9\u9009\u62e9\u590d\u5236\u94fe\u63a5\u7136\u540e\u5c31\u80fd\u83b7\u53d6code\u4e86",level:3},{value:"6. \u5728postman\u4e2d\u6839\u636ecode\u83b7\u53d6token",id:"6-\u5728postman\u4e2d\u6839\u636ecode\u83b7\u53d6token",level:3},{value:"7. \u6839\u636etoken\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f",id:"7-\u6839\u636etoken\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f",level:3},{value:"8. \u6700\u540e\u9644\u4e0a\u6570\u636e\u5e93\u7528\u6237\u4fe1\u606f\u622a\u56fe",id:"8-\u6700\u540e\u9644\u4e0a\u6570\u636e\u5e93\u7528\u6237\u4fe1\u606f\u622a\u56fe",level:3},{value:"\u516d\u3001\u5199\u5728\u6700\u540e",id:"\u516d\u5199\u5728\u6700\u540e",level:2},{value:"\u4e03\u3001\u9644\u5f55",id:"\u4e03\u9644\u5f55",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",del:"del",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.ah)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://juejin.cn/post/7261098261142208568",children:"Spring Authorization Server\u5165\u95e8 (\u5341\u56db) \u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"\u4e00\u524d\u8a00",children:"\u4e00\u3001\u524d\u8a00"}),"\n",(0,r.jsx)(t.p,{children:"\u5fae\u4fe1\u767b\u5f55\u4f7f\u7528\u9700\u8981\u8fdb\u884c\u8d44\u8d28\u8ba4\u8bc1\uff0c\u867d\u7136\u516c\u4f17\u5e73\u53f0\u63d0\u4f9b\u4e86\u6d4b\u8bd5\u53f7\uff0c\u4f46\u662f\u6d4b\u8bd5\u53f7\u53ea\u80fd\u7528\u5728\u5fae\u4fe1\u6d4f\u89c8\u5668\u6253\u5f00\u7684\u7f51\u9875\u4e2d\u4f7f\u7528\uff0c\u5982\u679c\u5c06\u6d4b\u8bd5\u53f7\u7528\u4e8e\u626b\u7801\u767b\u5f55\uff0c\u5219\u4f1a\u63d0\u793ascope\u53c2\u6570\u9519\u8bef\uff1b\u867d\u7136\u5fae\u4fe1\u767b\u5f55\u7684\u6d41\u7a0b\u4e5f\u662foauth\u7684\u90a3\u4e00\u5957\u6d41\u7a0b\uff0c\u4f46\u662f\u5b83\u8981\u6c42\u7684\u53c2\u6570\u5e76\u4e0d\u7b26\u5408oauth\u7684\u89c4\u8303\uff0c\u6240\u4ee5\u60f3\u8981\u96c6\u6210\u8fdb\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u4e2d\u5219\u9700\u8981\u6839\u636e\u53c2\u6570\u8981\u6c42\u8fdb\u884c\u5b9a\u5236\u3002"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",children:"\u5fae\u4fe1\u516c\u4f17\u5e73\u53f0\u6d4b\u8bd5\u53f7\u7533\u8bf7\u5730\u5740"})}),"\n",(0,r.jsx)(t.p,{children:"\u63a5\u4e0b\u6765\u5c31\u8be5\u5c55\u793a\u672c\u4eba\u7684\u4e09\u677f\u65a7\u4e86\uff0c\u7406\u8bba\u3001\u7f16\u7801\u3001\u6d4b\u8bd5\u3002"}),"\n",(0,r.jsx)(t.p,{children:"\u5982\u679c\u4e0d\u60f3\u770b\u5206\u6790\u53ef\u4ee5\u76f4\u63a5\u62c9\u81f3\u4e2d\u95f4\u7684\u4ee3\u7801\u90e8\u5206"}),"\n",(0,r.jsx)(t.h2,{id:"\u4e8c\u5b9a\u5236\u5206\u6790",children:"\u4e8c\u3001\u5b9a\u5236\u5206\u6790"}),"\n",(0,r.jsxs)(t.p,{children:["\u9996\u5148\uff0c\u6253\u5f00",(0,r.jsx)(t.a,{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",children:"\u7f51\u9875\u6388\u6743"}),"\u7684\u6587\u6863\u770b\u4e00\u4e0b\u5fae\u4fe1\u767b\u5f55\u5e76\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u6d41\u7a0b\uff0c\u54b1\u4eec\u6839\u636e\u6587\u6863\u4e00\u6b65\u6b65\u5206\u6790\u600e\u4e48\u53bb\u6539\u9020\u9879\u76ee\u4ee5\u9002\u914d\u5fae\u4fe1\u767b\u5f55"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(25892).Z+"",width:"466",height:"205"})}),"\n",(0,r.jsx)(t.h3,{id:"1-\u7b2c\u4e00\u6b65\u7528\u6237\u540c\u610f\u6388\u6743\u83b7\u53d6code",children:"1. \u7b2c\u4e00\u6b65\uff1a\u7528\u6237\u540c\u610f\u6388\u6743\u83b7\u53d6code"}),"\n",(0,r.jsx)(t.p,{children:"\u53c2\u6570\u5217\u8868(\u6458\u6284\u81ea\u5fae\u4fe1\u767b\u5f55\u6587\u6863)"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u53c2\u6570"}),(0,r.jsx)(t.th,{children:"\u662f\u5426\u5fc5\u987b"}),(0,r.jsx)(t.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"appid"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u516c\u4f17\u53f7\u7684\u552f\u4e00\u6807\u8bc6"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"redirect_uri"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u6388\u6743\u540e\u91cd\u5b9a\u5411\u7684\u56de\u8c03\u94fe\u63a5\u5730\u5740\uff0c \u8bf7\u4f7f\u7528 urlEncode \u5bf9\u94fe\u63a5\u8fdb\u884c\u5904\u7406"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"response_type"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u8fd4\u56de\u7c7b\u578b\uff0c\u8bf7\u586b\u5199code"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"scope"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u5e94\u7528\u6388\u6743\u4f5c\u7528\u57df\uff0csnsapi_base \uff08\u4e0d\u5f39\u51fa\u6388\u6743\u9875\u9762\uff0c\u76f4\u63a5\u8df3\u8f6c\uff0c\u53ea\u80fd\u83b7\u53d6\u7528\u6237openid\uff09\uff0csnsapi_userinfo \uff08\u5f39\u51fa\u6388\u6743\u9875\u9762\uff0c\u53ef\u901a\u8fc7openid\u62ff\u5230\u6635\u79f0\u3001\u6027\u522b\u3001\u6240\u5728\u5730\u3002\u5e76\u4e14\uff0c \u5373\u4f7f\u5728\u672a\u5173\u6ce8\u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u8981\u7528\u6237\u6388\u6743\uff0c\u4e5f\u80fd\u83b7\u53d6\u5176\u4fe1\u606f \uff09"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"state"}),(0,r.jsx)(t.td,{children:"\u5426"}),(0,r.jsx)(t.td,{children:"\u91cd\u5b9a\u5411\u540e\u4f1a\u5e26\u4e0astate\u53c2\u6570\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u586b\u5199a-zA-Z0-9\u7684\u53c2\u6570\u503c\uff0c\u6700\u591a128\u5b57\u8282"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"#wechat_redirect"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u65e0\u8bba\u76f4\u63a5\u6253\u5f00\u8fd8\u662f\u505a\u9875\u9762302\u91cd\u5b9a\u5411\u65f6\u5019\uff0c\u5fc5\u987b\u5e26\u6b64\u53c2\u6570"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"forcePopup"}),(0,r.jsx)(t.td,{children:"\u5426"}),(0,r.jsx)(t.td,{children:"\u5f3a\u5236\u6b64\u6b21\u6388\u6743\u9700\u8981\u7528\u6237\u5f39\u7a97\u786e\u8ba4\uff1b\u9ed8\u8ba4\u4e3afalse\uff1b\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u82e5\u7528\u6237\u547d\u4e2d\u4e86\u7279\u6b8a\u573a\u666f\u4e0b\u7684\u9759\u9ed8\u6388\u6743\u903b\u8f91\uff0c\u5219\u6b64\u53c2\u6570\u4e0d\u751f\u6548"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0\u53c2\u6570\u4e2d\u6709\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"appid"}),"\u7684\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u7684\u610f\u601d\u662f\u8ddf",(0,r.jsx)(t.code,{children:"client_id"}),"\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u540d\u5b57\u662f\u53eb",(0,r.jsx)(t.code,{children:"appid"}),"\uff0c\u5982\u679c\u76f4\u63a5\u7528OAuth2 Client\u6839\u636e\u8fd9\u4e9b\u53c2\u6570\u767b\u5f55\u7684\u8bdd\u662f\u8d70\u4e0d\u4e0b\u53bb\u7684\uff0c\u56e0\u4e3aOAuth2 Client\u4e0d\u4f1a\u5e26",(0,r.jsx)(t.code,{children:"appid"}),"\u53c2\u6570\uff0c\u53ea\u4f1a\u5e26",(0,r.jsx)(t.code,{children:"client_id"}),"\u53c2\u6570\uff0c\u6240\u4ee5\u8fd9\u65f6\u5019\u5c31\u8981\u5728\u8df3\u8f6c\u81f3\u8bf7\u6c42\u6388\u6743\u9875\u9762\u4e4b\u524d\u4fee\u6539\u6388\u6743\u7533\u8bf7\u7684\u53c2\u6570\u3002"]}),"\n",(0,r.jsxs)(t.p,{children:["\u53bb",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/client/authorization-grants.html#_customizing_the_authorization_request",children:"Security OAuth2 Client\u6587\u6863"}),"\u4e2d\u627e\u4e00\u4e0b\u76f8\u5173\u914d\u7f6e\uff0c\u53d1\u73b0\u6587\u6863\u4e2d\u660e\u786e\u6307\u51fa\u4e86\u81ea\u5b9a\u4e49\u6388\u6743\u8bf7\u6c42\u7684\u914d\u7f6e\uff0c\u5e76\u7ed9\u51fa\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5982\u4e0b\u6240\u793a\uff1a"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(10180).Z+"",width:"1119",height:"931"})}),"\n",(0,r.jsxs)(t.p,{children:["\u6839\u636e\u6587\u6863\u53ef\u77e5\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"AuthorizationRequestResolver"}),"\u6765\u9002\u914d\u5fae\u4fe1\u767b\u5f55\u4e2d\u7684\u83b7\u53d6code"]}),"\n",(0,r.jsx)(t.h3,{id:"2-\u7b2c\u4e8c\u6b65\u901a\u8fc7code\u6362\u53d6\u7f51\u9875\u6388\u6743access_token",children:"2. \u7b2c\u4e8c\u6b65\uff1a\u901a\u8fc7code\u6362\u53d6\u7f51\u9875\u6388\u6743access_token"}),"\n",(0,r.jsx)(t.p,{children:"\u53c2\u6570\u5217\u8868(\u6458\u6284\u81ea\u5fae\u4fe1\u767b\u5f55\u6587\u6863)"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u53c2\u6570"}),(0,r.jsx)(t.th,{children:"\u662f\u5426\u5fc5\u987b"}),(0,r.jsx)(t.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"appid"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u516c\u4f17\u53f7\u7684\u552f\u4e00\u6807\u8bc6"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"secret"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u516c\u4f17\u53f7\u7684appsecret"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"code"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u586b\u5199\u7b2c\u4e00\u6b65\u83b7\u53d6\u7684code\u53c2\u6570"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"grant_type"}),(0,r.jsx)(t.td,{children:"\u662f"}),(0,r.jsx)(t.td,{children:"\u586b\u5199\u4e3aauthorization_code"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["\u8ddf\u4e0a\u4e00\u6b65\u4e00\u6837\uff0c",(0,r.jsx)(t.code,{children:"clientid"}),"\u9700\u8981\u6539\u4e3a",(0,r.jsx)(t.code,{children:"appid"}),"\uff0c",(0,r.jsx)(t.code,{children:"client_secret"}),"\u9700\u8981\u6539\u4e3a",(0,r.jsx)(t.code,{children:"secret"}),"\uff0c\u7ee7\u7eed\u53bb\u6587\u6863\u4e0a\u627e\u4e00\u4e0b\u76f8\u5173\u914d\u7f6e\uff0c\u6587\u6863\u4e2d\u662f\u6709\u76f8\u5173\u81ea\u5b9a\u4e49\u8bf7\u6c42",(0,r.jsx)(t.code,{children:"access_token"}),"\u914d\u7f6e\uff0c\u8be6\u89c1",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/client/authorization-grants.html#_customizing_the_access_token_request",children:"Customizing the Access Token Request"}),"\uff0c\u6839\u636e\u6587\u6863\u7684\u8bf4\u660e\u53ef\u77e5\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"CodeGrantRequestEntityConverter"}),"\u6765\u9002\u914d\u5fae\u4fe1\u767b\u5f55\u6839\u636ecode\u83b7\u53d6",(0,r.jsx)(t.code,{children:"access_token"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(16443).Z+"",width:"1263",height:"246"})}),"\n",(0,r.jsx)(t.p,{children:"\u54cd\u5e94\u53c2\u6570\u5217\u8868"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u53c2\u6570"}),(0,r.jsx)(t.th,{children:"\u63cf\u8ff0"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"access_token"}),(0,r.jsx)(t.td,{children:"\u7f51\u9875\u6388\u6743\u63a5\u53e3\u8c03\u7528\u51ed\u8bc1,\u6ce8\u610f\uff1a\u6b64access_token\u4e0e\u57fa\u7840\u652f\u6301\u7684access_token\u4e0d\u540c"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"expires_inaccess_token"}),(0,r.jsx)(t.td,{children:"\u63a5\u53e3\u8c03\u7528\u51ed\u8bc1\u8d85\u65f6\u65f6\u95f4\uff0c\u5355\u4f4d\uff08\u79d2\uff09"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"refresh_token"}),(0,r.jsx)(t.td,{children:"\u7528\u6237\u5237\u65b0access_token"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"openid"}),(0,r.jsx)(t.td,{children:"\u7528\u6237\u552f\u4e00\u6807\u8bc6"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"scope"}),(0,r.jsx)(t.td,{children:"\u7528\u6237\u6388\u6743\u7684\u4f5c\u7528\u57df\uff0c\u4f7f\u7528\u9017\u53f7\uff08,\uff09\u5206\u9694"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["\u5728\u8fd9\u91cc\u653e\u54cd\u5e94\u53c2\u6570\u5217\u8868\u662f\u56e0\u4e3a\u5b83\u54cd\u5e94\u7684\u6570\u636e\u8ddf\u6846\u67b6\u9700\u8981\u7684\u6570\u636e\u683c\u5f0f\u4e0d\u4e00\u6837\uff0c\u76f8\u8f83\u4e8e\u6807\u51c6\u54cd\u5e94\u591a\u4e86\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"openid"}),"\uff0c\u5c11\u4e86\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"token_type"}),"\uff0c\u6846\u67b6\u4f1a\u81ea\u52a8\u5c06\u591a\u51fa\u6765\u7684\u54cd\u5e94\u6570\u636e\u653e\u5165",(0,r.jsx)(t.code,{children:"additionalParameters"}),"\u5c5e\u6027\u4e2d\uff0c\u4f46\u662f\u5c11\u7684",(0,r.jsx)(t.code,{children:"tokenType"}),"\u5c5e\u6027\u9700\u8981\u7ed9\u4e00\u4e2a\u9ed8\u8ba4\u7684type\uff0c\u6240\u4ee5\u8fd9\u91cc\u8981\u7ed9\u4ee5\u81ea\u5b9a\u4e49\u7684\u8f6c\u6362\u7c7b\uff1b\u540c\u65f6\u4e5f\u56e0\u4e3a\u5728\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u65f6\u9700\u8981\u5e26\u4e0a",(0,r.jsx)(t.code,{children:"openid"}),"\u8fd9\u4e2a\u5c5e\u6027\u503c\u3002"]}),"\n",(0,r.jsx)(t.p,{children:"\u5237\u65b0token\u90e8\u5206\u5982\u679c\u9700\u8981\u7684\u8bdd\u53ef\u4ee5\u53bb\u4e86\u89e3\u4e00\u4e0b"}),"\n",(0,r.jsx)(t.h3,{id:"3-\u7b2c\u4e09\u6b65\u62c9\u53d6\u7528\u6237\u4fe1\u606f\u9700scope\u4e3a-snsapi_userinfo",children:"3. \u7b2c\u4e09\u6b65\uff1a\u62c9\u53d6\u7528\u6237\u4fe1\u606f(\u9700scope\u4e3a snsapi_userinfo)"}),"\n",(0,r.jsx)(t.p,{children:"\u53c2\u6570\u5217\u8868(\u6458\u6284\u81ea\u5fae\u4fe1\u767b\u5f55\u6587\u6863)"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u53c2\u6570"}),(0,r.jsx)(t.th,{children:"\u63cf\u8ff0"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"access_token"}),(0,r.jsx)(t.td,{children:"\u7f51\u9875\u6388\u6743\u63a5\u53e3\u8c03\u7528\u51ed\u8bc1,\u6ce8\u610f\uff1a\u6b64access_token\u4e0e\u57fa\u7840\u652f\u6301\u7684access_token\u4e0d\u540c"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"openid"}),(0,r.jsx)(t.td,{children:"\u7528\u6237\u7684\u552f\u4e00\u6807\u8bc6"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"lang"}),(0,r.jsx)(t.td,{children:"\u8fd4\u56de\u56fd\u5bb6\u5730\u533a\u8bed\u8a00\u7248\u672c\uff0czh_CN \u7b80\u4f53\uff0czh_TW \u7e41\u4f53\uff0cen \u82f1\u8bed"})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["\u6b63\u5982\u4e0a\u4e00\u6b65\u53e5\u5c3e\u8bf4\u7684\uff0c\u8981\u643a\u5e26openid\u53d1\u8d77\u8bf7\u6c42\uff0c\u5e76\u4e14\u8981\u643a\u5e26",(0,r.jsx)(t.code,{children:"access_token"}),"\u53c2\u6570\uff0c\u9ed8\u8ba4",(0,r.jsx)(t.code,{children:"access_token"}),"\u662f\u653e\u5728\u8bf7\u6c42\u5934\u4e2d\u7684\uff0c\u683c\u5f0f\u4e3a\uff1a",(0,r.jsx)(t.code,{children:"Authorization: token_type access_token"}),"\uff0c\u8fd9\u91cc\u4e5f\u8981\u4fee\u6539\u4e00\u4e0b\u643a\u5e26\u65b9\u5f0f\uff0c\u5982\u679c\u770b\u8fc7\u4e0a\u4e00\u7bc7\u6587\u7ae0\u7684\u8bfb\u8005\u5e94\u8be5\u8fd8\u8bb0\u5f97\u6211\u4eec\u662f\u81ea\u5df1\u91cd\u5199",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\uff0c\u6587\u6863\u4e2d\u5173\u4e8e\u8be5\u7c7b\u7684\u63cf\u8ff0\u4e2d\u4e5f\u63d0\u5230\u4e86\u5728\u8bf7\u6c42\u7528\u6237\u4fe1\u606f\u4e4b\u524d\u7684\u914d\u7f6e\uff0c\u9700\u8981\u63d0\u4f9b\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"RequestEntityConverter"}),"\u5e76\u901a\u8fc7",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u7684",(0,r.jsx)(t.code,{children:"setRequestEntityConverter"}),"\u8bbe\u7f6e\u8fdb\u53bb\uff0c\u8be6\u89c1",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/login/advanced.html#oauth2login-advanced-oauth2-user-service",children:"\u6587\u6863"}),"\uff1b\u6240\u4ee5\u8fd9\u91cc\u4e5f\u8981\u63d0\u4f9b\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"RequestEntityConverter"}),"\u5e76\u6dfb\u52a0\u81f3\u81ea\u5b9a\u4e49",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u4e2d\u3002"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(23744).Z+"",width:"1256",height:"816"})}),"\n",(0,r.jsxs)(t.p,{children:["\u4f60\u4ee5\u4e3a\u8fd9\u5c31\u5b8c\u4e86\u5417\uff1f Of course not!!! \u6846\u67b6\u5728\u89e3\u6790\u54cd\u5e94\u4f53\u7684\u65f6\u5019\u4f1a\u6839\u636e",(0,r.jsx)(t.code,{children:"content-type"}),"\u53bb\u89e3\u6790\uff0c\u6846\u67b6\u53ea\u4f1a\u5c06",(0,r.jsx)(t.code,{children:"application/json"}),"\u7684",(0,r.jsx)(t.code,{children:"mediaType"}),"\u89e3\u6790\u4e3a",(0,r.jsx)(t.code,{children:"bean"}),"\uff0c\u4e0d\u7ba1\u662f\u83b7\u53d6",(0,r.jsx)(t.code,{children:"token"}),"\u8fd8\u662f\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u8bf7\u6c42\uff0c\u6846\u67b6\u90fd\u662f\u7528",(0,r.jsx)(t.code,{children:"restTemplate"}),"\u53d1\u8d77\u8bf7\u6c42\uff0c\u5e76\u4e14\u6307\u5b9a\u4e86\u54cd\u5e94\u6570\u636e\u7684java\u7c7b\uff0c\u4ee5\u4e0a\u63d0\u5230\u7684\u6240\u6709\u63a5\u53e3\uff0c\u9664\u4e86\u83b7\u53d6code\u662f\u91cd\u5b9a\u5411\uff0c\u5176\u5b83\u90fd\u6709\u54cd\u5e94\uff0c\u6076\u5fc3\u7684\u662f\u5fae\u4fe1\u54cd\u5e94\u56de\u6765\u7684",(0,r.jsx)(t.code,{children:"content-type"}),"\u662f",(0,r.jsx)(t.code,{children:"text/plain"}),"\uff0c\u6846\u67b6\u4f1a\u56e0\u4e3a\u627e\u4e0d\u5230\u89e3\u6790\u7684\u7c7b\u578b\u4ece\u800c\u629b\u51fa\u5f02\u5e38\uff0c\u6240\u4ee5\u8fd8\u8981\u914d\u7f6e\u4e00\u4e0b\uff0c\u8ba9\u6846\u67b6\u4e5f\u89e3\u6790",(0,r.jsx)(t.code,{children:"text/plain"}),"\u6570\u636e\u3002"]}),"\n",(0,r.jsx)(t.p,{children:"\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u4e2d\u867d\u7136\u672c\u4eba\u81ea\u5b9a\u4e49\u4e86\u5f88\u591a\u5185\u5bb9\uff0c\u4f46\u662f\u5173\u4e8e\u6388\u6743\u7aef\u70b9\u7684\u8bf7\u6c42\u4e0e\u54cd\u5e94\u90fd\u6ca1\u6709\u53bb\u4fee\u6539\uff0c\u7528\u6237\u4fe1\u606f\u63a5\u53e3\u76f4\u63a5\u8fd4\u56de\u4e86\u7528\u6237\u4fe1\u606f\u7c7b\uff0c\u6ca1\u6709\u8fd4\u56de\u4e00\u4e2a\u7edf\u4e00\u54cd\u5e94\u7c7b\u7684\u539f\u56e0\u5c31\u5728\u8fd9\u91cc\uff0c\u5982\u679c\u4fee\u6539\u4e86\u8fd9\u4e9b\u4e1c\u897f\uff0c\u90a3\u4e48\u7b49\u4f60\u5c06\u670d\u52a1\u63d0\u4f9b\u51fa\u53bb\u4ee5\u540e\u5bf9\u63a5\u65b9\u4f1a\u5f02\u5e38\u75db\u82e6\uff0c\u5e76\u4e14\u53ef\u80fd\u8fb9\u5bf9\u63a5\u8fb9\u9a82(\u6ca1\u9519\uff0c\u6b63\u662f\u5728\u4e0b)\uff0c\u76f8\u5bf9\u4e8e\u6807\u51c6oauth2\u534f\u8bae\u5bf9\u63a5\u8d77\u6765\u5b9e\u5728\u662f\u592a\u75db\u82e6\u4e86\u3002\u8981\u7262\u8bb0Spring Boot\u7684\u201c\u7ea6\u5b9a\u5927\u4e8e\u914d\u7f6e\u201d\u3002"}),"\n",(0,r.jsx)(t.h2,{id:"\u4e09\u7f16\u7801\u90e8\u5206",children:"\u4e09\u3001\u7f16\u7801\u90e8\u5206"}),"\n",(0,r.jsxs)(t.p,{children:["\u6839\u636e\u4e0a\u8fb9\u7684\u5206\u6790\u53d1\u73b0\uff0c\u5bf9\u63a5\u5fae\u4fe1\u767b\u5f55\u9700\u8981\u4ece\u5934\u6539\u5230\u5c3e\uff0c\u6388\u6743\u7533\u8bf7\u3001\u7528",(0,r.jsx)(t.code,{children:"code"}),"\u6362\u53d6",(0,r.jsx)(t.code,{children:"token"}),"\u548c\u7528",(0,r.jsx)(t.code,{children:"token"}),"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u90fd\u8981\u4fee\u6539\u3002"]}),"\n",(0,r.jsx)(t.h3,{id:"1-\u7f16\u7801\u5185\u5bb9",children:"1. \u7f16\u7801\u5185\u5bb9"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\u7f16\u5199",(0,r.jsx)(t.code,{children:"WechatAuthorizationRequestConsumer"}),"\u7c7b\uff0c\u6388\u6743\u7533\u8bf7\u63a5\u53e3\u643a\u5e26\u7684\u53c2\u6570\u3002"]}),"\n",(0,r.jsxs)(t.li,{children:["\u7f16\u5199",(0,r.jsx)(t.code,{children:"WechatCodeGrantRequestEntityConverter"}),"\u7c7b\uff0c\u4fee\u6539",(0,r.jsx)(t.code,{children:"code"}),"\u6362\u53d6",(0,r.jsx)(t.code,{children:"access_token"}),"\u65f6\u643a\u5e26\u7684\u53c2\u6570\u3002"]}),"\n",(0,r.jsxs)(t.li,{children:["\u7f16\u5199",(0,r.jsx)(t.code,{children:"WechatMapAccessTokenResponseConverter"}),"\u7c7b\uff0c\u6839\u636e\u54cd\u5e94\u6570\u636e\u751f\u6210",(0,r.jsx)(t.code,{children:"OAuth2AccessTokenResponse"}),"\u7c7b\u7684\u5b9e\u4f8b\u3002"]}),"\n",(0,r.jsxs)(t.li,{children:["\u7f16\u5199",(0,r.jsx)(t.code,{children:"WechatUserRequestEntityConverter"}),"\u7c7b\uff0c\u4fee\u6539\u8bf7\u6c42\u7528\u6237\u4fe1\u606f\u7684\u53c2\u6570\u3002"]}),"\n",(0,r.jsxs)(t.li,{children:["\u7f16\u5199",(0,r.jsx)(t.code,{children:"WechatUserResponseConverter"}),"\u7c7b\uff0c\u8ba9\u6846\u67b6\u53ef\u4ee5\u89e3\u6790",(0,r.jsx)(t.code,{children:"text/plain"}),"\u54cd\u5e94\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(t.li,{children:"\u5c06\u4e0a\u8fb9\u7684\u7c7b\u6dfb\u52a0\u81f3\u914d\u7f6e\u4e2d\uff0c\u4f7f\u5176\u751f\u6548\u3002"}),"\n",(0,r.jsxs)(t.li,{children:["\u7528\u6237\u4fe1\u606f\u5904\u7406\u7b56\u7565\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatUserConverter"}),"\u7c7b\uff0c\u4f7f\u5176\u89e3\u6790\u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(t.li,{children:"yml\u4e2d\u6dfb\u52a0\u5fae\u4fe1\u5e94\u7528\u914d\u7f6e\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(t.li,{children:"\u767b\u5f55\u9875\u9762\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55\u5165\u53e3\u3002"}),"\n"]}),"\n",(0,r.jsxs)(t.h3,{id:"2-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatauthorizationrequestconsumer\u7c7b",children:["2. \u5728",(0,r.jsx)(t.code,{children:"com.example.authorization.wechat"}),"\u5305\u4e2d\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatAuthorizationRequestConsumer"}),"\u7c7b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5224\u65ad\u662f\u5426\u5fae\u4fe1\u767b\u5f55\uff0c\u5982\u679c\u662f\u5fae\u4fe1\u767b\u5f55\u5219\u5c06",(0,r.jsx)(t.code,{children:"appid"}),"\u6dfb\u52a0\u81f3\u8bf7\u6c42\u53c2\u6570\u4e2d"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'/**\n * \u81ea\u5b9a\u4e49\u5fae\u4fe1\u767b\u5f55\u8ba4\u8bc1\u8bf7\u6c42\n *\n * @author vains\n */\npublic class WechatAuthorizationRequestConsumer implements Consumer<OAuth2AuthorizationRequest.Builder> {\n\n    @Override\n    public void accept(OAuth2AuthorizationRequest.Builder builder) {\n        OAuth2AuthorizationRequest authorizationRequest = builder.build();\n        Object registrationId = authorizationRequest.getAttribute(OAuth2ParameterNames.REGISTRATION_ID);\n        if (Objects.equals(registrationId, THIRD_LOGIN_WECHAT)) {\n            // \u5224\u65ad\u662f\u5426\u5fae\u4fe1\u767b\u5f55\uff0c\u5982\u679c\u662f\u5fae\u4fe1\u767b\u5f55\u5219\u5c06appid\u6dfb\u52a0\u81f3\u8bf7\u6c42\u53c2\u6570\u4e2d\n            builder.additionalParameters((params) -> params.put(WECHAT_PARAMETER_FORCE_POPUP, true));\n            builder.additionalParameters((params) -> params.put(WECHAT_PARAMETER_APPID, authorizationRequest.getClientId()));\n\n            // \u5fae\u4fe1\u7684PC\u7aef\u8ba4\u8bc1\u5bf9\u53c2\u6570\u987a\u5e8f\u6709\u5f3a\u6b63\u5219\u6821\u9a8c\uff0c\u4fee\u6539\u53c2\u6570\u987a\u5e8f\n            builder.parameters((params) -> {\n                // \u79fb\u9664oauth2\u53c2\u6570\uff0c\u987a\u5e8f\u4e0d\u5bf9\u4e0d\u80fd\u6b63\u5e38\u83b7\u53d6\u5230\u5fae\u4fe1\u6388\u6743\u7801\n                params.remove(OAuth2ParameterNames.RESPONSE_TYPE);\n                params.remove(OAuth2ParameterNames.CLIENT_ID);\n                params.remove(OAuth2ParameterNames.SCOPE);\n                params.remove(OAuth2ParameterNames.STATE);\n                params.remove(OAuth2ParameterNames.REDIRECT_URI);\n                params.remove(SecurityConstants.WECHAT_PARAMETER_FORCE_POPUP);\n                params.remove(SecurityConstants.WECHAT_PARAMETER_APPID);\n\n                // \u91cd\u65b0\u6dfb\u52a0\u5230\u53c2\u6570\u4e2d\n                params.put(SecurityConstants.WECHAT_PARAMETER_APPID, authorizationRequest.getClientId());\n                params.put(OAuth2ParameterNames.REDIRECT_URI, authorizationRequest.getRedirectUri());\n                params.put(OAuth2ParameterNames.RESPONSE_TYPE, authorizationRequest.getResponseType().getValue());\n                params.put(OAuth2ParameterNames.SCOPE, StringUtils.collectionToDelimitedString(authorizationRequest.getScopes(), " "));\n                params.put(OAuth2ParameterNames.STATE, authorizationRequest.getState());\n                params.put(OAuth2ParameterNames.CLIENT_ID, authorizationRequest.getClientId());\n                params.put(SecurityConstants.WECHAT_PARAMETER_FORCE_POPUP, true);\n            });\n        }\n    }\n\n}\n'})}),"\n",(0,r.jsxs)(t.h3,{id:"3-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatcodegrantrequestentityconverter\u7c7b",children:["3. \u5728",(0,r.jsx)(t.code,{children:"com.example.authorization.wechat"}),"\u5305\u4e2d\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatCodeGrantRequestEntityConverter"}),"\u7c7b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5982\u679c\u662f\u5fae\u4fe1\u767b\u5f55\uff0c\u83b7\u53d6",(0,r.jsx)(t.code,{children:"token"}),"\u65f6\u643a\u5e26",(0,r.jsx)(t.code,{children:"appid"}),"\u53c2\u6570\u4e0e",(0,r.jsx)(t.code,{children:"secret"}),"\u53c2\u6570"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"/**\n * \u5fae\u4fe1\u767b\u5f55\u8bf7\u6c42token\u5165\u53c2\u5904\u7406\u7c7b\n *\n * @author vains\n */\npublic class WechatCodeGrantRequestEntityConverter extends OAuth2AuthorizationCodeGrantRequestEntityConverter {\n\n    @Override\n    protected MultiValueMap<String, String> createParameters(OAuth2AuthorizationCodeGrantRequest authorizationCodeGrantRequest) {\n        // \u5982\u679c\u662f\u5fae\u4fe1\u767b\u5f55\uff0c\u83b7\u53d6token\u65f6\u643a\u5e26appid\u53c2\u6570\u4e0esecret\u53c2\u6570\n        MultiValueMap<String, String> parameters = super.createParameters(authorizationCodeGrantRequest);\n        String registrationId = authorizationCodeGrantRequest.getClientRegistration().getRegistrationId();\n        if (THIRD_LOGIN_WECHAT.equals(registrationId)) {\n            // \u5982\u679c\u5f53\u524d\u662f\u5fae\u4fe1\u767b\u5f55\uff0c\u643a\u5e26appid\u548csecret\n            parameters.add(WECHAT_PARAMETER_APPID, authorizationCodeGrantRequest.getClientRegistration().getClientId());\n            parameters.add(WECHAT_PARAMETER_SECRET, authorizationCodeGrantRequest.getClientRegistration().getClientSecret());\n        }\n        return parameters;\n    }\n\n     @Override\n    public RequestEntity<?> convert(OAuth2AuthorizationCodeGrantRequest authorizationGrantRequest) {\n        RequestEntity<?> requestEntity = super.convert(authorizationGrantRequest);\n        String registrationId = authorizationGrantRequest.getClientRegistration().getRegistrationId();\n        // \u6846\u67b6\u9ed8\u8ba4\u662fPOST\u8bf7\u6c42\uff0c\u53c2\u6570\u5728form-data\u4e2d\uff0c\u5fae\u4fe1\u7684token\u63a5\u53e3\u53c2\u6570\u5728queryParam\u4e2d\n        if (SecurityConstants.THIRD_LOGIN_WECHAT.equals(registrationId)) {\n            URI url = requestEntity.getUrl();\n            LinkedMultiValueMap<String, List<String>> body = (LinkedMultiValueMap<String, List<String>>) requestEntity.getBody();\n\n            URI uri = UriComponentsBuilder\n                    .fromUri(url)\n                    .queryParam(SecurityConstants.WECHAT_PARAMETER_APPID, body.get(SecurityConstants.WECHAT_PARAMETER_APPID))\n                    .queryParam(SecurityConstants.WECHAT_PARAMETER_SECRET, body.get(SecurityConstants.WECHAT_PARAMETER_SECRET))\n                    .queryParam(OAuth2ParameterNames.CODE, body.get(OAuth2ParameterNames.CODE))\n                    .queryParam(OAuth2ParameterNames.GRANT_TYPE, body.get(OAuth2ParameterNames.GRANT_TYPE))\n                    .queryParam(OAuth2ParameterNames.REDIRECT_URI, body.get(OAuth2ParameterNames.REDIRECT_URI))\n                    .build().toUri();\n            return new RequestEntity<>(HttpMethod.GET, uri);\n        }\n        return requestEntity;\n    }\n\n}\n"})}),"\n",(0,r.jsxs)(t.h3,{id:"4-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatmapaccesstokenresponseconverter\u7c7b",children:["4. \u5728",(0,r.jsx)(t.code,{children:"com.example.authorization.wechat"}),"\u5305\u4e2d\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatMapAccessTokenResponseConverter"}),"\u7c7b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u8fd9\u4e2a\u7c7b\u903b\u8f91\u662f\u9ed8\u8ba4\u7684",(0,r.jsx)(t.code,{children:"DefaultMapOAuth2AccessTokenResponseConverter"}),"\u7c7b\u4e2d\u7684\u903b\u8f91\uff0c\u552f\u4e00\u7684\u6539\u52a8\u5c31\u662f\u5728",(0,r.jsx)(t.code,{children:"token type"}),"\u4e3a\u7a7a\u65f6\u7ed9\u4e2a\u9ed8\u8ba4\u503c"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'/**\n * \u5fae\u4fe1\u767b\u5f55\u83b7\u53d6token\u7684\u54cd\u5e94\u5904\u7406\u7c7b\n *\n * @author vains\n */\npublic class WechatMapAccessTokenResponseConverter implements Converter<Map<String, Object>, OAuth2AccessTokenResponse> {\n\n    private static final Set<String> TOKEN_RESPONSE_PARAMETER_NAMES = new HashSet<>(\n            Arrays.asList(OAuth2ParameterNames.ACCESS_TOKEN, OAuth2ParameterNames.EXPIRES_IN,\n                    OAuth2ParameterNames.REFRESH_TOKEN, OAuth2ParameterNames.SCOPE, OAuth2ParameterNames.TOKEN_TYPE));\n\n    @Override\n    public OAuth2AccessTokenResponse convert(Map<String, Object> source) {\n        String accessToken = getParameterValue(source, OAuth2ParameterNames.ACCESS_TOKEN);\n        OAuth2AccessToken.TokenType accessTokenType = getAccessTokenType(source);\n        long expiresIn = getExpiresIn(source);\n        Set<String> scopes = getScopes(source);\n        String refreshToken = getParameterValue(source, OAuth2ParameterNames.REFRESH_TOKEN);\n        Map<String, Object> additionalParameters = new LinkedHashMap<>();\n        for (Map.Entry<String, Object> entry : source.entrySet()) {\n            if (!TOKEN_RESPONSE_PARAMETER_NAMES.contains(entry.getKey())) {\n                additionalParameters.put(entry.getKey(), entry.getValue());\n            }\n        }\n        return OAuth2AccessTokenResponse.withToken(accessToken)\n                // \u5982\u679ctoken type\u4e3a\u7a7a\uff0c\u7ed9\u4e2a\u9ed8\u8ba4\u503c\n                .tokenType(accessTokenType == null ? OAuth2AccessToken.TokenType.BEARER : accessTokenType)\n                .expiresIn(expiresIn)\n                .scopes(scopes)\n                .refreshToken(refreshToken)\n                .additionalParameters(additionalParameters)\n                .build();\n    }\n\n    private static OAuth2AccessToken.TokenType getAccessTokenType(Map<String, Object> tokenResponseParameters) {\n        if (OAuth2AccessToken.TokenType.BEARER.getValue()\n                .equalsIgnoreCase(getParameterValue(tokenResponseParameters, OAuth2ParameterNames.TOKEN_TYPE))) {\n            return OAuth2AccessToken.TokenType.BEARER;\n        }\n        return null;\n    }\n\n    private static long getExpiresIn(Map<String, Object> tokenResponseParameters) {\n        return getParameterValue(tokenResponseParameters, OAuth2ParameterNames.EXPIRES_IN, 0L);\n    }\n\n    private static Set<String> getScopes(Map<String, Object> tokenResponseParameters) {\n        if (tokenResponseParameters.containsKey(OAuth2ParameterNames.SCOPE)) {\n            String scope = getParameterValue(tokenResponseParameters, OAuth2ParameterNames.SCOPE);\n            return new HashSet<>(Arrays.asList(StringUtils.delimitedListToStringArray(scope, " ")));\n        }\n        return Collections.emptySet();\n    }\n\n    private static String getParameterValue(Map<String, Object> tokenResponseParameters, String parameterName) {\n        Object obj = tokenResponseParameters.get(parameterName);\n        return (obj != null) ? obj.toString() : null;\n    }\n\n    private static long getParameterValue(Map<String, Object> tokenResponseParameters, String parameterName,\n                                          long defaultValue) {\n        long parameterValue = defaultValue;\n\n        Object obj = tokenResponseParameters.get(parameterName);\n        if (obj != null) {\n            // Final classes Long and Integer do not need to be coerced\n            if (obj.getClass() == Long.class) {\n                parameterValue = (Long) obj;\n            }\n            else if (obj.getClass() == Integer.class) {\n                parameterValue = (Integer) obj;\n            }\n            else {\n                // Attempt to coerce to a long (typically from a String)\n                try {\n                    parameterValue = Long.parseLong(obj.toString());\n                }\n                catch (NumberFormatException ignored) {\n                }\n            }\n        }\n\n        return parameterValue;\n    }\n\n}\n'})}),"\n",(0,r.jsxs)(t.h3,{id:"5-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatuserrequestentityconverter\u7c7b",children:["5. \u5728",(0,r.jsx)(t.code,{children:"com.example.authorization.wechat"}),"\u5305\u4e2d\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatUserRequestEntityConverter"}),"\u7c7b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5bf9\u4e8e\u5fae\u4fe1\u767b\u5f55\u7684\u7279\u6b8a\u5904\u7406\uff0c\u8bf7\u6c42\u7528\u6237\u4fe1\u606f\u65f6\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"openid"}),"\u4e0e",(0,r.jsx)(t.code,{children:"access_token"}),"\u53c2\u6570"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"/**\n * \u5fae\u4fe1\u767b\u5f55\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u53c2\u6570\u8f6c\u6362\u5668\n *\n * @author vains\n */\npublic class WechatUserRequestEntityConverter extends OAuth2UserRequestEntityConverter {\n\n    @Override\n    public RequestEntity<?> convert(OAuth2UserRequest userRequest) {\n        // \u83b7\u53d6\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u5ba2\u6237\u7aef\u4fe1\u606f\n        ClientRegistration clientRegistration = userRequest.getClientRegistration();\n        if (THIRD_LOGIN_WECHAT.equals(clientRegistration.getRegistrationId())) {\n            // \u5bf9\u4e8e\u5fae\u4fe1\u767b\u5f55\u7684\u7279\u6b8a\u5904\u7406\uff0c\u8bf7\u6c42\u7528\u6237\u4fe1\u606f\u65f6\u6dfb\u52a0openid\u4e0eaccess_token\u53c2\u6570\n            Object openid = userRequest.getAdditionalParameters().get(WECHAT_PARAMETER_OPENID);\n            URI uri = UriComponentsBuilder\n                    .fromUriString(clientRegistration.getProviderDetails().getUserInfoEndpoint().getUri())\n                    .queryParam(WECHAT_PARAMETER_OPENID, openid)\n                    .queryParam(OAuth2ParameterNames.ACCESS_TOKEN, userRequest.getAccessToken().getTokenValue())\n                    .build().toUri();\n            return new RequestEntity<>(HttpMethod.GET, uri);\n        }\n        return super.convert(userRequest);\n    }\n}\n"})}),"\n",(0,r.jsxs)(t.h3,{id:"6-\u5728comexampleauthorizationwechat\u5305\u4e2d\u6dfb\u52a0wechatuserresponseconverter\u7c7b",children:["6. \u5728",(0,r.jsx)(t.code,{children:"com.example.authorization.wechat"}),"\u5305\u4e2d\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatUserResponseConverter"}),"\u7c7b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5fae\u4fe1\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u65f6\u54cd\u5e94\u7684\u7c7b\u578b\u4e3a",(0,r.jsx)(t.code,{children:"text/plain"}),"\uff0c\u8fd9\u91cc\u7279\u6b8a\u5904\u7406\u4e00\u4e0b"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"/**\n * \u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u54cd\u5e94\u8f6c\u6362\u5668\n *\n * @author vains\n */\npublic class WechatUserResponseConverter extends MappingJackson2HttpMessageConverter {\n\n    public WechatUserResponseConverter() {\n        List<MediaType> mediaTypes = new ArrayList<>(super.getSupportedMediaTypes());\n        // \u5fae\u4fe1\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u65f6\u54cd\u5e94\u7684\u7c7b\u578b\u4e3a\u201ctext/plain\u201d\uff0c\u8fd9\u91cc\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\n        mediaTypes.add(MediaType.TEXT_PLAIN);\n        super.setSupportedMediaTypes(mediaTypes);\n    }\n\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"7-\u5c06\u4e0a\u8fb9\u7684\u7c7b\u6dfb\u52a0\u81f3\u914d\u7f6e\u4e2d\u4f7f\u5176\u751f\u6548",children:"7. \u5c06\u4e0a\u8fb9\u7684\u7c7b\u6dfb\u52a0\u81f3\u914d\u7f6e\u4e2d\uff0c\u4f7f\u5176\u751f\u6548"}),"\n",(0,r.jsxs)(t.h4,{id:"1-authorizationconfig\u7c7b\u7684\u914d\u7f6e",children:["1. ",(0,r.jsx)(t.code,{children:"AuthorizationConfig"}),"\u7c7b\u7684\u914d\u7f6e"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'    /**\n     * \u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe(\u8d44\u6e90\u670d\u52a1\uff0c\u5ba2\u6237\u7aef\u914d\u7f6e)\n     *\n     * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n     * @return \u8fc7\u6ee4\u5668\u94fe\n     * @throws Exception \u629b\u51fa\n     */\n    @Bean\n    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http, ClientRegistrationRepository clientRegistrationRepository) throws Exception {\n        // \u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668\n        http.addFilter(corsFilter());\n        // \u7981\u7528 csrf \u4e0e cors\n        http.csrf(AbstractHttpConfigurer::disable);\n        http.cors(AbstractHttpConfigurer::disable);\n        http.authorizeHttpRequests((authorize) -> authorize\n                        // \u653e\u884c\u9759\u6001\u8d44\u6e90\n                        .requestMatchers("/assets/**", "/webjars/**", "/login", "/getCaptcha", "/getSmsCaptcha", "/error").permitAll()\n                        .anyRequest().authenticated()\n                )\n                // \u6307\u5b9a\u767b\u5f55\u9875\u9762\n                .formLogin(formLogin -> {\n                            formLogin.loginPage("/login");\n                            if (UrlUtils.isAbsoluteUrl(LOGIN_URL)) {\n                                // \u7edd\u5bf9\u8def\u5f84\u4ee3\u8868\u662f\u524d\u540e\u7aef\u5206\u79bb\uff0c\u767b\u5f55\u6210\u529f\u548c\u5931\u8d25\u6539\u4e3a\u5199\u56dejson\uff0c\u4e0d\u91cd\u5b9a\u5411\u4e86\n                                formLogin.successHandler(new LoginSuccessHandler());\n                                formLogin.failureHandler(new LoginFailureHandler());\n                            }\n                        }\n                );\n        // \u6dfb\u52a0BearerTokenAuthenticationFilter\uff0c\u5c06\u8ba4\u8bc1\u670d\u52a1\u5f53\u505a\u4e00\u4e2a\u8d44\u6e90\u670d\u52a1\uff0c\u89e3\u6790\u8bf7\u6c42\u5934\u4e2d\u7684token\n        http.oauth2ResourceServer((resourceServer) -> resourceServer\n                .jwt(Customizer.withDefaults())\n                .accessDeniedHandler(SecurityUtils::exceptionHandler)\n                .authenticationEntryPoint(SecurityUtils::exceptionHandler)\n        );\n        // \u517c\u5bb9\u524d\u540e\u7aef\u5206\u79bb\u4e0e\u4e0d\u5206\u79bb\u914d\u7f6e\n        if (UrlUtils.isAbsoluteUrl(LOGIN_URL)) {\n            http\n                    // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n                    .exceptionHandling((exceptions) -> exceptions\n                            .defaultAuthenticationEntryPointFor(\n                                    new LoginTargetAuthenticationEntryPoint(LOGIN_URL),\n                                    new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                            )\n                    );\n        }\n        // \u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\n        http.oauth2Login(oauth2Login -> oauth2Login\n                .loginPage(LOGIN_URL)\n                .authorizationEndpoint(authorization -> authorization\n                        .authorizationRequestResolver(this.authorizationRequestResolver(clientRegistrationRepository))\n                )\n                .tokenEndpoint(token -> token\n                        .accessTokenResponseClient(this.accessTokenResponseClient())\n                )\n        );\n\n        // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n        http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n        return http.build();\n    }\n\n    /**\n     * AuthorizationRequest \u81ea\u5b9a\u4e49\u914d\u7f6e\n     *\n     * @param clientRegistrationRepository yml\u914d\u7f6e\u4e2d\u5ba2\u6237\u7aef\u4fe1\u606f\u5b58\u50a8\u7c7b\n     * @return OAuth2AuthorizationRequestResolver\n     */\n    private OAuth2AuthorizationRequestResolver authorizationRequestResolver(ClientRegistrationRepository clientRegistrationRepository) {\n        DefaultOAuth2AuthorizationRequestResolver authorizationRequestResolver =\n                new DefaultOAuth2AuthorizationRequestResolver(\n                        clientRegistrationRepository, "/oauth2/authorization");\n\n        // \u517c\u5bb9\u5fae\u4fe1\u767b\u5f55\u6388\u6743\u7533\u8bf7\n        authorizationRequestResolver.setAuthorizationRequestCustomizer(new WechatAuthorizationRequestConsumer());\n\n        return authorizationRequestResolver;\n    }\n\n    /**\n     * \u9002\u914d\u5fae\u4fe1\u767b\u5f55\u9002\u914d\uff0c\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8bf7\u6c42token\u5165\u53c2\u5904\u7406\n     *\n     * @return OAuth2AccessTokenResponseClient accessToken\u54cd\u5e94\u4fe1\u606f\u5904\u7406\n     */\n    private OAuth2AccessTokenResponseClient<OAuth2AuthorizationCodeGrantRequest> accessTokenResponseClient() {\n        DefaultAuthorizationCodeTokenResponseClient tokenResponseClient = new DefaultAuthorizationCodeTokenResponseClient();\n        tokenResponseClient.setRequestEntityConverter(new WechatCodeGrantRequestEntityConverter());\n        // \u81ea\u5b9a\u4e49 RestTemplate\uff0c\u9002\u914d\u5fae\u4fe1\u767b\u5f55\u83b7\u53d6token\n        OAuth2AccessTokenResponseHttpMessageConverter messageConverter = new OAuth2AccessTokenResponseHttpMessageConverter();\n        List<MediaType> mediaTypes = new ArrayList<>(messageConverter.getSupportedMediaTypes());\n        // \u5fae\u4fe1\u83b7\u53d6token\u65f6\u54cd\u5e94\u7684\u7c7b\u578b\u4e3a\u201ctext/plain\u201d\uff0c\u8fd9\u91cc\u7279\u6b8a\u5904\u7406\u4e00\u4e0b\n        mediaTypes.add(MediaType.TEXT_PLAIN);\n        messageConverter.setAccessTokenResponseConverter(new WechatMapAccessTokenResponseConverter());\n        messageConverter.setSupportedMediaTypes(mediaTypes);\n\n        // \u521d\u59cb\u5316RestTemplate\n        RestTemplate restTemplate = new RestTemplate(Arrays.asList(\n                new FormHttpMessageConverter(),\n                messageConverter));\n\n        restTemplate.setErrorHandler(new OAuth2ErrorResponseErrorHandler());\n        tokenResponseClient.setRestOperations(restTemplate);\n        return tokenResponseClient;\n    }\n'})}),"\n",(0,r.jsxs)(t.h4,{id:"2-customoauth2userservice\u6539\u9020",children:["2. ",(0,r.jsx)(t.code,{children:"CustomOauth2UserService"}),"\u6539\u9020"]}),"\n",(0,r.jsxs)(t.p,{children:["\u79fb\u9664\u7c7b\u4e0a\u7684",(0,r.jsx)(t.code,{children:"@RequiredArgsConstructor"}),"\u6ce8\u89e3\uff0c\u81ea\u5df1\u5b9e\u73b0\u6784\u9020\u65b9\u6cd5\uff0c\u521d\u59cb\u5316\u65f6\u6dfb\u52a0\u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u8bf7\u6c42\u5904\u7406(",(0,r.jsx)(t.code,{children:"oidcUserService"}),"\u672c\u8d28\u4e0a\u662f\u8c03\u7528\u8be5\u7c7b\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\uff0c\u4e0d\u7528\u6dfb\u52a0)\uff0c\u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u5668\uff0c\u83b7\u53d6\u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u65f6\u4f7f\u5176\u652f\u6301",(0,r.jsx)(t.code,{children:"text/plain"}),"\u7684",(0,r.jsx)(t.code,{children:"Context-Type"}),"\u3002\u6dfb\u52a0\u5f02\u5e38\u5904\u7406\uff0c\u5c06\u5f02\u5e38\u4fe1\u606f\u653e\u5165",(0,r.jsx)(t.code,{children:"session"}),"\u4e2d\uff0c\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u65f6\u53ef\u4ee5\u83b7\u53d6\u5230\u5f02\u5e38\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'/**\n * \u81ea\u5b9a\u4e49\u4e09\u65b9oauth2\u767b\u5f55\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u670d\u52a1\n *\n * @author vains\n */\n@Service\npublic class CustomOauth2UserService extends DefaultOAuth2UserService {\n\n    private final IOauth2ThirdAccountService thirdAccountService;\n\n    private final Oauth2UserConverterContext userConverterContext;\n\n    public CustomOauth2UserService(IOauth2ThirdAccountService thirdAccountService, Oauth2UserConverterContext userConverterContext) {\n        this.thirdAccountService = thirdAccountService;\n        this.userConverterContext = userConverterContext;\n        // \u521d\u59cb\u5316\u65f6\u6dfb\u52a0\u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u8bf7\u6c42\u5904\u7406\uff0coidcUserService\u672c\u8d28\u4e0a\u662f\u8c03\u7528\u8be5\u7c7b\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\uff0c\u4e0d\u7528\u6dfb\u52a0\n        super.setRequestEntityConverter(new WechatUserRequestEntityConverter());\n        // \u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u5668\n        RestTemplate restTemplate = new RestTemplate();\n        restTemplate.setErrorHandler(new OAuth2ErrorResponseErrorHandler());\n        List<HttpMessageConverter<?>> messageConverters = List.of(\n                new StringHttpMessageConverter(),\n                // \u83b7\u53d6\u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u65f6\u4f7f\u5176\u652f\u6301\u201ctext/plain\u201d\n                new WechatUserResponseConverter(),\n                new ResourceHttpMessageConverter(),\n                new ByteArrayHttpMessageConverter(),\n                new AllEncompassingFormHttpMessageConverter()\n        );\n        restTemplate.setMessageConverters(messageConverters);\n        super.setRestOperations(restTemplate);\n    }\n\n\n    @Override\n    public OAuth2User loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException {\n        try {\n            OAuth2User oAuth2User = super.loadUser(userRequest);\n            // \u8f6c\u4e3a\u9879\u76ee\u4e2d\u7684\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n            Oauth2ThirdAccount oauth2ThirdAccount = userConverterContext.convert(userRequest, oAuth2User);\n            // \u68c0\u67e5\u7528\u6237\u4fe1\u606f\n            thirdAccountService.checkAndSaveUser(oauth2ThirdAccount);\n            // \u5c06loginType\u8bbe\u7f6e\u81f3attributes\u4e2d\n            LinkedHashMap<String, Object> attributes = new LinkedHashMap<>(oAuth2User.getAttributes());\n            // \u5c06RegistrationId\u5f53\u505a\u767b\u5f55\u7c7b\u578b\n            attributes.put("loginType", userRequest.getClientRegistration().getRegistrationId());\n            String userNameAttributeName = userRequest.getClientRegistration().getProviderDetails().getUserInfoEndpoint()\n                    .getUserNameAttributeName();\n            return new DefaultOAuth2User(oAuth2User.getAuthorities(), attributes, userNameAttributeName);\n        } catch (Exception e) {\n            // \u83b7\u53d6\u5f53\u524drequest\n            RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();\n            if (requestAttributes == null) {\n                throw new InvalidCaptchaException("Failed to get the current request.");\n            }\n            HttpServletRequest request = ((ServletRequestAttributes) requestAttributes).getRequest();\n            // \u5c06\u5f02\u5e38\u653e\u5165session\u4e2d\n            request.getSession(Boolean.FALSE).setAttribute(WebAttributes.AUTHENTICATION_EXCEPTION, e);\n            throw new AuthenticationServiceException(e.getMessage(), e);\n        }\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.h3,{id:"8-\u7528\u6237\u4fe1\u606f\u5904\u7406\u7b56\u7565\u6dfb\u52a0wechatuserconverter\u7c7b\u4f7f\u5176\u89e3\u6790\u5fae\u4fe1\u7528\u6237\u4fe1\u606f",children:["8. \u7528\u6237\u4fe1\u606f\u5904\u7406\u7b56\u7565\u6dfb\u52a0",(0,r.jsx)(t.code,{children:"WechatUserConverter"}),"\u7c7b\uff0c\u4f7f\u5176\u89e3\u6790\u5fae\u4fe1\u7528\u6237\u4fe1\u606f"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'/**\n * \u5fae\u4fe1\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u5668\n *\n * @author vains\n */\n@RequiredArgsConstructor\n@Component(THIRD_LOGIN_WECHAT)\npublic class WechatUserConverter implements Oauth2UserConverterStrategy {\n\n    @Override\n    public Oauth2ThirdAccount convert(OAuth2User oAuth2User) {\n        // \u83b7\u53d6\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n        Map<String, Object> attributes = oAuth2User.getAttributes();\n        // \u8f6c\u6362\u81f3Oauth2ThirdAccount\n        Oauth2ThirdAccount thirdAccount = new Oauth2ThirdAccount();\n        thirdAccount.setUniqueId(String.valueOf(attributes.get("openid")));\n        thirdAccount.setThirdUsername(oAuth2User.getName());\n        thirdAccount.setType(THIRD_LOGIN_WECHAT);\n        thirdAccount.setLocation(attributes.get("province")+ " " + attributes.get("city"));\n        // \u8bbe\u7f6e\u57fa\u7840\u7528\u6237\u4fe1\u606f\n        thirdAccount.setName(oAuth2User.getName());\n        thirdAccount.setAvatarUrl(String.valueOf(attributes.get("headimgurl")));\n        return thirdAccount;\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"9-yml\u4e2d\u6dfb\u52a0\u5fae\u4fe1\u5e94\u7528\u914d\u7f6e\u4fe1\u606f",children:"9. yml\u4e2d\u6dfb\u52a0\u5fae\u4fe1\u5e94\u7528\u914d\u7f6e\u4fe1\u606f"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"spring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/authorization-example?serverTimezone=UTC&userUnicode=true&characterEncoding=utf-8\n    username: root\n    password: root\n  security:\n    oauth2:\n      client:\n        registration:\n          # \u8fd9\u4e2a'gitee'\u5c31\u662fregistrationId\n          gitee:\n            # \u6307\u5b9aoauth\u767b\u5f55\u63d0\u4f9b\u8005\uff0c\u8be5oauth\u767b\u5f55\u7531provider\u4e2d\u7684gitee\u6765\u5904\u7406\n            provider: gitee\n            # \u5ba2\u6237\u7aef\u540d\u5b57\n            client-name: Sign in with Gitee\n            # \u8ba4\u8bc1\u65b9\u5f0f\n            authorization-grant-type: authorization_code\n            # \u5ba2\u6237\u7aefid\uff0c\u4f7f\u7528\u81ea\u5df1\u7684gitee\u7684\u5ba2\u6237\u7aefid\n            client-id: \n            # \u5ba2\u6237\u7aef\u79d8\u94a5\uff0c\u4f7f\u7528\u81ea\u5df1\u7684gitee\u7684\u5ba2\u6237\u7aef\u79d8\u94a5\n            client-secret: \n            # \u56de\u8c03\u5730\u5740\n            redirect-uri: http://192.168.1.102:8080/login/oauth2/code/gitee\n            # \u7533\u8bf7scope\u5217\u8868\n            scope:\n              - emails\n              - projects\n          github:\n            # security client\u9ed8\u8ba4\u5b9e\u73b0\u4e86GitHub\u63d0\u4f9b\u7684oauth2\u767b\u5f55\n            provider: github\n            client-id: \n            client-secret: \n          wechat:\n            # \u5fae\u4fe1\u767b\u5f55\u914d\u7f6e\n            provider: wechat\n            # \u5ba2\u6237\u7aef\u540d\u5b57\n            client-name: Sign in with WeChat\n            # \u8ba4\u8bc1\u65b9\u5f0f\n            authorization-grant-type: authorization_code\n            # \u5ba2\u6237\u7aefid\uff0c\u4f7f\u7528\u81ea\u5df1\u7684\u5fae\u4fe1\u7684appid\n            client-id: \n            # \u5ba2\u6237\u7aef\u79d8\u94a5\uff0c\u4f7f\u7528\u81ea\u5df1\u7684\u5fae\u4fe1\u7684app secret\n            client-secret: \n            # \u56de\u8c03\u5730\u5740\uff0c\u8bbe\u7f6e\u4e3a\u8ba4\u8bc1\u670d\u52a1\u7684\u56de\u8c03\u5730\u5740\uff0c\u7531\u8ba4\u8bc1\u670d\u52a1\u7528code\u6362\u53d6token\n            redirect-uri: http://192.168.1.102:8080/login/oauth2/code/wechat\n            # \u7533\u8bf7scope\u5217\u8868\n            scope: snsapi_userinfo\n\n        # oauth\u767b\u5f55\u63d0\u4f9b\u5546\n        provider:\n          # \u5fae\u4fe1\u7684OAuth2\u7aef\u70b9\u914d\u7f6e\n          wechat:\n            # \u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u54cd\u5e94\u4f53\u4e2d\u8d26\u53f7\u7684\u5b57\u6bb5\n            user-name-attribute: nickname\n            # \u83b7\u53d6token\u7684\u5730\u5740\n            token-uri: https://api.weixin.qq.com/sns/oauth2/access_token\n            # \u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u5730\u5740\n            user-info-uri: https://api.weixin.qq.com/sns/userinfo\n            # \u53d1\u8d77\u6388\u6743\u7533\u8bf7\u7684\u5730\u5740\n            authorization-uri: https://open.weixin.qq.com/connect/oauth2/authorize\n          # gitee\u7684OAuth2\u7aef\u70b9\u914d\u7f6e\n          gitee:\n            # \u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u54cd\u5e94\u4f53\u4e2d\u8d26\u53f7\u7684\u5b57\u6bb5\n            user-name-attribute: login\n            # \u83b7\u53d6token\u7684\u5730\u5740\n            token-uri: https://gitee.com/oauth/token\n            # \u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u5730\u5740\n            user-info-uri: https://gitee.com/api/v5/user\n            # \u53d1\u8d77\u6388\u6743\u7533\u8bf7\u7684\u5730\u5740\n            authorization-uri: https://gitee.com/oauth/authorize\n          github:\n            user-name-attribute: login\n\n# Mybatis-Plus \u914d\u7f6e\nmybatis-plus:\n  # \u626b\u63cfmapper\u6587\u4ef6\n  mapper-locations:\n    - classpath:com/vains/mapper/xml/*Mapper.xml\n"})}),"\n",(0,r.jsx)(t.h3,{id:"10-\u767b\u5f55\u9875\u9762\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55\u5165\u53e3",children:"10. \u767b\u5f55\u9875\u9762\u6dfb\u52a0\u5fae\u4fe1\u767b\u5f55\u5165\u53e3"}),"\n",(0,r.jsxs)(t.p,{children:["\u5c06\u4e0a\u671f\u7684\u6309\u94ae\u6539\u6210\u56fe\u6807\u4e86\uff0c\u91cd\u70b9\u7684\u662f\u70b9\u51fb\u5fae\u4fe1\u767b\u5f55\u6309\u94ae\u540e\u8981\u8ba9\u8bf7\u6c42\u8df3\u8f6c\u81f3",(0,r.jsx)(t.code,{children:"/oauth2/authorization/wechat"}),"\uff0c",(0,r.jsx)(t.code,{children:"wechat"}),"\u5c31\u662f\u4e0a\u8fb9yml\u4e2d\u5fae\u4fe1\u5e94\u7528\u7684",(0,r.jsx)(t.code,{children:"registrationId"}),"\uff0c\u8fd9\u91cc\u8981\u6ce8\u610f\u5bf9\u5e94\u4e0a"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:'<div class="third-box">\n    <a href="/oauth2/authorization/gitee" title="Gitee\u767b\u5f55">\n        <svg width="32" height="32" xmlns="http://www.w3.org/2000/svg" name="zi_tmGitee"\n             viewBox="0 0 2000 2000">\n            <path fill="red"\n                  d="M898 1992q183 0 344-69.5t283-191.5q122-122 191.5-283t69.5-344q0-183-69.5-344T1525 477q-122-122-283-191.5T898 216q-184 0-345 69.5T270 477Q148 599 78.5 760T9 1104q0 183 69.5 344T270 1731q122 122 283 191.5t345 69.5zm199-400H448q-17 0-30.5-14t-13.5-30V932q0-89 43.5-163.5T565 649q74-45 166-45h616q17 0 30.5 14t13.5 31v111q0 16-13.5 30t-30.5 14H731q-54 0-93.5 39.5T598 937v422q0 17 14 30.5t30 13.5h416q55 0 94.5-39.5t39.5-93.5v-22q0-17-14-30.5t-31-13.5H842q-17 0-30.5-14t-13.5-31v-111q0-16 13.5-30t30.5-14h505q17 0 30.5 14t13.5 30v250q0 121-86.5 207.5T1097 1592z"/>\n        </svg>\n    </a>\n\n    <a href="/oauth2/authorization/github" title="GitHub\u767b\u5f55">\n        <img width="36" style="margin-right: 5px;" alt="Sign in with GitHub"\n             src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"/>\n    </a>\n\n    <a href="/oauth2/authorization/wechat" title="GitHub\u767b\u5f55">\n        <img width="28" style="margin-right: 5px; position: static;" alt="Sign in with GitHub"\n             src="./assets/img/wechat_login.png"/>\n    </a>\n</div>\n'})}),"\n",(0,r.jsx)(t.h3,{id:"11\u8865\u5145",children:"11.\u8865\u5145"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"SecurityConstants"}),"\u5e38\u91cf\u7c7b\u4e2d\u7684\u5e38\u91cf"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'/**\n * \u5fae\u4fe1\u767b\u5f55\u76f8\u5173\u53c2\u6570\u2014\u2014openid\uff1a\u7528\u6237\u552f\u4e00id\n */\npublic static final String WECHAT_PARAMETER_OPENID = "openid";\n\n/**\n * \u5fae\u4fe1\u767b\u5f55\u76f8\u5173\u53c2\u6570\u2014\u2014forcePopup\uff1a\u5f3a\u5236\u6b64\u6b21\u6388\u6743\u9700\u8981\u7528\u6237\u5f39\u7a97\u786e\u8ba4\n */\npublic static final String WECHAT_PARAMETER_FORCE_POPUP = "forcePopup";\n\n/**\n * \u5fae\u4fe1\u767b\u5f55\u76f8\u5173\u53c2\u6570\u2014\u2014secret\uff1a\u5fae\u4fe1\u7684\u5e94\u7528\u79d8\u94a5\n */\npublic static final String WECHAT_PARAMETER_SECRET = "secret";\n\n/**\n * \u5fae\u4fe1\u767b\u5f55\u76f8\u5173\u53c2\u6570\u2014\u2014appid\uff1a\u5fae\u4fe1\u7684\u5e94\u7528id\n */\npublic static final String WECHAT_PARAMETER_APPID = "appid";\n\n/**\n * \u4e09\u65b9\u767b\u5f55\u7c7b\u578b\u2014\u2014\u5fae\u4fe1\n */\npublic static final String THIRD_LOGIN_WECHAT = "wechat";\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u5230\u6b64\u4e3a\u6b62\u7f16\u7801\u90e8\u5206\u5c31\u5b8c\u6210\u4e86\uff0c\u5fae\u4fe1\u767b\u5f55\u7684\u56fe\u6807\u53ef\u4ee5\u53bbgitee\u4e0a\u53d6\u4e00\u4e0b\u6216\u8005\u81ea\u5df1\u627e\u4e00\u4e0b\u5c31\u884c\uff0c\u4ee3\u7801\u4ed3\u5e93\u5730\u5740\u5728\u6700\u540e\u7684\u9644\u5f55\u4e2d\u3002"}),"\n",(0,r.jsx)(t.h2,{id:"\u56db\u5fae\u4fe1\u6d4b\u8bd5\u53f7\u914d\u7f6e\u7b80\u8981\u8bf4\u660e",children:"\u56db\u3001\u5fae\u4fe1\u6d4b\u8bd5\u53f7\u914d\u7f6e\u7b80\u8981\u8bf4\u660e"}),"\n",(0,r.jsxs)(t.p,{children:["\u5fae\u4fe1\u5e94\u7528\u914d\u7f6e\u4e2d",(0,r.jsx)(t.code,{children:"appid"}),"\u548c",(0,r.jsx)(t.code,{children:"app secret"}),"\u5927\u5bb6\u7528\u81ea\u5df1\u7684\uff0c\u5982\u679c\u6ca1\u6709\u8ba4\u8bc1\u8d44\u8d28\u4e5f\u53ef\u4ee5\u50cf\u4f5c\u8005\u8fd9\u6837\u53bb\u7533\u8bf7\u4e00\u4e2a\u5fae\u4fe1\u6d4b\u8bd5\u53f7\u53bb\u6d4b\u8bd5\uff0c\u56e0\u4e3a\u8fd9\u91cc\u9650\u5236\u4e86\u53ea\u6709\u5173\u6ce8\u4e86\u6d4b\u8bd5\u516c\u4f17\u53f7\u624d\u53ef\u4ee5\u4f7f\u7528\uff0c\u6700\u591a\u53ea\u80fd\u5173\u6ce8100\u4e2a\uff0c\u6240\u4ee5\u5927\u5bb6\u53bb\u7533\u8bf7\u4e00\u4e2a\u6d4b\u8bd5\u5c31ok\u3002"]}),"\n",(0,r.jsx)(t.p,{children:"\u4e0b\u8fb9\u6211\u4f1a\u653e\u4e00\u4e0b\u6d4b\u8bd5\u53f7\u7684\u622a\u56fe\uff0c\u8981\u662f\u771f\u60f3\u7528\u53ef\u4ee5\u5173\u6ce8\u4e0b\u6d4b\u8bd5\u53f7(\u6709\u56de\u8c03\u5730\u5740\u7684\u9650\u5236)"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"key"}),(0,r.jsx)(t.th,{children:"value"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"appID"}),(0,r.jsx)(t.td,{children:"wx946ad2f955901214"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"appsecret"}),(0,r.jsx)(t.td,{children:"e4635ff2ed22c83294394ac818cf75a7"})]})]})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(73823).Z+"",width:"1512",height:"760"})}),"\n",(0,r.jsx)(t.p,{children:"\u6d4b\u8bd5\u53f7\u7684\u4e8c\u7ef4\u7801\uff0c\u626b\u63cf\u5173\u6ce8\u540e\u624d\u53ef\u4f7f\u7528"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(35580).Z+"",width:"1366",height:"886"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"\u91cd\u8981\uff1a"})," \u60f3\u8ba9\u8054\u5408\u8ba4\u8bc1\u6d41\u7a0b\u8d70\u4e0b\u53bb\u8981\u4fee\u6539\u56de\u8c03\u5730\u5740\u4e3a\u8ba4\u8bc1\u670d\u52a1\u5668\u7684\u5730\u5740\n\u70b9\u51fb\u4fee\u6539\uff0c\u5728\u5f39\u51fa\u7684\u6846\u5185\u8f93\u5165\u8ba4\u8bc1\u670d\u52a1\u7684\u5730\u5740"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(75454).Z+"",width:"1486",height:"789"})}),"\n",(0,r.jsx)(t.p,{children:"\u4fee\u6539\u56de\u8c03\u5730\u5740"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(10837).Z+"",width:"1290",height:"723"})}),"\n",(0,r.jsx)(t.h2,{id:"\u4e94\u6d4b\u8bd5",children:"\u4e94\u3001\u6d4b\u8bd5"}),"\n",(0,r.jsx)(t.p,{children:"\u6d4b\u8bd5\u53f7\u9650\u5236\u4e86\u53ea\u80fd\u5728\u5fae\u4fe1\u5ba2\u6237\u7aef\u6253\u5f00\u6388\u6743\u7533\u8bf7\u5730\u5740\uff0c\u6240\u4ee5\u672c\u6b21\u6d4b\u8bd5\u8981\u5728\u5fae\u4fe1\u5185\u6253\u5f00\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740"}),"\n",(0,r.jsx)(t.h3,{id:"1-\u5fae\u4fe1\u5185\u6253\u5f00\u6388\u6743\u7533\u8bf7\u5730\u5740",children:"1. \u5fae\u4fe1\u5185\u6253\u5f00\u6388\u6743\u7533\u8bf7\u5730\u5740"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.del,{children:"\u4e0d\u77e5\u9053\u4e3a\u4ec0\u4e48pc\u7aef\u5fae\u4fe1\u8df3\u8f6c\u81f3\u5fae\u4fe1\u7684\u6388\u6743\u7533\u8bf7\u9875\u9762\u65f6\u662f\u7a7a\u767d\uff0c\u8fd9\u91cc\u6211\u7528\u624b\u673a\u8fdb\u884c\u6d4b\u8bd5\u3002"})}),"\n",(0,r.jsx)(t.p,{children:"\u7ecf\u8bc4\u8bba\u533a\u63d0\u9192\u53d1\u73b0\u662f\u56e0\u4e3a\u53c2\u6570\u7684\u987a\u5e8f\u95ee\u9898\uff0c\u5fae\u4fe1\u670d\u52a1\u5668\u4f1a\u5bf9\u6388\u6743\u7533\u8bf7\u5730\u5740\u7684\u53c2\u6570\u987a\u5e8f\u505a\u5f3a\u6821\u9a8c(\u79fb\u52a8\u7aef\u5fae\u4fe1\u5e94\u8be5\u662f\u6ca1\u6709\u8fd9\u4e2a\u6821\u9a8c\u7684)\uff0c\u6587\u6863\u539f\u6587\uff1a"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"\u5c24\u5176\u6ce8\u610f\uff1a\u7531\u4e8e\u6388\u6743\u64cd\u4f5c\u5b89\u5168\u7b49\u7ea7\u8f83\u9ad8\uff0c\u6240\u4ee5\u5728\u53d1\u8d77\u6388\u6743\u8bf7\u6c42\u65f6\uff0c\u5fae\u4fe1\u4f1a\u5bf9\u6388\u6743\u94fe\u63a5\u505a\u6b63\u5219\u5f3a\u5339\u914d\u6821\u9a8c\uff0c\u5982\u679c\u94fe\u63a5\u7684\u53c2\u6570\u987a\u5e8f\u4e0d\u5bf9\uff0c\u6388\u6743\u9875\u9762\u5c06\u65e0\u6cd5\u6b63\u5e38\u8bbf\u95ee\u3002"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["\u6587\u6863\u8bf4\u660e\u4f4d\u7f6e\u8bf7\u67e5\u770b",(0,r.jsx)(t.a,{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html#%E7%9B%AE%E5%BD%95",children:"\u7b2c\u4e00\u6b65\uff1a\u7528\u6237\u540c\u610f\u6388\u6743"}),"\uff0c\u83b7\u53d6code\u4e0b\u7684\u6b63\u6587\u5185\u5bb9\u3002"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"http://192.168.1.102:8080/oauth2/authorize?client_id=messaging-client&response_type=code&scope=message.read&redirect_uri=http://127.0.0.1:8000/login/oauth2/code/messaging-client-oidc\n"})}),"\n",(0,r.jsx)(t.h3,{id:"2-\u8ba4\u8bc1\u670d\u52a1\u68c0\u6d4b\u5230\u672a\u767b\u5f55\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",children:"2. \u8ba4\u8bc1\u670d\u52a1\u68c0\u6d4b\u5230\u672a\u767b\u5f55\uff0c\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(1532).Z+"",width:"1290",height:"2796"})}),"\n",(0,r.jsx)(t.h3,{id:"3-\u70b9\u51fb\u5fae\u4fe1\u767b\u5f55\u56fe\u6807\u7531\u8ba4\u8bc1\u670d\u52a1\u91cd\u5b9a\u5411\u81f3\u5fae\u4fe1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\u5fae\u4fe1\u6d4f\u89c8\u5668\u5f39\u6846\u7533\u8bf7\u6388\u6743",children:"3. \u70b9\u51fb\u5fae\u4fe1\u767b\u5f55\u56fe\u6807\uff0c\u7531\u8ba4\u8bc1\u670d\u52a1\u91cd\u5b9a\u5411\u81f3\u5fae\u4fe1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\uff0c\u5fae\u4fe1\u6d4f\u89c8\u5668\u5f39\u6846\u7533\u8bf7\u6388\u6743"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(29394).Z+"",width:"1290",height:"2796"})}),"\n",(0,r.jsx)(t.h3,{id:"4-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u5fae\u4fe1\u5f15\u5bfc\u8bf7\u6c42\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u8ba4\u8bc1\u670d\u52a1\u6839\u636ecode\u6362\u53d6access_token\u518d\u6839\u636eaccess_token\u548copenid\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",children:"4. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u5fae\u4fe1\u5f15\u5bfc\u8bf7\u6c42\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\uff0c\u8ba4\u8bc1\u670d\u52a1\u6839\u636ecode\u6362\u53d6access_token\uff0c\u518d\u6839\u636eaccess_token\u548copenid\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u83b7\u53d6\u5230\u7528\u6237\u4fe1\u606f\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(28845).Z+"",width:"1290",height:"2796"})}),"\n",(0,r.jsx)(t.h3,{id:"5-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u4f1a\u53d1\u73b0\u9875\u9762\u6ca1\u6709\u8df3\u8f6c\u8fd9\u662f\u56e0\u4e3a\u8bf7\u6c42\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\u643a\u5e26\u7684redirect_uri\u662f\u4e00\u4e2a\u4e0d\u53ef\u7528\u7684\u670d\u52a1\u52a0\u8f7d\u5931\u8d25\u4e86\u867d\u7136\u52a0\u8f7d\u5931\u8d25\u4e86\u4f46\u662f\u5f53\u524d\u94fe\u63a5\u5df2\u7ecf\u662f\u56de\u8c03\u5730\u5740\u4e86\u8fd9\u65f6\u5019\u53ef\u4ee5\u70b9\u53f3\u4e0a\u89d2\u7684\u4e09\u4e2a\u70b9\u9009\u62e9\u590d\u5236\u94fe\u63a5\u7136\u540e\u5c31\u80fd\u83b7\u53d6code\u4e86",children:"5. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u4f1a\u53d1\u73b0\u9875\u9762\u6ca1\u6709\u8df3\u8f6c\uff0c\u8fd9\u662f\u56e0\u4e3a\u8bf7\u6c42\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u7533\u8bf7\u5730\u5740\u643a\u5e26\u7684redirect_uri\u662f\u4e00\u4e2a\u4e0d\u53ef\u7528\u7684\u670d\u52a1\uff0c\u52a0\u8f7d\u5931\u8d25\u4e86\uff0c\u867d\u7136\u52a0\u8f7d\u5931\u8d25\u4e86\u4f46\u662f\u5f53\u524d\u94fe\u63a5\u5df2\u7ecf\u662f\u56de\u8c03\u5730\u5740\u4e86\uff0c\u8fd9\u65f6\u5019\u53ef\u4ee5\u70b9\u53f3\u4e0a\u89d2\u7684\u4e09\u4e2a\u70b9\uff0c\u9009\u62e9\u590d\u5236\u94fe\u63a5\uff0c\u7136\u540e\u5c31\u80fd\u83b7\u53d6code\u4e86"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(89046).Z+"",width:"1290",height:"2796"})}),"\n",(0,r.jsx)(t.h3,{id:"6-\u5728postman\u4e2d\u6839\u636ecode\u83b7\u53d6token",children:"6. \u5728postman\u4e2d\u6839\u636ecode\u83b7\u53d6token"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(51578).Z+"",width:"1390",height:"693"})}),"\n",(0,r.jsx)(t.h3,{id:"7-\u6839\u636etoken\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f",children:"7. \u6839\u636etoken\u83b7\u53d6\u5f53\u524d\u7528\u6237\u4fe1\u606f"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(94966).Z+"",width:"1393",height:"791"})}),"\n",(0,r.jsx)(t.h3,{id:"8-\u6700\u540e\u9644\u4e0a\u6570\u636e\u5e93\u7528\u6237\u4fe1\u606f\u622a\u56fe",children:"8. \u6700\u540e\u9644\u4e0a\u6570\u636e\u5e93\u7528\u6237\u4fe1\u606f\u622a\u56fe"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(37534).Z+"",width:"1280",height:"201"})}),"\n",(0,r.jsx)(t.h2,{id:"\u516d\u5199\u5728\u6700\u540e",children:"\u516d\u3001\u5199\u5728\u6700\u540e"}),"\n",(0,r.jsxs)(t.p,{children:["\u867d\u7136\u8fd9\u6b21\u662f\u7528\u6d4b\u8bd5\u53f7\u5bf9\u63a5\u7684\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5f00\u653e\u5e73\u53f0\u63d0\u4f9b\u7684\u626b\u7801\u767b\u5f55\u4e5f\u662f\u8fd9\u4e2a\u6d41\u7a0b\uff0c\u76f4\u63a5\u66ff\u6362",(0,r.jsx)(t.code,{children:"appid"}),"\u548c",(0,r.jsx)(t.code,{children:"app secret"}),"\u4e3a\u5f00\u653e\u5e73\u53f0\u7533\u8bf7\u7684\u5e94\u8be5\u80fd\u76f4\u63a5\u4f7f\u7528\uff1b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\u83b7\u53d6",(0,r.jsx)(t.code,{children:"access_token"}),"\u65f6\u53ef\u80fd\u4f1a\u8fd4\u56de",(0,r.jsx)(t.code,{children:"unionid"}),"\uff0c\u8fd9\u662f\u5728\u540c\u4e00\u4e2a\u5fae\u4fe1\u5f00\u653e\u5e73\u53f0\u8d26\u53f7\u4e0b\u62e5\u6709\u591a\u4e2a\u79fb\u52a8\u5e94\u7528\u3001\u7f51\u7ad9\u5e94\u7528\u548c\u516c\u4f17\u8d26\u53f7\uff0c\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u540e\u7528\u6237\u4fe1\u606f\u4e2d\u7684",(0,r.jsx)(t.code,{children:"openid"}),"\u53ef\u80fd\u4e0d\u540c\uff0c\u4f46\u662f",(0,r.jsx)(t.code,{children:"unionid"}),"\u662f\u76f8\u540c\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7",(0,r.jsx)(t.code,{children:"unionid"}),"\u533a\u5206\u7528\u6237\u3002\u6240\u4ee5\u53ef\u4ee5\u5728\u4e09\u65b9\u7528\u6237\u8868\u4e2d\u591a\u52a0\u4e00\u4e2a\u5b57\u6bb5\u6765\u5b58\u653e",(0,r.jsx)(t.code,{children:"unionid"}),"\u6216\u8005",(0,r.jsx)(t.code,{children:"openid"}),"\u3002\u5982\u679c\u6709\u4ec0\u4e48\u95ee\u9898\u6216\u8005\u66f4\u597d\u7684\u5efa\u8bae\u53ef\u4ee5\u5728\u4e0b\u65b9\u8bc4\u8bba\u533a\u4e2d\u63d0\u51fa"]}),"\n",(0,r.jsx)(t.h2,{id:"\u4e03\u9644\u5f55",children:"\u4e03\u3001\u9644\u5f55"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["\u5fae\u4fe1\u7f51\u9875\u6388\u6743\u767b\u5f55\u6587\u6863\uff1a",(0,r.jsx)(t.a,{href:"https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/Wechat_webpage_authorization.html",children:"\u5730\u5740"})]}),"\n",(0,r.jsxs)(t.li,{children:["\u5fae\u4fe1\u6d4b\u8bd5\u53f7\u7533\u8bf7\u5730\u5740\uff1a",(0,r.jsx)(t.a,{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",children:"\u5730\u5740"})]}),"\n",(0,r.jsxs)(t.li,{children:["Security OAuth2 Client\u6587\u6863\u5730\u5740\uff1a",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html",children:"\u5730\u5740"})]}),"\n",(0,r.jsxs)(t.li,{children:["\u4ee3\u7801\u5730\u5740\uff1a",(0,r.jsx)(t.a,{href:"https://gitee.com/vains-Sofia/authorization-example",children:"Gitee"})]}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,s.ah)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},25892:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-1-fe0097d6003af4616774644316f06df6.webp"},29394:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-10-dc06299b52a9407e7532fdcae42d2fcd.webp"},28845:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-11-9a93e846389dd5a995b41d2be7845fff.webp"},89046:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-12-68599b3074ffcfeeab8a1b1663133438.webp"},51578:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-13-353a7162a54f133e8106b4e462179845.webp"},94966:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-14-154ea4c85bc7ba87ae0dbe7785967477.webp"},37534:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-15-eacf853c55452c6aeb631529855b0852.webp"},10180:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-2-fa5cfb224b13286eb87b99a4138a0a49.webp"},16443:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-3-4ce60f7cc82e191900745a4893fca272.webp"},23744:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-4-e418c57489df96c5cb6d40950e9e1b7b.webp"},73823:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-5-6d5d22c746353db7ec2f5d3b66f53946.webp"},35580:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-6-f05d25f8faf75b6968c0a0ff3f1f48cc.webp"},75454:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-7-ae38251f7e206850136198b006e3b902.webp"},10837:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-8-e11cbbe1fb91fa457b2ff9991b14ea04.webp"},1532:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/14-9-daceecaf1c54609787d4c4c5564567ca.webp"},11151:(e,t,n)=>{n.d(t,{ah:()=>i});var r=n(67294);const s=r.createContext({});function i(e){const t=r.useContext(s);return r.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}}}]);