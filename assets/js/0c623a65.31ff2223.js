"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[3555],{54696:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>l,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var r=n(85893),i=n(11151);const o={},s=void 0,a={id:"zh-cn/spring-authorization-server/SAS-Github-Gitee-Login",title:"SAS-Github-Gitee-Login",description:"- Spring Authorization Server\u5165\u95e8 (\u5341\u4e09) \u5b9e\u73b0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\uff0c\u96c6\u6210Github\u4e0eGitee\u7684OAuth\u767b\u5f55",source:"@site/docs/zh-cn/spring-authorization-server/13-SAS-Github-Gitee-Login.md",sourceDirName:"zh-cn/spring-authorization-server",slug:"/zh-cn/spring-authorization-server/SAS-Github-Gitee-Login",permalink:"/light-docusaurus/docs/zh-cn/spring-authorization-server/SAS-Github-Gitee-Login",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/spring-authorization-server/13-SAS-Github-Gitee-Login.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{},sidebar:"troch",previous:{title:"SAS-Frontend-Backend-Separate",permalink:"/light-docusaurus/docs/zh-cn/spring-authorization-server/SAS-Frontend-Backend-Separate"},next:{title:"SAS-Wechat-Login",permalink:"/light-docusaurus/docs/zh-cn/spring-authorization-server/SAS-Wechat-Login"}},c={},u=[{value:"\u4e00\u3001\u524d\u8a00",id:"\u4e00\u524d\u8a00",level:2},{value:"1. \u4ec0\u4e48\u662f\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\uff1f",id:"1-\u4ec0\u4e48\u662f\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1",level:3},{value:"2. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\uff1f",id:"2-\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1",level:3},{value:"\u4e8c\u3001\u7f16\u7801",id:"\u4e8c\u7f16\u7801",level:2},{value:"1. \u524d\u671f\u51c6\u5907\u8bf4\u660e",id:"1-\u524d\u671f\u51c6\u5907\u8bf4\u660e",level:3},{value:"2. \u7f16\u7801\u6d41\u7a0b\u8bf4\u660e",id:"2-\u7f16\u7801\u6d41\u7a0b\u8bf4\u660e",level:3},{value:"3. \u521d\u59cb\u5316\u4e09\u65b9\u7528\u6237\u8d26\u53f7\u8868",id:"3-\u521d\u59cb\u5316\u4e09\u65b9\u7528\u6237\u8d26\u53f7\u8868",level:3},{value:"4. \u5f00\u59cb\u7f16\u7801",id:"4-\u5f00\u59cb\u7f16\u7801",level:3},{value:"1. \u5f15\u5165Security OAuth2 Client",id:"1-\u5f15\u5165security-oauth2-client",level:4},{value:"2. \u7f16\u5199\u81ea\u5b9a\u4e49<code>OAuth2UserService</code>",id:"2-\u7f16\u5199\u81ea\u5b9a\u4e49oauth2userservice",level:4},{value:"3. \u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u7f16\u5199\u4e00\u5957\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7c7b\uff0c\u5c06\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8f6c\u6210\u81ea\u5df1\u7cfb\u7edf\u91cc\u7684\u7528\u6237\u4fe1\u606f\u5e76\u50a8\u5b58",id:"3-\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u7f16\u5199\u4e00\u5957\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7c7b\u5c06\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8f6c\u6210\u81ea\u5df1\u7cfb\u7edf\u91cc\u7684\u7528\u6237\u4fe1\u606f\u5e76\u50a8\u5b58",level:4},{value:"4. \u7f16\u5199\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u81ea\u5b9a\u4e49token\u5904\u7406\uff0c\u5f53\u4f7f\u7528openId Connect\u767b\u5f55\u65f6\u5c06\u7528\u6237\u4fe1\u606f\u5199\u5165idToken\u4e2d",id:"4-\u7f16\u5199\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u81ea\u5b9a\u4e49token\u5904\u7406\u5f53\u4f7f\u7528openid-connect\u767b\u5f55\u65f6\u5c06\u7528\u6237\u4fe1\u606f\u5199\u5165idtoken\u4e2d",level:3},{value:"5. \u66f4\u65b0\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e\u7c7b\uff0c\u6dfb\u52a0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u914d\u7f6e",id:"5-\u66f4\u65b0\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e\u7c7b\u6dfb\u52a0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u914d\u7f6e",level:3},{value:"6. \u767b\u5f55\u9875\u9762\u6dfb\u52a0\u4e09\u65b9\u767b\u5f55\u5165\u53e3",id:"6-\u767b\u5f55\u9875\u9762\u6dfb\u52a0\u4e09\u65b9\u767b\u5f55\u5165\u53e3",level:3},{value:"\u4e09\u3001\u6d4b\u8bd5",id:"\u4e09\u6d4b\u8bd5",level:2},{value:"1. Gitee",id:"1-gitee",level:3},{value:"1. \u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3",id:"1-\u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3",level:4},{value:"2. \u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",id:"2-\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",level:4},{value:"3. \u9009\u62e9Gitee\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55",id:"3-\u9009\u62e9gitee\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55",level:4},{value:"4. \u767b\u5f55\u4e4b\u540e\u63d0\u4ea4\u4f1a\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762",id:"4-\u767b\u5f55\u4e4b\u540e\u63d0\u4ea4\u4f1a\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762",level:4},{value:"5. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u6388\u6743\u786e\u8ba4\u9875\u9762",id:"5-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u6388\u6743\u786e\u8ba4\u9875\u9762",level:4},{value:"6. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u643a\u5e26code\u8df3\u8f6c\u81f3\u8bf7\u6c42\u6388\u6743\u65f6\u643a\u5e26\u7684<code>redirect_uri</code>\u5730\u5740",id:"6-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u643a\u5e26code\u8df3\u8f6c\u81f3\u8bf7\u6c42\u6388\u6743\u65f6\u643a\u5e26\u7684redirect_uri\u5730\u5740",level:4},{value:"7. \u4f7f\u7528POSTMAN\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528<code>code</code>\u6362\u53d6<code>access token</code>",id:"7-\u4f7f\u7528postman\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528code\u6362\u53d6access-token",level:4},{value:"8. \u89e3\u6790<code>access token</code>\uff0c\u67e5\u770b\u81ea\u5b9a\u4e49\u5185\u5bb9\u662f\u5426\u751f\u6548",id:"8-\u89e3\u6790access-token\u67e5\u770b\u81ea\u5b9a\u4e49\u5185\u5bb9\u662f\u5426\u751f\u6548",level:4},{value:"2. Github",id:"2-github",level:3},{value:"1. \u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3",id:"1-\u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3-1",level:4},{value:"2. \u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",id:"2-\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762-1",level:4},{value:"3. \u9009\u62e9\u4e09\u65b9\u767b\u5f55\u4e2d\u7684Github\u767b\u5f55",id:"3-\u9009\u62e9\u4e09\u65b9\u767b\u5f55\u4e2d\u7684github\u767b\u5f55",level:4},{value:"4. \u91cd\u5b9a\u5411\u81f3Github\u767b\u5f55(\u5982\u679c\u672a\u767b\u5f55)",id:"4-\u91cd\u5b9a\u5411\u81f3github\u767b\u5f55\u5982\u679c\u672a\u767b\u5f55",level:4},{value:"5. \u63d0\u4ea4\u767b\u5f55\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3Github\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",id:"5-\u63d0\u4ea4\u767b\u5f55\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3github\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",level:4},{value:"6. \u786e\u8ba4\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",id:"6-\u786e\u8ba4\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",level:4},{value:"7. \u6388\u6743\u786e\u8ba4\u4ee5\u540e\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u56de\u8c03\u5730\u5740",id:"7-\u6388\u6743\u786e\u8ba4\u4ee5\u540e\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u56de\u8c03\u5730\u5740",level:4},{value:"8. \u4f7f\u7528POSTMAN\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528code\u6362\u53d6<code>access token</code>",id:"8-\u4f7f\u7528postman\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528code\u6362\u53d6access-token",level:4},{value:"9. \u5237\u65b0token",id:"9-\u5237\u65b0token",level:4},{value:"10. \u4f7f\u7528<code>access token</code>\u83b7\u53d6\u4e00\u4e0b\u7528\u6237\u4fe1\u606f\u770b\u4e0b",id:"10-\u4f7f\u7528access-token\u83b7\u53d6\u4e00\u4e0b\u7528\u6237\u4fe1\u606f\u770b\u4e0b",level:4},{value:"11. \u67e5\u770b\u6570\u636e\u5e93\u7684\u7528\u6237\u4fe1\u606f",id:"11-\u67e5\u770b\u6570\u636e\u5e93\u7684\u7528\u6237\u4fe1\u606f",level:4},{value:"\u56db\u3001\u5199\u5728\u6700\u540e",id:"\u56db\u5199\u5728\u6700\u540e",level:2},{value:"\u4e94\u3001\u9644\u5f55",id:"\u4e94\u9644\u5f55",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.ah)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://juejin.cn/post/7258466145653096504",children:"Spring Authorization Server\u5165\u95e8 (\u5341\u4e09) \u5b9e\u73b0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\uff0c\u96c6\u6210Github\u4e0eGitee\u7684OAuth\u767b\u5f55"})}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"\u4e00\u524d\u8a00",children:"\u4e00\u3001\u524d\u8a00"}),"\n",(0,r.jsx)(t.h3,{id:"1-\u4ec0\u4e48\u662f\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1",children:"1. \u4ec0\u4e48\u662f\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\uff1f"}),"\n",(0,r.jsx)(t.p,{children:"\xa0\xa0\xa0\xa0\xa0\xa0\u901a\u8fc7Spring Security\xa0OAuth2\xa0Client\uff08Login\uff09\u6a21\u5757\u96c6\u6210\u7b2c\u4e09\u65b9\u767b\u5f55\u81f3\u81ea\u5df1\u7684\u8ba4\u8bc1\u670d\u52a1\u4e2d\uff0c\u4f7f\u7528\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u53ea\u9700\u8981\u8bf7\u6c42\u8ba4\u8bc1\u670d\u52a1\uff0c\u4e0d\u901a\u8fc7\u524d\u7aef\u6765\u8df3\u8f6c\u4e09\u65b9\u7684\u6388\u6743\u7533\u8bf7\u94fe\u63a5\uff0c\u800c\u662f\u7edf\u4e00\u901a\u8fc7\u8ba4\u8bc1\u670d\u52a1\u6765\u8df3\u8f6c\uff0c\u53ea\u9700\u8981\u7ef4\u62a4Spring Authorization Server\u4e2d\u8eab\u4efd\u8ba4\u8bc1\u63d0\u4f9b\u5546\u7684\u5173\u7cfb\u5373\u53ef\u3002"}),"\n",(0,r.jsx)(t.h3,{id:"2-\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1",children:"2. \u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\uff1f"}),"\n",(0,r.jsx)(t.p,{children:"\xa0\xa0\xa0\xa0\xa0\xa0\u73b0\u5728\u9879\u76ee\u4e2d\u90fd\u4f1a\u96c6\u6210\u4e00\u4e9b\u4e09\u65b9\u767b\u5f55\uff0c\u5982Github\u3001Gitee\u3001\u5fae\u4fe1\u3001QQ\u5e73\u53f0\u63d0\u4f9b\u7684\u6388\u6743\u767b\u5f55\uff0c\u5982\u679c\u624b\u52a8\u96c6\u6210\u5219\u6bcf\u79cd\u4e09\u65b9\u767b\u5f55\u90fd\u8981\u63d0\u4f9b\u4e00\u4e2a\u56de\u8c03\u63a5\u53e3\uff0c\u81ea\u5df1\u5b9e\u73b0\u901a\u8fc7code\u6362\u53d6token\uff0c\u518d\u7528token\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u4e00\u4e2a\u8fc7\u7a0b\uff0c\u4f46\u662f\u8fd9\u4e9b\u5185\u5bb9Security OAuth2 Client\u90fd\u5df2\u7ecf\u5b9e\u73b0\u4e86\uff0c\u53ea\u8981\u7b26\u5408OAuth2\u7684\u6807\u51c6\u90fd\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e00\u5957\u5b9e\u73b0\uff0c\u4e0d\u9700\u8981\u81ea\u5df1\u518d\u9020\u8f6e\u5b50\u4e86\u3002"}),"\n",(0,r.jsxs)(t.p,{children:["\u5173\u4e8eSecurity OAuth2 Client\u7684\u5bf9\u63a5\u8fc7\u7a0b\u53ca\u539f\u7406\u5df2\u7ecf\u5728",(0,r.jsx)(t.a,{href:"https://juejin.cn/post/7243725197911834683",children:"Spring Authorization Server\u5165\u95e8 (\u516b) Spring Boot\u5f15\u5165Security OAuth2 Client\u5bf9\u63a5\u8ba4\u8bc1\u670d\u52a1"}),"\u4e2d\u8bf4\u8fc7\u4e86\uff0c\u4eca\u5929\u5c31\u4e0d\u7ec6\u8bb2\u4e86\uff0c\u4f1a\u91cd\u70b9\u8bb2\u4e00\u4e0b\u5982\u4f55\u83b7\u53d6\u548c\u5904\u7406\u7528\u6237\u4fe1\u606f\u3002\n\u5148\u6765\u770b\u4e00\u4e0b",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/login/advanced.html",children:"\u6587\u6863"}),"\uff0c\u6587\u6863\u4e2d\u8bf4\u660e\u4e86OAuth2 Login\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u5176\u4e2d\u5c31\u6709\u8bbe\u7f6e\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u670d\u52a1\uff0c\u5982\u4e0b"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(85784).Z+"",width:"1252",height:"791"})}),"\n",(0,r.jsxs)(t.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0\u518d\u6765\u8be6\u7ec6\u770b\u4e00\u4e0b\u5173\u4e8e",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u7684",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/login/advanced.html#oauth2login-advanced-oauth2-user-service",children:"\u8be6\u7ec6\u4ecb\u7ecd"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(94309).Z+"",width:"1287",height:"755"})}),"\n",(0,r.jsxs)(t.p,{children:["\xa0\xa0\xa0\xa0\xa0\xa0\u53d1\u73b0",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u6709\u4e00\u4e2a\u9ed8\u8ba4\u5b9e\u73b0",(0,r.jsx)(t.code,{children:"DefaultOAuth2UserService"}),"\uff0c\u5b83\u662f\u901a\u8fc7RestOperations\u7684\u5b9e\u4f8b\u8bf7\u6c42\u7528\u6237\u7684\u57fa\u7840\u4fe1\u606f\uff0c\u4e5f\u8bf4\u660e\u4e86\u8be5\u7c7b\u4e2d\u53ef\u81ea\u5b9a\u4e49\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u4f8b\u5982\u8bf7\u6c42\u53c2\u6570\u8f6c\u6362\u3001\u54cd\u5e94\u6570\u636e\u5904\u7406\u3002\n\u867d\u7136\u4e0a\u8fb9\u8bf4\u660e\u4e86\u5982\u4f55\u81ea\u5b9a\u4e49",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\uff0c\u4f46\u662f\u672c\u4eba\u5728\u67e5\u770b\u6e90\u7801\u65f6\u53d1\u73b0\u6846\u67b6\u4f1a\u5148\u4ece\u914d\u7f6e\u4e2d\u83b7\u53d6\uff0c\u83b7\u53d6\u4e0d\u5230\u4f1a\u4eceioc\u4e2d\u83b7\u53d6\uff0cioc\u4e2d\u6ca1\u6709\u5c31\u521d\u59cb\u5316\u4e00\u4e2a\uff0c\u5982\u4e0b\u6240\u793a"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(79600).Z+"",width:"1328",height:"787"})}),"\n",(0,r.jsxs)(t.p,{children:["\u6240\u4ee5\u4e5f\u652f\u6301\u4ee5\u6ce8\u5165ioc\u4e2d\u7684\u65b9\u5f0f\u53bb\u914d\u7f6e\u4e00\u4e2a",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u3002\n\u518d\u6765\u770b\u4e00\u4e0b",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u4e2d",(0,r.jsx)(t.code,{children:"loadUser"}),"\u65b9\u6cd5\u88ab\u8c03\u7528\u7684\u5730\u65b9"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(82720).Z+"",width:"1204",height:"64"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"OidcAuthorizationCodeAuthenticationProvider"}),"\u548c",(0,r.jsx)(t.code,{children:"OAuth2LoginAuthenticationProvider"}),"\u4e2d\u90fd\u6709\u8c03\u7528\uff0c\u5206\u522b\u770b\u4e00\u4e0b\u8fd9\u4e24\u4e2a",(0,r.jsx)(t.code,{children:"provider"}),"\u4e4b\u95f4\u7684\u903b\u8f91\uff0c\u770b\u770b\u5b83\u4eec\u7684\u533a\u522b"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(796).Z+"",width:"1340",height:"554"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(4918).Z+"",width:"1339",height:"522"})}),"\n",(0,r.jsxs)(t.p,{children:["\u53d1\u73b0Oidc\u662f\u9700\u8981\u6709",(0,r.jsx)(t.code,{children:"openid"}),"\u7684",(0,r.jsx)(t.code,{children:"scope"}),"\u624d\u4f1a\u88ab\u5904\u7406\uff0c\u800cOAuth2\u5f00\u5934\u7684\u8fd9\u4e2a\u662f\u5728",(0,r.jsx)(t.code,{children:"scope"}),"\u4e2d\u672a\u5305\u542b",(0,r.jsx)(t.code,{children:"openid"}),"\u624d\u4f1a\u53bb\u5904\u7406\u3002\u7ec6\u770b\u4e4b\u540e\u53d1\u73b0\u5b83\u4eec\u91cc\u8fb9\u6ce8\u5165\u7684",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\u7684\u5b9e\u4f8b\u4e0d\u4e00\u6837\uff0c\u5904\u7406oidc\u767b\u5f55\u7684\u5b9e\u4f8b\u662f",(0,r.jsx)(t.code,{children:"OidcUserService"}),"\uff0c\u5904\u7406\u666e\u901aoauth\u767b\u5f55\u7684\u662f",(0,r.jsx)(t.code,{children:"DefaultOAuth2UserService"}),"\uff0c\u8fd9\u662fSecurity OAuth2 Client\u9488\u5bf9OAuth\u4e0eOpenId connect\u4e24\u79cd\u767b\u5f55\u65b9\u5f0f\u7684\u5904\u7406\uff0c\u5728\u4e4b\u524d\u4e5f\u6709\u63d0\u5230\u8fc7\uff0c\u5f53scope\u4e2d\u5305\u542bopenid\u65f6\u672c\u6b21\u5c31\u662fopenid connect\u767b\u5f55\uff0c\u83b7\u53d6token\u540e\u4f1a\u54cd\u5e94idToken\uff0c\u91cc\u8fb9\u5305\u542b\u4e86\u7528\u6237\u4fe1\u606f\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f1a\u6709\u4e24\u79cd\u5904\u7406\u3002\u540c\u7406\uff0c\u5982\u679c\u6211\u4eec\u8981\u81ea\u5b9a\u4e49\u8fd9\u4e24\u4e2aservice\u7684\u8bdd\u4e5f\u9700\u8981\u5b9e\u73b0\u8fd9\u4e24\u4e2aservice\uff0c\u63d0\u9ad8\u517c\u5bb9\u6027\u3002"]}),"\n",(0,r.jsx)(t.h2,{id:"\u4e8c\u7f16\u7801",children:"\u4e8c\u3001\u7f16\u7801"}),"\n",(0,r.jsx)(t.h3,{id:"1-\u524d\u671f\u51c6\u5907\u8bf4\u660e",children:"1. \u524d\u671f\u51c6\u5907\u8bf4\u660e"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"\u4eca\u5929\u4e3b\u8981\u6f14\u793aGitee\u4e0eGitHub\u7684oauth\u767b\u5f55\uff0c\u6240\u4ee5\u9700\u8981\u5148\u5728\u5404\u5e73\u53f0\u6ce8\u518c\u597d\u6240\u9700\u7684\u7b2c\u4e09\u65b9\u5e94\u7528\u3002"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://docs.github.com/zh/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps",children:"Github\u7684OAuth\u767b\u5f55\u6587\u6863"})}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://gitee.com/api/v5/oauth_doc#/",children:"Gitee\u7684OAuth\u767b\u5f55\u6587\u6863"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"\u521d\u59cb\u5316\u4e09\u65b9\u7528\u6237\u8d26\u53f7\u8868"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"2-\u7f16\u7801\u6d41\u7a0b\u8bf4\u660e",children:"2. \u7f16\u7801\u6d41\u7a0b\u8bf4\u660e"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"\u5f15\u5165Security OAuth2 Client\u4f9d\u8d56\uff0c\u7ed9\u8ba4\u8bc1\u670d\u52a1\u6dfb\u52a0\u4e00\u4e2a\u201c\u5ba2\u6237\u7aef\u201d\u7684\u8eab\u4efd"}),"\n",(0,r.jsxs)(t.li,{children:["\u7f16\u5199\u81ea\u5b9a\u4e49",(0,r.jsx)(t.code,{children:"OAuth2UserService"}),"\uff0c\u6765\u5904\u7406\u4e09\u65b9\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f"]}),"\n",(0,r.jsx)(t.li,{children:"\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u7f16\u5199\u4e00\u5957\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7c7b\uff0c\u5c06\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8f6c\u6210\u81ea\u5df1\u7cfb\u7edf\u91cc\u7684\u7528\u6237\u4fe1\u606f\u5e76\u50a8\u5b58"}),"\n",(0,r.jsx)(t.li,{children:"\u7f16\u5199\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u81ea\u5b9a\u4e49token\u5904\u7406\uff0c\u5f53\u4f7f\u7528openId Connect\u767b\u5f55\u65f6\u5c06\u7528\u6237\u4fe1\u606f\u5199\u5165idToken\u4e2d"}),"\n",(0,r.jsx)(t.li,{children:"\u66f4\u65b0\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e\u7c7b\uff0c\u6dfb\u52a0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,r.jsx)(t.li,{children:"\u767b\u5f55\u9875\u9762\u6dfb\u52a0\u4e09\u65b9\u767b\u5f55\u5165\u53e3"}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5f00\u59cb\u7f16\u7801\u4e4b\u524d\u653e\u4e00\u4e0b\u5b98\u65b9\u7684",(0,r.jsx)(t.a,{href:"https://github.com/spring-projects/spring-authorization-server/tree/main/samples/demo-authorizationserver/src/main/java/sample/federation",children:"\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u793a\u4f8b"})]}),"\n",(0,r.jsx)(t.h3,{id:"3-\u521d\u59cb\u5316\u4e09\u65b9\u7528\u6237\u8d26\u53f7\u8868",children:"3. \u521d\u59cb\u5316\u4e09\u65b9\u7528\u6237\u8d26\u53f7\u8868"}),"\n",(0,r.jsx)(t.p,{children:"\u5982\u679c\u4e4b\u524d\u5f15\u5165\u8fc7\u9700\u91cd\u65b0\u5f15\u5165\uff0c\u8868\u7ed3\u6784\u6709\u53d8\u5316"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"DROP TABLE IF EXISTS `oauth2_third_account`;\nCREATE TABLE `oauth2_third_account`\n(\n    `id`                     int(11) NOT NULL AUTO_INCREMENT COMMENT '\u81ea\u589eid',\n    `user_id`                int(11) NULL DEFAULT NULL COMMENT '\u7528\u6237\u8868\u4e3b\u952e',\n    `unique_id`              varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u4e09\u65b9\u767b\u5f55\u552f\u4e00id',\n    `third_username`         varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u4e09\u65b9\u7528\u6237\u7684\u8d26\u53f7',\n    `credentials`            varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u7684\u8ba4\u8bc1\u4fe1\u606f(token)',\n    `credentials_expires_at` datetime(0) NULL DEFAULT NULL COMMENT '\u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u7684\u8ba4\u8bc1\u4fe1\u606f\u8fc7\u671f\u65f6\u95f4',\n    `avatar`                 varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u4e09\u65b9\u8d26\u53f7\u5934\u50cfurl',\n    `type`                   varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u4e09\u65b9\u767b\u5f55\u7c7b\u578b',\n    `blog`                   varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u535a\u5ba2\u5730\u5740',\n    `location`               varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_bin NULL DEFAULT NULL COMMENT '\u5730\u5740',\n    `create_time`            datetime(0) NULL DEFAULT NULL COMMENT '\u7ed1\u5b9a\u65f6\u95f4',\n    `update_time`            datetime(0) NULL DEFAULT NULL COMMENT '\u4fee\u6539\u65f6\u95f4',\n    PRIMARY KEY (`id`) USING BTREE\n) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin COMMENT = '\u4e09\u65b9\u767b\u5f55\u8d26\u6237\u4fe1\u606f\u8868' ROW_FORMAT = Dynamic;\n"})}),"\n",(0,r.jsx)(t.h3,{id:"4-\u5f00\u59cb\u7f16\u7801",children:"4. \u5f00\u59cb\u7f16\u7801"}),"\n",(0,r.jsx)(t.h4,{id:"1-\u5f15\u5165security-oauth2-client",children:"1. \u5f15\u5165Security OAuth2 Client"}),"\n",(0,r.jsx)(t.p,{children:"\u5f15\u5165\u4f9d\u8d56"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-xml",children:"<dependency>  \n    <groupId>org.springframework.boot</groupId>  \n    <artifactId>spring-boot-starter-oauth2-client</artifactId>  \n</dependency>\n"})}),"\n",(0,r.jsx)(t.p,{children:"\u6dfb\u52a0yml\u914d\u7f6e"}),"\n",(0,r.jsxs)(t.p,{children:["\u5b8c\u6574OAuth2 Client\u914d\u7f6e\u8be6\u89c1",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/client/core.html",children:"\u6587\u6863"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"spring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: jdbc:mysql://localhost:3306/authorization-example?serverTimezone=UTC&userUnicode=true&characterEncoding=utf-8\n    username: root\n    password: root\n  security:\n    oauth2:\n      client:\n        registration:\n          # \u8fd9\u4e2a'gitee'\u5c31\u662fregistrationId\n          gitee:\n            # \u6307\u5b9aoauth\u767b\u5f55\u63d0\u4f9b\u8005\uff0c\u8be5oauth\u767b\u5f55\u7531provider\u4e2d\u7684gitee\u6765\u5904\u7406\n            provider: gitee\n            # \u5ba2\u6237\u7aef\u540d\u5b57\n            client-name: Sign in with Gitee\n            # \u8ba4\u8bc1\u65b9\u5f0f\n            authorization-grant-type: authorization_code\n            # \u5ba2\u6237\u7aefid\uff0c\u4f7f\u7528\u81ea\u5df1\u7684gitee\u7684\u5ba2\u6237\u7aefid\n            client-id: \n            # \u5ba2\u6237\u7aef\u79d8\u94a5\uff0c\u4f7f\u7528\u81ea\u5df1\u7684gitee\u7684\u5ba2\u6237\u7aef\u79d8\u94a5\n            client-secret: \n            # \u56de\u8c03\u5730\u5740\n            redirect-uri: http://192.168.1.102:8080/login/oauth2/code/gitee\n            # \u7533\u8bf7scope\u5217\u8868\n            scope:\n              - emails\n              - projects\n          github:\n            # security client\u9ed8\u8ba4\u5b9e\u73b0\u4e86GitHub\u63d0\u4f9b\u7684oauth2\u767b\u5f55\n            provider: github\n            client-id: 88c69e87b2e50d2dab4d\n            client-secret: 350b351e8287fc142d01082bcf0dc5c6df7c21ae\n        # oauth\u767b\u5f55\u63d0\u4f9b\u5546\n        provider:\n          # gitee\u7684OAuth2\u7aef\u70b9\u914d\u7f6e\n          gitee:\n            # \u8bbe\u7f6e\u7528\u6237\u4fe1\u606f\u54cd\u5e94\u4f53\u4e2d\u8d26\u53f7\u7684\u5b57\u6bb5\n            user-name-attribute: id\n            # \u83b7\u53d6token\u7684\u5730\u5740\n            token-uri: https://gitee.com/oauth/token\n            # \u83b7\u53d6\u7528\u6237\u4fe1\u606f\u7684\u5730\u5740\n            user-info-uri: https://gitee.com/api/v5/user\n            # \u53d1\u8d77\u6388\u6743\u7533\u8bf7\u7684\u5730\u5740\n            authorization-uri: https://gitee.com/oauth/authorize\n\n# Mybatis-Plus \u914d\u7f6e\nmybatis-plus:\n  # \u626b\u63cfmapper\u6587\u4ef6\n  mapper-locations:\n    - classpath:com/vains/mapper/xml/*Mapper.xml\n"})}),"\n",(0,r.jsxs)(t.p,{children:["OAuth2 Client\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5e73\u53f0\u7684\u5b9e\u73b0\uff0c\u4e0d\u7528\u6dfb\u52a0\u914d\u7f6e\uff0c\u5982\u4e0b\n",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/login/core.html#oauth2login-common-oauth2-provider",children:"\u6587\u6863"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(22662).Z+"",width:"1512",height:"725"})}),"\n",(0,r.jsxs)(t.h4,{id:"2-\u7f16\u5199\u81ea\u5b9a\u4e49oauth2userservice",children:["2. \u7f16\u5199\u81ea\u5b9a\u4e49",(0,r.jsx)(t.code,{children:"OAuth2UserService"})]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"\u8bf4\u660e\uff1a"})," \u672c\u4eba\u5b9e\u73b0\u9ed8\u8ba4\u7684\u4e24\u4e2aservice\u662f\u56e0\u4e3a\u60f3\u83b7\u53d6\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u7684\u6765\u6e90\uff0c\u7136\u540e\u6839\u636e\u6765\u6e90\u53bb\u533a\u5206\u7528\u6237\u4fe1\u606f\uff0c\u5982\u679c\u53ea\u6709\u4e00\u4e2a\u4e09\u65b9\u767b\u5f55\u6216\u4e0d\u9700\u8981\u533a\u5206\u7528\u6237\u4fe1\u606f\u7684\u6765\u6e90\u5219\u53ef\u4ee5\u4f7f\u7528\u5b98\u65b9\u793a\u4f8b\u4e2d\u7684\u4ee3\u7801\uff0c\u76f4\u63a5\u4ece",(0,r.jsx)(t.code,{children:"LoginSuccessHandler"}),"\u4e2d\u83b7\u53d6\u7528\u6237\u4fe1\u606f"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5728service\u5305\u4e0b\u7684impl\u5305\u4e0b\u521b\u5efa",(0,r.jsx)(t.code,{children:"CustomOauth2UserService"}),"\u7c7b\u5e76\u7ee7\u627f",(0,r.jsx)(t.code,{children:"DefaultOAuth2UserService"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.service.impl;\n\nimport com.example.entity.Oauth2ThirdAccount;\nimport com.example.service.IOauth2ThirdAccountService;\nimport com.example.strategy.context.Oauth2UserConverterContext;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.oauth2.client.userinfo.DefaultOAuth2UserService;\nimport org.springframework.security.oauth2.client.userinfo.OAuth2UserRequest;\nimport org.springframework.security.oauth2.core.OAuth2AuthenticationException;\nimport org.springframework.security.oauth2.core.user.DefaultOAuth2User;\nimport org.springframework.security.oauth2.core.user.OAuth2User;\nimport org.springframework.stereotype.Service;\n\nimport java.util.LinkedHashMap;\n\n/**\n * \u81ea\u5b9a\u4e49\u4e09\u65b9oauth2\u767b\u5f55\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u670d\u52a1\n *\n * @author vains\n */\n@Service\n@RequiredArgsConstructor\npublic class CustomOauth2UserService extends DefaultOAuth2UserService {\n\n    private final IOauth2ThirdAccountService thirdAccountService;\n\n    private final Oauth2UserConverterContext userConverterContext;\n\n    @Override\n    public OAuth2User loadUser(OAuth2UserRequest userRequest) throws OAuth2AuthenticationException {\n        OAuth2User oAuth2User = super.loadUser(userRequest);\n        // \u8f6c\u4e3a\u9879\u76ee\u4e2d\u7684\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n        Oauth2ThirdAccount oauth2ThirdAccount = userConverterContext.convert(userRequest, oAuth2User);\n        // \u68c0\u67e5\u7528\u6237\u4fe1\u606f\n        thirdAccountService.checkAndSaveUser(oauth2ThirdAccount);\n        // \u5c06loginType\u8bbe\u7f6e\u81f3attributes\u4e2d\n        LinkedHashMap<String, Object> attributes = new LinkedHashMap<>(oAuth2User.getAttributes());\n        // \u5c06yml\u914d\u7f6e\u7684RegistrationId\u5f53\u505a\u767b\u5f55\u7c7b\u578b\n        attributes.put("loginType", userRequest.getClientRegistration().getRegistrationId());\n        String userNameAttributeName = userRequest.getClientRegistration().getProviderDetails().getUserInfoEndpoint()\n                .getUserNameAttributeName();\n        return new DefaultOAuth2User(oAuth2User.getAuthorities(), attributes, userNameAttributeName);\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["\u5728service\u5305\u4e0b\u7684impl\u5305\u4e0b\u521b\u5efa",(0,r.jsx)(t.code,{children:"CustomOidcUserService"}),"\u5e76\u7ee7\u627f",(0,r.jsx)(t.code,{children:"OidcUserService"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.service.impl;\n\nimport com.example.entity.Oauth2ThirdAccount;\nimport com.example.service.IOauth2ThirdAccountService;\nimport com.example.strategy.context.Oauth2UserConverterContext;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.oauth2.client.oidc.userinfo.OidcUserRequest;\nimport org.springframework.security.oauth2.client.oidc.userinfo.OidcUserService;\nimport org.springframework.security.oauth2.core.OAuth2AuthenticationException;\nimport org.springframework.security.oauth2.core.oidc.OidcIdToken;\nimport org.springframework.security.oauth2.core.oidc.user.DefaultOidcUser;\nimport org.springframework.security.oauth2.core.oidc.user.OidcUser;\nimport org.springframework.stereotype.Service;\nimport org.springframework.util.StringUtils;\n\nimport java.util.LinkedHashMap;\n\n/**\n * \u81ea\u5b9a\u4e49\u4e09\u65b9oidc\u767b\u5f55\u7528\u6237\u4fe1\u606f\u670d\u52a1\n *\n * @author vains\n */\n@Service\n@RequiredArgsConstructor\npublic class CustomOidcUserService extends OidcUserService {\n\n    private final IOauth2ThirdAccountService thirdAccountService;\n\n    private final Oauth2UserConverterContext userConverterContext;\n\n    @Override\n    public OidcUser loadUser(OidcUserRequest userRequest) throws OAuth2AuthenticationException {\n        // \u83b7\u53d6\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n        OidcUser oidcUser = super.loadUser(userRequest);\n        // \u8f6c\u4e3a\u9879\u76ee\u4e2d\u7684\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n        Oauth2ThirdAccount oauth2ThirdAccount = userConverterContext.convert(userRequest, oidcUser);\n        // \u68c0\u67e5\u7528\u6237\u4fe1\u606f\n        thirdAccountService.checkAndSaveUser(oauth2ThirdAccount);\n        OidcIdToken oidcIdToken = oidcUser.getIdToken();\n        // \u5c06loginType\u8bbe\u7f6e\u81f3attributes\u4e2d\n        LinkedHashMap<String, Object> attributes = new LinkedHashMap<>(oidcIdToken.getClaims());\n        // \u5c06RegistrationId\u5f53\u505a\u767b\u5f55\u7c7b\u578b\n        attributes.put("loginType", userRequest.getClientRegistration().getRegistrationId());\n        // \u91cd\u65b0\u751f\u6210\u4e00\u4e2aidToken\n        OidcIdToken idToken = new OidcIdToken(oidcIdToken.getTokenValue(), oidcIdToken.getIssuedAt(), oidcIdToken.getExpiresAt(), attributes);\n        String userNameAttributeName = userRequest.getClientRegistration().getProviderDetails().getUserInfoEndpoint()\n                .getUserNameAttributeName();\n        // \u91cd\u65b0\u751f\u6210oidcUser\n        if (StringUtils.hasText(userNameAttributeName)) {\n            return new DefaultOidcUser(oidcUser.getAuthorities(), idToken, oidcUser.getUserInfo(), userNameAttributeName);\n        }\n        return new DefaultOidcUser(oidcUser.getAuthorities(), idToken, oidcUser.getUserInfo());\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h4,{id:"3-\u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u7f16\u5199\u4e00\u5957\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7c7b\u5c06\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8f6c\u6210\u81ea\u5df1\u7cfb\u7edf\u91cc\u7684\u7528\u6237\u4fe1\u606f\u5e76\u50a8\u5b58",children:"3. \u4f7f\u7528\u7b56\u7565\u6a21\u5f0f\u7f16\u5199\u4e00\u5957\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7c7b\uff0c\u5c06\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8f6c\u6210\u81ea\u5df1\u7cfb\u7edf\u91cc\u7684\u7528\u6237\u4fe1\u606f\u5e76\u50a8\u5b58"}),"\n",(0,r.jsxs)(t.p,{children:["\u65b0\u5efastrategy\u5305\uff0c\u5728\u5305\u4e0b\u521b\u5efa\u7b56\u7565\u6a21\u5f0f\u7684\u63a5\u53e3",(0,r.jsx)(t.code,{children:"Oauth2UserConverterStrategy"}),"\uff0c\u521b\u5efa\u62bd\u8c61\u65b9\u6cd5",(0,r.jsx)(t.code,{children:"convert"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"package com.example.strategy;\n\nimport com.example.entity.Oauth2ThirdAccount;\nimport org.springframework.security.oauth2.core.user.OAuth2User;\n\n/**\n * oauth2 \u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u5230\u7684\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7b56\u7565\u63a5\u53e3\n *\n * @author vains\n */\npublic interface Oauth2UserConverterStrategy {\n\n    /**\n     * \u5c06oauth2\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\u8f6c\u4e3a {@link Oauth2ThirdAccount}\n     *\n     * @param oAuth2User oauth2\u767b\u5f55\u83b7\u53d6\u7684\u7528\u6237\u4fe1\u606f\n     * @return \u9879\u76ee\u4e2d\u7684\u7528\u6237\u4fe1\u606f\n     */\n    Oauth2ThirdAccount convert(OAuth2User oAuth2User);\n\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"\u521b\u5efa\u4e09\u65b9\u5e73\u53f0\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f\u5904\u7406\u5b9e\u73b0"}),"\n",(0,r.jsxs)(t.p,{children:["\u5728",(0,r.jsx)(t.code,{children:"com.example.strategy.impl"}),"\u5305\u4e0b\u521b\u5efa",(0,r.jsx)(t.code,{children:"GiteeUserConverter"}),"\u5904\u7406Gitee\u7684\u7528\u6237\u4fe1\u606f"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"\u6ce8\u610f\uff1a"})," \u8981\u6307\u5b9abean\u5728ioc\u4e2d\u7684\u540d\u5b57\uff0c\u6211\u8fd9\u91cc\u662f\u548c\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e09\u65b9\u767b\u5f55\u5e94\u7528\u5728\u914d\u7f6e\u65f6\u8bbe\u7f6e\u7684",(0,r.jsx)(t.code,{children:"RegistrationId"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.strategy.impl;\n\nimport com.example.entity.Oauth2ThirdAccount;\nimport com.example.strategy.Oauth2UserConverterStrategy;\nimport org.springframework.security.oauth2.core.user.OAuth2User;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Map;\n\nimport static com.example.constant.SecurityConstants.THIRD_LOGIN_GITEE;\n\n/**\n * \u8f6c\u6362\u901a\u8fc7\u7801\u4e91\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f\n *\n * @author vains\n */\n@Component(THIRD_LOGIN_GITEE)\npublic class GiteeUserConverter implements Oauth2UserConverterStrategy {\n\n\n    @Override\n    public Oauth2ThirdAccount convert(OAuth2User oAuth2User) {\n        // \u83b7\u53d6\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n        Map<String, Object> attributes = oAuth2User.getAttributes();\n        // \u8f6c\u6362\u81f3Oauth2ThirdAccount\n        Oauth2ThirdAccount thirdAccount = new Oauth2ThirdAccount();\n        thirdAccount.setUniqueId(oAuth2User.getName());\n        thirdAccount.setThirdUsername(String.valueOf(attributes.get("login")));\n        thirdAccount.setType(THIRD_LOGIN_GITEE);\n        thirdAccount.setBlog(String.valueOf(attributes.get("blog")));\n        // \u8bbe\u7f6e\u57fa\u7840\u7528\u6237\u4fe1\u606f\n        thirdAccount.setName(String.valueOf(attributes.get("name")));\n        thirdAccount.setAvatarUrl(String.valueOf(attributes.get("avatar_url")));\n        return thirdAccount;\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["\u5728",(0,r.jsx)(t.code,{children:"com.example.strategy.impl"}),"\u5305\u4e0b\u521b\u5efa",(0,r.jsx)(t.code,{children:"GithubUserConverter"}),"\u5904\u7406Github\u7684\u7528\u6237\u4fe1\u606f"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.strategy.impl;\n\nimport com.example.entity.Oauth2ThirdAccount;\nimport com.example.strategy.Oauth2UserConverterStrategy;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.oauth2.core.user.OAuth2User;\nimport org.springframework.stereotype.Component;\n\nimport static com.example.constant.SecurityConstants.THIRD_LOGIN_GITHUB;\n\n/**\n * \u8f6c\u6362\u901a\u8fc7Github\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f\n *\n * @author vains\n */\n@RequiredArgsConstructor\n@Component(THIRD_LOGIN_GITHUB)\npublic class GithubUserConverter implements Oauth2UserConverterStrategy {\n\n    private final GiteeUserConverter userConverter;\n\n    protected static final String LOGIN_TYPE = THIRD_LOGIN_GITHUB;\n\n    @Override\n    public Oauth2ThirdAccount convert(OAuth2User oAuth2User) {\n        // github\u4e0egitee\u76ee\u524d\u6240\u53d6\u5b57\u6bb5\u4e00\u81f4\uff0c\u76f4\u63a5\u8c03\u7528gitee\u7684\u89e3\u6790\n        Oauth2ThirdAccount thirdAccount = userConverter.convert(oAuth2User);\n        // \u63d0\u53d6location\n        Object location = oAuth2User.getAttributes().get("location");\n        thirdAccount.setLocation(String.valueOf(location));\n        // \u8bbe\u7f6e\u767b\u5f55\u7c7b\u578b\n        thirdAccount.setType(LOGIN_TYPE);\n        return thirdAccount;\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"SecurityConstants"}),"\u4e2d\u6dfb\u52a0\u5e38\u91cf"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'/**  \n * \u4e09\u65b9\u767b\u5f55\u7c7b\u578b\u2014\u2014Gitee\n */  \npublic static final String THIRD_LOGIN_GITEE = "gitee";  \n  \n/**  \n * \u4e09\u65b9\u767b\u5f55\u7c7b\u578b\u2014\u2014Github\n */  \npublic static final String THIRD_LOGIN_GITHUB = "github";\n'})}),"\n",(0,r.jsxs)(t.p,{children:["\u5728strategy\u5305\u4e0b\u521b\u5efacontext\u5305\uff0c\u521b\u5efa",(0,r.jsx)(t.code,{children:"Oauth2UserConverterContext"}),"\u7c7b\uff0c\u5728\u8be5\u7c7b\u4e2d\u6ce8\u5165\u6240\u6709\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u7b56\u7565\uff0c\u6839\u636e\u4f20\u5165\u7684type(RegistrationId)\u83b7\u53d6\u5bf9\u5e94\u7684\u89e3\u6790\u7c7b"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.strategy.context;\n\nimport com.example.entity.Oauth2ThirdAccount;\nimport com.example.strategy.Oauth2UserConverterStrategy;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.oauth2.client.userinfo.OAuth2UserRequest;\nimport org.springframework.security.oauth2.core.OAuth2AccessToken;\nimport org.springframework.security.oauth2.core.user.OAuth2User;\nimport org.springframework.stereotype.Component;\nimport org.springframework.util.ObjectUtils;\n\nimport java.time.Instant;\nimport java.time.LocalDateTime;\nimport java.time.ZoneId;\nimport java.util.Map;\n\n/**\n * \u4e09\u65b9oauth2\u767b\u5f55\u83b7\u53d6\u7684\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u5904\u7406\n *\n * @author vains\n */\n@Component\n@RequiredArgsConstructor\npublic class Oauth2UserConverterContext {\n\n    /**\n     * \u6ce8\u5165\u6240\u6709\u5b9e\u4f8b\uff0cmap\u7684key\u662f\u5b9e\u4f8b\u5728ioc\u4e2d\u7684\u540d\u5b57\n     *  \u8fd9\u91cc\u901a\u8fc7\u6784\u9020\u5668\u6ce8\u5165\u6240\u6709Oauth2UserConverterStrategy\u7684\u5b9e\u4f8b\uff0c\u5b9e\u4f8b\u540d\u4e4b\u524d\u5728\u7f16\u5199\u65f6\u5df2\u7ecf\u901a\u8fc7\n     *  {@link Component }\u6ce8\u89e3\u6307\u5b9a\u8fc7bean\u7684\u540d\u5b57\uff0c\u53ef\u4ee5\u6839\u636e\u7ed9\u5b9abean\u540d\u79f0\u4ecemap\u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684\u5b9e\u4f8b(\u5982\u679c\u5b58\u5728)\n     */\n    private final Map<String, Oauth2UserConverterStrategy> userConverterStrategyMap;\n\n    /**\n     * \u83b7\u53d6\u8f6c\u6362\u5668\u5b9e\u4f8b\n     *\n     * @param loginType \u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\n     * @return \u8f6c\u6362\u5668\u5b9e\u4f8b {@link Oauth2UserConverterStrategy}\n     */\n    public Oauth2UserConverterStrategy getInstance(String loginType) {\n        if (ObjectUtils.isEmpty(loginType)) {\n            throw new UnsupportedOperationException("\u767b\u5f55\u65b9\u5f0f\u4e0d\u80fd\u4e3a\u7a7a.");\n        }\n        Oauth2UserConverterStrategy userConverterStrategy = userConverterStrategyMap.get(loginType);\n        if (userConverterStrategy == null) {\n            throw new UnsupportedOperationException("\u4e0d\u652f\u6301[" + loginType + "]\u767b\u5f55\u65b9\u5f0f\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u8f6c\u6362\u5668");\n        }\n        return userConverterStrategy;\n    }\n\n    /**\n     * \u6839\u636e\u767b\u5f55\u65b9\u5f0f\u83b7\u53d6\u8f6c\u6362\u5668\u5b9e\u4f8b\uff0c\u4f7f\u7528\u8f6c\u6362\u5668\u83b7\u53d6\u7528\u6237\u4fe1\u606f\n     *\n     * @param userRequest  \u83b7\u53d6\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u5165\u53c2\n     * @param oAuth2User \u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u5230\u7684\u8ba4\u8bc1\u4fe1\u606f\n     * @return {@link Oauth2ThirdAccount}\n     */\n    public Oauth2ThirdAccount convert(OAuth2UserRequest userRequest, OAuth2User oAuth2User) {\n        // \u83b7\u53d6\u4e09\u65b9\u767b\u5f55\u914d\u7f6e\u7684registrationId\uff0c\u8fd9\u91cc\u5c06\u4ed6\u5f53\u505a\u767b\u5f55\u65b9\u5f0f\n        String registrationId = userRequest.getClientRegistration().getRegistrationId();\n        // \u8f6c\u6362\u7528\u6237\u4fe1\u606f\n        Oauth2ThirdAccount oauth2ThirdAccount = this.getInstance(registrationId).convert(oAuth2User);\n        // \u83b7\u53d6AccessToken\n        OAuth2AccessToken accessToken = userRequest.getAccessToken();\n        // \u8bbe\u7f6etoken\n        oauth2ThirdAccount.setCredentials(accessToken.getTokenValue());\n        // \u8bbe\u7f6e\u8d26\u53f7\u7684\u65b9\u5f0f\n        oauth2ThirdAccount.setType(registrationId);\n        Instant expiresAt = accessToken.getExpiresAt();\n        if (expiresAt != null) {\n            LocalDateTime tokenExpiresAt = expiresAt.atZone(ZoneId.of("UTC")).toLocalDateTime();\n            // token\u8fc7\u671f\u65f6\u95f4\n            oauth2ThirdAccount.setCredentialsExpiresAt(tokenExpiresAt);\n        }\n        return oauth2ThirdAccount;\n    }\n\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u4e09\u65b9\u8d26\u53f7\u5b9e\u4f53\u7c7b\u6dfb\u52a0\u6635\u79f0\u3001\u5934\u50cf\u5b57\u6bb5"}),"\n",(0,r.jsx)(t.p,{children:"\u4e3a\u4e86\u7701\u4e8b\u513f\u5c31\u5199\u5728\u4e00\u4e2a\u7c7b\u4e2d\u4e86"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.entity;\n\nimport com.baomidou.mybatisplus.annotation.*;\nimport lombok.Getter;\nimport lombok.Setter;\n\nimport java.io.Serial;\nimport java.io.Serializable;\nimport java.time.LocalDateTime;\n\n/**\n * <p>\n * \u4e09\u65b9\u767b\u5f55\u8d26\u6237\u4fe1\u606f\u8868\n * </p>\n *\n * @author vains\n * @since 2023-07-04\n */\n@Getter\n@Setter\n@TableName("oauth2_third_Account")\npublic class Oauth2ThirdAccount implements Serializable {\n\n    @Serial\n    private static final long serialVersionUID = 1L;\n\n    /**\n     * \u81ea\u589eid\n     */\n    @TableId(value = "id", type = IdType.AUTO)\n    private Integer id;\n\n    /**\n     * \u7528\u6237\u8868\u4e3b\u952e\n     */\n    private Integer userId;\n\n    /**\n     * \u4e09\u65b9\u767b\u5f55\u552f\u4e00id\n     */\n    private String uniqueId;\n\n    /**\n     * \u4e09\u65b9\u767b\u5f55\u7528\u6237\u540d\n     */\n    private String thirdUsername;\n\n    /**\n     * \u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u7684\u8ba4\u8bc1\u4fe1\u606f\n     */\n    private String credentials;\n\n    /**\n     * \u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u7684\u8ba4\u8bc1\u4fe1\u606f\u7684\u8fc7\u671f\u65f6\u95f4\n     */\n    private LocalDateTime credentialsExpiresAt;\n\n    /**\n     * \u4e09\u65b9\u767b\u5f55\u7c7b\u578b\n     */\n    private String type;\n\n    /**\n     * \u535a\u5ba2\u5730\u5740\n     */\n    private String blog;\n\n    /**\n     * \u5730\u5740\n     */\n    private String location;\n\n    /**\n     * \u7ed1\u5b9a\u65f6\u95f4\n     */\n    @TableField(fill = FieldFill.INSERT)\n    private LocalDateTime createTime;\n\n    /**\n     * \u4fee\u6539\u65f6\u95f4\n     */\n    @TableField(fill = FieldFill.INSERT_UPDATE)\n    private LocalDateTime updateTime;\n\n    /**\n     * \u7528\u6237\u540d\u3001\u6635\u79f0\n     */\n    @TableField(exist = false)\n    private String name;\n\n    /**\n     * \u5934\u50cf\u5730\u5740\n     */\n    @TableField(exist = false)\n    private String avatarUrl;\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"service\u6dfb\u52a0\u68c0\u67e5\u5e76\u6dfb\u52a0\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u7684\u5b9e\u73b0"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:"package com.example.service.impl;\n\nimport com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;\nimport com.example.entity.Oauth2ThirdAccount;\nimport com.example.mapper.Oauth2ThirdAccountMapper;\nimport com.example.service.IOauth2BasicUserService;\nimport com.example.service.IOauth2ThirdAccountService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.stereotype.Service;\nimport org.springframework.util.ObjectUtils;\n\n/**\n * <p>\n * \u4e09\u65b9\u767b\u5f55\u8d26\u6237\u4fe1\u606f\u8868 \u670d\u52a1\u5b9e\u73b0\u7c7b\n * </p>\n *\n * @author vains\n * @since 2023-07-04\n */\n@Service\n@RequiredArgsConstructor\npublic class Oauth2ThirdAccountServiceImpl extends ServiceImpl<Oauth2ThirdAccountMapper, Oauth2ThirdAccount> implements IOauth2ThirdAccountService {\n\n    private final IOauth2BasicUserService basicUserService;\n\n    @Override\n    public void checkAndSaveUser(Oauth2ThirdAccount thirdAccount) {\n        // \u6784\u5efa\u4e09\u65b9\u552f\u4e00id\u548c\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\u7684\u67e5\u8be2\u6761\u4ef6\n        Oauth2ThirdAccount oauth2ThirdAccount = this.lambdaQuery().eq(Oauth2ThirdAccount::getType, thirdAccount.getType())\n                .eq(Oauth2ThirdAccount::getUniqueId, thirdAccount.getUniqueId()).one();\n        if (oauth2ThirdAccount == null) {\n            // \u751f\u6210\u7528\u6237\u4fe1\u606f\n            Integer userId = basicUserService.saveByThirdAccount(thirdAccount);\n            thirdAccount.setUserId(userId);\n            // \u4e0d\u5b58\u5728\u4fdd\u5b58\u7528\u6237\u4fe1\u606f\n            this.save(thirdAccount);\n        } else {\n            // \u6821\u9a8c\u662f\u5426\u9700\u8981\u751f\u6210\u57fa\u7840\u7528\u6237\u4fe1\u606f\n            if (ObjectUtils.isEmpty(oauth2ThirdAccount.getUserId())) {\n                // \u751f\u6210\u7528\u6237\u4fe1\u606f\n                Integer userId = basicUserService.saveByThirdAccount(thirdAccount);\n                oauth2ThirdAccount.setUserId(userId);\n            }\n            // \u5b58\u5728\u66f4\u65b0\u7528\u6237\u7684\u8ba4\u8bc1\u4fe1\u606f\n            oauth2ThirdAccount.setCredentials(thirdAccount.getCredentials());\n            oauth2ThirdAccount.setCredentialsExpiresAt(thirdAccount.getCredentialsExpiresAt());\n            // \u8bbe\u7f6e\u7a7a\uff0c \u8ba9MybatisPlus\u81ea\u52a8\u586b\u5145\n            oauth2ThirdAccount.setUpdateTime(null);\n            this.updateById(oauth2ThirdAccount);\n        }\n    }\n\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"\u57fa\u7840\u7528\u6237\u4fe1\u606fservice\u6dfb\u52a0\u6839\u636e\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u6dfb\u52a0\u7528\u6237\u4fe1\u606f\u7c7b"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.service.impl;\n\nimport com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;\nimport com.baomidou.mybatisplus.core.toolkit.ObjectUtils;\nimport com.baomidou.mybatisplus.core.toolkit.Wrappers;\nimport com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;\nimport com.example.entity.*;\nimport com.example.mapper.Oauth2BasicUserMapper;\nimport com.example.mapper.SysAuthorityMapper;\nimport com.example.mapper.SysRoleAuthorityMapper;\nimport com.example.mapper.SysUserRoleMapper;\nimport com.example.model.security.CustomGrantedAuthority;\nimport com.example.service.IOauth2BasicUserService;\nimport lombok.RequiredArgsConstructor;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.stereotype.Service;\n\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.stream.Collectors;\n\n/**\n * <p>\n * \u57fa\u7840\u7528\u6237\u4fe1\u606f\u8868 \u670d\u52a1\u5b9e\u73b0\u7c7b\n * </p>\n *\n * @author vains\n */\n@Service\n@RequiredArgsConstructor\npublic class Oauth2BasicUserServiceImpl extends ServiceImpl<Oauth2BasicUserMapper, Oauth2BasicUser> implements IOauth2BasicUserService, UserDetailsService {\n\n    private final SysUserRoleMapper sysUserRoleMapper;\n\n    private final SysAuthorityMapper sysAuthorityMapper;\n\n    private final SysRoleAuthorityMapper sysRoleAuthorityMapper;\n\n    @Override\n    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {\n        // \u5728Security\u4e2d\u201cusername\u201d\u5c31\u4ee3\u8868\u4e86\u7528\u6237\u767b\u5f55\u65f6\u8f93\u5165\u7684\u8d26\u53f7\uff0c\u5728\u91cd\u5199\u8be5\u65b9\u6cd5\u65f6\u5b83\u53ef\u4ee5\u4ee3\u8868\u4ee5\u4e0b\u5185\u5bb9\uff1a\u8d26\u53f7\u3001\u624b\u673a\u53f7\u3001\u90ae\u7bb1\u3001\u59d3\u540d\u7b49\n        // \u201cusername\u201d\u5728\u6570\u636e\u5e93\u4e2d\u4e0d\u4e00\u5b9a\u975e\u8981\u662f\u4e00\u6837\u7684\u5217\uff0c\u5b83\u53ef\u4ee5\u662f\u624b\u673a\u53f7\u3001\u90ae\u7bb1\uff0c\u4e5f\u53ef\u4ee5\u90fd\u662f\uff0c\u6700\u4e3b\u8981\u7684\u76ee\u7684\u5c31\u662f\u6839\u636e\u8f93\u5165\u7684\u5185\u5bb9\u83b7\u53d6\u5230\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f\uff0c\u5982\u4e0b\u65b9\u6240\u793a\n        // \u901a\u8fc7\u4f20\u5165\u7684\u8d26\u53f7\u4fe1\u606f\u67e5\u8be2\u5bf9\u5e94\u7684\u7528\u6237\u4fe1\u606f\n        LambdaQueryWrapper<Oauth2BasicUser> wrapper = Wrappers.lambdaQuery(Oauth2BasicUser.class)\n                .or(o -> o.eq(Oauth2BasicUser::getEmail, username))\n                .or(o -> o.eq(Oauth2BasicUser::getMobile, username))\n                .or(o -> o.eq(Oauth2BasicUser::getAccount, username));\n        Oauth2BasicUser basicUser = baseMapper.selectOne(wrapper);\n        if (basicUser == null) {\n            throw new UsernameNotFoundException("\u8d26\u53f7\u4e0d\u5b58\u5728");\n        }\n\n        // \u901a\u8fc7\u7528\u6237\u89d2\u8272\u5173\u8054\u8868\u67e5\u8be2\u5bf9\u5e94\u7684\u89d2\u8272\n        List<SysUserRole> userRoles = sysUserRoleMapper.selectList(Wrappers.lambdaQuery(SysUserRole.class).eq(SysUserRole::getUserId, basicUser.getId()));\n        List<Integer> rolesId = Optional.ofNullable(userRoles).orElse(Collections.emptyList()).stream().map(SysUserRole::getRoleId).collect(Collectors.toList());\n        if (ObjectUtils.isEmpty(rolesId)) {\n            return basicUser;\n        }\n        // \u901a\u8fc7\u89d2\u8272\u83dc\u5355\u5173\u8054\u8868\u67e5\u51fa\u5bf9\u5e94\u7684\u83dc\u5355\n        List<SysRoleAuthority> roleMenus = sysRoleAuthorityMapper.selectList(Wrappers.lambdaQuery(SysRoleAuthority.class).in(SysRoleAuthority::getRoleId, rolesId));\n        List<Integer> menusId = Optional.ofNullable(roleMenus).orElse(Collections.emptyList()).stream().map(SysRoleAuthority::getAuthorityId).collect(Collectors.toList());\n        if (ObjectUtils.isEmpty(menusId)) {\n            return basicUser;\n        }\n\n        // \u6839\u636e\u83dc\u5355ID\u67e5\u51fa\u83dc\u5355\n        List<SysAuthority> menus = sysAuthorityMapper.selectBatchIds(menusId);\n        Set<CustomGrantedAuthority> authorities = Optional.ofNullable(menus).orElse(Collections.emptyList()).stream().map(SysAuthority::getUrl).map(CustomGrantedAuthority::new).collect(Collectors.toSet());\n        basicUser.setAuthorities(authorities);\n        return basicUser;\n    }\n\n    @Override\n    public Integer saveByThirdAccount(Oauth2ThirdAccount thirdAccount) {\n        Oauth2BasicUser basicUser = new Oauth2BasicUser();\n        basicUser.setName(thirdAccount.getName());\n        basicUser.setAvatarUrl(thirdAccount.getAvatarUrl());\n        basicUser.setDeleted(Boolean.FALSE);\n        basicUser.setSourceFrom(thirdAccount.getType());\n        this.save(basicUser);\n        return basicUser.getId();\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["\u8c03\u7528\u4e09\u65b9\u767b\u5f55\u540e\u521d\u59cb\u5316\u7528\u6237\u4fe1\u606f\u7684\u903b\u8f91\u5c31\u6839\u636e\u5177\u4f53\u7684\u4e1a\u52a1\u6765\u505a\uff0c\u6211\u8fd9\u91cc\u53ea\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u800c\u4e14\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8868\u53ea\u662f\u5b58\u50a8\u4e86\u51e0\u4e2a\u5b57\u6bb5\uff0c\u8bfb\u8005\u53ef\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u9009\u62e9\u4fdd\u5b58\u7684\u5c5e\u6027\uff0c\u76f4\u63a5\u5728",(0,r.jsx)(t.code,{children:"Oauth2UserConverterStrategy"}),"\u7684",(0,r.jsx)(t.code,{children:"convert"}),"\u65b9\u6cd5\u4e2d\u6620\u5c04\u3002"]}),"\n",(0,r.jsx)(t.h3,{id:"4-\u7f16\u5199\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u81ea\u5b9a\u4e49token\u5904\u7406\u5f53\u4f7f\u7528openid-connect\u767b\u5f55\u65f6\u5c06\u7528\u6237\u4fe1\u606f\u5199\u5165idtoken\u4e2d",children:"4. \u7f16\u5199\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u81ea\u5b9a\u4e49token\u5904\u7406\uff0c\u5f53\u4f7f\u7528openId Connect\u767b\u5f55\u65f6\u5c06\u7528\u6237\u4fe1\u606f\u5199\u5165idToken\u4e2d"}),"\n",(0,r.jsx)(t.p,{children:"\u53c2\u8003\u5b98\u65b9\u793a\u4f8b\u7f16\u5199\uff0c\u5e76\u4e14\u5c06\u4e4b\u524d\u7684\u81ea\u5b9a\u4e49\u903b\u8f91\u6574\u5408\u5728\u4e86\u4e00\u5757"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.authorization.federation;\n\nimport com.example.constant.SecurityConstants;\nimport org.springframework.security.core.Authentication;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.oauth2.core.oidc.IdTokenClaimNames;\nimport org.springframework.security.oauth2.core.oidc.OidcIdToken;\nimport org.springframework.security.oauth2.core.oidc.endpoint.OidcParameterNames;\nimport org.springframework.security.oauth2.core.oidc.user.OidcUser;\nimport org.springframework.security.oauth2.core.user.OAuth2User;\nimport org.springframework.security.oauth2.jwt.JwtClaimsSet;\nimport org.springframework.security.oauth2.server.authorization.token.JwtEncodingContext;\nimport org.springframework.security.oauth2.server.authorization.token.OAuth2TokenCustomizer;\n\nimport java.util.*;\nimport java.util.stream.Collectors;\n\n/**\n * An {@link OAuth2TokenCustomizer} to map claims from a federated identity to\n * the {@code id_token} produced by this authorization server.\n *\n * @author vains\n */\npublic final class FederatedIdentityIdTokenCustomizer implements OAuth2TokenCustomizer<JwtEncodingContext> {\n\n    private static final Set<String> ID_TOKEN_CLAIMS = Set.of(\n            IdTokenClaimNames.ISS,\n            IdTokenClaimNames.SUB,\n            IdTokenClaimNames.AUD,\n            IdTokenClaimNames.EXP,\n            IdTokenClaimNames.IAT,\n            IdTokenClaimNames.AUTH_TIME,\n            IdTokenClaimNames.NONCE,\n            IdTokenClaimNames.ACR,\n            IdTokenClaimNames.AMR,\n            IdTokenClaimNames.AZP,\n            IdTokenClaimNames.AT_HASH,\n            IdTokenClaimNames.C_HASH\n    );\n\n    @Override\n    public void customize(JwtEncodingContext context) {\n        if (OidcParameterNames.ID_TOKEN.equals(context.getTokenType().getValue())) {\n            Map<String, Object> thirdPartyClaims = extractClaims(context.getPrincipal());\n            context.getClaims().claims(existingClaims -> {\n                // Remove conflicting claims set by this authorization server\n                existingClaims.keySet().forEach(thirdPartyClaims::remove);\n\n                // Remove standard id_token claims that could cause problems with clients\n                ID_TOKEN_CLAIMS.forEach(thirdPartyClaims::remove);\n\n                // Add all other claims directly to id_token\n                existingClaims.putAll(thirdPartyClaims);\n            });\n        }\n\n        // \u68c0\u67e5\u767b\u5f55\u7528\u6237\u4fe1\u606f\u662f\u4e0d\u662fOAuth2User\uff0c\u5728token\u4e2d\u6dfb\u52a0loginType\u5c5e\u6027\n        if (context.getPrincipal().getPrincipal() instanceof OAuth2User user) {\n            JwtClaimsSet.Builder claims = context.getClaims();\n            Object loginType = user.getAttribute("loginType");\n            if (loginType instanceof String) {\n                // \u540c\u65f6\u68c0\u9a8c\u662f\u5426\u4e3aString\u548c\u662f\u5426\u4e0d\u4e3a\u7a7a\n                claims.claim("loginType", loginType);\n            }\n        }\n\n        // \u68c0\u67e5\u767b\u5f55\u7528\u6237\u4fe1\u606f\u662f\u4e0d\u662fUserDetails\uff0c\u6392\u9664\u6389\u6ca1\u6709\u7528\u6237\u53c2\u4e0e\u7684\u6d41\u7a0b\n        if (context.getPrincipal().getPrincipal() instanceof UserDetails user) {\n            // \u83b7\u53d6\u7533\u8bf7\u7684scopes\n            Set<String> scopes = context.getAuthorizedScopes();\n            // \u83b7\u53d6\u7528\u6237\u7684\u6743\u9650\n            Collection<? extends GrantedAuthority> authorities = user.getAuthorities();\n            // \u63d0\u53d6\u6743\u9650\u5e76\u8f6c\u4e3a\u5b57\u7b26\u4e32\n            Set<String> authoritySet = Optional.ofNullable(authorities).orElse(Collections.emptyList()).stream()\n                    // \u83b7\u53d6\u6743\u9650\u5b57\u7b26\u4e32\n                    .map(GrantedAuthority::getAuthority)\n                    // \u53bb\u91cd\n                    .collect(Collectors.toSet());\n\n            // \u5408\u5e76scope\u4e0e\u7528\u6237\u4fe1\u606f\n            authoritySet.addAll(scopes);\n\n            JwtClaimsSet.Builder claims = context.getClaims();\n            // \u5c06\u6743\u9650\u4fe1\u606f\u653e\u5165jwt\u7684claims\u4e2d\uff08\u4e5f\u53ef\u4ee5\u751f\u6210\u4e00\u4e2a\u4ee5\u6307\u5b9a\u5b57\u7b26\u5206\u5272\u7684\u5b57\u7b26\u4e32\u653e\u5165\uff09\n            claims.claim(SecurityConstants.AUTHORITIES_KEY, authoritySet);\n            // \u653e\u5165\u5176\u5b83\u81ea\u5b9a\u5185\u5bb9\n            // \u89d2\u8272\u3001\u5934\u50cf...\n        }\n    }\n\n    private Map<String, Object> extractClaims(Authentication principal) {\n        Map<String, Object> claims;\n        if (principal.getPrincipal() instanceof OidcUser oidcUser) {\n            OidcIdToken idToken = oidcUser.getIdToken();\n            claims = idToken.getClaims();\n        } else if (principal.getPrincipal() instanceof OAuth2User oauth2User) {\n            claims = oauth2User.getAttributes();\n        } else {\n            claims = Collections.emptyMap();\n        }\n\n        return new HashMap<>(claims);\n    }\n\n\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"5-\u66f4\u65b0\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e\u7c7b\u6dfb\u52a0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u914d\u7f6e",children:"5. \u66f4\u65b0\u8ba4\u8bc1\u670d\u52a1\u914d\u7f6e\u7c7b\uff0c\u6dfb\u52a0\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u914d\u7f6e"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'package com.example.config;\n\nimport com.example.authorization.device.DeviceClientAuthenticationConverter;\nimport com.example.authorization.device.DeviceClientAuthenticationProvider;\nimport com.example.authorization.federation.FederatedIdentityIdTokenCustomizer;\nimport com.example.authorization.handler.LoginFailureHandler;\nimport com.example.authorization.handler.LoginSuccessHandler;\nimport com.example.authorization.handler.LoginTargetAuthenticationEntryPoint;\nimport com.example.authorization.sms.SmsCaptchaGrantAuthenticationConverter;\nimport com.example.authorization.sms.SmsCaptchaGrantAuthenticationProvider;\nimport com.example.constant.RedisConstants;\nimport com.example.constant.SecurityConstants;\nimport com.example.support.RedisOperator;\nimport com.example.support.RedisSecurityContextRepository;\nimport com.example.util.SecurityUtils;\nimport com.nimbusds.jose.jwk.JWKSet;\nimport com.nimbusds.jose.jwk.RSAKey;\nimport com.nimbusds.jose.jwk.source.ImmutableJWKSet;\nimport com.nimbusds.jose.jwk.source.JWKSource;\nimport com.nimbusds.jose.proc.SecurityContext;\nimport lombok.RequiredArgsConstructor;\nimport lombok.SneakyThrows;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.MediaType;\nimport org.springframework.jdbc.core.JdbcTemplate;\nimport org.springframework.security.access.annotation.Secured;\nimport org.springframework.security.authentication.AuthenticationManager;\nimport org.springframework.security.config.Customizer;\nimport org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;\nimport org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.oauth2.core.AuthorizationGrantType;\nimport org.springframework.security.oauth2.core.ClientAuthenticationMethod;\nimport org.springframework.security.oauth2.core.oidc.OidcScopes;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\nimport org.springframework.security.oauth2.server.authorization.JdbcOAuth2AuthorizationConsentService;\nimport org.springframework.security.oauth2.server.authorization.JdbcOAuth2AuthorizationService;\nimport org.springframework.security.oauth2.server.authorization.OAuth2AuthorizationConsentService;\nimport org.springframework.security.oauth2.server.authorization.OAuth2AuthorizationService;\nimport org.springframework.security.oauth2.server.authorization.client.JdbcRegisteredClientRepository;\nimport org.springframework.security.oauth2.server.authorization.client.RegisteredClient;\nimport org.springframework.security.oauth2.server.authorization.client.RegisteredClientRepository;\nimport org.springframework.security.oauth2.server.authorization.config.annotation.web.configuration.OAuth2AuthorizationServerConfiguration;\nimport org.springframework.security.oauth2.server.authorization.config.annotation.web.configurers.OAuth2AuthorizationServerConfigurer;\nimport org.springframework.security.oauth2.server.authorization.settings.AuthorizationServerSettings;\nimport org.springframework.security.oauth2.server.authorization.settings.ClientSettings;\nimport org.springframework.security.oauth2.server.authorization.token.JwtEncodingContext;\nimport org.springframework.security.oauth2.server.authorization.token.OAuth2TokenCustomizer;\nimport org.springframework.security.oauth2.server.authorization.token.OAuth2TokenGenerator;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtAuthenticationConverter;\nimport org.springframework.security.oauth2.server.resource.authentication.JwtGrantedAuthoritiesConverter;\nimport org.springframework.security.web.DefaultSecurityFilterChain;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.util.UrlUtils;\nimport org.springframework.security.web.util.matcher.MediaTypeRequestMatcher;\nimport org.springframework.util.ObjectUtils;\nimport org.springframework.web.cors.CorsConfiguration;\nimport org.springframework.web.cors.UrlBasedCorsConfigurationSource;\nimport org.springframework.web.filter.CorsFilter;\n\nimport java.security.KeyPair;\nimport java.security.KeyPairGenerator;\nimport java.security.interfaces.RSAPrivateKey;\nimport java.security.interfaces.RSAPublicKey;\nimport java.util.UUID;\n\n/**\n * \u8ba4\u8bc1\u914d\u7f6e\n * {@link EnableMethodSecurity} \u5f00\u542f\u5168\u5c40\u65b9\u6cd5\u8ba4\u8bc1\uff0c\u542f\u7528JSR250\u6ce8\u89e3\u652f\u6301\uff0c\u542f\u7528\u6ce8\u89e3 {@link Secured} \u652f\u6301\uff0c\n * \u5728Spring Security 6.0\u7248\u672c\u4e2d\u5c06@Configuration\u6ce8\u89e3\u4ece@EnableWebSecurity, @EnableMethodSecurity, @EnableGlobalMethodSecurity\n * \u548c @EnableGlobalAuthentication \u4e2d\u79fb\u9664\uff0c\u4f7f\u7528\u8fd9\u4e9b\u6ce8\u89e3\u9700\u624b\u52a8\u6dfb\u52a0 @Configuration \u6ce8\u89e3\n * {@link EnableWebSecurity} \u6ce8\u89e3\u6709\u4e24\u4e2a\u4f5c\u7528:\n * 1. \u52a0\u8f7d\u4e86WebSecurityConfiguration\u914d\u7f6e\u7c7b, \u914d\u7f6e\u5b89\u5168\u8ba4\u8bc1\u7b56\u7565\u3002\n * 2. \u52a0\u8f7d\u4e86AuthenticationConfiguration, \u914d\u7f6e\u4e86\u8ba4\u8bc1\u4fe1\u606f\u3002\n *\n * @author vains\n */\n@Configuration\n@EnableWebSecurity\n@RequiredArgsConstructor\n@EnableMethodSecurity(jsr250Enabled = true, securedEnabled = true)\npublic class AuthorizationConfig {\n\n    private final RedisOperator<String> redisOperator;\n\n    /**\n     * \u767b\u5f55\u5730\u5740\uff0c\u524d\u540e\u7aef\u5206\u79bb\u5c31\u586b\u5199\u5b8c\u6574\u7684url\u8def\u5f84\uff0c\u4e0d\u5206\u79bb\u586b\u5199\u76f8\u5bf9\u8def\u5f84\n     */\n    private final String LOGIN_URL = "/login";\n\n    private static final String CUSTOM_CONSENT_PAGE_URI = "/oauth2/consent";\n\n    private final RedisSecurityContextRepository redisSecurityContextRepository;\n\n    /**\n     * \u914d\u7f6e\u7aef\u70b9\u7684\u8fc7\u6ee4\u5668\u94fe\n     *\n     * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n     * @return \u8fc7\u6ee4\u5668\u94fe\n     * @throws Exception \u629b\u51fa\n     */\n    @Bean\n    public SecurityFilterChain authorizationServerSecurityFilterChain(HttpSecurity http,\n                                                                      RegisteredClientRepository registeredClientRepository,\n                                                                      AuthorizationServerSettings authorizationServerSettings) throws Exception {\n        // \u914d\u7f6e\u9ed8\u8ba4\u7684\u8bbe\u7f6e\uff0c\u5ffd\u7565\u8ba4\u8bc1\u7aef\u70b9\u7684csrf\u6821\u9a8c\n        OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http);\n\n        // \u65b0\u5efa\u8bbe\u5907\u7801converter\u548cprovider\n        DeviceClientAuthenticationConverter deviceClientAuthenticationConverter =\n                new DeviceClientAuthenticationConverter(\n                        authorizationServerSettings.getDeviceAuthorizationEndpoint());\n        DeviceClientAuthenticationProvider deviceClientAuthenticationProvider =\n                new DeviceClientAuthenticationProvider(registeredClientRepository);\n\n        // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n        http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n        http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n                // \u5f00\u542fOpenID Connect 1.0\u534f\u8bae\u76f8\u5173\u7aef\u70b9\n                .oidc(Customizer.withDefaults())\n                // \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7528\u6237\u786e\u8ba4\u6388\u6743\u9875\n                .authorizationEndpoint(authorizationEndpoint -> authorizationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI))\n                // \u8bbe\u7f6e\u8bbe\u5907\u7801\u7528\u6237\u9a8c\u8bc1url(\u81ea\u5b9a\u4e49\u7528\u6237\u9a8c\u8bc1\u9875)\n                .deviceAuthorizationEndpoint(deviceAuthorizationEndpoint ->\n                        deviceAuthorizationEndpoint.verificationUri("/activate")\n                )\n                // \u8bbe\u7f6e\u9a8c\u8bc1\u8bbe\u5907\u7801\u7528\u6237\u786e\u8ba4\u9875\u9762\n                .deviceVerificationEndpoint(deviceVerificationEndpoint ->\n                        deviceVerificationEndpoint.consentPage(CUSTOM_CONSENT_PAGE_URI)\n                )\n                .clientAuthentication(clientAuthentication ->\n                        // \u5ba2\u6237\u7aef\u8ba4\u8bc1\u6dfb\u52a0\u8bbe\u5907\u7801\u7684converter\u548cprovider\n                        clientAuthentication\n                                .authenticationConverter(deviceClientAuthenticationConverter)\n                                .authenticationProvider(deviceClientAuthenticationProvider)\n                );\n        http\n                // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n                .exceptionHandling((exceptions) -> exceptions\n                        .defaultAuthenticationEntryPointFor(\n                                new LoginTargetAuthenticationEntryPoint(LOGIN_URL),\n                                new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                        )\n                )\n                // \u5904\u7406\u4f7f\u7528access token\u8bbf\u95ee\u7528\u6237\u4fe1\u606f\u7aef\u70b9\u548c\u5ba2\u6237\u7aef\u6ce8\u518c\u7aef\u70b9\n                .oauth2ResourceServer((resourceServer) -> resourceServer\n                        .jwt(Customizer.withDefaults()));\n\n        // \u81ea\u5b9a\u4e49\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\u8f6c\u6362\u5668\n        SmsCaptchaGrantAuthenticationConverter converter = new SmsCaptchaGrantAuthenticationConverter();\n        // \u81ea\u5b9a\u4e49\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\u8ba4\u8bc1\u63d0\u4f9b\n        SmsCaptchaGrantAuthenticationProvider provider = new SmsCaptchaGrantAuthenticationProvider();\n        http.getConfigurer(OAuth2AuthorizationServerConfigurer.class)\n                // \u8ba9\u8ba4\u8bc1\u670d\u52a1\u5668\u5143\u6570\u636e\u4e2d\u6709\u81ea\u5b9a\u4e49\u7684\u8ba4\u8bc1\u65b9\u5f0f\n                .authorizationServerMetadataEndpoint(metadata -> metadata.authorizationServerMetadataCustomizer(customizer -> customizer.grantType(SecurityConstants.GRANT_TYPE_SMS_CODE)))\n                // \u6dfb\u52a0\u81ea\u5b9a\u4e49grant_type\u2014\u2014\u77ed\u4fe1\u8ba4\u8bc1\u767b\u5f55\n                .tokenEndpoint(tokenEndpoint -> tokenEndpoint\n                        .accessTokenRequestConverter(converter)\n                        .authenticationProvider(provider));\n\n        DefaultSecurityFilterChain build = http.build();\n\n        // \u4ece\u6846\u67b6\u4e2d\u83b7\u53d6provider\u4e2d\u6240\u9700\u7684bean\n        OAuth2TokenGenerator<?> tokenGenerator = http.getSharedObject(OAuth2TokenGenerator.class);\n        AuthenticationManager authenticationManager = http.getSharedObject(AuthenticationManager.class);\n        OAuth2AuthorizationService authorizationService = http.getSharedObject(OAuth2AuthorizationService.class);\n        // \u4ee5\u4e0a\u4e09\u4e2abean\u5728build()\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528\u662f\u56e0\u4e3a\u8c03\u7528build\u65b9\u6cd5\u65f6\u6846\u67b6\u4f1a\u5c1d\u8bd5\u83b7\u53d6\u8fd9\u4e9b\u7c7b\uff0c\n        // \u5982\u679c\u83b7\u53d6\u4e0d\u5230\u5219\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u653e\u5165SharedObject\u4e2d\uff0c\u6240\u4ee5\u8981\u5728build\u65b9\u6cd5\u8c03\u7528\u4e4b\u540e\u83b7\u53d6\n        // \u5728\u901a\u8fc7set\u65b9\u6cd5\u8bbe\u7f6e\u8fdbprovider\u4e2d\uff0c\u4f46\u662f\u5982\u679c\u5728build\u65b9\u6cd5\u4e4b\u540e\u8c03\u7528authenticationProvider(provider)\n        // \u6846\u67b6\u4f1a\u63d0\u793aunsupported_grant_type\uff0c\u56e0\u4e3a\u5df2\u7ecf\u521d\u59cb\u5316\u5b8c\u4e86\uff0c\u5728\u6dfb\u52a0\u5c31\u4e0d\u4f1a\u751f\u6548\u4e86\n        provider.setTokenGenerator(tokenGenerator);\n        provider.setAuthorizationService(authorizationService);\n        provider.setAuthenticationManager(authenticationManager);\n\n        return build;\n    }\n\n    /**\n     * \u914d\u7f6e\u8ba4\u8bc1\u76f8\u5173\u7684\u8fc7\u6ee4\u5668\u94fe\n     *\n     * @param http spring security\u6838\u5fc3\u914d\u7f6e\u7c7b\n     * @return \u8fc7\u6ee4\u5668\u94fe\n     * @throws Exception \u629b\u51fa\n     */\n    @Bean\n    public SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {\n        // \u6dfb\u52a0\u8de8\u57df\u8fc7\u6ee4\u5668\n        http.addFilter(corsFilter());\n        // \u7981\u7528 csrf \u4e0e cors\n        http.csrf(AbstractHttpConfigurer::disable);\n        http.cors(AbstractHttpConfigurer::disable);\n        http.authorizeHttpRequests((authorize) -> authorize\n                        // \u653e\u884c\u9759\u6001\u8d44\u6e90\n                        .requestMatchers("/assets/**", "/webjars/**", "/login", "/getCaptcha", "/getSmsCaptcha", "/error").permitAll()\n                        .anyRequest().authenticated()\n                )\n                // \u6307\u5b9a\u767b\u5f55\u9875\u9762\n                .formLogin(formLogin -> {\n                            formLogin.loginPage("/login");\n                            if (UrlUtils.isAbsoluteUrl(LOGIN_URL)) {\n                                // \u7edd\u5bf9\u8def\u5f84\u4ee3\u8868\u662f\u524d\u540e\u7aef\u5206\u79bb\uff0c\u767b\u5f55\u6210\u529f\u548c\u5931\u8d25\u6539\u4e3a\u5199\u56dejson\uff0c\u4e0d\u91cd\u5b9a\u5411\u4e86\n                                formLogin.successHandler(new LoginSuccessHandler());\n                                formLogin.failureHandler(new LoginFailureHandler());\n                            }\n                        }\n                );\n        // \u6dfb\u52a0BearerTokenAuthenticationFilter\uff0c\u5c06\u8ba4\u8bc1\u670d\u52a1\u5f53\u505a\u4e00\u4e2a\u8d44\u6e90\u670d\u52a1\uff0c\u89e3\u6790\u8bf7\u6c42\u5934\u4e2d\u7684token\n        http.oauth2ResourceServer((resourceServer) -> resourceServer\n                .jwt(Customizer.withDefaults())\n                .accessDeniedHandler(SecurityUtils::exceptionHandler)\n                .authenticationEntryPoint(SecurityUtils::exceptionHandler)\n        );\n        // \u517c\u5bb9\u524d\u540e\u7aef\u5206\u79bb\u4e0e\u4e0d\u5206\u79bb\u914d\u7f6e\n        if (UrlUtils.isAbsoluteUrl(LOGIN_URL)) {\n            http\n                    // \u5f53\u672a\u767b\u5f55\u65f6\u8bbf\u95ee\u8ba4\u8bc1\u7aef\u70b9\u65f6\u91cd\u5b9a\u5411\u81f3login\u9875\u9762\n                    .exceptionHandling((exceptions) -> exceptions\n                            .defaultAuthenticationEntryPointFor(\n                                    new LoginTargetAuthenticationEntryPoint(LOGIN_URL),\n                                    new MediaTypeRequestMatcher(MediaType.TEXT_HTML)\n                            )\n                    );\n        }\n        // \u8054\u5408\u767b\u5f55\u914d\u7f6e\n        http.oauth2Login(oauth2Login ->\n                oauth2Login\n                        .loginPage(LOGIN_URL)\n        );\n\n        // \u4f7f\u7528redis\u5b58\u50a8\u3001\u8bfb\u53d6\u767b\u5f55\u7684\u8ba4\u8bc1\u4fe1\u606f\n        http.securityContext(context -> context.securityContextRepository(redisSecurityContextRepository));\n\n        return http.build();\n    }\n\n    /**\n     * \u8de8\u57df\u8fc7\u6ee4\u5668\u914d\u7f6e\n     *\n     * @return CorsFilter\n     */\n    @Bean\n    public CorsFilter corsFilter() {\n\n        // \u521d\u59cb\u5316cors\u914d\u7f6e\u5bf9\u8c61\n        CorsConfiguration configuration = new CorsConfiguration();\n\n        // \u8bbe\u7f6e\u5141\u8bb8\u8de8\u57df\u7684\u57df\u540d,\u5982\u679c\u5141\u8bb8\u643a\u5e26cookie\u7684\u8bdd,\u8def\u5f84\u5c31\u4e0d\u80fd\u5199*\u53f7, *\u8868\u793a\u6240\u6709\u7684\u57df\u540d\u90fd\u53ef\u4ee5\u8de8\u57df\u8bbf\u95ee\n        configuration.addAllowedOrigin("http://127.0.0.1:5173");\n        // \u8bbe\u7f6e\u8de8\u57df\u8bbf\u95ee\u53ef\u4ee5\u643a\u5e26cookie\n        configuration.setAllowCredentials(true);\n        // \u5141\u8bb8\u6240\u6709\u7684\u8bf7\u6c42\u65b9\u6cd5 ==> GET POST PUT Delete\n        configuration.addAllowedMethod("*");\n        // \u5141\u8bb8\u643a\u5e26\u4efb\u4f55\u5934\u4fe1\u606f\n        configuration.addAllowedHeader("*");\n\n        // \u521d\u59cb\u5316cors\u914d\u7f6e\u6e90\u5bf9\u8c61\n        UrlBasedCorsConfigurationSource configurationSource = new UrlBasedCorsConfigurationSource();\n\n        // \u7ed9\u914d\u7f6e\u6e90\u5bf9\u8c61\u8bbe\u7f6e\u8fc7\u6ee4\u7684\u53c2\u6570\n        // \u53c2\u6570\u4e00: \u8fc7\u6ee4\u7684\u8def\u5f84 == > \u6240\u6709\u7684\u8def\u5f84\u90fd\u8981\u6c42\u6821\u9a8c\u662f\u5426\u8de8\u57df\n        // \u53c2\u6570\u4e8c: \u914d\u7f6e\u7c7b\n        configurationSource.registerCorsConfiguration("/**", configuration);\n\n        // \u8fd4\u56de\u914d\u7f6e\u597d\u7684\u8fc7\u6ee4\u5668\n        return new CorsFilter(configurationSource);\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49jwt\uff0c\u5c06\u6743\u9650\u4fe1\u606f\u653e\u81f3jwt\u4e2d\n     *\n     * @return OAuth2TokenCustomizer\u7684\u5b9e\u4f8b\n     */\n    @Bean\n    public OAuth2TokenCustomizer<JwtEncodingContext> oAuth2TokenCustomizer() {\n        return new FederatedIdentityIdTokenCustomizer();\n    }\n\n    /**\n     * \u81ea\u5b9a\u4e49jwt\u89e3\u6790\u5668\uff0c\u8bbe\u7f6e\u89e3\u6790\u51fa\u6765\u7684\u6743\u9650\u4fe1\u606f\u7684\u524d\u7f00\u4e0e\u5728jwt\u4e2d\u7684key\n     *\n     * @return jwt\u89e3\u6790\u5668 JwtAuthenticationConverter\n     */\n    @Bean\n    public JwtAuthenticationConverter jwtAuthenticationConverter() {\n        JwtGrantedAuthoritiesConverter grantedAuthoritiesConverter = new JwtGrantedAuthoritiesConverter();\n        // \u8bbe\u7f6e\u89e3\u6790\u6743\u9650\u4fe1\u606f\u7684\u524d\u7f00\uff0c\u8bbe\u7f6e\u4e3a\u7a7a\u662f\u53bb\u6389\u524d\u7f00\n        grantedAuthoritiesConverter.setAuthorityPrefix("");\n        // \u8bbe\u7f6e\u6743\u9650\u4fe1\u606f\u5728jwt claims\u4e2d\u7684key\n        grantedAuthoritiesConverter.setAuthoritiesClaimName(SecurityConstants.AUTHORITIES_KEY);\n\n        JwtAuthenticationConverter jwtAuthenticationConverter = new JwtAuthenticationConverter();\n        jwtAuthenticationConverter.setJwtGrantedAuthoritiesConverter(grantedAuthoritiesConverter);\n        return jwtAuthenticationConverter;\n    }\n\n\n    /**\n     * \u5c06AuthenticationManager\u6ce8\u5165ioc\u4e2d\uff0c\u5176\u5b83\u9700\u8981\u4f7f\u7528\u5730\u65b9\u53ef\u4ee5\u76f4\u63a5\u4eceioc\u4e2d\u83b7\u53d6\n     *\n     * @param authenticationConfiguration \u5bfc\u51fa\u8ba4\u8bc1\u914d\u7f6e\n     * @return AuthenticationManager \u8ba4\u8bc1\u7ba1\u7406\u5668\n     */\n    @Bean\n    @SneakyThrows\n    public AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) {\n        return authenticationConfiguration.getAuthenticationManager();\n    }\n\n    /**\n     * \u914d\u7f6e\u5bc6\u7801\u89e3\u6790\u5668\uff0c\u4f7f\u7528BCrypt\u7684\u65b9\u5f0f\u5bf9\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u548c\u9a8c\u8bc1\n     *\n     * @return BCryptPasswordEncoder\n     */\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n\n    /**\n     * \u914d\u7f6e\u5ba2\u6237\u7aefRepository\n     *\n     * @param jdbcTemplate    db \u6570\u636e\u6e90\u4fe1\u606f\n     * @param passwordEncoder \u5bc6\u7801\u89e3\u6790\u5668\n     * @return \u57fa\u4e8e\u6570\u636e\u5e93\u7684repository\n     */\n    @Bean\n    public RegisteredClientRepository registeredClientRepository(JdbcTemplate jdbcTemplate, PasswordEncoder passwordEncoder) {\n        RegisteredClient registeredClient = RegisteredClient.withId(UUID.randomUUID().toString())\n                // \u5ba2\u6237\u7aefid\n                .clientId("messaging-client")\n                // \u5ba2\u6237\u7aef\u79d8\u94a5\uff0c\u4f7f\u7528\u5bc6\u7801\u89e3\u6790\u5668\u52a0\u5bc6\n                .clientSecret(passwordEncoder.encode("123456"))\n                // \u5ba2\u6237\u7aef\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u57fa\u4e8e\u8bf7\u6c42\u5934\u7684\u8ba4\u8bc1\n                .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC)\n                // \u914d\u7f6e\u8d44\u6e90\u670d\u52a1\u5668\u4f7f\u7528\u8be5\u5ba2\u6237\u7aef\u83b7\u53d6\u6388\u6743\u65f6\u652f\u6301\u7684\u65b9\u5f0f\n                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\n                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)\n                .authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS)\n                // \u5ba2\u6237\u7aef\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8ba4\u8bc1\n                .authorizationGrantType(new AuthorizationGrantType(SecurityConstants.GRANT_TYPE_SMS_CODE))\n                // \u6388\u6743\u7801\u6a21\u5f0f\u56de\u8c03\u5730\u5740\uff0coauth2.1\u5df2\u6539\u4e3a\u7cbe\u51c6\u5339\u914d\uff0c\u4e0d\u80fd\u53ea\u8bbe\u7f6e\u57df\u540d\uff0c\u5e76\u4e14\u5c4f\u853d\u4e86localhost\uff0c\u672c\u673a\u4f7f\u7528127.0.0.1\u8bbf\u95ee\n                .redirectUri("http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc")\n                .redirectUri("https://www.baidu.com")\n                // \u8be5\u5ba2\u6237\u7aef\u7684\u6388\u6743\u8303\u56f4\uff0cOPENID\u4e0ePROFILE\u662fIdToken\u7684scope\uff0c\u83b7\u53d6\u6388\u6743\u65f6\u8bf7\u6c42OPENID\u7684scope\u65f6\u8ba4\u8bc1\u670d\u52a1\u4f1a\u8fd4\u56deIdToken\n                .scope(OidcScopes.OPENID)\n                .scope(OidcScopes.PROFILE)\n                // \u81ea\u5b9ascope\n                .scope("message.read")\n                .scope("message.write")\n                // \u5ba2\u6237\u7aef\u8bbe\u7f6e\uff0c\u8bbe\u7f6e\u7528\u6237\u9700\u8981\u786e\u8ba4\u6388\u6743\n                .clientSettings(ClientSettings.builder().requireAuthorizationConsent(true).build())\n                .build();\n\n        // \u57fa\u4e8edb\u5b58\u50a8\u5ba2\u6237\u7aef\uff0c\u8fd8\u6709\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u5b9e\u73b0 InMemoryRegisteredClientRepository\n        JdbcRegisteredClientRepository registeredClientRepository = new JdbcRegisteredClientRepository(jdbcTemplate);\n\n        // \u521d\u59cb\u5316\u5ba2\u6237\u7aef\n        RegisteredClient repositoryByClientId = registeredClientRepository.findByClientId(registeredClient.getClientId());\n        if (repositoryByClientId == null) {\n            registeredClientRepository.save(registeredClient);\n        }\n        // \u8bbe\u5907\u7801\u6388\u6743\u5ba2\u6237\u7aef\n        RegisteredClient deviceClient = RegisteredClient.withId(UUID.randomUUID().toString())\n                .clientId("device-message-client")\n                // \u516c\u5171\u5ba2\u6237\u7aef\n                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)\n                // \u8bbe\u5907\u7801\u6388\u6743\n                .authorizationGrantType(AuthorizationGrantType.DEVICE_CODE)\n                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)\n                // \u81ea\u5b9ascope\n                .scope("message.read")\n                .scope("message.write")\n                .build();\n        RegisteredClient byClientId = registeredClientRepository.findByClientId(deviceClient.getClientId());\n        if (byClientId == null) {\n            registeredClientRepository.save(deviceClient);\n        }\n\n        // PKCE\u5ba2\u6237\u7aef\n        RegisteredClient pkceClient = RegisteredClient.withId(UUID.randomUUID().toString())\n                .clientId("pkce-message-client")\n                // \u516c\u5171\u5ba2\u6237\u7aef\n                .clientAuthenticationMethod(ClientAuthenticationMethod.NONE)\n                // \u6388\u6743\u7801\u6a21\u5f0f\uff0c\u56e0\u4e3a\u662f\u6269\u5c55\u6388\u6743\u7801\u6d41\u7a0b\uff0c\u6240\u4ee5\u6d41\u7a0b\u8fd8\u662f\u6388\u6743\u7801\u7684\u6d41\u7a0b\uff0c\u6539\u53d8\u7684\u53ea\u662f\u53c2\u6570\n                .authorizationGrantType(AuthorizationGrantType.AUTHORIZATION_CODE)\n                .authorizationGrantType(AuthorizationGrantType.REFRESH_TOKEN)\n                // \u6388\u6743\u7801\u6a21\u5f0f\u56de\u8c03\u5730\u5740\uff0coauth2.1\u5df2\u6539\u4e3a\u7cbe\u51c6\u5339\u914d\uff0c\u4e0d\u80fd\u53ea\u8bbe\u7f6e\u57df\u540d\uff0c\u5e76\u4e14\u5c4f\u853d\u4e86localhost\uff0c\u672c\u673a\u4f7f\u7528127.0.0.1\u8bbf\u95ee\n                .redirectUri("http://127.0.0.1:8080/login/oauth2/code/messaging-client-oidc")\n                .clientSettings(ClientSettings.builder().requireProofKey(Boolean.TRUE).build())\n                // \u81ea\u5b9ascope\n                .scope("message.read")\n                .scope("message.write")\n                .build();\n        RegisteredClient findPkceClient = registeredClientRepository.findByClientId(pkceClient.getClientId());\n        if (findPkceClient == null) {\n            registeredClientRepository.save(pkceClient);\n        }\n        return registeredClientRepository;\n    }\n\n    /**\n     * \u914d\u7f6e\u57fa\u4e8edb\u7684oauth2\u7684\u6388\u6743\u7ba1\u7406\u670d\u52a1\n     *\n     * @param jdbcTemplate               db\u6570\u636e\u6e90\u4fe1\u606f\n     * @param registeredClientRepository \u4e0a\u8fb9\u6ce8\u5165\u7684\u5ba2\u6237\u7aefrepository\n     * @return JdbcOAuth2AuthorizationService\n     */\n    @Bean\n    public OAuth2AuthorizationService authorizationService(JdbcTemplate jdbcTemplate, RegisteredClientRepository registeredClientRepository) {\n        // \u57fa\u4e8edb\u7684oauth2\u8ba4\u8bc1\u670d\u52a1\uff0c\u8fd8\u6709\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u670d\u52a1\u5b9e\u73b0InMemoryOAuth2AuthorizationService\n        return new JdbcOAuth2AuthorizationService(jdbcTemplate, registeredClientRepository);\n    }\n\n    /**\n     * \u914d\u7f6e\u57fa\u4e8edb\u7684\u6388\u6743\u786e\u8ba4\u7ba1\u7406\u670d\u52a1\n     *\n     * @param jdbcTemplate               db\u6570\u636e\u6e90\u4fe1\u606f\n     * @param registeredClientRepository \u5ba2\u6237\u7aefrepository\n     * @return JdbcOAuth2AuthorizationConsentService\n     */\n    @Bean\n    public OAuth2AuthorizationConsentService authorizationConsentService(JdbcTemplate jdbcTemplate, RegisteredClientRepository registeredClientRepository) {\n        // \u57fa\u4e8edb\u7684\u6388\u6743\u786e\u8ba4\u7ba1\u7406\u670d\u52a1\uff0c\u8fd8\u6709\u4e00\u4e2a\u57fa\u4e8e\u5185\u5b58\u7684\u670d\u52a1\u5b9e\u73b0InMemoryOAuth2AuthorizationConsentService\n        return new JdbcOAuth2AuthorizationConsentService(jdbcTemplate, registeredClientRepository);\n    }\n\n    /**\n     * \u914d\u7f6ejwk\u6e90\uff0c\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\uff0c\u516c\u5f00\u7528\u4e8e\u68c0\u7d22\u5339\u914d\u6307\u5b9a\u9009\u62e9\u5668\u7684JWK\u7684\u65b9\u6cd5\n     *\n     * @return JWKSource\n     */\n    @Bean\n    @SneakyThrows\n    public JWKSource<SecurityContext> jwkSource() {\n        // \u5148\u4eceredis\u83b7\u53d6\n        String jwkSetCache = redisOperator.get(RedisConstants.AUTHORIZATION_JWS_PREFIX_KEY);\n        if (ObjectUtils.isEmpty(jwkSetCache)) {\n            KeyPair keyPair = generateRsaKey();\n            RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic();\n            RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate();\n            RSAKey rsaKey = new RSAKey.Builder(publicKey)\n                    .privateKey(privateKey)\n                    .keyID(UUID.randomUUID().toString())\n                    .build();\n            // \u751f\u6210jws\n            JWKSet jwkSet = new JWKSet(rsaKey);\n            // \u8f6c\u4e3ajson\u5b57\u7b26\u4e32\n            String jwkSetString = jwkSet.toString(Boolean.FALSE);\n            // \u5b58\u5165redis\n            redisOperator.set(RedisConstants.AUTHORIZATION_JWS_PREFIX_KEY, jwkSetString);\n            return new ImmutableJWKSet<>(jwkSet);\n        }\n        // \u89e3\u6790\u5b58\u50a8\u7684jws\n        JWKSet jwkSet = JWKSet.parse(jwkSetCache);\n        return new ImmutableJWKSet<>(jwkSet);\n    }\n\n    /**\n     * \u751f\u6210rsa\u5bc6\u94a5\u5bf9\uff0c\u63d0\u4f9b\u7ed9jwk\n     *\n     * @return \u5bc6\u94a5\u5bf9\n     */\n    private static KeyPair generateRsaKey() {\n        KeyPair keyPair;\n        try {\n            KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance("RSA");\n            keyPairGenerator.initialize(2048);\n            keyPair = keyPairGenerator.generateKeyPair();\n        } catch (Exception ex) {\n            throw new IllegalStateException(ex);\n        }\n        return keyPair;\n    }\n\n    /**\n     * \u914d\u7f6ejwt\u89e3\u6790\u5668\n     *\n     * @param jwkSource jwk\u6e90\n     * @return JwtDecoder\n     */\n    @Bean\n    public JwtDecoder jwtDecoder(JWKSource<SecurityContext> jwkSource) {\n        return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource);\n    }\n\n    /**\n     * \u6dfb\u52a0\u8ba4\u8bc1\u670d\u52a1\u5668\u914d\u7f6e\uff0c\u8bbe\u7f6ejwt\u7b7e\u53d1\u8005\u3001\u9ed8\u8ba4\u7aef\u70b9\u8bf7\u6c42\u5730\u5740\u7b49\n     *\n     * @return AuthorizationServerSettings\n     */\n    @Bean\n    public AuthorizationServerSettings authorizationServerSettings() {\n        return AuthorizationServerSettings.builder()\n                /*\n                    \u8bbe\u7f6etoken\u7b7e\u53d1\u5730\u5740(http(s)://{ip}:{port}/context-path, http(s)://domain.com/context-path)\n                    \u5982\u679c\u9700\u8981\u901a\u8fc7ip\u8bbf\u95ee\u8fd9\u91cc\u5c31\u662fip\uff0c\u5982\u679c\u662f\u6709\u57df\u540d\u6620\u5c04\u5c31\u586b\u57df\u540d\uff0c\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u8bbf\u95ee\u8be5\u670d\u52a1\u8fd9\u91cc\u5c31\u586b\u4ec0\u4e48\n                 */\n                .issuer("http://192.168.1.102:8080")\n                .build();\n    }\n\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"6-\u767b\u5f55\u9875\u9762\u6dfb\u52a0\u4e09\u65b9\u767b\u5f55\u5165\u53e3",children:"6. \u767b\u5f55\u9875\u9762\u6dfb\u52a0\u4e09\u65b9\u767b\u5f55\u5165\u53e3"}),"\n",(0,r.jsxs)(t.p,{children:["\u9875\u9762\u65e0\u6240\u8c13\uff0c\u4f46\u662f\u4e00\u5b9a\u8981\u8df3\u8f6c\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684",(0,r.jsx)(t.code,{children:"/oauth2/authorization/{RegistrationId}"}),"\uff0c\u5b83\u4f1a\u81ea\u52a8\u5f15\u5bfc\u8bf7\u6c42\u81f3\u4e09\u65b9\u767b\u5f55\u7684\u7533\u8bf7\u6388\u6743\u63a5\u53e3"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:'<div class="third-box">\n    <a href="/oauth2/authorization/gitee" title="Gitee\u767b\u5f55">\n        <svg width="32" height="32" xmlns="http://www.w3.org/2000/svg" name="zi_tmGitee"\n             viewBox="0 0 2000 2000">\n            <path fill="red"\n                  d="M898 1992q183 0 344-69.5t283-191.5q122-122 191.5-283t69.5-344q0-183-69.5-344T1525 477q-122-122-283-191.5T898 216q-184 0-345 69.5T270 477Q148 599 78.5 760T9 1104q0 183 69.5 344T270 1731q122 122 283 191.5t345 69.5zm199-400H448q-17 0-30.5-14t-13.5-30V932q0-89 43.5-163.5T565 649q74-45 166-45h616q17 0 30.5 14t13.5 31v111q0 16-13.5 30t-30.5 14H731q-54 0-93.5 39.5T598 937v422q0 17 14 30.5t30 13.5h416q55 0 94.5-39.5t39.5-93.5v-22q0-17-14-30.5t-31-13.5H842q-17 0-30.5-14t-13.5-31v-111q0-16 13.5-30t30.5-14h505q17 0 30.5 14t13.5 30v250q0 121-86.5 207.5T1097 1592z"/>\n        </svg>\n    </a>\n    \n    <a href="/oauth2/authorization/github" title="GitHub\u767b\u5f55">\n        <img width="36" style="margin-right: 5px;" alt="Sign in with GitHub"\n             src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png"/>\n    </a>\n</div>\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u6539\u9020\u8ba4\u8bc1\u670d\u52a1\u4e4b\u524d\u7f16\u5199\u7684\u7528\u6237\u4fe1\u606f\u63a5\u53e3\uff0c\u9002\u914d\u4e09\u65b9\u7528\u6237"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",children:'@ResponseBody\n@GetMapping("/user")\npublic Oauth2UserinfoResult user(Principal principal) {\n    Oauth2UserinfoResult result = new Oauth2UserinfoResult();\n    if (!(principal instanceof JwtAuthenticationToken jwtAuthenticationToken)) {\n        return result;\n    }\n    // \u83b7\u53d6jwt\u89e3\u6790\u5185\u5bb9\n    Jwt token = jwtAuthenticationToken.getToken();\n    // \u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u8d26\u53f7\n    String account = token.getClaim(JwtClaimNames.SUB);\n    // \u83b7\u53d6scope\n    List<String> scopes = token.getClaimAsStringList("scope");\n    List<String> claimAsStringList = token.getClaimAsStringList(SecurityConstants.AUTHORITIES_KEY);\n    if (!ObjectUtils.isEmpty(claimAsStringList)) {\n        scopes = null;\n    }\n    LambdaQueryWrapper<Oauth2BasicUser> accountWrapper = Wrappers.lambdaQuery(Oauth2BasicUser.class)\n            .eq(Oauth2BasicUser::getAccount, account);\n    Oauth2BasicUser basicUser = basicUserService.getOne(accountWrapper);\n    if (basicUser != null) {\n        // \u586b\u5145\u7528\u6237\u7684\u6743\u9650\u4fe1\u606f\n        this.fillUserAuthority(claimAsStringList, basicUser, scopes);\n        BeanUtils.copyProperties(basicUser, result);\n        // \u6839\u636e\u7528\u6237\u4fe1\u606f\u67e5\u8be2\u4e09\u65b9\u767b\u5f55\u4fe1\u606f\n        LambdaQueryWrapper<Oauth2ThirdAccount> userIdWrapper =\n                Wrappers.lambdaQuery(Oauth2ThirdAccount.class)\n                        .eq(Oauth2ThirdAccount::getUserId, basicUser.getId());\n        Oauth2ThirdAccount oauth2ThirdAccount = thirdAccountService.getOne(userIdWrapper);\n        if (oauth2ThirdAccount == null) {\n            return result;\n        }\n        result.setCredentials(oauth2ThirdAccount.getCredentials());\n        result.setThirdUsername(oauth2ThirdAccount.getThirdUsername());\n        result.setCredentialsExpiresAt(oauth2ThirdAccount.getCredentialsExpiresAt());\n        return result;\n    }\n    // \u6839\u636e\u5f53\u524dsub\u53bb\u4e09\u65b9\u767b\u5f55\u8868\u53bb\u67e5\n    LambdaQueryWrapper<Oauth2ThirdAccount> wrapper = Wrappers.lambdaQuery(Oauth2ThirdAccount.class)\n            .eq(Oauth2ThirdAccount::getUniqueId, account)\n            .eq(Oauth2ThirdAccount::getType, token.getClaim("loginType"));\n    Oauth2ThirdAccount oauth2ThirdAccount = thirdAccountService.getOne(wrapper);\n    if (oauth2ThirdAccount == null) {\n        return result;\n    }\n    // \u67e5\u5230\u4e4b\u540e\u53cd\u67e5\u57fa\u7840\u7528\u6237\u8868\n    Oauth2BasicUser oauth2BasicUser = basicUserService.getById(oauth2ThirdAccount.getUserId());\n    BeanUtils.copyProperties(oauth2BasicUser, result);\n    // \u586b\u5145\u7528\u6237\u7684\u6743\u9650\u4fe1\u606f\n    this.fillUserAuthority(claimAsStringList, oauth2BasicUser, scopes);\n    // \u590d\u5236\u57fa\u7840\u7528\u6237\u4fe1\u606f\n    BeanUtils.copyProperties(oauth2BasicUser, result);\n    // \u8bbe\u7f6e\u4e09\u65b9\u7528\u6237\u4fe1\u606f\n    result.setLocation(oauth2ThirdAccount.getLocation());\n    result.setCredentials(oauth2ThirdAccount.getCredentials());\n    result.setThirdUsername(oauth2ThirdAccount.getThirdUsername());\n    result.setCredentialsExpiresAt(oauth2ThirdAccount.getCredentialsExpiresAt());\n    return result;\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"\u4e09\u6d4b\u8bd5",children:"\u4e09\u3001\u6d4b\u8bd5"}),"\n",(0,r.jsx)(t.h3,{id:"1-gitee",children:"1. Gitee"}),"\n",(0,r.jsx)(t.h4,{id:"1-\u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3",children:"1. \u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"http://192.168.1.102:8080/oauth2/authorize?client_id=messaging-client&response_type=code&scope=message.read&redirect_uri=http://127.0.0.1:8000/login/oauth2/code/messaging-client-oidc\n"})}),"\n",(0,r.jsx)(t.h4,{id:"2-\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762",children:"2. \u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(36701).Z+"",width:"1512",height:"760"})}),"\n",(0,r.jsx)(t.h4,{id:"3-\u9009\u62e9gitee\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55",children:"3. \u9009\u62e9Gitee\u4e09\u65b9\u767b\u5f55\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55"}),"\n",(0,r.jsx)(t.p,{children:"\u91cd\u5b9a\u5411\u5230Gitee\u7684\u767b\u5f55\u9875\u9762(\u5982\u679c\u6ca1\u6709\u767b\u5f55)"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(10468).Z+"",width:"1512",height:"743"})}),"\n",(0,r.jsx)(t.h4,{id:"4-\u767b\u5f55\u4e4b\u540e\u63d0\u4ea4\u4f1a\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762",children:"4. \u767b\u5f55\u4e4b\u540e\u63d0\u4ea4\u4f1a\u91cd\u5b9a\u5411\u81f3\u6388\u6743\u786e\u8ba4\u9875\u9762"}),"\n",(0,r.jsxs)(t.p,{children:["\u524d\u63d0\u662f\u4e09\u65b9\u5e94\u7528\u7684\u56de\u8c03\u5730\u5740\u8981\u914d\u7f6e\u4e3a\u8ba4\u8bc1\u670d\u52a1\u7684",(0,r.jsx)(t.code,{children:"/login/oauth2/code/{RegistionId}"}),"\uff0c\u8fd9\u91cc\u7684",(0,r.jsx)(t.code,{children:"RegistionId"}),"\u8981\u8ddfyml\u4e2d\u914d\u7f6e\u7684id\u8981\u4e00\u81f4"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(36034).Z+"",width:"1512",height:"742"})}),"\n",(0,r.jsx)(t.h4,{id:"5-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u6388\u6743\u786e\u8ba4\u9875\u9762",children:"5. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u6388\u6743\u786e\u8ba4\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(75850).Z+"",width:"1512",height:"778"})}),"\n",(0,r.jsxs)(t.h4,{id:"6-\u786e\u8ba4\u6388\u6743\u4ee5\u540e\u643a\u5e26code\u8df3\u8f6c\u81f3\u8bf7\u6c42\u6388\u6743\u65f6\u643a\u5e26\u7684redirect_uri\u5730\u5740",children:["6. \u786e\u8ba4\u6388\u6743\u4ee5\u540e\u643a\u5e26code\u8df3\u8f6c\u81f3\u8bf7\u6c42\u6388\u6743\u65f6\u643a\u5e26\u7684",(0,r.jsx)(t.code,{children:"redirect_uri"}),"\u5730\u5740"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(36113).Z+"",width:"1512",height:"141"})}),"\n",(0,r.jsxs)(t.h4,{id:"7-\u4f7f\u7528postman\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528code\u6362\u53d6access-token",children:["7. \u4f7f\u7528POSTMAN\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528",(0,r.jsx)(t.code,{children:"code"}),"\u6362\u53d6",(0,r.jsx)(t.code,{children:"access token"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(8979).Z+"",width:"1387",height:"761"})}),"\n",(0,r.jsxs)(t.h4,{id:"8-\u89e3\u6790access-token\u67e5\u770b\u81ea\u5b9a\u4e49\u5185\u5bb9\u662f\u5426\u751f\u6548",children:["8. \u89e3\u6790",(0,r.jsx)(t.code,{children:"access token"}),"\uff0c\u67e5\u770b\u81ea\u5b9a\u4e49\u5185\u5bb9\u662f\u5426\u751f\u6548"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(59671).Z+"",width:"1479",height:"781"})}),"\n",(0,r.jsxs)(t.p,{children:["\u901a\u8fc7\u622a\u56fe\u53ef\u4ee5\u770b\u51fa\u8bbe\u7f6e\u7684",(0,r.jsx)(t.code,{children:"loginType"}),"\u5df2\u7ecf\u6210\u529f\u8bbe\u7f6e\u4e86\uff0c\u4f46\u662f\u56e0\u4e3a\u4e0d\u662f",(0,r.jsx)(t.code,{children:"openid connect"}),"\u767b\u5f55\uff0c\u6240\u4ee5\u6ca1\u6709\u8fd4\u56de",(0,r.jsx)(t.code,{children:"idToken"}),"\uff0c\u8fd9\u91cc\u4e5f\u65e0\u6cd5\u770b\u51fa\u662f\u5426\u5c06\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u653e\u5165\u4e86",(0,r.jsx)(t.code,{children:"IDToken"}),"\u4e2d"]}),"\n",(0,r.jsx)(t.h3,{id:"2-github",children:"2. Github"}),"\n",(0,r.jsx)(t.h4,{id:"1-\u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3-1",children:"1. \u8bbf\u95ee\u7533\u8bf7\u6388\u6743\u63a5\u53e3"}),"\n",(0,r.jsx)(t.p,{children:"\u8bbf\u95ee\u65f6\u8bb0\u5f97\u91cd\u542f\u8ba4\u8bc1\u670d\u52a1\u6e05\u7406\u4e00\u4e0b\u8ba4\u8bc1\u4fe1\u606f\uff0c\u5e76\u4e14\u8bb0\u5f97scope\u4e2d\u8981\u5305\u542bopenid"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"http://192.168.1.102:8080/oauth2/authorize?client_id=messaging-client&response_type=code&scope=message.read%20openid&redirect_uri=http://127.0.0.1:8000/login/oauth2/code/messaging-client-oidc\n"})}),"\n",(0,r.jsx)(t.h4,{id:"2-\u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762-1",children:"2. \u91cd\u5b9a\u5411\u81f3\u767b\u5f55\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:"\u56fe\u7565"}),"\n",(0,r.jsx)(t.h4,{id:"3-\u9009\u62e9\u4e09\u65b9\u767b\u5f55\u4e2d\u7684github\u767b\u5f55",children:"3. \u9009\u62e9\u4e09\u65b9\u767b\u5f55\u4e2d\u7684Github\u767b\u5f55"}),"\n",(0,r.jsx)(t.h4,{id:"4-\u91cd\u5b9a\u5411\u81f3github\u767b\u5f55\u5982\u679c\u672a\u767b\u5f55",children:"4. \u91cd\u5b9a\u5411\u81f3Github\u767b\u5f55(\u5982\u679c\u672a\u767b\u5f55)"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(946).Z+"",width:"1512",height:"773"})}),"\n",(0,r.jsx)(t.p,{children:"(\u8fd9\u4e00\u6b65\u5f88\u6709\u53ef\u80fd\u4f1a\u663e\u793a\u65e0\u6cd5\u8bbf\u95ee\uff0c\u539f\u56e0\u61c2\u5f97\u90fd\u61c2)"}),"\n",(0,r.jsx)(t.h4,{id:"5-\u63d0\u4ea4\u767b\u5f55\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3github\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",children:"5. \u63d0\u4ea4\u767b\u5f55\u4ee5\u540e\u91cd\u5b9a\u5411\u81f3Github\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:"(\u6211\u4e4b\u524d\u786e\u8ba4\u8fc7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u518d\u786e\u8ba4\u4e86)"}),"\n",(0,r.jsx)(t.h4,{id:"6-\u786e\u8ba4\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762",children:"6. \u786e\u8ba4\u540e\u91cd\u5b9a\u5411\u81f3\u8ba4\u8bc1\u670d\u52a1\u7684\u6388\u6743\u786e\u8ba4\u9875\u9762"}),"\n",(0,r.jsx)(t.p,{children:"\u56fe\u7565"}),"\n",(0,r.jsx)(t.h4,{id:"7-\u6388\u6743\u786e\u8ba4\u4ee5\u540e\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u56de\u8c03\u5730\u5740",children:"7. \u6388\u6743\u786e\u8ba4\u4ee5\u540e\u643a\u5e26code\u91cd\u5b9a\u5411\u81f3\u56de\u8c03\u5730\u5740"}),"\n",(0,r.jsx)(t.p,{children:"\u56fe\u7565"}),"\n",(0,r.jsxs)(t.h4,{id:"8-\u4f7f\u7528postman\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528code\u6362\u53d6access-token",children:["8. \u4f7f\u7528POSTMAN\u6a21\u62df\u5ba2\u6237\u7aef\u4f7f\u7528code\u6362\u53d6",(0,r.jsx)(t.code,{children:"access token"})]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(47370).Z+"",width:"1391",height:"775"})}),"\n",(0,r.jsxs)(t.p,{children:["\u53ef\u4ee5\u770b\u5230\u54cd\u5e94\u4e86",(0,r.jsx)(t.code,{children:"idToken"}),"\uff0c\u5e76\u4e14",(0,r.jsx)(t.code,{children:"idToken"}),"\u5de8\u957f\uff0c\u89e3\u6790\u4e00\u4e0b\u770b\u770bjwt\u4e2d\u7684\u5185\u5bb9"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(35474).Z+"",width:"1512",height:"1625"})}),"\n",(0,r.jsxs)(t.p,{children:["\u89e3\u6790\u540e\u53d1\u73b0Github\u8fd4\u56de\u7684\u7528\u6237\u4fe1\u606f\u5f88\u5168\uff0c\u90fd\u53ef\u4ee5\u5728\u91cc\u8fb9\u627e\u5230\uff0c\u8fd9\u4e5f\u662f",(0,r.jsx)(t.code,{children:"idToken"}),"\u7684\u4f5c\u7528\uff0c\u4e0d\u7528\u8bbf\u95ee\u670d\u52a1\u5668\u901a\u8fc7\u89e3\u6790token\u7684\u65b9\u5f0f\u83b7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u51cf\u5c11\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7684\u4ea4\u4e92\u6b21\u6570\u3002"]}),"\n",(0,r.jsx)(t.h4,{id:"9-\u5237\u65b0token",children:"9. \u5237\u65b0token"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(32468).Z+"",width:"1396",height:"780"})}),"\n",(0,r.jsxs)(t.h4,{id:"10-\u4f7f\u7528access-token\u83b7\u53d6\u4e00\u4e0b\u7528\u6237\u4fe1\u606f\u770b\u4e0b",children:["10. \u4f7f\u7528",(0,r.jsx)(t.code,{children:"access token"}),"\u83b7\u53d6\u4e00\u4e0b\u7528\u6237\u4fe1\u606f\u770b\u4e0b"]}),"\n",(0,r.jsxs)(t.p,{children:["\u8fd9\u91cc\u5c06\u4e09\u65b9\u767b\u5f55\u83b7\u53d6\u7684",(0,r.jsx)(t.code,{children:"token"}),"\u4e5f\u8fd4\u56de\u4e86\uff0c\u6839\u636e\u5b9e\u9645\u9700\u8981\u51b3\u5b9a\u662f\u5426\u8fd4\u56de"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(84892).Z+"",width:"1393",height:"782"})}),"\n",(0,r.jsx)(t.h4,{id:"11-\u67e5\u770b\u6570\u636e\u5e93\u7684\u7528\u6237\u4fe1\u606f",children:"11. \u67e5\u770b\u6570\u636e\u5e93\u7684\u7528\u6237\u4fe1\u606f"}),"\n",(0,r.jsx)(t.p,{children:"\u57fa\u7840\u7528\u6237\u4fe1\u606f\u8868(\u7b2c\u4e00\u4e2a\u4e91\u9038\u662f\u624b\u52a8\u6dfb\u52a0\u7684\uff0c\u5269\u4e0b\u4e24\u4e2a\u662f\u56e0\u4e3aGitee\u548cGithub\u90fd\u662f\u8fd9\u4e2a\u6635\u79f0)"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(35611).Z+"",width:"1420",height:"173"})}),"\n",(0,r.jsx)(t.p,{children:"\u4e09\u65b9\u7528\u6237\u4fe1\u606f\u8868"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(76585).Z+"",width:"1410",height:"153"})}),"\n",(0,r.jsx)(t.h2,{id:"\u56db\u5199\u5728\u6700\u540e",children:"\u56db\u3001\u5199\u5728\u6700\u540e"}),"\n",(0,r.jsxs)(t.p,{children:["\u8fd9\u6b21\u662f\u5148\u5b8c\u6210\u7684\u4ee3\u7801\u3001\u540e\u5199\u7684\u6587\u7ae0\uff0c\u5199\u7684\u4e5f\u6bd4\u8f83\u4e71\uff0c\u5982\u679c\u6709\u7f3a\u5c11\u4ee3\u7801\u6216\u8005\u54ea\u91cc\u6ca1\u5199\u6e05\u695a\u5927\u5bb6\u53ef\u4ee5\u5728\u8bc4\u8bba\u533a\u4e2d\u6307\u51fa\uff0c",(0,r.jsx)(t.strong,{children:"\u8054\u5408\u8eab\u4efd\u8ba4\u8bc1\u5b83\u8fd9\u4e2a\u4e1c\u897f\u4e0d\u662fSpring Authorization Server\u81ea\u5e26\u7684\u4e1c\u897f\uff0c\u800c\u662f\u501f\u52a9Security OAuth2 Client\u5b9e\u73b0\u7684\u4e00\u4e2a\u529f\u80fd"}),"\uff0c\u5927\u5bb6\u8981\u6ce8\u610f\u8fd9\u4e00\u70b9\u3002"]}),"\n",(0,r.jsx)(t.h2,{id:"\u4e94\u9644\u5f55",children:"\u4e94\u3001\u9644\u5f55"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\u4ee3\u7801\u5730\u5740\uff1a\u4ee3\u7801\u5df2\u63d0\u4ea4\u81f3Gitee\u7684",(0,r.jsx)(t.a,{href:"https://gitee.com/vains-Sofia/authorization-example/tree/federation",children:"federation\u5206\u652f"})]}),"\n",(0,r.jsxs)(t.li,{children:["Security OAuth2 Client",(0,r.jsx)(t.a,{href:"https://docs.spring.io/spring-security/reference/servlet/oauth2/index.html",children:"\u6587\u6863\u5730\u5740"})]}),"\n",(0,r.jsxs)(t.li,{children:["Gitee\u7684OAuth2",(0,r.jsx)(t.a,{href:"https://gitee.com/api/v5/oauth_doc#/list-item-2",children:"\u6587\u6863\u5730\u5740"})]}),"\n",(0,r.jsxs)(t.li,{children:["Github\u7684OAuth2",(0,r.jsx)(t.a,{href:"https://docs.github.com/zh/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps#1-request-a-users-github-identity",children:"\u6587\u6863\u5730\u5740"})]}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"https://www.box3.cn/tools/jwt.html",children:"JWT\u5728\u7ebf\u89e3\u6790\u5730\u5740"})}),"\n",(0,r.jsx)(t.li,{children:"Gitee\u7684\u4e09\u65b9\u5e94\u7528\u793a\u4f8b"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(80283).Z+"",width:"1512",height:"1321"})}),"\n",(0,r.jsxs)(t.ol,{start:"7",children:["\n",(0,r.jsx)(t.li,{children:"Github\u4e09\u65b9\u5e94\u7528\u793a\u4f8b"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"img",src:n(35891).Z+"",width:"1512",height:"2025"})})]})}function l(e={}){const{wrapper:t}={...(0,i.ah)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},85784:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-1-6f2c739d0e1879b5714270cb114917b0.webp"},36034:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-10-33e3a7be326402e4c00c9ce6c8afc711.webp"},75850:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-11-ef1bb191d9883e5a171e213cae8834c0.webp"},36113:(e,t,n)=>{n.d(t,{Z:()=>r});const r="data:image/webp;base64,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"},8979:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-13-4df85ee8520904ed71c3c79f5594fae3.webp"},59671:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-14-fa5bde04f2d43ed829195e53c7c218f2.webp"},946:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-15-03ec619d8ee6314aa25b2379f436d375.webp"},47370:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-16-8dabfea963c1f6edc6267cab953357ae.webp"},35474:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-17-98ef3d5a1b5385b895c99aaf4f5661d2.webp"},32468:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-18-b061d4d9a56b1396a04ec34acfe5d6cc.webp"},84892:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-19-1e4e6faa59d1aa240596a1304d43a4e2.webp"},94309:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-2-7f4ecf89738019610afb03227dd7c1a9.webp"},35611:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-20-879186f6c57ed4374aa6e30233a229a8.webp"},76585:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-21-dd41e5cdd5cd3732715b8bb4eae12be4.webp"},80283:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-22-7052f417c8794f0325dca0f0d3260e4e.webp"},35891:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-23-a46d553767f484a4e0d3482782ac48c6.webp"},79600:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-3-2c07b3d0ab9da86ef6ec3e91387c7c29.webp"},82720:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-4-e9e9e0a56bc339066dc121c9b344295a.webp"},796:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-5-5d94b283927c36b912b4d65491648bed.webp"},4918:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-6-86d4183b3bc77325d95ba1ef4e4d1867.webp"},22662:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-7-4bb1260fde1066b33bfbc12b0756fb03.webp"},36701:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-8-da522b9cabae05e2fc4f0affc190df42.webp"},10468:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/13-9-15ea4110a39d1526b3adc2887d22fafd.webp"},11151:(e,t,n)=>{n.d(t,{ah:()=>o});var r=n(67294);const i=r.createContext({});function o(e){const t=r.useContext(i);return r.useMemo((()=>"function"==typeof e?e(t):{...t,...e}),[t,e])}}}]);