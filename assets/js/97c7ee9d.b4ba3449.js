"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[76808],{23535:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>a});var l=s(74848),r=s(28453);const t={},c=void 0,o={id:"zh-cn/devenv/Docker-Pgsql",title:"Docker-Pgsql",description:"- Postgres Offical",source:"@site/docs/zh-cn/devenv/11-Docker-Pgsql.md",sourceDirName:"zh-cn/devenv",slug:"/zh-cn/devenv/Docker-Pgsql",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Pgsql",draft:!1,unlisted:!1,editUrl:"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/devenv/11-Docker-Pgsql.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"troch",previous:{title:"Docker-Mysql",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Mysql"},next:{title:"Docker-Oracle",permalink:"/light-docusaurus/docs/zh-cn/devenv/Docker-Oracle"}},d={},a=[{value:"1. Docker\u5b89\u88c5",id:"1-docker\u5b89\u88c5",level:2},{value:"2. Pgsql\u5907\u4efd\u8fd8\u539f",id:"2-pgsql\u5907\u4efd\u8fd8\u539f",level:2},{value:"\u4e00\u3001Windows\u4e0b\u5907\u4efd\u548c\u6062\u590d",id:"\u4e00windows\u4e0b\u5907\u4efd\u548c\u6062\u590d",level:3},{value:"\u4e8c\u3001Linux \u4e0b\u5907\u4efd\u548c\u6062\u590d",id:"\u4e8clinux-\u4e0b\u5907\u4efd\u548c\u6062\u590d",level:3},{value:"SQL\u65b9\u5f0f\u5907\u4efd\u548c\u6062\u590d",id:"sql\u65b9\u5f0f\u5907\u4efd\u548c\u6062\u590d",level:3},{value:"3. \u5e38\u7528\u547d\u4ee4",id:"3-\u5e38\u7528\u547d\u4ee4",level:2}];function i(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.postgresql.org/",children:"Postgres Offical"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://hub.docker.com/_/postgres",children:"Postgres Docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://doc.rockdata.net/zh-cn/psycopg/",children:"Redrock Postgres \u6587\u6863"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://pgtune.leopard.in.ua/",children:"PGTune - calculate configuration for PostgreSQL based on the maximum performance for a given hardware configuration"})}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"1-docker\u5b89\u88c5",children:"1. Docker\u5b89\u88c5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u521b\u5efaNetwork\ndocker network create dev\n\n# \u521b\u5efa\u6570\u636e\u5377\ndocker volume create pgsql_data;\n\n# \u521b\u5efa\u6587\u4ef6\u5939\nmkdir -p //d/docker/pgsql/{conf,data,logs}\n\n# docker run -i --rm postgres cat /usr/share/postgresql/postgresql.conf.sample >  D:/docker/pgsql/conf/postgresql.conf\n\n# \u83b7\u53d6\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\ndocker run -d --name postgres_temp postgres:15.3 \\\n&& docker cp postgres_temp:/usr/share/postgresql/postgresql.conf.sample D:/docker/pgsql/conf/postgresql.conf \\\n&& docker stop postgres_temp && docker rm postgres_temp\n\n# \u8fd0\u884c\u5bb9\u5668\ndocker run -d \\\n  --publish 5432:5432 \\\n\t--volume //d/docker/pgsql/data:/var/lib/postgresql/data \\\n\t--volume //d/docker/pgsql/conf/postgresql.conf:/etc/postgresql/postgresql.conf:ro \\\n  --env PGDATA=/var/lib/postgresql/data \\\n  --env POSTGRES_PASSWORD=postgres \\\n  --net dev \\\n  --restart=no \\\n  --name postgres \\\n  postgres:15.3\n\ndocker exec -it -u root postgres /bin/bash\n\ndocker container restart postgres\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Account","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"postgres/postgres"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"2-pgsql\u5907\u4efd\u8fd8\u539f",children:"2. Pgsql\u5907\u4efd\u8fd8\u539f"}),"\n",(0,l.jsx)(n.h3,{id:"\u4e00windows\u4e0b\u5907\u4efd\u548c\u6062\u590d",children:"\u4e00\u3001Windows\u4e0b\u5907\u4efd\u548c\u6062\u590d"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5907\u4efd\u547d\u4ee4"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"pg_dump -h localhost -U postgres test > D:\\postgres.bak\n\n1. pg_dump          \u662f\u5907\u4efd\u6570\u636e\u5e93\u6307\u4ee4\uff1b\n2. localhost        \u662f\u6570\u636e\u5e93\u7684 ip \u5730\u5740\uff1b\n3. postgres         \u662f\u6570\u636e\u5e93\u7684\u7528\u6237\u540d\uff1b\n4. test             \u662f\u6570\u636e\u5e93\u540d\uff1b\n5. >                \u610f\u601d\u662f\u5bfc\u51fa\u5230\u6307\u5b9a\u76ee\u5f55\uff1b\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u6062\u590d\u547d\u4ee4"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"psql -h localhost -U postgres -d test < D:\\postgres.bak\n\n1. psql           \u662f\u6062\u590d\u6570\u636e\u5e93\u6307\u4ee4\uff1b\n2. localhost      \u662f\u8981\u6062\u590d\u7684\u6570\u636e\u5e93\u7684 ip \u5730\u5740\uff1b\n3. postgres       \u662f\u6570\u636e\u5e93\u7684\u7528\u6237\u540d\uff1b\n4. test           \u662f\u6570\u636e\u5e93\u540d\uff1b\n5. <              \u610f\u601d\u662f\u5bfc\u51fa\u5230\u6307\u5b9a\u76ee\u5f55\uff1b\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u4e8clinux-\u4e0b\u5907\u4efd\u548c\u6062\u590d",children:"\u4e8c\u3001Linux \u4e0b\u5907\u4efd\u548c\u6062\u590d"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5907\u4efd"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"pg_dump -h localhost -U postgres databasename > databasename.bak\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u6062\u590d"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"psql -h localhost -U postgres -d databasename < databasename.bak\n"})}),"\n",(0,l.jsx)(n.h3,{id:"sql\u65b9\u5f0f\u5907\u4efd\u548c\u6062\u590d",children:"SQL\u65b9\u5f0f\u5907\u4efd\u548c\u6062\u590d"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:["\u8fd9\u91cc\u6211\u4eec\u7528\u5230\u7684\u5de5\u5177\u662f ",(0,l.jsx)(n.code,{children:"pg_dump"})," \u548c ",(0,l.jsx)(n.code,{children:"pg_dumpall"}),"\n\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5728\u6570\u636e\u5e93\u6b63\u5728\u4f7f\u7528\u7684\u65f6\u5019\u8fdb\u884c\u5b8c\u6574\u4e00\u81f4\u7684\u5907\u4efd\uff0c\u5e76\u4e0d\u963b\u585e\u5176\u5b83\u7528\u6237\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u3002\n\u5b83\u4f1a\u4ea7\u751f\u4e00\u4e2a\u811a\u672c\u6587\u4ef6\uff0c\u91cc\u9762\u5305\u542b\u5907\u4efd\u5f00\u59cb\u65f6\uff0c\u5df2\u521b\u5efa\u7684\u5404\u79cd\u6570\u636e\u5e93\u5bf9\u8c61\u7684 SQL \u8bed\u53e5\u548c\u6bcf\u4e2a\u8868\u4e2d\u7684\u6570\u636e\u3002\n\u53ef\u4ee5\u4f7f\u7528\u6570\u636e\u5e93\u63d0\u4f9b\u7684\u5de5\u5177 ",(0,l.jsx)(n.code,{children:"pg_dumpall"})," \u548c ",(0,l.jsx)(n.code,{children:"pg_dump"})," \u6765\u8fdb\u884c\u5907\u4efd\u3002\n",(0,l.jsx)(n.code,{children:"pg_dump"})," \u53ea\u5907\u4efd\u6570\u636e\u5e93\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u5b83\u4e0d\u4f1a\u5bfc\u51fa\u89d2\u8272\u548c\u8868\u7a7a\u95f4\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u4fe1\u606f\u662f\u6574\u4e2a\u6570\u636e\u5e93\u96c6\u7fa4\u5171\u7528\u7684\uff0c\u4e0d\u5c5e\u4e8e\u67d0\u4e2a\u5355\u72ec\u7684\u6570\u636e\u5e93\u3002\n",(0,l.jsx)(n.code,{children:"pg_dumpall"}),"\uff0c\u5bf9\u96c6\u7c07\u4e2d\u7684\u6bcf\u4e2a\u6570\u636e\u5e93\u8c03\u7528 pg_dump \u6765\u5b8c\u6210\u8be5\u5de5\u4f5c,\u8fd8\u4f1a\u8fd8\u8f6c\u50a8\u5bf9\u6240\u6709\u6570\u636e\u5e93\u516c\u7528\u7684\u5168\u5c40\u5bf9\u8c61\uff08 pg_dump \u4e0d\u4fdd\u5b58\u8fd9\u4e9b\u5bf9\u8c61\uff09\u3002\n\u76ee\u524d\u8fd9\u5305\u62ec\u9002\u6570\u636e\u5e93\u7528\u6237\u548c\u7ec4\u3001\u8868\u7a7a\u95f4\u4ee5\u53ca\u9002\u5408\u6240\u6709\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u6743\u9650\u7b49\u5c5e\u6027\u3002"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4f8b\u5982\uff0c\u5728\u6211\u7684\u8ba1\u7b97\u673a\u4e0a\uff0c\u53ef\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5bf9\u540d\u4e3a dbname \u7684\u6570\u636e\u5e93\u8fdb\u884c\u5907\u4efd\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"pg_dump \u2013h 127.0.0.1 -p 5432 -U postgres -c -C \u2013f dbname.sql dbname\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u53ef\u5bf9\u5168\u90e8 pg \u6570\u636e\u5e93\u8fdb\u884c\u5907\u4efd\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"pg_dumpall \u2013h 127.0.0.1 \u2013p 5432 -U postgres \u2013c -C \u2013f db_bak.sql\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6062\u590d\u65b9\u5f0f\u5f88\u7b80\u5355\u3002\u6267\u884c\u6062\u590d\u547d\u4ee4\u5373\u53ef\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"psql \u2013h 127.0.0.1 -p 5432 -U postgres \u2013f db_bak.sql\n"})}),"\n",(0,l.jsx)(n.h2,{id:"3-\u5e38\u7528\u547d\u4ee4",children:"3. \u5e38\u7528\u547d\u4ee4"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u547d\u4ee4\u884c\u64cd\u4f5c"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"# \u767b\u5f55\u6570\u636e\u5e93\npsql --help\npsql -h localhost -p 5432 -U postgres -W -d postgres \npsql --host=localhost --port=5432 --username=postgres --password --dbname=postgres \n\n# \u521b\u5efa\u7528\u6237\u5e76\u6388\u6743\nCREATE USER light WITH PASSWORD 'light';\nGRANT ALL PRIVILEGES ON DATABASE test TO light;\nALTER TABLE test.test_table OWNER TO light;\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u8fde\u63a5\u7ba1\u7406"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u8be2\u5f53\u524d\u8fde\u63a5\u6570\nSELECT * FROM pg_stat_activity;\n\n-- \u67e5\u770b\u8fc7\u671f\u8fde\u63a5\nSELECT * FROM pg_stat_activity WHERE state = 'idle';\n\n--\u5220\u9664\u8fde\u63a5\uff0c\u62ec\u53f7\u91cc\u4f20pid\nSELECT pg_terminate_backend(151);\n\n-- \u67e5\u770b\u6700\u5927\u8fde\u63a5\u6570\nSHOW max_connections;\n\n-- \u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570\uff0c\u9700\u8981superuser\u6743\u9650\nALTER system SET max_connections = 1000;\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"\u6570\u636e\u5e93\u64cd\u4f5c"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sql",children:"-- \u67e5\u770b\u6570\u636e\u5e93\u5217\u8868\nSELECT datname FROM pg_database;\n\n-- \u67e5\u770b\u6570\u636e\u8868\u5217\u8868\nSELECT tablename FROM pg_tables WHERE schemaname='public';\n\n-- \u5207\u6362\u5230\u67d0\u4e2a\u6570\u636e\u5e93\n\\c db_name;\n\n-- \u6267\u884c\u6570\u636e\u5e93\u811a\u672c\n\\i /path/to/scripts.sql\n\n-- \u67e5\u8be2\u5f53\u524d\u6570\u636e\u5e93\u4e0b\u7684\u6240\u6709\u6570\u636e\u8868\nSELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_type = 'BASE TABLE';\n\n-- \u5220\u9664\u6570\u636e\u5e93\nDROP DATABASE IF EXISTS \"db_name\";\n\n-- \u521b\u5efa\u6570\u636e\u5e93\nCREATE DATABASE \"db_name\"\n    WITH OWNER = postgres\n    TEMPLATE = template0\n    ENCODING = 'UTF8'\n    TABLESPACE = pg_default\n    CONNECTION LIMIT = -1;\nGRANT ALL ON DATABASE \"db_name\"  TO postgres;\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(i,{...e})}):i(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var l=s(96540);const r={},t=l.createContext(r);function c(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);