"use strict";(self.webpackChunklight_docusaurus=self.webpackChunklight_docusaurus||[]).push([[64998],{28453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>o});var a=r(96540);const l={},c=a.createContext(l);function i(e){const n=a.useContext(c);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),a.createElement(c.Provider,{value:n},e.children)}},63955:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"zh-cn/java/Java-profile-tools","title":"Java-profile-tools","description":"- Java\u795e\u5668--JMH & Arthas","source":"@site/docs/zh-cn/java/24-Java-profile-tools.md","sourceDirName":"zh-cn/java","slug":"/zh-cn/java/Java-profile-tools","permalink":"/docs/zh-cn/java/Java-profile-tools","draft":false,"unlisted":false,"editUrl":"https://github.com/lorchr/light-docusaurus/tree/main/docs/zh-cn/java/24-Java-profile-tools.md","tags":[],"version":"current","sidebarPosition":24,"frontMatter":{},"sidebar":"troch","previous":{"title":"All-About-Lock","permalink":"/docs/zh-cn/java/All-About-Lock"},"next":{"title":"APT","permalink":"/docs/zh-cn/java/apt/"}}');var l=r(74848),c=r(28453);const i={},o=void 0,s={},t=[{value:"\u95ee\u9898\u63cf\u8ff0",id:"\u95ee\u9898\u63cf\u8ff0",level:2},{value:"JMH\u7b80\u4ecb",id:"jmh\u7b80\u4ecb",level:2},{value:"Arthas \u6211\u7684\u4ee3\u7801\u5728\u8fd0\u884c\u65f6\u5230\u5e95\u505a\u4e86\u4ec0\u4e48",id:"arthas-\u6211\u7684\u4ee3\u7801\u5728\u8fd0\u884c\u65f6\u5230\u5e95\u505a\u4e86\u4ec0\u4e48",level:2},{value:"\u5b9e\u9645\u64cd\u4f5c",id:"\u5b9e\u9645\u64cd\u4f5c",level:3},{value:"\u76d1\u63a7\u65b9\u6cd5\u8c03\u7528",id:"\u76d1\u63a7\u65b9\u6cd5\u8c03\u7528",level:3},{value:"trace\u547d\u4ee4 &amp; jad\u547d\u4ee4",id:"trace\u547d\u4ee4--jad\u547d\u4ee4",level:3},{value:"watch\u547d\u4ee4",id:"watch\u547d\u4ee4",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://bryantchang.github.io/2019/12/08/java-profile-tools/",children:"Java\u795e\u5668--JMH & Arthas"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://mp.weixin.qq.com/s/29xkxWccyX15EqSHbFaWHg",children:"JMH \u548c Arthas \u5b9a\u4f4d\u95ee\u9898\u7684\u6848\u4f8b\u5206\u4eab"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u7b80\u5355\u4ecb\u7ecd\u4e24\u6b3eJava\u6d4b\u8bd5\u548c\u6027\u80fd\u76d1\u63a7\u795e\u5668"}),"\n",(0,l.jsx)(n.p,{children:"\u6700\u8fd1\u7684\u5de5\u4f5c\u65e5\u5e76\u4e0d\u7b97\u592a\u5e73\uff0c\u5404\u79cd\u5927\u5927\u5c0f\u5c0f\u7684case\u548c\u89e3case\uff0c\u53d1\u73b0\u5df2\u7ecf\u6709\u597d\u4e45\u597d\u4e45\u6ca1\u6709\u9759\u4e0b\u5fc3\u6765\u4e13\u5fc3\u5199\u70b9\u4e1c\u897f\u4e86\u3002\u4e0d\u8fc7\u5012\u8fd8\u662f\u575a\u6301\u5229\u7528\u4e1a\u4f59\u65f6\u95f4\u5b66\u4e60\u4e86\u4e0d\u5c11\u5fae\u8bfe\u4e0a\u7684\u4e1c\u897f\uff0c\u53d1\u73b0\u5927\u4f6c\u4eec\u603b\u7ed3\u7684\u4e1c\u897f\u8fd8\u662f\u4e0d\u4e00\u6837\uff0c\u76f8\u6bd4\u4e8e\u5927\u5b66\u65f6\u7684\u90a3\u4e9b\u67af\u71e5\u7684\u8bfe\u672c\uff0c\u5927\u4f6c\u4eec\u603b\u7ed3\u51fa\u6765\u7684\u5185\u5bb9\u66f4\u6d3b\uff0c\u66f4\u52a0\u5bb9\u6613\u7406\u89e3\u3002\u81ea\u5df1\u540e\u9762\u4e5f\u4f1a\u628a\u5927\u4f6c\u4eec\u7684\u4e1c\u897f\u597d\u597d\u6d88\u5316\u5438\u6536\uff0c\u53d8\u6210\u81ea\u5df1\u7684\u4e1c\u897f\u7528\u6587\u5b57\u6027\u7684\u4e1c\u897f\u8868\u8fbe\u51fa\u6765\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u4eca\u5929\u60f3\u603b\u7ed3\u7684\u4e1c\u897f\u662f\u6700\u8fd1\u5de5\u4f5c\u4e2d\u4f7f\u7528\u5230\u7684\u6d4b\u8bd5\u5de5\u5177JMH\u4ee5\u53caJava\u8fd0\u884c\u65f6\u76d1\u63a7\u5de5\u5177Arthas\u3002\u4ed6\u4eec\u5728\u6211\u7684\u5b9e\u9645\u5de5\u4f5c\u4e2d\u4e5f\u7b97\u662f\u5e2e\u4e86\u5927\u5fd9\u3002\u6240\u4ee5\u5728\u8fd9\u91cc\u629b\u7816\u5f15\u7389\u4e00\u4e0b\u8fd9\u4e9b\u5de5\u5177\u7684\u4f7f\u7528\u65b9\u6cd5\u3002\u540c\u65f6\u4e5f\u52a0\u6df1\u4e00\u4e0b\u81ea\u5df1\u5bf9\u8fd9\u4e9b\u5de5\u5177\u7684\u719f\u6089\u7a0b\u5ea6\u3002\u5bf9\u8fd9\u4e24\u4e2a\u5de5\u5177\uff0c\u6211\u90fd\u4f1a\u9996\u5148\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u8fd9\u4e9b\u5de5\u5177\u7684\u5927\u81f4\u4f7f\u7528\u573a\u666f\uff0c\u7136\u540e\u4f1a\u4f7f\u7528\u4e00\u4e2a\u5728\u5de5\u4f5c\u4e2d\u771f\u6b63\u9047\u5230\u7684\u6027\u80fd\u95ee\u9898\u6392\u67e5\u4e3a\u4f8b\u8be6\u7ec6\u8bb2\u89e3\u8fd9\u4e24\u4e2a\u5de5\u5177\u7684\u5b9e\u9645\u7528\u6cd5\u3002\u8bdd\u4e0d\u591a\u8bf4\uff0c\u76f4\u5954\u4e3b\u9898\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u95ee\u9898\u63cf\u8ff0",children:"\u95ee\u9898\u63cf\u8ff0"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3a\u4e86\u80fd\u591f\u8ba9\u6211\u540e\u9762\u7684\u5b9e\u4f8b\u80fd\u591f\u8d2f\u7a7f\u8fd9\u4e24\u4e2a\u5de5\u5177\u7684\u4f7f\u7528\uff0c\u6211\u9996\u5148\u7b80\u5355\u63cf\u8ff0\u4e0b\u6211\u4eec\u5728\u5f00\u53d1\u4e2d\u9047\u5230\u7684\u5b9e\u9645\u7684\u6027\u80fd\u95ee\u9898\u3002\u7136\u540e\u518d\u5f15\u51fa\u8fd9\u4e24\u4e2a\u6027\u80fd\u5de5\u5177\u7684\u5b9e\u9645\u4f7f\u7528\uff0c\u770b\u6211\u4eec\u5982\u4f55\u4f7f\u7528\u8fd9\u4e24\u4e2a\u5de5\u5177\u6210\u529f\u5b9a\u4f4d\u5230\u6027\u80fd\u74f6\u9888\u7684\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u95ee\u9898\u5982\u4e0b\uff1a\u4e3a\u4e86\u80fd\u591f\u652f\u6301\u4e22\u5931\u7387\uff0c\u6211\u4eec\u5c06\u539f\u5148log4j2 \u7684Async+\u81ea\u5b9a\u4e49Appender\u7684\u65b9\u5f0f\u8fdb\u884c\u4e86\u4fee\u6b63\uff0c\u628a\u5f02\u6b65\u7684\u903b\u8f91\u653e\u5230\u4e86\u81ea\u5df1\u6539\u7248\u540e\u7684Appender\u4e2d\u3002\u4f46\u6211\u4eec\u53d1\u73b0\u4fee\u6539\u540e\u65e5\u5fd7\u6027\u80fd\u8981\u6bd4\u4e4b\u524dAsync+\u81ea\u5b9a\u4e49Appender\u7684\u65b9\u5f0f\u4e0b\u964d\u4e0d\u5c11\u3002\u8fd9\u91cc\u7531\u4e8e\u9690\u79c1\u539f\u56e0\u6211\u5e76\u6ca1\u6709\u7528\u5b9e\u9645\u516c\u53f8\u4e2d\u7684\u5b9e\u4f8b\uff0c\u8fd9\u91cc\u6211\u7528\u4e86\u4e00\u79cd\u5176\u4ed6\u540c\u6837\u80fd\u591f\u4f53\u73b0\u95ee\u9898\u7684\u65b9\u5f0f\u3002\u6211\u4eec\u6682\u65f6\u5148\u4e0d\u7ed9\u51fa\u5177\u4f53\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5148\u7ed9\u51fa\u6027\u80fd\u6d4b\u8bd5\u4ee3\u7801\u548c\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u4ee3\u7801"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'package com.bryantchang.appendertest;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\n\npublic class AppenderTest {\n\n    private static final String LOGGER_NAME_DEFAULT = "defaultLogger";\n    private static final String LOGGER_NAME_INCLUDE = "includeLocationLogger";\n    private static final Logger LOGGER = LoggerFactory.getLogger(LOGGER_NAME_INCLUDE);\n    public static final long BATCH = 10000;\n\n    public static void main(String[] args) throws InterruptedException {\n        while(true) {\n            long start, end;\n            start = System.currentTimeMillis();\n            for (int i = 0; i < BATCH; i++) {\n                LOGGER.info("msg is {}", i);\n            }\n            end = System.currentTimeMillis();\n            System.out.println("duration of " + LOGGER_NAME_INCLUDE +  " is " + (end - start) + "ms");\n            Thread.sleep(1000);\n        }\n    }\n}\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u4ee3\u7801\u903b\u8f91\u53ca\u5176\u7b80\u5355\uff0c\u5c31\u662f\u8c03\u7528",(0,l.jsx)(n.code,{children:"logger.info"}),"\u6bcf\u6b21\u6253\u537010000\u6761\u65e5\u5fd7\uff0c\u7136\u540e\u8bb0\u5f55\u8017\u65f6\u3002\u4e24\u8005\u7684\u5bf9\u6bd4\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c\n\u5bf9\u6bd4\u7ed3\u679c\nhelloworld\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u4ece\u8fd9\u4e24\u5f20\u56fe\u7247\u4e2d\u6211\u4eec\u80fd\u591f\u770b\u5230\u540c\u6837\u7684\u903b\u8f91\uff0c\u4e24\u4e2a\u7a0b\u5e8f\u7684\u8017\u65f6\u5dee\u8ddd\u76f8\u5dee\u4e86\u6570\u5341\u500d\uff0c\u4f46\u770b\u56fe\u7247\uff0c\u8c8c\u4f3c\u4ec5\u4ec5\u662flogger\u7684\u540d\u79f0\u4e0d\u4e00\u6837\u3002\u5bf9\u4e0a\u9762\u7684\u5b9e\u9a8c\u7ed3\u679c\u8fdb\u884c\u5206\u6790\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u6709\u4e24\u4e2a\u7591\u95ee"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0a\u9762\u7684\u4ee3\u7801\u6d4b\u8bd5\u662f\u5426\u6807\u51c6\uff0c\u89c4\u8303"}),"\n",(0,l.jsx)(n.li,{children:"\u5982\u679c\u771f\u7684\u662f\u6027\u80fd\u95ee\u9898\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u4ee3\u7801\u5230\u5e95\u5728\u54ea\u4e2a\u65b9\u6cd5\u4e0a\u6709\u4e86\u8fd9\u4e48\u5927\u7684\u5dee\u8ddd\u5bfc\u81f4\u4e86\u6700\u7ec8\u7684\u6027\u80fd\u5dee\u5f02"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4e0b\u9762\u8fd9\u4e24\u4e2a\u5de5\u5177\u5c31\u5206\u522b\u6765\u56de\u7b54\u8fd9\u4e24\u4e2a\u95ee\u9898"}),"\n",(0,l.jsx)(n.h2,{id:"jmh\u7b80\u4ecb",children:"JMH\u7b80\u4ecb"}),"\n",(0,l.jsx)(n.p,{children:"\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff0c\u6d4b\u8bd5\u7684\u65b9\u6cd5\u662f\u5426\u6807\u51c6\u3002\u6211\u4eec\u5728\u7f16\u5199\u4ee3\u7801\u65f6\u7528\u7684\u662f\u6b7b\u5faa\u73af+\u524d\u540e\u201c\u6390\u79d2\u8868\u201d\u7684\u65b9\u5f0f\u3002\u5047\u5982\u6211\u4eec\u8981\u518d\u52a0\u4e2a\u591a\u7ebf\u7a0b\u7684\u6d4b\u8bd5\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u641e\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u9664\u4e86\u4ee3\u7801\u672c\u8eab\u7684\u903b\u8f91\u8fd8\u8981\u5173\u5fc3\u6d4b\u8bd5\u7684\u903b\u8f91\u3002\u6211\u4eec\u4f1a\u60f3\uff0c\u6709\u6ca1\u6709\u4e00\u6b3e\u5de5\u5177\u80fd\u591f\u5c06\u6211\u4eec\u4ece\u6d4b\u8bd5\u903b\u8f91\u4e2d\u5f7b\u5e95\u89e3\u653e\u51fa\u6765\uff0c\u53ea\u9700\u8981\u5173\u5fc3\u6211\u4eec\u9700\u8981\u6d4b\u8bd5\u7684\u4ee3\u7801\u903b\u8f91\u3002JMH\u5c31\u662f\u8fd9\u6837\u4e00\u6b3eJava\u7684\u6d4b\u8bd5\u6846\u67b6\u3002\u4e0b\u9762\u662fJMH\u7684\u5b98\u65b9\u5b9a\u4e49"}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsx)(n.p,{children:"JMH \u662f\u4e00\u4e2a\u9762\u5411 Java \u8bed\u8a00\u6216\u8005\u5176\u4ed6 Java \u865a\u62df\u673a\u8bed\u8a00\u7684\u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5\u6846\u67b6"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u9762\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cJMH\u6240\u6d4b\u8bd5\u7684\u65b9\u6cd5\u7ea6\u7b80\u5355\u8d8a\u597d\uff0c\u4f9d\u8d56\u8d8a\u5c11\u8d8a\u597d\uff0c\u6700\u9002\u5408\u7684\u573a\u666f\u5c31\u662f\uff0c\u6d4b\u8bd5\u4e24\u4e2a\u96c6\u5408put\uff0cget\u6027\u80fd\uff0c\u4f8b\u5982ArrayList\u4e0eLinkedList\u7684\u5bf9\u6bd4\u7b49\uff0c\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u6d4b\u8bd5\u7684\u662f\u6279\u91cf\u6253\u4e00\u6279\u65e5\u5fd7\u6240\u9700\u8981\u7684\u65f6\u95f4\uff0c\u4e5f\u57fa\u672c\u7b26\u5408\u4f7f\u7528JMH\u7684\u6d4b\u8bd5\u573a\u666f\u3002\u4e0b\u9762\u662f\u6d4b\u8bd5\u4ee3\u7801\uff0cbench\u6846\u67b6\u4ee3\u7801\u4ee5\u53ca\u4e3b\u51fd\u6570\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u5f85\u6d4b\u8bd5\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'public class LogBenchMarkWorker {\n\n    private LogBenchMarkWorker() {}\n\n    private static class LogBenchMarkWorkerInstance {\n        private static final LogBenchMarkWorker instance = new LogBenchMarkWorker();\n    }\n\n    public static LogBenchMarkWorker getInstance() {\n        return LogBenchMarkWorkerInstance.instance;\n    }\n\n    private static final String LOGGER_DEFAULT_NAME = "defaultLogger";\n    private static final String LOGGER_INCLUDE_LOCATION = "includeLocationLogger";\n    private static final Logger LOGGER = LoggerFactory.getLogger(LOGGER_DEFAULT_NAME);\n    private static long BATCH_SIZE = 10000;\n\n    public void logBatch() {\n        for (int i = 0; i < BATCH_SIZE; i++) {\n            LOGGER.info("msg is {}", i);\n        }\n    }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\u5f85\u6d4b\u8bd5\u65b9\u6cd5\u975e\u5e38\u7b80\u5355\uff0c\u5c31\u662f\u5355\u6279\u6b21\u4e00\u6b21\u6027\u6253\u537010000\u6761\u65e5\u5fd7\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u5e76\u6ca1\u6709\u9700\u8981\u989d\u5916\u8bf4\u660e\u7684\u90e8\u5206\u3002\u4e0b\u9762\u6211\u4eec\u518d\u6765\u770bbenchmark\u90e8\u5206\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"public class LogBenchMarkMain {\n\n    @Benchmark\n    @BenchmarkMode(Mode.AverageTime)\n    @Fork(value = 1)\n    @Threads(1)\n    public void testLog1() {\n        LogBenchMarkWorker.getInstance().logBatch();\n    }\n\n    @Benchmark\n    @BenchmarkMode(Mode.AverageTime)\n    @Fork(value = 1)\n    @Threads(4)\n    public void testLog4() {\n        LogBenchMarkWorker.getInstance().logBatch();\n    }\n\n    @Benchmark\n    @BenchmarkMode(Mode.AverageTime)\n    @Fork(value = 1)\n    @Threads(8)\n    public void testLog8() {\n        LogBenchMarkWorker.getInstance().logBatch();\n    }\n\n    @Benchmark\n    @BenchmarkMode(Mode.AverageTime)\n    @Fork(value = 1)\n    @Threads(16)\n    public void testLog16() {\n        LogBenchMarkWorker.getInstance().logBatch();\n    }\n}\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u8fd9\u6bb5\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u5c31\u4f1a\u53d1\u73b0\u6709\u4e86\u4e00\u4e9bJMH\u4e2d\u7279\u6709\u7684\u4e1c\u897f\uff0c\u6211\u4e0b\u9762\u8fdb\u884c\u7b80\u8981\u4ecb\u7ecd\u3002"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Benchmark\u6ce8\u89e3\uff1a\u6807\u8bc6\u5728\u67d0\u4e2a\u5177\u4f53\u65b9\u6cd5\u4e0a\uff0c\u8868\u793a\u8fd9\u4e2a\u65b9\u6cd5\u5c06\u662f\u4e00\u4e2a\u88ab\u6d4b\u8bd5\u7684\u6700\u5c0f\u65b9\u6cd5\uff0c\u5728JMH\u4e2d\u6210\u4e3a\u4e00\u4e2aOPS"}),"\n",(0,l.jsxs)(n.li,{children:["BenmarkMode:\u6d4b\u8bd5\u7c7b\u578b\uff0cJMH\u63d0\u4f9b\u4e86\u51e0\u79cd\u4e0d\u540c\u7684Mode","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Throughput:\u6574\u4f53\u541e\u5410\u91cf"}),"\n",(0,l.jsx)(n.li,{children:"AverageTime:\u8c03\u7528\u7684\u5e73\u5747\u65f6\u95f4\uff0c\u6bcf\u6b21OPS\u6267\u884c\u7684\u65f6\u95f4"}),"\n",(0,l.jsx)(n.li,{children:"SampleTime:\u53d6\u6837\uff0c\u7ed9\u51fa\u4e0d\u540c\u6bd4\u4f8b\u7684ops\u65f6\u95f4\uff0c\u4f8b\u598299%\u7684ops\u65f6\u95f4\uff0c99.99%\u7684ops\u65f6\u95f4"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"fork\uff1afork\u7684\u6b21\u6570\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a2\uff0cJMH\u4f1afork\u51fa\u4e24\u4e2a\u8fdb\u7a0b\u6765\u6d4b\u8bd5"}),"\n",(0,l.jsx)(n.li,{children:"Threads\uff1a\u5f88\u5bb9\u6613\u7406\u89e3\uff0c\u8fd9\u4e2a\u53c2\u6570\u8868\u793a\u8fd9\u4e2a\u65b9\u6cd5\u540c\u65f6\u88ab\u591a\u5c11\u4e2a\u7ebf\u7a0b\u6267\u884c"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u5b9a\u4e49\u4e864\u4e2a\u5f85\u6d4b\u8bd5\u7684\u65b9\u6cd5\uff0c\u65b9\u6cd5\u7684Fork\uff0cBenchmarkMode\u5747\u4e3a\u6d4b\u8bd5\u5355\u6b21OPS\u7684\u5e73\u5747\u65f6\u95f4\uff0c\u4f464\u4e2a\u65b9\u6cd5\u7684\u7ebf\u7a0b\u6570\u4e0d\u540c\u3002\n\u9664\u4e86\u8fd9\u51e0\u4e2a\u53c2\u6570\uff0c\u8fd8\u6709\u51e0\u4e2a\u53c2\u6570\uff0c\u6211\u4f1a\u5728main\u51fd\u6570\u91cc\u9762\u6765\u8bb2\uff0cmain\u4ee3\u7801\u5982\u4e0b\u6240\u793a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'public class Main {\n    public static void main(String[] args) throws RunnerException {\n        Options options = new OptionsBuilder()\n                .include(LogBenchMarkMain.class.getSimpleName())\n                .warmupIterations(5)\n                .measurementIterations(5)\n                .output("logs/BenchmarkCommon.log")\n                .build();\n        new Runner(options).run();\n    }\n}\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u5728main\u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u5c31\u662f\u8981\u8bbe\u7f6eJMH\u7684\u57fa\u7840\u914d\u7f6e\uff0c\u8fd9\u91cc\u9762\u7684\u51e0\u4e2a\u914d\u7f6e\u53c2\u6570\u542b\u4e49\u5982\u4e0b\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["include",":benchmark","\u6240\u5728\u7c7b\u7684\u540d\u5b57\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b63\u5219\u8868\u8fbe"]}),"\n",(0,l.jsx)(n.li,{children:"warmupIteration:\u9884\u70ed\u7684\u8fed\u4ee3\u6b21\u6570\uff0c\u8fd9\u91cc\u4e3a\u4ec0\u4e48\u8981\u9884\u70ed\u7684\u539f\u56e0\u662f\u7531\u4e8eJIT\u7684\u5b58\u5728\uff0c\u968f\u7740\u4ee3\u7801\u7684\u8fd0\u884c\uff0c\u4f1a\u52a8\u6001\u5bf9\u4ee3\u7801\u7684\u8fd0\u884c\u8fdb\u884c\u4f18\u5316\u3002\u56e0\u6b64\u5728\u6d4b\u8bd5\u8fc7\u7a0b\u4e2d\u9700\u8981\u5148\u9884\u70ed\u51e0\u8f6e\uff0c\u8ba9\u4ee3\u7801\u8fd0\u884c\u7a33\u5b9a\u540e\u518d\u5b9e\u9645\u8fdb\u884c\u6d4b\u8bd5"}),"\n",(0,l.jsx)(n.li,{children:"measurementIterations:\u5b9e\u9645\u6d4b\u8bd5\u8f6e\u6b21"}),"\n",(0,l.jsx)(n.li,{children:"output:\u6d4b\u8bd5\u62a5\u544a\u8f93\u51fa\u4f4d\u7f6e"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u5206\u522b\u7528\u4e24\u79cdlogger\u8fd0\u884c\u4e00\u4e0b\u6d4b\u8bd5\uff0c\u67e5\u770b\u6027\u80fd\u6d4b\u8bd5\u62a5\u544a\u5bf9\u6bd4"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u666e\u901alogger"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"LogBenchMarkMain.testLog1   avgt    5  0.006 \xb1 0.001   s/op\nLogBenchMarkMain.testLog16  avgt    5  0.062 \xb1 0.026   s/op\nLogBenchMarkMain.testLog4   avgt    5  0.006 \xb1 0.002   s/op\nLogBenchMarkMain.testLog8   avgt    5  0.040 \xb1 0.004   s/op\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u4f7f\u7528\u4e86",(0,l.jsx)(n.code,{children:"INCLUDE_LOCATION"}),"\u7684logger"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"LogBenchMarkMain.testLog1   avgt    5  0.379 \xb1 0.007   s/op\nLogBenchMarkMain.testLog16  avgt    5  1.784 \xb1 0.670   s/op\nLogBenchMarkMain.testLog4   avgt    5  0.378 \xb1 0.003   s/op\nLogBenchMarkMain.testLog8   avgt    5  0.776 \xb1 0.070   s/op\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u8fd9\u91cc\u6211\u4eec\u770b\u5230\uff0c\u6027\u80fd\u5dee\u8ddd\u7acb\u73b0\u3002\u4f7f\u7528",(0,l.jsx)(n.code,{children:"INCLUDE_LOCATION"}),"\u7684\u6027\u80fd\u8981\u660e\u663e\u4f4e\u4e8e\u4f7f\u7528\u666e\u901alogger\u7684\u6027\u80fd\u3002\u8fd9\u662f\u6211\u4eec\u4e00\u5b9a\u5f88\u597d\u5947\uff0c\u5e76\u4e14\u95ee\u4e00\u53e5\u201c\u5230\u5e95\u6162\u5728\u54ea\u201d\uff01\uff01"]}),"\n",(0,l.jsx)(n.h2,{id:"arthas-\u6211\u7684\u4ee3\u7801\u5728\u8fd0\u884c\u65f6\u5230\u5e95\u505a\u4e86\u4ec0\u4e48",children:"Arthas \u6211\u7684\u4ee3\u7801\u5728\u8fd0\u884c\u65f6\u5230\u5e95\u505a\u4e86\u4ec0\u4e48"}),"\n",(0,l.jsx)(n.p,{children:"Arthas\u662f\u963f\u91cc\u5f00\u6e90\u7684\u4e00\u6b3ejava\u8c03\u8bd5\u795e\u5668\uff0c\u4e0egreys\u7c7b\u4f3c\uff0c\u4e0d\u8fc7\u6709\u7740\u6bd4greys\u66f4\u52a0\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u4f8b\u5982\uff0c\u53ef\u4ee5\u76f4\u63a5\u7ed8\u5236java\u65b9\u6cd5\u8c03\u7528\u7684\u706b\u7130\u56fe\u7b49\u3002\u8fd9\u4e24\u4e2a\u5de5\u5177\u7684\u539f\u7406\u90fd\u662f\u4f7f\u7528\u4e86Java\u5f3a\u5927\u7684\u5b57\u8282\u7801\u6280\u672f\u3002\u6bd5\u7adf\u6211\u4e5f\u4e0d\u662fJVM\u5927\u4f6c\uff0c\u6240\u4ee5\u5177\u4f53\u7684\u5b9e\u73b0\u7ec6\u8282\u6ca1\u6cd5\u5c55\u5f00\uff0c\u6211\u4eec\u8981\u505a\u7684\u5c31\u662f\u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a\uff0c\u63a5\u53d7\u5e76\u7528\u719f\u7ec3\u7684\u4f7f\u7528\u597d\u8fd9\u4e9b\u597d\u7528\u7684\u6027\u80fd\u76d1\u63a7\u5de5\u5177\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b9e\u9645\u64cd\u4f5c",children:"\u5b9e\u9645\u64cd\u4f5c"}),"\n",(0,l.jsx)(n.p,{children:"talk is cheap, show me your code,\u65e2\u7136\u662f\u5de5\u5177\uff0c\u6211\u4eec\u76f4\u63a5\u8fdb\u884c\u5b9e\u9645\u64cd\u4f5c\u3002\u6211\u4eec\u5728\u672c\u673a\u8fd0\u884c\u6211\u4eec\u4e00\u5f00\u59cb\u7684\u7a0b\u5e8f\uff0c\u7136\u540e\u8bb2\u89e3arthas\u7684\u4f7f\u7528\u65b9\u6cd5\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u4eec\u9996\u5148\u901a\u8fc7jps\u627e\u5230\u7a0b\u5e8f\u7684\u8fdb\u7a0b\u53f7\uff0c\u7136\u540e\u76f4\u63a5\u901a\u8fc7arthas\u7ed9\u5230\u7684as.sh\u5bf9\u6211\u4eec\u8fd0\u884c\u7684\u7a0b\u5e8f\u8fdb\u884c\u5b57\u8282\u7801\u589e\u5f3a\uff0c\u7136\u540e\u542f\u52a8arthas\uff0c\u547d\u4ee4\u5982\u4e0b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"./as.sh pid\n"})}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c\n\u8fd9\u4e2a\u5c31\u662farthas\u7684\u542f\u52a8\u754c\u9762\u4e86\uff0c\u6211\u4eec\u4f7f\u7528help\u547d\u4ee4\u67e5\u770b\u5de5\u5177\u6240\u652f\u6301\u7684\u529f\u80fd\nhelloworld\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u5230\uff0carthas\u652f\u6301\u67e5\u770b\u5f53\u524djvm\u7684\u72b6\u6001\uff0c\u67e5\u770b\u5f53\u524d\u7684\u7ebf\u7a0b\u72b6\u6001\uff0c\u76d1\u63a7\u67d0\u4e9b\u65b9\u6cd5\u7684\u8c03\u7528\u65f6\u95f4\uff0ctrace\uff0cprofile\u751f\u6210\u706b\u7130\u56fe\u7b49\uff0c\u529f\u80fd\u4e00\u5e94\u4ff1\u5168\n\u6211\u4eec\u8fd9\u91cc\u4e5f\u53ea\u5c06\u51e0\u4e2a\u6bd4\u8f83\u5e38\u7528\u7684\u547d\u4ee4\uff0c\u5176\u4ed6\u7684\u547d\u4ee4\u5982\u679c\u5927\u5bb6\u611f\u5174\u8da3\u53ef\u4ee5\u8be6\u89c1\u5b98\u7f51arthas\u5b98\u7f51\u3002\u8fd9\u7bc7\u6587\u7ae0\u4e3b\u8981\u4ecb\u7ecd\u4e0b\u9762\u51e0\u4e2a\u529f\u80fd"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u53cd\u7f16\u8bd1\u4ee3\u7801"}),"\n",(0,l.jsx)(n.li,{children:"\u76d1\u63a7\u67d0\u4e2a\u65b9\u6cd5\u7684\u8c03\u7528"}),"\n",(0,l.jsx)(n.li,{children:"\u67e5\u770b\u67d0\u4e2a\u65b9\u6cd5\u7684\u8c03\u7528\u548c\u8fd4\u56de\u503c"}),"\n",(0,l.jsx)(n.li,{children:"trace\u67d0\u4e2a\u65b9\u6cd5"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u76d1\u63a7\u65b9\u6cd5\u8c03\u7528",children:"\u76d1\u63a7\u65b9\u6cd5\u8c03\u7528"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u4e2a\u4e3b\u8981\u7684\u547d\u4ee4\u4e3amonitor\uff0c\u6839\u636e\u5b98\u7f51\u7684\u4ecb\u7ecd\uff0c\u5e38\u7528\u7684\u4f7f\u7528\u65b9\u6cd5\u4e3a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"monitor -c duration className methodName\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5176\u4e2dduration\u4ee3\u8868\u6bcf\u9694\u51e0\u79d2\u5c55\u793a\u4e00\u6b21\u7edf\u8ba1\u7ed3\u679c\uff0c\u5373\u5355\u6b21\u7684\u7edf\u8ba1\u5468\u671f\uff0cclassName\u5c31\u662f\u7c7b\u7684\u5168\u9650\u5b9a\u540d\uff0cmethodname\u5c31\u662f\u65b9\u6cd5\u7684\u540d\u5b57\uff0c\u8fd9\u91cc\u9762\u6211\u4eec\u67e5\u770b\u7684\u65b9\u6cd5\u662fLogger\u7c7b\u7684info\u65b9\u6cd5\uff0c\u6211\u4eec\u5206\u522b\u5bf9\u4f7f\u7528\u4e24\u79cd\u4e0d\u540clogger\u7684info\u65b9\u6cd5\u3002\u8fd9\u91cc\u9762\u7684\u7c7b\u662forg.slf4j.Logger\uff0c\u65b9\u6cd5\u65f6info\uff0c\u6211\u4eec\u7684\u76d1\u63a7\u8bed\u53e5\u4e3a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"monitor -c 5 org.slf4j.Logger info\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u76d1\u63a7\u7ed3\u679c\u5982\u4e0b"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u666e\u901aappender\nhelloworld\u7ed3\u679c\n\u4f7f\u7528include appender\nhelloworld\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528include appeder\u7684\u6253\u5370\u65e5\u5fd7\u65b9\u6cd5\u8981\u6bd4\u666e\u901a\u7684appender\u9ad8\u51fa\u4e863\u500d\uff0c\u8fd9\u5c31\u4e0d\u7981\u8ba9\u6211\u4eec\u6709\u4e86\u7591\u95ee\uff0c\u7a76\u7adf\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u5404\u4e2a\u6b65\u9aa4\u8017\u65f6\u5982\u4f55\u5462\u3002\u4e0b\u9762\u6211\u4eec\u5c31\u4ecb\u7ecd\u7b2c\u4e8c\u6761\u547d\u4ee4\uff0ctrace\u65b9\u6cd5\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"trace\u547d\u4ee4--jad\u547d\u4ee4",children:"trace\u547d\u4ee4 & jad\u547d\u4ee4"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u4e24\u4e2a\u7a0b\u5e8f\u7684log4j2\u914d\u7f6e\u6587\u4ef6\u5982\u4e0b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n\x3c!--status\uff1a\u65e5\u5fd7\u7b49\u7ea7   monitorInterval\uff1a\u66f4\u65b0\u914d\u7f6e\u6587\u4ef6\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u5355\u4f4d\u79d2--\x3e\n<configuration status="warn" monitorInterval="30">\n    \x3c!--\u5b9a\u4e49\u6240\u6709\u7684appender --\x3e\n    <appenders>\n        \x3c!--\u8fd9\u4e2a\u8f93\u51fa\u63a7\u5236\u53f0\u7684\u914d\u7f6e --\x3e\n        <Console name="console" target="SYSTEM_OUT">\n            \x3c!--\u63a7\u5236\u53f0\u53ea\u8f93\u51falevel\u53ca\u4ee5\u4e0a\u7ea7\u522b\u7684\u4fe1\u606f\uff08onMatch\uff09\uff0c\u5176\u4ed6\u7684\u76f4\u63a5\u62d2\u7edd\uff08onMismatch\uff09 --\x3e\n            <ThresholdFilter level="warn" onMatch="ACCEPT" onMismatch="DENY"/>\n            \x3c!--\u65e5\u5fd7\u6253\u5370\u683c\u5f0f --\x3e\n            <PatternLayout pattern="[%d{HH:mm:ss.SSS}] [%-5p] %l - %m%n"/>\n        </Console>\n\n\n        <Async name="AsyncDefault" blocking="false" includeLocation="false">\n            <AppenderRef ref="fileAppender"/>\n        </Async>\n\n        <Async name="AsyncIncludeLocation" blocking="false" includeLocation="true">\n            <AppenderRef ref="fileAppender"/>\n        </Async>\n\n        \x3c!--\u6587\u4ef6\u4f1a\u6253\u5370\u51fa\u6240\u6709\u4fe1\u606f\uff0c\u8fd9\u4e2alog\u6bcf\u6b21\u8fd0\u884c\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u6e05\u7a7a\uff0c\u7531append\u5c5e\u6027\u51b3\u5b9a\uff0c\u8fd9\u4e2a\u4e5f\u633a\u6709\u7528\u7684\uff0c\u9002\u5408\u4e34\u65f6\u6d4b\u8bd5\u7528 --\x3e\n        \x3c!--append\u4e3aTRUE\u8868\u793a\u6d88\u606f\u589e\u52a0\u5230\u6307\u5b9a\u6587\u4ef6\u4e2d\uff0cfalse\u8868\u793a\u6d88\u606f\u8986\u76d6\u6307\u5b9a\u7684\u6587\u4ef6\u5185\u5bb9\uff0c\u9ed8\u8ba4\u503c\u662ftrue --\x3e\n        <File name="fileAppender" fileName="log/test.log" append="false">\n            <PatternLayout pattern="[%d{HH:mm:ss.SSS}] [%-5p] %l - %m%n"/>\n        </File>\n\n        \x3c!--\u6dfb\u52a0\u8fc7\u6ee4\u5668ThresholdFilter,\u53ef\u4ee5\u6709\u9009\u62e9\u7684\u8f93\u51fa\u67d0\u4e2a\u7ea7\u522b\u4ee5\u4e0a\u7684\u7c7b\u522b  onMatch="ACCEPT" onMismatch="DENY"\u610f\u601d\u662f\u5339\u914d\u5c31\u63a5\u53d7,\u5426\u5219\u76f4\u63a5\u62d2\u7edd  --\x3e\n        <File name="ERROR" fileName="logs/error.log">\n            <ThresholdFilter level="error" onMatch="ACCEPT" onMismatch="DENY"/>\n            <PatternLayout pattern="[%d{yyyy.MM.dd \'at\' HH:mm:ss z}] [%-5p] %l - %m%n"/>\n        </File>\n\n        \x3c!--\u8fd9\u4e2a\u4f1a\u6253\u5370\u51fa\u6240\u6709\u7684\u4fe1\u606f\uff0c\u6bcf\u6b21\u5927\u5c0f\u8d85\u8fc7size\uff0c\u5219\u8fd9size\u5927\u5c0f\u7684\u65e5\u5fd7\u4f1a\u81ea\u52a8\u5b58\u5165\u6309\u5e74\u4efd-\u6708\u4efd\u5efa\u7acb\u7684\u6587\u4ef6\u5939\u4e0b\u9762\u5e76\u8fdb\u884c\u538b\u7f29\uff0c\u4f5c\u4e3a\u5b58\u6863 --\x3e\n        <RollingFile name="rollingFile" fileName="logs/app.log"\n                     filePattern="logs/$${date:yyyy-MM}/web-%d{yyyy-MM-dd}.log.gz">\n            <PatternLayout pattern="[%d{yyyy-MM-dd HH:mm:ss}] [%-5p] %l - %m%n"/>\n            <Policies>\n                <TimeBasedTriggeringPolicy modulate="true" interval="1"/>\n            </Policies>\n            <DefaultRolloverStrategy>\n                <Delete basePath="logs" maxDepth="2">\n                    <IfFileName glob="*/*.log.gz" />\n                    <IfLastModified age="7d" />\n                </Delete>\n            </DefaultRolloverStrategy>\n        </RollingFile>\n    </appenders>\n\n    \x3c!--\u7136\u540e\u5b9a\u4e49logger\uff0c\u53ea\u6709\u5b9a\u4e49\u4e86logger\u5e76\u5f15\u5165\u7684appender\uff0cappender\u624d\u4f1a\u751f\u6548 --\x3e\n    <loggers>\n        \x3c!--\u8fc7\u6ee4\u6389spring\u548cmybatis\u7684\u4e00\u4e9b\u65e0\u7528\u7684DEBUG\u4fe1\u606f--\x3e\n        <logger name="defaultLogger" additivity="false">\n            <appender-ref ref="AsyncDefault"></appender-ref>\n        </logger>\n\n        <logger name="includeLocationLogger" additivity="false">\n            <appender-ref ref="AsyncIncludeLocation"></appender-ref>\n        </logger>\n\n        \x3c!--\u5efa\u7acb\u4e00\u4e2a\u9ed8\u8ba4\u7684root\u7684logger --\x3e\n        <root level="INFO">\n\n        </root>\n    </loggers>\n\n</configuration>\n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u6211\u4eec\u90fd\u662f\u7528\u4e86\u4e00\u4e2a",(0,l.jsx)(n.code,{children:"AsyncAppender"}),"\u5957\u7528\u4e86\u4e00\u4e2a",(0,l.jsx)(n.code,{children:"FileAppender"}),"\u3002\u67e5\u770b",(0,l.jsx)(n.code,{children:"fileAppender"}),"\uff0c\u53d1\u73b0\u4e8c\u8005\u76f8\u540c\u5b8c\u5168\u6ca1\u533a\u522b\uff0c\u53ea\u6709",(0,l.jsx)(n.code,{children:"asyncAppender"}),"\u4e2d\u7684\u4e00\u4e2a\u9009\u9879\u6709\u533a\u522b\uff0c\u8fd9\u5c31\u662f",(0,l.jsx)(n.code,{children:"includeLocation"}),"\uff0c\u4e00\u4e2a\u662f",(0,l.jsx)(n.code,{children:"false"}),"\uff0c\u53e6\u4e00\u4e2a\u662f",(0,l.jsx)(n.code,{children:"true"}),"\u3002\u81f3\u4e8e\u8fd9\u4e2a\u53c2\u6570\u7684\u542b\u4e49\uff0c\u6211\u4eec\u6682\u65f6\u4e0d\u8ba8\u8bba\uff0c\u6211\u4eec\u73b0\u5728\u77e5\u9053\u95ee\u9898\u53ef\u80fd\u51fa\u5728",(0,l.jsx)(n.code,{children:"AsyncAppender"}),"\u91cc\u9762\uff0c\u4f46\u662f\u6211\u4eec\u8be5\u5982\u4f55\u9a8c\u8bc1\u5462\u3002",(0,l.jsx)(n.code,{children:"trace"}),"\u547d\u4ee4\u5c31\u6709\u4e86\u5927\u7528\u573a\u3002"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"trace"}),"\u547d\u4ee4\u7684\u57fa\u672c\u7528\u6cd5\u4e0emonitor\u7c7b\u4f3c\uff0c\u5176\u4e2d\u4e3b\u8981\u7684\u4e00\u4e2a\u53c2\u6570\u662f",(0,l.jsx)(n.code,{children:"-n"}),"\u5219\u662f\u4ee3\u8868",(0,l.jsx)(n.code,{children:"trace"}),"\u591a\u5c11\u6b21\u7684\u610f\u601d"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"trace -n trace_times className methodName\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u6211\u5728\u4e4b\u524d",(0,l.jsx)(n.code,{children:"Log4j2"}),"\u7684\u76f8\u5173\u535a\u5ba2\u91cc\u9762\u8bb2\u5230\u8fc7\uff0c\u4efb\u4f55\u4e00\u4e2a",(0,l.jsx)(n.code,{children:"appender"}),"\uff0c\u6700\u6838\u5fc3\u7684\u65b9\u6cd5\u5c31\u662f\u4ed6\u7684",(0,l.jsx)(n.code,{children:"append"}),"\u65b9\u6cd5\u3002\u6240\u4ee5\u6211\u4eec\u5206\u522b",(0,l.jsx)(n.code,{children:"trace"}),"\u4e24\u4e2a\u7a0b\u5e8f\u7684",(0,l.jsx)(n.code,{children:"append"}),"\u65b9\u6cd5\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"trace -n 5 org.apache.logging.log4j.core.appender.AsyncAppender append\n"})}),"\n",(0,l.jsx)(n.p,{children:"trace\u7ed3\u679c\u5982\u4e0b"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u666e\u901aappender"}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528include appender"}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsxs)(n.p,{children:["\u6211\u4eec\u7acb\u523b\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e24\u4e2atrace\u7684\u70ed\u70b9\u65b9\u6cd5\u4e0d\u4e00\u6837\uff0c\u5728\u4f7f\u7528",(0,l.jsx)(n.code,{children:"include"}),"\u7684",(0,l.jsx)(n.code,{children:"appender"}),"\u4e2d\uff0c\u8017\u65f6\u6700\u957f\u7684\u65b9\u6cd5\u65f6",(0,l.jsx)(n.code,{children:"org.apache.logging.log4j.core.impl.Log4jLogEvent"}),"\u7c7b\u4e2d\u7684",(0,l.jsx)(n.code,{children:"createMemento"}),"\u65b9\u6cd5\uff0c\u90a3\u4e48\u600e\u4e48\u624d\u80fd\u77e5\u9053\u8fd9\u4e2a\u65b9\u6cd5\u5230\u5e95\u505a\u4e86\u5565\u5462\uff0c\u90a3\u5c31\u8bf7\u51fa\u6211\u4eec\u4e0b\u4e00\u4e2a\u5e38\u7528\u547d\u4ee4jad\uff0c\u8fd9\u4e2a\u547d\u4ee4\u80fd\u591f\u53cd\u7f16\u8bd1\u51fa\u5bf9\u5e94\u65b9\u6cd5\u7684\u4ee3\u7801\u3002\u8fd9\u91cc\u6211\u4eecjad\u4e00\u4e0b\u4e0a\u9762\u8bf4\u7684\u90a3\u4e2a",(0,l.jsx)(n.code,{children:"createMemento"}),"\u65b9\u6cd5\uff0c\u547d\u4ee4\u5f88\u7b80\u5355"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"jad org.apache.logging.log4j.core.impl.Log4jLogEvent createMemento\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7ed3\u679c\u5982\u4e0b"}),"\n",(0,l.jsxs)(n.p,{children:["helloworld\u7ed3\u679c\n\u6211\u4eec\u53d1\u73b0\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e2d\u6709\u4e2a",(0,l.jsx)(n.code,{children:"includeLocation"}),"\u53c2\u6570\uff0c\u8fd9\u4e2a\u548c\u6211\u4eec\u7684\u770b\u5230\u7684\u4e24\u4e2a",(0,l.jsx)(n.code,{children:"appender"}),"\u7684\u552f\u4e00\u4e0d\u540c\u7684\u914d\u7f6e\u76f8\u543b\u5408\uff0c\u6211\u4eec\u6b64\u65f6\u5e94\u8be5\u6709\u8fd9\u4e2a\u731c\u60f3\uff0c\u4f1a\u4e0d\u4f1a\u5c31\u662f\u8fd9\u4e2a\u53c2\u6570\u5bfc\u81f4\u7684\u5462\uff1f\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e2a\u731c\u60f3\uff0c\u6211\u4eec\u5f15\u51fa\u4e0b\u4e00\u4e2a\u547d\u4ee4,watch"]}),"\n",(0,l.jsx)(n.h3,{id:"watch\u547d\u4ee4",children:"watch\u547d\u4ee4"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"watch"}),"\u547d\u4ee4\u80fd\u591f\u89c2\u5bdf\u5230\u67d0\u4e2a\u7279\u5b9a\u65b9\u6cd5\u7684\u5165\u53c2\uff0c\u8fd4\u56de\u503c\u7b49\u4fe1\u606f\uff0c\u6211\u4eec\u4f7f\u7528\u8fd9\u4e2a\u547d\u4ee4\u67e5\u770b\u4e00\u4e0b\u8fd9\u4e2a",(0,l.jsx)(n.code,{children:"createMemento"}),"\u65b9\u6cd5\u7684\u5165\u53c2\uff0c\u5982\u679c\u4e24\u4e2a\u7a0b\u5e8f\u7684\u5165\u53c2\u4e0d\u540c\uff0c\u90a3\u57fa\u672c\u53ef\u4ee5\u65ad\u5b9a\u662f\u8fd9\u4e2a\u539f\u56e0\u5f15\u8d77\u547d\u4ee4\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'watch org.apache.logging.log4j.core.impl.Log4jLogEvent createMemento "params" -x 2 -n 5 -b -f\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u9762\u7684\u53c2\u6570\u542b\u4e49\u5982\u4e0b"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"-x \u53c2\u6570\u5c55\u5f00\u5c42\u6b21"}),"\n",(0,l.jsx)(n.li,{children:"-n \u6267\u884c\u6b21\u6570"}),"\n",(0,l.jsx)(n.li,{children:"-b \u67e5\u770b\u65b9\u6cd5\u8c03\u7528\u524d\u72b6\u6001"}),"\n",(0,l.jsx)(n.li,{children:"-f \u65b9\u6cd5\u8c03\u7528\u540e"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u5176\u4e2d\u7684param\u4ee3\u8868\u67e5\u770b\u65b9\u6cd5\u7684\u8c03\u7528\u53c2\u6570\u5217\u8868\uff0c\u8fd8\u6709\u5176\u4ed6\u7684\u76d1\u63a7\u9879\u8be6\u89c1\u5b98\u7f51\u5b98\u7f51"}),"\n",(0,l.jsx)(n.p,{children:"\u6700\u7ec8watch\u7ed3\u679c\u5982\u4e0b"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u666e\u901alogger"}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528include"}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsxs)(n.p,{children:["\u679c\u4e0d\u5176\u7136\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u679c\u7136\u662f\u4e00\u4e2atrue\u4e00\u4e2afalse\uff0c\u6211\u4eec\u7b80\u5355\u770b\u4e0b\u8fd9\u4e2a\u53c2\u6570\u662f\u5982\u4f55\u4f20\u8fdb\u6765\u7684\uff0c\u6211\u4eecjad\u4e00\u4e0b",(0,l.jsx)(n.code,{children:"AsyncAppender"}),"\u7684",(0,l.jsx)(n.code,{children:"append"}),"\u65b9\u6cd5"]}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsxs)(n.p,{children:["\u6211\u4eec\u53d1\u73b0\u8fd9\u4e2a",(0,l.jsx)(n.code,{children:"includeLocation"}),"\u6b63\u662f",(0,l.jsx)(n.code,{children:"appender"}),"\u7684\u4e00\u4e2a\u5c5e\u6027\uff0c\u4e5f\u5c31\u662f\u6211\u4eecxml\u4e2d\u914d\u7f6e\u7684\u90a3\u4e2a\u5c5e\u6027\u3002\u67e5\u770b\u5b98\u7f51\u7684\u76f8\u5173\u5206\u6790\uff0c\u6211\u4eec\u770b\u5230\u8fd9\u4e2a\u53c2\u6570\u4f1a\u4f7flog\u7684\u6027\u80fd\u4e0b\u964d5\u201310\u500d"]}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0d\u8fc7\u4e3a\u4e86\u4e00\u63a2\u7a76\u7adf\uff0c\u6211\u8fd8\u662f\u9759\u6001\u8ddf\u4e86\u4e00\u4e0b\u8fd9\u6bb5\u4ee3\u7801"}),"\n",(0,l.jsxs)(n.p,{children:["\u8fd9\u4e2a",(0,l.jsx)(n.code,{children:"includeLocation"}),"\u4f1a\u5728event\u7684",(0,l.jsx)(n.code,{children:"createMemento"}),"\u4e2d\u88ab\u7528\u5230\uff0c\u5728\u5e8f\u5217\u5316\u751f\u6210\u5bf9\u8c61\u65f6\u4f1a\u521b\u5efa\u4e00\u4e2aLogEventProxy\uff0c\u4ee3\u7801\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"public LogEventProxy(final LogEvent event, final boolean includeLocation) {\n    this.loggerFQCN = event.getLoggerFqcn();\n    this.marker = event.getMarker();\n    this.level = event.getLevel();\n    this.loggerName = event.getLoggerName();\n\n    final Message msg = event.getMessage();\n    this.message = msg instanceof ReusableMessage\n            ? memento((ReusableMessage) msg)\n            : msg;\n    this.timeMillis = event.getTimeMillis();\n    this.thrown = event.getThrown();\n    this.thrownProxy = event.getThrownProxy();\n    this.contextData = memento(event.getContextData());\n    this.contextStack = event.getContextStack();\n    this.source = includeLocation ? event.getSource() : null;\n    this.threadId = event.getThreadId();\n    this.threadName = event.getThreadName();\n    this.threadPriority = event.getThreadPriority();\n    this.isLocationRequired = includeLocation;\n    this.isEndOfBatch = event.isEndOfBatch();\n    this.nanoTime = event.getNanoTime();\n}\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5982\u679c",(0,l.jsx)(n.code,{children:"includeLocation"}),"\u4e3atrue\uff0c\u90a3\u4e48\u5c31\u4f1a\u8c03\u7528",(0,l.jsx)(n.code,{children:"getSource"}),"\u51fd\u6570\uff0c\u8ddf\u8fdb\u53bb\u67e5\u770b\uff0c\u4ee3\u7801\u5982\u4e0b"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"    public StackTraceElement getSource() {\n        if (source != null) {\n            return source;\n        }\n        if (loggerFqcn == null || !includeLocation) {\n            return null;\n        }\n        source = Log4jLogEvent.calcLocation(loggerFqcn);\n        return source;\n    }\n     public static StackTraceElement calcLocation(final String fqcnOfLogger) {\n        if (fqcnOfLogger == null) {\n            return null;\n        }\n        // LOG4J2-1029 new Throwable().getStackTrace is faster than Thread.currentThread().getStackTrace().\n        final StackTraceElement[] stackTrace = new Throwable().getStackTrace();\n        StackTraceElement last = null;\n        for (int i = stackTrace.length - 1; i > 0; i--) {\n            final String className = stackTrace[i].getClassName();\n            if (fqcnOfLogger.equals(className)) {\n                return last;\n            }\n            last = stackTrace[i];\n        }\n        return null;\n    }\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u4eec\u770b\u5230\u4ed6\u4f1a\u4ece\u6574\u4e2a\u7684\u8c03\u7528\u6808\u4e2d\u53bb\u5bfb\u627e\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u4ee3\u7801\u884c\uff0c\u5176\u6027\u80fd\u53ef\u60f3\u800c\u77e5\u3002\u6211\u4eec\u7528arthas\u76d1\u63a7\u4e00\u4e0b\uff0c\u9a8c\u8bc1\u4e00\u4e0b\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u9996\u5148\u6211\u4eectrace crateMemento\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"trace -n 5 org.apache.logging.log4j.core.impl.Log4jLogEvent createMemento\n"})}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsxs)(n.p,{children:["\u53d1\u73b0\u70ed\u70b9\u65b9\u6cd5\u65f6",(0,l.jsx)(n.code,{children:"org.apache.logging.log4j.core.impl.Log4jLogEvent"}),"\u7684",(0,l.jsx)(n.code,{children:"serialize()"}),"\uff0c\u7ee7\u7eed",(0,l.jsx)(n.code,{children:"trace"}),"\u4e0b\u53bb"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"trace -n 5 org.apache.logging.log4j.core.impl.Log4jLogEvent serialize\n"})}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsxs)(n.p,{children:["\u770b\u5230\u70ed\u70b9\u662f",(0,l.jsx)(n.code,{children:"org.apache.logging.log4j.core.impl.Log4jLogEvent:LogEventProxy"}),"\u7684\u6784\u9020\u65b9\u6cd5\uff0c\u7ee7\u7eed",(0,l.jsx)(n.code,{children:"trace"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"trace -n 5 org.apache.logging.log4j.core.impl.Log4jLogEvent$LogEventProxy <init>\n"})}),"\n",(0,l.jsx)(n.p,{children:"helloworld\u7ed3\u679c"}),"\n",(0,l.jsxs)(n.p,{children:["\u53d1\u73b0\u662f",(0,l.jsx)(n.code,{children:"getSourc"}),"e\u65b9\u6cd5\uff0c\u7ee7\u7eed"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"trace -n 5 trace -n 5 org.apache.logging.log4j.core.LogEvent getSource\n"})}),"\n",(0,l.jsxs)(n.p,{children:["helloworld\u7ed3\u679c\n\u70ed\u70b9\u7ec8\u4e8e\u5b9a\u4f4d\u5230\u4e86\uff0c\u662f",(0,l.jsx)(n.code,{children:"org.apache.logging.log4j.core.impl.Log4jLogEvent"}),"\u7684",(0,l.jsx)(n.code,{children:"calcLocation"}),"\u51fd\u6570\uff0c\u548c\u6211\u4eec\u9759\u6001\u8ddf\u8e2a\u7684\u4ee3\u7801\u4e00\u6837\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u81f3\u6b64\u6211\u4eec\u901a\u8fc7\u7ed3\u5408JMH\u548carthas\u5171\u540c\u5b9a\u4f4d\u51fa\u4e86\u4e00\u4e2a\u7ebf\u4e0a\u7684\u6027\u80fd\u95ee\u9898\u3002\u4e0d\u8fc7\u6211\u4ecb\u7ecd\u7684\u53ea\u662f\u51b0\u5c71\u4e00\u89d2\uff0c\u66f4\u591a\u5e38\u7528\u7684\u547d\u4ee4\u8fd8\u5e0c\u671b\u5927\u5bb6\u901a\u8fc7\u5b98\u7f51\u81ea\u5df1\u4e86\u89e3\u548c\u5b9e\u8df5\uff0c\u6709\u4e86\u51e0\u6b21\u4eb2\u8eab\u5b9e\u8df5\u4e4b\u540e\uff0c\u8fd9\u4e2a\u5de5\u5177\u4e5f\u5c31\u73a9\u719f\u4e86\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u771f\u4e0d\u5bb9\u6613\uff0c\u73b0\u5728\u5df2\u7ecf\u662f\u6df1\u591c\uff0c\u53c8\u5b8c\u6210\u4e86\u4e00\u7bc7\u535a\u5ba2\u7684\u64b0\u5199\uff0c\u5fc3\u91cc\u7f8e\u6ecb\u6ecb\u3002\u5927\u5bb6\u665a\u5b89\uff01\uff01"})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);