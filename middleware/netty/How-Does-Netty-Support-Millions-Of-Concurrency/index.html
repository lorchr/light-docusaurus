<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-middleware docs-version-current docs-doc-page docs-doc-id-netty/How-Does-Netty-Support-Millions-Of-Concurrency" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">How-Does-Netty-Support-Millions-Of-Concurrency | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/middleware/netty/How-Does-Netty-Support-Millions-Of-Concurrency/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" property="og:title" content="How-Does-Netty-Support-Millions-Of-Concurrency | Light Docusaurus"><meta data-rh="true" name="description" content="- Netty如何做到单机百万并发？"><meta data-rh="true" property="og:description" content="- Netty如何做到单机百万并发？"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/middleware/netty/How-Does-Netty-Support-Millions-Of-Concurrency/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/middleware/netty/How-Does-Netty-Support-Millions-Of-Concurrency/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/middleware/netty/How-Does-Netty-Support-Millions-Of-Concurrency/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e8086d6f.css">
<script src="/assets/js/runtime~main.6257abc0.js" defer="defer"></script>
<script src="/assets/js/main.34b50ab8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a class="navbar__item navbar__link" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/middleware/netty/How-Does-Netty-Support-Millions-Of-Concurrency/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/middleware/">MiddleWare</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/compare/">Compare</a><button aria-label="展开侧边栏分类 &#x27;Compare&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/mysql/">Mysql</a><button aria-label="展开侧边栏分类 &#x27;Mysql&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/postgresql/">Postgresql</a><button aria-label="展开侧边栏分类 &#x27;Postgresql&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/redis/">Redis</a><button aria-label="展开侧边栏分类 &#x27;Redis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/nginx/">Nginx</a><button aria-label="展开侧边栏分类 &#x27;Nginx&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/middleware/category/netty/">Netty</a><button aria-label="折叠侧边栏分类 &#x27;Netty&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/middleware/netty/How-Does-Netty-Support-Millions-Of-Concurrency/">How-Does-Netty-Support-Millions-Of-Concurrency</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/mqtt/">MQTT</a><button aria-label="展开侧边栏分类 &#x27;MQTT&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/influxdb/">InfluxDB</a><button aria-label="展开侧边栏分类 &#x27;InfluxDB&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/kafka/">Kafka</a><button aria-label="展开侧边栏分类 &#x27;Kafka&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/rabbitmq/">RabbitMQ</a><button aria-label="展开侧边栏分类 &#x27;RabbitMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/rocketmq/">RocketMQ</a><button aria-label="展开侧边栏分类 &#x27;RocketMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/workflow/">Workflow</a><button aria-label="展开侧边栏分类 &#x27;Workflow&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/plusar/">Plusar</a><button aria-label="展开侧边栏分类 &#x27;Plusar&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/shardingsphere/">ShardingSphere</a><button aria-label="展开侧边栏分类 &#x27;ShardingSphere&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/middleware/category/netty/"><span itemprop="name">Netty</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">How-Does-Netty-Support-Millions-Of-Concurrency</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>How-Does-Netty-Support-Millions-Of-Concurrency</h1></header><ul>
<li><a href="https://mp.weixin.qq.com/s/SbaTric6zLs0wL_o46nHQA" target="_blank" rel="noopener noreferrer">Netty如何做到单机百万并发？</a></li>
</ul>
<p>说到Netty，我们知道他极其强悍的性能以及纯异步模型，释放出了极强的生产力，内置的各种编解码编排，心跳包检测，粘包拆包处理等，高效且易于使用，以至于很多耳熟能详的组件都在使用，比如<code>hadoop</code>，<code>dubbo</code>等。但是他是如何做到这些的呢？本章将会以庖丁解牛的方式，一步一步的来拔出此剑。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="netty的异步模型">Netty的异步模型<a href="#netty的异步模型" class="hash-link" aria-label="Netty的异步模型的直接链接" title="Netty的异步模型的直接链接">​</a></h2>
<p>说起netty的异步模型，我相信大多数人，只要是写过服务端的话，都是耳熟能详的，<code>bossGroup</code>和<code>workerGroup</code>被<code>ServerBootstrap</code>所驱动，用起来简直是如虎添翼，再加上各种配置化的<code>handler</code>加持，组装起来也是行云流水，俯拾即是。但是，任何一个好的架构，都不是一蹴而就实现的，那她经历了怎样的心路历程呢？</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-经典的多线程模型">1. 经典的多线程模型<a href="#1-经典的多线程模型" class="hash-link" aria-label="1. 经典的多线程模型的直接链接" title="1. 经典的多线程模型的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="668" height="184" class="img_ev3q"></p>
<p>此模型中，服务端起来后，客户端连接到服务端，服务端会为每个客户端开启一个线程来进行后续的读写操作。客户端少的时候，整体性能和功能还是可以的，但是如果客户端非常多的时候，线程的创建将会导致内存的急剧飙升从而导致服务端的性能下降，严重者会导致新客户端连接不上来，更有甚者，服务器直接宕机。此模型虽然简单，但是由于其简单粗暴，所以难堪大用，建议在写服务端的时候，要彻底的避免此种写法。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-经典的reactor模型">2. 经典的Reactor模型<a href="#2-经典的reactor模型" class="hash-link" aria-label="2. 经典的Reactor模型的直接链接" title="2. 经典的Reactor模型的直接链接">​</a></h3>
<p>由于多线程模型难堪大用，所以更好的模型一直在研究之中，<code>Reactor</code>模型，作为天选之子，也被引入了进来，由于其强大的基于事件处理的特性，使得其成为异步模型的不二之选，其起源可以参考这篇文章。</p>
<p><code>Reactor</code>模型由于是基于事件处理的，所以一旦有事件被触发，将会派发到对应的<code>event handler</code>中进行处理。所以在此模型中，有两个最重要的参与者，列举如下：</p>
<ul>
<li>
<p><code>Reactor</code>：主要用来将IO事件派发到相对应的<code>handler</code>中，可以将其想象为打电话时候的分发总机，你先打电话到总机号码，然后通过总机，你可以分拨到各个分机号码。</p>
</li>
<li>
<p><code>Handlers</code>：主要用来处理IO事件相关的具体业务，可以将其想象为拨通分机号码后，实际上为你处理事件的员工。</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-2-54ca17939c53a1999dd2bc647dce011e.webp" width="359" height="227" class="img_ev3q"></p>
<p>上图  为<code>Reactor</code>模型的描述图，具体来说一下：</p>
<p><code>Initiation Dispatcher</code>其实扮演的就是<code>Reactor</code>的角色，主要进行<code>Event Demultiplexer</code>，即事件派发。而其内部一般都有一个<code>Acceptor</code>，用于通过对系统资源的操纵来获取资源句柄，然后交由<code>Reactor</code>，通过<code>handle_events</code>方法派发至具体的<code>EventHandler</code>的。</p>
<p><code>Synchronous Event Demultiplexer</code>其实就是<code>Acceptor</code>的角色，此角色内部通过调用系统的方法来进行资源操作，比如说，假如客户端连接上来，那么将会获得当前连接，假如需要删除文件，那么将会获得当前待操作的文件句柄等等。这些句柄实际上是要返回给<code>Reactor</code>的，然后经由<code>Reactor</code>派发下放给具体的<code>EventHandler</code>。</p>
<p><code>Event Handler</code>这里，其实就是具体的事件操作了。其内部针对不同的业务逻辑，拥有不同的操作方法，比如说，鉴权<code>EventHandler</code>会检测传入的连接，验证其是否在白名单，心跳包<code>EventHanler</code>会检测管道是否空闲，业务<code>EventHandler</code>会进行具体的业务处理，编解码<code>EventHandler</code>会对当前连接传输的内容进行编码解码操作等等。</p>
<p>由于Netty是<code>Reactor</code>模型的具体实现，所以在编码的时候，我们可以非常清楚明白的理解<code>Reactor</code>的具体使用方式，这里暂时不讲，后面会提到。</p>
<p>由于Doug Lea写过一篇关于NIO的文章，整体总结的极好，所以这里我们就结合他的文章来详细分析一下<code>Reactor</code>模型的演化过程。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-3-2dcb2381a3ef4d25369d3ff0983bed84.webp" width="354" height="143" class="img_ev3q"></p>
<p>上图模型为单线程<code>Reator</code>模型，<code>Reactor</code>  模型会利用给定的<code>selectionKeys</code>进行派发操作，派发到给定的<code>handler</code>，之后当有客户端连接上来的时候，<code>acceptor</code>会进行<code>accept</code>接收操作，之后将接收到的连接和之前派发的<code>handler</code>进行组合并启动。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-4-050414bf87197b74044873f01809bb80.webp" width="353" height="248" class="img_ev3q"></p>
<p>上图模型为池化Reactor模型，此模型将读操作和写操作解耦了出来，当有数据过来的时候，将<code>handler</code>的系列操作扔到线程池中来进行，极大的提到了整体的吞吐量和处理速度。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-5-d7688d89758ba415398127826386c7d9.webp" width="354" height="246" class="img_ev3q"></p>
<p>上图模型为多<code>Reactor</code>模型，此模型中，将原本单个<code>Reactor</code>一分为二，分别为<code>mainReactor</code>和<code>subReactor</code>，其中<code>mainReactor</code>主要进行客户端连接方面的处理，客户端<code>accept</code>后发送给<code>subReactor</code>进行后续处理处理。这种模型的好处就是整体职责更加明确，同时对于多CPU的机器，系统资源的利用更加高一些。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-6-cd796b21f2daeead1d97c4a6f4a60f91.webp" width="811" height="532" class="img_ev3q"></p>
<p>从netty写的<code>server</code>端，就可以看出，<code>boss worker group</code>对应的正是主副Reactor，之后<code>ServerBootstrap</code>进行<code>Reactor</code>的创建操作，里面的<code>group</code>, <code>channel</code>, <code>option</code>等进行初始化操作，而设置的<code>childHandler</code>则是具体的业务操作，其底层的事件分发器则通过调用linux系统级接口epoll来实现连接并将其传给<code>Reactor</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="石中剑netty强悍的原理-jni">石中剑Netty强悍的原理 （JNI）<a href="#石中剑netty强悍的原理-jni" class="hash-link" aria-label="石中剑Netty强悍的原理 （JNI）的直接链接" title="石中剑Netty强悍的原理 （JNI）的直接链接">​</a></h2>
<p>netty之剑之所以锋利，不仅仅因为其纯异步的编排模型，避免了各种阻塞式的操作，同时其内部各种设计精良的组件，终成一统。且不说让人眼前一亮的缓冲池设计，读写标随心而动，摒弃了繁冗复杂的边界检测，用起来着实舒服之极；原生的流控和高低水位设计，让流速控制真的是随心所欲，铸就了一道相当坚固的护城河；齐全的粘包拆包处理方式，让每一笔数据都能够清晰明了；而高效的空闲检测机制，则让心跳包和断线重连等设计方案变得如此俯拾即是</p>
<p>上层的设计如此优秀，其性能又怎能甘居下风。由于底层通讯方式完全是C语言编写，然后利用JNI机制进行处理，所以整体的性能可以说是达到了原生C语言性能的强悍程度。说道JNI，这里我觉得有必要详细说一下，他是我们利用java直接调用c语言原生代码的关键。</p>
<p>JNI，全称为<code>Java Native Interface</code>，翻译过来就是java本地接口，他是java调用C语言的一套规范。具体来看看怎么做的吧。</p>
<p>步骤一，先来写一个简单的java调用函数：</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @author shichaoyang</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @Description: 数据同步器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @date 2020-10-14 19:41</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DataSynchronizer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 加载本地底层C实现库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.loadLibrary(&quot;synchronizer&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 底层数据同步方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private native String syncData(String status);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 程序启动，调用底层数据同步方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * @param args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String... args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String rst = new DataSynchronizer().syncData(&quot;ProcessStep2&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;The execute result from C is : &quot; + rst);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看出，是一个非常简单的java类，此类中，<code>syncData</code>方法前面带了<code>native</code>修饰，代表此方法最终将会调用底层C语言实现。<code>main</code>方法是启动类，将C语言执行的结果接收并打印出来。</p>
<p>然后，打开我们的linux环境，这里由于我用的是<code>linux mint</code>，依次执行如下命令来设置环境：</p>
<ol>
<li>执行<code>apt install default-jdk</code> 安装java环境，安装完毕。</li>
<li>通过<code>update-alternatives --list java</code> 获取java安装路径，这里为：<code>/usr/lib/jvm/java-11-openjdk-amd64</code></li>
<li>设置java环境变量 <code>export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64</code></li>
</ol>
<p>环境设置完毕之后，就可以开始进行下一步了。</p>
<p>步骤二，编译</p>
<p>首先，进入到代码<code>DataSynchronizer.c</code>所在的目录，然后运行如下命令来编译java源码：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">javac -h . DataSynchronizer.java</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编译完毕之后，可以看到当前目录出现了如下几个文件：</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="294" height="98" class="img_ev3q"></p>
<p>其中<code>DataSynchronizer.h</code>是生成的头文件，这个文件尽量不要修改，整体内容如下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* DO NOT EDIT THIS FILE - it is machine generated */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;jni.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* Header for class DataSynchronizer */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifndef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">_Included_DataSynchronizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">_Included_DataSynchronizer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifdef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">__cplusplus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">extern</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Class:     DataSynchronizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Method:    syncData</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * Signature: (Ljava/lang/String;)Ljava/lang/String;</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JNIEXPORT jstring JNICALL </span><span class="token function" style="color:#d73a49">Java_DataSynchronizer_syncData</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JNIEnv </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobject</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jstring</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifdef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">__cplusplus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中<code>JNIEXPORT jstring JNICALL Java_DataSynchronizer_syncData</code>方法，就是给我们生成的本地C语言方法，我们这里只需要创建一个C语言文件，名称为<code>DataSynchronizer.c</code>，将此头文件加载进来，实现此方法即可：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;jni.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;DataSynchronizer.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JNIEXPORT jstring JNICALL </span><span class="token function" style="color:#d73a49">Java_DataSynchronizer_syncData</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">JNIEnv </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jobject obj</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> jstring str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Step 1: Convert the JNI String (jstring) into C-String (char*)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">inCStr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetStringUTFChars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> inCStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Step 2: Perform its intended operations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;In C, the received string is: %s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inCStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">ReleaseStringUTFChars</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inCStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// release resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Prompt user for a C-string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> outCStr</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Enter a String: &quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">scanf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outCStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Step 3: Convert the C-string (char*) into JNI String (jstring) and return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">NewStringUTF</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> outCStr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中需要注意的是，<code>JNIEnv*</code>变量，实际上指的是当前的JNI环境。而<code>jobject</code>变量则类似<code>java</code>中的<code>this</code>关键字。<code>jstring</code>则是c语言层面上的字符串，相当于<code>java</code>中的<code>String</code>。整体对应如下</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-8-f129d209a41a78c0dc15648c42121830.webp" width="582" height="409" class="img_ev3q"></p>
<p>最后，我们来编译一下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -fPIC -I&quot;$JAVA_HOME/include&quot; -I&quot;$JAVA_HOME/include/linux&quot; -shared -o libsynchronizer.so DataSynchronizer.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>编译完毕后，可以看到当前目录下又多了一个<code>libsynchronizer.so</code>文件（这个文件类似windows上编译后生成的.dll类库文件）：</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="415" height="84" class="img_ev3q"></p>
<p>此时我们可以运行了，运行如下命令进行运行：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -Djava.library.path=. DataSynchronizer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>得到结果如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -Djava.library.path=. DataSynchronizer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">In C, the received string is: ProcessStep2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Enter a String: sdfsdf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The execute result from C is : sdfsdf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从这里看到，我们正确的通过java jni技术，调用了C语言底层的逻辑，然后获取到结果，打印了出来。在netty中，也是利用了jni的技术，然后通过调用底层的C语言逻辑实现，来实现高效的网络通讯的。感兴趣的同学可以扒拉下netty源码，在<code>transport-native-epoll</code>模块中，就可以见到具体的实现方法了。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-10-3695c6fa1be468b014b95670eb300d1a.webp" width="836" height="181" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="io多路复用模型">IO多路复用模型<a href="#io多路复用模型" class="hash-link" aria-label="IO多路复用模型的直接链接" title="IO多路复用模型的直接链接">​</a></h2>
<p>石中剑，之所以能荡平英格兰全境，自然有其最强悍的地方。相应的，Netty，则也是不遑多让，之所以能够被各大知名的组件所采用，自然也有其最强悍的地方，而本章节的IO多路复用模型，则是其强悍的理由之一。</p>
<p>在说IO多路复用模型之前，我们先来大致了解下Linux文件系统。在Linux系统中，不论是你的鼠标，键盘，还是打印机，甚至于连接到本机的socket client端，都是以文件描述符的形式存在于系统中，诸如此类，等等等等，所以可以这么说，一切皆文  件。来看一下系统定义的文件描述符说明：</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="566" height="138" class="img_ev3q"></p>
<p>从上面的列表可以看到，文件描述符0,1,2都已经被系统占用了，当系统启动的时候，这三个描述符就存在了。其中0代表标准输入，1代表标准输出，2代表错误输出。当我们创建新的文件描述符的时候，就会在2的基础上进行递增。可以这么说，文件描述符是为了管理被打开的文件而创建的系统索引，他代表了文件的身份ID。对标windows的话，你可以认为和句柄类似，这样就更容易理解一些。</p>
<p>由于网上对linux文件这块的原理描述的文章已经非常多了，所以这里我不再做过多的赘述，感兴趣的同学可以从Wikipedia翻阅一下。由于这块内容比较复杂，不属于本文普及的内容，建议读者另行自研，这里我非常推荐马士兵老师将linux文件系统这块，讲解的真的非常好。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="select模型">select模型<a href="#select模型" class="hash-link" aria-label="select模型的直接链接" title="select模型的直接链接">​</a></h2>
<p>此模型是IO多路复用的最早期使用的模型之一，距今已经几十年了，但是现在依旧有不少应用还在采用此种方式，可见其长生不老。首先来看下其具体的定义（来源于man二类文档）：
<code>int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *errorfds, struct timeval *timeout);</code>
这里解释下其具体参数：</p>
<ul>
<li>参数一：<code>nfds</code>，也即maxfd，最大的文件描述符递增一。这里之所以传最大描述符，为的就是在遍历fd_set的时候，限定遍历范围。</li>
<li>参数二：<code>readfds</code>，可读文件描述符集合。</li>
<li>参数三：<code>writefds</code>，可写文件描述符集合。</li>
<li>参数四：<code>errorfds</code>，异常文件描述符集合。</li>
<li>参数五：<code>timeout</code>，超时时间。在这段时间内没有检测到描 述符被触发，则返回。</li>
</ul>
<p>下面的宏处理，可以对fd_set集合（准确的说是bitmap，一个描述符有变更，则会在描述符对应的索引处置1）进行操作：</p>
<ul>
<li>
<p><code>FD_CLR(inr fd,fd_set* set)</code>      用来清除描述词组set中相关fd 的位，即bitmap结构中索引值为fd的值置为0。</p>
</li>
<li>
<p><code>FD_ISSET(int fd,fd_set *set)</code>   用来测试描述词组set中相关fd 的位是否为真，即bitmap结构中某一位是否为1。</p>
</li>
<li>
<p><code>FD_SET（int fd,fd_set*set）</code>   用来设置描述词组set中相关fd的位，即将bitmap结构中某一位设置为1，索引值为fd。</p>
</li>
<li>
<p><code>FD_ZERO（fd_set *set）</code>        用来清除描述词组set的全部位，即将bitmap结构全部清零。</p>
</li>
</ul>
<p>首先来看一段服务端采用了select模型的示例代码：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//创建server端套接字，获取文件描述符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listenfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">socket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PF_INET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">SOCK_STREAM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//绑定服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">bind</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//监听服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr_in</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socklen_t addr_len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//接收客户端连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">addr_len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//读缓冲区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//读文件操作符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fd_set read_fds</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//注意：每次调用select之前都要重新设置文件描述符connfd，因为文件描述符表会在内核中被修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">FD_ZERO</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">read_fds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">FD_SET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">read_fds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//注意：select会将用户态中的文件描述符表放到内核中进行修改，内核修改完毕后再返回给用户态，开销较大</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">read_fds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Fail to select!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//检测文件描述符表中相关请求是否可读</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">FD_ISSET</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">read_fds</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;receive %d bytes from client: %s \n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面的代码我加了比较详细的注释了，大家应该很容易看明白，说白了大概流程其实如下：</p>
<p>首先，创建socket套接字，创建完毕后，会获取到此套接字的文件描述符。</p>
<p>然后，bind到指定的地址进行监听listen。这样，服务端就在特定的端口启动起来并进行监听了。</p>
<p>之后，利用开启accept方法来监听客户端的连接请求。一旦有客户端连接，则将获取到当前客户端连接的connection文件描述符。</p>
<p>双方建立连接之后，就可以进行数据互传了。需要注意的是，在循环开始的时候，务必每次都要重新设置当前connection的文件描述符，是因为文件描描述符表在内核中被修改过，如果不重置，将会导致异常的情况。</p>
<p>重新设置文件描述符后，就可以利用select函数从文件描述符表中，来轮询哪些文件描述符就绪了。此时系统会将用户态的文件描述符表发送到内核态进行调整，即将准备就绪的文件描述符进行置位，然后再发送给用户态的应用中来。</p>
<p>用户通过FD_ISSET方法来轮询文件描述符，如果数据可读，则读取数据即可。</p>
<p>举个例子，假设此时连接上来了3个客户端，connection的文件描述符分别为 4,8,12，那么其<code>read_fds</code>文件描述符表（bitmap结构）的大致结构为 <code>00010001000100000....0</code>，由于<code>read_fds</code>文件描述符的长度为1024位，所以最多允许1024个连接。</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="748" height="122" class="img_ev3q"></p>
<p>而在select的时候，涉及到用户态和内核态的转换，所以整体转换方式如下：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-13-56365e3cf9293ee0fe9c0d2818f9ec3f.webp" width="749" height="405" class="img_ev3q"></p>
<p>所以，综合起来，select整体还是比较高效和稳定的，但是呈现出来的问题也不少，这些问题进一步限制了其性能发挥：</p>
<ol>
<li>文件描述符表为<code>bitmap</code>结构，且有长度为1024的限制。</li>
<li><code>fdset</code>无法做到重用，每次循环必须重新创建。</li>
<li>频繁的用户态和内核态拷贝，性能开销较大。</li>
<li>需要对文件描述符表进行遍历，<code>O(n)</code>的轮询时间复杂度。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="poll模型">poll模型<a href="#poll模型" class="hash-link" aria-label="poll模型的直接链接" title="poll模型的直接链接">​</a></h2>
<p>考虑到select模型的几个限制，后来进行了改进，这也就是poll模型，既然是select模型的改进版，那么肯定有其亮眼的地方，一起来看看吧。当然，这次我们依旧是先翻阅linux man二类文档，因为这是官方的文档，对其有着最为精准的定义。</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">pollfd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">fds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> nfds_t nfds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> timeout</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其实，从运行机制上说来，poll所做的功能和select是基本上一样的，都是等待并检测一组文件描述符就绪，然后在进行后续的IO处理工作。只不过不同的是，select中，采用的是bitmap结构，长度限定在1024位的文件描述符表，而poll模型则采用的是pollfd结构的数组fds，也正是由于poll模型采用了数组结构，则不会有1024长度限制，使其能够承受更高的并发。</p>
<p>pollfd结构内容如下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">pollfd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain">   fd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">/* 文件描述符 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">short</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">/* 关心的事件 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">short</span><span class="token plain"> revents</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 实际返回的事件 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从上面的结构可以看出，fd很明显就是指文件描述符，也就是当客户端连接上来后，fd会将生成的文件描述符保存到这里；而events则是指用户想关注的事件；<code>revents</code>则是指实际返回的事件，是由系统内核填充并返回，如果当前的fd文件描述符有状态变化，则<code>revents</code>的值就会有相应的变化。</p>
<p><code>events</code>事件列表如下：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-14-76a71d804598e1f6d5fd0da45e7ec5b5.webp" width="424" height="368" class="img_ev3q"></p>
<p><code>revents</code>事件列表如下：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-15-3495d02b4982686cffd3df014ad6c7c9.webp" width="426" height="496" class="img_ev3q"></p>
<p>从列表中可以看出，<code>revents</code>是包含<code>events</code>的。接下来结合示例来看一下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//创建server端套接字，获取文件描述符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listenfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">socket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PF_INET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">SOCK_STREAM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//绑定服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">bind</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//监听服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">pollfd</span><span class="token plain"> pollfds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socklen_t addr_len </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//接收客户端连接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listenfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">addr_len</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//放入fd数组</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pollfds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pollfds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> POLLIN</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//读缓冲区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buff</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//读文件操作符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fd_set read_fds</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** SELECT模型专用</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** 注意：每次调用select之前都要重新设置文件描述符connfd，因为文件描述符表会在内核中被修改</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** FD_ZERO(&amp;read_fds);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** FD_SET(connfd,&amp;read_fds);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        ** 注意：select会将用户态中的文件描述符表放到内核中进行修改，内核修改完毕后再返回给用户态，开销较大</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        ** ret = select(connfd+1,&amp;read_fds,NULL,NULL,NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">        **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">poll</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pollfds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Fail to poll!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** SELECT模型专用</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** 检测文件描述符表中相关请求是否可读</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** if(FD_ISSET(connfd, &amp;read_fds))</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** {</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         **   ret = recv(connfd,buff,sizeof(buff)-1,0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         **   printf(&quot;receive %d bytes from client: %s \n&quot;,ret,buff);</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         ** }</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">         **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//检测文件描述符数组中相关请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pollfds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">revents </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> POLLIN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pollfds</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">revents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;receive %d bytes from client: %s \n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">ret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">buff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于源码中，我做了比较详细的注释，同时将和select模型不一样的地方都列了出来，这里就不再详细解释了。总体说来，poll模型比select模型要好用一些，去掉了一些限制，但是仍然避免不了如下的问题：</p>
<ol>
<li>用户态和内核态仍需要频繁切换，因为<code>revents</code>的赋值是在内核态进行的，然后再推送到用户态，和select类似，整体开销较大。</li>
<li>仍需要遍历数组，时间复杂度为<code>O(N)</code>。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="epoll模型">epoll模型<a href="#epoll模型" class="hash-link" aria-label="epoll模型的直接链接" title="epoll模型的直接链接">​</a></h2>
<p>如果说select模型和poll模型是早期的产物，在性能上有诸多不尽人意之处，那么自linux 2.6之后新增的epoll模型，则彻底解决了性能问题，一举使得单机承受百万并发的课题变得极为容易。现在可以这么说，只需要一些简单的设置更改，然后配合上epoll的性能，实现单机百万并发轻而易举。同时，由于epoll整体的优化，使得之前的几个比较耗费性能的问题不再成为羁绊，所以也成为了linux平台上进行网络通讯的首选模型。</p>
<p>讲解之前，还是<code>linux man</code>文档镇楼：<code>linux man epoll 4类文档</code> <code>linux man epoll 7类文档</code>，俩文档结合着读，会对epoll有个大概的了解。和之前提到的select和poll不同的是，此二者皆属于系统调用函数，但是epoll则不然，他是存在于内核中的数据结构，可以通过<code>epoll_create</code>，<code>epoll_ctl</code>及<code>epoll_wait</code>三个函数结合来对此数据结构进行操控。</p>
<p>说道<code>epoll_create</code>函数，其作用是在内核中创建一个epoll数据结构实例，然后将返回此实例在系统中的文件描述符。此epoll数据结构的组成其实是一个链表结构，我们称之为<code>interest list</code>，里面会注册连接上来的client的文件描述符。</p>
<p>其简化工作机制如下：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-16-d447fe1f6f7dc281a1a544738cbbcd0d.webp" width="591" height="461" class="img_ev3q"></p>
<p>说道epoll_ctl函数，其作用则是对epoll实例进行增删改查操作。有些类似我们常用的CRUD操作。这个函数操作的对象其实就是epoll数据结构，当有新的client连接上来的时候，他会将此client注册到epoll中的<code>interest list</code>中，此操作通过附加<code>EPOLL_CTL_ADD</code>标记来实现；</p>
<p>当已有的client掉线或者主动下线的时候，他会将下线的client从epoll的<code>interest list</code>中移除，此操作通过附加<code>EPOLL_CTL_DEL</code>标记来实现；当有client的文件描述符有变更的时候，他会将events中的对应的文件描述符进行更新，此操作通过附加EPOLL_CTL_MOD来实现；当<code>interest list</code>中有client已经准备好了，可以进行IO操作的时候，他会将这些clients拿出来， 然后放到一个新的ready list里面。</p>
<p>其简化工作机制如下：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-17-fc70d24410713753df8c93bbe092945e.webp" width="587" height="502" class="img_ev3q"></p>
<p>说道epoll_wait函数，其作用就是扫描<code>ready list</code>，处理准备就绪的client IO，其返回结果即为准备好进行IO的client的个数。通过遍历这些准备好的client，就可以轻松进行IO处理了。</p>
<p>上面这三个函数是epoll操作的基本函数，但是，想要彻底理解epoll，则需要先了解这三块内容，即：<code>inode</code>，<code>链表</code>，<code>红黑树</code>。</p>
<p>在linux内核中，针对当前打开的文件，有一个<code>open file table</code>，里面记录的是所有打开的文件描述符信息；同时也有一个<code>inode table</code>，里面则记录的是底层的文件描述符信息。这里假如文件描述符B fork了文件描述符A，虽然在<code>open file table</code>中，我们看新增了一个文件描述符B，但是实际上，在<code>inode table</code>中，A和B的底层是一模一样的。这里，将inode table中的内容理解为windows中的文件属性，会更加贴切和易懂。这样存储的好处就是，无论上层文件描述符怎么变化，由于epoll监控的数据永远是inode table的底层数据，那么我就可以一直能够监控到文件的各种变化信息，这也是epoll高效的基础。</p>
<p>简化流程如下：</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/1-18-5f14ade5a7715dc1c41d8edc511a7294.webp" width="588" height="461" class="img_ev3q"></p>
<p>数据存储这块解决了，那么针对连接上来的客户端socket，该用什么数据结构保存进来呢？这里用到了红黑树，由于客户端socket会有频繁的新增和删除操作，而红黑树这块时间复杂度仅仅为<code>O(logN)</code>，还是挺高效的。有人会问为啥不用哈希表呢？当大  量的连接频繁的进行接入或者断开的时候，扩容或者其他行为将会产生不少的rehash操作，而且还要考虑哈希冲突的情况。虽然查询速度的确可以达到<code>O(1)</code>，但是rehash或者哈希冲突是不可控的，所以基于这些考量，我认为红黑树占优一些。</p>
<p>客户端socket怎么管理这块解决了，接下来，当有socket有数据需要进行读写事件处理的时候，系统会将已经就绪的socket添加到双向链表中，然后通过epoll_wait方法检测的时候，其实检查的就是这个双向链表，由于链表中都是就绪的数据，所以避免了针对整个客户端socket列表进行遍历的情况，使得整体效率大大提升。</p>
<p>整体的操作流程为：</p>
<ul>
<li>
<p>首先，利用epoll_create在内核中创建一个epoll对象。其实这个epoll对象，就是一个可以存储客户端连接的数据结构。</p>
</li>
<li>
<p>然后，客户端socket连接上来，会通过epoll_ctl操作将结果添加到epoll对象的红黑树数据结构中。</p>
</li>
<li>
<p>然后，一旦有socket有事件发生，则会通过回调函数将其添加到ready list双向链表中。</p>
</li>
<li>
<p>最后，epoll_wait会遍历链表来处理已经准备好的socket，然后通过预先设置的水平触发或者边缘触发来进行数据的感知操作。</p>
</li>
</ul>
<p>从上面的细节可以看出，由于epoll内部监控的是底层的文件描述符信息，可以将变更的描述符直接加入到ready list，无需用户将所有的描述符再进行传入。同时由于epoll_wait扫描的是已经就绪的文件描述符，避免了很多无效的遍历查询，使得epoll的整体性能大大提升，可以说现在只要谈论linux平台的IO多路复用，epoll已经成为了不二之选。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="水平触发和边缘触发">水平触发和边缘触发<a href="#水平触发和边缘触发" class="hash-link" aria-label="水平触发  和边缘触发的直接链接" title="水平触发和边缘触发的直接链接">​</a></h2>
<p>上面说到了epoll，主要讲解了client端怎么连进来，但是并未详细的讲解<code>epoll_wait</code>怎么被唤醒的，这里我将来详细的讲解一下。</p>
<p>水平触发，意即<code>Level Trigger</code>，边缘触发，意即<code>Edge Trigger</code>，如果单从字面意思上理解，则不太容易，但是如果将硬件设计中的水平沿，上升沿，下降沿的概念引进来，则理解起来就容易多了。比如我们可以这样认为：</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="512" height="201" class="img_ev3q"></p>
<p>如果将上图中的方块看做是buffer的话，那么理解起来则就更加容易了，比如针对水平触发，buffer只要是一直有数据，则一直通知；而边缘触发，则buffer容量发生变化的时候，才会通知。虽然可以这样简单的理解，但是实际上，其细节处理部分，比图示中展现的更加精细，这里来详细的说一下。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="边缘触发">边缘触发<a href="#边缘触发" class="hash-link" aria-label="边缘触发的直接链接" title="边缘触发的直接链接">​</a></h2>
<p>针对读操作，也就是当前fd处于EPOLLIN模式下，即可读。此时意味着有新的数据到来，接收缓冲区可读，以下buffer都指接收缓冲区：</p>
<ol>
<li>buffer由空变为非空，意即有数据进来的时候，此过程会触发通知。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="362" height="177" class="img_ev3q"></p>
<ol start="2">
<li>buffer原本有些数据，这时候又有新数据进来的时候，数据变多，此过程会触发通知。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,UklGRsgNAABXRUJQVlA4ILwNAAAQSgCdASpnAbAAPm0ylUgkIqIhIvQ7wIANiWdu5VARNwQY3E4EgA9D22A8wH61/pL7yvoA3oDeUv3A9KTVlvKv837eP7r4W/i3yf91/MvlFRGvlv3d/J/3T0B/yPgf7/v5X1AvxX+ff4jfo9N/xHoBezfzr/Lf3/95P7J6M/+J6C/Xv2AP1a/3vrj/t/CE9C9gD+i/5b1W/57/u/4z8xvbF9Kf9T/VfAX/Nv7L/y+xZ6Opak+OmnH/fGgo64pNN0SYOUtfdIvrTRUbhZlnuhJKBT/g3VmZswbG2Iw2qdPeT3OxUxnCUH92XqDfYLpqyNit3BieYlpzTwh8P/9G5ZTyAGZrRR7SoznE4wzm5GC4kPq1ZXoPmKEQYjv6aSMQ3P+J6BAyKkj2YYOli+I4FxBct0fh2rNomCm+E4u8FC5i5i5lZR0tEC3vrfpMgEfFb7uR8kIWmaJ8G4zjvoLbg8HqEguhfUrz6vYo20hOPZNa3IrsOyt2vhVbxecS6m+9sB8WDUdfQdqQIYj2lIy+YN/lhZ3Imj0j0Xufkpya0LXtc8ThEH2L6WIo/fhuSE6RmWYczf6xP62eRMHzkCalsXzE8boFx4C/T5KYbYWBulZhMA4qYa67SuS7q/zB5iyRwI8VTpTa4SezBYha2hrO27QwkD+3SVYk+nmalwtlNJnTRtIB5+bniB2A1/iqt61X0ucsnBd8jgZ2E8HddmxH+zh48vYv/vqpppjJ9bPJGi2D2oskZ433vyKKZdGc7i+lc+Rd1kMIWT3o+1rYYt5ZsJ0cKui0vaJb9r4AAP7/BQE00FO+BPCo25zOFn/fD08jUEI33aI6AW37eLjdLh+kUJMfbiKjfSn3Afa+ZCFxQ4v2a3TCJ6PSpjtwHNBuFxRj24ke/YEIBtBR4Nw/bNeDwavPDNnUcDjKrfh8M2cjyUWuL9wC6k4x6nts+sQtK46JEIs2EEKaXyCg/mJQ+vPsNdVdL/CewYVfUwFwiId+KmVvgKWdFf0LaWiioPSBWCfcwqoEysshpDNKGJh2n4Ffl/r7pgYWKgClBfzzkxpI+Dh0NIvsvyO1tmjN7qKeftQXkfzYbh9hNt+75nQuWg432DqQ4hmXcwwb3gAbyGZjWf/rfiNI0rXkfQTP35bcwwOqglQAQbkqfdY4b0HKC2nPQKkZVSFCjsQVLS3vn/75JjlxbgvBkyaurCVfZJPg7qSqakYGjJIm/NxJ9DMpjO+z/4i80vHE4BM/v4bqBVp1TqYSAcHwpw25cASKSvN8IzpmsmA/MNSBKZs21dx7YzI+pd4+xRpP0cpD7E6rDjoKrs9Rg2A529R7L+BnkCcrdAA1s/bZruFR5YkYQqBXsc44dt8zQcmX7YQhKYM+9+CjnQGIrzHdiaGGQ+9LzKd+AWxToCDTvVq/DC/ZbuCrXrDKBbxhKuR+2y8MPXaZsRMNr3K/BDmRKUfI5FWgnbR2Tc2EdWvF2z7GRnOlShVmwHG1ggSonxKFFR/OqTAKVGPAYysNYkuzLpynqf5aEsNGZtNGQdWDE4gU2KJ99lJCzQ/oKypoD5cHhBcWwQrE+gmho+RWBA3LkbRPpi5V7CAoF77x097LgM/plL3TX2fu0AGz8jgArwCF2qIEaTZYlaW7LGLBxV5pfFJ/TqdTv1+2fQsWvmtc1WwOxNHYREeGGMaH9pprYbx1xAdHrW93P3lBUka0Ij4cOYAah98JN4FwpBIW7Fj3Yja7xezH0qPNRIIdZnANHS9ghu1bFYfp4Rea0XtUnVHr9h6Ppm6PvNKjpLB6Ims7bcbMUD3bliHmPNMZ3kdh/Gpl2L/h/GUNAjJzt6Zp4zYX7q2D6JaZI+ncaCmNPPuu371XQL0BLH2BMSiBd02bjNt3DpZ/FP4hV8AM2JCXIYKAJaZmhzoiePcV5USq38YRygQz5zl/v2irKrNTl/fEj34rPFk2gH9ppPo858HsHOWtUMwrYQXuul4EMss4+1rI96/B34fBh3i9P7I7S8pDRRoa/yxGlBJZiAqz//zMXLddFrjbwbz1sI+g9mo3r0EsoPR6VB9TAkZOeVhQs7eof/K//Sn3ub/nSI9/17KtrlXgWyV0Op/DT1/3A9v5SMp7QDUwdEcqQOcLnP99DwnnzmlAtp3TXlxk/xe/iAGWF4/LrS4cTpGn+0j+lar45+8TZMZY46+6dAZ8LRDH07KEZaDQyc//+NW1PZ+AcYtpDHnywGhqu7hcXVOcM3+RI0WbYh7sZoEkULuEPuMaUEn7cGtxJsKqtr+HhHrbwbzwZ9/eQ7w9IwmEzXmCr/uOuzrzqUE7zBicfng0bE7r8xnaR2y0E68+zbq/Fybkf6R3WvqKHcmb3MOmFnPvHLCZGjkEBrSDgawhMhmTIrksEe62nOc8GyURMvneI0HOAOADEJddAVP419kweGDDywzKL+wEwxqz9Ez8DhjbtIw58ZO7pg0z0YCTCGQ4EHj7R8C053y0N0gb3Akcd/aKyMUTTkJ7nfX8wz8EMmRaZnGrwXxjTtihDVQcFBjEQke25rdLoaE/UvjLlkd2GdNVnjRUMej3B834KHlDeyfaPIKxo/dKmQISiJ0tDmghoivYxoLntUuYm9QXw53wuKJf4ZFRF2H88mk/9rQ8+Km4bq4MM3XLRk3bjbsjfl1tNaWHkJ1XALLbM20tVgM2OaX+WAp3mdK/NTkZWutmAkPgcrHwb28uZJj2jWiOOAgcoJYc+kV5LV5gUljYcODMyCe/QrQkmv8FmgEvzxPsOc8CzstQcN2LmUBUJktkeGnmldmtZs8laaCUpP0y3gZ0rCoqAi+aTAn3TytlXHGxLdtI1AI4qrVyGlc7lTRCzmoKA7j77rAVPLm6fGrVuZ08XVV9/VQ7/tweC3Sg0Lk1QNM6t2IrWq6shM0OATeXhV4kp59j0TmcTwdo+wamOJ8fWi/tfE1BzxPHUHIRg5kHPccnSQ0Y8PamUzxziYgZteyNo8M5ArEOY2MC04z8eIsv/CyTE9bnbWpeCLBFWSAkJ9FtDbOeE1xC+8mZ6TCqYN8hKmWNk3crEYEbFShfWIgiyF5h8VcPFMnHZT5QA7aLsn+4yVwR8trgo5sBGEF/mNFDgb8P8qe99ucFs9azlwWo6v6wIskv4rwHz7F/A2mTHWED0GfAYozp13s50B743bPaNs2RBn+adHvB9d/LNfZCphehPAWyLvUq/tLmzs2MfDXz2b3QQqZKqCdWqD9XCySdH8VRHftfYe0wH0aO3u0VEn29pp2s0xx44G9IIxJUH+I2qFFDtPjJCTmfk0kdaoSGkta4I8T0wM7N8IXNVO+078zcBpI8rQ234amnUi0zc30jtCDFTcepf0YR+DxWBHec+QKAhemc4OqLRUanjtmFj5U8lAmFE+LDcxdnaVaN5U3mUivgll+26e8d5EX0/98efWFm7mmTa2v7SwVf3yYoPq8V6y3X8X8lVZNXd+CkPX8IZDJ0sbRTCvYal8VeAXGeAwPak/0QD1dgRuYVx0TD4cTTMZ/ynqCt2FAp5ZVYkgJAuEq+7/r4tssf9radB5qZD1qAhOX3be+/Vyzg5uzcLvcQWv2pdzBv8NakVhNgTowPmRmRk5/uFeL3maNgeEV0TkL159MxS08zsxRxEOalZGCrD79euTHMDgM5b4Adhz/v1nzYXYEf3t+i9V5lrL3Q3n01adcoPXa6ZMu7jqcFfXP9tDbA6YX23IKh2oS7BBQJulR29WZaV4x5qw46iSttTv8QYMVo+RIna5YbmF5zxaXq7MM/e8ZwOF2uwwkzVsh/QIJBusVCteyC1y72ujlptEqwBZ4iiD3k35gJqd94XqLjMEQP9tRUV1aGjqzWKLV3DlGzP6fM85ALubi3OruouvExkAdc3NIrcC8nx5ermGiIrefnZdXMh9GKsiEZr22LECcGe8sgCyTu/H+Qk2ClKAfKeZgfiKrngyix+BciGXn7pr1jogeEp8LxUc4rT3DB95VIkIxuYFN36HqiX+09azEwZnPhPmDXPD44CYYw0c6NKMF4ENm1PMEffgQQHZRNgoCW3LUN3EthimcesZHDlEmh+e848wZHSx0zUbwYvAc77a7XBWfu1ieX1u0hevVlp+8FWBqGruoYvidYIQ5mGn/+N8a4AqhbEcborlrt/nbvhqEBYA/AsH0T8XqOOizLMKqPhIXRd6bYygnLfATF4wphnY6Wpy5WMPMfXMwbYRn5FAS6ZQwGr4Q+xJl3Cf2bFaBwB+raYOWIwRZsucWwjhT2HaUh3W/n24+zgNUu/eUp56/ctTzsP2B5o9KtvQWxrMtmU7fa7TNgkrM3UxDKIKNaw+zH8BhE7IQjjt3VyATUjTA1ccjGHz6PkMUpqs686rkVlkRPgNEM5tzcaoaKwAHjRHCY1lqY0pWSTZdjCQ6QKAN3HuHiO4y+/6w3Qk0FKTDCbWFgSLDyfDIXfXBNkAzFF0YYGlHCqdX7AZPy7R9F49RuItbt5Y6aVma7EGoIPPkpc1xhjC4BAXY3oGIBtsSpngzMdSseo8HbHOcGH2kyohrCek5AW2e/PzeODpcLXotK8j9De+t57W1pgWg/jt3Fu0/6OV1vOCGS422W8RgusC2HijxuJj0gvAb47yqf2V+FwEuG4BKJFI8fkkqWg8NXZjFZRBVvG8fSZ+Z/DdgsfzwHrYjJa9R4TViuomAAAAA=" width="359" height="176" class="img_ev3q"></p>
<ol start="3">
<li>buffer中有数据，此时用户对操作的fd注册<code>EPOLL_CTL_MOD</code>事件的时候，会触发通知。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="360" height="256" class="img_ev3q"></p>
<p>针对写操作，也就是当前fd处于<code>EPOLLOUT</code>模式下，即可写。此时意味着缓冲区可以写了，以下buffer都指发送缓冲区：</p>
<ol>
<li>buffer满了，这时候发送出去一些数据，数据变少，此过程会触发通知。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="359" height="174" class="img_ev3q"></p>
<ol start="2">
<li>buffer原本有些数据，这时候又发送出去一些数据，数据变少，此过程会触发通知。</li>
</ol>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="361" height="175" class="img_ev3q"></p>
<p>这里就是ET这种模式触发的几种情形，可以看出，基本上都是围绕着接收缓冲区或者发送缓冲区的状态变化来进行的。</p>
<p>晦涩难懂？不存在的，举个栗子：</p>
<p>在服务端，我们开启边缘触发模式，然后将<code>buffer size</code>设为10个字节，来看看具体的表现形式。</p>
<p>服务端开启，客户端连接，发送单字符A到服务端，输出结果如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;ET Mode: it was triggered once</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get 1 bytes of content: A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;wait to read!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，由于buffer从空到非空，边缘触发通知产生，之后在<code>epoll_wait</code>处阻塞，继续等待后续事件。</p>
<p>这里我们变一下，输入ABCDEFGHIJKLMNOPQ，可以看到，客户端发送的字符长度超过了服务端<code>buffer size</code>，那么输出结果将是怎么样的呢？</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;ET Mode: it was triggered once</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get 9 bytes of content: ABCDEFGHI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get 8 bytes of content: JKLMNOPQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;wait to read!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以看到，这次发送，由于发送的长度大于<code>buffer size</code>，所以内容被折成两段进行接收，由于用了边缘触发方式，buffer的情况是从空到非空，所以只会产生一次通知。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="水平触发">水平触发<a href="#水平触发" class="hash-link" aria-label="水平触发的直接链接" title="水平触发的直接链接">​</a></h2>
<p>水平触发则简单多了，他包含了边缘触发的所有场景，简而言之如下：</p>
<p>当接收缓冲区不为空的时候，有数据可读，则读事件会一直触发。</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="359" height="159" class="img_ev3q"></p>
<p>当发送缓冲区未满的时候，可以继续写入数据，则写事件一直会触发。</p>
<p><img decoding="async" loading="lazy" alt="img" src="data:image/webp;base64,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" width="363" height="151" class="img_ev3q"></p>
<p>同样的，为了使表达更清晰，我们也来举个栗子，按照上述入输入方式来进行。</p>
<p>服务端开启，客户端连接并发送单字符A，可以看到服务端输出情况如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;LT Mode: it was triggered once!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get 1 bytes of content: A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这个输出结果，毋庸置疑，由于buffer中有数据，所以水平模式触发，输出了结果。</p>
<p>服务端开启，客户端连接并发送ABCDEFGHIJKLMNOPQ，可以看到服务端输出情况如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;LT Mode: it was triggered once!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get 9 bytes of content: ABCDEFGHI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--&gt;LT Mode: it was triggered once!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get 8 bytes of content: JKLMNOPQ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从结果中，可以看出，由于buffer中数据读取完毕后，还有未读完的数据，所以水平模式会一直触发，这也是为啥这里水平模式被触发了两次的原因。</p>
<p>有了这两个栗子的比对，不知道聪明的你，get到二者的区别了吗？</p>
<p>在实际开发过程中，实际上LT更易用一些，毕竟系统帮助我们做了大部分校验通知工作，之前提到的SELECT和POLL，默认采用的也都是这个。但是需要注意的是，当有成千上万个客户端连接上来开始进行数据发送，由于LT的特性，内核会频繁的处理通知操作，导致其相对于ET来说，比较的耗费系统资源，所以，随着客户端的增多，其性能也就越差。</p>
<p>而边缘触发，由于监控的是FD的状态变化，所以整体的系统通知并没有那么频繁，高并发下整体的性能表现也要好很多。但是由于此模式下，用户需要积极的处理好每一笔数据，带来的维护代价也是相当大的，稍微不注意就有可能出错。所以使用起来须要非常小心才行。</p>
<p>至于二者如何抉择，诸位就仁者见仁智者见智吧。</p>
<p>行文到这里，关于epoll的讲解基本上完毕了，大家从中是不是学到了很多干货呢？由于从netty研究到linux epoll底层，其难度非常大，可以用曲高和寡来形容，所以在这块探索的文章是比较少的，很多东西需要自己照着man文档和源码一点一点的琢磨（linux源码详见eventpoll.c等）。</p>
<p>这里我来纠正一下搜索引擎上，说epoll高性能是因为利用mmap技术实现了用户态和内核态的内存共享，所以性能好，我前期被这个观点误导了好久，后来下来了linux源码，翻了一下，并没有在epoll中翻到mmap的技术点，所以这个观点是错误的。这些错误观点的文章，国内不少，国外也不少，希望大家能审慎抉择，避免被错误带偏。</p>
<p>所以，epoll高性能的根本就是，其高效的文件描述符处理方式加上颇具特性边的缘触发处理模式，以极少的内核态和用户态的切换，实现了真正意义上的高并发。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="手写epoll服务端">手写epoll服务端<a href="#手写epoll服务端" class="hash-link" aria-label="手写epoll服务端的直接链接" title="手写epoll服务端的直接链接">​</a></h2>
<p>实践是最好的老师，我们现在已经知道了epoll之剑怎么嵌入到石头中的，现在就让我们不妨尝试着拔一下看看。手写epoll服务器，具体细节如下（非C语言coder，代码有参考）：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;sys/types.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;sys/socket.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;netinet/in.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;arpa/inet.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;unistd.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;string.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;fcntl.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;sys/epoll.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;pthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;errno.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdbool.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">MAX_EVENT_NUMBER</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">1024</span><span class="token macro property expression" style="color:#36acaa">   </span><span class="token macro property comment" style="color:#999988;font-style:italic">//事件总数量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">BUFFER_SIZE</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">10</span><span class="token macro property expression" style="color:#36acaa">          </span><span class="token macro property comment" style="color:#999988;font-style:italic">//缓冲区大小，这里为10个字节</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">ENABLE_ET</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression" style="color:#36acaa">             </span><span class="token macro property comment" style="color:#999988;font-style:italic">//ET模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 文件描述符设为非阻塞状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 注意：这个设置很重要，否则体现不出高性能</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SetNonblocking</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> old_option </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">fcntl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> F_GETFL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> new_option </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> old_option </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> O_NONBLOCK</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">fcntl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> F_SETFL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> new_option</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> old_option</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 将文件描述符fd放入到内核中的epoll数据结构中并将fd设置为EPOLLIN可读，同时根据ET开关来决定使用水平触发还是边缘触发模式 </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 注意：默认为水平触发，或上EPOLLET则为边缘触发</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AddFd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> enable_et</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">epoll_event</span><span class="token plain"> event</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//为当前fd设置事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//指向当前fd</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> EPOLLIN</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//使得fd可读</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">enable_et</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        event</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> EPOLLET</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//设置为边缘触发</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">epoll_ctl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EPOLL_CTL_ADD</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//将fd添加到内核中的epoll实例中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">SetNonblocking</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//设为非阻塞模式                      </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*  LT水平触发 </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *  注意：水平触发简单易用，性能不高，适合低并发场合</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *        一旦缓冲区有数据，则会重复不停的进行通知，直至缓冲区数据读写完毕</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">lt_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">epoll_event</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//已经就绪的事件，这些时间可读或者可写</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sockfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//获取描述符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//如果监听类型的描述符，则代表有新的client接入，则将其添加到内核中的epoll结构中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr_in</span><span class="token plain"> client_address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            socklen_t client_addrlength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">client_address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listen_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client_address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client_addrlength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//创建连接并返回文件描述符（实际进行的三次握手过程）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">AddFd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//添加到epoll结构中并初始化为LT模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> EPOLLIN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//如果客户端有数据过来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--&gt;LT Mode: it was triggered once!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BUFFER_SIZE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BUFFER_SIZE </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//读取数据完毕后，关闭当前描述符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">continue</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;get %d bytes of content: %s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;something unexpected happened!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*  ET Work mode features: efficient but potentially dangerous */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/*  ET边缘触发</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> *  注意：边缘触发由于内核不会频繁通知，所以高效，适合高并发场合，但是处理不当将会导致严重事故</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">          其通知机制和触发方式参见之前讲解，由于不会重复触发，所以需要处理好缓冲区中的数据，避免脏读脏写或者数据丢失等</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">et_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">epoll_event</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">BUFFER_SIZE</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> number</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> sockfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">fd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//如果有新客户  端请求过来，将其添加到内核中的epoll结构中并默认置为ET模式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr_in</span><span class="token plain"> client_address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            socklen_t client_addrlength </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">client_address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> connfd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listen_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client_address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client_addrlength</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">AddFd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> connfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">events </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> EPOLLIN</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//如果客户端有数据过来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--&gt;ET Mode: it was triggered once\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//循环等待</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BUFFER_SIZE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">recv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> BUFFER_SIZE </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">errno </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> EAGAIN </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> errno </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> EWOULDBLOCK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//通过EAGAIN检测，确认数据读取完毕</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;--&gt;wait to read!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//数据读取完毕，关闭描述符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sockfd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//数据未读取完毕，继续读取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;get %d bytes of content: %s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;something unexpected happened!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> ip </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.0.76.135&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9999</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//套接字设置这块，参见https://www.gta.ufrj.br/ensino/eel878/sockets/sockaddr_inman.html</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr_in</span><span class="token plain"> address</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">bzero</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sin_family </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> AF_INET</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">inet_pton</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">AF_INET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ip</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sin_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sin_port </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">htons</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> listen_fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">socket</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PF_INET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SOCK_STREAM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//创建套接字并返回描述符</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listen_fd </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fail to create socket!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">bind</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listen_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">sockaddr</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">address</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//绑定本机</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fail to bind socket!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">listen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listen_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//在端口上监听</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fail to listen socket!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">epoll_event</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">MAX_EVENT_NUMBER</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> epoll_fd </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">epoll_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//在内核中创建epoll实例，flag为5只是为了分配空间用，实际可以不用带</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoll_fd </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;fail to create epoll!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">AddFd</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//添加文件描述符到epoll对象中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">epoll_wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MAX_EVENT_NUMBER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//拿出就绪的文件描述符并进行处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ret </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;epoll failure!\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ENABLE_ET</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//ET处理方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">et_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">//LT处理方式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">lt_process</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">events</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ret</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> epoll_fd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">listen_fd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//退出监听</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>详细的注释我都已经写上去了，这就是整个<code>epoll server</code>端全部源码了，仅仅只有200行左右，是不是很惊讶，接下来让我们来测试下性能，看看能够达到我们所说的单机百万并发吗？其实悄悄的给你说，netty底层的c语言实现，和这个是差不多的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="单机百万并发实战">单机百万并发实战<a href="#单机百万并发实战" class="hash-link" aria-label="单机百万并发实战的直接链接" title="单机百万并发实战的直接链接">​</a></h2>
<p>在实际测试过程中，由于要实现高并发，那么肯定得使用ET模式了。但是由于这块内容更多的是linux配置的调整，且前人已经有了具体的文章了，</p>
<p>这里我们主要是利用vmware虚拟机一主三从，参数调优，来实现百万并发。</p>
<p>此块内容由于比较复杂，先暂时放一放，后续将会搭建环境并对此手写server进行压测。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/middleware/netty/1-How-Does-Netty-Support-Millions-Of-Concurrency.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>Lorchr</b> <!-- -->于 <b><time datetime="2025-06-07T06:55:55.000Z" itemprop="dateModified">2025年6月7日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/middleware/category/netty/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Netty</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/middleware/category/mqtt/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">MQTT</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#netty的异步模型" class="table-of-contents__link toc-highlight">Netty的异步模型</a><ul><li><a href="#1-经典的多线程模型" class="table-of-contents__link toc-highlight">1. 经典的多线程模型</a></li><li><a href="#2-经典的reactor模型" class="table-of-contents__link toc-highlight">2. 经典的Reactor模型</a></li></ul></li><li><a href="#石中剑netty强悍的原理-jni" class="table-of-contents__link toc-highlight">石中剑Netty强悍的原理 （JNI）</a></li><li><a href="#io多路复用模型" class="table-of-contents__link toc-highlight">IO多路复用模型</a></li><li><a href="#select模型" class="table-of-contents__link toc-highlight">select模型</a></li><li><a href="#poll模型" class="table-of-contents__link toc-highlight">poll模型</a></li><li><a href="#epoll模型" class="table-of-contents__link toc-highlight">epoll模型</a></li><li><a href="#水平触发和边缘触发" class="table-of-contents__link toc-highlight">水平触发和边缘触发</a></li><li><a href="#边缘触发" class="table-of-contents__link toc-highlight">边缘触发</a></li><li><a href="#水平触发" class="table-of-contents__link toc-highlight">水平触发</a></li><li><a href="#  手写epoll服务端" class="table-of-contents__link toc-highlight">手写epoll服务端</a></li><li><a href="#单机百万并发实战" class="table-of-contents__link toc-highlight">单机百万并发实战</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>