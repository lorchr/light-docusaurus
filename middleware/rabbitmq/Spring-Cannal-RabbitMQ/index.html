<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-middleware docs-version-current docs-doc-page docs-doc-id-rabbitmq/Spring-Cannal-RabbitMQ" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.2.1">
<title data-rh="true">Spring-Cannal-RabbitMQ | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/middleware/rabbitmq/Spring-Cannal-RabbitMQ/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" property="og:title" content="Spring-Cannal-RabbitMQ | Light Docusaurus"><meta data-rh="true" name="description" content="- SpringCloud整合Canal+RabbitMQ+Redis实现数据监听"><meta data-rh="true" property="og:description" content="- SpringCloud整合Canal+RabbitMQ+Redis实现数据监听"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/middleware/rabbitmq/Spring-Cannal-RabbitMQ/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/middleware/rabbitmq/Spring-Cannal-RabbitMQ/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/middleware/rabbitmq/Spring-Cannal-RabbitMQ/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.10a62360.css">
<script src="/assets/js/runtime~main.849e35c8.js" defer="defer"></script>
<script src="/assets/js/main.4af205e6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a class="navbar__item navbar__link" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/middleware/rabbitmq/Spring-Cannal-RabbitMQ/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/middleware/">MiddleWare</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/compare/">Compare</a><button aria-label="展开侧边栏分类 &#x27;Compare&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/mysql/">Mysql</a><button aria-label="展开侧边栏分类 &#x27;Mysql&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/postgresql/">Postgresql</a><button aria-label="展开侧边栏分类 &#x27;Postgresql&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/redis/">Redis</a><button aria-label="展开侧边栏分类 &#x27;Redis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/nginx/">Nginx</a><button aria-label="展开侧边栏分类 &#x27;Nginx&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/netty/">Netty</a><button aria-label="展开侧边栏分类 &#x27;Netty&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/mqtt/">MQTT</a><button aria-label="展开侧边栏分类 &#x27;MQTT&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/influxdb/">InfluxDB</a><button aria-label="展开侧边栏分类 &#x27;InfluxDB&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/kafka/">Kafka</a><button aria-label="展开侧边栏分类 &#x27;Kafka&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/middleware/category/rabbitmq/">RabbitMQ</a><button aria-label="折叠侧边栏分类 &#x27;RabbitMQ&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/middleware/rabbitmq/Spring-Boot-Integrate-RabbitMQ/">Spring-Boot-Integrate-RabbitMQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/middleware/rabbitmq/Spring-Cannal-RabbitMQ/">Spring-Cannal-RabbitMQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/middleware/rabbitmq/Spring-Boot-Cannal-RabbitMQ/">Spring-Boot-Cannal-RabbitMQ</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/rocketmq/">RocketMQ</a><button aria-label="展开侧边栏分类 &#x27;RocketMQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/workflow/">Workflow</a><button aria-label="展开侧边栏分类 &#x27;Workflow&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/plusar/">Plusar</a><button aria-label="展开侧边栏分类 &#x27;Plusar&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/middleware/category/shardingsphere/">ShardingSphere</a><button aria-label="展开侧边栏分类 &#x27;ShardingSphere&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/middleware/category/rabbitmq/"><span itemprop="name">RabbitMQ</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring-Cannal-RabbitMQ</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring-Cannal-RabbitMQ</h1></header><ul>
<li><a href="https://juejin.cn/post/7299733832412643363" target="_blank" rel="noopener noreferrer">SpringCloud整合Canal+RabbitMQ+Redis实现数据监听</a></li>
<li><a href="https://mp.weixin.qq.com/s/wyIVNT_Q0XTR1jZ8QQXo4w" target="_blank" rel="noopener noreferrer">SpringCloud 整合 Canal+RabbitMQ+Redis 实现数据监听</a></li>
<li><a href="https://mp.weixin.qq.com/s/vE7FfuXgQBT6XFbVZcqxTA" target="_blank" rel="noopener noreferrer">如何实现一个简单易用的 RocketMQ SDK</a> <a href="https://github.com/makemyownlife/platform-rocketmq" target="_blank" rel="noopener noreferrer">makemyownlife/platform-rocketmq</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="canal介绍">Canal介绍<a href="#canal介绍" class="hash-link" aria-label="Canal介绍的直接链接" title="Canal介绍的直接链接">​</a></h2>
<p>Canal 指的是阿里巴巴开源的数据同步工具，用于数据库的实时增量数据订阅和消费。它可以针对 MySQL、MariaDB、Percona、阿里云RDS、Gtid模式下的异构数据同步等情况进行实时增量数据同步。
当前的 canal 支持源端 MySQL 版本包括 5.1.x , 5.5.x , 5.6.x , 5.7.x , 8.0.x</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="canal是如何同步数据库数据的呢">Canal是如何同步数据库数据的呢？<a href="#canal是如何同步数据库数据的呢" class="hash-link" aria-label="Canal是如何同步数据库数据的呢？的直接链接" title="Canal是如何同步数据库数  据的呢？的直接链接">​</a></h3>
<p>Canal通过伪装成mysql从服务向主服务拉取数据，所以先来了解一下MySQL的主从复制吧</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mysql主从复制原理">MySQL主从复制原理<a href="#mysql主从复制原理" class="hash-link" aria-label="MySQL主从复制原理的直接链接" title="MySQL主从复制原理的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2-1-21e6c42d0c053a5305a8021397370045.awebp" width="913" height="391" class="img_ev3q"></p>
<ol>
<li>
<p>从库(slave)会生成两个线程，I/O线程(<code>IOthread</code>)，SQL线程(<code>SQLthread</code>)。</p>
</li>
<li>
<p>当slave的I/O线程连接到master后，会去请求master的二进制日志(<code>binlog</code>)，此时master会通过logdump(将主库的二进制日志文件内容传输给从库的过程)
给从库传输<code>binlog</code>。</p>
</li>
<li>
<p>然后slave将拿到的<code>binlog</code>日志依次写入<code>Relaylog</code>(中继日志)的最末端，同时将读取到的Master 的<code>bin-log</code>的文件名和位置记录到<code>master- info</code>文件中，作用为了让slave知道它需要从哪个位置和哪 个日志文件开始同步数据，以保证数据的一致性，并且能够及时获取到master的新的更新操作， 开始数据同步过程。slave不仅在启动时读取 <code>master-info</code> 文件，而且会定期更新该文件中的记 录，以确保记录都是最新的。</p>
</li>
<li>
<p>最后SQL线程会读取<code>Relaylog</code>，并解析为具体操作(比如DDL这种)，来实现主从库的操作一致， 最终实现数据一致；</p>
</li>
</ol>
<p>大致了解完了MySQL的主从复制，接着我们看Canal就简单啦。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="canal工作原理">Canal工作原理<a href="#canal工作原理" class="hash-link" aria-label="Canal工作原理的直接链接" title="Canal工作原理的直接链  接">​</a></h2>
<p><img decoding="async" loading="lazy" alt="img" src="data:;base64,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" width="701" height="363" class="img_ev3q"></p>
<ol>
<li>
<p>Canal Server与MySQL建立连接后，会通过模拟mysql slave的交互协议，伪装自己为mysql slave，向mysql master发送dump协议获取数据库的 binlog（二进制日志）文件。</p>
</li>
<li>
<p>Canal Server解析binlog文件，通过网络将解析后的事件传输给
消息中间件(Kafka,RabbitMQ等),实现数据的实时同步。</p>
</li>
</ol>
<p>了解完canal的原理后，我们就正式开始RabbitMQ+Canal+Redis实现缓存和数据库数据一致的功能。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmqcanalredis工作原理">RabbitMQ+Canal+redis工作原理<a href="#rabbitmqcanalredis工作原理" class="hash-link" aria-label="RabbitMQ+Canal+redis工作原理的直接链接" title="RabbitMQ+Canal+redis工作原理的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" alt="img" src="data:;base64,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" width="668" height="276" class="img_ev3q"></p>
<p>通过上图很好理解：</p>
<ol>
<li>
<p>APP向数据库进行写操作(比如我们更新商品信息啥的)</p>
</li>
<li>
<p>Canal监听到数据库发生变化，便会向rabbitMQ传递数据库发生变化的消息。</p>
</li>
<li>
<p>消费者就可以从rabbitMQ获取这些消息，然后进行删除缓存操作。</p>
</li>
</ol>
<p>下面通过实战让我们更好地理解是如何实现缓存和数据库数据一致性的。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实战配置">实战配置<a href="#实战配置" class="hash-link" aria-label="实战配置的直接链接" title="实战配置的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="canal-配置">Canal 配置<a href="#canal-配置" class="hash-link" aria-label="Canal 配置的直接链接" title="Canal 配置的直接链接">​</a></h3>
<p>修改 <code>conf/canal.properties</code> 配置</p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 指定模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.serverMode = rabbitMQ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定实例,多个实例使用逗号分隔: canal.destinations = example1,example2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.destinations = example </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rabbitmq 服 务端 ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq.host = 你的ip(注意不要加端口号哦)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rabbitmq 虚拟主机 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq.virtual.host = / </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rabbitmq 交换机  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq.exchange = canal.exchange  (这是本例子用的交换机)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rabbitmq 用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq.username = 你的用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rabbitmq 密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq.password = 你的密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rabbitmq.deliveryMode =</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>修改实例配置文件 <code>conf/example/instance.properties</code></p>
<div class="language-properties codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-properties codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#配置 slaveId,自定义,不等于 mysql 的 server Id 即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.instance.mysql.slaveId=10 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 数据库地址:配置自己的ip和端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.instance.master.address=你的IP:端口号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 数据库用户名和密码 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.instance.dbUsername=用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.instance.dbPassword=密码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 指定库和表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.instance.filter.regex=.*\..*    // 这里的 .* 表示 canal.instance.master.address 下面的所有数据库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># mq config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># rabbitmq 的 routing key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">canal.mq.topic=canal.routing.key(这是本例子用的key)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后重启 canal 服务。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmq-配置">RabbitMQ 配置<a href="#rabbitmq-配置" class="hash-link" aria-label="RabbitMQ 配置的直接链接" title="RabbitMQ 配置的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2-4-d64c74bfb2373e550a835874e924b1c9.awebp" width="1347" height="781" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2-5-46473982fde3f17eac1cacc7eee2ef12.awebp" width="937" height="445" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2-6-6d0cafce436703e3090a7ad6d7805f63.awebp" width="937" height="512" class="img_ev3q"></p>
<p>这样rabbitMQ就配置完啦，下面就是实战代码啦。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="实战代码">实战代码<a href="#实战代码" class="hash-link" aria-label="实战代码的直接链接" title="实战代码的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="canalmessage-canal传来的消息">CanalMessage: Canal传来的消息<a href="#canalmessage-canal传来的消息" class="hash-link" aria-label="CanalMessage: Canal传来的消息的直接链接" title="CanalMessage: Canal传来的消息的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@NoArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CanalMessage&lt;T&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String table;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;T&gt; data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String database;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long es;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Integer id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Boolean isDdl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;T&gt; old;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;String&gt; pkNames;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String sql;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long ts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmq配置类">RabbitMQ配置类<a href="#rabbitmq配置类" class="hash-link" aria-label="RabbitMQ配置类的直接链接" title="RabbitMQ配置类的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RabbitConfig {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 消息序列化配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Bean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public RabbitListenerContainerFactory&lt;?&gt; rabbitListenerContainerFactory(ConnectionFactory connectionFactory) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // SimpleRabbitListenerContainerFactory 是 RabbitMQ 提供的一个实现了 RabbitListenerContainerFactory 接口的简单消息监听器容器工厂。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 它的作用是创建和配置 RabbitMQ 消息监听器容器，用于监听和处理消息。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //ConnectionFactory 是 RabbitMQ 提供的一个接口，用于创建 RabbitMQ 的连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setConnectionFactory(connectionFactory);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //使用了 Jackson2JsonMessageConverter 将消息转换为 JSON 格式进行序列化和反序列化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        factory.setMessageConverter(  new Jackson2JsonMessageConverter());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return factory;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将消息转换为JSON格式，才能映射到<code>CanalMessage</code>上。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rabbitmqcanal监听处理类">RabbitMQ+Canal监听处理类<a href="#rabbitmqcanal监听处理类" class="hash-link" aria-label="RabbitMQ+Canal监听处理类的直接链接" title="RabbitMQ+Canal监听处理类的直接链接">​</a></h3>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Slf4j</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequiredArgsConstructor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CanalListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final SysMenuService menuService;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //@RabbitListener(queues = &quot;canal.queue&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void handleDataChange(@Payload CanalMessage message) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String tableName = message.getTable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log.info(&quot;Canal 监听 {} 发生变化；明细：{}&quot;, tableName, message);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (Arrays.asList(&quot;sys_menu&quot;, &quot;sys_role&quot;, &quot;sys_role_menu&quot;).contains(tableName)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            log.info(&quot;======== 清理菜单路由缓存 ========&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            menuService.cleanCache();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>menuService</code>的<code>cleanCache()</code>是把登录时的路由列表缓存清除掉，具体可去源码查看，在最底下。</p>
<p>这样我们实现缓存和数据库数据一致性的功能就完成啦，接下来测试一下。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="测试">测试<a href="#测试" class="hash-link" aria-label="测试的直接链接" title="测试的直接链接">​</a></h2>
<p>我们直接通过手动修改数据库来完成测试。</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2-7-07fefe733a1b65f0f776a6390cf7692a.awebp" width="1258" height="455" class="img_ev3q"></p>
<p>我们在菜单表修改菜单管理的内容改成菜单管理1，点击保存</p>
<p><img decoding="async" loading="lazy" alt="img" src="/assets/images/2-8-dc9e6ff6454a7e7bb838dc4430c6bd53.awebp" width="1267" height="753" class="img_ev3q"></p>
<p>可以看到更新操作已经被监听到啦。接着就完成清理缓存操作咯，然后就可以防止缓存和数据库数据不一致的问题啦。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="代码摘自">代码摘自<a href="#代码摘自" class="hash-link" aria-label="代码摘自的直接链接" title="代码摘自的直接链接">​</a></h2>
<p><a href="https://gitee.com/youlaitech/youlai-mall" target="_blank" rel="noopener noreferrer">youlai-mall: 🚀基于 Spring Boot 3、Spring Cloud &amp; Alibaba 2022、SAS OAuth2 、Vue3、Element-Plus、uni-app 构建的开源全栈商城。 (gitee.com)</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/middleware/rabbitmq/2-Spring-Cannal-RabbitMQ.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>Lorchr</b> <!-- -->于 <b><time datetime="2025-05-09T13:47:59.000Z" itemprop="dateModified">2025年5月9日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/middleware/rabbitmq/Spring-Boot-Integrate-RabbitMQ/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Spring-Boot-Integrate-RabbitMQ</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/middleware/rabbitmq/Spring-Boot-Cannal-RabbitMQ/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Spring-Boot-Cannal-RabbitMQ</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#canal介绍" class="table-of-contents__link toc-highlight">Canal介绍</a><ul><li><a href="#canal是如何同步数据库数据的呢" class="table-of-contents__link toc-highlight">Canal是如何同步数据库数据的呢？</a></li></ul></li><li><a href="#mysql主从复制原理" class="table-of-contents__link toc-highlight">MySQL主从复制原理</a></li><li><a href="#canal工作原理" class="table-of-contents__link toc-highlight">Canal工作原理</a></li><li><a href="#rabbitmqcanalredis工作原理" class="table-of-contents__link toc-highlight">RabbitMQ+Canal+redis工作原理</a></li><li><a href="#实战配置" class="table-of-contents__link toc-highlight">实战配置</a><ul><li><a href="#canal-配置" class="table-of-contents__link toc-highlight">Canal 配置</a></li><li><a href="#rabbitmq-配置" class="table-of-contents__link toc-highlight">RabbitMQ 配置</a></li></ul></li><li><a href="#实战代码" class="table-of-contents__link toc-highlight">实战代码</a><ul><li><a href="#canalmessage-canal传来的消息" class="table-of-contents__link toc-highlight">CanalMessage: Canal传来的消息</a></li><li><a href="#rabbitmq配置类" class="table-of-contents__link toc-highlight">RabbitMQ配置类</a></li><li><a href="#rabbitmqcanal监听处理类" class="table-of-contents__link toc-highlight">RabbitMQ+Canal监听处理类</a></li></ul></li><li><a href="#测试" class="table-of-contents__link toc-highlight">测试</a></li><li><a href="#代码摘自" class="table-of-contents__link toc-highlight">代码摘自</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>