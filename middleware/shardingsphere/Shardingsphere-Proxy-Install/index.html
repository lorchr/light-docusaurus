<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-middleware docs-version-current docs-doc-page docs-doc-id-shardingsphere/Shardingsphere-Proxy-Install" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Shardingsphere-Proxy-Install | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/middleware/shardingsphere/Shardingsphere-Proxy-Install/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" property="og:title" content="Shardingsphere-Proxy-Install | Light Docusaurus"><meta data-rh="true" name="description" content="一、Shardingsphere Proxy 安装 (Docker版)"><meta data-rh="true" property="og:description" content="一、Shardingsphere Proxy 安装 (Docker版)"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/middleware/shardingsphere/Shardingsphere-Proxy-Install/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/middleware/shardingsphere/Shardingsphere-Proxy-Install/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/middleware/shardingsphere/Shardingsphere-Proxy-Install/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.609e5209.css">
<script src="/light-docusaurus/assets/js/runtime~main.dc675bf0.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.e6636429.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/middleware/shardingsphere/Shardingsphere-Proxy-Install/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><main class="docMainContainer_TBSr docMainContainerEnhanced_lQrH"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Shardingsphere-Proxy-Install</h1></header><h2 id="一shardingsphere-proxy-安装-docker版">一 、Shardingsphere Proxy 安装 (Docker版)</h2>
<pre><code class="language-shell"># 下载镜像
docker pull apache/shardingsphere-proxy:5.2.1

# 创建文件夹
mkdir -p //d/docker/shardingsphere-proxy/{conf,data,logs,ext-lib}

# 获取配置文件
docker run -d --name shardingsphere_proxy_temp --entrypoint=bash apache/shardingsphere-proxy:5.2.1 \
&amp;&amp; docker cp shardingsphere_proxy_temp:/opt/shardingsphere-proxy/conf d:/docker/shardingsphere-proxy/ \
&amp;&amp; docker rm shardingsphere_proxy_temp

# 安装Mysql驱动
wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar -O d:/docker/shardingsphere-proxy/ext-lib/mysql-connector-java-8.0.11.jar

# 运行容器
docker run -d \
  --publish 13307:3307 \
  --volume //d/docker/shardingsphere-proxy/ext-lib:/opt/shardingsphere-proxy/ext-lib \
  --volume //d/docker/shardingsphere-proxy/conf:/opt/shardingsphere-proxy/conf \
  --volume //d/docker/shardingsphere-proxy/logs:/opt/shardingsphere-proxy/logs \
  --env PORT=3307 \
  --net dev \
  --ip 172.18.0.6 \
  --restart=on-failure:3 \
  --name shardingsphere-proxy \
  apache/shardingsphere-proxy:5.2.1

docker exec -it -u root shardingsphere-proxy /bin/bash

</code></pre>
<p><strong>注:</strong> 配置文件部分按照后续章节编写</p>
<h2 id="二shardingsphere-proxy-安装-二进制版">二、Shardingsphere Proxy 安装 (二进制版)</h2>
<h3 id="1-前置条件">1. 前置条件</h3>
<p>运行需要Java环境，Jdk版本在 1.8 以上</p>
<ul>
<li><a href="https://openjdk.org/projects/jdk8/">Jdk 1.8+</a></li>
<li><a href="https://jdk.java.net/java-se-ri/8-MR5">Jdk 1.8+</a></li>
</ul>
<h3 id="2-安装">2. 安装</h3>
<ul>
<li><a href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/startup/bin/">二进制安装</a></li>
<li><a href="https://shardingsphere.apache.org/document/current/cn/downloads/">二进制安装包下载</a></li>
</ul>
<pre><code class="language-shell"># 下载安装包
wget https://dlcdn.apache.org/shardingsphere/5.4.1/apache-shardingsphere-5.4.1-shardingsphere-proxy-bin.tar.gz -O apache-shardingsphere-5.4.1-shardingsphere-proxy-bin.tar.gz

# 解压
tar -zxvf apache-shardingsphere-5.4.1-shardingsphere-proxy-bin.tar.gz -C /usr/local
mv apache-shardingsphere-5.4.1-shardingsphere-proxy-bin shardingsphere-proxy

# 下载Mysql依赖
mkdir -p /usr/local/shardingsphere-proxy/ext-lib
wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar -O /usr/local/shardingsphere-proxy/ext-lib/mysql-connector-java-8.0.11.jar
</code></pre>
<p>操作指令</p>
<pre><code class="language-shell"># 启动
/usr/local/shardingsphere-proxy/bin/start.sh

# 停止
/usr/local/shardingsphere-proxy/bin/stop.sh

# 查看日志
tail -f logs/stdout.log

# 使用 psql 命令行连接
psql -h 172.21.7.11 -p 3307 -U root -W root -d readwrite_pgsql

# 查看数据表
SELECT tablename FROM pg_tables WHERE schemaname=&#x27;public&#x27;;
</code></pre>
<p><strong>注:</strong> 配置文件部分按照后续章节编写</p>
<h2 id="三配置-confserveryaml">三、配置 <code>conf/server.yaml</code></h2>
<p>配置ShardingSphere-Proxy 运行模式 认证信息及其他属性等</p>
<ul>
<li><a href="https://shardingsphere.apache.org/document/5.4.1/cn/user-manual/shardingsphere-jdbc/yaml-config/mode/">模式配置</a></li>
<li><a href="https://shardingsphere.apache.org/document/5.4.1/cn/user-manual/shardingsphere-proxy/yaml-config/authority/">权限配置</a></li>
<li><a href="https://shardingsphere.apache.org/document/5.4.1/cn/user-manual/shardingsphere-proxy/yaml-config/props/">属性配置</a></li>
</ul>
<h3 id="1-配置-serveryaml-521-版本">1. 配置 <code>server.yaml</code> (5.2.1 版本)</h3>
<pre><code class="language-yaml">mode:
  type: Standalone
  repository:
    type: JDBC

rules:
  - !AUTHORITY
    users:
      - root@%:root
      - sharding@:sharding
    provider:
      type: ALL_PRIVILEGES_PERMITTED

props:
#  max-connections-size-per-query: 1
#  kernel-executor-size: 16  # Infinite by default.
#  proxy-frontend-flush-threshold: 128  # The default value is 128.
#  proxy-opentracing-enabled: false
#  proxy-hint-enabled: false
  sql-show: true

</code></pre>
<h3 id="2-配置-serveryaml-541-版本">2. 配置 <code>server.yaml</code> (5.4.1 版本)</h3>
<pre><code class="language-yaml">mode:
  type: Standalone
  repository:
    type: JDBC

authority:
  users:
    - user: root@%
      password: root
    - user: sharding
      password: sharding
    - user: postgres
      password: postgres
  privilege:
    type: ALL_PERMITTED
 
props:
#  max-connections-size-per-query: 1
#  kernel-executor-size: 16  # Infinite by default.
#  proxy-frontend-flush-threshold: 128  # The default value is 128.
#  proxy-hint-enabled: false
  sql-show: on
</code></pre>
<h2 id="四配置-confconfig-yaml">四、配置 <code>conf/config-*.yaml</code></h2>
<p>修改 <code>conf</code> 目录下以 <code>config-</code> 前缀开头的文件，如：<code>conf/config-sharding.yaml</code> 文件，进行分片规则、读写分离规则配置。配置方式请参考<a href="https://shardingsphere.apache.org/document/current/cn/user-manual/shardingsphere-proxy/yaml-config/">配置手册</a>。<code>config-*.yaml</code> 文件的 <code>*</code> 部分可以任意命名。 ShardingSphere-Proxy 支持配置多个逻辑数据源，每个以 <code>config-</code> 前缀命名的 YAML 配置文件，即为一个逻辑数据源。</p>
<h3 id="1-mysql-读写分离配置-confconfig-mysql-rwsyaml-521-版本">1. Mysql 读写分离配置 <code>conf/config-mysql-rws.yaml</code> (5.2.1 版本)</h3>
<pre><code class="language-yaml">databaseName: readwrite_mysql

dataSources:
 write_ds:
   url: jdbc:mysql://192.168.3.49:3316/mes_technical?serverTimezone=UTC&amp;useSSL=false&amp;allowPublicKeyRetrieval=true
   username: root
   password: admin
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1
 read_ds_0:
   url: jdbc:mysql://192.168.3.49:3317/mes_technical?serverTimezone=UTC&amp;useSSL=false&amp;allowPublicKeyRetrieval=true
   username: root
   password: admin
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1

rules:
- !READWRITE_SPLITTING
 dataSources:
   readwrite_ds:
     staticStrategy:
       writeDataSourceName: write_ds
       readDataSourceNames:
         - read_ds_0
     loadBalancerName: random
 loadBalancers:
   random:
     type: RANDOM

</code></pre>
<h3 id="2-mysql-读写分离配置-confconfig-mysql-rwsyaml-541-版本">2. Mysql 读写分离配置 <code>conf/config-mysql-rws.yaml</code> (5.4.1 版本)</h3>
<pre><code class="language-yaml">databaseName: readwrite_mysql

dataSources:
 write_ds:
   url: jdbc:mysql://192.168.3.49:3316/mes_technical?serverTimezone=UTC&amp;useSSL=false&amp;allowPublicKeyRetrieval=true
   username: root
   password: admin
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1
 read_ds_0:
   url: jdbc:mysql://192.168.3.49:3317/mes_technical?serverTimezone=UTC&amp;useSSL=false&amp;allowPublicKeyRetrieval=true
   username: root
   password: admin
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1

rules:
- !READWRITE_SPLITTING
 dataSources:
   readwrite_ds:
     writeDataSourceName: write_ds
     readDataSourceNames:
       - read_ds_0
     loadBalancerName: random
 loadBalancers:
   random:
     type: RANDOM
- !SINGLE
  tables:
    # MySQL 风格
    # - ds_0.t_single # 加载指定单表
    # - ds_1.*        # 加载指定数据源中的全部单表
    - &quot;*.*&quot;           # 加载全部单表

</code></pre>
<h3 id="3-pgsql-读写分离配置-confconfig-pgsql-rwsyaml-521-版本">3. Pgsql 读写分离配置 <code>conf/config-pgsql-rws.yaml</code> (5.2.1 版本)</h3>
<pre><code class="language-yaml">databaseName: readwrite_pgsql

dataSources:
 primary_ds:
   url: jdbc:postgresql://192.168.3.49:5433/mes_technical
   username: postgres
   password: postgres
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1
 replica_ds_0:
   url: jdbc:postgresql://192.168.3.49:5434/mes_technical
   username: postgres
   password: postgres
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1

rules:
- !READWRITE_SPLITTING
 dataSources:
   readwrite_ds:
     staticStrategy:
       writeDataSourceName: primary_ds
       readDataSourceNames:
         - replica_ds_0
     loadBalancerName: random
 loadBalancers:
   random:
     type: RANDOM

</code></pre>
<h3 id="4-pgsql-读写分离配置-confconfig-pgsql-rwsyaml-541-版本">4. Pgsql 读写分离配置 <code>conf/config-pgsql-rws.yaml</code> (5.4.1 版本)</h3>
<pre><code class="language-yaml">databaseName: readwrite_pgsql

dataSources:
 primary_ds:
   url: jdbc:postgresql://192.168.3.49:5433/test
   username: postgres
   password: postgres
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1
 replica_ds_0:
   url: jdbc:postgresql://192.168.3.49:5434/test
   username: postgres
   password: postgres
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1
 replica_ds_1:
   url: jdbc:postgresql://192.168.3.34:5432/test
   username: postgres
   password: postgres
   connectionTimeoutMilliseconds: 30000
   idleTimeoutMilliseconds: 60000
   maxLifetimeMilliseconds: 1800000
   maxPoolSize: 50
   minPoolSize: 1

rules:
- !READWRITE_SPLITTING
 dataSources:
   readwrite_ds:
     writeDataSourceName: primary_ds
     readDataSourceNames:
       - replica_ds_0
       - replica_ds_1
     loadBalancerName: random
 loadBalancers:
   random:
     type: RANDOM
- !SINGLE
  tables:
    # PostgreSQL 风格
    # - ds_1.public.t_single  # 加载指定单表
    # - ds_2.public.*         # 加载指定schema中的全部单表
    # - ds_3.*.*              # 加载所有schema下的所有表
    - &quot;*.*.*&quot;                 # 加载全部单表
</code></pre>
<h2 id="五添加mysql驱动">五、添加Mysql驱动</h2>
<p>如果后端连接 <code>PostgreSQL</code> 或 <code>openGauss</code> 数据库，不需要引入额外依赖。</p>
<p>如果后端连接 <code>MySQL</code> 数据库，请下载 <a href="https://repo1.maven.org/maven2/mysql/mysql-connector-java/5.1.49/mysql-connector-java-5.1.49.jar">mysql-connector-java-5.1.49.jar</a> 或者 <a href="https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar">mysql-connector-java-8.0.11.jar</a>，并将其放入 <code>ext-lib</code> 目录。</p>
<pre><code class="language-shell">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.11/mysql-connector-java-8.0.11.jar
</code></pre>
<h2 id="六使用客户端连接-shardingsphere-proxy">六、使用客户端连接 ShardingSphere-Proxy</h2>
<p>执行 <code>MySQL</code> / <code>PostgreSQL</code> / <code>openGauss</code> 的客户端命令直接操作 <code>ShardingSphere-Proxy</code> 即可。</p>
<h3 id="1-使用-mysql-客户端连接-shardingsphere-proxy">1. 使用 MySQL 客户端连接 ShardingSphere-Proxy：</h3>
<pre><code class="language-shell">docker exec -it -u root mysql-master /bin/bash

mysql -h 172.18.0.6 -P 3307 -u root -p root -D readwrite_mysql
</code></pre>
<h3 id="2-使用-postgresql-客户端连接-shardingsphere-proxy">2. 使用 PostgreSQL 客户端连接 ShardingSphere-Proxy：</h3>
<pre><code class="language-shell">docker exec -it -u root postgres-master /bin/bash

psql -h 172.18.0.6 -p 3307 -U root -W root -d readwrite_pgsql

# 查看数据库列表
SELECT datname FROM pg_database;

# 查看数据表列表
SELECT tablename FROM pg_tables WHERE schemaname=&#x27;public&#x27;;

\x on;
SELECT * FROM pg_tablespace;
SELECT * FROM pg_namespace;
\x off;

# 测试
create table t1(id int);
insert into t1 values(1);
select * from t1;
drop table t1;
</code></pre>
<h3 id="3-使用-opengauss-客户端连接-shardingsphere-proxy">3. 使用 openGauss 客户端连接 ShardingSphere-Proxy：</h3>
<pre><code class="language-shell">gsql -r -h 172.18.0.6 -p 3307 -U root -W root
</code></pre>
<h2 id="七总结">七、总结</h2>
<p>因为在5.2.1 之前和之后存在较大的破坏性更新，所以两部分配置存在较大的差异和不兼容情况</p>
<h3 id="共性问题">共性问题</h3>
<ol>
<li>
<p>多数据库代理问题（针对读写分离）</p>
<ul>
<li>不兼容同时代理 Mysql 和 Pgsql。需要搭建两个 Shardingsphere proxy，分别来代理 Mysql 和 Pgsql</li>
<li>对于多租户每个租户需要单独一份配置文件，如: <code>config-tenant1.yaml</code> <code>config-tenant2.yaml</code>
<ul>
<li><code>config-tenant1.yaml</code> 配置 <code>tenant1</code> 的数据源 <code>tenant1_write</code> <code>tenant_read1</code> <code>tenant_read1</code></li>
<li><code>config-tenant2.yaml</code> 配置 <code>tenant1</code> 的数据源 <code>tenant2_write</code> <code>tenant_read2</code> <code>tenant_read2</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>对于 bool 值的处理 Mysql 与 Pgsql 表现不一致</p>
<ul>
<li>Mysql  1  0</li>
<li>Pgsql  t  f</li>
<li>建议使用字符串或者数字来存储布尔值</li>
</ul>
</li>
</ol>
<h3 id="shardingsphere-proxy-521">Shardingsphere proxy 5.2.1</h3>
<ol>
<li>对 <code>json</code> <code>jsonb</code> 类型的属性支持不好<!-- -->
<ul>
<li>建议直接使用 <code>text</code> 大文本格式，可以同时避免在不同数据库之间的兼容性问题</li>
<li>对于类型 <code>TypeHandler</code> 直接使用 MybatisPlus 提供的 <code>JacksonTypeHandler</code> <code>FastjsonTypeHandler</code> <code>GsonTypeHandler</code></li>
</ul>
</li>
</ol>
<h3 id="shardingsphere-proxy-541">Shardingsphere proxy 5.4.1</h3>
<ol>
<li>不支持系统表的查询，如 <code>pg_namespace</code> <code>pg_tablespace</code> 等<!-- -->
<ul>
<li>目前测试仅可以使用 <code>psql</code> 命令行的方式查询代理的数据库表，系统表查询报错 <code>Table or view &#x27;pg_namespace&#x27; does not exists</code></li>
<li>基本处于不可用 的状态，建议直接使用 5.2.1 版本 <a href="https://github.com/apache/shardingsphere/issues/29387">issue#29387</a></li>
</ul>
</li>
</ol>
<h2 id="八参考文档">八、参考文档</h2>
<ul>
<li>
<p><a href="https://blog.51cto.com/u_12897/8329842">SQL Server 读写分离</a></p>
</li>
<li>
<p><a href="https://blog.51cto.com/u_15101584/2623066">oracle的读写分离实现</a></p>
</li>
<li>
<p><a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/replication/configure-distribution?view=sql-server-ver16">SQL Server 配置分发</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/weixin_47308871/article/details/126134314">【ShardingSphere-proxy +PostgreSQL实现读写分离（静态策略）】</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/apple_csdn/article/details/124454743">【Sharding Sphere、Spring Boot】Spring Boot整合Sharding Sphere Proxy（5.0.0）</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/qq_32681589/article/details/134651667">【ShardingSphere专题】SpringBoot整合ShardingSphere（一、数据分片入门及实验）</a></p>
</li>
<li>
<p><a href="https://blog.51cto.com/u_13171517/6596021">shardingsphere-proxy 实现postgresql的分库分表</a></p>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/middleware/shardingsphere/3-Shardingsphere-Proxy-Install.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>Lorchr</b> <!-- -->于 <b><time datetime="2024-02-23T07:23:15.000Z">2024年2月23日</time></b> <!-- -->  更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一shardingsphere-proxy-安装-docker版" class="table-of-contents__link toc-highlight">一、Shardingsphere Proxy 安装 (Docker版)</a></li><li><a href="#二shardingsphere-proxy-安装-二进制版" class="table-of-contents__link toc-highlight">二、Shardingsphere Proxy 安装 (二进制版)</a><ul><li><a href="#1-前置条件" class="table-of-contents__link toc-highlight">1. 前置条件</a></li><li><a href="#2-安装" class="table-of-contents__link toc-highlight">2. 安装</a></li></ul></li><li><a href="#三配置-confserveryaml" class="table-of-contents__link toc-highlight">三、配置 <code>conf/server.yaml</code></a><ul><li><a href="#1-配置-serveryaml-521-版本" class="table-of-contents__link toc-highlight">1. 配置 <code>server.yaml</code> (5.2.1 版本)</a></li><li><a href="#2-配置-serveryaml-541-版本" class="table-of-contents__link toc-highlight">2. 配置 <code>server.yaml</code> (5.4.1 版本)</a></li></ul></li><li><a href="#四配置-confconfig-yaml" class="table-of-contents__link toc-highlight">四、配置 <code>conf/config-*.yaml</code></a><ul><li><a href="#1-mysql-读写分离配置-confconfig-mysql-rwsyaml-521-版本" class="table-of-contents__link toc-highlight">1. Mysql 读写分离配置 <code>conf/config-mysql-rws.yaml</code> (5.2.1 版本)</a></li><li><a href="#2-mysql-读写分离配置-confconfig-mysql-rwsyaml-541-版本" class="table-of-contents__link toc-highlight">2. Mysql 读写分离配置 <code>conf/config-mysql-rws.yaml</code> (5.4.1 版本)</a></li><li><a href="#3-pgsql-读写分离配置-confconfig-pgsql-rwsyaml-521-版本" class="table-of-contents__link toc-highlight">3. Pgsql 读写分离配置 <code>conf/config-pgsql-rws.yaml</code> (5.2.1 版本)</a></li><li><a href="#4-pgsql-读写分离配置-confconfig-pgsql-rwsyaml-541-版本" class="table-of-contents__link toc-highlight">4. Pgsql 读写分离配置 <code>conf/config-pgsql-rws.yaml</code> (5.4.1 版本)</a></li></ul></li><li><a href="#五添加mysql驱动" class="table-of-contents__link toc-highlight">五、添加Mysql驱动</a></li><li><a href="#六使用客户端连接-shardingsphere-proxy" class="table-of-contents__link toc-highlight">六、使用客户端连接 ShardingSphere-Proxy</a><ul><li><a href="#1-使用-mysql-客户端连接-shardingsphere-proxy" class="table-of-contents__link toc-highlight">1. 使用 MySQL 客户端连接 ShardingSphere-Proxy：</a></li><li><a href="#2-使用-postgresql-客户端连接-shardingsphere-proxy" class="table-of-contents__link toc-highlight">2. 使用 PostgreSQL 客户端连接 ShardingSphere-Proxy：</a></li><li><a href="#3-使用-opengauss-客户端连接-shardingsphere-proxy" class="table-of-contents__link toc-highlight">3. 使用 openGauss 客户端连接 ShardingSphere-Proxy：</a></li></ul></li><li><a href="#七总结" class="table-of-contents__link toc-highlight">七、总结</a><ul><li><a href="#共性问题" class="table-of-contents__link toc-highlight">共性问题</a></li><li><a href="#shardingsphere-proxy-521" class="table-of-contents__link toc-highlight">Shardingsphere proxy 5.2.1</a></li><li><a href="#shardingsphere-proxy-541" class="table-of-contents__link toc-highlight">Shardingsphere proxy 5.4.1</a></li></ul></li><li><a href="#八参考文档" class="table-of-contents__link toc-highlight">八、参考文档</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>