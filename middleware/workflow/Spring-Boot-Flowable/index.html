<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-middleware docs-version-current docs-doc-page docs-doc-id-workflow/Spring-Boot-Flowable" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Spring-Boot-Flowable | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/middleware/workflow/Spring-Boot-Flowable/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" property="og:title" content="Spring-Boot-Flowable | Light Docusaurus"><meta data-rh="true" name="description" content="- Spring Boot整合流程引擎Flowable"><meta data-rh="true" property="og:description" content="- Spring Boot整合流程引擎Flowable"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/middleware/workflow/Spring-Boot-Flowable/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/middleware/workflow/Spring-Boot-Flowable/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/middleware/workflow/Spring-Boot-Flowable/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.609e5209.css">
<script src="/light-docusaurus/assets/js/runtime~main.ce5c1d45.js" defer="defer"></script>
<script src="/light-docusaurus/assets/js/main.704d0d8d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/light-docusaurus/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/middleware/workflow/Spring-Boot-Flowable/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/middleware/">MiddleWare</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/compare/">Compare</a><button aria-label="展开侧边栏分类 &#x27;Compare&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/mysql/">Mysql</a><button aria-label="展开侧边栏分类 &#x27;Mysql&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/postgresql/">Postgresql</a><button aria-label="展开侧边栏分类 &#x27;Postgresql&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/redis/">Redis</a><button aria-label="展开侧边栏分类 &#x27;Redis&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/nginx/">Nginx</a><button aria-label="展开侧边栏分类 &#x27;Nginx&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/mqtt/">MQTT</a><button aria-label="展开侧边栏分类 &#x27;MQTT&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/influxdb/">InfluxDB</a><button aria-label="展开侧边栏分类 &#x27;InfluxDB&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/kafka/">Kafka</a><button aria-label="展开侧边栏分类 &#x27;Kafka&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/rocketmq/">RocketMQ</a><button aria-label="展开侧边栏分类 &#x27;RocketMQ&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/light-docusaurus/middleware/category/workflow/">Workflow</a><button aria-label="折叠侧边栏分类 &#x27;Workflow&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/middleware/workflow/Workflow-Core-Concept/">Workflow-Core-Concept</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/middleware/workflow/Web-UI/">Web-UI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/middleware/workflow/Countersign-and-ParallerApproval/">Countersign-and-ParallerApproval</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/middleware/workflow/Spring-Boot-Camunda/">Spring-Boot-Camunda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/middleware/workflow/Flowable-Usage/">Flowable-Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/middleware/workflow/Spring-Boot-Flowable/">Spring-Boot-Flowable</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/plusar/">Plusar</a><button aria-label="展开侧边栏分类 &#x27;Plusar&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/middleware/category/workflow/"><span itemprop="name">Workflow</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spring-Boot-Flowable</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Spring-Boot-Flowable</h1></header><ul>
<li><a href="https://blog.csdn.net/qq_43372633/article/details/130598488">Spring Boot整合流程引擎Flowable</a></li>
<li><a href="https://mp.weixin.qq.com/s/O-LrOhGf4Fe6fTSz6mXtqQ">SpringBoot+Flowable 完美结合，优雅实现工作流！</a></li>
</ul>
<p>工作流Flowable学习，入门，实战</p>
<h2 id="1-工作流介绍">1. 工作流介绍</h2>
<h3 id="11-为什么使用工作流">1.1 为什么使用工作流</h3>
<p>在程序员工作中，或多或少都会遇见审批流程类型的业务需求。一个审批流程可能包含开始-&gt;申请-&gt;领导审批-&gt;老板审批-&gt;结束等多个阶段，如果我们用字段去定义每一个流程阶段(0-&gt;开始 1-&gt;申请 2-&gt;领导审批 3-&gt;老板审批 4-&gt;结束)，虽然可以实现流程运行逻辑，但这样业务代码逻辑复杂。如果审批流程还有驳回操作，则还需要加一个是否驳回字段，显然这样实现，成本太大，且不利于维护。</p>
<p>为了解决上述用代码逻辑硬写审批流程而导致的成本大，不利用维护的缺点，工作流因此而生。</p>
<h3 id="12-工作流是什么">1.2 工作流是什么</h3>
<p>工作流，是把业务之间的各个步骤以及规则进行抽象和概括性的描述。使用特定的语言为业务流程建模，让其运行在计算机上，并让计算机进行计算和推动。工作流是复杂版本的状态机。</p>
<p>简单状态</p>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-1-f50ded8eb124b2fca79d1b9a23f4be6e.png" width="696" height="407"></p>
<p>上图为工作流退化为基础状态机的例子，路人乙的状态非常简单，站起来-&gt;走起来-&gt;跑起来-&gt;慢下来-&gt;站起来，无限循环，如果让我们实现路人乙的状态切换，那么我们只需要用一个字段来记录路人乙当前的状态就好了。</p>
<p>而对于复杂的状态或者状态维度增加且状态流转的条件极为复杂，可能单纯用字段记录状态的实现方式就会不那么理想。如下图:</p>
<p>复杂状态</p>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-2-e6c6a44ccf2511152b6a26eec3542950.png" width="1051" height="680"></p>
<p>现在交给路人甲的选择就多了起来，当路人甲获发完工资后的时候，他会根据余额的大小来判断接下来该如何行动，如果数额小于等于5000，那么他决定买一个平板，如果数额小于等于10万，那么路人甲就决定去学习一下购买理财产品，但如果路人甲获得的余额数量超过了30万，他就决定购买一辆宝马，但购买宝马的流程是复杂的，路人甲决定同时完成交首付和贷款的手续。</p>
<p>其实这个流程还不算特别复杂，但到目前为止，单纯用一个字段来表明状态已经无法满足要求了。</p>
<blockquote>
<p>工作流解决的痛点在于，解除业务宏观流程和微观逻辑的耦合，让熟悉宏观业务流程的人去制定整套流转逻辑，而让专业的人只需要关心他们应当关心的流程节点，就好比大家要一起修建一座超级体育场，路人甲只需要关心他身边的这一堆砖是怎么堆砌而非整座建筑。</p>
</blockquote>
<h3 id="13-工作流不能解决的问题">1.3 工作流不能解决的问题</h3>
<p>工作流无法解决毫无关系(没有前后关联)的事务。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-3-6fa287c741ade20b493af21cf4927a36.png" width="883" height="462"></p>
<p>工作流是一个固定好的框架，大家就按照这个框架来执行流程就行了，但某些情况他本身没有流转顺序的。</p>
<p>比如：路人丙每天需要学习，谈恋爱以及玩游戏，它们之间没有关联性无法建立流程，但可以根据每一项完成的状态决定今天的任务是否完结，这种情况我们需要使用CMMN来 建模，它就是专门针对这种情况而设计的，但今天我们不讲这个，而是讲讲BPMN协议。</p>
<h2 id="2-bpmn20协议">2. BPMN2.0协议</h2>
<h3 id="21-什么是bpmn20协议">2.1 什么是BPMN2.0协议</h3>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-4-b0f6eda6087fb26d02246b8482ae560b.png" width="368" height="371"></p>
<p>对于业务建模，我们需要一种通用的语言来描绘，这样在沟通上和实现上会降低难度，就像中文、英文一样，BPMN2.0便是一种国际通用的建模语言，他能让自然人轻松阅读，更能被计算机所解析。</p>
<h3 id="22-bpmn20协议元素介绍">2.2 BPMN2.0协议元素介绍</h3>
<p>协议中元素的主要分类为，事件-任务-连线-网关。</p>
<p>一个流程必须包含一个事件（如：开始事件）和至少一个结束（事件）。其中网关的作用是流程流转逻辑的控制。任务则分很多类型，他们各司其职，所有节点均由连线联系起来。</p>
<p>下面我就以每种类型的节点简单地概括一下其作用。</p>
<h4 id="网关">网关：</h4>
<ol>
<li>
<p>互斥网关（Exclusive Gateway），又称排他网关，他有且仅有一个有效出口，可以理解为if......else if...... else if......else，就和我们平时写代码的一样。</p>
</li>
<li>
<p>并行网关（Parallel Gateway），他的所有出口都会被执行，可以理解为开多线程同时执行多个任务。</p>
</li>
<li>
<p>包容性网关（Inclusive Gateway），只要满足条件的出口都会执行，可以理解为 if(......) do, if (......) do, if (......) do，所有的条件判断都是同级别的。</p>
</li>
</ol>
<h4 id="任务">任务：</h4>
<p>BPMN2.0协议的所有任务其实是从一个抽象任务派生而来的，抽象任务会有如下行为：</p>
<ul>
<li>当流程流转到该任务时，应该做些什么？</li>
<li>当该任务获得信号(signal)的时候，它是否可以继续向下流转，而任务获得信号的这个动作我们称为Trigger。</li>
</ul>
<p>利用如上的抽象行为，我们来解释一些比较常见且具有代表性的任务类型。</p>
<p><code>人工任务（User Task）</code>，它是使用得做多的一种任务类型，他自带有一些人工任务的变量，例如签收人（Assignee），签收人就代表该任务交由谁处理，我们也可以通过某个特定或一系列特定的签收人来查找待办任务。利用上面的行为解释便是，当到达User Task节点的时候，节点设置Assignee变量或等待设置Assignee变量，当任务被完成的时候，我们使用Trigger来要求流程引擎退出该任务，继续流转。</p>
<p><code>服务任务（Service Task）</code>，该任务会在到达的时候执行一段自动的逻辑并自动流转。从“到达自动执行一段逻辑”这里我们就可以发现，服务任务的想象空间就可以非常大，我们可以执行一段计算，执行发送邮件，执行RPC调用，而使用最广泛的则为HTTP调用，因为HTTP是使用最广泛的协议之一，它可以解决大部分第三方调用问题，在我们的使用中，HTTP服务任务也被我们单独剥离出来作为一个特殊任务节点。</p>
<p><code>接受任务（Receive Task）</code>，该任务的名字让人费解，但它又是最简单的一种任务，当该任务到达的时候，它不做任何逻辑，而是被动地等待Trigger，它的适用场景往往是一些不明确的阻塞，比如：一个复杂的计算需要等待很多条件，这些条件是需要人为来判断是否可以执行，而不是直接执行，这个时候，工作人员如果判断可以继续了，那么就Trigger一下使其流转。</p>
<p><code>调用活动（Call Activity）</code>，调用活动可以理解为函数调用，它会引用另外一个流程使之作为子流程运行，调用活动跟函数调用的功能一样，使流程模块化，增加复用的可能性。</p>
<p>上面大概介绍了一下常用的节点，下面的图就展示了一个 以BPMN2.0为基础的流程模型，尽量覆盖到所介绍的所有节点。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-5-15ee15de2f92409982193b3e3fa506fb.png" width="1080" height="569"></p>
<p>这里是一个生产手机的流程，从“手机设计”节点到“批准生产”节点是一个串行的任务，而审批的结果会遇到一个互斥网关，上面讲过，互斥网关只需要满足其中一个条件就会流转，而这里表达的意义就是审批是否通过。</p>
<p>“载入图纸”是一个服务任务，它是自动执行的，之后会卡在“等待原材料”这个节点，因为这个节点是需要人为去判断（比如原材料涨价，原材料不足等因素），所以需要在一种自定义的条件下Trigger，而该图的条件应该为“原材料足够”，原材料足够之后，我们会开始并行生产手机零件。</p>
<p>需要注意的是，并行网关在图中是成对出现的，他的作用是开始一系列并行任务和等待并行任务一起完成。</p>
<h3 id="23-如何使用bpmn20协议">2.3 如何使用BPMN2.0协议</h3>
<p>首先，从用户的角度来看，使用者其实只需要关心三件事</p>
<p>我如何把我的业务逻辑转化为流程图-即容易理解的绘图工具。
我如何使流程流转-即开箱即用的API。
我需要引擎告诉我，我现在该处理什么节点-即丰富且鲜明的事件机制。
图中是流程图的整个生命周期，从画图到部署，然后启动流程，流程经过人工或自动的方式流转，最后结束。</p>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-6-da8f6a9d302320a13e82c8c3610fd6dc.png" width="978" height="176"></p>
<h2 id="3-flowable简介">3. Flowable简介</h2>
<h3 id="31-flowable是什么">3.1 Flowable是什么</h3>
<p>Flowable是BPMN2.0协议的一种Java版本的实现，是一个使用Java编写的轻量级业务流程引擎。Flowable流程引擎可用于部署BPMN 2.0流程定义（用于定义流程的行业XML标 准）， 创建这些流程定义的流程实例，进行查询，访问运行中或历史的流程实例与相关数据，等等。</p>
<p>Flowable可以嵌入Java应用程序中运行，也可以作为服务器、集群运行，更可以提供云服务。</p>
<h3 id="32-flowable与activiti">3.2 Flowable与Activiti</h3>
<p>Flowable是基于Activiti-6.0.0.Beta4分支开发的。目前Flowable已经修复了Activiti6很多的bug，可以实现零成本从Activiti迁移到Flowable。</p>
<h2 id="4-flowable实战">4. Flowable实战</h2>
<p>假设公司产品有一个新需求，需要你设计一个员工请假流程的功能。你该如何设计？</p>
<ol>
<li>
<p>我会用flowable来实现</p>
</li>
<li>
<p>创建springboot项目（flowable-ui），该项目是启动flowable-ui网站，在本地进行流程画图设计。安装flowable-ui，启动服务进入folwable-ui网站画图，导出图对应的xml文件 (画图)</p>
</li>
<li>
<p>创建springboot项目（flowable），该项目是启动流程应用，将对应的xml文件复制到resources下的processes文件夹中(processes文件夹需自己创建) (部署)</p>
</li>
<li>
<p>启动springboot项目 (启动)</p>
</li>
<li>
<p>通过接口调用，启动流程 (流转)</p>
</li>
</ol>
<h3 id="41-本地安装启动flowable-ui">4.1 本地安装，启动flowable-ui</h3>
<p>创建 springboot（flowable-ui）项目 项目目录</p>
<p>JavaSkillPointApplication文件</p>
<pre><code class="language-java">package com.weige.javaskillpoint;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class JavaSkillPointApplication {

    public static void main(String[] args) {
        SpringApplication.run(JavaSkillPointApplication.class, args);
    }

}
</code></pre>
<p>application.yml文件</p>
<pre><code class="language-yaml">server:
  port: 8088

flowable:
  idm:
    app:
      admin:
        # 登录的用户名
        user-id: admin
        # 登录的密码
        password: admin
        # 用户的名字
        first-name: wei
        last-name: kai
spring:
  # mysql连接信息
  datasource:
    # mysql8之后
    driver-class-name: com.mysql.cj.jdbc.Driver
    # mysql8之前
#    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://43.143.132.109:3306/flowable?useUnicode=true&amp;characterEncoding=utf8&amp;tinyInt1isBit=false&amp;useSSL=false&amp;serverTimezone=GMT&amp;nullCatalogMeansCurrent=true
    username: root
    password: ******
  jpa:
    properties:
      hibernate:
        hbm2ddl:
          auto: update
        dialect: org.hibernate.dialect.MySQL5InnoDBDialect
    open-in-view: true
</code></pre>
<p>注意：</p>
<p><code>&amp;nullCatalogMeansCurrent=true</code> 这个一定要加在url后，不然flowable自动创建表失败</p>
<p>在数据库中创建flowable数据库，启动flowable-ui项目时，flowable服务会自动创建对应的表</p>
<p>启动项目后 网站的登录用户 密码 <code>user-id: admin password: admin</code></p>
<p>pom.xml文件</p>
<pre><code class="language-xml"> &lt;dependencies&gt;
    &lt;!--Springboot项目自带 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
    &lt;/dependency&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;
    &lt;/dependency&gt;
    &lt;!--Springboot Web项目 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!--lombok --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
        &lt;artifactId&gt;lombok&lt;/artifactId&gt;
        &lt;version&gt;1.18.22&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- idm依赖提供身份认证 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.flowable&lt;/groupId&gt;
        &lt;artifactId&gt;flowable-spring-boot-starter-ui-idm&lt;/artifactId&gt;
        &lt;version&gt;6.7.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- modeler绘制流程图 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.flowable&lt;/groupId&gt;
        &lt;artifactId&gt;flowable-spring-boot-starter-ui-modeler&lt;/artifactId&gt;
        &lt;version&gt;6.7.1&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- jpa --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- mysql驱动 --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- flowable --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.flowable&lt;/groupId&gt;
        &lt;artifactId&gt;flowable-spring-boot-starter&lt;/artifactId&gt;
        &lt;version&gt;6.7.1&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<p>启动项目</p>
<p>访问 <a href="http://localhost:8088/">http://localhost:8088/</a></p>
<p>这个时候就可以开始设计员工请假流程图 我先画一个完整的出来 将每个步骤对应的信息都截下来 供大家参考</p>
<p><img alt="img" src="/light-docusaurus/assets/images/flowable-8-f11db551ee58bc56306fd9ef538952f2.png" width="1080" height="524">
<img alt="img" src="/light-docusaurus/assets/images/flowable-9-9ab32a03f290b6e3965680ed5fc21e4d.png" width="1080" height="520">
<img alt="img" src="/light-docusaurus/assets/images/flowable-10-13033f21cdbdd4944fa90c15cc5e3163.png" width="1080" height="528">
<img alt="img" src="/light-docusaurus/assets/images/flowable-11-569a29d58289090559f13e79ea96ae23.png" width="1080" height="391">
<img alt="img" src="/light-docusaurus/assets/images/flowable-12-eb257c0e0ac5782d15c6561e0c96a16c.png" width="1080" height="530">
<img alt="img" src="/light-docusaurus/assets/images/flowable-13-e1b36a3b1ba61eaea2aac47ae00fb02e.png" width="1080" height="412">
<img alt="img" src="/light-docusaurus/assets/images/flowable-14-c3bb326b5addf24e56fe6f5f1510c4cd.png" width="1080" height="500">
<img alt="img" src="/light-docusaurus/assets/images/flowable-15-7ae0fe8ebdd221c60ee559a159c30060.png" width="1080" height="477">
<img alt="img" src="/light-docusaurus/assets/images/flowable-16-d6c1df25e4c249e78716486d3aa11ef9.png" width="1080" height="469">
<img alt="img" src="/light-docusaurus/assets/images/flowable-17-65394910a50813983fbf393408a6e10c.png" width="1080" height="507">
<img alt="img" src="/light-docusaurus/assets/images/flowable-18-b038f297402f9d0324620293b80da403.png" width="1080" height="461">
<img alt="img" src="/light-docusaurus/assets/images/flowable-19-96c87c651158d950394b5bef87c50b89.png" width="1080" height="483">
<img alt="img" src="/light-docusaurus/assets/images/flowable-20-cc385351c6973b933c110a22481909b9.png" width="1080" height="531">
<img alt="img" src="/light-docusaurus/assets/images/flowable-21-5437bb1564bf7918eca1254e1e3748b1.png" width="1080" height="419"></p>
<p>推荐大家画一遍 这里我会上传请假流程的xml文件，大家直接导入即可，通过链接下载流程xml文件</p>
<p>链接: <a href="https://pan.baidu.com/s/10FAFBiM3SYUj9FcSoPadtw?pwd=rqku">https://pan.baidu.com/s/10FAFBiM3SYUj9FcSoPadtw?pwd=rqku</a> 提取码: rqku</p>
<h3 id="42-创建flowable应用项目-部署并启动">4.2 创建flowable应用项目 部署并启动</h3>
<p>创建springboot项目</p>
<p>项目目录</p>
<p>JavaSkillPointApplication文件</p>
<pre><code class="language-java">package com.weige.javaskillpoint;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class JavaSkillPointApplication {

    public static void main(String[] args) {
        SpringApplication.run(JavaSkillPointApplication.class, args);
    }

}
</code></pre>
<p>公司员工请假流程.bpmn20.xml 在resources下创建processes文件夹 复制xml文件到该目录即可</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;definitions xmlns=&quot;http://www.omg.org/spec/BPMN/20100524/MODEL&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:flowable=&quot;http://flowable.org/bpmn&quot; xmlns:bpmndi=&quot;http://www.omg.org/spec/BPMN/20100524/DI&quot; xmlns:omgdc=&quot;http://www.omg.org/spec/DD/20100524/DC&quot; xmlns:omgdi=&quot;http://www.omg.org/spec/DD/20100524/DI&quot; typeLanguage=&quot;http://www.w3.org/2001/XMLSchema&quot; expressionLanguage=&quot;http://www.w3.org/1999/XPath&quot; targetNamespace=&quot;http://www.flowable.org/processdef&quot; exporter=&quot;Flowable Open Source Modeler&quot; exporterVersion=&quot;6.7.1&quot;&gt;
  &lt;process id=&quot;leave&quot; name=&quot;公司员工请假流程&quot; isExecutable=&quot;true&quot;&gt;
    &lt;documentation&gt;公司员工请假流程&lt;/documentation&gt;
    &lt;startEvent id=&quot;startEvent1&quot; name=&quot;开始 &quot; flowable:formFieldValidation=&quot;true&quot;&gt;&lt;/startEvent&gt;
    &lt;userTask id=&quot;apply&quot; name=&quot;请假申请 &quot; flowable:assignee=&quot;${studentUser}&quot; flowable:formFieldValidation=&quot;true&quot;&gt;
      &lt;extensionElements&gt;
        &lt;modeler:initiator-can-complete xmlns:modeler=&quot;http://flowable.org/modeler&quot;&gt;&lt;![CDATA[false]]&gt;&lt;/modeler:initiator-can-complete&gt;
      &lt;/extensionElements&gt;
    &lt;/userTask&gt;
    &lt;userTask id=&quot;teacherPass&quot; name=&quot;领导审批 &quot; flowable:candidateGroups=&quot;a&quot; flowable:formFieldValidation=&quot;true&quot;&gt;&lt;/userTask&gt;
    &lt;exclusiveGateway id=&quot;judgeTask&quot; name=&quot;判断是否大于2天&quot;&gt;&lt;/exclusiveGateway&gt;
    &lt;sequenceFlow id=&quot;applyFlow&quot; name=&quot;申请流程 &quot; sourceRef=&quot;apply&quot; targetRef=&quot;teacherPass&quot;&gt;&lt;/sequenceFlow&gt;
    &lt;userTask id=&quot;principalPass&quot; name=&quot;老板审批&quot; flowable:candidateGroups=&quot;b&quot; flowable:formFieldValidation=&quot;true&quot;&gt;&lt;/userTask&gt;
    &lt;endEvent id=&quot;sid-EA94CD8C-3002-421E-BD64-B46EBDD8070F&quot; name=&quot;结束&quot;&gt;&lt;/endEvent&gt;
    &lt;sequenceFlow id=&quot;principalCheck&quot; name=&quot;通过&quot; sourceRef=&quot;principalPass&quot; targetRef=&quot;sid-EA94CD8C-3002-421E-BD64-B46EBDD8070F&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${outcome==&#x27;通过&#x27;}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;sid-8BA4821E-F022-45C8-B86B-CD7052B9FB05&quot; name=&quot;流程开始 &quot; sourceRef=&quot;startEvent1&quot; targetRef=&quot;apply&quot;&gt;&lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;teacherPassFlow&quot; name=&quot;通过 &quot; sourceRef=&quot;teacherPass&quot; targetRef=&quot;judgeTask&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${outcome==&#x27;通过&#x27;}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;teacherNotPassFlow&quot; name=&quot;驳回&quot; sourceRef=&quot;teacherPass&quot; targetRef=&quot;apply&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${outcome==&#x27;驳回&#x27;}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;judgeLess&quot; name=&quot;小于2天&quot; sourceRef=&quot;judgeTask&quot; targetRef=&quot;sid-EA94CD8C-3002-421E-BD64-B46EBDD8070F&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${day&lt;=2}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;judgeMore&quot; name=&quot;大于2天 &quot; sourceRef=&quot;judgeTask&quot; targetRef=&quot;principalPass&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${day&gt;2}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
    &lt;sequenceFlow id=&quot;principalNotPassFlow&quot; name=&quot;驳回 &quot; sourceRef=&quot;principalPass&quot; targetRef=&quot;apply&quot;&gt;
      &lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[${outcome==&#x27;驳回&#x27;}]]&gt;&lt;/conditionExpression&gt;
    &lt;/sequenceFlow&gt;
  &lt;/process&gt;
  &lt;bpmndi:BPMNDiagram id=&quot;BPMNDiagram_leave&quot;&gt;
    &lt;bpmndi:BPMNPlane bpmnElement=&quot;leave&quot; id=&quot;BPMNPlane_leave&quot;&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;startEvent1&quot; id=&quot;BPMNShape_startEvent1&quot;&gt;
        &lt;omgdc:Bounds height=&quot;30.0&quot; width=&quot;30.0&quot; x=&quot;74.99999776482586&quot; y=&quot;159.99999329447763&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;apply&quot; id=&quot;BPMNShape_apply&quot;&gt;
        &lt;omgdc:Bounds height=&quot;80.0&quot; width=&quot;100.0&quot; x=&quot;254.99999620020395&quot; y=&quot;134.99999798834327&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;teacherPass&quot; id=&quot;BPMNShape_teacherPass&quot;&gt;
        &lt;omgdc:Bounds height=&quot;79.99999999999994&quot; width=&quot;100.0&quot; x=&quot;494.9999926239253&quot; y=&quot;134.99999798834327&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;judgeTask&quot; id=&quot;BPMNShape_judgeTask&quot;&gt;
        &lt;omgdc:Bounds height=&quot;40.0&quot; width=&quot;40.0&quot; x=&quot;734.9999780952935&quot; y=&quot;154.99999567866334&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;principalPass&quot; id=&quot;BPMNShape_principalPass&quot;&gt;
        &lt;omgdc:Bounds height=&quot;80.0&quot; width=&quot;100.0&quot; x=&quot;704.9999785423283&quot; y=&quot;434.999993517995&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNShape bpmnElement=&quot;sid-EA94CD8C-3002-421E-BD64-B46EBDD8070F&quot; id=&quot;BPMNShape_sid-EA94CD8C-3002-421E-BD64-B46EBDD8070F&quot;&gt;
        &lt;omgdc:Bounds height=&quot;28.0&quot; width=&quot;28.0&quot; x=&quot;914.9999863654377&quot; y=&quot;160.99999089539082&quot;&gt;&lt;/omgdc:Bounds&gt;
      &lt;/bpmndi:BPMNShape&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;judgeLess&quot; id=&quot;BPMNEdge_judgeLess&quot; flowable:sourceDockerX=&quot;20.0&quot; flowable:sourceDockerY=&quot;20.0&quot; flowable:targetDockerX=&quot;14.0&quot; flowable:targetDockerY=&quot;14.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;774.9442491776681&quot; y=&quot;174.9999951288619&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;914.9999863654377&quot; y=&quot;174.9999912788773&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;judgeMore&quot; id=&quot;BPMNEdge_judgeMore&quot; flowable:sourceDockerX=&quot;20.0&quot; flowable:sourceDockerY=&quot;20.0&quot; flowable:targetDockerX=&quot;50.0&quot; flowable:targetDockerY=&quot;40.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;754.9999781250214&quot; y=&quot;194.94667175689042&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;754.9999784827237&quot; y=&quot;434.999993517995&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;principalNotPassFlow&quot; id=&quot;BPMNEdge_principalNotPassFlow&quot; flowable:sourceDockerX=&quot;50.0&quot; flowable:sourceDockerY=&quot;40.0&quot; flowable:targetDockerX=&quot;50.0&quot; flowable:targetDockerY=&quot;40.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;704.9999785423213&quot; y=&quot;474.88912948633504&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;304.0&quot; y=&quot;474.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;304.86621744522387&quot; y=&quot;214.94999798834328&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;teacherNotPassFlow&quot; id=&quot;BPMNEdge_teacherNotPassFlow&quot; flowable:sourceDockerX=&quot;50.0&quot; flowable:sourceDockerY=&quot;39.99999999999997&quot; flowable:targetDockerX=&quot;50.0&quot; flowable:targetDockerY=&quot;40.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;544.9999926239253&quot; y=&quot;134.99999798834327&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;544.9999926239253&quot; y=&quot;75.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;306.0&quot; y=&quot;75.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;305.3994977262591&quot; y=&quot;134.99999798834327&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;applyFlow&quot; id=&quot;BPMNEdge_applyFlow&quot; flowable:sourceDockerX=&quot;50.0&quot; flowable:sourceDockerY=&quot;40.0&quot; flowable:targetDockerX=&quot;50.0&quot; flowable:targetDockerY=&quot;39.99999999999997&quot;&gt;
        &lt;omgdi:waypoint x=&quot;354.94999620020394&quot; y=&quot;174.99999798834324&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;494.9999926238438&quot; y=&quot;174.99999798834324&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;principalCheck&quot; id=&quot;BPMNEdge_principalCheck&quot; flowable:sourceDockerX=&quot;50.0&quot; flowable:sourceDockerY=&quot;40.0&quot; flowable:targetDockerX=&quot;14.0&quot; flowable:targetDockerY=&quot;14.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;804.9499785423245&quot; y=&quot;474.71097808621374&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;928.0&quot; y=&quot;474.0&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;928.953164519099&quot; y=&quot;188.9499145334794&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;sid-8BA4821E-F022-45C8-B86B-CD7052B9FB05&quot; id=&quot;BPMNEdge_sid-8BA4821E-F022-45C8-B86B-CD7052B9FB05&quot; flowable:sourceDockerX=&quot;15.0&quot; flowable:sourceDockerY=&quot;15.0&quot; flowable:targetDockerX=&quot;50.0&quot; flowable:targetDockerY=&quot;40.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;104.94999736929918&quot; y=&quot;174.99999362086504&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;254.99999620020395&quot; y=&quot;174.9999968967466&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
      &lt;bpmndi:BPMNEdge bpmnElement=&quot;teacherPassFlow&quot; id=&quot;BPMNEdge_teacherPassFlow&quot; flowable:sourceDockerX=&quot;50.0&quot; flowable:sourceDockerY=&quot;39.99999999999997&quot; flowable:targetDockerX=&quot;20.0&quot; flowable:targetDockerY=&quot;20.0&quot;&gt;
        &lt;omgdi:waypoint x=&quot;594.949992623855&quot; y=&quot;174.9999974384194&quot;&gt;&lt;/omgdi:waypoint&gt;
        &lt;omgdi:waypoint x=&quot;734.9999775100968&quot; y=&quot;174.99999589808294&quot;&gt;&lt;/omgdi:waypoint&gt;
      &lt;/bpmndi:BPMNEdge&gt;
    &lt;/bpmndi:BPMNPlane&gt;
  &lt;/bpmndi:BPMNDiagram&gt;
&lt;/definitions&gt;
</code></pre>
<p>application.yml</p>
<pre><code class="language-yaml">server:
  port: 8081

spring:
  # mysql连接信息
  datasource:
    # mysql8之后
#    driver-class-name: com.mysql.cj.jdbc.Driver
    # mysql8之前
    driver-class-name: com.mysql.jdbc.Driver
    url: jdbc:mysql://43.143.132.109:3306/flowable?useUnicode=true&amp;characterEncoding=utf8&amp;tinyInt1isBit=false&amp;useSSL=false&amp;serverTimezone=GMT
    username: root
    password: ******
</code></pre>
<p>注意：这里的数据库url链接应与flowable-ui项目保持一致</p>
<p>JavaSkillPointApplicationTests测试文件</p>
<pre><code class="language-java">package com.weige.javaskillpoint;

import org.flowable.engine.HistoryService;
import org.flowable.engine.RuntimeService;
import org.flowable.engine.TaskService;
import org.flowable.engine.history.HistoricActivityInstance;
import org.flowable.engine.runtime.ProcessInstance;
import org.flowable.task.api.Task;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.util.CollectionUtils;

import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.stream.Collectors;

@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

    @Test
    void sub() {
        // 员工提交请假申请
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;day&quot;, 5);
        map.put(&quot;studentUser&quot;, &quot;小明&quot;);
        // leave为员工请假流程xml文件中的id
        ProcessInstance a1 = runtimeService.startProcessInstanceByKey(&quot;leave&quot;, map);

        Task task = taskService.createTaskQuery().processInstanceId(a1.getId()).singleResult();
        taskService.complete(task.getId());
    }


    @Test
    void queryLeadTask() {
        // 查询领导分组的任务
        List&lt;Task&gt; teacher = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        for (Task task : teacher) {
            // 根据任务id查询当前任务参数
            Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());
            System.out.println(variables.get(&quot;day&quot;) + &quot;,&quot; + variables.get(&quot;studentUser&quot;));
        }
    }

    @Test
    void queryBossTask() {
        // 查询老板分组的任务
        List&lt;Task&gt; teacher = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        for (Task task : teacher) {
            // 根据任务id查询当前任务参数
            Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());
            System.out.println(variables.get(&quot;day&quot;) + &quot;,&quot; + variables.get(&quot;studentUser&quot;));
        }
    }

    @Test
    void LeadApprovalTask() {
        // 领导审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }
    }

    @Test
    void boosApprovalTask() {
        // 老板审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }
    }

    @Test
    void queryHistory() {
        List&lt;ProcessInstance&gt; processInstance = runtimeService.createProcessInstanceQuery().processDefinitionKey(&quot;leave&quot;).orderByStartTime().desc().list();
        if (CollectionUtils.isEmpty(processInstance)) {
            System.out.println(&quot;------------------------------------------&quot;);
        }
        // 获取最近的一个流程
        List&lt;HistoricActivityInstance&gt; activities = historyService.createHistoricActivityInstanceQuery()
                .processInstanceId(processInstance.get(0).getId())
                // 只查询已经完成的活动
                .finished()
                // 按照结束时间排序
                .orderByHistoricActivityInstanceEndTime().desc()
                .list();
        List&lt;String&gt; collect = activities.stream().map(a -&gt; &quot;活动名称:&quot; + a.getActivityName() + &quot;;活动执行时间:&quot; + a.getDurationInMillis() + &quot;毫秒&quot;).collect(Collectors.toList());
        for (String s : collect) {
            System.out.println(s);
        }
    }

    @Test
    void Test() {
        // 发起请假
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;day&quot;, 5);
        map.put(&quot;studentUser&quot;, &quot;小明&quot;);
        ProcessInstance studentLeave = runtimeService.startProcessInstanceByKey(&quot;leave&quot;, map);
        Task task = taskService.createTaskQuery().processInstanceId(studentLeave.getId()).singleResult();
        taskService.complete(task.getId());

        // 领导审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }

        // 老板审批
        List&lt;Task&gt; principalTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        Map&lt;String, Object&gt; principalMap = new HashMap&lt;&gt;();
        principalMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task principalTask : principalTaskList) {
            taskService.complete(principalTask.getId(), principalMap);
        }

        // 查看历史
        List&lt;HistoricActivityInstance&gt; activities = historyService.createHistoricActivityInstanceQuery()
                .processInstanceId(studentLeave.getId())
                .finished()
                .orderByHistoricActivityInstanceEndTime().asc()
                .list();
        for (HistoricActivityInstance activity : activities) {
            System.out.println(activity.getActivityName());
        }
    }
}
</code></pre>
<h3 id="43-启动流程代码详解">4.3 启动流程代码详解</h3>
<p>流程实例</p>
<ol>
<li>
<p>现在已经在流程引擎中部署了流程定义，因此可以使用这个流程定义作为“蓝图”启动流程实例。</p>
</li>
<li>
<p>我们使用RuntimeService启动一个流程实例。</p>
</li>
<li>
<p>收集的数据作为一个java.util.Map实例传递，其中的键就是之后用于获取变量的标识符。</p>
</li>
<li>
<p>这个流程实例使用key启动。这个key就是BPMN 2.0 XML文件中设置的id属性。</p>
</li>
<li>
<p>在这个例子里是StudentLeave。</p>
</li>
</ol>
<p>这两个就是在XML文件钟定义的变量</p>
<pre><code class="language-shell">flowable:assignee=&quot;${studentUser}&quot;
${outcome==‘通过’}
${day &lt;= 2}
</code></pre>
<p>员工对应的BPMN 2.0 XML属性，我们通过id启动流程</p>
<pre><code class="language-xml">&lt;process id=&quot;leave&quot; name=&quot;公司员工请假流程&quot; isExecutable=&quot;true&quot;&gt;
</code></pre>
<p>员工对应的BPMN 2.0 XML属性 通过assignee员工可以发起请假流程</p>
<pre><code class="language-xml">&lt;userTask id=&quot;apply&quot; name=&quot;请假申请 &quot; flowable:assignee=&quot;${studentUser}&quot; flowable:formFieldValidation=&quot;true&quot;&gt;
    &lt;extensionElements&gt;
       &lt;modeler:initiator-can-complete xmlns:modeler=&quot;http://flowable.org/modeler&quot;&gt;&lt;![CDATA[false]]&gt;&lt;/modeler:initiator-can-complete&gt;
     &lt;/extensionElements&gt;
&lt;/userTask&gt;
</code></pre>
<p>领导对应的BPMN 2.0 XML属性 通过candidateGroups可以查询领导下可以审批的任务</p>
<pre><code class="language-xml">&lt;userTask id=&quot;teacherPass&quot; name=&quot;领导审批 &quot; flowable:candidateGroups=&quot;a&quot; flowable:formFieldValidation=&quot;true&quot;&gt;&lt;/userTask&gt;
</code></pre>
<p>老板对应的BPMN 2.0 XML属性 通过candidateGroups可以查询老板下可以审批的任务</p>
<pre><code class="language-xml">&lt;userTask id=&quot;principalPass&quot; name=&quot;老板审批&quot; flowable:candidateGroups=&quot;b&quot; flowable:formFieldValidation=&quot;true&quot;&gt;&lt;/userTask&gt;
</code></pre>
<p>员工发起请假流程代码：</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

    @Test
    void sub() {
        // 员工提交请假申请
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;day&quot;, 5);
        map.put(&quot;studentUser&quot;, &quot;小明&quot;);
        // leave为员工请假流程xml文件中的id
        ProcessInstance leave= runtimeService.startProcessInstanceByKey(&quot;leave&quot;, map);
  
        Task task = taskService.createTaskQuery().processInstanceId(leave.getId()).singleResult();
        // 员工提交请假申请
        taskService.complete(task.getId());
    }
}
</code></pre>
<p>查询领导审批任务代码：</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

    @Test
    void queryLeadTask() {
        // 查询领导分组的任务
        List&lt;Task&gt; teacher = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        for (Task task : teacher) {
            // 根据任务id查询当前任务参数
            Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());
            System.out.println(variables.get(&quot;day&quot;) + &quot;,&quot; + variables.get(&quot;studentUser&quot;));
        }
    }
}
</code></pre>
<p>查询老板审批任务代码：</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

    @Test
    void queryBossTask() {
        // 查询老板分组的任务
        List&lt;Task&gt; teacher = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        for (Task task : teacher) {
            // 根据任务id查询当前任务参数
            Map&lt;String, Object&gt; variables = taskService.getVariables(task.getId());
            System.out.println(variables.get(&quot;day&quot;) + &quot;,&quot; + variables.get(&quot;studentUser&quot;));
        }
    }
}
</code></pre>
<p>领导进行审批任务代码（通过或驳回）：</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

  @Test
    void LeadApprovalTask() {
        // 领导审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }
    }
}
</code></pre>
<p>老板进行审批任务代码（通过或驳回）：</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

  @Test
    void boosApprovalTask() {
        // 老板审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }
    }
}
</code></pre>
<p>查询最进一个流程所走的节点时间（这里的流程不能走完，如果day=5，我们先执行领导审批，则开始查询流程开始到领导审批的节点信息，如果我们进行了老板审批，则该流程结束，此时查询为流程节点信息为空，因为该流程已执行完。）：</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

  @Test
    void queryHistory() {
        List&lt;ProcessInstance&gt; processInstance = runtimeService.createProcessInstanceQuery().processDefinitionKey(&quot;leave&quot;).orderByStartTime().desc().list();
        if (CollectionUtils.isEmpty(processInstance)) {
            System.out.println(&quot;------------------------------------------&quot;);
        }
        // 获取最近的一个流程
        List&lt;HistoricActivityInstance&gt; activities = historyService.createHistoricActivityInstanceQuery()
                .processInstanceId(processInstance.get(0).getId())
                // 只查询已经完成的活动
                .finished()
                // 按照结束时间排序
                .orderByHistoricActivityInstanceEndTime().desc()
                .list();
        List&lt;String&gt; collect = activities.stream().map(a -&gt; &quot;活动名称:&quot; + a.getActivityName() + &quot;;活动执行时间:&quot; + a.getDurationInMillis() + &quot;毫秒&quot;).collect(Collectors.toList());
        for (String s : collect) {
            System.out.println(s);
        }
    }
}
</code></pre>
<p>员工请假天数小于等于2时</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

  @Test
    void Test() {
        // 发起请假
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;day&quot;, 2);
        map.put(&quot;studentUser&quot;, &quot;小明&quot;);
        ProcessInstance studentLeave = runtimeService.startProcessInstanceByKey(&quot;leave&quot;, map);
        Task task = taskService.createTaskQuery().processInstanceId(studentLeave.getId()).singleResult();
        taskService.complete(task.getId());

        // 领导审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }

        // 老板审批
        List&lt;Task&gt; principalTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        Map&lt;String, Object&gt; principalMap = new HashMap&lt;&gt;();
        principalMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task principalTask : principalTaskList) {
            taskService.complete(principalTask.getId(), principalMap);
        }

        // 查看历史
        List&lt;HistoricActivityInstance&gt; activities = historyService.createHistoricActivityInstanceQuery()
                .processInstanceId(studentLeave.getId())
                .finished()
                .orderByHistoricActivityInstanceEndTime().asc()
                .list();
        for (HistoricActivityInstance activity : activities) {
            System.out.println(activity.getActivityName());
        }
    }
}
</code></pre>
<p>图片
员工请假天数大于2时</p>
<pre><code class="language-java">@SpringBootTest
class JavaSkillPointApplicationTests {
    @Autowired
    private RuntimeService runtimeService;

    @Autowired
    private TaskService taskService;

    @Autowired
    private HistoryService historyService;

  @Test
    void Test() {
        // 发起请假
        Map&lt;String, Object&gt; map = new HashMap&lt;&gt;();
        map.put(&quot;day&quot;, 5);
        map.put(&quot;studentUser&quot;, &quot;小明&quot;);
        ProcessInstance studentLeave = runtimeService.startProcessInstanceByKey(&quot;leave&quot;, map);
        Task task = taskService.createTaskQuery().processInstanceId(studentLeave.getId()).singleResult();
        taskService.complete(task.getId());

        // 领导审批
        List&lt;Task&gt; teacherTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;a&quot;).list();
        Map&lt;String, Object&gt; teacherMap = new HashMap&lt;&gt;();
        teacherMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task teacherTask : teacherTaskList) {
            taskService.complete(teacherTask.getId(), teacherMap);
        }

        // 老板审批
        List&lt;Task&gt; principalTaskList = taskService.createTaskQuery().taskCandidateGroup(&quot;b&quot;).list();
        Map&lt;String, Object&gt; principalMap = new HashMap&lt;&gt;();
        principalMap.put(&quot;outcome&quot;, &quot;通过&quot;);
        for (Task principalTask : principalTaskList) {
            taskService.complete(principalTask.getId(), principalMap);
        }

        // 查看历史
        List&lt;HistoricActivityInstance&gt; activities = historyService.createHistoricActivityInstanceQuery()
                .processInstanceId(studentLeave.getId())
                .finished()
                .orderByHistoricActivityInstanceEndTime().asc()
                .list();
        for (HistoricActivityInstance activity : activities) {
            System.out.println(activity.getActivityName());
        }
    }
}
</code></pre>
<h3 id="44-flowable数据库说明">4.4 flowable数据库说明</h3>
<p>Flowable的所有数据库表都以ACT_开头。第二部分是说明表用途的两字符标示符。服务API的命名也大略符合这个规则。</p>
<ul>
<li>
<p><code>ACT_RE_*</code> ：’ RE ’表示repository（存储）。RepositoryService接口操作的表。带此前缀的表包含的是静态信息，如，流程定义，流程的资源（图片，规则等）。</p>
</li>
<li>
<p><code>ACT_RU_*</code> ：’ RU ’表示runtime。这是运行时的表存储着流程变量，用户任务，变量，职责（job）等运行时的数据。flowable只存储实例执行期间的运行时数据，当流程实例结束时，将删除这些记录。这就保证了这些运行时的表小且快。</p>
</li>
<li>
<p><code>ACT_ID_*</code> : ’ ID ’表示identity(组织机构)。这些表包含标识的信息，如用户，用户组，等等。</p>
</li>
<li>
<p><code>ACT_HI_*</code> : ’ HI ’表示history。就是这些表包含着历史的相关数据，如结束的流程实例，变量，任务，等等。</p>
</li>
<li>
<p><code>ACT_GE_*</code> : 普通数据，各种情况都使用的数据。</p>
</li>
</ul>
<p>一般数据对应表</p>
<table><thead><tr><th>表名</th><th>表说明</th></tr></thead><tbody><tr><td>ACT_GE_BYTEARRAY</td><td>通用的流程定义和流程资源</td></tr><tr><td>ACT_GE_PROPERTY</td><td>系统相关属性</td></tr></tbody></table>
<p>流程历史记录表</p>
<table><thead><tr><th>表名</th><th>表说明</th></tr></thead><tbody><tr><td>ACT_HI_ACTINST</td><td>历史的流程实例</td></tr><tr><td>ACT_HI_ATTACHMENT</td><td>历史的流程附件</td></tr><tr><td>ACT_HI_COMMENT</td><td>历史的说明性信息</td></tr><tr><td>ACT_HI_DETAIL</td><td>历史的流程运行中的细节信息</td></tr><tr><td>ACT_HI_IDENTITYLINK</td><td>历史的流程运行过程中用户关系</td></tr><tr><td>ACT_HI_PROCINST</td><td>历史的流程实例</td></tr><tr><td>ACT_HI_TASKINST</td><td>历史的 任务实例</td></tr><tr><td>ACT_HI_VARINST</td><td>历史的流程运行中的变量信息</td></tr></tbody></table>
<p>用户用户组表</p>
<table><thead><tr><th>表名</th><th>表说明</th></tr></thead><tbody><tr><td>ACT_ID_BYTEARRAY</td><td>二进制数据表</td></tr><tr><td>ACT_ID_GROUP</td><td>用户组信息表</td></tr><tr><td>ACT_ID_INFO</td><td>用户信息详情表</td></tr><tr><td>ACT_ID_MEMBERSHIP</td><td>人与组关系表</td></tr><tr><td>ACT_ID_PRIV</td><td>权限表</td></tr><tr><td>ACT_ID_PRIV_MAPPING</td><td>用户或组权限关系表</td></tr><tr><td>ACT_ID_PROPERTY</td><td>属性表</td></tr><tr><td>ACT_ID_TOKEN</td><td>系分登录日志表</td></tr><tr><td>ACT_ID_USER</td><td>用户表</td></tr></tbody></table>
<p>流程定义表</p>
<table><thead><tr><th>表名</th><th>表说明</th></tr></thead><tbody><tr><td>ACT_RE_DEPLOYMENT</td><td>部署单元信息</td></tr><tr><td>ACT_RE_MODEL</td><td>模型信息</td></tr><tr><td>ACT_RE_PROCDEF</td><td>已部署的流程定义</td></tr></tbody></table>
<p>运行实例表</p>
<table><thead><tr><th>表名</th><th>表说明</th></tr></thead><tbody><tr><td>ACT_RU_DEADLETTER_JOB</td><td>正在运行的任务表</td></tr><tr><td>ACT_RU_EVENT_SUBSCR</td><td>运行时事件</td></tr><tr><td>ACT_RU_EXECUTION</td><td>运行时流程执行实例</td></tr><tr><td>ACT_RU_DEADLETTER_JOB</td><td>历史作业表</td></tr><tr><td>ACT_RU_EVENT_SUBSCR</td><td>运行时用户关系信息</td></tr><tr><td>ACT_RU_EXECUTION</td><td>运行时作业表</td></tr><tr><td>ACT_RU_DEADLETTER_JOB</td><td>暂停作业表</td></tr><tr><td>ACT_RU_EVENT_SUBSCR</td><td>运行时任务表</td></tr><tr><td>ACT_RU_EXECUTION</td><td>定时作业表</td></tr><tr><td>ACT_RU_EXECUTION</td><td>运行时变量表</td></tr></tbody></table>
<p>其他表</p>
<table><thead><tr><th>表名</th><th>表说明</th></tr></thead><tbody><tr><td>ACT_EVT_LOG</td><td>事件日志表</td></tr><tr><td>ACT_PROCDEF_INFO</td><td>流程定义信息</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/middleware/workflow/22-Spring-Boot-Flowable.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>liuhui</b> <!-- -->于 <b><time datetime="2024-01-03T06:56:44.000Z">2024年1月3日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/middleware/workflow/Flowable-Usage/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Flowable-Usage</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/middleware/category/plusar/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Plusar</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-工作流介绍" class="table-of-contents__link toc-highlight">1. 工作流介绍</a><ul><li><a href="#11-为什么使用工作流" class="table-of-contents__link toc-highlight">1.1 为什么使用工作流</a></li><li><a href="#12-工作流是什么" class="table-of-contents__link toc-highlight">1.2 工作流是什么</a></li><li><a href="#13-工作流不能解决的问题" class="table-of-contents__link toc-highlight">1.3 工作流不能解决的问题</a></li></ul></li><li><a href="#2-bpmn20协议" class="table-of-contents__link toc-highlight">2. BPMN2.0协议</a><ul><li><a href="#21-什么是bpmn20协议" class="table-of-contents__link toc-highlight">2.1 什么是BPMN2.0协议</a></li><li><a href="#22-bpmn20协议元素介绍" class="table-of-contents__link toc-highlight">2.2 BPMN2.0协议元素介绍</a></li><li><a href="#23-如何使用bpmn20协议" class="table-of-contents__link toc-highlight">2.3 如何使用BPMN2.0协议</a></li></ul></li><li><a href="#3-flowable简介" class="table-of-contents__link toc-highlight">3. Flowable简介</a><ul><li><a href="#31-flowable是什么" class="table-of-contents__link toc-highlight">3.1 Flowable是什么</a></li><li><a href="#32-flowable与activiti" class="table-of-contents__link toc-highlight">3.2 Flowable与Activiti</a></li></ul></li><li><a href="#4-flowable实战" class="table-of-contents__link toc-highlight">4. Flowable实战</a><ul><li><a href="#41-本地安装启动flowable-ui" class="table-of-contents__link toc-highlight">4.1 本地安装，启动flowable-ui</a></li><li><a href="#42-创建flowable应用项目-部署并启动" class="table-of-contents__link toc-highlight">4.2 创建flowable应用项目 部署并启动</a></li><li><a href="#43-启动流程代码详解" class="table-of-contents__link toc-highlight">4.3 启动流程代码详解</a></li><li><a href="#44-flowable数据库说明" class="table-of-contents__link toc-highlight">4.4 flowable数据库说明</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>