<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-middleware docs-doc-id-nginx/Nginx-From-Install-to-HA">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Nginx-From-Install-to-HA | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/light-docusaurus/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/light-docusaurus/middleware/nginx/Nginx-From-Install-to-HA/"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-middleware-current"><meta data-rh="true" property="og:title" content="Nginx-From-Install-to-HA | Light Docusaurus"><meta data-rh="true" name="description" content="Nginx 从安装到高可用"><meta data-rh="true" property="og:description" content="Nginx 从安装到高可用"><link data-rh="true" rel="icon" href="/light-docusaurus/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/light-docusaurus/middleware/nginx/Nginx-From-Install-to-HA/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/middleware/nginx/Nginx-From-Install-to-HA/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/light-docusaurus/middleware/nginx/Nginx-From-Install-to-HA/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/light-docusaurus/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/light-docusaurus/blog/atom.xml" title="Light Docusaurus Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/light-docusaurus/opensearch.xml"><link rel="stylesheet" href="/light-docusaurus/assets/css/styles.31188a40.css">
<link rel="preload" href="/light-docusaurus/assets/js/runtime~main.a08a97eb.js" as="script">
<link rel="preload" href="/light-docusaurus/assets/js/main.8deac95e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/light-docusaurus/"><div class="navbar__logo"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/light-docusaurus/img/logo.svg" alt="Torch Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/light-docusaurus/docs/zh-cn/">Torch</a><a class="navbar__item navbar__link" href="/light-docusaurus/blog/">Blog</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/light-docusaurus/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/light-docusaurus/electron/">Electron</a><a class="navbar__item navbar__link" href="/light-docusaurus/postman/">Postman</a><a class="navbar__item navbar__link" href="/light-docusaurus/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/light-docusaurus/middleware/nginx/Nginx-From-Install-to-HA/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/light-docusaurus/middleware/">MiddleWare</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/mysql/">Mysql</a><button aria-label="打开/收起侧边栏菜单「Mysql」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/postgresql/">Postgresql</a><button aria-label="打开/收起侧边栏菜单「Postgresql」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/redis/">Redis</a><button aria-label="打开/收起侧边栏菜单「Redis」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/light-docusaurus/middleware/category/nginx/">Nginx</a><button aria-label="打开/收起侧边栏菜单「Nginx」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/light-docusaurus/middleware/nginx/Ningx/">Ningx</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/light-docusaurus/middleware/nginx/Nginx-From-Install-to-HA/">Nginx-From-Install-to-HA</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/mqtt/">MQTT</a><button aria-label="打开/收起侧边栏菜单「MQTT」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/influxdb/">InfluxDB</a><button aria-label="打开/收起侧边栏菜单「InfluxDB」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/light-docusaurus/middleware/category/plusar/">Plusar</a><button aria-label="打开/收起侧边栏菜单「Plusar」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/light-docusaurus/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/light-docusaurus/middleware/category/nginx/"><span itemprop="name">Nginx</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Nginx-From-Install-to-HA</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Nginx-From-Install-to-HA</h1></header><p><a href="https://mp.weixin.qq.com/s/3vLfd7xi8AsO3cRaEgREdQ" target="_blank" rel="noopener noreferrer">Nginx 从安装到高可用</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-nginx安装">1. Nginx安装<a href="#1-nginx安装" class="hash-link" aria-label="1. Nginx安装的直接链接" title="1. Nginx安装的直接链接">​</a></h2><p>1、去<a href="http://nginx.org/" target="_blank" rel="noopener noreferrer">官网</a>下载对应的nginx包，推荐使用稳定版本
2、上传nginx到linux系统
3、安装依赖环境</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 安装gcc环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gcc-c++</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装PCRE库，用于解析正则表达式</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y pcre pcre-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># zlib压缩和解压缩依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y zlib zlib-devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># SSL 安全的加密的套接字协议层，用于HTTP安全传输，也就是https</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> -y openssl openssl-devel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>4、解压，需要注意，解压后得到的是源码，源码需要编译后才能安装</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf nginx-1.16.1.tar.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>5、编译之前，先创建nginx临时目录，如果不创建，在启动nginx的过程中会报错</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> /var/temp/nginx -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>6、在nginx目录，输入如下命令进行配置，目的是为了创建makefile文件</p><div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./configure \   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/nginx \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--pid-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/run/nginx/nginx.pid \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--lock-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/lock/nginx.lock \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--error-log-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/log/nginx/error.log \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-log-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/log/nginx/access.log \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--with-http_gzip_static_module \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-client-body-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/client \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-proxy-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/proxy \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-fastcgi-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/fastcgi \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-uwsgi-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/uwsgi \    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-scgi-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/scgi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>注：代表在命令行中换行，用于提高可读性配置命令：</p><p>7、make编译&amp;安装</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>8、进入sbin目录启动nginx</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 校验配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./nginx -t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启动</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 停止</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./nginx -s stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重新加载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./nginx -s reload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-配置反向代理">2. 配置反向代理<a href="#2-配置反向代理" class="hash-link" aria-label="2. 配置反向代理的直接链接" title="2. 配置反向代理的直接链接">​</a></h2><p>1、配置upstream</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>2、配置server</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listem  80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.tomcats.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://tomcats;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-配置负载均衡">3. 配置负载均衡<a href="#3-配置负载均衡" class="hash-link" aria-label="3. 配置负载均衡的直接链接" title="3. 配置负载均衡的直接链接">​</a></h2><p>nginx默认采用轮训的方式进行负载均衡</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1使用加权轮询">1、使用加权轮询<a href="#1使用加权轮询" class="hash-link" aria-label="1、使用加权轮询的直接链接" title="1、使用加权轮询的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080 weight=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080 weight=5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080 weight=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2hash负载均衡">2、hash负载均衡<a href="#2hash负载均衡" class="hash-link" aria-label="2、hash负载均衡的直接链接" title="2、hash负载均衡的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ip_hash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>hash算法实际上只会计算 192.168.1这段做哈希</p><p>使用ip_hash的注意点：</p><ul><li>不能把后台服务器直接移除，只能标记down.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3url-hash负载均衡">3、url hash负载均衡<a href="#3url-hash负载均衡" class="hash-link" aria-label="3、url hash负载均衡的直接链接" title="3、url hash负载均衡的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hash $request_url;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4最小连接负载均衡">4、最小连接负载均衡<a href="#4最小连接负载均衡" class="hash-link" aria-label="4、最小连接负载均衡的直接链接" title="4、最小连接负载均衡的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    least_conn;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-upstream指令参数">4. upstream指令参数<a href="#4-upstream指令参数" class="hash-link" aria-label="4. upstream指令参数的直接链接" title="4. upstream指令参数的直接链接">​</a></h2><ul><li>max_conns：限制最大同时连接数 1.11.5之前只能用于商业版</li><li>slow_start：单位秒，权重在指定时间内从1上升到指定值，不适用与hash负载均衡、随机负载均衡 如果在 upstream 中只有一台 server，则该参数失效（商业版才有）</li><li>down：禁止访问</li><li>backup：备用机 只有在其他服务器无法访问的时候才能访问到 不适用与hash负载均衡、随机负载均衡</li><li>max_fails：表示失败几次，则标记server已宕机，剔出上游服务 默认值1</li><li>fail_timeout：表示失败的重试时间 默认值10</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1keepalived">1、keepalived<a href="#1keepalived" class="hash-link" aria-label="1、keepalived的直接链接" title="1、keepalived的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080 weight=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080 weight=5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080 weight=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    keepalive 32; #保持的连接数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listem  80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.tomcats.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://tomcats;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_http_version 1.1; #连接的协议版本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Connection &quot;&quot;; 清空连接请求头</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2控制浏览器缓存">2、控制浏览器缓存<a href="#2控制浏览器缓存" class="hash-link" aria-label="2、控制浏览器缓存的直接链接" title="2、控制浏览器缓存的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listem  80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.tomcats.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://tomcats;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        expires 10s;  #浏览器缓存10秒钟</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #expires @22h30m  #在晚上10点30的时候过期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #expires -1h  #缓存在一小时前时效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #expires epoch  #不设置缓存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #expires off  #缓存关闭，浏览器自己控制缓存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #expires max  #最大过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3反向代理缓存">3、反向代理缓存<a href="#3反向代理缓存" class="hash-link" aria-label="3、反向代理缓存的直接链接" title="3、反向代理缓存的直接链接">​</a></h3><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">upstream [proxyName] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.173:8080 weight=1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.174:8080 weight=5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server 192.168.1.175:8080 weight=2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#proxy_cache_path 设置缓存保存的目录的位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#keys_zone设置共享内以及占用的空间大小</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#mas_size 设置缓存最大空间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#inactive 缓存过期时间，错过此时间自动清理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#use_temp_path 关闭零时目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">proxy_cache_path /usr/local/nginx/upsteam_cache keys_zone=mycache:5m max_size=1g inactive=8h use_temp_path=off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listem  80;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name www.tomcats.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #开启并使用缓存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_cache mycache;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #针对200和304响应码的缓存过期时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_cache_valid 200 304 8h;   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://tomcats;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-配置ssl证书提供https访问">5. 配置ssl证书提供https访问<a href="#5-配置ssl证书提供https访问" class="hash-link" aria-label="5. 配置ssl证书提供https访问的直接链接" title="5. 配置ssl证书提供https访问的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-安装ssl模块">1. 安装SSL模块<a href="#1-安装ssl模块" class="hash-link" aria-label="1. 安装SSL模块的直接链接" title="1. 安装SSL模块的直接链接">​</a></h3><p>要在nginx中配置https，就必须安装ssl模块，也就是: http_ssl_module。</p><p>进入到nginx的解压目录：/home/software/nginx-1.16.1</p><p>新增ssl模块(原来的那些模块需要保留)</p><div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./configure \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/nginx \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--pid-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/run/nginx/nginx.pid \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--lock-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/lock/nginx.lock \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--error-log-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/log/nginx/error.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-log-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/log/nginx/access.log \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--with-http_gzip_static_module \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-client-body-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/client \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-proxy-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/proxy \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-fastcgi-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/fastcgi \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-uwsgi-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/uwsgi \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--http-scgi-temp-path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/var/temp/nginx/scgi  \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--with-http_ssl_module</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>编译和安装</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2配置https">2、配置HTTPS<a href="#2配置https" class="hash-link" aria-label="2、配置HTTPS的直接链接" title="2、配置HTTPS的直接链接">​</a></h3><p>把ssl证书 <em>.crt 和 私钥 </em>.key 拷贝到<code>/usr/local/nginx/conf</code>目录中。</p><p>新增 server 监听 443 端口：</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">server {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen       443;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name  www.imoocdsp.com;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 开启ssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl     on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 配置ssl证书</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate      1_www.imoocdsp.com_bundle.crt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 配置证书秘钥</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key  2_www.imoocdsp.com.key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ssl会话cache</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_session_cache    shared:SSL:1m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ssl会话超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_session_timeout  5m;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 配置加密套件，写法遵循 openssl 标准</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_prefer_server_ciphers on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://tomcats/;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index  index.html index.htm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-配置ha-nginx">6. 配置HA Nginx<a href="#6-配置ha-nginx" class="hash-link" aria-label="6. 配置HA Nginx的直接链接" title="6. 配置HA Nginx的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1安装keepalived">1、安装keepalived<a href="#1安装keepalived" class="hash-link" aria-label="1、安装keepalived的直接链接" title="1、安装keepalived的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 下载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://www.keepalived.org/download.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 解压</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">tar</span><span class="token plain"> -zxvf keepalived-2.0.18.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使用configure命令配置安装目录与核心配置文件所在位置：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./configure --prefix</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/usr/local/keepalived --sysconf</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">/etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 配置文件 在/etc/keepalived/keepalived.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 忘记安装配置的目录，则通过如下命令找到：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">whereis</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启动keepalived 进入sbin目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./keepalived</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>prefix ：keepalived安装的位置sysconf：keepalived核心配置文件所在位置，固定位置，改成其他位置则keepalived启动不了，/var/log/messages中会报错</li><li>sysconf ：keepalived核心配置文件所在位置，固定位置，改成其他位置则keepalived启动不了，/var/log/messages中会报错
配置过程中可能会出现警告信息，如下所示：</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*** WARNING - this build will not support IPVS with IPv6. Please </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> libnl/libnl-3 dev libraries to support IPv6 with IPVS.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 安装libnl/libnl-3依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yum -y </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> libnl libnl-devel  </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2配置keepalived-主机">2、配置keepalived 主机<a href="#2配置keepalived-主机" class="hash-link" aria-label="2、配置keepalived 主机的直接链接" title="2、配置keepalived 主机的直接链接">​</a></h3><p>(1) 通过命令 <code>vim keepalived.conf</code> 打开配置文件</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global_defs { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 路由id：当前安装keepalived的节点主机标识符，保证全局唯一 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id keep_171 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 表示状态是MASTER主机还是备用机BACKUP </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state MASTER </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 该实例绑定的网卡 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 保证主备节点一致即可 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 权重，master权重一般高于backup，如果有多个，那就是选举，谁的权重高，谁就当选 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 100 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 主备之间同步检查时间间隔，单位秒 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 认证权限密码，防止非法节点进入 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 虚拟出来的ip，可以有多个（vip） </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.161 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看网卡</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 启动keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看进程</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ps</span><span class="token plain"> -ef </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> keepalived</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看vip(虚拟ip)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 在网卡ens33下，多了一个192.168.1.161，这个就是虚拟ip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3把keepalived注册为系统服务">3、把keepalived注册为系统服务<a href="#3把keepalived注册为系统服务" class="hash-link" aria-label="3、把keepalived注册为系统服务的直接链接" title="3、把keepalived注册为系统服务的直接链接">​</a></h3><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 拷贝配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 将keepalived目录下etc/init.d/keepalived拷贝到/etc/init.d/下</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 将keepalived目录下etc/sysconfig/keepalived拷贝到/etc/sysconfig/下</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 刷新systemctl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#启动 keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start keepalived.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#停止 keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop keepalived.service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#重启 keepalived</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart keepalived.service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4实现双机主备高可用">4、实现双机主备高可用<a href="#4实现双机主备高可用" class="hash-link" aria-label="4、实现双机主备高可用的直接链接" title="4、实现双机主备高可用的直接链接">​</a></h2><p>(1) 修改备机配置</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global_defs { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id keep_172 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 备用机设置为BACKUP </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state BACKUP </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # 权重低于MASTER </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 80 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # 注意：主备两台的vip都是一样的，绑定到同一个vip </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.161 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(2) 启动 Keepalived</p><p>(3) 访问vip即可访问主机，当主机失效时访问vip就会访问到备机</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="5keepalived配置nginx自动重启">5、keepalived配置nginx自动重启<a href="#5keepalived配置nginx自动重启" class="hash-link" aria-label="5、keepalived配置nginx自动重启的直接链接" title="5、keepalived配置nginx自动重启的直接链接">​</a></h3><p>(1) 编写脚本</p><p>在<code>/etc/keepalived/</code>下创建脚本<code>check_nginx_alive_or_not</code></p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#!/bin/bash </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token assign-left variable" style="color:#36acaa">A</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ps</span><span class="token variable" style="color:#36acaa"> -C nginx --no-header </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable function" style="color:#d73a49">wc</span><span class="token variable" style="color:#36acaa"> -l</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 判断nginx是否宕机，如果宕机了，尝试重启 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$A</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /usr/local/nginx/sbin/nginx </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 等待一小会再次检查nginx，如果没有启动成功，则停止keepalived，使其启动备用机 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sleep</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">`</span><span class="token variable function" style="color:#d73a49">ps</span><span class="token variable" style="color:#36acaa"> -C nginx --no-header </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable function" style="color:#d73a49">wc</span><span class="token variable" style="color:#36acaa"> -l</span><span class="token variable" style="color:#36acaa">`</span><span class="token plain"> -eq </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token keyword" style="color:#00009f">then</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">killall</span><span class="token plain"> keepalived </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">fi</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(2) 添加运行权限</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> +x /etc/keepalived/check_nginx_alive_or_not.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(3) 配置keepalived监听nginx脚本</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_script check_nginx_alive { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    script &quot;/etc/keepalived/check_nginx_alive_or_not.sh&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interval 2 # 每隔两秒运行上一行脚本 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    weight 10 # 如果脚本运行失败，则升级权重+10 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(4) 在vrrp_instance中新增监控的脚本</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">track_script { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    check_nginx_alive # 追踪 nginx 脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(5) 重启Keepalived使得配置文件生效</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart keepalived</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="6keepalived双主热备">6、keepalived双主热备<a href="#6keepalived双主热备" class="hash-link" aria-label="6、keepalived双主热备的直接链接" title="6、keepalived双主热备的直接链接">​</a></h3><p>(1) 配置DNS轮询</p><p>在同一个域名下配置两个ip，自行百度</p><p>(2) 配置第一台主机</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id keep_171 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state MASTER i</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nterface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 100 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.161 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_2  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state BACKUP </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 52 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 80 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.162 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(3) 配置第二台主机</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id keep_172 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state BACKUP </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 51 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 80 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.161</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state MASTER </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 52 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 100 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.162 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(4) 重启两台Keepalived</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart keepalived</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="7-lvslinux-virtual-server实现高可用负载均衡">7. LVS（Linux Virtual Server）实现高可用负载均衡<a href="#7-lvslinux-virtual-server实现高可用负载均衡" class="hash-link" aria-label="7. LVS（Linux Virtual Server）实现高可用负载均衡的直接链接" title="7. LVS（Linux Virtual Server）实现高可用负载均衡的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1为什么要使用lvsnginx">1、为什么要使用LVS+Nginx<a href="#1为什么要使用lvsnginx" class="hash-link" aria-label="1、为什么要使用LVS+Nginx的直接链接" title="1、为什么要使用LVS+Nginx的直接链接">​</a></h3><p>lvs基于四层负载均衡，工作效率较Nginx的七层负载更高，使用LVS搭建Nginx集群，可以提高性能
四层负载均衡无法对信息处理，只能通过ip+端口的形式转发，所以需要七成负载进行数据的处理
Nginx接收请求来回，LVS可以只接受不响应</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2lvs的三种模式">2、LVS的三种模式<a href="#2lvs的三种模式" class="hash-link" aria-label="2、LVS的三种模式的直接链接" title="2、LVS的三种模式的直接链接">​</a></h3><p>(1)NAT模式</p><ul><li>客户端将请求发往LVS，LVS会选择一台服务器响应请求，服务器将结果返回给LVS，LVS再返回给客户端。</li><li>在NAT模式中，服务器的网关必须指向LVS，否则报文无法送达客户端</li><li>NAT 技术将请求的报文和响应的报文都需要通过LVS进行地址改写，因此网站访问量比较大的时候负载均衡调度器有比较大的瓶颈，一般要求最多之能 10-20 台节点</li><li>NAT 模式支持对 IP 地址和端口进行转换。即用户请求的端口和真实服务器的端口可以不一致</li></ul><p>(2)TUN模式</p><ul><li>客户端将请求发往LVS，LVS会选择一台服务器响应请求，在客户端与服务器之间建立隧道，返回结果的时候直接由服务器返回响应，不在经过LVS。</li><li>TUN模式必须所有的服务器上都绑定VIP的IP地址，所有的服务器都必须有网卡。</li><li>TUN模式走隧道运维难度大，并且会直接暴露服务器地址</li><li>服务器将应答包直接发给用户。所以，减少了负载均衡器的大量数据流动，负载均衡器不再是系统的瓶颈，就能处理很巨大的请求量，这种方式，一台负载均衡器能够为很多服务器进行分发。而且跑在公网上就能进行不同地域的分发</li></ul><p>(3)DR模式</p><ul><li>客户端将请求发往LVS，LVS会选择一台服务器响应请求，返回结果的时候通过统一的路由进行返回，不在经过LVS。
和TUN模式一样，LVS只是分发请求，应答包通过单独的路由返回给客户端，与TUN相比这种方式不需要隧道结构，可以兼容大多数的操作系统，同时统一路由可以隐藏真实的物理服务器。DR模式效率更高，但配置更复杂.</li><li>所有服务器节点和LVS只能在一个局域网里面。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3搭建lvs-dr模式">3、搭建LVS-DR模式<a href="#3搭建lvs-dr模式" class="hash-link" aria-label="3、搭建LVS-DR模式的直接链接" title="3、搭建LVS-DR模式的直接链接">​</a></h3><p>先关闭掉服务器上网络配置管理器，避免网络接口冲突</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop NetworkManagersystemctl disable NetworkManager</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(1) 创建子接口（创建LVS的虚拟ip）</p><p>进入网卡配置目录<code>/etc/sysconfig/network-scripts/</code>,找到网卡配置文件，这里以<code>ifcfg-ens33</code>为例，拷贝并创建子接口</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> ifcfg-ens33 ifcfg-ens33:1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改子接口配置如下</p><ul><li>配置中的 192.168.1.150 就是vip，是提供给外网用户访问的ip地址</li></ul><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DEVICE=&quot;ens33:1&quot;ONBOOT=&quot;yes&quot;IPADDR=192.168.1.150NETMASK=255.255.255.0BOOTPROTO=static</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>重启网络服务</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">service</span><span class="token plain"> network restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启成功后，<code>ip addr</code> 查看一下，你会发现多了一个ip，也就是虚拟ip（vip）</p><p><strong>注意：</strong> 阿里云不支持配置网卡，需要购买相应的负载均衡服务，腾讯云支持配置网卡，但需要购买网卡支持，一个网卡支持10个虚拟ip配置</p><p>(2) 安装ipvsadm</p><p>如今的centos都集成了LVS，所以ipvs是自带的，我们只需要安装ipvsadm即可（ipvsadm是管理集群的工具，通过ipvs可以管理集群，查看集群等操作）</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> ipvsadm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(3) 配置服务器（RS）的虚拟ip</p><p>进入网卡配置目录<code>/etc/sysconfig/network-scripts/</code>,找到<code>ifcfg-lo</code>，拷贝并创建子接口</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> ifcfg-lo ifcfg-lo:1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>修改子接口配置如下</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">DEVICE=&quot;lo:1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IPADDR=192.168.1.150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NETMASK=255.255.255.255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NETWORK=127.0.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BROADCAST=127.255.255.255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ONBOOT=&quot;yes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME=loopback</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>重启网络服务成功后，ip addr 查看一下，你会发现多了一个ip，也就是虚拟ip（vip）</p><p>(4) 为服务器（RS）配置arp</p><p>ARP响应级别与通告行为参数说明</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">arp-ignore：ARP响应级别（处理请求）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">：只要本机配置了ip，就能响应请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">：请求的目标地址到达对应的网络接口，才会响应请求</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">arp-announce：ARP通告行为（返回响应）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">：本机上任何网络接口都向外通告，所有的网卡都能接受到通告</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">：尽可能避免本网卡与不匹配的目标进行通告2：只在本网卡通告</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>打开<code>/etc/sysctl.conf</code> <code>vim /etc/sysctl.conf</code></p><p>配置所有网卡、默认网卡以及虚拟网卡的arp响应级别和通告行为，分别对应：all，default，lo</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># configration for lvs </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.conf.all.arp_ignore = 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.conf.default.arp_ignore = 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.conf.lo.arp_ignore = 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.conf.all.arp_announce = 2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.conf.default.arp_announce = 2 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net.ipv4.conf.lo.arp_announce = 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>刷新配置文件</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sysctl -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>增加一个网关，用于接收数据报文，当有请求到本机后，会交给lo去处理</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">route </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> -host </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.150 dev lo:1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>将网关添加至开机启动</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;route add -host 192.168.1.150 dev lo:1&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /etc/rc.local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(5) 使用ipvsadm配置集群规则</p><p>创建LVS节点，用户访问的集群调度者</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -A -t </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.150:80 -s rr -p </span><span class="token number" style="color:#36acaa">5</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>-A：添加集群</li><li>-t：tcp协议ip地址：设定集群的访问</li><li>ip：也就是LVS的虚拟ip</li><li>-s：设置负载均衡的算法，</li><li>rr：表示轮询</li><li>-p：设置连接持久化的时间,在指定时间内同一个用户的请求会访问到同一个服务器中</li></ul><p>创建多台RS真实服务器</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -a -t </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.150:80 -r </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.171:80 -g </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -a -t </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.150:80 -r </span><span class="token number" style="color:#36acaa">192.168</span><span class="token plain">.1.172:80 -g</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>-a：添加真实服务器</li><li>-t：tcp协议</li><li>-r：真实服务器的ip地址</li><li>-g：设定DR模式</li></ul><p>保存到规则库，否则重启失效</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -S</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>检查集群</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#查看集群列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -Ln</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#查看集群状态</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -Ln --stats</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>一些其他命令</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 重启ipvsadm，重启后需要重新配置 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">service</span><span class="token plain"> ipvsadm restart </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看持久化连接 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -Ln --persistent-conn </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看连接请求过期时间以及请求源ip和目标ip </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -Lnc </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 设置tcp tcpfin udp 的过期时间（一般保持默认） </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm --set </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看过期时间 </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -Ln --timeout</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(6) 访问虚拟ip，完成LVS搭建</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="附lvs的负载均衡算法">附：LVS的负载均衡算法<a href="#附lvs的负载均衡算法" class="hash-link" aria-label="附：LVS的负载均衡算法的直接链接" title="附：LVS的负载均衡算法的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1静态算法">(1)静态算法<a href="#1静态算法" class="hash-link" aria-label="(1)静态算法的直接链接" title="(1)静态算法的直接链接">​</a></h3><p>静态：根据LVS本身自由的固定的算法分发用户请求。</p><ul><li>轮询（Round Robin 简写’rr’）：轮询算法假设所有的服务器处理请求的能力都一样的，调度器会把所有的请求平均分配给每个真实服务器。（同Nginx的轮询）</li><li>加权轮询（Weight Round Robin 简写’wrr’）：安装权重比例分配用户请求。权重越高，被分配到处理的请求越多。（同Nginx的权重）</li><li>源地址散列（Source Hash 简写’sh’）：同一个用户ip的请求，会由同一个RS来处理。（同Nginx的ip_hash）</li><li>目标地址散列（Destination Hash 简写’dh’）：根据url的不同，请求到不同的RS。（同Nginx的url_hash）</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2动态算法">(2)动态算法<a href="#2动态算法" class="hash-link" aria-label="(2)动态算法的直接链接" title="(2)动态算法的直接链接">​</a></h3><p>动态：会根据流量的不同，或者服务器的压力不同来分配用户请求，这是动态计算的。</p><ul><li>最小连接数（Least Connections 简写’lc’）：把新的连接请求分配到当前连接数最小的服务器。</li><li>加权最少连接数（Weight Least Connections 简写’wlc’）：服务器的处理性能用数值来代表，权重越大处理的请求越多。Real Server 有可能会存在性能上的差异，wlc动态获取不同服务器的负载状况，把请求分发到性能好并且比较空闲的服务器。</li><li>最短期望延迟（Shortest Expected Delay 简写’sed’）：特殊的wlc算法。举例阐述，假设有ABC三台服务器，权重分别为1、2、3 。如果使用wlc算法的话，当一个新请求进来，它可能会分给ABC中的任意一个。使用sed算法后会进行如下运算：</li></ul><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A：（1+1）/1</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">B：（1+2）/2</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C：（1+3）/3</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain">/3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最终结果，会把这个请求交给得出运算结果最小的服务器。最少队列调度（Never Queue 简写’nq’）：永不使用队列。如果有Real Server的连接数等于0，则直接把这个请求分配过去，不需要在排队等待运算了（sed运算）。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="8-搭建keepalivedlvsnginx高可用集群负载均衡">8. 搭建Keepalived+Lvs+Nginx高可用集群负载均衡<a href="#8-搭建keepalivedlvsnginx高可用集群负载均衡" class="hash-link" aria-label="8. 搭建Keepalived+Lvs+Nginx高可用集群负载均衡的直接链接" title="8. 搭建Keepalived+Lvs+Nginx高可用集群负载均衡的直接链接">​</a></h2><p>如果原先服务器上配置了LVS+nginx需要清空ipvsadm中的配置</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ipvsadm -C</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果配置了<code>Keepalived+Nginx</code>双主集群也需要去除掉<code>Keepalived</code>中原先的配置，按照的后文进行配置</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-使用keepalived配置master-lvs">1. 使用keepalived配置Master LVS<a href="#1-使用keepalived配置master-lvs" class="hash-link" aria-label="1. 使用keepalived配置Master LVS的直接链接" title="1. 使用keepalived配置Master LVS的直接链接">​</a></h3><p>在LVS的机器上安装keepalived，安装过程参考上文</p><p>(1) 修改keepalived的配置</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id keep_151 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state MASTER </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 41 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 100 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#配置集群访问的ip+端口，端口和nginx保持一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virtual_server 192.168.1.150 80{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #健康检查的时间，单位：秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay_loop 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #配置负载均衡的算法，默认的轮询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_algo rr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #设置LVS的模式 NAT|TUN|DR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb-kind DR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #设置会话持久化的时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    persistence_timeout 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #协议</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #配置负载均衡的真实服务器，也就是nginx节点的具体的ip地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    real_server 192.168.1.171 80{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #轮询权重配比</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weight 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #设置健康检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TCP_CHECK {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #检查80端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_port 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_timeout 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #重试次数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nb_get_retry 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #重试间隔时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delay_before_retry 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    real_server 192.168.1.171 80{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weight 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TCP_CHECK {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_port 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_timeout 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nb_get_retry 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delay_before_retry 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(2) 启动/重启keepalived</p><div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart keepalived</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-使用keepalived配置backup-lvs">2. 使用keepalived配置Backup LVS<a href="#2-使用keepalived配置backup-lvs" class="hash-link" aria-label="2. 使用keepalived配置Backup LVS的直接链接" title="2. 使用keepalived配置Backup LVS的直接链接">​</a></h3><p>配置在备用机上</p><div class="language-conf codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-conf codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">global_defs {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_id keep_152 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vrrp_instance VI_1 { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    state  BACKUP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface ens33 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_router_id 41 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    priority 50 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    advert_int 1 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authentication { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_type PASS </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auth_pass 1111 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    virtual_ipaddress { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        192.168.1.150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#配置集群访问的ip+端口，端口和nginx保持一致</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">virtual_server 192.168.1.150 80{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #健康检查的时间，单位：秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delay_loop 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #配置负载均衡的算法，默认的轮询</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb_algo rr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #设置LVS的模式 NAT|TUN|DR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lb-kind DR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #设置会话持久化的时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    persistence_timeout 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #协议</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protocol TCP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #配置负载均衡的真实服务器，也就是nginx节点的具体的ip地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    real_server 192.168.1.171 80{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #轮询权重配比</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weight 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #设置健康检查</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TCP_CHECK {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #检查80端口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_port 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #超时时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_timeout 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #重试次数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nb_get_retry 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #重试间隔时间</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delay_before_retry 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    real_server 192.168.1.171 80{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        weight 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TCP_CHECK {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_port 80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            connect_timeout 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nb_get_retry 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            delay_before_retry 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/middleware/nginx/Nginx-From-Install-to-HA.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">最后<!-- -->由 <b>Hui Liu</b> <!-- -->于 <b><time datetime="2023-08-07T04:09:29.000Z">2023年8月7日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/light-docusaurus/middleware/nginx/Ningx/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Ningx</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/light-docusaurus/middleware/category/mqtt/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">MQTT</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-nginx安装" class="table-of-contents__link toc-highlight">1. Nginx安装</a></li><li><a href="#2-配置反向代理" class="table-of-contents__link toc-highlight">2. 配置反向代理</a></li><li><a href="#3-配置负载均衡" class="table-of-contents__link toc-highlight">3. 配置负载均衡</a><ul><li><a href="#1使用加权轮询" class="table-of-contents__link toc-highlight">1、使用加权轮询</a></li><li><a href="#2hash负载均衡" class="table-of-contents__link toc-highlight">2、hash负载均衡</a></li><li><a href="#3url-hash负载均衡" class="table-of-contents__link toc-highlight">3、url hash负载均衡</a></li><li><a href="#4最小连接负载均衡" class="table-of-contents__link toc-highlight">4、最小连接负载均衡</a></li></ul></li><li><a href="#4-upstream指令参数" class="table-of-contents__link toc-highlight">4. upstream指令参数</a><ul><li><a href="#1keepalived" class="table-of-contents__link toc-highlight">1、keepalived</a></li><li><a href="#2控制浏览器缓存" class="table-of-contents__link toc-highlight">2、控制浏览器缓存</a></li><li><a href="#3反向代理缓存" class="table-of-contents__link toc-highlight">3、反向代理缓存</a></li></ul></li><li><a href="#5-配置ssl证书提供https访问" class="table-of-contents__link toc-highlight">5. 配置ssl证书提供https访问</a><ul><li><a href="#1-安装ssl模块" class="table-of-contents__link toc-highlight">1. 安装SSL模块</a></li><li><a href="#2配置https" class="table-of-contents__link toc-highlight">2、配置HTTPS</a></li></ul></li><li><a href="#6-配置ha-nginx" class="table-of-contents__link toc-highlight">6. 配置HA Nginx</a><ul><li><a href="#1安装keepalived" class="table-of-contents__link toc-highlight">1、安装keepalived</a></li><li><a href="#2配置keepalived-主机" class="table-of-contents__link toc-highlight">2、配置keepalived 主机</a></li><li><a href="#3把keepalived注册为系统服务" class="table-of-contents__link toc-highlight">3、把keepalived注册为系统服务</a></li></ul></li><li><a href="#4实现双机主备高可用" class="table-of-contents__link toc-highlight">4、实现双机主备高可用</a><ul><li><a href="#5keepalived配置nginx自动重启" class="table-of-contents__link toc-highlight">5、keepalived配置nginx自动重启</a></li><li><a href="#6keepalived双主热备" class="table-of-contents__link toc-highlight">6、keepalived双主热备</a></li></ul></li><li><a href="#7-lvslinux-virtual-server实现高可用负载均衡" class="table-of-contents__link toc-highlight">7. LVS（Linux Virtual Server）实现高可用负载均衡</a><ul><li><a href="#1为什么要使用lvsnginx" class="table-of-contents__link toc-highlight">1、为什么要使用LVS+Nginx</a></li><li><a href="#2lvs的三种模式" class="table-of-contents__link toc-highlight">2、LVS的三种模式</a></li><li><a href="#3搭建lvs-dr模式" class="table-of-contents__link toc-highlight">3、搭建LVS-DR模式</a></li></ul></li><li><a href="#附lvs的负载均衡算法" class="table-of-contents__link toc-highlight">附：LVS的负载均衡算法</a><ul><li><a href="#1静态算法" class="table-of-contents__link toc-highlight">(1)静态算法</a></li><li><a href="#2动态算法" class="table-of-contents__link toc-highlight">(2)动态算法</a></li></ul></li><li><a href="#8-搭建keepalivedlvsnginx高可用集群负载均衡" class="table-of-contents__link toc-highlight">8. 搭建Keepalived+Lvs+Nginx高可用集群负载均衡</a><ul><li><a href="#1-使用keepalived配置master-lvs" class="table-of-contents__link toc-highlight">1. 使用keepalived配置Master LVS</a></li><li><a href="#2-使用keepalived配置backup-lvs" class="table-of-contents__link toc-highlight">2. 使用keepalived配置Backup LVS</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/docs/intro/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/light-docusaurus/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/light-docusaurus/assets/js/runtime~main.a08a97eb.js"></script>
<script src="/light-docusaurus/assets/js/main.8deac95e.js"></script>
</body>
</html>