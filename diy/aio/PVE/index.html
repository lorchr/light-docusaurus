<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-diy docs-version-current docs-doc-page docs-doc-id-aio/PVE" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">PVE | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/diy/aio/PVE/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-diy-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-diy-current"><meta data-rh="true" property="og:title" content="PVE | Light Docusaurus"><meta data-rh="true" name="description" content="- PVE 和 Esxi性能对比"><meta data-rh="true" property="og:description" content="- PVE 和 Esxi性能对比"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/diy/aio/PVE/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/diy/aio/PVE/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/diy/aio/PVE/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e8086d6f.css">
<script src="/assets/js/runtime~main.2519630d.js" defer="defer"></script>
<script src="/assets/js/main.a410c441.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/diy/aio/PVE/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/">DIY</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/Boot-U-Disk-By-Ventoy/">Boot-U-Disk-By-Ventoy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/device-and-software-plan/">Device and Software Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/geek-diyer/">Geek Diyer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/diy/category/aio/">AIO</a><button aria-label="折叠侧边栏分类 &#x27;AIO&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Device-J4125/">Device-J4125</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Device-J4125-Reference/">Device-J4125-Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Esxi/">Esxi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Esxi-Reference-1/">Esxi-Reference-1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/diy/aio/PVE/">PVE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/PVE-Reference-1/">PVE-Reference-1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/AIO-Reference-1/">AIO-Reference-1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/签到/">签到</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/network/">Network</a><button aria-label="展开侧边栏分类 &#x27;Network&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/android/">Android</a><button aria-label="展开侧边栏分类 &#x27;Android&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/nas/">NAS</a><button aria-label="展开侧边栏分类 &#x27;NAS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/home-assistant/">Home Assistant</a><button aria-label="展开侧边栏分类 &#x27;Home Assistant&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/router/">Router</a><button aria-label="展开侧边栏分类 &#x27;Router&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/soft-router/">Soft Router</a><button aria-label="展开侧边栏分类 &#x27;Soft Router&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/tv-box/">TV Box</a><button aria-label="展开侧边栏分类 &#x27;TV Box&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/game-box/">Game Box</a><button aria-label="展开侧边栏分类 &#x27;Game Box&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/diy/category/aio/"><span itemprop="name">AIO</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PVE</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>PVE</h1></header><ul>
<li><a href="https://kb.blockbridge.com/technote/proxmox-vs-vmware-nvmetcp/" target="_blank" rel="noopener noreferrer">PVE 和 Esxi性能对比</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="一pve安装初始化">一、PVE安装初始化<a href="#一pve安装初始化" class="hash-link" aria-label="一、PVE 安装初始化的直接链接" title="一、PVE安装初始化的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="合并-local-与-local-lvm">合并 local 与 local-lvm<a href="#合并-local-与-local-lvm" class="hash-link" aria-label="合并 local 与 local-lvm的直接链接" title="合并 local 与 local-lvm的直接链接">​</a></h3>
<p>安装PVE后,磁盘空间被默认分为2个</p>
<ul>
<li>local      主要用于存放ISO镜像和虚拟机备份文件</li>
<li>local-lvm  主要用来存放创建的虚拟机文件</li>
</ul>
<p>合并后的缺点</p>
<ul>
<li>删除Local-lvm后,虚拟机无法快照,只能通过转换磁盘qcow2后才能快照</li>
<li>LXC容器不支持qcow2虚拟磁盘</li>
<li>还有一个就是PVE初步的设计就是为了磁盘隔离,避免一个挂全部挂</li>
</ul>
<p>合并脚本</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查询默认磁盘结构</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fdisk -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看目录树</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询pve存储空间位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls /dev/pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 删除data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvremove /dev/pve/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将pve-data的空间分配到pve-root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvextend -rl +100%FREE /dev/pve/root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询扩容结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>合并后的操作</p>
<ul>
<li>数据中心 - 存储，选择 local-lvm 点击 移除 并确认</li>
<li>数据中心 - 存储，选择 local 点击 编辑，在 内容 中选择所有并保存</li>
<li>刷新浏览器就变为只剩一个local，磁盘统一，且菜单合并</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="换源">换源<a href="#换源" class="hash-link" aria-label="换源的直接链接" title="换源的直接链接">​</a></h3>
<p>参考<a href="https://mirrors.ustc.edu.cn/help/proxmox.html" target="_blank" rel="noopener noreferrer">中科大PVE文档</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="更换debian源">更换Debian源<a href="#更换debian源" class="hash-link" aria-label="更换Debian源的直接链接" title="更换Debian源的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 备份旧的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/apt/sources.list /etc/apt/sources.list.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 写入新的源文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat &gt;&gt; /etc/apt/sources.list &lt;&lt; EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http://mirrors.ustc.edu.cn/debian bookworm main contrib non-free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb-src http://mirrors.ustc.edu.cn/debian bookworm main contrib non-free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http://mirrors.ustc.edu.cn/debian bookworm-updates main contrib non-free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb-src http://mirrors.ustc.edu.cn/debian bookworm-updates main contrib non-free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb http://mirrors.ustc.edu.cn/debian bookworm-proposed-updates main contrib non-free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deb-src http://mirrors.ustc.edu.cn/debian bookworm-proposed-updates main contrib non-free</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看修改结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (参考) 直接替换为中科大源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g&#x27; /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &#x27;s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g&#x27; /etc/apt/sources.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="更换pve企业源">更换PVE企业源<a href="#更换pve企业源" class="hash-link" aria-label="更换PVE企业源的直接链接" title="更换PVE企业源的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 列出当前的源文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls /etc/apt/sources.list.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 备份旧的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv /etc/apt/sources.list.d/pve-enterprise.list  /etc/apt/sources.list.d/pve-enterprise.list.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载GPG校验秘钥并写入新的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://mirrors.ustc.edu.cn/proxmox/debian/proxmox-release-bookworm.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bookworm.gpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;# deb https://enterprise.proxmox.com/debian/pve bookworm pve-enterprise&quot; &gt; /etc/apt/sources.list.d/pve-enterprise.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;deb https://mirrors.ustc.edu.cn/proxmox/debian/pve bookworm pve-no-subscription&quot; &gt; /etc/apt/sources.list.d/pve-no-subscription.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看修改结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/apt/sources.list.d/pve-enterprise.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/apt/sources.list.d/pve-no-subscription.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (参考) 更换PVE企业源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;# deb https://enterprise.proxmox.com/debian/pve bookworm pve-enterprise&quot; &gt; /etc/apt/sources.list.d/pve-enterprise.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &quot;deb https://mirrors.ustc.edu.cn/proxmox/debian/pve bookworm pve-no-subscription&quot; &gt; /etc/apt/sources.list.d/pve-no-subscription.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="更换ceph源">更换Ceph源<a href="#更换ceph源" class="hash-link" aria-label="更换Ceph源的直接链接" title="更换Ceph源的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 列出当前的源文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ls /etc/apt/sources.list.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 备份旧的文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /etc/apt/sources.list.d/ceph.list            /etc/apt/sources.list.d/ceph.list.backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更换Ceph源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if [ -f /etc/apt/sources.list.d/ceph.list ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CEPH_CODENAME=`ceph -v | grep ceph | awk &#x27;{print $(NF-1)}&#x27;`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source /etc/os-release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-$CEPH_CODENAME $VERSION_CODENAME no-subscription&quot; &gt; /etc/apt/sources.list.d/ceph.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看修改结果</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/apt/sources.list.d/ceph.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="更换lxc容器源">更换LXC容器源<a href="#更换lxc容器源" class="hash-link" aria-label="更换LXC容器源的直接链接" title="更换LXC容器源的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 更换源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i.bak &#x27;s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g&#x27; /usr/share/perl5/PVE/APLInfo.pm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重启守护进程</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart pvedaemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="更新仓库缓存">更新仓库缓存<a href="#更新仓库缓存" class="hash-link" aria-label="更新仓库缓存的直接链接" title="更新仓库缓存的直 接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 更新仓库缓存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 升级软件包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt upgrade -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="二pve配置">二、PVE配置<a href="#二pve配置" class="hash-link" aria-label="二、PVE配置的直接链接" title="二、PVE配置的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改ip-主机名-dns">修改IP 主机名 DNS<a href="#修改ip-主机名-dns" class="hash-link" aria-label="修改IP 主机名 DNS的直接链接" title="修改IP 主机名 DNS的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看网络</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/network/interfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看DNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/resolv.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看主机名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/hostname</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看开机界面信息 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/issue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装zsh">安装zsh<a href="#安装zsh" class="hash-link" aria-label="安装zsh的直接链接" title="安装zsh的直接链接">​</a></h3>
<ul>
<li><a href="https://github.com/zimfw/zimfw" target="_blank" rel="noopener noreferrer">zim</a></li>
<li><a href="https://github.com/ohmyzsh/ohmyzsh" target="_blank" rel="noopener noreferrer">ohmyzsh</a></li>
<li><a href="https://github.com/fish-shell/fish-shell" target="_blank" rel="noopener noreferrer">fish</a></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看本机的shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /etc/shells</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install -y zsh git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 切换默认shell为zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chsh -s /bin/zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装zim">安装Zim<a href="#安装zim" class="hash-link" aria-label="安装Zim的直接链接" title="安装Zim的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装Zim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -fsSL https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 或</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget -nv -O - https://raw.githubusercontent.com/zimfw/install/master/install.zsh | zsh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 安装不成功可以先配置 DNS 8.8.8.8或者开VPN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="安装zim插件-p10k">安装zim插件 p10k<a href="#安装zim插件-p10k" class="hash-link" aria-label="安装zim插件 p10k的直接链接" title="安装zim插件 p10k的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 打开.zimrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim .zimrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 把这句放到文件末尾</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zmodule romkatv/powerlevel10k --use degit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 之后执行安装，后续要装什么插件，也往上面添加之后在执行下面的命令。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zimfw install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 要是想重新设置p10k的样式，可以用下面的命令</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p10k configure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果出现乱码，需要先安装字体 https://www.nerdfonts.com/font-downloads，推荐 Hack Nerd Font</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/ryanoasis/nerd-fonts/releases/download/v3.2.1/Hack.zip -O Hack.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/ryanoasis/nerd-fonts.git --depth 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd nerd-fonts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./install.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="域名访问">域名访问<a href="#域名访问" class="hash-link" aria-label="域名访问的直接链接" title="域名访问的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 实现内网 主机名.local访问</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install -y avahi-daemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">service avahi-daemon status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用域名访问PVE <a href="https://pve.local:8006" target="_blank" rel="noopener noreferrer">https://pve.local:8006</a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="记录网卡总线信息-bus-info">记录网卡总线信息 bus info<a href="#记录网卡总线信息-bus-info" class="hash-link" aria-label="记录网卡总线信息 bus info的直接链接" title="记录网卡总线信息 bus info的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装ethtool </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install -y ethtool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看网卡信息，主要是bus info </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># enp1s0 enp2s0 enp3s0(eno1) enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool -i enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~# ethtool -i enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">driver: igc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">version: 6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">firmware-version: 2014:8877</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expansion-rom-version:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bus-info: 0000:04:00.0          # 记录总线地址，对应pci名称，直通网卡使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supports-statistics: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supports-test: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supports-eeprom-access: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supports-register-dump: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">supports-priv-flags: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置wol">配置WOL<a href="#配置wol" class="hash-link" aria-label="配置WOL的直接链接" title="配置WOL的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看WOL唤醒支持</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 以下为输出示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Settings for enp4s0:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Supported ports: [ TP ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Supported link modes:   10baseT/Half 10baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                100baseT/Half 100baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                1000baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                2500baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Supported pause frame use: Symmetric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Supports auto-negotiation: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Supported FEC modes: Not reported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Advertised link modes:  10baseT/Half 10baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                100baseT/Half 100baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                1000baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                2500baseT/Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Advertised pause frame use: Symmetric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Advertised auto-negotiation: Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Advertised FEC modes: Not reported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Speed: 1000Mb/s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Duplex: Full</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Auto-negotiation: on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Port: Twisted Pair</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PHYAD: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Transceiver: internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MDI-X: off (auto)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Supports Wake-on: pumbg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Wake-on: g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Current message level: 0x00000007 (7)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               drv probe link</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Link detected: yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>Supports Wake-on: 判断该网卡是否支持WOL唤醒，pumbg则表示支持WOL</li>
<li>Wake-on: 表示WOL禁用状态，g为开启 d为禁用</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pve工具">PVE工具<a href="#pve工具" class="hash-link" aria-label="PVE工具的直接链接" title="PVE工具的直接链接">​</a></h3>
<ul>
<li><a href="https://github.com/ivanhao/pvetools" target="_blank" rel="noopener noreferrer">PVE-Tools</a></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt install -y git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/ivanhao/pvetools.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd pvetools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./pvetools.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/Benson80/pve-source" target="_blank" rel="noopener noreferrer">PVE-Source</a></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/Benson80/pve-source.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd pve-source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tar -zxvf ./pve_source.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./pve_source.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="  复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/tteck/Proxmox" target="_blank" rel="noopener noreferrer">Tteck-Proxmox</a></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/tteck/Proxmox.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd Proxmox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./misc/post-pve-install.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="三pve操作">三、PVE操作<a href="#三pve操作" class="hash-link" aria-label="三、PVE操作的直接链接" title="三、PVE操作的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="命令行操作虚拟机">命令行操作虚拟机<a href="#命令行操作虚拟机" class="hash-link" aria-label="命令行操作虚拟机的直接链接" title="命令行操作虚拟机的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看集群资源状况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh get /cluster/resources</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 取得虚拟机当前状态</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh get /nodes/&lt;节点id&gt;/qemu/&lt;虚拟机id&gt;/status/current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh get /nodes/pve/qemu/100/status/current</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 关闭虚拟机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh create /nodes/&lt;节点id&gt;/qemu/&lt;虚 拟机id&gt;/status/stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh create /nodes/pve/qemu/100/status/stop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动虚拟机</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh create /nodes/&lt;节点id&gt;/qemu/&lt;虚拟机id&gt;/status/start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pvesh create /nodes/pve/qemu/100/status/start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>查看pci设备</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 网卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci | grep -i &#x27;Ethernet&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 声卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci | grep -i &#x27;Audio&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 核显</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci | grep -i &#x27;Graphics&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SATA控制器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci | grep -i &#x27;SATA&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~/pvetools# lspci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:00.0 Host bridge: Intel Corporation Gemini Lake Host Bridge (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:02.0 VGA compatible controller: Intel Corporation GeminiLake [UHD Graphics 600] (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:0e.0 Audio device: Intel Corporation Celeron/Pentium Silver Processor High Definition Audio (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:0f.0 Communication controller: Intel Corporation Celeron/Pentium Silver Processor Trusted Execution Engine Interface (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:12.0 SATA controller: Intel Corporation Celeron/Pentium Silver Processor SATA Controller (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:13.0 PCI bridge: Intel Corporation Gemini Lake PCI Express Root Port (rev f6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:13.1 PCI bridge: Intel Corporation Gemini Lake PCI Express Root Port (rev f6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:13.2 PCI bridge: Intel Corporation Gemini Lake PCI Express Root Port (rev f6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:13.3 PCI bridge: Intel Corporation Gemini Lake PCI Express Root Port (rev f6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:14.0 PCI bridge: Intel Corporation Gemini Lake PCI Express Root Port (rev f6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:14.1 PCI bridge: Intel Corporation Gemini Lake PCI Express Root Port (rev f6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:15.0 USB controller: Intel Corporation Celeron/Pentium Silver Processor USB 3.0 xHCI Controller (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:1f.0 ISA bridge: Intel Corporation Celeron/Pentium Silver Processor LPC Controller (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:1f.1 SMBus: Intel Corporation Celeron/Pentium Silver Processor Gaussian Mixture Model (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">03:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">04:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="挂载磁盘">挂载磁盘<a href="#挂载磁盘" class="hash-link" aria-label="挂载磁盘的直接链接" title="挂载磁盘的直接链接">​</a></h3>
<ol>
<li>查看磁盘挂载情况</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># lsblk 列出磁盘 MOUNTPOINTS 为空的是未挂载的磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# lsblk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sda      8:0    0   32G  0 disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdb      8:16   0  2.4G  0 disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─sdb1   8:17   0  128M  0 part /boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│                               /boot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─sdb2   8:18   0  256M  0 part /rom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─sdb3   8:19   0    2G  0 part /overlay/upper/opt/docker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                /overlay</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sdc      8:32   0  100G  0 disk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─sdc1   8:33   0  100G  0 part /mnt/sdc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>使用 <code>fdisk</code> 进行分区</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 使用 fdisk /dev/sba 对未挂载的磁盘分区</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# fdisk /dev/sba</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to fdisk (util-linux 2.37.4).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Changes will remain in memory only, until you decide to write them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Be careful before using the write command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fdisk: cannot open /dev/sba: No such file or directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# fdisk /dev/sda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to fdisk (util-linux 2.37.4).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Changes will remain in memory only, until you decide to write them.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Be careful before using the write command.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device does not contain a recognized partition table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created a new DOS disklabel with disk identifier 0x764af82b.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command (m for help): p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk /dev/sda: 32 GiB, 34359738368 bytes, 67108864 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk model: QEMU HARDDISK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Units: sectors of 1 * 512 = 512 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sector size (logical/physical): 512 bytes / 512 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disklabel type: dos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk identifier: 0x764af82b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command (m for help): n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Partition type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   p   primary (0 primary, 0 extended, 4 free)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   e   extended (container for logical partitions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Select (default p): p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Partition number (1-4, default 1): </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">First sector (2048-67108863, default 2048): </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-67108863, default 67108863):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Created a new partition 1 of type &#x27;Linux&#x27; and of size 32 GiB.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command (m for help): p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk /dev/sda: 32 GiB, 34359738368 bytes, 67108864 sectors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk model: QEMU HARDDISK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Units: sectors of 1 * 512 = 512 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sector size (logical/physical): 512 bytes / 512 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disklabel type: dos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Disk identifier: 0x764af82b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device     Boot Start      End  Sectors Size Id Type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sda1        2048 67108863 67106816  32G 83 Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command (m for help): w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The partition table has been altered.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Calling ioctl() to re-read partition table.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Syncing disks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>根目录下创建了一个名为 <code>/mnt/sda</code> 的目录，并将 <code>/dev/sda1</code> 文件系统格式化为 <code>ext4</code>。</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 将目录格式化为 ext4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# mkdir /mnt/sda</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# mkfs.ext4 /dev/sda1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mke2fs 1.46.5 (30-Dec-2021)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Discarding device blocks: done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating filesystem with 8388352 4k blocks and 2097152 inodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Filesystem UUID: 8018393e-9b35-4170-978d-cd59ea37065c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Superblock backups stored on blocks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        4096000, 7962624</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Allocating group tables: done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing inode tables: done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating journal (32768 blocks): done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Writing superblocks and filesystem accounting information: done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>配置 <code>/etc/fstab</code> 文件实现开机自动挂载 在配置文件 <code>/etc/fstab</code> 后追加 <code>/dev/sda1 /mnt/sda ext4 defaults 0 0</code></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# vim /etc/fstab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# cat /etc/fstab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &lt;file system&gt; &lt;mount point&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sda1 /mnt/sda ext4 defaults 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdc1 /mnt/sdc ext4 defaults 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>使用 <code>mount</code> 命令挂载</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 挂载磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# mount /dev/sda1 /mnt/sda/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开机自动挂载</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# mount -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 卸载挂载的磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@iStoreOS:~# umount /dev/sda1 /mnt/sda/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="6">
<li>使用UUID挂载磁盘</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 安装 ntfs-3g 挂在 NTFS 磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt-get install ntfs-3g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查看磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fdisk -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取UUID  21729cd9-6b93-4321-8061-5ac641b1020c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blkid /dev/sdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 创建挂载点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir /mnt/sdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 挂在磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /etc/fstab /etc/fstab.bak</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/fstab </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 写入配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/dev/sdb                                   /mnt/sdb  ntfs-3g  rw,locale=zh_CN.utf8,uid=1000        0 0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID=21729cd9-6b93-4321-8061-5ac641b1020c  /mnt/sdb  ntfs-3g  nofail,rw,locale=zh_CN.utf8,uid=1000 0 0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UUID=21729cd9-6b93-4321-8061-5ac641b1020c  /mnt/sda  ext4     defaults,noatime,nofail              0 0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中nofail选项确保即使硬盘未连接或出错，系统也能正常启动</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="修改虚拟机编号vmid">修改虚拟机编号VMID<a href="#修改虚拟机编号vmid" class="hash-link" aria-label="修改虚拟机编号VMID的直接链接" title="修改虚拟机编号VMID的直接链接">​</a></h3>
<p>例如，将vmid 102的虚拟机改成vmid 100的虚拟机</p>
<ol>
<li>修改虚拟机配置文件</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /etc/pve/qemu-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mv 102.conf 100.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/pve/qemu-server/100.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>将配置文件中涉及到硬盘的参数的如sata0，scsi0，tpmstate0，efidisk0的内容修改成数值100</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">efidisk0: local-lvm:vm-102-disk-0,efitype=4m,pre-enrolled-keys=1,size=4M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sata0: local-lvm:vm-102-disk-1,size=32G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tpmstate0: local-lvm:vm-102-disk-2,size=4M,version=v2.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>改成如下</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">efidisk0: local-lvm:vm-100-disk-0,efitype=4m,pre-enrolled-keys=1,size=4M</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sata0: local-lvm:vm-100-disk-1,size=32G</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tpmstate0: local-lvm:vm-100-disk-2,size=4M,version=v2.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>通过lvrename命令修改vm磁盘序号</li>
</ol>
<p>或者命令查看磁盘</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lvs -a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将VM磁盘中的102磁盘都修改为100的</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lvrename /dev/pve/vm-102-disk-0 /dev/pve/vm-100-disk-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvrename /dev/pve/vm-102-disk-1 /dev/pve/vm-100-disk-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvrename /dev/pve/vm-102-disk-2 /dev/pve/vm-100-disk-2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>或者使用下方命令更换vmid，复制黏贴到终端运行。</li>
</ol>
<p>修改其中的vgNAME（当前节点名，如pve），newVMID（新VMID），oldVMID（旧VMID）参数名即可。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设置变量vgNAME，newVMID，oldVMID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vgNAME=iKuai newVMID=100 oldVMID=102 ;  \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 循环查找旧磁盘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for i in $(lvs -a|grep $vgNAME | awk &#x27;{print $1}&#x27; | grep $oldVMID); \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 重命名磁盘序号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lvrename $vgNAME/vm-$oldVMID-disk-$(echo $i | awk &#x27;{print substr($0,length,1)}&#x27;) vm-$newVMID-disk-$(echo $i | awk &#x27;{print substr($0,length,1)}&#x27;); done; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 替换conf文件中的vmid数值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sed -i &quot;s/$oldVMID/$newVMID/g&quot; /etc/pve/qemu-server/$oldVMID.conf; mv /etc/pve/qemu-server/$oldVMID.conf /etc/pve/qemu-server/$newVMID.conf; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 解绑变量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unset vgNAME newVMID oldVMID;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>参考文档<!-- -->
<ol>
<li><a href="https://bobcares.com/blog/change-vmid-proxmox/" target="_blank" rel="noopener noreferrer">How to change VMID Proxmox (bobcares.com)</a></li>
<li><a href="https://forum.proxmox.com/threads/changing-vmid-of-a-vm.63161/" target="_blank" rel="noopener noreferrer">Changing VMID of a VM | Proxmox Support Forum</a></li>
<li><a href="https://www.jianshu.com/p/3093d35d698a" target="_blank" rel="noopener noreferrer">PVE 修改虚拟机VMID</a></li>
</ol>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="四hdmi直通">四、HDMI直通<a href="#四hdmi直通" class="hash-link" aria-label="四、HDMI直通的直接链接" title="四、HDMI直通的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pve开启硬件直通功能">PVE开启硬件直通功能<a href="#pve开启硬件直通功能" class="hash-link" aria-label="PVE开启硬件直通功能的直接链接" title="PVE开启硬件直通功能的直接链接">​</a></h3>
<ol>
<li>
<p>BIOS中关闭CSM（兼容启动模式），仅开启UEFI启动，并以UEFI安装PVE</p>
</li>
<li>
<p>BIOS中打开硬件直通相关设置</p>
<ul>
<li>找到BIOS中虚拟化功能，并打开(VMX或SVM)</li>
<li>找到BIOS中硬件直通相关功能，并打开（VT-d，AMD-v）</li>
</ul>
</li>
<li>
<p>BIOS的CSM设置里面把vedio的UEFI换成legacy</p>
</li>
<li>
<p>修改GRUB，启动IOMMU(硬件直通)支持</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 修改grub启动文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将以下条目删除</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 替换为</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on iommu=pt nofb nomodeset video=vesafb:off video=efifb:off video=simplefb:off pcie_acs_override=downstream&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 按“CTRL+X”退出修改，然后“Y”确认保存，然后按“enter”确认文件名并保存</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新GRUB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># pcie_acs_override （PCIE拆分，增加直通成功率）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># video=vesafb:off,efifb:off （关闭framebuffer，避免显卡占用）</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="加载直通所需要的linux模组">加载直通所需要的Linux模组<a href="#加载直通所需要的linux模组" class="hash-link" aria-label="加载直通所需要的Linux模组的直接链接" title="加载直通所需要的Linux模组的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 修改模组加载文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 添加以下内容</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vfio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vfio_iommu_type1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vfio_pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vfio_virqfd </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="屏蔽显卡相关驱动">屏蔽显卡相关驱动<a href="#屏蔽显卡相关驱动" class="hash-link" aria-label="屏蔽显卡相关驱动的直接链接" title="屏蔽显卡相关驱动的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建屏蔽文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/modprobe.d/pve-blacklist.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入需要屏蔽的显卡相关模组（包含声卡以及i915核显驱动）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist nvidiafb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist snd_hda_intel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist snd_soc_skl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist snd_sof_pci</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist snd_hda_codec_hdmi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blacklist i915</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置对应的直通相关模组绑定设备">配置对应的直通相关模组，绑定设备<a href="#配置对应的直通相关模组绑定设备" class="hash-link" aria-label="配置对应的直通相关模组，绑定设备的直接链接" title="配置对应的直通相关模组，绑定设备的直接链接">​</a></h3>
<p>确认显卡和声卡硬件ids</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查询设备位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci | grep VGA        # 显卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci | grep Audio      # 声卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询对应设备ids</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci -n -s 00:02.0     # 显卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lspci -n -s 00:0e.0     # 声卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询PCI ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; spci | grep VGA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:02.0 VGA compatible controller: Intel Corporation GeminiLake [UHD Graphics 600] (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; lspci -n -s 00:02.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">00:02.0 0300: 8086:3185 (rev 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 保存PCI ID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 显卡 00:02 8086:3185</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 声卡 00:0e 8086:3198</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建设置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/modprobe.d/igpu-pass.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加入以下条目——————————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置vfio-pci，绑定设备，ids处输入前面查到的先看ids号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options vfio-pci ids=8086:3185,8086:3198 disable_vga=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 避免ignored RDMSR警告刷屏</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options kvm ignore_msrs=1 report_ignored_msrs=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 允许设备不安全中断，增加成功率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options vfio_iommu_type1 allow_unsafe_interrupts=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 激活声卡（不确定）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">options snd-hda-intel enable_msi=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="更新配置并重启">更新配置 并重启<a href="#更新配置并重启" class="hash-link" aria-label="更新配置并重启的直接链接" title="更新配置并重启的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">update-initramfs -u -k all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reboot</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="下载显卡rom文件">下载显卡rom文件<a href="#下载显卡rom文件" class="hash-link" aria-label="下载显卡rom文件的直接链接" title="下载显卡rom文件的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 进入路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /usr/share/kvm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 下载文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://gitee.com/spoto/PVE_Generic_AIO/raw/master/Z.1%E3%80%81J4125%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%B8%E6%98%BE%E7%9B%B4%E9%80%9A%EF%BC%88%E5%90%ABHDMI%E8%BE%93%E5%87%BA%EF%BC%89/vbios_1005v4.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建虚拟机需要注意的地方">创建虚拟机需要注意的地方<a href="#创建虚拟机需要注意的地方" class="hash-link" aria-label="创建虚拟机需要注意的地方的直接链接" title="创建虚拟机需要注意的地方的直接链接">​</a></h3>
<ol>
<li>CPU使用host模式</li>
<li>q35机型直通成功率较高，亦可尝试i440fx</li>
<li>直通PCI硬件（设置为主GPU，PCIE模式）</li>
<li>删除原本虚拟显示设备</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为核显加载bios文件">为核显加载BIOS文件<a href="#为核显加载bios文件" class="hash-link" aria-label="为核显加载BIOS文件的直接链接" title="为核显加载BIOS文件的直接链接">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># xxx为虚拟机编号VMID</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/pve/qemu-server/xxx.conf </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#找到通过host硬件ID找到硬件描述的一行并加入</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">romfile=vbios_1005v4.bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="插入hdmi接口启动成功">插入HDMI接口启动成功<a href="#插入hdmi接口启动成功" class="hash-link" aria-label="插入HDMI接口启动成功的直接链接" title="插入HDMI接口启动成功的直接链接">​</a></h3>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="五安装-atlasos-精简-windows-10">五、安装 AtlasOS 精简 Windows 10<a href="#五安装-atlasos-精简-windows-10" class="hash-link" aria-label="五、安装 AtlasOS 精简 Windows 10的直接链接" title="五、安装 AtlasOS 精简 Windows 10的直接链接">​</a></h2>
<ul>
<li><a href="https://atlasos.net/" target="_blank" rel="noopener noreferrer">AtlasOS</a></li>
<li><a href="https://docs.atlasos.net/getting-started/installation/" target="_blank" rel="noopener noreferrer">AtlasOS Doc</a></li>
<li><a href="https://github.com/atlas-os/atlas" target="_blank" rel="noopener noreferrer">AtlasOS Github</a></li>
</ul>
<ol>
<li>上传Windows10镜像</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /var/lib/vz/template/iso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>正常安装Windows 10 或者Windows 11</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># BT链接 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">magnet:?xt=urn:btih:366ADAA52FB3639B17D73718DD5F9E3EE9477B40&amp;dn=SW_DVD9_WIN_ENT_LTSC_2021_64BIT_ChnSimp_MLF_X22-84402.ISO&amp;xl=5044211712</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>安装网卡驱动</li>
<li>下载AtlasOS Playbook 和 AME Wizard</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://download.ameliorated.io/AME%20Wizard%20Beta.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://cdn.jsdelivr.net/atlas/0.4.0/AtlasPlaybook_v0.4.0.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="六安装-ikuai">六、安装 iKuai<a href="#六安装-ikuai" class="hash-link" aria-label="六、安装 iKuai的直接链接" title="六、安装 iKuai的直接链接">​</a></h2>
<ol>
<li>在BIOS中打开硬件直通相关选项（VT-d &amp; VMX）</li>
<li>编辑Grub开启网口直通</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开启硬件直通</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将 GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot; 改为 GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果你的pcie设备分组有问题也可以换成这一行对分组拆分（直通遇到问题都可以尝试这个）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on pcie_acs_override=downstream&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~/pvetools# update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generating grub configuration file ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found linux image: /boot/vmlinuz-6.8.4-3-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found initrd image: /boot/initrd.img-6.8.4-3-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Adding boot menu entry for UEFI Firmware Settings ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>记录外部网口与编码映射关系</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 获取网卡名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取网卡的PCI地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp1s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp2s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp3s0  ethtool --driver eno1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从PCI上查看网卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~# lspci | grep -i &#x27;Ethernet&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">03:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">04:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>外部编号</th><th>网卡名</th><th>PCI地址</th><th>备注</th></tr></thead><tbody><tr><td>ETH0</td><td>enp1s0</td><td>01:00.0</td><td>WAN</td></tr><tr><td>ETH1</td><td>enp2s0</td><td>02:00.0</td><td>LAN</td></tr><tr><td>ETH2</td><td>eno1 enp3s0</td><td>03:00.0</td><td>LAN</td></tr><tr><td>ETH3</td><td>enp4s0</td><td>04:00.0</td><td>MNG</td></tr></tbody></table>
<ol start="4">
<li>下载镜像并上传</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://www.ikuai8.com/download.php?n=/3.x/iso/iKuai8_x64_3.7.12_Build202406112125.iso</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>
<p>创建虚拟机</p>
<ol>
<li>常规: 序号 100 名称 iKuai</li>
<li>操作系统: 选择上传的iKuai镜像</li>
<li>系统: 默认</li>
<li>磁盘: 8G</li>
<li>CPU: 1C4T 类别: Host</li>
<li>内存: 4096 MB</li>
<li>网络: vmbr0 VirtIO半虚拟化</li>
</ol>
</li>
<li>
<p>iKuai - 硬件 - 添加 - PCI设备，选择需要直通的网卡</p>
</li>
<li>
<p>开机进入iKuai系统，选择 1 安装系统，按 y 确认，安装成功后会自动重启</p>
</li>
<li>
<p>重启后按照指令修改ip， 192.168.0.201</p>
</li>
<li>
<p>浏览器访问 192.168.0.201 ，登录账号 admin / admin，修改密码为 admin123</p>
</li>
<li>
<p>在系统管理 - 登录管理 - 远程访问开启远程维护，端口为22，账号密码 sshd / admin123</p>
</li>
<li>
<p>在网络设置 - DHCP设置 - DHCP服务端 修改目标网段，或者关闭DHCP服务，否则会污染内网设备的IP分配</p>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="七安装-openwrt">七、安装 OpenWrt<a href="#七安装-openwrt" class="hash-link" aria-label="七、安装 OpenWrt的直接链接" title="七、安装 OpenWrt的直接链接">​</a></h2>
<ol>
<li>在BIOS中打开硬件直通相关选项（VT-d &amp; VMX）</li>
<li>编辑Grub开启网口直通</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开启硬件直通</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将 GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot; 改为 GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果你的pcie设备分组有问题也可以换成这一行对分组拆分（直通遇到问题都可以尝试这个）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on pcie_acs_override=downstream&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~/pvetools# update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generating grub configuration file ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found linux image: /boot/vmlinuz-6.8.4-3-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found initrd image: /boot/initrd.img-6.8.4-3-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Adding boot menu entry for UEFI Firmware Settings ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>记录外部网口与编码映射关系</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 获取网卡名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取网卡的PCI地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp1s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp2s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp3s0  ethtool --driver eno1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从PCI上查看网卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~# lspci | grep -i &#x27;Ethernet&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">03:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">04:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>外部编号</th><th> 网卡名</th><th>PCI地址</th><th>备注</th></tr></thead><tbody><tr><td>ETH0</td><td>enp1s0</td><td>01:00.0</td><td>WAN</td></tr><tr><td>ETH1</td><td>enp2s0</td><td>02:00.0</td><td>LAN</td></tr><tr><td>ETH2</td><td>eno1 enp3s0</td><td>03:00.0</td><td>LAN</td></tr><tr><td>ETH3</td><td>enp4s0</td><td>04:00.0</td><td>MNG</td></tr></tbody></table>
<ol start="4">
<li>下载镜像</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># https://firmware-selector.openwrt.org/?version=23.05.5&amp;target=x86%2Fgeneric&amp;id=generic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wget https://downloads.openwrt.org/releases/23.05.5/targets/x86/generic/openwrt-23.05.5-x86-generic-generic-squashfs-combined-efi.img.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gzip -d openwrt-23.05.5-x86-generic-generic-squashfs-combined-efi.img.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>
<p> 创建虚拟机</p>
<ol>
<li>常规: 序号 202 名称 OpenWrt</li>
<li>操作系统: 不使用任何介质</li>
<li>系统: 默认，或把BIOS改为 UEFI(OpenWrt使用默认的SeaBIOS)</li>
<li>磁盘: 删除硬盘</li>
<li>CPU: 1C4T 类别: Host</li>
<li>内存: 2048 MB</li>
<li>网络: vmbr0 VirtIO半虚拟化</li>
</ol>
</li>
<li>
<p>导入镜像</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 202为虚拟机编号  istoreos为下载的镜像名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qm importdisk 202 openwrt-23.05.5-x86-generic-generic-squashfs-combined-efi.img local-lvm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果合并了 local 和 local-lvm 将结尾的 local-lvm 改为 local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="7">
<li>OpenWrt - 硬件 - 未使用的磁盘0，双击添加</li>
<li>OpenWrt - 选项 - 引导顺序，仅勾选挂载的 disk 磁盘，并将其移动到第一位</li>
<li>OpenWrt - 硬件 - EFI磁盘 - 移除</li>
<li>OpenWrt - 硬件 - 添加 - PCI设备，选择需要直通的网卡</li>
<li>开机进入命令行，配置默认的ip地址</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/config/network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config interface &#x27;loopback&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option device &#x27;lo&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option proto &#x27;static&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ipaddr &#x27;127.0.0.1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option netmask &#x27;255.0.0.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config globals &#x27;globals&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ula_prefix &#x27;fd57:6dbb:d2f3::/48&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option name &#x27;br-lan&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option type &#x27;bridge&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list ports &#x27;eth0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config interface &#x27;lan&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option device &#x27;br-lan&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option proto &#x27;static&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ipaddr &#x27;192.168.0.202&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option netmask &#x27;255.255.255.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option gateway &#x27;192.168.0.1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option peerdns &#x27;0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list dns &#x27;223.5.5.5&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴  板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="八安装-istoreos">八、安装 iStoreOS<a href="#八安装-istoreos" class="hash-link" aria-label="八、安装 iStoreOS的直接链接" title="八、安装 iStoreOS的直接链接">​</a></h2>
<ol>
<li>在BIOS中打开硬件直通相关选项（VT-d &amp; VMX）</li>
<li>编辑Grub开启网口直通</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 开启硬件直通</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 将 GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet&quot; 改为 GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果你的pcie设备分组有问题也可以换成这一行对分组拆分（直通遇到问题都可以尝试这个）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># GRUB_CMDLINE_LINUX_DEFAULT=&quot;quiet intel_iommu=on pcie_acs_override=downstream&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 更新grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~/pvetools# update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Generating grub configuration file ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found linux image: /boot/vmlinuz-6.8.4-3-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found initrd image: /boot/initrd.img-6.8.4-3-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found linux image: /boot/vmlinuz-6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found initrd image: /boot/initrd.img-6.8.4-2-pve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Found memtest86+ 64bit EFI image: /boot/memtest86+x64.efi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Adding boot menu entry for UEFI Firmware Settings ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="3">
<li>记录外部网口与编码映射关系</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 获取网卡名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ip addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 获取网卡的PCI地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp1s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp2s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp3s0  ethtool --driver eno1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ethtool --driver enp4s0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从PCI上查看网卡</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@pve:~# lspci | grep -i &#x27;Ethernet&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">01:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">02:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">03:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">04:00.0 Ethernet controller: Intel Corporation Ethernet Controller I226-V (rev 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>外部编号</th><th>网卡名</th><th>PCI地址</th><th>备注</th></tr></thead><tbody><tr><td>ETH0</td><td>enp1s0</td><td>01:00.0</td><td>WAN</td></tr><tr><td>ETH1</td><td>enp2s0</td><td>02:00.0</td><td>LAN</td></tr><tr><td>ETH2</td><td>eno1 enp3s0</td><td>03:00.0</td><td>LAN</td></tr><tr><td>ETH3</td><td>enp4s0</td><td>04:00.0</td><td>MNG</td></tr></tbody></table>
<ol start="4">
<li>下载镜像</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://fw0.koolcenter.com/iStoreOS/x86_64/istoreos-22.03.6-2024061415-x86-64-squashfs-combined.img.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gzip -d istoreos-22.03.6-2024061415-x86-64-squashfs-combined.img.gz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="5">
<li>
<p>创建虚拟机</p>
<ol>
<li>常规: 序号 203 名称 iStoreOS</li>
<li>操作系统: 不使用任何介质</li>
<li>系统: 默认，或把BIOS改为 UEFI(OpenWrt使用默认的SeaBIOS)</li>
<li>磁盘: 删除硬盘</li>
<li>CPU: 1C4T 类别: Host</li>
<li>内存: 4096 MB</li>
<li>网络: vmbr0 VirtIO半虚拟化</li>
</ol>
</li>
<li>
<p>导入镜像</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 203为虚拟机编号  istoreos为下载的镜像名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qm importdisk 203 istoreos-22.03.6-2024061415-x86-64-squashfs-combined.img local-lvm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果合并了 local 和 local-lvm 将结尾的 local-lvm 改为 local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="7">
<li>iStoreOS - 硬件 - 未使用的磁盘0，双击添加</li>
<li>iStoreOS - 选项 - 引导顺序，仅勾选挂载的 disk 磁盘，并将其移动到第一位</li>
<li>iStoreOS - 硬件 - EFI磁盘 - 移除</li>
<li>iStoreOS - 硬件 - 添加 - PCI设备，选择需要直通的网卡</li>
<li>开机进入命令行，配置默认的ip地址</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vim /etc/config/network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config interface &#x27;loopback&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option device &#x27;lo&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option proto &#x27;static&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ipaddr &#x27;127.0.0.1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option netmask &#x27;255.0.0.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config globals &#x27;globals&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ula_prefix &#x27;fd57:6dbb:d2f3::/48&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option name &#x27;br-lan&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option type &#x27;bridge&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list ports &#x27;eth0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config interface &#x27;lan&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option device &#x27;br-lan&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option proto &#x27;static&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option ipaddr &#x27;192.168.0.203&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option netmask &#x27;255.255.255.0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option gateway &#x27;192.168.0.1&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        option peerdns &#x27;0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        list dns &#x27;223.5.5.5&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>注意</strong></p>
<ol>
<li>也可以使用 iStoreOS 提供的 <code>quickstart</code> 命令初始化网络</li>
<li>如果设置静态ip后无法访问后台，可以将wan口的 device 加到 lan 下</li>
</ol>
<p>访问iStoreOS <a href="http://istoreos.local" target="_blank" rel="noopener noreferrer">http://istoreos.local</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="九安装-hassos">九、安装 HassOS<a href="#九安装-hassos" class="hash-link" aria-label="九、安装 HassOS的直接链接" title="九、安装 HassOS的直接链接">​</a></h2>
<ol>
<li>常规: 序号 110 名称 HassOS</li>
<li>操作系统: 不使用任何介质</li>
<li>系统: 默认</li>
<li>磁盘: 删除硬盘</li>
<li>CPU: 1C2T 类别: Host</li>
<li>内存: 4096 MB</li>
<li>网络: vmbr0 VirtIO半虚拟化</li>
<li>创建完成后，再次确认删除磁盘和改为UEFI启动</li>
<li>下载镜像</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wget https://github.com/home-assistant/operating-system/releases/download/12.3/haos_ova-12.3.qcow2.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install -y xz-utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xz -d haos_ova-12.3.qcow2.xz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xz -d -c haos_ova-12.3.qcow2.xz &gt; ./haos_ova-12.3.qcow2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="10">
<li>Shell窗口添加 qcow2 镜像</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /root/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 110为虚拟机编号  haos为下载的qcow2镜像名称</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qm importdisk 110 haos_ova-12.3.qcow2 local-lvm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果合并了 local 和 local-lvm 将结尾的 local-lvm 改为 local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="11">
<li>HassOS - 硬件 - 未使用的磁盘0，双击添加</li>
<li>HassOS - 选项 - 引导顺序，仅勾选挂载的 qcow2 磁盘，并将其移动到第一位</li>
<li>浏览器访问 <a href="http://homeassistant.local:8123/" target="_blank" rel="noopener noreferrer">http://homeassistant.local:8123/</a></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 查看ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ha network info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 设为静态IP，并指定ip地址，默认为auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ha network update enp0s18 --ipv4-method static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ha network update enp0s18 --ipv4-address 192.168.0.211/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 使用nmcli修改ip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli con show</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli device status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli&gt; print ipv4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli&gt; set ipv4.addresses 192.168.0.211/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Do you also want to set &#x27;ipv4.method&#x27; to &#x27;manual&#x27;? [yes]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli&gt; set ipv4.dns 1.1.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli&gt; set ipv4.gateway 192.168.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli&gt; save</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nmcli&gt; quit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><a href="https://github.com/home-assistant/operating-system/blob/dev/Documentation/network.md" target="_blank" rel="noopener noreferrer">https://github.com/home-assistant/operating-system/blob/dev/Documentation/network.md</a></li>
<li><a href="https://community.home-assistant.io/t/how-to-change-ip-adresse-in-cli/332205/4" target="_blank" rel="noopener noreferrer">https://community.home-assistant.io/t/how-to-change-ip-adresse-in-cli/332205/4</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/diy/aio/20-PVE.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>Lorchr</b> <!-- -->于 <b><time datetime="2025-06-12T10:19:26.000Z" itemprop="dateModified">2025年6月12日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/diy/aio/Esxi-Reference-1/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Esxi-Reference-1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/diy/aio/PVE-Reference-1/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">PVE-Reference-1</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一pve安装初始化" class="table-of-contents__link toc-highlight">一、PVE安装初始化</a><ul><li><a href="#合并-local-与-local-lvm" class="table-of-contents__link toc-highlight">合并 local 与 local-lvm</a></li><li><a href="#换源" class="table-of-contents__link toc-highlight">换源</a></li></ul></li><li><a href="#二pve配置" class="table-of-contents__link toc-highlight">二、PVE配置</a><ul><li><a href="#修改ip-主机名-dns" class="table-of-contents__link toc-highlight">修改IP 主机名 DNS</a></li><li><a href="#安装zsh" class="table-of-contents__link toc-highlight">安装zsh</a></li><li><a href="#域名访问" class="table-of-contents__link toc-highlight">域名访问</a></li><li><a href="#记录网卡总线信息-bus-info" class="table-of-contents__link toc-highlight">记录网卡总线信息 bus info</a></li><li><a href="#配置wol" class="table-of-contents__link toc-highlight">配置WOL</a></li><li><a href="#pve工具" class="table-of-contents__link toc-highlight">PVE工具</a></li></ul></li><li><a href="#三pve操作" class="table-of-contents__link toc-highlight">三、PVE操作</a><ul><li><a href="#命令行操作虚拟机" class="table-of-contents__link toc-highlight">命令行操作虚拟机</a></li><li><a href="#挂载磁盘" class="table-of-contents__link toc-highlight">挂载磁盘</a></li><li><a href="#修改虚拟机编号vmid" class="table-of-contents__link toc-highlight">修改虚拟机编号VMID</a></li></ul></li><li><a href="#四hdmi直通" class="table-of-contents__link toc-highlight">四、HDMI直通</a><ul><li><a href="#pve开启硬件直通功能" class="table-of-contents__link toc-highlight">PVE开启硬件直通功能</a></li><li><a href="#加载直通所需要的linux模组" class="table-of-contents__link toc-highlight">加载直通所需要的Linux模组</a></li><li><a href="#屏蔽显卡相关驱动" class="table-of-contents__link toc-highlight">屏蔽显卡相关驱动</a></li><li><a href="#配置对应的直通相关模组绑定设备" class="table-of-contents__link toc-highlight">配置对应的直通相关模组，绑定设备</a></li><li><a href="#更新配置并重启" class="table-of-contents__link toc-highlight">更新配置并重启</a></li><li><a href="#下载显卡rom文件" class="table-of-contents__link toc-highlight">下载显卡rom文件</a></li><li><a href="#创建虚拟机需要注意的地方" class="table-of-contents__link toc-highlight">创建虚拟机需要注意的地方</a></li><li><a href="#为核显加载bios文 件" class="table-of-contents__link toc-highlight">为核显加载BIOS文件</a></li><li><a href="#插入hdmi接口启动成功" class="table-of-contents__link toc-highlight">插入HDMI接口启动成功</a></li></ul></li><li><a href="#五安装-atlasos-精简-windows-10" class="table-of-contents__link toc-highlight">五、安装 AtlasOS 精简 Windows 10</a></li><li><a href="#六安装-ikuai" class="table-of-contents__link toc-highlight">六、安装 iKuai</a></li><li><a href="#七安装-openwrt" class="table-of-contents__link toc-highlight">七、安装 OpenWrt</a></li><li><a href="#八安装-istoreos" class="table-of-contents__link toc-highlight">八、安装 iStoreOS</a></li><li><a href="#九安装-hassos" class="table-of-contents__link toc-highlight">九、安装 HassOS</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>