<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-diy docs-version-current docs-doc-page docs-doc-id-aio/Esxi-Reference-1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Esxi-Reference-1 | Light Docusaurus</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://lorchr.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://lorchr.github.io/diy/aio/Esxi-Reference-1/"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-diy-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-diy-current"><meta data-rh="true" property="og:title" content="Esxi-Reference-1 | Light Docusaurus"><meta data-rh="true" name="description" content="- 快速构建和安装干净的 ESXi 8 镜像指南"><meta data-rh="true" property="og:description" content="- 快速构建和安装干净的 ESXi 8 镜像指南"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lorchr.github.io/diy/aio/Esxi-Reference-1/"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/diy/aio/Esxi-Reference-1/" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://lorchr.github.io/diy/aio/Esxi-Reference-1/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://TLGHDZ3Y2I-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Light Docusaurus RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Light Docusaurus Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="Light Docusaurus" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e8086d6f.css">
<script src="/assets/js/runtime~main.c1801180.js" defer="defer"></script>
<script src="/assets/js/main.0392788b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Torch Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Torch</b></a><a class="navbar__item navbar__link" href="/docs/category/guide/">Torch</a><a class="navbar__item navbar__link" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/middleware/">Middleware</a><a class="navbar__item navbar__link" href="/electron/">Electron</a><a class="navbar__item navbar__link" href="/postman/">Postman</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/diy/">DIY</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/diy/aio/Esxi-Reference-1/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li></ul></div><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/">DIY</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/Boot-U-Disk-By-Ventoy/">Boot-U-Disk-By-Ventoy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/device-and-software-plan/">Device and Software Plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/diy/geek-diyer/">Geek Diyer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/diy/category/aio/">AIO</a><button aria-label="折叠侧边栏分类 &#x27;AIO&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Device-J4125/">Device-J4125</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Device-J4125-Reference/">Device-J4125-Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/Esxi/">Esxi</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/diy/aio/Esxi-Reference-1/">Esxi-Reference-1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/PVE/">PVE</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/PVE-Reference-1/">PVE-Reference-1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/diy/aio/AIO-Reference-1/">AIO-Reference-1</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/network/">Network</a><button aria-label="展开侧边栏分类 &#x27;Network&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/android/">Android</a><button aria-label="展开侧边栏分类 &#x27;Android&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/nas/">NAS</a><button aria-label="展开侧边栏分类 &#x27;NAS&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/home-assistant/">Home Assistant</a><button aria-label="展开侧边栏分类 &#x27;Home Assistant&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/router/">Router</a><button aria-label="展开侧边栏分类 &#x27;Router&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/soft-router/">Soft Router</a><button aria-label="展开侧边栏分类 &#x27;Soft Router&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/tv-box/">TV Box</a><button aria-label="展开侧边栏分类 &#x27;TV Box&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/diy/category/game-box/">Game Box</a><button aria-label="展开侧边栏分类 &#x27;Game Box&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/diy/category/aio/"><span itemprop="name">AIO</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Esxi-Reference-1</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Esxi-Reference-1</h1></header><ul>
<li><a href="https://zhuanlan.zhihu.com/p/601787086" target="_blank" rel="noopener noreferrer">快速构建和安装干净的 ESXi 8 镜像指南</a></li>
<li><a href="https://soulteary.com/2023/01/29/how-to-easily-create-and-install-a-custom-esxi-image.html" target="_blank" rel="noopener noreferrer">快速构建和安装干净的 ESXi 8 镜像指南</a></li>
</ul>
<p>申请的 ESXi 8 的免费授权到了，所以趁着春节假期最后一天，折腾一把。这 篇文档支持 ESXi 8 及以下版本的安装镜像构建，无需麻烦的依赖安装和解决环境问题。</p>
<p>相比较安装运行网上已经构建好的黑盒镜像，为什么不自己进行构建呢？</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="写在前面">写在前面<a href="#写在前面" class="hash-link" aria-label="写在前面的直接链接" title="写在前面的直接链接">​</a></h2>
<p><img decoding="async" loading="lazy" alt="ESXi 8 的新版本控制台界面" src="/assets/images/finial-1f17bd42fd3ca98fb3890823cbe137c6.jpg" width="1200" height="585" class="img_ev3q"></p>
<p>2021 年，我曾写过一篇如何构建 ESXi 7 的安装镜像，以及简单的安装教程：<a href="https://soulteary.com/2021/06/22/nuc-notes-install-esxi7.html" target="_blank" rel="noopener noreferrer">《NUC 折腾笔记 - 安装 ESXi 7》[1]</a>。文章里的构建方法和命令，截止目前虽然还有效，我们可以通过这些命令，来构建包含我们所需要的硬件驱动或应用软件的自定义镜像。</p>
<p>但是，两年过去了，构建工具和其面对的系统环境却有了变化。有一位海外的用户总结了他在折腾 ESXi 8 所需要的构建环境过程中遇到的问题：<a href="https://blog.zuthof.nl/2022/11/30/powercli-13-update-and-installation-hurdles-on-windows/" target="_blank" rel="noopener noreferrer">《PowerCLI 13 update and installation hurdles on Windows》[2]</a>。</p>
<p>实际上，如果你还是按照“老路”走，在不同的 Windows 版本中，你将遇到不同的“惊喜”。未免太麻烦了，而且一旦 ESXi 9 出来，各种环境和工具出现更多的“过时问题”，是不是还得在踩一遍坑？那么，有没有简单的方法呢？答案是有的。</p>
<p>我封装了一个简单的，用于 ESXi 镜像构建的 Docker 工具镜像，相比较乱七八糟的折腾一通环境、依赖，使用 Docker 的现成镜像，快速构建你所需要的镜像，显然更高效、稳定、干净， 以及可靠。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="申请免费的-esxi-个人授权">申请免费的 ESXi 个人授权<a href="#申请免费的-esxi-个人授权" class="hash-link" aria-label="申请免费的 ESXi 个人授权的直接链接" title="申请免费的 ESXi 个人授权的直接链接">​</a></h3>
<p>在 VMware 网站中，我们能够找到 ESXi 8 和 ESXi 7 的使用授权的申请地址：</p>
<p><a href="https://my.vmware.com/web/vmware/evalcenter?p=free-esxi8&amp;source=dwnp" target="_blank" rel="noopener noreferrer">VMware vSphere Hypervisor 8[3]</a>
<a href="https://my.vmware.com/web/vmware/evalcenter?p=free-esxi7&amp;source=dwnp" target="_blank" rel="noopener noreferrer">VMware vSphere Hypervisor 7[4]</a>
注册社区帐号，然后填写表单，耐心等待授权审核通过，然后就能够合情合理合规的使用这款强大的软件啦。（第一次申请，审核时间可能久一些，之后的申请基本都是秒过。）</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="本篇文章中的开源项目">本篇文章中的开源项目<a href="#本篇文章中的开源项目" class="hash-link" aria-label="本篇文章中的开源项目的直接链接" title="本篇文章中的开源项目的直接链接">​</a></h3>
<p>我将本文中使用的代码上传到了 <a href="https://github.com/soulteary/easy-ESXi-builder" target="_blank" rel="noopener noreferrer">soulteary/easy-ESXi-builder[5]</a>，如果你期望完全自行构建，或者进行调整，可以考虑自取代码，折腾一下。</p>
<p>当然，如果这个项目帮助到了你，欢迎“一键三连”。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="快速制作-esxi-安装镜像">快速制作 ESXi 安装镜像<a href="#快速制作-esxi-安装镜像" class="hash-link" aria-label="快速制作 ESXi 安装镜像的直接链接" title="快速制作 ESXi 安装镜像的直接链接">​</a></h2>
<p>我使用 docker 制作了一个构建 ESXi 安装镜像的工作，通过下面的 方式，只需要执行一条命令获取工具镜像：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker pull soulteary/easy-esxi-builder:2023.01.29</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>至于 docker 的安装，你可以访问<a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer"> Docker 官方网站[6]</a>下载安装包，然后一路“Next” 完成安装。如果你使用 Linux，也可以参考这篇文章<a href="https://soulteary.com/2022/06/21/building-a-cost-effective-linux-learning-environment-on-a-laptop-the-basics.html#%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84-docker-%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer">《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》[7]</a>中提到的“更简单的 Docker 安装”方式，来完成 Docker 的快速初始化。</p>
<p>当我们完成了“工具镜像”的下载后，还需要准备（下载）两类“做饭的素材”：</p>
<ul>
<li>ESXi 的离线安装包，比如：“VMware-ESXi-8.0-20513097-depot.zip”，获取方式：<!-- -->
<ul>
<li>在上文中的 “授权申请”页面，我们能够直接下载，比如 ESXi 6，7，8。</li>
<li>获取使用好心人分享的网盘地址（记得做文件 HASH 校验）</li>
</ul>
</li>
<li>ESXi 相关社区驱动，搭配我们自己的硬件使用，比如：<!-- -->
<ul>
<li>ESXi 的 PCIe 社区网络驱动程序：<a href="https://flings.vmware.com/community-networking-driver-for-esxi" target="_blank" rel="noopener noreferrer">community-networking-driver-for-esxi[8]</a></li>
<li>ESXi 的 USB 社区网络驱动程序：<a href="https://flings.vmware.com/usb-network-native-driver-for-esxi" target="_blank" rel="noopener noreferrer">usb-network-native-driver-for-esxi[9]</a></li>
<li>ESXi 的 NVMe 社区驱动程序：<a href="https://flings.vmware.com/community-nvme-driver-for-esxi" target="_blank" rel="noopener noreferrer">community-nvme-driver-for-esxi[10]</a></li>
</ul>
</li>
</ul>
<p>将下载好的文件放置在当前目录，然后执行下面的命令，能够直接启动工具镜像，进入一个干净可靠的构建环境：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --rm -it -v `pwd`:/data soulteary/easy-esxi-builder:2023.01.29</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面的命令执行完毕后，当前目录下载好的 ESXi 安装包和驱动等，将被挂载到 Docker 容器中的 <code>/data</code> 目录中。</p>
<p>接下来，我们就能够使用下面的命令，来添加基础镜像，和我们要附加到 ESXi 镜像中的驱动了（命令中的文件名根据下载的文件名进行适当调整）：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 加载基础镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwareDepot /data/VMware-ESXi-8.0-20513097-depot.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载社区 NVMe 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwareDepot /data/nvme-community-driver_1.0.1.0-3vmw.700.1.0.15843807-component-18902434.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载社区 PCIe 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwareDepot /data/Net-Community-Driver_1.2.7.0-1vmw.700.1.0.15843807_19480755.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 加载社区 USB 驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwareDepot /data/ESXi800-VMKUSB-NIC-FLING-61054763-component-20826251.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 如果你还需要更多驱动，参考上面的命令，继续操作即可。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>一通命令执行，加载完毕“做饭的素材”后，执行 Get-EsxImageProfile 来查看系统加载了的 ESXi 基础镜像具体是什么版本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get-EsxImageProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                           Vendor          Last Modified   Acceptance Level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                           ------          -------------   ----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESXi-8.0.0-20513097-standard   VMware, Inc.    09/23/2022 18:… PartnerSupported</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESXi-8.0.0-20513097-no-tools   VMware, Inc.    09/23/2022 18:… PartnerSupported</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，使用下面的命令，制作一个“镜像副本”，用于“继续发挥”：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">New-EsxImageProfile -CloneProfile &quot;ESXi-8.0.0-20513097-standard&quot; -name &quot;ESXi-8.0.0-20513097-standard-nic&quot; -vendor &quot;soulteary&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>命令执行完毕，我们将看到类似下面的输出：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Name                           Vendor          Last Modified   Acceptance Level</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                           ------          -------------   ----------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ESXi-8.0.0-20513097-standard-… soulteary       09/23/2022 18:… PartnerSupported</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同样的，我们需要使用命令 Get-EsxSoftwarePackage 来获得可以使用的驱动列表：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get-EsxSoftwarePackage </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                     Version                        Vendor     Creation Date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                     -------                        ------     -------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dwi2c                    0.1-2vmw.800.1.0.20513097      VMW        09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">elxnet                   12.0.1250.0-8vmw.800.1.0.2051… VMW        09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lpnic                    11.4.62.0-1vmw.800.1.0.205130… VMW        09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esx-update               8.0.0-1.0.20513097             VMware     09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">qfle3                    1.0.67.0-30vmw.800.1.0.205130… VMW        09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esxio-base               8.0.0-1.0.20513097             VMware     09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpu-microcode            8.0.0-1.0.20513097             VMware     09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">esx-base                 8.0.0-1.0.20513097             VMware     09/23/2022 17:3…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>相比较 ESXi 基础镜像列表就俩选项，日志将输出至少一百个驱动，非常不利于观察和获得我们刚刚添加的驱动名称。所以，在这里我们可以通过简单的命令，过滤掉“VMware” 出品、和官方镜像一起构建于 “09/23/2022” （可以根据具体情况调整）的内容：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Get-EsxSoftwarePackage | grep -v VMware | grep -v &#x27;09/23/2022&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name                     Version                        Vendor     Creation Date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----                     -------                        ------     -------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nvme-community           1.0.1.0-3vmw.700.1.0.15843807  VMW        01/08/2020 12:0…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">net-community            1.2.7.0-1vmw.700.1.0.15843807  VMW        03/10/2022 21:2…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vmkusb-nic-fling         1.11-1vmw.800.1.20.61054763    VMW        11/16/2022 02:1…</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pensandoatlas            1.46.0.E.24.1.256-2vmw.800.1.… VMW        08/16/2022 14:0…</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>命令执行完，能够看到结果列表就所剩不多了。挑选出我们手动添加的驱动的名称，执行类似下面的命令，就完成了对 ESXi 镜像驱动的增加。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwarePackage -ImageProfile &quot;ESXi-8.0.0-20513097-standard-nic&quot; -SoftwarePackage &quot;nvme-community&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwarePackage -ImageProfile &quot;ESXi-8.0.0-20513097-standard-nic&quot; -SoftwarePackage &quot;net-community&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add-EsxSoftwarePackage -ImageProfile &quot;ESXi-8.0.0-20513097-standard-nic&quot; -SoftwarePackage &quot;vmkusb-nic-fling&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最后，执行命令将附加好社区驱动的 ESXi 镜像进行导出即可：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Export-EsxImageProfile -ImageProfile &quot;ESXi-8.0.0-20513097-standard-nic&quot; -ExportToIso -FilePath /data/ESXi8.iso</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>镜像导出到 <code>/data</code> 目录后，关闭容器，回到当前系统，准备制作安装引导盘（USB 启动盘）。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="esxi-8-的安装">ESXi 8 的安装<a href="#esxi-8-的安装" class="hash-link" aria-label="ESXi 8 的安装的直接链接" title="ESXi 8 的安装的直接链接">​</a></h2>
<p>ESXi 8 安装和之前类似，首先需要制作一张安装引导盘。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="制作-usb-安装引导盘">制作 USB 安装引导盘<a href="#制作-usb-安装引导盘" class="hash-link" aria-label="制作 USB 安装引导盘的直接链接" title="制作 USB 安装引导盘的直接链接">​</a></h3>
<p><img decoding="async" loading="lazy" alt="使用 balena Etcher 制作启动盘" src="/assets/images/flash-esxi-installer-15747abca3d8444f4425960979fcc3b5.jpg" width="1200" height="720" class="img_ev3q">
和之前一样，我个人推荐使用 <a href="https://www.balena.io/etcher" target="_blank" rel="noopener noreferrer">Balena Etcher[11]</a> 来简单的制作启动盘，只需要把我们制作好的 ESXi.iso 拖到软件界面上，然后点击 “Flash!” 按钮，等待镜像写入 USB 设备即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="完成-esxi-的安装">完成 ESXi 的安装<a href="#完成-esxi-的安装" class="hash-link" aria-label="完成 ESXi 的安装的直接链接" title="完成 ESXi 的安装的直接链接">​</a></h3>
<p>这里记录和分享下如何在普通的家用设备上完成 ESXi 的安装，包含解决不被 ESXi 支持的网络硬件的安装配置过程。</p>
<p>安装的第一步是在引导界面或者设备 BIOS 设置使用 USB 安装盘设备引导。</p>
<p><img decoding="async" loading="lazy" alt="选择 ESXi 安装盘引导设备" src="/assets/images/boot-device-af3293e152a641319d669eaf64dd6f68.jpg" width="1200" height="675" class="img_ev3q">
如果 USB 设备引导正常，我们将能够看到类似下面的 ESXi 安装工具的加载界面。</p>
<p><img decoding="async" loading="lazy" alt="耐心等待安装工具加载完毕" src="/assets/images/installer-loading-0a709e71c3011a4d7b4f403791d77c1a.jpg" width="1200" height="675" class="img_ev3q">
如果你的设备已经接入网络，并且网卡设备可以被识别，我们将进入下面的界面。如果你遇到问题，可以参考下文中的解决方案来解决问题。</p>
<p><img decoding="async" loading="lazy" alt="正式进入安装流程" src="/assets/images/welcome-to-installer-bcc15f1aa0b8b29a905afcb7fe915db0.jpg" width="1200" height="675" class="img_ev3q">
如果你不是跨两个（6-&gt;8）版本升级 ESXi，并且之前没有在老版本中安装过网络驱动，可以考虑直接升级。如果你希望省心一些，可以选择备份设备中的虚拟机数据，然后选择第三项，进行全新的覆盖安装。</p>
<p><img decoding="async" loading="lazy" alt="选择安装模式" src="/assets/images/select-install-method-2d2cacfbdb51ec095f0c51c19d6e933e.jpg" width="1200" height="675" class="img_ev3q">
一路“Next”之后，就来到了正式的安装过程中，耐心等待进度条走完。</p>
<p><img decoding="async" loading="lazy" alt="等待 ESXi 安装进度走完" src="/assets/images/waiting-install-progress-f27331402251af0807c1ab1093b3e5a1.jpg" width="1200" height="675" class="img_ev3q">
安装完毕，选择重启设备，拔掉插在设备上的 USB 引导盘。耐心等待 ESXi 新系统的启动。</p>
<p><img decoding="async" loading="lazy" alt="ESXi 顺利启动完毕" src="/assets/images/back-to-main-ui-b95a15d1cb6634b22a05497f8f2010df.jpg" width="1200" height="675" class="img_ev3q">
我们可以从启动完毕的 ESXi 的界面中得到 ESXi 控制台的登录地址，或者在路由器的管理界面中，以及使用 arp -a 命令，来寻找在网络中“新出现”的家伙。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">arp -a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? (10.11.12.229) at 0:xx:xx:xx:xx:xx on en0 ifscope [ethernet]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>相比较 ESXi 6 和 ESXi 7 ，ESXi 8 的登录界面可以说是“焕然一新”。</p>
<p><img decoding="async" loading="lazy" alt="ESXi 新版  登录界面" src="/assets/images/login-web-ui-eb4cadd232742f9a6117355777931680.jpg" width="1200" height="621" class="img_ev3q">
使用我们设置好的账号密码，登录控制台，就能看到新版本的控制台啦。</p>
<p><img decoding="async" loading="lazy" alt="ESXi 8 新版界面" src="/assets/images/finial-1f17bd42fd3ca98fb3890823cbe137c6.jpg" width="1200" height="585" class="img_ev3q">
想要顺利的使用 ESXi ，别忘记更新授权。具体方法，导航栏点击“管理”菜单，进入管理页面，选择“许可”选项卡，点击分配许可证，输入我们的许可即可。</p>
<p><img decoding="async" loading="lazy" alt="更新 ESXi 8 授权" src="/assets/images/update-license-14334c64676a0cdc025ea2898b8d4bf1.jpg" width="1200" height="608" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="esxi-安装常见问题解决方案">ESXi 安装常见问题解决方案<a href="#esxi-安装常见问题解决方案" class="hash-link" aria-label="ESXi 安装常见问题解决方案的直接链接" title="ESXi 安装常见问题解决方案的直接链接">​</a></h2>
<p>常见的问题应该主要就下面两种。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="无法进入正式安装过程">无法进入正式安装过程<a href="#无法进入正式安装过程" class="hash-link" aria-label="无法进入正式安装过程的直接链接" title="无法进入正式安装过程的直接链接">​</a></h3>
<p>在 USB 引导设备之后，将先进行安装工具的加载，但是自 ESXi 7 开始，如果我们没有联网（插好网线），或者没有使用能够识别的网卡，将不能继续进行“正式安装过程”。在加载过程的最后，我们将看到类似下面的一闪而过的错误日志界面。</p>
<p><img decoding="async" loading="lazy" alt="ESXi 安装工具加载出错" src="/assets/images/esxi-error-log-a91a25f0dc14d6450bdfae5813968df7.jpg" width="1200" height="675" class="img_ev3q">
解决方法有几种，包括：插上 网线，更换设备网卡，插一张便宜的 USB 网卡，或者降级 ESXi 版本。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="安装过程中卡在no-vmknic-tagged-for-management-was-found">安装过程中卡在“no vmknic tagged for management was found”<a href="#安装过程中卡在no-vmknic-tagged-for-management-was-found" class="hash-link" aria-label="安装过程中卡在“no vmknic tagged for management was found”的直接链接" title="安装过程中卡在“no vmknic tagged for management was found”的直接链接">​</a></h3>
<p>如果你的设备没有 ESXi 8 默认支持的网卡，即使我们在镜像中打了网卡驱动，也会遇到类似下面的问题。</p>
<p><img decoding="async" loading="lazy" alt="安装过程报异常" src="/assets/images/install-exception-fef6d6099c358ea4f7c9dcd8e7d2f403.jpg" width="1200" height="675" class="img_ev3q">
其实，此刻 ESXi 8 已经安装完毕，只差设置“网卡地址”，以及“设置管理员密码”。（这里应该是 VMware 工程师编写代码的疏忽。）</p>
<p>放心的重启设备，拔掉 USB 安装盘，然后等待设备系统加载。</p>
<p><img decoding="async" loading="lazy" alt="系统加载完毕，网络未正确配置" src="/assets/images/network-not-configure-c97cbec98f7efe12b733f3fcd0edfcdb.jpg" width="1200" height="675" class="img_ev3q">
等待 ESXi 启动完毕，我们能够看到网络界面展示的结果是：<code>https://0.0.0.0/ (static)</code>。这个算是很典型的网卡没插网线，或者网卡没配置好的状况。</p>
<p>我们按下 F2 ，然后在登录界面直接按下回车，进入 ESXi 系统设置。</p>
<p><img decoding="async" loading="lazy" alt="登录管理员账号" src="/assets/images/login-to-reset-network-b1a97637480383d213c0365481266942.jpg" width="1200" height="675" class="img_ev3q">
选择“网络恢复”选项。</p>
<p><img decoding="async" loading="lazy" alt="进行网络恢复设置" src="/assets/images/network-restore-options-ac9592ab5d37cb98b08b37c7f4730b89.jpg" width="1200" height="675" class="img_ev3q">
在新的界面中，再次确认恢复网络设置。（重置网络）</p>
<p><img decoding="async" loading="lazy" alt="确认重置网络" src="/assets/images/confirm-to-restore-ec27830ade2d139c3fdeef44d85685ee.jpg" width="1200" height="675" class="img_ev3q">
完成网络重置之后，返回 ESXi 界面，能够发现网络状态，就已经正常啦。</p>
<p>下面记录下制作这个镜像工具的过程，希望能够帮助到“后来的人”。比如，如果 ESXi 出新版了，工具需要升级，而我恰好没有时间折腾。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="制作-docker-esxi-构建工具镜像">制作 Docker ESXi 构建工具镜像<a href="#制作-docker-esxi-构建工具镜像" class="hash-link" aria-label="制作 Docker ESXi 构建工具镜像的直接链接" title="制作 Docker ESXi 构建工具镜像的直接链接">​</a></h2>
<p>ESXi 构建工具 <a href="https://vdc-repo.vmware.com/vmwb-repository/dcr-public/9619cb6d-3975-4bff-aa1f-0e785283a1a9/58d0925b-e15d-4803-bbd4-eb314dd165b0/GUID-9081EBAF-BF85-48B1-82A0-D1C49F3FF1E8.html" target="_blank" rel="noopener noreferrer">PowerCLI 的文档中有提到[12]</a>，运行它需要 Python 3.7 运行环境，所以我们使用 <code>python:3.7</code> 作为基础镜像。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FROM python:3.7</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接着，先来安装需要的 Python 依赖软件包：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RUN pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple &amp;&amp; pip install six psutil lxml pyopenssl --no-cache-dir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>以及，PowerCLI 运行需要的 <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux-debian" target="_blank" rel="noopener noreferrer">.Net 运行环境[13]</a>和 PowerShell 环境：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RUN wget &quot;https://packages.microsoft.com/config/debian/11/packages-microsoft-prod.deb&quot; -O packages-microsoft-prod.deb &amp;&amp; dpkg -i packages-microsoft-prod.deb &amp;&amp; rm packages-microsoft-prod.deb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN sed -i -e &quot;s/deb.debian.org/mirrors.tuna.tsinghua.edu.cn/&quot; /etc/apt/sources.list &amp;&amp; apt-get update &amp;&amp; apt-get install -y powershell</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后，根据 <a href="https://developer.vmware.com/powercli/installation-guide" target="_blank" rel="noopener noreferrer">VMWare 开发者文档[14]</a>中的 PowerCLI 安装文档，采用离线方案安装完整的 PowerCLI：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RUN curl -L &#x27;https://developer.vmware.com/docs/17484/&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;authority: developer.vmware.com&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;accept: text/html&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;referer: https://developer.vmware.com/powercli/installation-guide&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H &#x27;user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --compressed \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -o VMware-PowerCLI-13.0.0-20829139.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来的工作需要在 Powershell 环境中进行，所以需要设置 pwsh 为容器构建的 shell：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SHELL [&quot;/usr/bin/pwsh&quot;, &quot;-c&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>搞定 pwsh 运行环境之后，我们来一套“组合拳”，完整之前下载完毕的 PowerCLI 的工具压缩包的安装，以及做一个简单的环境清理：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">RUN cd $($env:PSModulePath | awk -F &#x27;:&#x27; &#x27;{print $1}&#x27;) &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mv /VMware-PowerCLI-13.0.0-20829139.zip . &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Expand-Archive ./VMware-PowerCLI-13.0.0-20829139.zip ./ &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rm -rf ./VMware-PowerCLI-13.0.0-20829139.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最后，告诉工具镜像用 pwsh 替代 python 作为入口即可：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ENTRYPOINT pwsh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>完整的代码，可以参考 <a href="https://github.com/soulteary/easy-ESXi-builder" target="_blank" rel="noopener noreferrer">soulteary/easy-ESXi-builder[15]</a> 项目。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="其他">其他<a href="#其他" class="hash-link" aria-label="其他的直接链接" title="其他的直接链接">​</a></h2>
<p>关于制作镜像时的技术选型的思考。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么放弃基于-windows-制作镜像或编程构建程序">为什么放弃基于 Windows 制作镜像或编程构建程序<a href="#为什么放弃基于-windows-制作镜像或编程构建程序" class="hash-link" aria-label="为什么放弃基于 Windows 制作镜像或编程构建程序的直接链接" title="为什么放弃基于 Windows 制作镜像或编程构建程序的直接链接">​</a></h3>
<p>想要制作 ESXi 镜像，我们需要使用到官方提供的 PowerCLI，在<a href="https://vdc-repo.vmware.com/vmwb-repository/dcr-public/9619cb6d-3975-4bff-aa1f-0e785283a1a9/58d0925b-e15d-4803-bbd4-eb314dd165b0/GUID-9081EBAF-BF85-48B1-82A0-D1C49F3FF1E8.html" target="_blank" rel="noopener noreferrer"> VMWare 官方的一处文档中[16]</a>，我们可以看到下面的线索：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">To use the VMware.ImageBuilder module, you must install Python 3.7 with four additional packages and configure PowerCLI.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting from VMware PowerCLI 13.0, Python 3.7 is a prerequisite for using the VMware.ImageBuilder module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">You must also install four additional packages in Python:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- six</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- psutil</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- lxml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- pyopenssl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To configure PowerCLI, you must set the path to the Python 3.7 executable by using the Set-PowerCLIConfiguration cmdlet.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果我们坚持使用 Windows，那么我们可能需要先<a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/install/installing-windows-powershell?view=powershell-7.3" target="_blank" rel="noopener noreferrer">解决 Powershell 的版本更新[17]</a>，以及安装今年即将退出舞台的 Python 3.7 ，要知道目前我们能够获得到的 Windows 的符合条件的 Python 3.7 版本的安装包是 2020 年 8 月的 <a href="https://www.python.org/downloads/release/python-379/" target="_blank" rel="noopener noreferrer">Python 3.7.9[18]</a>。</p>
<p>并且，Windows 环境下，当我们使用构建必须使用到的命令 Add-EsxSoftwareDepot 来引用官方的安装镜像的时候，可能会遇到需 要设置 Python 运行环境路径，设置之后并不生效的问题。以及安装 get-pip 可能因为 Python 版本比较久引发的各种小问题，比如这个：<a href="https://github.com/pypa/get-pip/issues/124" target="_blank" rel="noopener noreferrer">“No module named &#x27;distutils.cmd&#x27;”[19]</a> 等。</p>
<p>与其面对这些“按下葫芦又起瓢”的问题，不如选择更长久、稳定的方案。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="为什么没有使用-ubuntu-作为基础镜像而选择了-debian">为什么没有使用 Ubuntu 作为基础镜像，而选择了 Debian<a href="#为什么没有使用-ubuntu-作为基础镜像而选择了-debian" class="hash-link" aria-label="为什么没有使用 Ubuntu 作为基础镜像，而选择了 Debian的直接链接" title="为什么没有使用 Ubuntu 作为基础镜像，而选择了 Debian的直接链接">​</a></h3>
<p>构建镜像需要的 PowerCLI 构建工具，依赖 .Net Runtime，同时也依赖 Python 3.7 版本。</p>
<p>Ubuntu 22.04 安装 Python 3.7 这个老版本比较麻烦，需要使用 ppa 或者下载 deb 包，出于文章前面提到的长久的考虑，不推荐使用 Ubuntu 20.04 或者 18.04 这俩比较久的镜像。</p>
<p>所以，不如直接使用“干净又卫生”的 Python 3.7 的 Docker 镜像，来作为基础镜像。而这个镜像的底子就是 Debian。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="最后">最后<a href="#最后" class="hash-link" aria-label="最后的直接链接" title="最后的直接链接">​</a></h2>
<p>好了，这篇文章就先写到这里啦。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="引用链接">引用链接<a href="#引用链接" class="hash-link" aria-label="引用链接的直接链接" title="引用链接的直接链接">​</a></h2>
<p>[1] <a href="https://soulteary.com/2021/06/22/nuc-notes-install-esxi7.html" target="_blank" rel="noopener noreferrer">《NUC 折腾笔记 - 安装 ESXi 7》</a>
[2] <a href="https://blog.zuthof.nl/2022/11/30/powercli-13-update-and-installation-hurdles-on-windows/" target="_blank" rel="noopener noreferrer">《PowerCLI 13 update and installation hurdles on Windows》</a>
[3] <a href="https://my.vmware.com/web/vmware/evalcenter?p=free-esxi8&amp;source=dwnp" target="_blank" rel="noopener noreferrer">VMware vSphere Hypervisor 8</a>
[4] <a href="https://my.vmware.com/web/vmware/evalcenter?p=free-esxi7&amp;source=dwnp" target="_blank" rel="noopener noreferrer">VMware vSphere Hypervisor 7</a>
[5] <a href="https://github.com/soulteary/easy-ESXi-builder" target="_blank" rel="noopener noreferrer">soulteary/easy-ESXi-builder</a>
[6] <a href="https://www.docker.com/" target="_blank" rel="noopener noreferrer">Docker 官方网站</a>
[7] <a href="https://soulteary.com/2022/06/21/building-a-cost-effective-linux-learning-environment-on-a-laptop-the-basics.html#%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84-docker-%E5%AE%89%E8%A3%85" target="_blank" rel="noopener noreferrer">《在笔记本上搭建高性价比的 Linux 学习环境：基础篇》</a>
[8] <a href="https://flings.vmware.com/community-networking-driver-for-esxi" target="_blank" rel="noopener noreferrer">community-networking-driver-for-esxi</a>
[9] <a href="https://flings.vmware.com/usb-network-native-driver-for-esxi" target="_blank" rel="noopener noreferrer">usb-network-native-driver-for-esxi</a>
[10] <a href="https://flings.vmware.com/community-nvme-driver-for-esxi" target="_blank" rel="noopener noreferrer">community-nvme-driver-for-esxi</a>
[11] <a href="https://www.balena.io/etcher" target="_blank" rel="noopener noreferrer">Balena Etcher</a>
[12] <a href="https://vdc-repo.vmware.com/vmwb-repository/dcr-public/9619cb6d-3975-4bff-aa1f-0e785283a1a9/58d0925b-e15d-4803-bbd4-eb314dd165b0/GUID-9081EBAF-BF85-48B1-82A0-D1C49F3FF1E8.html" target="_blank" rel="noopener noreferrer">PowerCLI 的文档中有提到</a>
[13] <a href="https://learn.microsoft.com/en-us/dotnet/core/install/linux-debian" target="_blank" rel="noopener noreferrer">.Net 运行环境</a>
[14] <a href="https://developer.vmware.com/powercli/installation-guide" target="_blank" rel="noopener noreferrer">VMWare 开发者文档</a>
[15] <a href="https://github.com/soulteary/easy-ESXi-builder" target="_blank" rel="noopener noreferrer">soulteary/easy-ESXi-builder</a>
[16] <a href="https://vdc-repo.vmware.com/vmwb-repository/dcr-public/9619cb6d-3975-4bff-aa1f-0e785283a1a9/58d0925b-e15d-4803-bbd4-eb314dd165b0/GUID-9081EBAF-BF85-48B1-82A0-D1C49F3FF1E8.html" target="_blank" rel="noopener noreferrer">VMWare 官方的一处文档中</a>
[17] <a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/install/installing-windows-powershell?view=powershell-7.3" target="_blank" rel="noopener noreferrer">解决 Powershell 的版本更新</a>
[18] <a href="https://www.python.org/downloads/release/python-379/" target="_blank" rel="noopener noreferrer">Python 3.7.9</a>
[19] <a href="https://github.com/pypa/get-pip/issues/124" target="_blank" rel="noopener noreferrer">“No module named &#x27;distutils.cmd&#x27;”</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/lorchr/light-docusaurus/tree/main/diy/aio/11-Esxi-Reference-1.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->由 <b>Lorchr</b> <!-- -->于 <b><time datetime="2025-05-09T14:22:14.000Z" itemprop="dateModified">2025年5月9日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/diy/aio/Esxi/"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Esxi</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/diy/aio/PVE/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">PVE</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#写在前面" class="table-of-contents__link toc-highlight">写在前面</a><ul><li><a href="#申请免费的-esxi-个人授权" class="table-of-contents__link toc-highlight">申请免费的 ESXi 个人授权</a></li><li><a href="#本篇文章中的开源项目" class="table-of-contents__link toc-highlight">本篇文章中的开源项目</a></li></ul></li><li><a href="#快速制作-esxi-安装镜像" class="table-of-contents__link toc-highlight">快速制作 ESXi 安装镜像</a></li><li><a href="#esxi-8-的安装" class="table-of-contents__link toc-highlight">ESXi 8 的安装</a><ul><li><a href="#制作-usb-安装引导盘" class="table-of-contents__link toc-highlight">制作 USB 安装引导盘</a></li><li><a href="#完成-esxi-的安装" class="table-of-contents__link toc-highlight">完成 ESXi 的安装</a></li></ul></li><li><a href="#esxi-安装常见问题解决方案" class="table-of-contents__link toc-highlight">ESXi 安装常见问题解决方案</a><ul><li><a href="#无法进入正式安装过程" class="table-of-contents__link toc-highlight">无法进入正式安装过程</a></li><li><a href="#安装过程中卡在no-vmknic-tagged-for-management-was-found" class="table-of-contents__link toc-highlight">安装过程中卡在“no vmknic tagged for management was found”</a></li></ul></li><li><a href="#制作-docker-esxi-构建工具镜像" class="table-of-contents__link toc-highlight">制作 Docker ESXi 构建工具镜像</a></li><li><a href="#其他" class="table-of-contents__link toc-highlight">其他</a><ul><li><a href="#为什么放弃基于-windows-制作镜像或编程构建程序" class="table-of-contents__link toc-highlight">为什么放弃基于 Windows 制作镜像或编程构建程序</a></li><li><a href="#为什么没有使用-ubuntu-作为基础镜像而选择了-debian" class="table-of-contents__link toc-highlight">为什么没有使用 Ubuntu 作为基础镜像，而选择了 Debian</a></li></ul></li><li><a href="#最后" class="table-of-contents__link toc-highlight">最后</a></li><li><a href="#引用链接" class="table-of-contents__link toc-highlight">引用链接</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/category/guide/">Torch</a></li><li class="footer__item"><a class="footer__link-item" href="/middleware/">Middleware</a></li><li class="footer__item"><a class="footer__link-item" href="/electron/">Electron</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/lorchr" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/diy/">DIY</a></li><li class="footer__item"><a href="https://github.com/lorchr/light-docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Offical</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docusaurus.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Home<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://docusaurus.io/docs/playground" target="_blank" rel="noopener noreferrer" class="footer__link-item">Playground<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Light-Docusaurus, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>